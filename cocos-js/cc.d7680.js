System.register([],(function(t,e){"use strict";return{execute:function(){t({BitMask:qt,CCClass:Ge,CacheMode:void 0,DebugMode:void 0,Enum:Yt,Eventify:an,ExtrapolationMode:void 0,HorizontalTextAlignment:void 0,InstanceMaterialType:void 0,KeyCode:void 0,Overflow:void 0,PipelineEventType:void 0,QuatInterpolationMode:void 0,RealInterpolationMode:void 0,SystemEventType:void 0,TangentWeightMode:void 0,VerticalTextAlignment:void 0,WorldNode3DToLocalNodeUI:Rb,WorldNode3DToWorldNodeUI:Db,absMax:ui,absMaxComponent:li,approx:qn,assert:m,assertID:I,bezier:M_,bezierByTime:Z_,ccenum:Zt,clamp:Yn,clamp01:Kn,color:pi,computeRatioByType:fU,createDefaultPipeline:PM,debug:g,deserialize:Bh,earcut:fJ,enumerableProps:hi,equals:Xn,error:d,errorID:b,find:ED,fragmentText:qj,getBaselineOffset:function(){return 0},getError:R,getPathFromRoot:function(t,e){for(var n=t,i="";null!==n&&n!==e;)i=n.name+"/"+i,n=n.parent;return i.slice(0,-1)},getSerializationMetadata:function(t){return t[sl]},getWorldTransformUntilRoot:function(t,e,n){for(Ri.identity(n);t!==e;)Ri.fromRTS(kG,t.rotation,t.position,t.scale),Ri.multiply(n,kG,n),t=t.parent;return n},instantiate:$h,inverseLerp:ci,isCustomTargetModifier:qG,isDisplayStats:D,isElementModifier:XG,isPropertyModifier:WG,isUnicodeCJK:Vj,isUnicodeSpace:jj,isValid:Qe,lerp:Qn,log:_,logID:T,markAsWarning:void 0,mat4:Mi,murmurhash2_32_gc:Po,nextPow2:ai,pingPong:si,pseudoRandom:ni,pseudoRandomRange:ii,pseudoRandomRangeInt:ri,quat:Pi,randomRange:ti,randomRangeInt:ei,rect:ji,removeProperty:void 0,repeat:oi,replaceProperty:void 0,safeMeasureText:Wj,sampleAnimationCurve:hU,setDefaultLogTimes:function(t){t>0&&(kn=t)},setDisplayStats:O,size:Hi,toDegree:Jn,toRadian:Zn,tween:wct,tweenUtil:Pct,v2:Fi,v3:vi,v4:Ui,warn:p,warnID:E});var n="undefined"==typeof window?global:window,i=t("cclegacy",{_global:n});i.internal={},n.CC_BUILD=!0,n.CC_TEST=!1,n.CC_EDITOR=false,n.CC_PREVIEW=!1,n.CC_DEV=!1,n.CC_DEBUG=!1,n.CC_JSB=!1,n.CC_BYTEDANCE=!1,n.CC_WECHAT=!1,n.CC_ALIPAY=!1,n.CC_XIAOMI=!1,n.CC_BAIDU=!1,n.CC_COCOSPLAY=!1,n.CC_HUAWEI=!1,n.CC_OPPO=!1,n.CC_VIVO=!1,n.CC_MINIGAME=!1,n.CC_RUNTIME_BASED=!1,n.CC_SUPPORT_JIT=!0;var r=t("VERSION","3.4.2");n.CocosEngine=i.ENGINE_VERSION=r,n.cc=i;var a="https://github.com/cocos-creator/engine/blob/develop/EngineErrorMap.md",o=null,s=console.log.bind(console),c=s,l=s,u=function(t,e){if(!t){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];console.log("ASSERT: "+f.apply(void 0,[e].concat(i)))}},h=s;function f(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return i.js.formatStr.apply(null,[t].concat(n))}function _(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return s.apply(void 0,[t].concat(n))}function p(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return c.apply(void 0,[t].concat(n))}function d(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return l.apply(void 0,[t].concat(n))}function m(t,e){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return u.apply(void 0,[t,e].concat(i))}function g(){return h.apply(void 0,arguments)}function v(t){if(s=c=l=u=h=function(){},t!==w.NONE){if(t>w.ERROR){var e=function(t){if(i.game.canvas){if(!o){var e=document.createElement("Div");e.setAttribute("id","logInfoDiv"),e.setAttribute("width","200"),e.setAttribute("height",i.game.canvas.height);var n=e.style;n.zIndex="99999",n.position="absolute",n.top=n.left="0",(o=document.createElement("textarea")).setAttribute("rows","20"),o.setAttribute("cols","30"),o.setAttribute("disabled","true");var r=o.style;r.backgroundColor="transparent",r.borderBottom="1px solid #cccccc",r.borderTopWidth=r.borderLeftWidth=r.borderRightWidth="0px",r.borderTopStyle=r.borderLeftStyle=r.borderRightStyle="none",r.padding="0px",r.margin="0px",e.appendChild(o),i.game.canvas.parentNode.appendChild(e)}o.value=o.value+t+"\r\n",o.scrollTop=o.scrollHeight}};l=function(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];e("ERROR :  "+f.apply(void 0,[t].concat(i)))},u=function(t,n){if(!t){for(var i=arguments.length,r=new Array(i>2?i-2:0),a=2;a<i;a++)r[a-2]=arguments[a];e("ASSERT: "+f.apply(void 0,[n].concat(r)))}},t!==w.ERROR_FOR_WEB_PAGE&&(c=function(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];e("WARN :  "+f.apply(void 0,[t].concat(i)))}),t===w.INFO_FOR_WEB_PAGE&&(s=function(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];e(f.apply(void 0,[t].concat(i)))})}else console&&(console.error||(console.error=console.log),console.warn||(console.warn=console.log),l=console.error.bind?console.error.bind(console):function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return console.error.apply(console,[t].concat(n))},u=function(t,e){if(!t){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];var a=f.apply(void 0,[e].concat(i));throw new Error(a)}});if(t!==w.ERROR&&(c=console.warn.bind?console.warn.bind(console):function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return console.warn.apply(console,[t].concat(n))}),t<=w.INFO&&(s=console.log.bind?console.log.bind(console):function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return console.log.apply(console,[t].concat(n))}),t<=w.VERBOSE&&"function"==typeof console.debug){var n=console.debug.bind(console);h=function(){return n.apply(void 0,arguments)}}}}function y(t){d(t.stack||t)}function x(t){return function(e){for(var n=t+" "+e+", please go to "+a+"#"+e+" to see details.",i=arguments.length,r=new Array(i>1?i-1:0),o=1;o<i;o++)r[o-1]=arguments[o];return 0===r.length?n:n+" Arguments: "+r.join(", ")}}var S=x("Log");function T(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];_(S.apply(void 0,[t].concat(n)))}var A=x("Warning");function E(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];p(A.apply(void 0,[t].concat(n)))}var C=x("Error");function b(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];d(C.apply(void 0,[t].concat(n)))}var w,P=x("Assert");function I(t,e){if(!t){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];m(!1,P.apply(void 0,[e].concat(i)))}}function R(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return C.apply(void 0,[t].concat(n))}function D(){return!!i.profiler&&i.profiler.isShowingStats()}function O(t){i.profiler&&(t?i.profiler.showStats():i.profiler.hideStats(),i.game.config.showFPS=!!t)}!function(t){t[t.NONE=0]="NONE",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.INFO_FOR_WEB_PAGE=5]="INFO_FOR_WEB_PAGE",t[t.WARN_FOR_WEB_PAGE=6]="WARN_FOR_WEB_PAGE",t[t.ERROR_FOR_WEB_PAGE=7]="ERROR_FOR_WEB_PAGE"}(w||(w=t("DebugMode",{})));var M=Object.freeze({__proto__:null,log:_,warn:p,error:d,assert:m,debug:g,_resetDebugSetting:v,_throw:y,logID:T,warnID:E,errorID:b,assertID:I,get DebugMode(){return w},getError:R,isDisplayStats:D,setDisplayStats:O});function N(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function L(t,e,n){return e&&N(t.prototype,e),n&&N(t,n),t}function B(){return(B=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}).apply(this,arguments)}function F(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,U(t,e)}function z(t){return(z=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function U(t,e){return(U=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function k(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function G(t,e,n){return(G=k()?Reflect.construct:function(t,e,n){var i=[null];i.push.apply(i,e);var r=new(Function.bind.apply(t,i));return n&&U(r,n.prototype),r}).apply(null,arguments)}function H(t){var e="function"==typeof Map?new Map:void 0;return(H=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,i)}function i(){return G(t,arguments,z(this).constructor)}return i.prototype=Object.create(t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),U(i,t)})(t)}function V(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function j(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function W(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return j(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?j(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0;return function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=t[Symbol.iterator]()).next.bind(n)}function X(t,e,n,i){n&&Object.defineProperty(t,e,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(i):void 0})}function q(t,e,n,i,r){var a={};return Object.keys(i).forEach((function(t){a[t]=i[t]})),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce((function(n,i){return i(t,e,n)||n}),a),r&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(r):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(t,e,a),a=null),a}var Y=function(){function t(t){this.i=0,this.array=t}var e=t.prototype;return e.remove=function(t){var e=this.array.indexOf(t);e>=0&&this.removeAt(e)},e.removeAt=function(t){this.array.splice(t,1),t<=this.i&&--this.i},e.fastRemove=function(t){var e=this.array.indexOf(t);e>=0&&this.fastRemoveAt(e)},e.fastRemoveAt=function(t){var e=this.array;e[t]=e[e.length-1],--e.length,t<=this.i&&--this.i},e.push=function(t){this.array.push(t)},L(t,[{key:"length",get:function(){return this.array.length},set:function(t){this.array.length=t,this.i>=t&&(this.i=t-1)}}]),t}();function K(t,e){t.splice(e,1)}function Q(t,e){var n=t.length;e<0||e>=n||(t[e]=t[n-1],t.length=n-1)}function Z(t,e){var n=t.indexOf(e);return n>=0&&(K(t,n),!0)}function J(t,e){return t.indexOf(e)>=0}var $=Object.freeze({__proto__:null,removeAt:K,fastRemoveAt:Q,remove:Z,fastRemove:function(t,e){var n=t.indexOf(e);n>=0&&(t[n]=t[t.length-1],--t.length)},removeIf:function(t,e){var n=t.findIndex(e);if(n>=0){var i=t[n];return K(t,n),i}},verifyType:function(t,e){if(t&&t.length>0)for(var n,i=W(t);!(n=i()).done;)if(!(n.value instanceof e))return T(1300),!1;return!0},removeArray:function(t,e){for(var n=0,i=e.length;n<i;n++)Z(t,e[n])},appendObjectsAt:function(t,e,n){return t.splice.apply(t,[n,0].concat(e)),t},contains:J,copy:function(t){for(var e=t.length,n=new Array(e),i=0;i<e;i+=1)n[i]=t[i];return n},MutableForwardIterator:Y}),tt=function(){function t(t){this.id=void 0,this.prefix=void 0,this.id=0|998*Math.random(),this.prefix=t?t+".":""}return t.prototype.getNewId=function(){return this.prefix+ ++this.id},t}();tt.global=new tt("global");var et=new tt("TmpCId."),nt="undefined"==typeof Symbol?"__aliases__":Symbol("[[Aliases]]"),it="__cid__";function rt(t){return"number"==typeof t||t instanceof Number}function at(t){return"string"==typeof t||t instanceof String}function ot(t){for(var e in t)return!1;return!0}var st,ct=(st={value:void 0,enumerable:!1,writable:!1,configurable:!0},function(t,e,n,i,r){st.value=n,st.writable=i,st.enumerable=r,Object.defineProperty(t,e,st),st.value=void 0}),lt=function(){var t={get:void 0,set:void 0,enumerable:!1};return function(e,n,i,r,a,o){void 0===a&&(a=!1),void 0===o&&(o=!1),"boolean"==typeof r&&(a=r,r=void 0),t.get=i,t.set=r,t.enumerable=a,t.configurable=o,Object.defineProperty(e,n,t),t.get=void 0,t.set=void 0}}(),ut=function(){var t={get:void 0,enumerable:!1,configurable:!1};return function(e,n,i,r,a){t.get=i,t.enumerable=r,t.configurable=a,Object.defineProperty(e,n,t),t.get=void 0}}(),ht=function(){var t={set:void 0,enumerable:!1,configurable:!1};return function(e,n,i,r,a){t.set=i,t.enumerable=r,t.configurable=a,Object.defineProperty(e,n,t),t.set=void 0}}();function ft(t){var e=Object.create(null);return t&&(e["."]=1,e["/"]=1,delete e["."],delete e["/"]),e}function _t(t){if("function"==typeof t){var e=t.prototype;if(e&&e.hasOwnProperty("__classname__")&&e.__classname__)return e.__classname__;var n="";if(t.name&&(n=t.name),t.toString){var i,r=t.toString();(i="["===r.charAt(0)?r.match(/\[\w+\s*(\w+)\]/):r.match(/function\s*(\w+)/))&&2===i.length&&(n=i[1])}return"Object"!==n?n:""}return t&&t.constructor?_t(t.constructor):""}function pt(t,e,n,i){var r=/([^.]+)$/,a=r.exec(e)[0],o=r.exec(n)[0];function s(){return this[o]}i?lt(t,a,s,(function(t){this[o]=t})):ut(t,a,s)}function dt(t,e,n,i){for(var r in n)pt(t,e+"."+r,n[r],i)}var mt=/(%d)|(%s)/,gt=/%s/;function vt(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];if(0===arguments.length)return"";if(0===n.length)return""+t;var r="string"==typeof t&&mt.test(t);if(r)for(var a,o=W(n);!(a=o()).done;){var s=a.value,c="number"==typeof s?mt:gt;if(c.test(t)){var l=""+s;t=t.replace(c,l)}else t+=" "+s}else for(var u,h=W(n);!(u=h()).done;){var f=u.value;t+=" "+f}return t}function yt(){for(var t=arguments.length-1,e=new Array(t),n=0;n<t;++n)e[n]=arguments[n+1];return e}function xt(t,e){for(;t;){var n=Object.getOwnPropertyDescriptor(t,e);if(n)return n;t=Object.getPrototypeOf(t)}return null}function St(t,e,n){var i=xt(e,t);i&&Object.defineProperty(n,t,i)}function Tt(t){t=t||{};for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];for(var r=0,a=n;r<a.length;r++){var o=a[r];if(o){if("object"!=typeof o){b(5402,o);continue}for(var s in o)s in t||St(s,o,t)}}return t}function At(t){t=t||{};for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];for(var r=0,a=n;r<a.length;r++){var o=a[r];if(o){if("object"!=typeof o){b(5403,o);continue}for(var s in o)St(s,o,t)}}return t}function Et(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t.prototype=Object.create(e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),t}function Ct(t){var e=t.prototype,n=e&&Object.getPrototypeOf(e);return n&&n.constructor}function bt(t,e){if(t&&e){if("function"!=typeof t)return!1;if("function"!=typeof e)return!1;if(t===e)return!0;for(;;){if(!(t=Ct(t)))return!1;if(t===e)return!0}}return!1}function wt(t){for(var e=0,n=Object.keys(t);e<n.length;e++)delete t[n[e]]}var Pt=ft(!0),It=ft(!0);function Rt(t,e){return function(n,i){if(i.prototype.hasOwnProperty(t)&&delete e[i.prototype[t]],ct(i.prototype,t,n),n){var r=e[n];r&&r!==i?d("A Class already exists with the same "+t+' : "'+n+'".'):e[n]=i}}}var Dt=Rt("__cid__",Pt),Ot=Rt("__classname__",It);function Mt(t,e){if(Ot(t,e),!e.prototype.hasOwnProperty(it)){var n=t||et.getNewId();n&&Dt(n,e)}}function Nt(t,e){var n=It[e],i=Pt[e],r=!0;if(n&&n!==t&&(d('"'+e+'" has already been set as name or alias of another class.'),r=!1),i&&i!==t&&(d('"'+e+'" has already been set as id or alias of another class.'),r=!1),r){var a=t[nt];a||(a=[],t[nt]=a),a.push(e),It[e]=t,Pt[e]=t}}function Lt(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var i=0,r=e;i<r.length;i++){var a=r[i],o=a.prototype,s=o.__cid__;s&&delete Pt[s];var c=o.__classname__;c&&delete It[c];var l=o[nt];if(l)for(var u=0;u<l.length;++u){var h=l[u];delete It[h],delete Pt[h]}}}function Bt(t){return Pt[t]}function Ft(t){return It[t]}function zt(t,e){if(e=void 0===e||e,"function"==typeof t&&t.prototype.hasOwnProperty(it))return t.prototype.__cid__;if(t&&t.constructor){var n=t.constructor.prototype;if(n&&n.hasOwnProperty(it))return t.__cid__}return""}var Ut=function(){var t=e.prototype;function e(t,e){this.count=void 0,this._pool=void 0,this._cleanup=void 0;var n=void 0===e?t:e,i=void 0===e?null:t;this.count=0,this._pool=new Array(n),this._cleanup=i}return t.get=function(){return this._get()},t._get=function(){if(this.count>0){--this.count;var t=this._pool[this.count];return this._pool[this.count]=null,t}return null},t.put=function(t){var e=this._pool;if(this.count<e.length){if(this._cleanup&&!1===this._cleanup(t))return;e[this.count]=t,++this.count}},t.resize=function(t){t>=0&&(this._pool.length=t,this.count>t&&(this.count=t))},e}(),kt=$,Gt={IDGenerator:tt,Pool:Ut,array:$,isNumber:rt,isString:at,isEmptyObject:ot,getPropertyDescriptor:xt,addon:Tt,mixin:At,extend:Et,getSuper:Ct,isChildClassOf:bt,clear:wt,value:ct,getset:lt,get:ut,set:ht,unregisterClass:Lt,getClassName:_t,setClassName:Mt,setClassAlias:Nt,getClassByName:Ft,get _registeredClassNames(){return B({},It)},set _registeredClassNames(t){wt(It),Object.assign(It,t)},get _registeredClassIds(){return B({},Pt)},set _registeredClassIds(t){wt(Pt),Object.assign(Pt,t)},_getClassId:zt,_setClassId:Dt,_getClassById:Bt,obsolete:pt,obsoletes:dt,formatStr:vt,shiftArguments:yt,createMap:ft};i.js=Gt,t("js",Object.freeze({__proto__:null,array:kt,js:Gt,IDGenerator:tt,Pool:Ut,isNumber:rt,isString:at,isEmptyObject:ot,value:ct,getset:lt,get:ut,set:ht,createMap:ft,getClassName:_t,obsolete:pt,obsoletes:dt,formatStr:vt,shiftArguments:yt,getPropertyDescriptor:xt,addon:Tt,mixin:At,extend:Et,getSuper:Ct,isChildClassOf:bt,clear:wt,_idToClass:Pt,_nameToClass:It,_setClassId:Dt,setClassName:Mt,setClassAlias:Nt,unregisterClass:Lt,_getClassById:Bt,getClassByName:Ft,_getClassId:zt}));var Ht=new(function(){function t(){this._pools=[],this._lastShrinkPassed=0,this.shrinkTimeSpan=5}var e=t.prototype;return e.addContainer=function(t){-1===t._poolHandle&&(t._poolHandle=this._pools.length,this._pools.push(t))},e.removeContainer=function(t){-1!==t._poolHandle&&(this._pools[this._pools.length-1]._poolHandle=t._poolHandle,Gt.array.fastRemoveAt(this._pools,t._poolHandle),t._poolHandle=-1)},e.tryShrink=function(){for(var t=0;t<this._pools.length;t++)this._pools[t].tryShrink()},e.update=function(t){this._lastShrinkPassed+=t,this._lastShrinkPassed>this.shrinkTimeSpan&&(this.tryShrink(),this._lastShrinkPassed-=this.shrinkTimeSpan)},t}()),Vt=function(){function t(){this._poolHandle=-1,Ht.addContainer(this)}return t.prototype.destroy=function(){Ht.removeContainer(this)},t}(),jt=t("Pool",function(t){function e(e,n,i){var r;(r=t.call(this)||this)._ctor=void 0,r._elementsPerBatch=void 0,r._nextAvail=void 0,r._freepool=[],r._dtor=void 0,r._ctor=e,r._dtor=i||null,r._elementsPerBatch=Math.max(n,1),r._nextAvail=r._elementsPerBatch-1;for(var a=0;a<r._elementsPerBatch;++a)r._freepool.push(e());return r}F(e,t);var n=e.prototype;return n.alloc=function(){if(this._nextAvail<0){this._freepool.length=this._elementsPerBatch;for(var t=0;t<this._elementsPerBatch;t++)this._freepool[t]=this._ctor();this._nextAvail=this._elementsPerBatch-1}return this._freepool[this._nextAvail--]},n.free=function(t){this._freepool[++this._nextAvail]=t},n.freeArray=function(t){this._freepool.length=this._nextAvail+1,Array.prototype.push.apply(this._freepool,t),this._nextAvail+=t.length},n.tryShrink=function(){if(this._nextAvail>>1>this._elementsPerBatch){if(this._dtor)for(var t=this._nextAvail>>1;t<=this._nextAvail;t++)this._dtor(this._freepool[t]);this._freepool.length=this._nextAvail>>1,this._nextAvail=this._freepool.length-1}},n.destroy=function(){var e=arguments.length>0?arguments[0]:null;e&&E(14100);var n=e||this._dtor;if(n)for(var i=0;i<=this._nextAvail;i++)n(this._freepool[i]);this._freepool.length=0,this._nextAvail=-1,t.prototype.destroy.call(this)},e}(Vt)),Wt=t("RecyclePool",function(t){function e(e,n,i){var r;(r=t.call(this)||this)._fn=void 0,r._dtor=null,r._count=0,r._data=void 0,r._initSize=0,r._fn=e,r._dtor=i||null,r._data=new Array(n),r._initSize=n;for(var a=0;a<n;++a)r._data[a]=e();return r}F(e,t);var n=e.prototype;return n.reset=function(){this._count=0},n.resize=function(t){if(t>this._data.length)for(var e=this._data.length;e<t;++e)this._data[e]=this._fn()},n.add=function(){return this._count>=this._data.length&&this.resize(this._data.length<<1),this._data[this._count++]},n.destroy=function(){if(this._dtor)for(var e=0;e<this._data.length;e++)this._dtor(this._data[e]);this._data.length=0,this._count=0,t.prototype.destroy.call(this)},n.tryShrink=function(){if(this._data.length>>2>this._count){var t=Math.max(this._initSize,this._data.length>>1);if(this._dtor)for(var e=t;e<this._data.length;e++)this._dtor(this._data[e]);this._data.length=t}},n.removeAt=function(t){if(!(t>=this._count)){var e=this._count-1,n=this._data[t];this._data[t]=this._data[e],this._data[e]=n,this._count-=1}},L(e,[{key:"length",get:function(){return this._count}},{key:"data",get:function(){return this._data}}]),e}(Vt)),Xt=t("CachedArray",function(t){function e(e,n){var i;return(i=t.call(this)||this).array=void 0,i.length=0,i._compareFn=void 0,i._initSize=0,i.array=new Array(e),i._initSize=e,i.length=0,i._compareFn=void 0!==n?n:function(t,e){return t-e},i}F(e,t);var n=e.prototype;return n.push=function(t){this.array[this.length++]=t},n.pop=function(){return this.array[--this.length]},n.get=function(t){return this.array[t]},n.clear=function(){this.length=0},n.destroy=function(){this.length=0,this.array.length=0,t.prototype.destroy.call(this)},n.tryShrink=function(){this.array.length>>2>this.length&&(this.array.length=Math.max(this._initSize,this.array.length>>1))},n.sort=function(){this.array.length=this.length,this.array.sort(this._compareFn)},n.concat=function(t){for(var e=0;e<t.length;++e)this.array[this.length++]=t[e]},n.fastRemove=function(t){if(!(t>=this.length||t<0)){var e=--this.length;this.array[t]=this.array[e]}},n.indexOf=function(t){for(var e=0,n=this.length;e<n;++e)if(this.array[e]===t)return e;return-1},e}(Vt));function qt(t){if("__bitmask__"in t)return t;ct(t,"__bitmask__",null,!0);for(var e=-1,n=Object.keys(t),i=0;i<n.length;i++){var r=n[i],a=t[r];if(-1===a)a=++e,t[r]=a;else if("number"==typeof a)e=a;else if("string"==typeof a&&Number.isInteger(parseFloat(r)))continue;var o=""+a;r!==o&&ct(t,o,r)}return t}function Yt(t){return"__enums__"in t?t:(ct(t,"__enums__",null,!0),Yt.update(t))}function Kt(t){t.hasOwnProperty("__enums__")}function Qt(t){Kt(t);var e=t.__enums__||[];for(var n in e.length=0,t){var i=t[n];Number.isInteger(i)&&e.push({name:n,value:i})}return e.sort((function(t,e){return t.value-e.value})),t.__enums__=e,e}function Zt(t){"__enums__"in t||ct(t,"__enums__",null,!0)}t("memop",Object.freeze({__proto__:null,Pool:jt,RecyclePool:Wt,CachedArray:Xt})),qt.isBitMask=function(t){return t&&t.hasOwnProperty("__bitmask__")},qt.getList=function(t){if(t.__bitmask__)return t.__bitmask__;var e=t.__bitmask__=[];for(var n in t){var i=t[n];Number.isInteger(i)&&e.push({name:n,value:i})}return e.sort((function(t,e){return t.value-e.value})),e},i.BitMask=qt,Yt.update=function(t){for(var e=-1,n=Object.keys(t),i=0;i<n.length;i++){var r=n[i],a=t[r];if(-1===a)a=++e,t[r]=a;else if("number"==typeof a)e=a;else if("string"==typeof a&&Number.isInteger(parseFloat(r)))continue;var o=""+a;r!==o&&ct(t,o,r)}return Array.isArray(t.__enums__)&&Qt(t),t},Yt||(Yt=t("Enum",{})),Yt.isEnum=function(t){return t&&t.hasOwnProperty("__enums__")},Yt.getList=function(t){return Kt(t),t.__enums__?t.__enums__:Qt(t)},i.Enum=Yt;var Jt=t("ValueType",function(){function t(){}var e=t.prototype;return e.clone=function(){return b(100,_t(this)+".clone"),this},e.equals=function(){return!1},e.set=function(){b(100,_t(this)+".set")},e.toString=function(){return""+{}},t}());Mt("cc.ValueType",Jt),i.ValueType=Jt;var $t=t("macro",{SUPPORT_TEXTURE_FORMATS:[".astc",".pkm",".pvr",".webp",".jpg",".jpeg",".bmp",".png"],KEY:{none:0,back:6,menu:18,backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,select:41,insert:45,Delete:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,num0:96,num1:97,num2:98,num3:99,num4:100,num5:101,num6:102,num7:103,num8:104,num9:105,"*":106,"+":107,"-":109,numdel:110,"/":111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,";":186,semicolon:186,equal:187,"=":187,",":188,comma:188,dash:189,".":190,period:190,forwardslash:191,grave:192,"[":219,openbracket:219,backslash:220,"]":221,closebracket:221,quote:222,dpadLeft:1e3,dpadRight:1001,dpadUp:1003,dpadDown:1004,dpadCenter:1005},RAD:Math.PI/180,DEG:180/Math.PI,REPEAT_FOREVER:Number.MAX_VALUE-1,FLT_EPSILON:1.192092896e-7,ORIENTATION_PORTRAIT:1,ORIENTATION_LANDSCAPE:2,ORIENTATION_AUTO:3,ENABLE_TILEDMAP_CULLING:!0,TOUCH_TIMEOUT:5e3,ENABLE_TRANSPARENT_CANVAS:!1,ENABLE_WEBGL_ANTIALIAS:!0,ENABLE_ANTIALIAS_FXAA:!1,ENABLE_BLOOM:!1,CLEANUP_IMAGE_CACHE:!1,ENABLE_MULTI_TOUCH:!0,MAX_LABEL_CANVAS_POOL_SIZE:20,ENABLE_WEBGL_HIGHP_STRUCT_VALUES:!1,BATCHER2D_MEM_INCREMENT:144});i.macro=$t;for(var te=/^(?:cc|dragonBones|sp|ccsg)\..+/,ee=new Array(123),ne=0;ne<123;++ne)ee[ne]=64;for(var ie=0;ie<64;++ie)ee["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charCodeAt(ie)]=ie;var re=ee;function ae(t,e,n){function i(t,e,n,i){var r=Object.getOwnPropertyDescriptor(t,e);if(r)r.get&&(t[n]=r.get),r.set&&i&&(t[i]=r.set);else{var a=t[n];lt(t,e,a,t[i])}}for(var r,a=t.prototype,o=0;o<e.length;o++){var s=(r=e[o])[0].toUpperCase()+r.slice(1);i(a,r,"get"+s,"set"+s)}for(r in n){var c=n[r];i(a,r,c[0],c[1])}}function oe(t,e,n,i){var r=t[e];r?Array.isArray(r)?i?(r.push(r[0]),r[0]=n):r.push(n):t[e]=i?[n,r]:[r,n]:t[e]=n}function se(t,e){if("function"==typeof t.contains)return t.contains(e);if("function"==typeof t.compareDocumentPosition)return!!(16&t.compareDocumentPosition(e));var n=e.parentNode;if(n)do{if(n===t)return!0;n=n.parentNode}while(null!==n);return!1}function ce(t){return"object"==typeof window&&"function"==typeof Node?t instanceof Node:t&&"object"==typeof t&&"number"==typeof t.nodeType&&"string"==typeof t.nodeName}function le(t,e,n){t&&setTimeout((function(){t(e,n)}),0)}function ue(t){return!(!t||t.constructor!==Object)&&ot(t)}function he(t,e,n){if(e>n){var i=e;e=n,n=i}return t<e?e:t<n?t:n}function fe(t){return t*$t.RAD}function _e(t){return t*$t.DEG}i.misc={BUILTIN_CLASSID_RE:te,BASE64_VALUES:re,propertyDefine:ae,pushToMap:oe,contains:se,isDomNode:ce,callInNextTick:le,isPlainEmptyObj_DEV:ue,clampf:he,degreesToRadians:fe,radiansToDegrees:_e},t("misc",Object.freeze({__proto__:null,BUILTIN_CLASSID_RE:te,BASE64_VALUES:re,propertyDefine:ae,pushToMap:oe,contains:se,isDomNode:ce,callInNextTick:le,tryCatchFunctor_EDITOR:function(t){return Function("target","try {\n  target."+t+"();\n}\ncatch (e) {\n  cc._throw(e);\n}")},isPlainEmptyObj_DEV:ue,clampf:he,degreesToRadians:fe,radiansToDegrees:_e}));var pe="$_$";function de(t,e){var n=e?Object.create(e):{};return ct(t,"__attrs__",n),n}function me(t){if("function"!=typeof t)return de(t,ve(t.constructor));for(var e,n=i.Class.getInheritanceChain(t),r=n.length-1;r>=0;r--){var a=n[r];a.hasOwnProperty("__attrs__")&&a.__attrs__||de(a,(e=n[r+1])&&e.__attrs__)}return de(t,(e=n[0])&&e.__attrs__),t.__attrs__}function ge(t,e){var n=ve(t),i=e+pe,r={};for(var a in n)a.startsWith(i)&&(r[a.slice(i.length)]=n[a]);return r}function ve(t){return t.hasOwnProperty("__attrs__")&&t.__attrs__||me(t)}function ye(t,e,n,i){ve(t)[e+pe+n]=i}var xe=function(){function t(t,e){this.name=void 0,this.default=void 0,this.name=t,this.default=e}return t.prototype.toString=function(){return this.name},t}(),Se=t("CCInteger",new xe("Integer",0));i.Integer=Se,i.CCInteger=Se;var Te=t("CCFloat",new xe("Float",0));i.Float=Te,i.CCFloat=Te;var Ae=t("CCBoolean",new xe("Boolean",!1));i.Boolean=Ae,i.CCBoolean=Ae;var Ee=t("CCString",new xe("String",""));function Ce(t,e){return function(n,i){var r='"'+_t(n)+"."+i+'"',a=ge(n,i),o=a.type;if(o===Se||o===Te?o="Number":o!==Ee&&o!==Ae||(o=""+o),o===t){if(a.hasOwnProperty("default")){var s=a.default;if(void 0!==s&&!Array.isArray(s)&&!ue(s)){var c=typeof s,l=t.toLowerCase();if(c===l)if("object"===l){if(!s||s instanceof a.ctor)return;E(3605,r,_t(a.ctor))}else"Number"!==t&&E(3606,e,r,t);else{if("function"===c)return;t===Ee.default&&null==s?E(3607,r):E(3611,e,r,c)}delete a.type}}}else E(3604,r)}}i.String=Ee,i.CCString=Ee;var be=Object.freeze({__proto__:null,DELIMETER:pe,createAttrsSingle:de,createAttrs:me,attr:ge,getClassAttrs:ve,setClassAttr:ye,PrimitiveType:xe,CCInteger:Se,CCFloat:Te,CCBoolean:Ae,CCString:Ee,getTypeChecker_ET:Ce,getObjTypeChecker_ET:function(t){return function(e,n){Ce("Object","type")(e,n);var r=ve(e)[n+pe+"default"],a=i.Class.getDefault(r);if(!Array.isArray(a)&&bt(t,i.ValueType)){var o=_t(t),s=vt('No need to specify the "type" of "%s.%s" because %s is a child class of ValueType.',_t(e),n,o);r?_(s):E(3612,s,o,_t(e),n,o)}}}}),we={default:{},serializable:{},editorOnly:{},formerlySerializedAs:{}};function Pe(t,e,n,i){if(!t.get&&!t.set&&t.hasOwnProperty("default")){var r="_N$"+e;t.get=function(){return this[r]},t.set=function(t){var e=this[r];this[r]=t,n.call(this,e)};var a={};for(var o in i[r]=a,we){var s=we[o];t.hasOwnProperty(o)&&(a[o]=t[o],s.canUsedInGet||delete t[o])}}}function Ie(t,e,n,r){if(Array.isArray(e)){if(!(e.length>0))return b(5508,n,r);t.type=e=e[0]}"function"==typeof e&&(e===String?t.type=i.String:e===Boolean?t.type=i.Boolean:e===Number&&(t.type=i.Float))}function Re(t,e,n){var i=t?{_short:!0}:{_short:!0,default:e};return n&&(i.type=n),i}function De(t,e){if(!t||t.constructor!==Object){if(Array.isArray(t)&&t.length>0)return Re(e,[],t);if("function"==typeof t){var n=t;return Re(e,bt(n,i.ValueType)?new n:null,n)}return Re(e,t instanceof xe?t.default:t)}return null}var Oe=[];function Me(){return Oe[Oe.length-1]}i._RF={push:function(t,e,n,i){void 0===n&&(n=e,e=""),Oe.push({uuid:e,script:n,module:t,exports:t.exports,beh:null,importMeta:i})},pop:function(){var t=Oe.pop(),e=t.module,n=e.exports;if(n===t.exports){for(var i in n)return;e.exports=n=t.cls}},peek:Me};var Ne=pe,Le={datas:null,push:function(t){if(this.datas)this.datas.push(t);else{this.datas=[t];var e=this;setTimeout((function(){e.init()}),0)}},init:function(){var t=this.datas;if(t){for(var e=0;e<t.length;++e){var n=t[e],i=n.cls,r=n.props;"function"==typeof r&&(r=r());var a=_t(i);r?ke(i,a,r,i.$super,n.mixins):b(3633,a)}this.datas=null}}};function Be(t,e,n,i){!function(t,e){!function(t,e){t.indexOf(e)<0&&t.push(e)}(t.__props__,e)}(t,n),Ve(t,i,e,n)}function Fe(t,e,n,i){var r=i.get;i.set,r&&(Ve(t,i,e,n),ye(t,n,"serializable",!1))}function ze(t){return"function"==typeof t?t():t}function Ue(t,e,n){for(var i in e)t.hasOwnProperty(i)||n&&!n(i)||Object.defineProperty(t,i,xt(e,i))}function ke(t,e,n,i,r){if(t.__props__=[],i&&i.__props__&&(t.__props__=i.__props__.slice()),r)for(var a=0;a<r.length;++a){var o=r[a];o.__props__&&(t.__props__=t.__props__.concat(o.__props__.filter((function(e){return t.__props__.indexOf(e)<0}))))}if(n)for(var s in function(t,e){for(var n in t){var i=t[n],r=De(i,!1);if(r&&(i=t[n]=r),i){var a=i.notify;a&&Pe(i,n,a,t),"type"in i&&Ie(i,i.type,e,n)}}}(n,e),n){var c=n[s];c.get||c.set?Fe(t,e,s,c):Be(t,e,s,c)}var l=ve(t);t.__values__=t.__props__.filter((function(t){return!1!==l[t+Ne+"serializable"]}))}function Ge(t){var e=t.name,n=t.extends,r=t.mixins,a=function(t,e,n,r){var a=i.Component,o=Me();if(o&&bt(e,a)){if(bt(o.cls,a))return b(3615),null;t=t||o.script}var s=function(t,e,n,i){var r=i.ctor,a=[r],o=r;ct(o,"__ctors__",a.length>0?a:null,!0);var s=o.prototype;if(e&&(o.$super=e),n){for(var c=n.length-1;c>=0;c--){var l=n[c];Ue(s,l.prototype),Ge._isCCClass(l)&&Ue(ve(o),ve(l))}s.constructor=o}return Mt(t,o),o}(t,e,n,r);if(o)if(bt(e,a)){var c=o.uuid;c&&Dt(c,s),o.cls=s}else bt(o.cls,a)||(o.cls=s);return s}(e,n,r,t);e||(e=i.js.getClassName(a)),a._sealed=!0,n&&(n._sealed=!1);var o=t.properties;"function"==typeof o||n&&null===n.__props__||r&&r.some((function(t){return null===t.__props__}))?(Le.push({cls:a,props:o,mixins:r}),a.__props__=a.__values__=null):ke(a,e,o,n,t.mixins);var s=t.editor;return s&&bt(n,i.Component)&&i.Component._registerEditorProps(a,s),a}Ge._isCCClass=function(t){var e;return null==t||null===(e=t.hasOwnProperty)||void 0===e?void 0:e.call(t,"__ctors__")},Ge.fastDefine=function(t,e,n){Mt(t,e);for(var i=e.__props__=e.__values__=Object.keys(n),r=ve(e),a=0;a<i.length;a++){var o=i[a];r[o+Ne+"visible"]=!1,r[o+Ne+"default"]=n[o]}},Ge.Attr=be,Ge.attr=ge,Ge.getInheritanceChain=function(t){for(var e=[];t=Ct(t);)t!==Object&&e.push(t);return e};var He={Integer:"Number",Float:"Number",Boolean:"Boolean",String:"String"};function Ve(t,e,n,i){var r=null,a="";function o(){return a=i+Ne,r=ve(t)}"type"in e&&void 0===e.type&&E(3660,i,n);var s=e.type;s&&(He[s]?(r||o())[a+"type"]=s:"Object"===s||("object"==typeof s?Yt.isEnum(s)?((r||o())[a+"type"]="Enum",r[a+"enumList"]=Yt.getList(s)):qt.isBitMask(s)&&((r||o())[a+"type"]="BitMask",r[a+"bitmaskList"]=qt.getList(s)):"function"==typeof s&&((r||o())[a+"type"]="Object",r[a+"ctor"]=s))),"default"in e&&((r||o())[a+"default"]=e.default);var c,l=function(t,n){if(t in e){var i=e[t];typeof i===n&&((r||o())[a+t]=i)}};e.editorOnly&&((r||o())[a+"editorOnly"]=!0),e.__noImplicit?(r||o())[a+"serializable"]=null!==(c=e.serializable)&&void 0!==c&&c:!1===e.serializable&&((r||o())[a+"serializable"]=!1),l("formerlySerializedAs","string");var u=e.range;u&&Array.isArray(u)&&u.length>=2&&((r||o())[a+"min"]=u[0],r[a+"max"]=u[1],u.length>2&&(r[a+"step"]=u[2])),l("min","number"),l("max","number"),l("step","number")}Ge.isArray=function(t){return t=ze(t),Array.isArray(t)},Ge.getDefault=ze,Ge.escapeForJS=function(t){return JSON.stringify(t).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")},Ge.IDENTIFIER_RE=/^[A-Za-z_$][0-9A-Za-z_$]*$/,Ge.getNewValueTypeCode=function(t){for(var e=_t(t),n=t.constructor,i="new "+e+"(",r=0;r<n.__props__.length;r++)i+=t[n.__props__[r]],r<n.__props__.length-1&&(i+=",");return i+")"},i.Class=Ge;var je,We=t("editorExtrasTag","__editorExtras__"),Xe=1<<22,qe=[],Ye=t("CCObject",function(){function t(t){void 0===t&&(t=""),this._objFlags=void 0,this._name=void 0,this._name=t,this._objFlags=0}t._deferredDestroy=function(){for(var t=qe.length,e=0;e<t;++e){var n=qe[e];1&n._objFlags||n._destroyImmediate()}t===qe.length?qe.length=0:qe.splice(0,t)};var e=t.prototype;return e.destroy=function(){return 1&this._objFlags?(E(5e3),!1):!(4&this._objFlags||(this._objFlags|=4,qe.push(this),0))},e._destruct=function(){var t=this.constructor,e=t.__destruct__;e||(e=function(t,e){var n,r=t instanceof i._BaseNode||t instanceof i.Component,a=r?"_id":null,o={};for(n in t)if(t.hasOwnProperty(n)){if(n===a)continue;switch(typeof t[n]){case"string":o[n]="";break;case"object":case"function":o[n]=null}}if(Ge._isCCClass(e))for(var s=i.Class.Attr.getClassAttrs(e),c=e.__props__,l=0;l<c.length;l++){var u=(n=c[l])+i.Class.Attr.DELIMETER+"default";if(u in s){if(r&&"_id"===n)continue;switch(typeof s[u]){case"string":o[n]="";break;case"object":case"function":o[n]=null;break;case"undefined":o[n]=void 0}}}var h="";for(n in o){var f;f=Ge.IDENTIFIER_RE.test(n)?"o."+n+"=":"o["+Ge.escapeForJS(n)+"]=";var _=o[n];""===_&&(_='""'),h+=f+_+";\n"}return Function("o",h)}(this,t),ct(t,"__destruct__",e,!0)),e(this)},e._destroyImmediate=function(){1&this._objFlags?b(5e3):(this._onPreDestroy&&this._onPreDestroy(),this._destruct(),this._objFlags|=1)},L(t,[{key:"name",get:function(){return this._name},set:function(t){this._name=t}},{key:"hideFlags",get:function(){return this._objFlags&t.Flags.AllHideMasks},set:function(e){var n=e&t.Flags.AllHideMasks;this._objFlags=this._objFlags&~t.Flags.AllHideMasks|n}},{key:"replicated",get:function(){return!!(this._objFlags&Xe)},set:function(t){t?this._objFlags|=Xe:this._objFlags&=-4194305}},{key:"isValid",get:function(){return!(1&this._objFlags)}}]),t}()),Ke=Ye.prototype;function Qe(t,e){return"object"==typeof t?!(!t||t._objFlags&(e?5:1)):void 0!==t}Ke._deserialize=null,Ke._onPreDestroy=null,Ge.fastDefine("cc.Object",Ye,((je={_name:"",_objFlags:0})[We]={},je)),Ge.Attr.setClassAttr(Ye,We,"editorOnly",!0),Ge.Attr.setClassAttr(Ye,"replicated","visible",!1),ct(Ye,"Flags",{Destroyed:1,DontSave:8,EditorOnly:16,Dirty:32,DontDestroy:64,PersistentMask:-4192741,Destroying:128,Deactivating:256,LockedInEditor:512,HideInHierarchy:1024,AllHideMasks:1560,IsPreloadStarted:8192,IsOnLoadStarted:32768,IsOnLoadCalled:16384,IsOnEnableCalled:2048,IsStartCalled:65536,IsEditorOnEnableCalled:4096,IsPositionLocked:1<<21,IsRotationLocked:1<<17,IsScaleLocked:1<<18,IsAnchorLocked:1<<19,IsSizeLocked:1<<20}),i.isValid=Qe,i.Object=Ye;var Ze=kt.fastRemoveAt;function Je(){}var $e=function(){function t(){this.callback=Je,this.target=void 0,this.once=!1}var e=t.prototype;return e.set=function(t,e,n){this.callback=t||Je,this.target=e,this.once=!!n},e.reset=function(){this.target=void 0,this.callback=Je,this.once=!1},e.check=function(){return!(this.target instanceof Ye&&!Qe(this.target,!0))},t}(),tn=new jt((function(){return new $e}),32),en=function(){function t(){this.callbackInfos=[],this.isInvoking=!1,this.containCanceled=!1}var e=t.prototype;return e.removeByCallback=function(t){for(var e=0;e<this.callbackInfos.length;++e){var n=this.callbackInfos[e];n&&n.callback===t&&(n.reset(),tn.free(n),Ze(this.callbackInfos,e),--e)}},e.removeByTarget=function(t){for(var e=0;e<this.callbackInfos.length;++e){var n=this.callbackInfos[e];n&&n.target===t&&(n.reset(),tn.free(n),Ze(this.callbackInfos,e),--e)}},e.cancel=function(t){var e=this.callbackInfos[t];e&&(e.reset(),this.isInvoking?this.callbackInfos[t]=null:Ze(this.callbackInfos,t),tn.free(e)),this.containCanceled=!0},e.cancelAll=function(){for(var t=0;t<this.callbackInfos.length;t++){var e=this.callbackInfos[t];e&&(e.reset(),tn.free(e),this.callbackInfos[t]=null)}this.containCanceled=!0},e.purgeCanceled=function(){for(var t=this.callbackInfos.length-1;t>=0;--t)this.callbackInfos[t]||Ze(this.callbackInfos,t);this.containCanceled=!1},e.clear=function(){this.cancelAll(),this.callbackInfos.length=0,this.isInvoking=!1,this.containCanceled=!1},t}(),nn=new jt((function(){return new en}),16),rn=function(){function t(){this._callbackTable=ft(!0),this._offCallback=void 0}var e=t.prototype;return e.on=function(t,e,n,i){if(!this.hasEventListener(t,e,n)){var r=this._callbackTable[t];r||(r=this._callbackTable[t]=nn.alloc());var a=tn.alloc();a.set(e,n,i),r.callbackInfos.push(a)}return e},e.hasEventListener=function(t,e,n){var i=this._callbackTable&&this._callbackTable[t];if(!i)return!1;var r=i.callbackInfos;if(!e){if(i.isInvoking){for(var a=0;a<r.length;++a)if(r[a])return!0;return!1}return r.length>0}for(var o=0;o<r.length;++o){var s=r[o];if(s&&s.check()&&s.callback===e&&s.target===n)return!0}return!1},e.removeAll=function(t){var e=typeof t;if("string"===e||"number"===e){var n=this._callbackTable&&this._callbackTable[t];n&&(n.isInvoking?n.cancelAll():(n.clear(),nn.free(n),delete this._callbackTable[t]))}else if(t)for(var i in this._callbackTable){var r=this._callbackTable[i];if(r.isInvoking)for(var a=r.callbackInfos,o=0;o<a.length;++o){var s=a[o];s&&s.target===t&&r.cancel(o)}else r.removeByTarget(t)}},e.off=function(t,e,n){var i,r=this._callbackTable&&this._callbackTable[t];if(r){var a=r.callbackInfos;if(e)for(var o=0;o<a.length;++o){var s=a[o];if(s&&s.callback===e&&s.target===n){r.cancel(o);break}}else this.removeAll(t)}null===(i=this._offCallback)||void 0===i||i.call(this)},e.emit=function(t,e,n,i,r,a){var o=this._callbackTable&&this._callbackTable[t];if(o){var s=!o.isInvoking;o.isInvoking=!0;for(var c=o.callbackInfos,l=0,u=c.length;l<u;++l){var h=c[l];if(h){var f=h.callback,_=h.target;h.once&&this.off(t,f,_),h.check()?_?f.call(_,e,n,i,r,a):f(e,n,i,r,a):this.off(t,f,_)}}s&&(o.isInvoking=!1,o.containCanceled&&o.purgeCanceled())}},e.clear=function(){for(var t in this._callbackTable){var e=this._callbackTable[t];e&&(e.clear(),nn.free(e),delete this._callbackTable[t])}},e._registerOffCallback=function(t){this._offCallback=t},t}();function an(t){for(var e=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._callbackTable=ft(!0),e}F(e,t);var n=e.prototype;return n.once=function(t,e,n){return this.on(t,e,n,!0)},n.targetOff=function(t){this.removeAll(t)},e}(t),n=rn.prototype,i=Object.getOwnPropertyNames(n).concat(Object.getOwnPropertySymbols(n)),r=0;r<i.length;++r){var a=i[r];if(!(a in e.prototype)){var o=Object.getOwnPropertyDescriptor(n,a);o&&Object.defineProperty(e.prototype,a,o)}}return e}var on,sn,cn,ln,un,hn,fn=t("EventTarget",an((function(){})));i.EventTarget=fn,function(t){t.UNKNOWN="unknown",t.WECHAT="wechat",t.ANDROID="androidbrowser",t.IE="ie",t.EDGE="edge",t.QQ="qqbrowser",t.MOBILE_QQ="mqqbrowser",t.UC="ucbrowser",t.UCBS="ucbs",t.BROWSER_360="360browser",t.BAIDU_APP="baiduboxapp",t.BAIDU="baidubrowser",t.MAXTHON="maxthon",t.OPERA="opera",t.OUPENG="oupeng",t.MIUI="miuibrowser",t.FIREFOX="firefox",t.SAFARI="safari",t.CHROME="chrome",t.LIEBAO="liebao",t.QZONE="qzone",t.SOUGOU="sogou",t.HUAWEI="huawei"}(on||(on={})),function(t){t.UNKNOWN="unknown",t.ENGLISH="en",t.CHINESE="zh",t.FRENCH="fr",t.ITALIAN="it",t.GERMAN="de",t.SPANISH="es",t.DUTCH="du",t.RUSSIAN="ru",t.KOREAN="ko",t.JAPANESE="ja",t.HUNGARIAN="hu",t.PORTUGUESE="pt",t.ARABIC="ar",t.NORWEGIAN="no",t.POLISH="pl",t.TURKISH="tr",t.UKRAINIAN="uk",t.ROMANIAN="ro",t.BULGARIAN="bg"}(sn||(sn={})),function(t){t[t.NONE=0]="NONE",t[t.LAN=1]="LAN",t[t.WWAN=2]="WWAN"}(cn||(cn={})),function(t){t.UNKNOWN="Unknown",t.IOS="iOS",t.ANDROID="Android",t.WINDOWS="Windows",t.LINUX="Linux",t.OSX="OS X",t.OHOS="OHOS"}(ln||(ln={})),function(t){t.UNKNOWN="UNKNOWN",t.EDITOR_PAGE="EDITOR_PAGE",t.EDITOR_CORE="EDITOR_CORE",t.MOBILE_BROWSER="MOBILE_BROWSER",t.DESKTOP_BROWSER="DESKTOP_BROWSER",t.WIN32="WIN32",t.ANDROID="ANDROID",t.IOS="IOS",t.MACOS="MACOS",t.OHOS="OHOS",t.WECHAT_GAME="WECHAT_GAME",t.BAIDU_MINI_GAME="BAIDU_MINI_GAME",t.XIAOMI_QUICK_GAME="XIAOMI_QUICK_GAME",t.ALIPAY_MINI_GAME="ALIPAY_MINI_GAME",t.BYTEDANCE_MINI_GAME="BYTEDANCE_MINI_GAME",t.OPPO_MINI_GAME="OPPO_MINI_GAME",t.VIVO_MINI_GAME="VIVO_MINI_GAME",t.HUAWEI_QUICK_GAME="HUAWEI_QUICK_GAME",t.COCOSPLAY="COCOSPLAY",t.LINKSURE_MINI_GAME="LINKSURE_MINI_GAME",t.QTT_MINI_GAME="QTT_MINI_GAME"}(un||(un={})),function(t){t.WEBP="WEBP",t.IMAGE_BITMAP="IMAGE_BITMAP",t.WEB_VIEW="WEB_VIEW",t.VIDEO_PLAYER="VIDEO_PLAYER",t.SAFE_AREA="SAFE_AREA",t.INPUT_TOUCH="INPUT_TOUCH",t.EVENT_KEYBOARD="EVENT_KEYBOARD",t.EVENT_MOUSE="EVENT_MOUSE",t.EVENT_TOUCH="EVENT_TOUCH",t.EVENT_ACCELEROMETER="EVENT_ACCELEROMETER"}(hn||(hn={}));var _n=new(function(t){function e(){var e,n,i;(i=t.call(this)||this).networkType=void 0,i.isNative=void 0,i.isBrowser=void 0,i.isMobile=void 0,i.isLittleEndian=void 0,i.platform=void 0,i.language=void 0,i.nativeLanguage=void 0,i.os=void 0,i.osVersion=void 0,i.osMainVersion=void 0,i.browserType=void 0,i.browserVersion=void 0,i._battery=void 0,i._featureMap=void 0;var r,a=window.navigator,o=a.userAgent.toLowerCase();null===(e=a.getBattery)||void 0===e||e.call(a).then((function(t){i._battery=t})),i.networkType=cn.LAN,i.isNative=!1,i.isBrowser=!0,i.isMobile=/mobile|android|iphone|ipad/.test(o),i.platform=i.isMobile?un.MOBILE_BROWSER:un.DESKTOP_BROWSER,i.isLittleEndian=(r=new ArrayBuffer(2),new DataView(r).setInt16(0,256,!0),256===new Int16Array(r)[0]);var s=a.language;i.nativeLanguage=s.toLowerCase(),s=(s=s||a.browserLanguage)?s.split("-")[0]:sn.ENGLISH,i.language=s;var c=!1,l=!1,u="",h=0,f=/android\s*(\d+(?:\.\d+)*)/i.exec(o)||/android\s*(\d+(?:\.\d+)*)/i.exec(a.platform);f&&(c=!0,u=f[1]||"",h=parseInt(u)||0),(f=/(iPad|iPhone|iPod).*OS ((\d+_?){2,3})/i.exec(o))?(l=!0,u=f[2]||"",h=parseInt(u)||0):(/(iPhone|iPad|iPod)/.exec(a.platform)||"MacIntel"===a.platform&&a.maxTouchPoints&&a.maxTouchPoints>1)&&(l=!0,u="",h=0);var _=ln.UNKNOWN;-1!==a.appVersion.indexOf("Win")?_=ln.WINDOWS:l?_=ln.IOS:-1!==a.appVersion.indexOf("Mac")?_=ln.OSX:-1!==a.appVersion.indexOf("X11")&&-1===a.appVersion.indexOf("Linux")?_=ln.LINUX:c?_=ln.ANDROID:-1===a.appVersion.indexOf("Linux")&&-1===o.indexOf("ubuntu")||(_=ln.LINUX),i.os=_,i.osVersion=u,i.osMainVersion=h,i.browserType=on.UNKNOWN;var p=/wechat|weixin|micromessenger/i.exec(o)||/mqqbrowser|micromessenger|qqbrowser|sogou|qzone|liebao|maxthon|ucbs|360 aphone|360browser|baiduboxapp|baidubrowser|maxthon|mxbrowser|miuibrowser/i.exec(o)||/qq|qqbrowser|ucbrowser|ubrowser|edge|HuaweiBrowser/i.exec(o)||/chrome|safari|firefox|trident|opera|opr\/|oupeng/i.exec(o),d=p?p[0].toLowerCase():ln.UNKNOWN;("safari"===d&&c||"qq"===d&&/android.*applewebkit/i.test(o))&&(d=on.ANDROID);var m={micromessenger:on.WECHAT,wechat:on.WECHAT,weixin:on.WECHAT,trident:on.IE,edge:on.EDGE,"360 aphone":on.BROWSER_360,mxbrowser:on.MAXTHON,"opr/":on.OPERA,ubrowser:on.UC,huaweibrowser:on.HUAWEI};i.browserType=m[d]||d,i.browserVersion="";var g=/(mqqbrowser|micromessenger|qqbrowser|sogou|qzone|liebao|maxthon|uc|ucbs|360 aphone|360|baiduboxapp|baidu|maxthon|mxbrowser|miui(?:.hybrid)?)(mobile)?(browser)?\/?([\d.]+)/i.exec(o);g||(g=/(qq|chrome|safari|firefox|trident|opera|opr\/|oupeng)(mobile)?(browser)?\/?([\d.]+)/i.exec(o)),i.browserVersion=g?g[4]:"";var v,y=document.createElement("canvas");y.getContext("2d");try{v=y.toDataURL("image/webp").startsWith("data:image/webp")}catch(t){v=!1}var x=!1;"undefined"!=typeof createImageBitmap&&"undefined"!=typeof Blob&&(y.width=y.height=2,createImageBitmap(y,{}).then((function(t){x=!0,null==t||t.close()})).catch((function(){})));var S=void 0!==document.documentElement.ontouchstart||void 0!==document.ontouchstart,T=void 0!==document.documentElement.onmouseup;return i._featureMap=((n={})[hn.WEBP]=v,n[hn.IMAGE_BITMAP]=x,n[hn.WEB_VIEW]=!0,n[hn.VIDEO_PLAYER]=!0,n[hn.SAFE_AREA]=!1,n[hn.INPUT_TOUCH]=S,n[hn.EVENT_KEYBOARD]=void 0!==document.documentElement.onkeyup,n[hn.EVENT_MOUSE]=T,n[hn.EVENT_TOUCH]=S||T,n[hn.EVENT_ACCELEROMETER]=void 0!==window.DeviceMotionEvent||void 0!==window.DeviceOrientationEvent,n),i._registerEvent(),i}F(e,t);var n=e.prototype;return n._registerEvent=function(){var t,e=this;t=void 0!==document.hidden?"hidden":void 0!==document.mozHidden?"mozHidden":void 0!==document.msHidden?"msHidden":void 0!==document.webkitHidden?"webkitHidden":"hidden";var n=!1,i=function(){n||(n=!0,e.emit("hide"))},r=function(t,i,r,a,o){n&&(n=!1,e.emit("show",t,i,r,a,o))};if(t)for(var a=["visibilitychange","mozvisibilitychange","msvisibilitychange","webkitvisibilitychange","qbrowserVisibilityChange"],o=0;o<a.length;o++)document.addEventListener(a[o],(function(e){var n=document[t];(n=n||e.hidden)?i():r()}));else window.addEventListener("blur",i),window.addEventListener("focus",r);window.navigator.userAgent.indexOf("MicroMessenger")>-1&&(window.onfocus=r),"onpageshow"in window&&"onpagehide"in window&&(window.addEventListener("pagehide",i),window.addEventListener("pageshow",r),document.addEventListener("pagehide",i),document.addEventListener("pageshow",r))},n.hasFeature=function(t){return this._featureMap[t]},n.getBatteryLevel=function(){return this._battery?this._battery.level:1},n.triggerGC=function(){},n.openURL=function(t){window.open(t)},n.now=function(){return Date.now?Date.now():+new Date},n.restartJSVM=function(){},n.close=function(){this.emit("close"),window.close()},e}(fn)),pn=/(\.[^\.\/\?\\]*)(\?.*)?$/,dn=/((.*)(\/|\\|\\\\))?(.*?\..*$)?/,mn=/[^\.\/]+\/\.\.\//;function gn(){for(var t="",e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];for(var r=0,a=n;r<a.length;r++){var o=a[r];t=(t+(""===t?"":"/")+o).replace(/(\/|\\\\)$/,"")}return t}function vn(t){var e=pn.exec(t);return e?e[1]:""}function yn(t){if(t){var e=t.lastIndexOf(".");if(-1!==e)return t.substring(0,e)}return t}function xn(t,e){var n=t.indexOf("?");n>0&&(t=t.substring(0,n));var i=/(\/|\\)([^\/\\]+)$/g.exec(t.replace(/(\/|\\)$/,""));if(!i)return t;var r=i[2];return e&&t.substring(t.length-e.length).toLowerCase()===e.toLowerCase()?r.substring(0,r.length-e.length):r}function Sn(t){var e=dn.exec(t);return e?e[2]:""}function Tn(t,e){e=e||"";var n=t.indexOf("?"),i="";return n>0&&(i=t.substring(n),t=t.substring(0,n)),(n=t.lastIndexOf("."))<0?t+e+i:t.substring(0,n)+e+i}function An(t,e,n){if(0===e.indexOf("."))return Tn(t,e);var i=t.indexOf("?"),r="",a=n?vn(t):"";return i>0&&(r=t.substring(i),t=t.substring(0,i)),i=(i=t.lastIndexOf("/"))<=0?0:i+1,t.substring(0,i)+e+a+r}function En(t){var e=t=String(t);do{e=t,t=t.replace(mn,"")}while(e.length!==t.length);return t}function Cn(t){return t.replace(/[\/\\]$/,"")}function bn(){return _n.os===ln.WINDOWS?"\\":"/"}t("path",Object.freeze({__proto__:null,join:gn,extname:vn,mainFileName:yn,basename:xn,dirname:Sn,changeExtname:Tn,changeBasename:An,_normalize:En,stripSep:Cn,getSeperator:bn})),i.log=_,i.warn=p,i.error=d,i.assert=m,i._throw=y,i.logID=T,i.warnID=E,i.errorID=b,i.assertID=I,i.debug=M,i.path={join:gn,extname:vn,mainFileName:yn,basename:xn,dirname:Sn,changeExtname:Tn,changeBasename:An,_normalize:En,stripSep:Cn,get sep(){return bn()}};var wn=0,Pn={};function In(t){var e,n;return e=(t>65535)<<4,e|=n=((t>>>=e)>255)<<3,e|=n=((t>>>=n)>15)<<2,(e|=n=((t>>>=n)>3)<<1)|(t>>>=n)>>1}function Rn(t){var e=32;return(t&=-t)&&e--,65535&t&&(e-=16),16711935&t&&(e-=8),252645135&t&&(e-=4),858993459&t&&(e-=2),1431655765&t&&(e-=1),e}function Dn(t){return--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,1+(t|=t>>>16)}var On=new Array(256);!function(t){for(var e=0;e<256;++e){var n=e,i=e,r=7;for(n>>>=1;n;n>>>=1)i<<=1,i|=1&n,--r;t[e]=i<<r&255}}(On);var Mn=Object.freeze({__proto__:null,INT_BITS:32,INT_MAX:2147483647,INT_MIN:-2147483648,sign:function(t){return(t>0)-(t<0)},abs:function(t){var e=t>>31;return(t^e)-e},min:function(t,e){return e^(t^e)&-(t<e)},max:function(t,e){return t^(t^e)&-(t<e)},isPow2:function(t){return!(t&t-1||!t)},log2:In,log10:function(t){return t>=1e9?9:t>=1e8?8:t>=1e7?7:t>=1e6?6:t>=1e5?5:t>=1e4?4:t>=1e3?3:t>=100?2:t>=10?1:0},popCount:function(t){return 16843009*((t=(858993459&(t-=t>>>1&1431655765))+(t>>>2&858993459))+(t>>>4)&252645135)>>>24},countTrailingZeros:Rn,nextPow2:Dn,prevPow2:function(t){return t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)-(t>>>1)},parity:function(t){return t^=t>>>16,t^=t>>>8,t^=t>>>4,27030>>>(t&=15)&1},reverse:function(t){return On[255&t]<<24|On[t>>>8&255]<<16|On[t>>>16&255]<<8|On[t>>>24&255]},interleave2:function(t,e){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t&=65535)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e&=65535)|e<<8))|e<<4))|e<<2))|e<<1))<<1},deinterleave2:function(t,e){return(t=65535&((t=16711935&((t=252645135&((t=858993459&((t=t>>>e&1431655765)|t>>>1))|t>>>2))|t>>>4))|t>>>16))<<16>>16},interleave3:function(t,e,n){return t=1227133513&((t=3272356035&((t=251719695&((t=4278190335&((t&=1023)|t<<16))|t<<8))|t<<4))|t<<2),(t|=(e=1227133513&((e=3272356035&((e=251719695&((e=4278190335&((e&=1023)|e<<16))|e<<8))|e<<4))|e<<2))<<1)|(n=1227133513&((n=3272356035&((n=251719695&((n=4278190335&((n&=1023)|n<<16))|n<<8))|n<<4))|n<<2))<<2},deinterleave3:function(t,e){return(t=1023&((t=4278190335&((t=251719695&((t=3272356035&((t=t>>>e&1227133513)|t>>>2))|t>>>4))|t>>>8))|t>>>16))<<22>>22},nextCombination:function(t){var e=t|t-1;return e+1|(~e&-~e)-1>>>Rn(t)+1}});t("bits",Mn);var Nn,Ln,Bn,Fn,zn,Un,kn=10,Gn=0,Hn=new Map;Fn=function(t,e,n,i,r,a,o){var s=Hn.get(a);s&&s.logTimes>s.count&&(r("'%s' is deprecated, please use '%s' instead. "+o,t+"."+e,n+"."+i),s.count++)},Nn=t("replaceProperty",(function(t,e,n){null!=t&&n.forEach((function(n){var i=Gn++;Hn.set(i,{id:i,count:0,logTimes:void 0!==n.logTimes?n.logTimes:kn});var r=null!=n.target?n.target:t,a=null!=n.newName?n.newName:n.name,o=null!=n.targetName?n.targetName:e,s=r===t,c=n.suggest?"("+n.suggest+")":"";if(null!=n.customFunction)t[n.name]=function(){var t;return Fn(e,n.name,o,a,p,i,c),(t=n.customFunction).call.apply(t,[this].concat(Array.prototype.slice.call(arguments)))};else if(null!=n.customSetter||null!=n.customGetter){var l=null!=n.customSetter,u=null!=n.customGetter;l&&u?Object.defineProperty(t,n.name,{get:function(){return Fn(e,n.name,o,a,p,i,c),n.customGetter.call(this)},set:function(t){Fn(e,n.name,o,a,p,i,c),n.customSetter.call(this,t)},enumerable:!1}):l?Object.defineProperty(t,n.name,{set:function(t){Fn(e,n.name,o,a,p,i,c),n.customSetter.call(this,t)},enumerable:!1}):u&&Object.defineProperty(t,n.name,{get:function(){return Fn(e,n.name,o,a,p,i,c),n.customGetter.call(this)},enumerable:!1})}else Object.defineProperty(t,n.name,{get:function(){return Fn(e,n.name,o,a,p,i,c),s?this[a]:r[a]},set:function(t){Fn(e,n.name,o,a,p,i,c),s?this[a]=t:r[a]=t},enumerable:!1})}))})),Un=function(t,e,n,i,r){var a=Hn.get(i);a&&a.logTimes>a.count&&(n("'%s' has been removed. "+r,t+"."+e),a.count++)},Ln=t("removeProperty",(function(t,e,n){null!=t&&n.forEach((function(n){var i=Gn++;Hn.set(i,{id:i,count:0,logTimes:void 0!==n.logTimes?n.logTimes:kn});var r=n.suggest?"("+n.suggest+")":"";Object.defineProperty(t,n.name,{get:function(){return Un(e,n.name,d,i,r)},set:function(){Un(e,n.name,d,i,r)},enumerable:!1})}))})),zn=function(t,e,n,i,r){var a=Hn.get(i);a&&a.logTimes>a.count&&(n("'%s' is deprecated. "+r,t+"."+e),a.count++)},Bn=t("markAsWarning",(function(t,e,n){null!=t&&n.forEach((function(n){var i=n.name,r=Object.getOwnPropertyDescriptor(t,i);if(r&&r.configurable){var a=Gn++;Hn.set(a,{id:a,count:0,logTimes:void 0!==n.logTimes?n.logTimes:kn});var o=n.suggest?"("+n.suggest+")":"";if(void 0!==r.value)if("function"==typeof r.value){var s=r.value;t[i]=function(){return zn(e,i,p,a,o),s.call.apply(s,[this].concat(Array.prototype.slice.call(arguments)))}}else{var c=r.value;Object.defineProperty(t,i,{configurable:!0,get:function(){return zn(e,i,p,a,o),c}}),r.writable&&Object.defineProperty(t,i,{set:function(t){zn(e,i,p,a,o),c=t}})}else!function(e,n,i,r,a,o){if(e.get){var s=e.get;e.get=function(){return zn(n,i,r,a,o),s.call(this)}}if(e.set){var c=e.set;e.set=function(t){zn(n,i,r,a,o),c.call(this,t)}}Object.defineProperty(t,i,e)}(r,e,i,p,a,o);Object.defineProperty(t,i,{enumerable:!1})}}))}));var Vn=Math.PI/180,jn=180/Math.PI,Wn=t("EPSILON",1e-6);function Xn(t,e){return Math.abs(t-e)<=Wn*Math.max(1,Math.abs(t),Math.abs(e))}function qn(t,e,n){return n=n||Wn,Math.abs(t-e)<=n}function Yn(t,e,n){if(e>n){var i=e;e=n,n=i}return t<e?e:t>n?n:t}function Kn(t){return t<0?0:t>1?1:t}function Qn(t,e,n){return t+(e-t)*n}function Zn(t){return t*Vn}function Jn(t){return t*jn}var $n=t("random",Math.random);function ti(t,e){return Math.random()*(e-t)+t}function ei(t,e){return Math.floor(ti(t,e))}function ni(t){return(t=(9301*t+49297)%233280)/233280}function ii(t,e,n){return ni(t)*(n-e)+e}function ri(t,e,n){return Math.floor(ii(t,e,n))}function ai(t){return--t,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t}function oi(t,e){return t-Math.floor(t/e)*e}function si(t,e){return t=oi(t,2*e),e-Math.abs(t-e)}function ci(t,e,n){return(n-t)/(e-t)}function li(t){return Math.abs(t.x)>Math.abs(t.y)?Math.abs(t.x)>Math.abs(t.z)?t.x:t.z:Math.abs(t.y)>Math.abs(t.z)?t.y:t.z}function ui(t,e){return Math.abs(t)>Math.abs(e)?t:e}function hi(t,e){e.forEach((function(e){Object.defineProperty(t,e,{enumerable:!0})}))}var fi=1/255,_i=t("Color",function(t){function e(e,n,i,r){var a;return(a=t.call(this)||this)._val=0,"string"==typeof e?a.fromHEX(e):void 0!==n?a.set(e,n,i,r):a.set(e),a}F(e,t),e.clone=function(t){var n=new e;return t._val?n._val=t._val:n._val=(t.a<<24>>>0)+(t.b<<16)+(t.g<<8)+t.r,n},e.copy=function(t,e){return t.r=e.r,t.g=e.g,t.b=e.b,t.a=e.a,t},e.set=function(t,e,n,i,r){return t.r=e,t.g=n,t.b=i,t.a=r,t},e.fromHEX=function(t,e){e=0===e.indexOf("#")?e.substring(1):e,t.r=parseInt(e.substr(0,2),16)||0,t.g=parseInt(e.substr(2,2),16)||0,t.b=parseInt(e.substr(4,2),16)||0;var n=parseInt(e.substr(6,2),16);return t.a=Number.isNaN(n)?255:n,t._val=(t.a<<24>>>0)+(t.b<<16)+(t.g<<8)+t.r,t},e.add=function(t,e,n){return t.r=e.r+n.r,t.g=e.g+n.g,t.b=e.b+n.b,t.a=e.a+n.a,t},e.subtract=function(t,e,n){return t.r=e.r-n.r,t.g=e.g-n.g,t.b=e.b-n.b,t.a=e.a-n.a,t},e.multiply=function(t,e,n){return t.r=e.r*n.r,t.g=e.g*n.g,t.b=e.b*n.b,t.a=e.a*n.a,t},e.divide=function(t,e,n){return t.r=e.r/n.r,t.g=e.g/n.g,t.b=e.b/n.b,t.a=e.a/n.a,t},e.scale=function(t,e,n){return t.r=e.r*n,t.g=e.g*n,t.b=e.b*n,t.a=e.a*n,t},e.lerp=function(t,e,n,i){var r=e.r,a=e.g,o=e.b,s=e.a;return r+=(n.r-r)*i,a+=(n.g-a)*i,o+=(n.b-o)*i,s+=(n.a-s)*i,t._val=Math.floor((s<<24>>>0)+(o<<16)+(a<<8)+r),t},e.toArray=function(t,n,i){void 0===i&&(i=0);var r=n instanceof e||n.a>1?1/255:1;return t[i+0]=n.r*r,t[i+1]=n.g*r,t[i+2]=n.b*r,t[i+3]=n.a*r,t},e.fromArray=function(t,e,n){return void 0===n&&(n=0),e.r=255*t[n+0],e.g=255*t[n+1],e.b=255*t[n+2],e.a=255*t[n+3],e},e.strictEquals=function(t,e){return t.r===e.r&&t.g===e.g&&t.b===e.b&&t.a===e.a},e.equals=function(t,e,n){return void 0===n&&(n=Wn),Math.abs(t.r-e.r)<=n*Math.max(1,Math.abs(t.r),Math.abs(e.r))&&Math.abs(t.g-e.g)<=n*Math.max(1,Math.abs(t.g),Math.abs(e.g))&&Math.abs(t.b-e.b)<=n*Math.max(1,Math.abs(t.b),Math.abs(e.b))&&Math.abs(t.a-e.a)<=n*Math.max(1,Math.abs(t.a),Math.abs(e.a))},e.hex=function(t){return(255*t.r<<24|255*t.g<<16|255*t.b<<8|255*t.a)>>>0};var n=e.prototype;return n.clone=function(){var t=new e;return t._val=this._val,t},n.equals=function(t){return t&&this._val===t._val},n.lerp=function(t,e){var n=this.r,i=this.g,r=this.b,a=this.a;return n+=(t.r-n)*e,i+=(t.g-i)*e,r+=(t.b-r)*e,a+=(t.a-a)*e,this._val=Math.floor((a<<24>>>0)+(r<<16)+(i<<8)+n),this},n.toString=function(){return"rgba("+this.r.toFixed()+", "+this.g.toFixed()+", "+this.b.toFixed()+", "+this.a.toFixed()+")"},n.toCSS=function(t){return void 0===t&&(t="rgba"),"rgba"===t?"rgba("+this.r+","+this.g+","+this.b+","+(this.a*fi).toFixed(2)+")":"rgb"===t?"rgb("+this.r+","+this.g+","+this.b+")":"#"+this.toHEX(t)},n.fromHEX=function(t){t=0===t.indexOf("#")?t.substring(1):t;var e=parseInt(t.substr(0,2),16)||0,n=parseInt(t.substr(2,2),16)||0,i=parseInt(t.substr(4,2),16)||0,r=parseInt(t.substr(6,2),16);return r=Number.isNaN(r)?255:r,this._val=(r<<24>>>0)+(i<<16)+(n<<8)+(0|e),this},n.toHEX=function(t){void 0===t&&(t="#rrggbb");var e="0",n=[(this.r<16?e:"")+this.r.toString(16),(this.g<16?e:"")+this.g.toString(16),(this.b<16?e:"")+this.b.toString(16)];return"#rgb"===t?(n[0]=n[0][0],n[1]=n[1][0],n[2]=n[2][0]):"#rrggbbaa"===t&&n.push((this.a<16?e:"")+this.a.toString(16)),n.join("")},n.toRGBValue=function(){return 16777215&this._val},n.fromHSV=function(t,e,n){var i=0,r=0,a=0;if(0===e)i=r=a=n;else if(0===n)i=r=a=0;else{1===t&&(t=0),t*=6;var o=Math.floor(t),s=t-o,c=n*(1-e),l=n*(1-e*s),u=n*(1-e*(1-s));switch(o){case 0:i=n,r=u,a=c;break;case 1:i=l,r=n,a=c;break;case 2:i=c,r=n,a=u;break;case 3:i=c,r=l,a=n;break;case 4:i=u,r=c,a=n;break;case 5:i=n,r=c,a=l}}return i*=255,r*=255,a*=255,this._val=(this.a<<24>>>0)+(a<<16)+(r<<8)+(0|i),this},n.toHSV=function(){var t=this.r*fi,e=this.g*fi,n=this.b*fi,i={h:0,s:0,v:0},r=Math.max(t,e,n),a=Math.min(t,e,n),o=0;return i.v=r,i.s=r?(r-a)/r:0,i.s?(o=r-a,i.h=t===r?(e-n)/o:e===r?2+(n-t)/o:4+(t-e)/o,i.h/=6,i.h<0&&(i.h+=1)):i.h=0,i},n.set=function(t,e,n,i){return"object"==typeof t?null!=t._val?this._val=t._val:(e=t.g||0,n=t.b||0,i="number"==typeof t.a?t.a:255,t=t.r||0,this._val=(i<<24>>>0)+(n<<16)+(e<<8)+(0|t)):(t=t||0,e=e||0,n=n||0,i="number"==typeof i?i:255,this._val=(i<<24>>>0)+(n<<16)+(e<<8)+(0|t)),this},n.multiply=function(t){var e=(255&this._val)*t.r>>8,n=(65280&this._val)*t.g>>8,i=(16711680&this._val)*t.b>>8,r=((4278190080&this._val)>>>8)*t.a;return this._val=4278190080&r|16711680&i|65280&n|255&e,this},n._set_r_unsafe=function(t){return this._val=(4294967040&this._val|t)>>>0,this},n._set_g_unsafe=function(t){return this._val=(4294902015&this._val|t<<8)>>>0,this},n._set_b_unsafe=function(t){return this._val=(4278255615&this._val|t<<16)>>>0,this},n._set_a_unsafe=function(t){return this._val=(16777215&this._val|t<<24)>>>0,this},L(e,[{key:"r",get:function(){return 255&this._val},set:function(t){t=~~Yn(t,0,255),this._val=(4294967040&this._val|t)>>>0}},{key:"g",get:function(){return(65280&this._val)>>8},set:function(t){t=~~Yn(t,0,255),this._val=(4294902015&this._val|t<<8)>>>0}},{key:"b",get:function(){return(16711680&this._val)>>16},set:function(t){t=~~Yn(t,0,255),this._val=(4278255615&this._val|t<<16)>>>0}},{key:"a",get:function(){return(4278190080&this._val)>>>24},set:function(t){t=~~Yn(t,0,255),this._val=(16777215&this._val|t<<24)>>>0}},{key:"x",get:function(){return this.r*fi},set:function(t){this.r=255*t}},{key:"y",get:function(){return this.g*fi},set:function(t){this.g=255*t}},{key:"z",get:function(){return this.b*fi},set:function(t){this.b=255*t}},{key:"w",get:function(){return this.a*fi},set:function(t){this.a=255*t}}]),e}(Jt));function pi(t,e,n,i){return new _i(t,e,n,i)}_i.WHITE=Object.freeze(new _i(255,255,255,255)),_i.GRAY=Object.freeze(new _i(127,127,127,255)),_i.BLACK=Object.freeze(new _i(0,0,0,255)),_i.TRANSPARENT=Object.freeze(new _i(0,0,0,0)),_i.RED=Object.freeze(new _i(255,0,0,255)),_i.GREEN=Object.freeze(new _i(0,255,0,255)),_i.BLUE=Object.freeze(new _i(0,0,255,255)),_i.CYAN=Object.freeze(new _i(0,255,255,255)),_i.MAGENTA=Object.freeze(new _i(255,0,255,255)),_i.YELLOW=Object.freeze(new _i(255,255,0,255)),Ge.fastDefine("cc.Color",_i,{r:0,g:0,b:0,a:255}),i.Color=_i,i.color=pi;var di=t("Vec3",function(t){function e(e,n,i){var r;return r=t.call(this)||this,e&&"object"==typeof e?(r.x=e.x,r.y=e.y,r.z=e.z):(r.x=e||0,r.y=n||0,r.z=i||0),r}F(e,t),e.zero=function(t){return t.x=0,t.y=0,t.z=0,t},e.clone=function(t){return new e(t.x,t.y,t.z)},e.copy=function(t,e){return t.x=e.x,t.y=e.y,t.z=e.z,t},e.set=function(t,e,n,i){return t.x=e,t.y=n,t.z=i,t},e.add=function(t,e,n){return t.x=e.x+n.x,t.y=e.y+n.y,t.z=e.z+n.z,t},e.subtract=function(t,e,n){return t.x=e.x-n.x,t.y=e.y-n.y,t.z=e.z-n.z,t},e.multiply=function(t,e,n){return t.x=e.x*n.x,t.y=e.y*n.y,t.z=e.z*n.z,t},e.divide=function(t,e,n){return t.x=e.x/n.x,t.y=e.y/n.y,t.z=e.z/n.z,t},e.ceil=function(t,e){return t.x=Math.ceil(e.x),t.y=Math.ceil(e.y),t.z=Math.ceil(e.z),t},e.floor=function(t,e){return t.x=Math.floor(e.x),t.y=Math.floor(e.y),t.z=Math.floor(e.z),t},e.min=function(t,e,n){return t.x=Math.min(e.x,n.x),t.y=Math.min(e.y,n.y),t.z=Math.min(e.z,n.z),t},e.max=function(t,e,n){return t.x=Math.max(e.x,n.x),t.y=Math.max(e.y,n.y),t.z=Math.max(e.z,n.z),t},e.round=function(t,e){return t.x=Math.round(e.x),t.y=Math.round(e.y),t.z=Math.round(e.z),t},e.multiplyScalar=function(t,e,n){return t.x=e.x*n,t.y=e.y*n,t.z=e.z*n,t},e.scaleAndAdd=function(t,e,n,i){return t.x=e.x+n.x*i,t.y=e.y+n.y*i,t.z=e.z+n.z*i,t},e.distance=function(t,e){var n=e.x-t.x,i=e.y-t.y,r=e.z-t.z;return Math.sqrt(n*n+i*i+r*r)},e.squaredDistance=function(t,e){var n=e.x-t.x,i=e.y-t.y,r=e.z-t.z;return n*n+i*i+r*r},e.len=function(t){var e=t.x,n=t.y,i=t.z;return Math.sqrt(e*e+n*n+i*i)},e.lengthSqr=function(t){var e=t.x,n=t.y,i=t.z;return e*e+n*n+i*i},e.negate=function(t,e){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t},e.invert=function(t,e){return t.x=1/e.x,t.y=1/e.y,t.z=1/e.z,t},e.invertSafe=function(t,e){var n=e.x,i=e.y,r=e.z;return Math.abs(n)<Wn?t.x=0:t.x=1/n,Math.abs(i)<Wn?t.y=0:t.y=1/i,Math.abs(r)<Wn?t.z=0:t.z=1/r,t},e.normalize=function(t,e){var n=e.x,i=e.y,r=e.z,a=n*n+i*i+r*r;return a>0&&(a=1/Math.sqrt(a),t.x=n*a,t.y=i*a,t.z=r*a),t},e.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},e.cross=function(t,e,n){var i=e.x,r=e.y,a=e.z,o=n.x,s=n.y,c=n.z;return t.x=r*c-a*s,t.y=a*o-i*c,t.z=i*s-r*o,t},e.lerp=function(t,e,n,i){return t.x=e.x+i*(n.x-e.x),t.y=e.y+i*(n.y-e.y),t.z=e.z+i*(n.z-e.z),t},e.random=function(t,e){e=e||1;var n=2*$n()*Math.PI,i=2*$n()-1,r=Math.sqrt(1-i*i);return t.x=r*Math.cos(n)*e,t.y=r*Math.sin(n)*e,t.z=i*e,t},e.transformMat4=function(t,e,n){var i=e.x,r=e.y,a=e.z,o=n.m03*i+n.m07*r+n.m11*a+n.m15;return o=o?Math.abs(1/o):1,t.x=(n.m00*i+n.m04*r+n.m08*a+n.m12)*o,t.y=(n.m01*i+n.m05*r+n.m09*a+n.m13)*o,t.z=(n.m02*i+n.m06*r+n.m10*a+n.m14)*o,t},e.transformMat4Normal=function(t,e,n){var i=e.x,r=e.y,a=e.z,o=n.m03*i+n.m07*r+n.m11*a;return o=o?Math.abs(1/o):1,t.x=(n.m00*i+n.m04*r+n.m08*a)*o,t.y=(n.m01*i+n.m05*r+n.m09*a)*o,t.z=(n.m02*i+n.m06*r+n.m10*a)*o,t},e.transformMat3=function(t,e,n){var i=e.x,r=e.y,a=e.z;return t.x=i*n.m00+r*n.m03+a*n.m06,t.y=i*n.m01+r*n.m04+a*n.m07,t.z=i*n.m02+r*n.m05+a*n.m08,t},e.transformAffine=function(t,e,n){var i=e.x,r=e.y,a=e.z;return t.x=n.m00*i+n.m04*r+n.m08*a+n.m12,t.y=n.m01*i+n.m05*r+n.m09*a+n.m13,t.x=n.m02*i+n.m06*r+n.m10*a+n.m14,t},e.transformQuat=function(t,e,n){var i=n.w*e.x+n.y*e.z-n.z*e.y,r=n.w*e.y+n.z*e.x-n.x*e.z,a=n.w*e.z+n.x*e.y-n.y*e.x,o=-n.x*e.x-n.y*e.y-n.z*e.z;return t.x=i*n.w+o*-n.x+r*-n.z-a*-n.y,t.y=r*n.w+o*-n.y+a*-n.x-i*-n.z,t.z=a*n.w+o*-n.z+i*-n.y-r*-n.x,t},e.transformRTS=function(t,e,n,i,r){var a=e.x*r.x,o=e.y*r.y,s=e.z*r.z,c=n.w*a+n.y*s-n.z*o,l=n.w*o+n.z*a-n.x*s,u=n.w*s+n.x*o-n.y*a,h=-n.x*a-n.y*o-n.z*s;return t.x=c*n.w+h*-n.x+l*-n.z-u*-n.y+i.x,t.y=l*n.w+h*-n.y+u*-n.x-c*-n.z+i.y,t.z=u*n.w+h*-n.z+c*-n.y-l*-n.x+i.z,t},e.transformInverseRTS=function(t,e,n,i,r){var a=e.x-i.x,o=e.y-i.y,s=e.z-i.z,c=n.w*a-n.y*s+n.z*o,l=n.w*o-n.z*a+n.x*s,u=n.w*s-n.x*o+n.y*a,h=n.x*a+n.y*o+n.z*s;return t.x=(c*n.w+h*n.x+l*n.z-u*n.y)/r.x,t.y=(l*n.w+h*n.y+u*n.x-c*n.z)/r.y,t.z=(u*n.w+h*n.z+c*n.y-l*n.x)/r.z,t},e.rotateX=function(t,e,n,i){var r=e.x-n.x,a=e.y-n.y,o=e.z-n.z,s=Math.cos(i),c=Math.sin(i),l=r,u=a*s-o*c,h=a*c+o*s;return t.x=l+n.x,t.y=u+n.y,t.z=h+n.z,t},e.rotateY=function(t,e,n,i){var r=e.x-n.x,a=e.y-n.y,o=e.z-n.z,s=Math.cos(i),c=Math.sin(i),l=o*c+r*s,u=a,h=o*s-r*c;return t.x=l+n.x,t.y=u+n.y,t.z=h+n.z,t},e.rotateZ=function(t,e,n,i){var r=e.x-n.x,a=e.y-n.y,o=e.z-n.z,s=Math.cos(i),c=Math.sin(i),l=r*s-a*c,u=r*c+a*s,h=o;return t.x=l+n.x,t.y=u+n.y,t.z=h+n.z,t},e.toArray=function(t,e,n){return void 0===n&&(n=0),t[n+0]=e.x,t[n+1]=e.y,t[n+2]=e.z,t},e.fromArray=function(t,e,n){return void 0===n&&(n=0),t.x=e[n+0],t.y=e[n+1],t.z=e[n+2],t},e.strictEquals=function(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z},e.equals=function(t,e,n){void 0===n&&(n=Wn);var i=t.x,r=t.y,a=t.z,o=e.x,s=e.y,c=e.z;return Math.abs(i-o)<=n*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-s)<=n*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(a-c)<=n*Math.max(1,Math.abs(a),Math.abs(c))},e.angle=function(t,n){e.normalize(mi,t),e.normalize(gi,n);var i=e.dot(mi,gi);return i>1?0:i<-1?Math.PI:Math.acos(i)},e.projectOnPlane=function(t,n,i){return e.subtract(t,n,e.project(t,n,i))},e.project=function(t,n,i){var r=e.lengthSqr(i);return r<1e-6?e.set(t,0,0,0):e.multiplyScalar(t,i,e.dot(n,i)/r)};var n=e.prototype;return n.clone=function(){return new e(this.x,this.y,this.z)},n.set=function(t,e,n){return t&&"object"==typeof t?(this.x=t.x,this.y=t.y,this.z=t.z):(this.x=t||0,this.y=e||0,this.z=n||0),this},n.equals=function(t,e){return void 0===e&&(e=Wn),Math.abs(this.x-t.x)<=e*Math.max(1,Math.abs(this.x),Math.abs(t.x))&&Math.abs(this.y-t.y)<=e*Math.max(1,Math.abs(this.y),Math.abs(t.y))&&Math.abs(this.z-t.z)<=e*Math.max(1,Math.abs(this.z),Math.abs(t.z))},n.equals3f=function(t,e,n,i){return void 0===i&&(i=Wn),Math.abs(this.x-t)<=i*Math.max(1,Math.abs(this.x),Math.abs(t))&&Math.abs(this.y-e)<=i*Math.max(1,Math.abs(this.y),Math.abs(e))&&Math.abs(this.z-n)<=i*Math.max(1,Math.abs(this.z),Math.abs(n))},n.strictEquals=function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z},n.strictEquals3f=function(t,e,n){return this.x===t&&this.y===e&&this.z===n},n.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.z.toFixed(2)+")"},n.lerp=function(t,e){return this.x+=e*(t.x-this.x),this.y+=e*(t.y-this.y),this.z+=e*(t.z-this.z),this},n.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},n.add3f=function(t,e,n){return this.x+=t,this.y+=e,this.z+=n,this},n.subtract=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},n.subtract3f=function(t,e,n){return this.x-=t,this.y-=e,this.z-=n,this},n.multiplyScalar=function(t){return"object"==typeof t&&console.warn("should use Vec3.multiply for vector * vector operation"),this.x*=t,this.y*=t,this.z*=t,this},n.multiply=function(t){return"object"!=typeof t&&console.warn("should use Vec3.scale for vector * scalar operation"),this.x*=t.x,this.y*=t.y,this.z*=t.z,this},n.multiply3f=function(t,e,n){return this.x*=t,this.y*=e,this.z*=n,this},n.divide=function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},n.divide3f=function(t,e,n){return this.x/=t,this.y/=e,this.z/=n,this},n.negative=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},n.clampf=function(t,e){return this.x=Yn(this.x,t.x,e.x),this.y=Yn(this.y,t.y,e.y),this.z=Yn(this.z,t.z,e.z),this},n.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},n.cross=function(t){var e=this.x,n=this.y,i=this.z,r=t.x,a=t.y,o=t.z;return this.x=n*o-i*a,this.y=i*r-e*o,this.z=e*a-n*r,this},n.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},n.lengthSqr=function(){return this.x*this.x+this.y*this.y+this.z*this.z},n.normalize=function(){var t=this.x,e=this.y,n=this.z,i=t*t+e*e+n*n;return i>0&&(i=1/Math.sqrt(i),this.x=t*i,this.y=e*i,this.z=n*i),this},n.transformMat4=function(t){var e=this.x,n=this.y,i=this.z,r=t.m03*e+t.m07*n+t.m11*i+t.m15;return r=r?1/r:1,this.x=(t.m00*e+t.m04*n+t.m08*i+t.m12)*r,this.y=(t.m01*e+t.m05*n+t.m09*i+t.m13)*r,this.z=(t.m02*e+t.m06*n+t.m10*i+t.m14)*r,this},e}(Jt));di.UNIT_X=Object.freeze(new di(1,0,0)),di.UNIT_Y=Object.freeze(new di(0,1,0)),di.UNIT_Z=Object.freeze(new di(0,0,1)),di.RIGHT=Object.freeze(new di(1,0,0)),di.UP=Object.freeze(new di(0,1,0)),di.FORWARD=Object.freeze(new di(0,0,-1)),di.ZERO=Object.freeze(new di(0,0,0)),di.ONE=Object.freeze(new di(1,1,1)),di.NEG_ONE=Object.freeze(new di(-1,-1,-1));var mi=new di,gi=new di;function vi(t,e,n){return new di(t,e,n)}Ge.fastDefine("cc.Vec3",di,{x:0,y:0,z:0}),i.Vec3=di,i.v3=vi;var yi=t("Mat3",function(t){function e(e,n,i,r,a,o,s,c,l){var u;return void 0===e&&(e=1),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===a&&(a=1),void 0===o&&(o=0),void 0===s&&(s=0),void 0===c&&(c=0),void 0===l&&(l=1),u=t.call(this)||this,"object"==typeof e?(u.m00=e.m00,u.m01=e.m01,u.m02=e.m02,u.m03=e.m03,u.m04=e.m04,u.m05=e.m05,u.m06=e.m06,u.m07=e.m07,u.m08=e.m08):(u.m00=e,u.m01=n,u.m02=i,u.m03=r,u.m04=a,u.m05=o,u.m06=s,u.m07=c,u.m08=l),u}F(e,t),e.clone=function(t){return new e(t.m00,t.m01,t.m02,t.m03,t.m04,t.m05,t.m06,t.m07,t.m08)},e.copy=function(t,e){return t.m00=e.m00,t.m01=e.m01,t.m02=e.m02,t.m03=e.m03,t.m04=e.m04,t.m05=e.m05,t.m06=e.m06,t.m07=e.m07,t.m08=e.m08,t},e.set=function(t,e,n,i,r,a,o,s,c,l){return t.m00=e,t.m01=n,t.m02=i,t.m03=r,t.m04=a,t.m05=o,t.m06=s,t.m07=c,t.m08=l,t},e.identity=function(t){return t.m00=1,t.m01=0,t.m02=0,t.m03=0,t.m04=1,t.m05=0,t.m06=0,t.m07=0,t.m08=1,t},e.transpose=function(t,e){if(t===e){var n=e.m01,i=e.m02,r=e.m05;t.m01=e.m03,t.m02=e.m06,t.m03=n,t.m05=e.m07,t.m06=i,t.m07=r}else t.m00=e.m00,t.m01=e.m03,t.m02=e.m06,t.m03=e.m01,t.m04=e.m04,t.m05=e.m07,t.m06=e.m02,t.m07=e.m05,t.m08=e.m08;return t},e.invert=function(t,e){var n=e.m00,i=e.m01,r=e.m02,a=e.m03,o=e.m04,s=e.m05,c=e.m06,l=e.m07,u=e.m08,h=u*o-s*l,f=-u*a+s*c,_=l*a-o*c,p=n*h+i*f+r*_;return 0===p?(t.m00=0,t.m01=0,t.m02=0,t.m03=0,t.m04=0,t.m05=0,t.m06=0,t.m07=0,t.m08=0,t):(p=1/p,t.m00=h*p,t.m01=(-u*i+r*l)*p,t.m02=(s*i-r*o)*p,t.m03=f*p,t.m04=(u*n-r*c)*p,t.m05=(-s*n+r*a)*p,t.m06=_*p,t.m07=(-l*n+i*c)*p,t.m08=(o*n-i*a)*p,t)},e.determinant=function(t){var e=t.m00,n=t.m01,i=t.m02,r=t.m03,a=t.m04,o=t.m05,s=t.m06,c=t.m07,l=t.m08;return e*(l*a-o*c)+n*(-l*r+o*s)+i*(c*r-a*s)},e.multiply=function(t,e,n){var i=e.m00,r=e.m01,a=e.m02,o=e.m03,s=e.m04,c=e.m05,l=e.m06,u=e.m07,h=e.m08,f=n.m00,_=n.m01,p=n.m02,d=n.m03,m=n.m04,g=n.m05,v=n.m06,y=n.m07,x=n.m08;return t.m00=f*i+_*o+p*l,t.m01=f*r+_*s+p*u,t.m02=f*a+_*c+p*h,t.m03=d*i+m*o+g*l,t.m04=d*r+m*s+g*u,t.m05=d*a+m*c+g*h,t.m06=v*i+y*o+x*l,t.m07=v*r+y*s+x*u,t.m08=v*a+y*c+x*h,t},e.multiplyMat4=function(t,e,n){var i=e.m00,r=e.m01,a=e.m02,o=e.m03,s=e.m04,c=e.m05,l=e.m06,u=e.m07,h=e.m08,f=n.m00,_=n.m01,p=n.m02,d=n.m04,m=n.m05,g=n.m06,v=n.m08,y=n.m09,x=n.m10;return t.m00=f*i+_*o+p*l,t.m01=f*r+_*s+p*u,t.m02=f*a+_*c+p*h,t.m03=d*i+m*o+g*l,t.m04=d*r+m*s+g*u,t.m05=d*a+m*c+g*h,t.m06=v*i+y*o+x*l,t.m07=v*r+y*s+x*u,t.m08=v*a+y*c+x*h,t},e.transform=function(t,e,n){var i=e.m00,r=e.m01,a=e.m02,o=e.m03,s=e.m04,c=e.m05,l=e.m06,u=e.m07,h=e.m08,f=n.x,_=n.y;return t.m00=i,t.m01=r,t.m02=a,t.m03=o,t.m04=s,t.m05=c,t.m06=f*i+_*o+l,t.m07=f*r+_*s+u,t.m08=f*a+_*c+h,t},e.scale=function(t,e,n){var i=n.x,r=n.y;return t.m00=i*e.m00,t.m01=i*e.m01,t.m02=i*e.m02,t.m03=r*e.m03,t.m04=r*e.m04,t.m05=r*e.m05,t.m06=e.m06,t.m07=e.m07,t.m08=e.m08,t},e.rotate=function(t,e,n){var i=e.m00,r=e.m01,a=e.m02,o=e.m03,s=e.m04,c=e.m05,l=e.m06,u=e.m07,h=e.m08,f=Math.sin(n),_=Math.cos(n);return t.m00=_*i+f*o,t.m01=_*r+f*s,t.m02=_*a+f*c,t.m03=_*o-f*i,t.m04=_*s-f*r,t.m05=_*c-f*a,t.m06=l,t.m07=u,t.m08=h,t},e.fromMat4=function(t,e){return t.m00=e.m00,t.m01=e.m01,t.m02=e.m02,t.m03=e.m04,t.m04=e.m05,t.m05=e.m06,t.m06=e.m08,t.m07=e.m09,t.m08=e.m10,t},e.fromViewUp=function(t,n,i){return di.lengthSqr(n)<Wn*Wn?(e.identity(t),t):(i=i||di.UNIT_Y,di.normalize(xi,di.cross(xi,i,n)),di.lengthSqr(xi)<Wn*Wn?(e.identity(t),t):(di.cross(Si,n,xi),e.set(t,xi.x,xi.y,xi.z,Si.x,Si.y,Si.z,n.x,n.y,n.z),t))},e.fromTranslation=function(t,e){return t.m00=1,t.m01=0,t.m02=0,t.m03=0,t.m04=1,t.m05=0,t.m06=e.x,t.m07=e.y,t.m08=1,t},e.fromScaling=function(t,e){return t.m00=e.x,t.m01=0,t.m02=0,t.m03=0,t.m04=e.y,t.m05=0,t.m06=0,t.m07=0,t.m08=1,t},e.fromRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t.m00=i,t.m01=n,t.m02=0,t.m03=-n,t.m04=i,t.m05=0,t.m06=0,t.m07=0,t.m08=1,t},e.fromQuat=function(t,e){var n=e.x,i=e.y,r=e.z,a=e.w,o=n+n,s=i+i,c=r+r,l=n*o,u=i*o,h=i*s,f=r*o,_=r*s,p=r*c,d=a*o,m=a*s,g=a*c;return t.m00=1-h-p,t.m03=u-g,t.m06=f+m,t.m01=u+g,t.m04=1-l-p,t.m07=_-d,t.m02=f-m,t.m05=_+d,t.m08=1-l-h,t},e.inverseTransposeMat4=function(t,e){var n=e.m00,i=e.m01,r=e.m02,a=e.m03,o=e.m04,s=e.m05,c=e.m06,l=e.m07,u=e.m08,h=e.m09,f=e.m10,_=e.m11,p=e.m12,d=e.m13,m=e.m14,g=e.m15,v=n*s-i*o,y=n*c-r*o,x=n*l-a*o,S=i*c-r*s,T=i*l-a*s,A=r*l-a*c,E=u*d-h*p,C=u*m-f*p,b=u*g-_*p,w=h*m-f*d,P=h*g-_*d,I=f*g-_*m,R=v*I-y*P+x*w+S*b-T*C+A*E;return R?(R=1/R,t.m00=(s*I-c*P+l*w)*R,t.m01=(c*b-o*I-l*C)*R,t.m02=(o*P-s*b+l*E)*R,t.m03=(r*P-i*I-a*w)*R,t.m04=(n*I-r*b+a*C)*R,t.m05=(i*b-n*P-a*E)*R,t.m06=(d*A-m*T+g*S)*R,t.m07=(m*x-p*A-g*y)*R,t.m08=(p*T-d*x+g*v)*R,t):null},e.toArray=function(t,e,n){return void 0===n&&(n=0),t[n+0]=e.m00,t[n+1]=e.m01,t[n+2]=e.m02,t[n+3]=e.m03,t[n+4]=e.m04,t[n+5]=e.m05,t[n+6]=e.m06,t[n+7]=e.m07,t[n+8]=e.m08,t},e.fromArray=function(t,e,n){return void 0===n&&(n=0),t.m00=e[n+0],t.m01=e[n+1],t.m02=e[n+2],t.m03=e[n+3],t.m04=e[n+4],t.m05=e[n+5],t.m06=e[n+6],t.m07=e[n+7],t.m08=e[n+8],t},e.add=function(t,e,n){return t.m00=e.m00+n.m00,t.m01=e.m01+n.m01,t.m02=e.m02+n.m02,t.m03=e.m03+n.m03,t.m04=e.m04+n.m04,t.m05=e.m05+n.m05,t.m06=e.m06+n.m06,t.m07=e.m07+n.m07,t.m08=e.m08+n.m08,t},e.subtract=function(t,e,n){return t.m00=e.m00-n.m00,t.m01=e.m01-n.m01,t.m02=e.m02-n.m02,t.m03=e.m03-n.m03,t.m04=e.m04-n.m04,t.m05=e.m05-n.m05,t.m06=e.m06-n.m06,t.m07=e.m07-n.m07,t.m08=e.m08-n.m08,t},e.multiplyScalar=function(t,e,n){return t.m00=e.m00*n,t.m01=e.m01*n,t.m02=e.m02*n,t.m03=e.m03*n,t.m04=e.m04*n,t.m05=e.m05*n,t.m06=e.m06*n,t.m07=e.m07*n,t.m08=e.m08*n,t},e.multiplyScalarAndAdd=function(t,e,n,i){return t.m00=n.m00*i+e.m00,t.m01=n.m01*i+e.m01,t.m02=n.m02*i+e.m02,t.m03=n.m03*i+e.m03,t.m04=n.m04*i+e.m04,t.m05=n.m05*i+e.m05,t.m06=n.m06*i+e.m06,t.m07=n.m07*i+e.m07,t.m08=n.m08*i+e.m08,t},e.strictEquals=function(t,e){return t.m00===e.m00&&t.m01===e.m01&&t.m02===e.m02&&t.m03===e.m03&&t.m04===e.m04&&t.m05===e.m05&&t.m06===e.m06&&t.m07===e.m07&&t.m08===e.m08},e.equals=function(t,e,n){return void 0===n&&(n=Wn),Math.abs(t.m00-e.m00)<=n*Math.max(1,Math.abs(t.m00),Math.abs(e.m00))&&Math.abs(t.m01-e.m01)<=n*Math.max(1,Math.abs(t.m01),Math.abs(e.m01))&&Math.abs(t.m02-e.m02)<=n*Math.max(1,Math.abs(t.m02),Math.abs(e.m02))&&Math.abs(t.m03-e.m03)<=n*Math.max(1,Math.abs(t.m03),Math.abs(e.m03))&&Math.abs(t.m04-e.m04)<=n*Math.max(1,Math.abs(t.m04),Math.abs(e.m04))&&Math.abs(t.m05-e.m05)<=n*Math.max(1,Math.abs(t.m05),Math.abs(e.m05))&&Math.abs(t.m06-e.m06)<=n*Math.max(1,Math.abs(t.m06),Math.abs(e.m06))&&Math.abs(t.m07-e.m07)<=n*Math.max(1,Math.abs(t.m07),Math.abs(e.m07))&&Math.abs(t.m08-e.m08)<=n*Math.max(1,Math.abs(t.m08),Math.abs(e.m08))};var n=e.prototype;return n.clone=function(){var t=this;return new e(t.m00,t.m01,t.m02,t.m03,t.m04,t.m05,t.m06,t.m07,t.m08)},n.set=function(t,e,n,i,r,a,o,s,c){return void 0===t&&(t=1),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=1),void 0===a&&(a=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===c&&(c=1),"object"==typeof t?(this.m00=t.m00,this.m01=t.m01,this.m02=t.m02,this.m03=t.m03,this.m04=t.m04,this.m05=t.m05,this.m06=t.m06,this.m07=t.m07,this.m08=t.m08):(this.m00=t,this.m01=e,this.m02=n,this.m03=i,this.m04=r,this.m05=a,this.m06=o,this.m07=s,this.m08=c),this},n.equals=function(t,e){return void 0===e&&(e=Wn),Math.abs(this.m00-t.m00)<=e*Math.max(1,Math.abs(this.m00),Math.abs(t.m00))&&Math.abs(this.m01-t.m01)<=e*Math.max(1,Math.abs(this.m01),Math.abs(t.m01))&&Math.abs(this.m02-t.m02)<=e*Math.max(1,Math.abs(this.m02),Math.abs(t.m02))&&Math.abs(this.m03-t.m03)<=e*Math.max(1,Math.abs(this.m03),Math.abs(t.m03))&&Math.abs(this.m04-t.m04)<=e*Math.max(1,Math.abs(this.m04),Math.abs(t.m04))&&Math.abs(this.m05-t.m05)<=e*Math.max(1,Math.abs(this.m05),Math.abs(t.m05))&&Math.abs(this.m06-t.m06)<=e*Math.max(1,Math.abs(this.m06),Math.abs(t.m06))&&Math.abs(this.m07-t.m07)<=e*Math.max(1,Math.abs(this.m07),Math.abs(t.m07))&&Math.abs(this.m08-t.m08)<=e*Math.max(1,Math.abs(this.m08),Math.abs(t.m08))},n.strictEquals=function(t){return this.m00===t.m00&&this.m01===t.m01&&this.m02===t.m02&&this.m03===t.m03&&this.m04===t.m04&&this.m05===t.m05&&this.m06===t.m06&&this.m07===t.m07&&this.m08===t.m08},n.toString=function(){var t=this;return"[\n"+t.m00+", "+t.m01+", "+t.m02+",\n"+t.m03+",\n"+t.m04+", "+t.m05+",\n"+t.m06+", "+t.m07+",\n"+t.m08+"\n]"},n.identity=function(){return this.m00=1,this.m01=0,this.m02=0,this.m03=0,this.m04=1,this.m05=0,this.m06=0,this.m07=0,this.m08=1,this},n.transpose=function(){var t=this.m01,e=this.m02,n=this.m05;return this.m01=this.m03,this.m02=this.m06,this.m03=t,this.m05=this.m07,this.m06=e,this.m07=n,this},n.invert=function(){var t=this.m00,e=this.m01,n=this.m02,i=this.m03,r=this.m04,a=this.m05,o=this.m06,s=this.m07,c=this.m08,l=c*r-a*s,u=-c*i+a*o,h=s*i-r*o,f=t*l+e*u+n*h;return 0===f?(this.set(0,0,0,0,0,0,0,0,0),this):(f=1/f,this.m00=l*f,this.m01=(-c*e+n*s)*f,this.m02=(a*e-n*r)*f,this.m03=u*f,this.m04=(c*t-n*o)*f,this.m05=(-a*t+n*i)*f,this.m06=h*f,this.m07=(-s*t+e*o)*f,this.m08=(r*t-e*i)*f,this)},n.determinant=function(){var t=this.m00,e=this.m01,n=this.m02,i=this.m03,r=this.m04,a=this.m05,o=this.m06,s=this.m07,c=this.m08;return t*(c*r-a*s)+e*(-c*i+a*o)+n*(s*i-r*o)},n.add=function(t){return this.m00+=t.m00,this.m01+=t.m01,this.m02+=t.m02,this.m03+=t.m03,this.m04+=t.m04,this.m05+=t.m05,this.m06+=t.m06,this.m07+=t.m07,this.m08+=t.m08,this},n.subtract=function(t){return this.m00-=t.m00,this.m01-=t.m01,this.m02-=t.m02,this.m03-=t.m03,this.m04-=t.m04,this.m05-=t.m05,this.m06-=t.m06,this.m07-=t.m07,this.m08-=t.m08,this},n.multiply=function(t){var e=this.m00,n=this.m01,i=this.m02,r=this.m03,a=this.m04,o=this.m05,s=this.m06,c=this.m07,l=this.m08,u=t.m00,h=t.m01,f=t.m02,_=t.m03,p=t.m04,d=t.m05,m=t.m06,g=t.m07,v=t.m08;return this.m00=u*e+h*r+f*s,this.m01=u*n+h*a+f*c,this.m02=u*i+h*o+f*l,this.m03=_*e+p*r+d*s,this.m04=_*n+p*a+d*c,this.m05=_*i+p*o+d*l,this.m06=m*e+g*r+v*s,this.m07=m*n+g*a+v*c,this.m08=m*i+g*o+v*l,this},n.multiplyScalar=function(t){return this.m00*=t,this.m01*=t,this.m02*=t,this.m03*=t,this.m04*=t,this.m05*=t,this.m06*=t,this.m07*=t,this.m08*=t,this},n.scale=function(t){var e=t.x,n=t.y;return this.m00=e*this.m00,this.m01=e*this.m01,this.m02=e*this.m02,this.m03=n*this.m03,this.m04=n*this.m04,this.m05=n*this.m05,this.m06=this.m06,this.m07=this.m07,this.m08=this.m08,this},n.rotate=function(t){var e=this.m00,n=this.m01,i=this.m02,r=this.m03,a=this.m04,o=this.m05,s=this.m06,c=this.m07,l=this.m08,u=Math.sin(t),h=Math.cos(t);return this.m00=h*e+u*r,this.m01=h*n+u*a,this.m02=h*i+u*o,this.m03=h*r-u*e,this.m04=h*a-u*n,this.m05=h*o-u*i,this.m06=s,this.m07=c,this.m08=l,this},n.fromQuat=function(t){var e=t.x,n=t.y,i=t.z,r=t.w,a=e+e,o=n+n,s=i+i,c=e*a,l=n*a,u=n*o,h=i*a,f=i*o,_=i*s,p=r*a,d=r*o,m=r*s;return this.m00=1-u-_,this.m03=l-m,this.m06=h+d,this.m01=l+m,this.m04=1-c-_,this.m07=f-p,this.m02=h-d,this.m05=f+p,this.m08=1-c-u,this},e}(Jt));yi.IDENTITY=Object.freeze(new yi);var xi=new di,Si=new di;Ge.fastDefine("cc.Mat3",yi,{m00:1,m01:0,m02:0,m03:0,m04:1,m05:0,m06:0,m07:0,m08:1}),i.Mat3=yi;var Ti=t("Quat",function(t){function e(e,n,i,r){var a;return a=t.call(this)||this,e&&"object"==typeof e?(a.x=e.x,a.y=e.y,a.z=e.z,a.w=e.w):(a.x=e||0,a.y=n||0,a.z=i||0,a.w=null!=r?r:1),a}F(e,t),e.clone=function(t){return new e(t.x,t.y,t.z,t.w)},e.copy=function(t,e){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t},e.set=function(t,e,n,i,r){return t.x=e,t.y=n,t.z=i,t.w=r,t},e.identity=function(t){return t.x=0,t.y=0,t.z=0,t.w=1,t},e.rotationTo=function(t,n,i){var r=di.dot(n,i);return r<-.999999?(di.cross(Ci,di.UNIT_X,n),Ci.length()<1e-6&&di.cross(Ci,di.UNIT_Y,n),di.normalize(Ci,Ci),e.fromAxisAngle(t,Ci,Math.PI),t):r>.999999?(t.x=0,t.y=0,t.z=0,t.w=1,t):(di.cross(Ci,n,i),t.x=Ci.x,t.y=Ci.y,t.z=Ci.z,t.w=1+r,e.normalize(t,t))},e.getAxisAngle=function(t,e){var n=2*Math.acos(e.w),i=Math.sin(n/2);return 0!==i?(t.x=e.x/i,t.y=e.y/i,t.z=e.z/i):(t.x=1,t.y=0,t.z=0),n},e.multiply=function(t,e,n){var i=e.x*n.w+e.w*n.x+e.y*n.z-e.z*n.y,r=e.y*n.w+e.w*n.y+e.z*n.x-e.x*n.z,a=e.z*n.w+e.w*n.z+e.x*n.y-e.y*n.x,o=e.w*n.w-e.x*n.x-e.y*n.y-e.z*n.z;return t.x=i,t.y=r,t.z=a,t.w=o,t},e.multiplyScalar=function(t,e,n){return t.x=e.x*n,t.y=e.y*n,t.z=e.z*n,t.w=e.w*n,t},e.scaleAndAdd=function(t,e,n,i){return t.x=e.x+n.x*i,t.y=e.y+n.y*i,t.z=e.z+n.z*i,t.w=e.w+n.w*i,t},e.rotateX=function(t,e,n){n*=.5;var i=Math.sin(n),r=Math.cos(n),a=e.x,o=e.y,s=e.z,c=e.w;return t.x=a*r+c*i,t.y=o*r+s*i,t.z=s*r-o*i,t.w=c*r-a*i,t},e.rotateY=function(t,e,n){n*=.5;var i=Math.sin(n),r=Math.cos(n),a=e.x,o=e.y,s=e.z,c=e.w;return t.x=a*r-s*i,t.y=o*r+c*i,t.z=s*r+a*i,t.w=c*r-o*i,t},e.rotateZ=function(t,e,n){n*=.5;var i=Math.sin(n),r=Math.cos(n),a=e.x,o=e.y,s=e.z,c=e.w;return t.x=a*r+o*i,t.y=o*r-a*i,t.z=s*r+c*i,t.w=c*r-s*i,t},e.rotateAround=function(t,n,i,r){return e.invert(Ai,n),di.transformQuat(Ci,i,Ai),e.fromAxisAngle(Ai,Ci,r),e.multiply(t,n,Ai),t},e.rotateAroundLocal=function(t,n,i,r){return e.fromAxisAngle(Ai,i,r),e.multiply(t,n,Ai),t},e.calculateW=function(t,e){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=Math.sqrt(Math.abs(1-e.x*e.x-e.y*e.y-e.z*e.z)),t},e.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z+t.w*e.w},e.lerp=function(t,e,n,i){return t.x=e.x+i*(n.x-e.x),t.y=e.y+i*(n.y-e.y),t.z=e.z+i*(n.z-e.z),t.w=e.w+i*(n.w-e.w),t},e.slerp=function(t,e,n,i){var r=0,a=0,o=n.x,s=n.y,c=n.z,l=n.w,u=e.x*n.x+e.y*n.y+e.z*n.z+e.w*n.w;if(u<0&&(u=-u,o=-o,s=-s,c=-c,l=-l),1-u>1e-6){var h=Math.acos(u),f=Math.sin(h);r=Math.sin((1-i)*h)/f,a=Math.sin(i*h)/f}else r=1-i,a=i;return t.x=r*e.x+a*o,t.y=r*e.y+a*s,t.z=r*e.z+a*c,t.w=r*e.w+a*l,t},e.sqlerp=function(t,n,i,r,a,o){return e.slerp(Ai,n,a,o),e.slerp(Ei,i,r,o),e.slerp(t,Ai,Ei,2*o*(1-o)),t},e.invert=function(t,e){var n=e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w,i=n?1/n:0;return t.x=-e.x*i,t.y=-e.y*i,t.z=-e.z*i,t.w=e.w*i,t},e.conjugate=function(t,e){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t.w=e.w,t},e.len=function(t){return Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z+t.w*t.w)},e.lengthSqr=function(t){return t.x*t.x+t.y*t.y+t.z*t.z+t.w*t.w},e.normalize=function(t,e){var n=e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w;return n>0&&(n=1/Math.sqrt(n),t.x=e.x*n,t.y=e.y*n,t.z=e.z*n,t.w=e.w*n),t},e.fromAxes=function(t,n,i,r){return yi.set(bi,n.x,n.y,n.z,i.x,i.y,i.z,r.x,r.y,r.z),e.normalize(t,e.fromMat3(t,bi))},e.fromViewUp=function(t,n,i){return yi.fromViewUp(bi,n,i),e.normalize(t,e.fromMat3(t,bi))},e.fromAxisAngle=function(t,e,n){n*=.5;var i=Math.sin(n);return t.x=i*e.x,t.y=i*e.y,t.z=i*e.z,t.w=Math.cos(n),t},e.fromMat3=function(t,e){var n=e.m00,i=e.m03,r=e.m06,a=e.m01,o=e.m04,s=e.m07,c=e.m02,l=e.m05,u=e.m08,h=n+o+u;if(h>0){var f=.5/Math.sqrt(h+1);t.w=.25/f,t.x=(l-s)*f,t.y=(r-c)*f,t.z=(a-i)*f}else if(n>o&&n>u){var _=2*Math.sqrt(1+n-o-u);t.w=(l-s)/_,t.x=.25*_,t.y=(i+a)/_,t.z=(r+c)/_}else if(o>u){var p=2*Math.sqrt(1+o-n-u);t.w=(r-c)/p,t.x=(i+a)/p,t.y=.25*p,t.z=(s+l)/p}else{var d=2*Math.sqrt(1+u-n-o);t.w=(a-i)/d,t.x=(r+c)/d,t.y=(s+l)/d,t.z=.25*d}return t},e.fromEuler=function(t,e,n,i){e*=wi,n*=wi,i*=wi;var r=Math.sin(e),a=Math.cos(e),o=Math.sin(n),s=Math.cos(n),c=Math.sin(i),l=Math.cos(i);return t.x=r*s*l+a*o*c,t.y=a*o*l+r*s*c,t.z=a*s*c-r*o*l,t.w=a*s*l-r*o*c,t},e.fromAngleZ=function(t,e){return e*=wi,t.x=t.y=0,t.z=Math.sin(e),t.w=Math.cos(e),t},e.toAxisX=function(t,e){var n=2*e.y,i=2*e.z;return t.x=1-n*e.y-i*e.z,t.y=n*e.x+i*e.w,t.z=i*e.x+n*e.w,t},e.toAxisY=function(t,e){var n=2*e.x,i=2*e.y,r=2*e.z;return t.x=i*e.x-r*e.w,t.y=1-n*e.x-r*e.z,t.z=r*e.y+n*e.w,t},e.toAxisZ=function(t,e){var n=2*e.x,i=2*e.y,r=2*e.z;return t.x=r*e.x-i*e.w,t.y=r*e.y-n*e.w,t.z=1-n*e.x-i*e.y,t},e.toEuler=function(t,e,n){var i=e.x,r=e.y,a=e.z,o=e.w,s=0,c=0,l=0,u=i*r+a*o;if(u>.499999)s=0,c=Jn(2*Math.atan2(i,o)),l=90;else if(u<-.499999)s=0,c=-Jn(2*Math.atan2(i,o)),l=-90;else{var h=i*i,f=r*r,_=a*a;s=Jn(Math.atan2(2*i*o-2*r*a,1-2*h-2*_)),c=Jn(Math.atan2(2*r*o-2*i*a,1-2*f-2*_)),l=Jn(Math.asin(2*u)),n&&(s=-180*Math.sign(s+1e-6)+s,c=-180*Math.sign(c+1e-6)+c,l=180*Math.sign(l+1e-6)-l)}return t.x=s,t.y=c,t.z=l,t},e.toArray=function(t,e,n){return void 0===n&&(n=0),t[n+0]=e.x,t[n+1]=e.y,t[n+2]=e.z,t[n+3]=e.w,t},e.fromArray=function(t,e,n){return void 0===n&&(n=0),t.x=e[n+0],t.y=e[n+1],t.z=e[n+2],t.w=e[n+3],t},e.strictEquals=function(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z&&t.w===e.w},e.equals=function(t,e,n){return void 0===n&&(n=Wn),Math.abs(t.x-e.x)<=n*Math.max(1,Math.abs(t.x),Math.abs(e.x))&&Math.abs(t.y-e.y)<=n*Math.max(1,Math.abs(t.y),Math.abs(e.y))&&Math.abs(t.z-e.z)<=n*Math.max(1,Math.abs(t.z),Math.abs(e.z))&&Math.abs(t.w-e.w)<=n*Math.max(1,Math.abs(t.w),Math.abs(e.w))};var n=e.prototype;return n.clone=function(){return new e(this.x,this.y,this.z,this.w)},n.set=function(t,e,n,i){return t&&"object"==typeof t?(this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w):(this.x=t||0,this.y=e||0,this.z=n||0,this.w=null!=i?i:1),this},n.equals=function(t,e){return void 0===e&&(e=Wn),Math.abs(this.x-t.x)<=e*Math.max(1,Math.abs(this.x),Math.abs(t.x))&&Math.abs(this.y-t.y)<=e*Math.max(1,Math.abs(this.y),Math.abs(t.y))&&Math.abs(this.z-t.z)<=e*Math.max(1,Math.abs(this.z),Math.abs(t.z))&&Math.abs(this.w-t.w)<=e*Math.max(1,Math.abs(this.w),Math.abs(t.w))},n.strictEquals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},n.getEulerAngles=function(t){return e.toEuler(t,this)},n.lerp=function(t,e){return this.x+=e*(t.x-this.x),this.y+=e*(t.y-this.y),this.z+=e*(t.z-this.z),this.w+=e*(t.w-this.w),this},n.slerp=function(t,n){return e.slerp(this,this,t,n)},n.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},n.lengthSqr=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},e}(Jt));Ti.IDENTITY=Object.freeze(new Ti);var Ai=new Ti,Ei=new Ti,Ci=new di,bi=new yi,wi=.5*Math.PI/180;function Pi(t,e,n,i){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=1),new Ti(t,e,n,i)}Ge.fastDefine("cc.Quat",Ti,{x:0,y:0,z:0,w:1}),i.Quat=Ti,i.quat=Pi;var Ii=Object.freeze([Object.freeze([1,0,0,1]),Object.freeze([0,1,-1,0]),Object.freeze([-1,0,0,-1]),Object.freeze([0,-1,1,0])]),Ri=t("Mat4",function(t){function e(e,n,i,r,a,o,s,c,l,u,h,f,_,p,d,m){var g;return void 0===e&&(e=1),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===a&&(a=0),void 0===o&&(o=1),void 0===s&&(s=0),void 0===c&&(c=0),void 0===l&&(l=0),void 0===u&&(u=0),void 0===h&&(h=1),void 0===f&&(f=0),void 0===_&&(_=0),void 0===p&&(p=0),void 0===d&&(d=0),void 0===m&&(m=1),(g=t.call(this)||this).m00=void 0,g.m01=void 0,g.m02=void 0,g.m03=void 0,g.m04=void 0,g.m05=void 0,g.m06=void 0,g.m07=void 0,g.m08=void 0,g.m09=void 0,g.m10=void 0,g.m11=void 0,g.m12=void 0,g.m13=void 0,g.m14=void 0,g.m15=void 0,"object"==typeof e?(g.m00=e.m00,g.m01=e.m01,g.m02=e.m02,g.m03=e.m03,g.m04=e.m04,g.m05=e.m05,g.m06=e.m06,g.m07=e.m07,g.m08=e.m08,g.m09=e.m09,g.m10=e.m10,g.m11=e.m11,g.m12=e.m12,g.m13=e.m13,g.m14=e.m14,g.m15=e.m15):(g.m00=e,g.m01=n,g.m02=i,g.m03=r,g.m04=a,g.m05=o,g.m06=s,g.m07=c,g.m08=l,g.m09=u,g.m10=h,g.m11=f,g.m12=_,g.m13=p,g.m14=d,g.m15=m),g}F(e,t),e.clone=function(t){return new e(t.m00,t.m01,t.m02,t.m03,t.m04,t.m05,t.m06,t.m07,t.m08,t.m09,t.m10,t.m11,t.m12,t.m13,t.m14,t.m15)},e.copy=function(t,e){return t.m00=e.m00,t.m01=e.m01,t.m02=e.m02,t.m03=e.m03,t.m04=e.m04,t.m05=e.m05,t.m06=e.m06,t.m07=e.m07,t.m08=e.m08,t.m09=e.m09,t.m10=e.m10,t.m11=e.m11,t.m12=e.m12,t.m13=e.m13,t.m14=e.m14,t.m15=e.m15,t},e.set=function(t,e,n,i,r,a,o,s,c,l,u,h,f,_,p,d,m){return t.m00=e,t.m01=n,t.m02=i,t.m03=r,t.m04=a,t.m05=o,t.m06=s,t.m07=c,t.m08=l,t.m09=u,t.m10=h,t.m11=f,t.m12=_,t.m13=p,t.m14=d,t.m15=m,t},e.identity=function(t){return t.m00=1,t.m01=0,t.m02=0,t.m03=0,t.m04=0,t.m05=1,t.m06=0,t.m07=0,t.m08=0,t.m09=0,t.m10=1,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t},e.transpose=function(t,e){if(t===e){var n=e.m01,i=e.m02,r=e.m03,a=e.m06,o=e.m07,s=e.m11;t.m01=e.m04,t.m02=e.m08,t.m03=e.m12,t.m04=n,t.m06=e.m09,t.m07=e.m13,t.m08=i,t.m09=a,t.m11=e.m14,t.m12=r,t.m13=o,t.m14=s}else t.m00=e.m00,t.m01=e.m04,t.m02=e.m08,t.m03=e.m12,t.m04=e.m01,t.m05=e.m05,t.m06=e.m09,t.m07=e.m13,t.m08=e.m02,t.m09=e.m06,t.m10=e.m10,t.m11=e.m14,t.m12=e.m03,t.m13=e.m07,t.m14=e.m11,t.m15=e.m15;return t},e.invert=function(t,e){var n=e.m00,i=e.m01,r=e.m02,a=e.m03,o=e.m04,s=e.m05,c=e.m06,l=e.m07,u=e.m08,h=e.m09,f=e.m10,_=e.m11,p=e.m12,d=e.m13,m=e.m14,g=e.m15,v=n*s-i*o,y=n*c-r*o,x=n*l-a*o,S=i*c-r*s,T=i*l-a*s,A=r*l-a*c,E=u*d-h*p,C=u*m-f*p,b=u*g-_*p,w=h*m-f*d,P=h*g-_*d,I=f*g-_*m,R=v*I-y*P+x*w+S*b-T*C+A*E;return 0===R?(t.m00=0,t.m01=0,t.m02=0,t.m03=0,t.m04=0,t.m05=0,t.m06=0,t.m07=0,t.m08=0,t.m09=0,t.m10=0,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=0,t):(R=1/R,t.m00=(s*I-c*P+l*w)*R,t.m01=(r*P-i*I-a*w)*R,t.m02=(d*A-m*T+g*S)*R,t.m03=(f*T-h*A-_*S)*R,t.m04=(c*b-o*I-l*C)*R,t.m05=(n*I-r*b+a*C)*R,t.m06=(m*x-p*A-g*y)*R,t.m07=(u*A-f*x+_*y)*R,t.m08=(o*P-s*b+l*E)*R,t.m09=(i*b-n*P-a*E)*R,t.m10=(p*T-d*x+g*v)*R,t.m11=(h*x-u*T-_*v)*R,t.m12=(s*C-o*w-c*E)*R,t.m13=(n*w-i*C+r*E)*R,t.m14=(d*y-p*S-m*v)*R,t.m15=(u*S-h*y+f*v)*R,t)},e.determinant=function(t){var e=t.m00,n=t.m01,i=t.m02,r=t.m03,a=t.m04,o=t.m05,s=t.m06,c=t.m07,l=t.m08,u=t.m09,h=t.m10,f=t.m11,_=t.m12,p=t.m13,d=t.m14,m=t.m15;return(e*o-n*a)*(h*m-f*d)-(e*s-i*a)*(u*m-f*p)+(e*c-r*a)*(u*d-h*p)+(n*s-i*o)*(l*m-f*_)-(n*c-r*o)*(l*d-h*_)+(i*c-r*s)*(l*p-u*_)},e.multiply=function(t,e,n){var i=e.m00,r=e.m01,a=e.m02,o=e.m03,s=e.m04,c=e.m05,l=e.m06,u=e.m07,h=e.m08,f=e.m09,_=e.m10,p=e.m11,d=e.m12,m=e.m13,g=e.m14,v=e.m15,y=n.m00,x=n.m01,S=n.m02,T=n.m03;return t.m00=y*i+x*s+S*h+T*d,t.m01=y*r+x*c+S*f+T*m,t.m02=y*a+x*l+S*_+T*g,t.m03=y*o+x*u+S*p+T*v,y=n.m04,x=n.m05,S=n.m06,T=n.m07,t.m04=y*i+x*s+S*h+T*d,t.m05=y*r+x*c+S*f+T*m,t.m06=y*a+x*l+S*_+T*g,t.m07=y*o+x*u+S*p+T*v,y=n.m08,x=n.m09,S=n.m10,T=n.m11,t.m08=y*i+x*s+S*h+T*d,t.m09=y*r+x*c+S*f+T*m,t.m10=y*a+x*l+S*_+T*g,t.m11=y*o+x*u+S*p+T*v,y=n.m12,x=n.m13,S=n.m14,T=n.m15,t.m12=y*i+x*s+S*h+T*d,t.m13=y*r+x*c+S*f+T*m,t.m14=y*a+x*l+S*_+T*g,t.m15=y*o+x*u+S*p+T*v,t},e.transform=function(t,e,n){var i=n.x,r=n.y,a=n.z;if(e===t)t.m12=e.m00*i+e.m04*r+e.m08*a+e.m12,t.m13=e.m01*i+e.m05*r+e.m09*a+e.m13,t.m14=e.m02*i+e.m06*r+e.m10*a+e.m14,t.m15=e.m03*i+e.m07*r+e.m11*a+e.m15;else{var o=e.m00,s=e.m01,c=e.m02,l=e.m03,u=e.m04,h=e.m05,f=e.m06,_=e.m07,p=e.m08,d=e.m09,m=e.m10,g=e.m11;e.m12,e.m13,e.m14,e.m15,t.m00=o,t.m01=s,t.m02=c,t.m03=l,t.m04=u,t.m05=h,t.m06=f,t.m07=_,t.m08=p,t.m09=d,t.m10=m,t.m11=g,t.m12=o*i+u*r+p*a+e.m12,t.m13=s*i+h*r+d*a+e.m13,t.m14=c*i+f*r+m*a+e.m14,t.m15=l*i+_*r+g*a+e.m15}return t},e.translate=function(t,e,n){return console.warn("function changed"),e===t?(t.m12+=n.x,t.m13+=n.y,t.m14+=n.z):(t.m00=e.m00,t.m01=e.m01,t.m02=e.m02,t.m03=e.m03,t.m04=e.m04,t.m05=e.m05,t.m06=e.m06,t.m07=e.m07,t.m08=e.m08,t.m09=e.m09,t.m10=e.m10,t.m11=e.m11,t.m12+=n.x,t.m13+=n.y,t.m14+=n.z,t.m15=e.m15),t},e.scale=function(t,e,n){var i=n.x,r=n.y,a=n.z;return t.m00=e.m00*i,t.m01=e.m01*i,t.m02=e.m02*i,t.m03=e.m03*i,t.m04=e.m04*r,t.m05=e.m05*r,t.m06=e.m06*r,t.m07=e.m07*r,t.m08=e.m08*a,t.m09=e.m09*a,t.m10=e.m10*a,t.m11=e.m11*a,t.m12=e.m12,t.m13=e.m13,t.m14=e.m14,t.m15=e.m15,t},e.rotate=function(t,e,n,i){var r=i.x,a=i.y,o=i.z,s=Math.sqrt(r*r+a*a+o*o);if(Math.abs(s)<Wn)return null;r*=s=1/s,a*=s,o*=s;var c=Math.sin(n),l=Math.cos(n),u=1-l,h=e.m00,f=e.m01,_=e.m02,p=e.m03,d=e.m04,m=e.m05,g=e.m06,v=e.m07,y=e.m08,x=e.m09,S=e.m10,T=e.m11,A=r*r*u+l,E=a*r*u+o*c,C=o*r*u-a*c,b=r*a*u-o*c,w=a*a*u+l,P=o*a*u+r*c,I=r*o*u+a*c,R=a*o*u-r*c,D=o*o*u+l;return t.m00=h*A+d*E+y*C,t.m01=f*A+m*E+x*C,t.m02=_*A+g*E+S*C,t.m03=p*A+v*E+T*C,t.m04=h*b+d*w+y*P,t.m05=f*b+m*w+x*P,t.m06=_*b+g*w+S*P,t.m07=p*b+v*w+T*P,t.m08=h*I+d*R+y*D,t.m09=f*I+m*R+x*D,t.m10=_*I+g*R+S*D,t.m11=p*I+v*R+T*D,e!==t&&(t.m12=e.m12,t.m13=e.m13,t.m14=e.m14,t.m15=e.m15),t},e.rotateX=function(t,e,n){var i=Math.sin(n),r=Math.cos(n),a=e.m04,o=e.m05,s=e.m06,c=e.m07,l=e.m08,u=e.m09,h=e.m10,f=e.m11;return e!==t&&(t.m00=e.m00,t.m01=e.m01,t.m02=e.m02,t.m03=e.m03,t.m12=e.m12,t.m13=e.m13,t.m14=e.m14,t.m15=e.m15),t.m04=a*r+l*i,t.m05=o*r+u*i,t.m06=s*r+h*i,t.m07=c*r+f*i,t.m08=l*r-a*i,t.m09=u*r-o*i,t.m10=h*r-s*i,t.m11=f*r-c*i,t},e.rotateY=function(t,e,n){var i=Math.sin(n),r=Math.cos(n),a=e.m00,o=e.m01,s=e.m02,c=e.m03,l=e.m08,u=e.m09,h=e.m10,f=e.m11;return e!==t&&(t.m04=e.m04,t.m05=e.m05,t.m06=e.m06,t.m07=e.m07,t.m12=e.m12,t.m13=e.m13,t.m14=e.m14,t.m15=e.m15),t.m00=a*r-l*i,t.m01=o*r-u*i,t.m02=s*r-h*i,t.m03=c*r-f*i,t.m08=a*i+l*r,t.m09=o*i+u*r,t.m10=s*i+h*r,t.m11=c*i+f*r,t},e.rotateZ=function(t,e,n){var i=Math.sin(n),r=Math.cos(n),a=e.m00,o=e.m01,s=e.m02,c=e.m03,l=e.m04,u=e.m05,h=e.m06,f=e.m07;return e!==t&&(t.m08=e.m08,t.m09=e.m09,t.m10=e.m10,t.m11=e.m11,t.m12=e.m12,t.m13=e.m13,t.m14=e.m14,t.m15=e.m15),t.m00=a*r+l*i,t.m01=o*r+u*i,t.m02=s*r+h*i,t.m03=c*r+f*i,t.m04=l*r-a*i,t.m05=u*r-o*i,t.m06=h*r-s*i,t.m07=f*r-c*i,t},e.fromTranslation=function(t,e){return t.m00=1,t.m01=0,t.m02=0,t.m03=0,t.m04=0,t.m05=1,t.m06=0,t.m07=0,t.m08=0,t.m09=0,t.m10=1,t.m11=0,t.m12=e.x,t.m13=e.y,t.m14=e.z,t.m15=1,t},e.fromScaling=function(t,e){return t.m00=e.x,t.m01=0,t.m02=0,t.m03=0,t.m04=0,t.m05=e.y,t.m06=0,t.m07=0,t.m08=0,t.m09=0,t.m10=e.z,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t},e.fromRotation=function(t,e,n){var i=n.x,r=n.y,a=n.z,o=Math.sqrt(i*i+r*r+a*a);if(Math.abs(o)<Wn)return null;i*=o=1/o,r*=o,a*=o;var s=Math.sin(e),c=Math.cos(e),l=1-c;return t.m00=i*i*l+c,t.m01=r*i*l+a*s,t.m02=a*i*l-r*s,t.m03=0,t.m04=i*r*l-a*s,t.m05=r*r*l+c,t.m06=a*r*l+i*s,t.m07=0,t.m08=i*a*l+r*s,t.m09=r*a*l-i*s,t.m10=a*a*l+c,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t},e.fromXRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t.m00=1,t.m01=0,t.m02=0,t.m03=0,t.m04=0,t.m05=i,t.m06=n,t.m07=0,t.m08=0,t.m09=-n,t.m10=i,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t},e.fromYRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t.m00=i,t.m01=0,t.m02=-n,t.m03=0,t.m04=0,t.m05=1,t.m06=0,t.m07=0,t.m08=n,t.m09=0,t.m10=i,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t},e.fromZRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t.m00=i,t.m01=n,t.m02=0,t.m03=0,t.m04=-n,t.m05=i,t.m06=0,t.m07=0,t.m08=0,t.m09=0,t.m10=1,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t},e.fromRT=function(t,e,n){var i=e.x,r=e.y,a=e.z,o=e.w,s=i+i,c=r+r,l=a+a,u=i*s,h=i*c,f=i*l,_=r*c,p=r*l,d=a*l,m=o*s,g=o*c,v=o*l;return t.m00=1-(_+d),t.m01=h+v,t.m02=f-g,t.m03=0,t.m04=h-v,t.m05=1-(u+d),t.m06=p+m,t.m07=0,t.m08=f+g,t.m09=p-m,t.m10=1-(u+_),t.m11=0,t.m12=n.x,t.m13=n.y,t.m14=n.z,t.m15=1,t},e.getTranslation=function(t,e){return t.x=e.m12,t.y=e.m13,t.z=e.m14,t},e.getScaling=function(t,e){var n=Oi.m00=e.m00,i=Oi.m01=e.m01,r=Oi.m02=e.m02,a=Oi.m03=e.m04,o=Oi.m04=e.m05,s=Oi.m05=e.m06,c=Oi.m06=e.m08,l=Oi.m07=e.m09,u=Oi.m08=e.m10;return t.x=Math.sqrt(n*n+i*i+r*r),t.y=Math.sqrt(a*a+o*o+s*s),t.z=Math.sqrt(c*c+l*l+u*u),yi.determinant(Oi)<0&&(t.x*=-1),t},e.getRotation=function(t,e){var n=e.m00+e.m05+e.m10,i=0;return n>0?(i=2*Math.sqrt(n+1),t.w=.25*i,t.x=(e.m06-e.m09)/i,t.y=(e.m08-e.m02)/i,t.z=(e.m01-e.m04)/i):e.m00>e.m05&&e.m00>e.m10?(i=2*Math.sqrt(1+e.m00-e.m05-e.m10),t.w=(e.m06-e.m09)/i,t.x=.25*i,t.y=(e.m01+e.m04)/i,t.z=(e.m08+e.m02)/i):e.m05>e.m10?(i=2*Math.sqrt(1+e.m05-e.m00-e.m10),t.w=(e.m08-e.m02)/i,t.x=(e.m01+e.m04)/i,t.y=.25*i,t.z=(e.m06+e.m09)/i):(i=2*Math.sqrt(1+e.m10-e.m00-e.m05),t.w=(e.m01-e.m04)/i,t.x=(e.m08+e.m02)/i,t.y=(e.m06+e.m09)/i,t.z=.25*i),t},e.toRTS=function(t,e,n,i){i.x=di.set(Di,t.m00,t.m01,t.m02).length(),Oi.m00=t.m00/i.x,Oi.m01=t.m01/i.x,Oi.m02=t.m02/i.x,i.y=di.set(Di,t.m04,t.m05,t.m06).length(),Oi.m03=t.m04/i.y,Oi.m04=t.m05/i.y,Oi.m05=t.m06/i.y,i.z=di.set(Di,t.m08,t.m09,t.m10).length(),Oi.m06=t.m08/i.z,Oi.m07=t.m09/i.z,Oi.m08=t.m10/i.z,yi.determinant(Oi)<0&&(i.x*=-1,Oi.m00*=-1,Oi.m01*=-1,Oi.m02*=-1),Ti.fromMat3(e,Oi),di.set(n,t.m12,t.m13,t.m14)},e.fromRTS=function(t,e,n,i){var r=e.x,a=e.y,o=e.z,s=e.w,c=r+r,l=a+a,u=o+o,h=r*c,f=r*l,_=r*u,p=a*l,d=a*u,m=o*u,g=s*c,v=s*l,y=s*u,x=i.x,S=i.y,T=i.z;return t.m00=(1-(p+m))*x,t.m01=(f+y)*x,t.m02=(_-v)*x,t.m03=0,t.m04=(f-y)*S,t.m05=(1-(h+m))*S,t.m06=(d+g)*S,t.m07=0,t.m08=(_+v)*T,t.m09=(d-g)*T,t.m10=(1-(h+p))*T,t.m11=0,t.m12=n.x,t.m13=n.y,t.m14=n.z,t.m15=1,t},e.fromRTSOrigin=function(t,e,n,i,r){var a=e.x,o=e.y,s=e.z,c=e.w,l=a+a,u=o+o,h=s+s,f=a*l,_=a*u,p=a*h,d=o*u,m=o*h,g=s*h,v=c*l,y=c*u,x=c*h,S=i.x,T=i.y,A=i.z,E=r.x,C=r.y,b=r.z;return t.m00=(1-(d+g))*S,t.m01=(_+x)*S,t.m02=(p-y)*S,t.m03=0,t.m04=(_-x)*T,t.m05=(1-(f+g))*T,t.m06=(m+v)*T,t.m07=0,t.m08=(p+y)*A,t.m09=(m-v)*A,t.m10=(1-(f+d))*A,t.m11=0,t.m12=n.x+E-(t.m00*E+t.m04*C+t.m08*b),t.m13=n.y+C-(t.m01*E+t.m05*C+t.m09*b),t.m14=n.z+b-(t.m02*E+t.m06*C+t.m10*b),t.m15=1,t},e.fromQuat=function(t,e){var n=e.x,i=e.y,r=e.z,a=e.w,o=n+n,s=i+i,c=r+r,l=n*o,u=i*o,h=i*s,f=r*o,_=r*s,p=r*c,d=a*o,m=a*s,g=a*c;return t.m00=1-h-p,t.m01=u+g,t.m02=f-m,t.m03=0,t.m04=u-g,t.m05=1-l-p,t.m06=_+d,t.m07=0,t.m08=f+m,t.m09=_-d,t.m10=1-l-h,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t},e.frustum=function(t,e,n,i,r,a,o){var s=1/(n-e),c=1/(r-i),l=1/(a-o);return t.m00=2*a*s,t.m01=0,t.m02=0,t.m03=0,t.m04=0,t.m05=2*a*c,t.m06=0,t.m07=0,t.m08=(n+e)*s,t.m09=(r+i)*c,t.m10=(o+a)*l,t.m11=-1,t.m12=0,t.m13=0,t.m14=o*a*2*l,t.m15=0,t},e.perspective=function(t,e,n,i,r,a,o,s,c){void 0===a&&(a=!0),void 0===o&&(o=-1),void 0===s&&(s=1),void 0===c&&(c=0);var l=1/Math.tan(e/2),u=1/(i-r),h=a?l/n:l,f=(a?l:l*n)*s,_=Ii[c];return t.m00=h*_[0],t.m01=h*_[1],t.m02=0,t.m03=0,t.m04=f*_[2],t.m05=f*_[3],t.m06=0,t.m07=0,t.m08=0,t.m09=0,t.m10=(r-o*i)*u,t.m11=-1,t.m12=0,t.m13=0,t.m14=r*i*u*(1-o),t.m15=0,t},e.ortho=function(t,e,n,i,r,a,o,s,c,l){void 0===s&&(s=-1),void 0===c&&(c=1),void 0===l&&(l=0);var u=1/(e-n),h=1/(i-r)*c,f=1/(a-o),_=-2*u,p=-2*h,d=(e+n)*u,m=(r+i)*h,g=Ii[l];return t.m00=_*g[0],t.m01=_*g[1],t.m02=0,t.m03=0,t.m04=p*g[2],t.m05=p*g[3],t.m06=0,t.m07=0,t.m08=0,t.m09=0,t.m10=f*(1-s),t.m11=0,t.m12=d*g[0]+m*g[2],t.m13=d*g[1]+m*g[3],t.m14=(a-s*o)*f,t.m15=1,t},e.lookAt=function(t,e,n,i){var r=e.x,a=e.y,o=e.z,s=i.x,c=i.y,l=i.z,u=r-n.x,h=a-n.y,f=o-n.z,_=1/Math.sqrt(u*u+h*h+f*f),p=c*(f*=_)-l*(h*=_),d=l*(u*=_)-s*f,m=s*h-c*u,g=h*(m*=_=1/Math.sqrt(p*p+d*d+m*m))-f*(d*=_),v=f*(p*=_)-u*m,y=u*d-h*p;return t.m00=p,t.m01=g,t.m02=u,t.m03=0,t.m04=d,t.m05=v,t.m06=h,t.m07=0,t.m08=m,t.m09=y,t.m10=f,t.m11=0,t.m12=-(p*r+d*a+m*o),t.m13=-(g*r+v*a+y*o),t.m14=-(u*r+h*a+f*o),t.m15=1,t},e.inverseTranspose=function(t,e){var n=e.m00,i=e.m01,r=e.m02,a=e.m03,o=e.m04,s=e.m05,c=e.m06,l=e.m07,u=e.m08,h=e.m09,f=e.m10,_=e.m11,p=e.m12,d=e.m13,m=e.m14,g=e.m15,v=n*s-i*o,y=n*c-r*o,x=n*l-a*o,S=i*c-r*s,T=i*l-a*s,A=r*l-a*c,E=u*d-h*p,C=u*m-f*p,b=u*g-_*p,w=h*m-f*d,P=h*g-_*d,I=f*g-_*m,R=v*I-y*P+x*w+S*b-T*C+A*E;return R?(R=1/R,t.m00=(s*I-c*P+l*w)*R,t.m01=(c*b-o*I-l*C)*R,t.m02=(o*P-s*b+l*E)*R,t.m03=0,t.m04=(r*P-i*I-a*w)*R,t.m05=(n*I-r*b+a*C)*R,t.m06=(i*b-n*P-a*E)*R,t.m07=0,t.m08=(d*A-m*T+g*S)*R,t.m09=(m*x-p*A-g*y)*R,t.m10=(p*T-d*x+g*v)*R,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t):null},e.toArray=function(t,e,n){return void 0===n&&(n=0),t[n+0]=e.m00,t[n+1]=e.m01,t[n+2]=e.m02,t[n+3]=e.m03,t[n+4]=e.m04,t[n+5]=e.m05,t[n+6]=e.m06,t[n+7]=e.m07,t[n+8]=e.m08,t[n+9]=e.m09,t[n+10]=e.m10,t[n+11]=e.m11,t[n+12]=e.m12,t[n+13]=e.m13,t[n+14]=e.m14,t[n+15]=e.m15,t},e.fromArray=function(t,e,n){return void 0===n&&(n=0),t.m00=e[n+0],t.m01=e[n+1],t.m02=e[n+2],t.m03=e[n+3],t.m04=e[n+4],t.m05=e[n+5],t.m06=e[n+6],t.m07=e[n+7],t.m08=e[n+8],t.m09=e[n+9],t.m10=e[n+10],t.m11=e[n+11],t.m12=e[n+12],t.m13=e[n+13],t.m14=e[n+14],t.m15=e[n+15],t},e.add=function(t,e,n){return t.m00=e.m00+n.m00,t.m01=e.m01+n.m01,t.m02=e.m02+n.m02,t.m03=e.m03+n.m03,t.m04=e.m04+n.m04,t.m05=e.m05+n.m05,t.m06=e.m06+n.m06,t.m07=e.m07+n.m07,t.m08=e.m08+n.m08,t.m09=e.m09+n.m09,t.m10=e.m10+n.m10,t.m11=e.m11+n.m11,t.m12=e.m12+n.m12,t.m13=e.m13+n.m13,t.m14=e.m14+n.m14,t.m15=e.m15+n.m15,t},e.subtract=function(t,e,n){return t.m00=e.m00-n.m00,t.m01=e.m01-n.m01,t.m02=e.m02-n.m02,t.m03=e.m03-n.m03,t.m04=e.m04-n.m04,t.m05=e.m05-n.m05,t.m06=e.m06-n.m06,t.m07=e.m07-n.m07,t.m08=e.m08-n.m08,t.m09=e.m09-n.m09,t.m10=e.m10-n.m10,t.m11=e.m11-n.m11,t.m12=e.m12-n.m12,t.m13=e.m13-n.m13,t.m14=e.m14-n.m14,t.m15=e.m15-n.m15,t},e.multiplyScalar=function(t,e,n){return t.m00=e.m00*n,t.m01=e.m01*n,t.m02=e.m02*n,t.m03=e.m03*n,t.m04=e.m04*n,t.m05=e.m05*n,t.m06=e.m06*n,t.m07=e.m07*n,t.m08=e.m08*n,t.m09=e.m09*n,t.m10=e.m10*n,t.m11=e.m11*n,t.m12=e.m12*n,t.m13=e.m13*n,t.m14=e.m14*n,t.m15=e.m15*n,t},e.multiplyScalarAndAdd=function(t,e,n,i){return t.m00=e.m00+n.m00*i,t.m01=e.m01+n.m01*i,t.m02=e.m02+n.m02*i,t.m03=e.m03+n.m03*i,t.m04=e.m04+n.m04*i,t.m05=e.m05+n.m05*i,t.m06=e.m06+n.m06*i,t.m07=e.m07+n.m07*i,t.m08=e.m08+n.m08*i,t.m09=e.m09+n.m09*i,t.m10=e.m10+n.m10*i,t.m11=e.m11+n.m11*i,t.m12=e.m12+n.m12*i,t.m13=e.m13+n.m13*i,t.m14=e.m14+n.m14*i,t.m15=e.m15+n.m15*i,t},e.strictEquals=function(t,e){return t.m00===e.m00&&t.m01===e.m01&&t.m02===e.m02&&t.m03===e.m03&&t.m04===e.m04&&t.m05===e.m05&&t.m06===e.m06&&t.m07===e.m07&&t.m08===e.m08&&t.m09===e.m09&&t.m10===e.m10&&t.m11===e.m11&&t.m12===e.m12&&t.m13===e.m13&&t.m14===e.m14&&t.m15===e.m15},e.equals=function(t,e,n){return void 0===n&&(n=Wn),Math.abs(t.m00-e.m00)<=n*Math.max(1,Math.abs(t.m00),Math.abs(e.m00))&&Math.abs(t.m01-e.m01)<=n*Math.max(1,Math.abs(t.m01),Math.abs(e.m01))&&Math.abs(t.m02-e.m02)<=n*Math.max(1,Math.abs(t.m02),Math.abs(e.m02))&&Math.abs(t.m03-e.m03)<=n*Math.max(1,Math.abs(t.m03),Math.abs(e.m03))&&Math.abs(t.m04-e.m04)<=n*Math.max(1,Math.abs(t.m04),Math.abs(e.m04))&&Math.abs(t.m05-e.m05)<=n*Math.max(1,Math.abs(t.m05),Math.abs(e.m05))&&Math.abs(t.m06-e.m06)<=n*Math.max(1,Math.abs(t.m06),Math.abs(e.m06))&&Math.abs(t.m07-e.m07)<=n*Math.max(1,Math.abs(t.m07),Math.abs(e.m07))&&Math.abs(t.m08-e.m08)<=n*Math.max(1,Math.abs(t.m08),Math.abs(e.m08))&&Math.abs(t.m09-e.m09)<=n*Math.max(1,Math.abs(t.m09),Math.abs(e.m09))&&Math.abs(t.m10-e.m10)<=n*Math.max(1,Math.abs(t.m10),Math.abs(e.m10))&&Math.abs(t.m11-e.m11)<=n*Math.max(1,Math.abs(t.m11),Math.abs(e.m11))&&Math.abs(t.m12-e.m12)<=n*Math.max(1,Math.abs(t.m12),Math.abs(e.m12))&&Math.abs(t.m13-e.m13)<=n*Math.max(1,Math.abs(t.m13),Math.abs(e.m13))&&Math.abs(t.m14-e.m14)<=n*Math.max(1,Math.abs(t.m14),Math.abs(e.m14))&&Math.abs(t.m15-e.m15)<=n*Math.max(1,Math.abs(t.m15),Math.abs(e.m15))};var n=e.prototype;return n.clone=function(){return new e(this.m00,this.m01,this.m02,this.m03,this.m04,this.m05,this.m06,this.m07,this.m08,this.m09,this.m10,this.m11,this.m12,this.m13,this.m14,this.m15)},n.set=function(t,e,n,i,r,a,o,s,c,l,u,h,f,_,p,d){return void 0===t&&(t=1),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===a&&(a=1),void 0===o&&(o=0),void 0===s&&(s=0),void 0===c&&(c=0),void 0===l&&(l=0),void 0===u&&(u=1),void 0===h&&(h=0),void 0===f&&(f=0),void 0===_&&(_=0),void 0===p&&(p=0),void 0===d&&(d=1),"object"==typeof t?(this.m01=t.m01,this.m02=t.m02,this.m03=t.m03,this.m04=t.m04,this.m05=t.m05,this.m06=t.m06,this.m07=t.m07,this.m08=t.m08,this.m09=t.m09,this.m10=t.m10,this.m11=t.m11,this.m12=t.m12,this.m13=t.m13,this.m14=t.m14,this.m15=t.m15,this.m00=t.m00):(this.m01=e,this.m02=n,this.m03=i,this.m04=r,this.m05=a,this.m06=o,this.m07=s,this.m08=c,this.m09=l,this.m10=u,this.m11=h,this.m12=f,this.m13=_,this.m14=p,this.m15=d,this.m00=t),this},n.equals=function(t,e){return void 0===e&&(e=Wn),Math.abs(this.m00-t.m00)<=e*Math.max(1,Math.abs(this.m00),Math.abs(t.m00))&&Math.abs(this.m01-t.m01)<=e*Math.max(1,Math.abs(this.m01),Math.abs(t.m01))&&Math.abs(this.m02-t.m02)<=e*Math.max(1,Math.abs(this.m02),Math.abs(t.m02))&&Math.abs(this.m03-t.m03)<=e*Math.max(1,Math.abs(this.m03),Math.abs(t.m03))&&Math.abs(this.m04-t.m04)<=e*Math.max(1,Math.abs(this.m04),Math.abs(t.m04))&&Math.abs(this.m05-t.m05)<=e*Math.max(1,Math.abs(this.m05),Math.abs(t.m05))&&Math.abs(this.m06-t.m06)<=e*Math.max(1,Math.abs(this.m06),Math.abs(t.m06))&&Math.abs(this.m07-t.m07)<=e*Math.max(1,Math.abs(this.m07),Math.abs(t.m07))&&Math.abs(this.m08-t.m08)<=e*Math.max(1,Math.abs(this.m08),Math.abs(t.m08))&&Math.abs(this.m09-t.m09)<=e*Math.max(1,Math.abs(this.m09),Math.abs(t.m09))&&Math.abs(this.m10-t.m10)<=e*Math.max(1,Math.abs(this.m10),Math.abs(t.m10))&&Math.abs(this.m11-t.m11)<=e*Math.max(1,Math.abs(this.m11),Math.abs(t.m11))&&Math.abs(this.m12-t.m12)<=e*Math.max(1,Math.abs(this.m12),Math.abs(t.m12))&&Math.abs(this.m13-t.m13)<=e*Math.max(1,Math.abs(this.m13),Math.abs(t.m13))&&Math.abs(this.m14-t.m14)<=e*Math.max(1,Math.abs(this.m14),Math.abs(t.m14))&&Math.abs(this.m15-t.m15)<=e*Math.max(1,Math.abs(this.m15),Math.abs(t.m15))},n.strictEquals=function(t){return this.m00===t.m00&&this.m01===t.m01&&this.m02===t.m02&&this.m03===t.m03&&this.m04===t.m04&&this.m05===t.m05&&this.m06===t.m06&&this.m07===t.m07&&this.m08===t.m08&&this.m09===t.m09&&this.m10===t.m10&&this.m11===t.m11&&this.m12===t.m12&&this.m13===t.m13&&this.m14===t.m14&&this.m15===t.m15},n.toString=function(){return"[\n"+this.m00+", "+this.m01+", "+this.m02+", "+this.m03+",\n"+this.m04+", "+this.m05+", "+this.m06+", "+this.m07+",\n"+this.m08+", "+this.m09+", "+this.m10+", "+this.m11+",\n"+this.m12+", "+this.m13+", "+this.m14+", "+this.m15+"\n]"},n.identity=function(){return this.m00=1,this.m01=0,this.m02=0,this.m03=0,this.m04=0,this.m05=1,this.m06=0,this.m07=0,this.m08=0,this.m09=0,this.m10=1,this.m11=0,this.m12=0,this.m13=0,this.m14=0,this.m15=1,this},n.zero=function(){return this.m00=0,this.m01=0,this.m02=0,this.m03=0,this.m04=0,this.m05=0,this.m06=0,this.m07=0,this.m08=0,this.m09=0,this.m10=0,this.m11=0,this.m12=0,this.m13=0,this.m14=0,this.m15=0,this},n.transpose=function(){var t=this.m01,e=this.m02,n=this.m03,i=this.m06,r=this.m07,a=this.m11;return this.m01=this.m04,this.m02=this.m08,this.m03=this.m12,this.m04=t,this.m06=this.m09,this.m07=this.m13,this.m08=e,this.m09=i,this.m11=this.m14,this.m12=n,this.m13=r,this.m14=a,this},n.invert=function(){var t=this.m00,e=this.m01,n=this.m02,i=this.m03,r=this.m04,a=this.m05,o=this.m06,s=this.m07,c=this.m08,l=this.m09,u=this.m10,h=this.m11,f=this.m12,_=this.m13,p=this.m14,d=this.m15,m=t*a-e*r,g=t*o-n*r,v=t*s-i*r,y=e*o-n*a,x=e*s-i*a,S=n*s-i*o,T=c*_-l*f,A=c*p-u*f,E=c*d-h*f,C=l*p-u*_,b=l*d-h*_,w=u*d-h*p,P=m*w-g*b+v*C+y*E-x*A+S*T;return 0===P?(this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),this):(P=1/P,this.m00=(a*w-o*b+s*C)*P,this.m01=(n*b-e*w-i*C)*P,this.m02=(_*S-p*x+d*y)*P,this.m03=(u*x-l*S-h*y)*P,this.m04=(o*E-r*w-s*A)*P,this.m05=(t*w-n*E+i*A)*P,this.m06=(p*v-f*S-d*g)*P,this.m07=(c*S-u*v+h*g)*P,this.m08=(r*b-a*E+s*T)*P,this.m09=(e*E-t*b-i*T)*P,this.m10=(f*x-_*v+d*m)*P,this.m11=(l*v-c*x-h*m)*P,this.m12=(a*A-r*C-o*T)*P,this.m13=(t*C-e*A+n*T)*P,this.m14=(_*g-f*y-p*m)*P,this.m15=(c*y-l*g+u*m)*P,this)},n.determinant=function(){var t=this.m00,e=this.m01,n=this.m02,i=this.m03,r=this.m04,a=this.m05,o=this.m06,s=this.m07,c=this.m08,l=this.m09,u=this.m10,h=this.m11,f=this.m12,_=this.m13,p=this.m14,d=this.m15;return(t*a-e*r)*(u*d-h*p)-(t*o-n*r)*(l*d-h*_)+(t*s-i*r)*(l*p-u*_)+(e*o-n*a)*(c*d-h*f)-(e*s-i*a)*(c*p-u*f)+(n*s-i*o)*(c*_-l*f)},n.add=function(t){return this.m00+=t.m00,this.m01+=t.m01,this.m02+=t.m02,this.m03+=t.m03,this.m04+=t.m04,this.m05+=t.m05,this.m06+=t.m06,this.m07+=t.m07,this.m08+=t.m08,this.m09+=t.m09,this.m10+=t.m10,this.m11+=t.m11,this.m12+=t.m12,this.m13+=t.m13,this.m14+=t.m14,this.m15+=t.m15,this},n.subtract=function(t){return this.m00-=t.m00,this.m01-=t.m01,this.m02-=t.m02,this.m03-=t.m03,this.m04-=t.m04,this.m05-=t.m05,this.m06-=t.m06,this.m07-=t.m07,this.m08-=t.m08,this.m09-=t.m09,this.m10-=t.m10,this.m11-=t.m11,this.m12-=t.m12,this.m13-=t.m13,this.m14-=t.m14,this.m15-=t.m15,this},n.multiply=function(t){var e=this.m00,n=this.m01,i=this.m02,r=this.m03,a=this.m04,o=this.m05,s=this.m06,c=this.m07,l=this.m08,u=this.m09,h=this.m10,f=this.m11,_=this.m12,p=this.m13,d=this.m14,m=this.m15,g=t.m00,v=t.m01,y=t.m02,x=t.m03;return this.m00=g*e+v*a+y*l+x*_,this.m01=g*n+v*o+y*u+x*p,this.m02=g*i+v*s+y*h+x*d,this.m03=g*r+v*c+y*f+x*m,g=t.m04,v=t.m05,y=t.m06,x=t.m07,this.m04=g*e+v*a+y*l+x*_,this.m05=g*n+v*o+y*u+x*p,this.m06=g*i+v*s+y*h+x*d,this.m07=g*r+v*c+y*f+x*m,g=t.m08,v=t.m09,y=t.m10,x=t.m11,this.m08=g*e+v*a+y*l+x*_,this.m09=g*n+v*o+y*u+x*p,this.m10=g*i+v*s+y*h+x*d,this.m11=g*r+v*c+y*f+x*m,g=t.m12,v=t.m13,y=t.m14,x=t.m15,this.m12=g*e+v*a+y*l+x*_,this.m13=g*n+v*o+y*u+x*p,this.m14=g*i+v*s+y*h+x*d,this.m15=g*r+v*c+y*f+x*m,this},n.multiplyScalar=function(t){return this.m00*=t,this.m01*=t,this.m02*=t,this.m03*=t,this.m04*=t,this.m05*=t,this.m06*=t,this.m07*=t,this.m08*=t,this.m09*=t,this.m10*=t,this.m11*=t,this.m12*=t,this.m13*=t,this.m14*=t,this.m15*=t,this},n.translate=function(t){return console.warn("function changed"),this.m12+=t.x,this.m13+=t.y,this.m14+=t.z,this},n.scale=function(t){var e=t.x,n=t.y,i=t.z;return this.m00*=e,this.m01*=e,this.m02*=e,this.m03*=e,this.m04*=n,this.m05*=n,this.m06*=n,this.m07*=n,this.m08*=i,this.m09*=i,this.m10*=i,this.m11*=i,this},n.rotate=function(t,e){var n=e.x,i=e.y,r=e.z,a=Math.sqrt(n*n+i*i+r*r);if(Math.abs(a)<Wn)return null;n*=a=1/a,i*=a,r*=a;var o=Math.sin(t),s=Math.cos(t),c=1-s,l=this.m00,u=this.m01,h=this.m02,f=this.m03,_=this.m04,p=this.m05,d=this.m06,m=this.m07,g=this.m08,v=this.m09,y=this.m10,x=this.m11,S=n*n*c+s,T=i*n*c+r*o,A=r*n*c-i*o,E=n*i*c-r*o,C=i*i*c+s,b=r*i*c+n*o,w=n*r*c+i*o,P=i*r*c-n*o,I=r*r*c+s;return this.m00=l*S+_*T+g*A,this.m01=u*S+p*T+v*A,this.m02=h*S+d*T+y*A,this.m03=f*S+m*T+x*A,this.m04=l*E+_*C+g*b,this.m05=u*E+p*C+v*b,this.m06=h*E+d*C+y*b,this.m07=f*E+m*C+x*b,this.m08=l*w+_*P+g*I,this.m09=u*w+p*P+v*I,this.m10=h*w+d*P+y*I,this.m11=f*w+m*P+x*I,this},n.getTranslation=function(t){return t.x=this.m12,t.y=this.m13,t.z=this.m14,t},n.getScale=function(t){var e=Oi.m00=this.m00,n=Oi.m01=this.m01,i=Oi.m02=this.m02,r=Oi.m03=this.m04,a=Oi.m04=this.m05,o=Oi.m05=this.m06,s=Oi.m06=this.m08,c=Oi.m07=this.m09,l=Oi.m08=this.m10;return t.x=Math.sqrt(e*e+n*n+i*i),t.y=Math.sqrt(r*r+a*a+o*o),t.z=Math.sqrt(s*s+c*c+l*l),yi.determinant(Oi)<0&&(t.x*=-1),t},n.getRotation=function(t){var e=this.m00+this.m05+this.m10,n=0;return e>0?(n=2*Math.sqrt(e+1),t.w=.25*n,t.x=(this.m06-this.m09)/n,t.y=(this.m08-this.m02)/n,t.z=(this.m01-this.m04)/n):this.m00>this.m05&&this.m00>this.m10?(n=2*Math.sqrt(1+this.m00-this.m05-this.m10),t.w=(this.m06-this.m09)/n,t.x=.25*n,t.y=(this.m01+this.m04)/n,t.z=(this.m08+this.m02)/n):this.m05>this.m10?(n=2*Math.sqrt(1+this.m05-this.m00-this.m10),t.w=(this.m08-this.m02)/n,t.x=(this.m01+this.m04)/n,t.y=.25*n,t.z=(this.m06+this.m09)/n):(n=2*Math.sqrt(1+this.m10-this.m00-this.m05),t.w=(this.m01-this.m04)/n,t.x=(this.m08+this.m02)/n,t.y=(this.m06+this.m09)/n,t.z=.25*n),t},n.fromRTS=function(t,e,n){var i=t.x,r=t.y,a=t.z,o=t.w,s=i+i,c=r+r,l=a+a,u=i*s,h=i*c,f=i*l,_=r*c,p=r*l,d=a*l,m=o*s,g=o*c,v=o*l,y=n.x,x=n.y,S=n.z;return this.m00=(1-(_+d))*y,this.m01=(h+v)*y,this.m02=(f-g)*y,this.m03=0,this.m04=(h-v)*x,this.m05=(1-(u+d))*x,this.m06=(p+m)*x,this.m07=0,this.m08=(f+g)*S,this.m09=(p-m)*S,this.m10=(1-(u+_))*S,this.m11=0,this.m12=e.x,this.m13=e.y,this.m14=e.z,this.m15=1,this},n.fromQuat=function(t){var e=t.x,n=t.y,i=t.z,r=t.w,a=e+e,o=n+n,s=i+i,c=e*a,l=n*a,u=n*o,h=i*a,f=i*o,_=i*s,p=r*a,d=r*o,m=r*s;return this.m00=1-u-_,this.m01=l+m,this.m02=h-d,this.m03=0,this.m04=l-m,this.m05=1-c-_,this.m06=f+p,this.m07=0,this.m08=h+d,this.m09=f-p,this.m10=1-c-u,this.m11=0,this.m12=0,this.m13=0,this.m14=0,this.m15=1,this},e}(Jt));Ri.IDENTITY=Object.freeze(new Ri);var Di=new di,Oi=new yi;function Mi(t,e,n,i,r,a,o,s,c,l,u,h,f,_,p,d){return new Ri(t,e,n,i,r,a,o,s,c,l,u,h,f,_,p,d)}Ge.fastDefine("cc.Mat4",Ri,{m00:1,m01:0,m02:0,m03:0,m04:0,m05:1,m06:0,m07:0,m08:0,m09:0,m10:1,m11:0,m12:0,m13:0,m14:0,m15:1}),i.Mat4=Ri,i.mat4=Mi;var Ni=t("Vec2",function(t){function e(e,n){var i;return i=t.call(this)||this,e&&"object"==typeof e?(i.x=e.x,i.y=e.y):(i.x=e||0,i.y=n||0),i}F(e,t),e.clone=function(t){return new e(t.x,t.y)},e.copy=function(t,e){return t.x=e.x,t.y=e.y,t},e.set=function(t,e,n){return t.x=e,t.y=n,t},e.add=function(t,e,n){return t.x=e.x+n.x,t.y=e.y+n.y,t},e.subtract=function(t,e,n){return t.x=e.x-n.x,t.y=e.y-n.y,t},e.multiply=function(t,e,n){return t.x=e.x*n.x,t.y=e.y*n.y,t},e.divide=function(t,e,n){return t.x=e.x/n.x,t.y=e.y/n.y,t},e.ceil=function(t,e){return t.x=Math.ceil(e.x),t.y=Math.ceil(e.y),t},e.floor=function(t,e){return t.x=Math.floor(e.x),t.y=Math.floor(e.y),t},e.min=function(t,e,n){return t.x=Math.min(e.x,n.x),t.y=Math.min(e.y,n.y),t},e.max=function(t,e,n){return t.x=Math.max(e.x,n.x),t.y=Math.max(e.y,n.y),t},e.round=function(t,e){return t.x=Math.round(e.x),t.y=Math.round(e.y),t},e.multiplyScalar=function(t,e,n){return t.x=e.x*n,t.y=e.y*n,t},e.scaleAndAdd=function(t,e,n,i){return t.x=e.x+n.x*i,t.y=e.y+n.y*i,t},e.distance=function(t,e){var n=e.x-t.x,i=e.y-t.y;return Math.sqrt(n*n+i*i)},e.squaredDistance=function(t,e){var n=e.x-t.x,i=e.y-t.y;return n*n+i*i},e.len=function(t){var e=t.x,n=t.y;return Math.sqrt(e*e+n*n)},e.lengthSqr=function(t){var e=t.x,n=t.y;return e*e+n*n},e.negate=function(t,e){return t.x=-e.x,t.y=-e.y,t},e.inverse=function(t,e){return t.x=1/e.x,t.y=1/e.y,t},e.inverseSafe=function(t,e){var n=e.x,i=e.y;return Math.abs(n)<Wn?t.x=0:t.x=1/n,Math.abs(i)<Wn?t.y=0:t.y=1/i,t},e.normalize=function(t,e){var n=e.x,i=e.y,r=n*n+i*i;return r>0&&(r=1/Math.sqrt(r),t.x=n*r,t.y=i*r),t},e.dot=function(t,e){return t.x*e.x+t.y*e.y},e.cross=function(t,e,n){return t instanceof di?(t.x=t.y=0,t.z=e.x*n.y-e.y*n.x,t):t.x*e.y-t.y*e.x},e.lerp=function(t,e,n,i){var r=e.x,a=e.y;return t.x=r+i*(n.x-r),t.y=a+i*(n.y-a),t},e.random=function(t,e){e=e||1;var n=2*$n()*Math.PI;return t.x=Math.cos(n)*e,t.y=Math.sin(n)*e,t},e.transformMat3=function(t,e,n){var i=e.x,r=e.y;return t.x=n.m00*i+n.m03*r+n.m06,t.y=n.m01*i+n.m04*r+n.m07,t},e.transformMat4=function(t,e,n){var i=e.x,r=e.y;return t.x=n.m00*i+n.m04*r+n.m12,t.y=n.m01*i+n.m05*r+n.m13,t},e.str=function(t){return"Vec2("+t.x+", "+t.y+")"},e.toArray=function(t,e,n){return void 0===n&&(n=0),t[n+0]=e.x,t[n+1]=e.y,t},e.fromArray=function(t,e,n){return void 0===n&&(n=0),t.x=e[n+0],t.y=e[n+1],t},e.strictEquals=function(t,e){return t.x===e.x&&t.y===e.y},e.equals=function(t,e,n){return void 0===n&&(n=Wn),Math.abs(t.x-e.x)<=n*Math.max(1,Math.abs(t.x),Math.abs(e.x))&&Math.abs(t.y-e.y)<=n*Math.max(1,Math.abs(t.y),Math.abs(e.y))},e.angle=function(t,n){e.normalize(Li,t),e.normalize(Bi,n);var i=e.dot(Li,Bi);return i>1?0:i<-1?Math.PI:Math.acos(i)};var n=e.prototype;return n.clone=function(){return new e(this.x,this.y)},n.set=function(t,e){return t&&"object"==typeof t?(this.x=t.x,this.y=t.y):(this.x=t||0,this.y=e||0),this},n.equals=function(t,e){return void 0===e&&(e=Wn),Math.abs(this.x-t.x)<=e*Math.max(1,Math.abs(this.x),Math.abs(t.x))&&Math.abs(this.y-t.y)<=e*Math.max(1,Math.abs(this.y),Math.abs(t.y))},n.equals2f=function(t,e,n){return void 0===n&&(n=Wn),Math.abs(this.x-t)<=n*Math.max(1,Math.abs(this.x),Math.abs(t))&&Math.abs(this.y-e)<=n*Math.max(1,Math.abs(this.y),Math.abs(e))},n.strictEquals=function(t){return t&&this.x===t.x&&this.y===t.y},n.strictEquals2f=function(t,e){return this.x===t&&this.y===e},n.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+")"},n.lerp=function(t,e){var n=this.x,i=this.y;return this.x=n+e*(t.x-n),this.y=i+e*(t.y-i),this},n.clampf=function(t,e){return this.x=Yn(this.x,t.x,e.x),this.y=Yn(this.y,t.y,e.y),this},n.add=function(t){return this.x+=t.x,this.y+=t.y,this},n.add2f=function(t,e){return this.x+=t,this.y+=e,this},n.subtract=function(t){return this.x-=t.x,this.y-=t.y,this},n.subtract2f=function(t,e){return this.x-=t,this.y-=e,this},n.multiplyScalar=function(t){return"object"==typeof t&&console.warn("should use Vec2.multiply for vector * vector operation"),this.x*=t,this.y*=t,this},n.multiply=function(t){return"object"!=typeof t&&console.warn("should use Vec2.scale for vector * scalar operation"),this.x*=t.x,this.y*=t.y,this},n.multiply2f=function(t,e){return this.x*=t,this.y*=e,this},n.divide=function(t){return this.x/=t.x,this.y/=t.y,this},n.divide2f=function(t,e){return this.x/=t,this.y/=e,this},n.negative=function(){return this.x=-this.x,this.y=-this.y,this},n.dot=function(t){return this.x*t.x+this.y*t.y},n.cross=function(t){return this.x*t.y-this.y*t.x},n.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},n.lengthSqr=function(){return this.x*this.x+this.y*this.y},n.normalize=function(){var t=this.x,e=this.y,n=t*t+e*e;return n>0&&(n=1/Math.sqrt(n),this.x*=n,this.y*=n),this},n.angle=function(t){var e=this.lengthSqr(),n=t.lengthSqr();if(0===e||0===n)return console.warn("Can't get angle between zero vector"),0;var i=this.dot(t)/Math.sqrt(e*n);return i=Yn(i,-1,1),Math.acos(i)},n.signAngle=function(t){var e=this.angle(t);return this.cross(t)<0?-e:e},n.rotate=function(t){var e=this.x,n=this.y,i=Math.sin(t),r=Math.cos(t);return this.x=r*e-i*n,this.y=i*e+r*n,this},n.project=function(t){var e=this.dot(t)/t.dot(t);return this.x=t.x*e,this.y=t.y*e,this},n.transformMat4=function(t){var e=this.x,n=this.y;return this.x=t.m00*e+t.m04*n+t.m12,this.y=t.m01*e+t.m05*n+t.m13,this},e}(Jt));Ni.ZERO=Object.freeze(new Ni(0,0)),Ni.ONE=Object.freeze(new Ni(1,1)),Ni.NEG_ONE=Object.freeze(new Ni(-1,-1)),Ni.UNIT_X=Object.freeze(new Ni(1,0)),Ni.UNIT_Y=Object.freeze(new Ni(0,1));var Li=new Ni,Bi=new Ni;function Fi(t,e){return new Ni(t,e)}Ge.fastDefine("cc.Vec2",Ni,{x:0,y:0}),i.Vec2=Ni,i.v2=Fi;var zi=t("Vec4",function(t){function e(e,n,i,r){var a;return a=t.call(this)||this,e&&"object"==typeof e?(a.x=e.x,a.y=e.y,a.z=e.z,a.w=e.w):(a.x=e||0,a.y=n||0,a.z=i||0,a.w=r||0),a}F(e,t),e.clone=function(t){return new e(t.x,t.y,t.z,t.w)},e.copy=function(t,e){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t},e.set=function(t,e,n,i,r){return t.x=e,t.y=n,t.z=i,t.w=r,t},e.add=function(t,e,n){return t.x=e.x+n.x,t.y=e.y+n.y,t.z=e.z+n.z,t.w=e.w+n.w,t},e.subtract=function(t,e,n){return t.x=e.x-n.x,t.y=e.y-n.y,t.z=e.z-n.z,t.w=e.w-n.w,t},e.multiply=function(t,e,n){return t.x=e.x*n.x,t.y=e.y*n.y,t.z=e.z*n.z,t.w=e.w*n.w,t},e.divide=function(t,e,n){return t.x=e.x/n.x,t.y=e.y/n.y,t.z=e.z/n.z,t.w=e.w/n.w,t},e.ceil=function(t,e){return t.x=Math.ceil(e.x),t.y=Math.ceil(e.y),t.z=Math.ceil(e.z),t.w=Math.ceil(e.w),t},e.floor=function(t,e){return t.x=Math.floor(e.x),t.y=Math.floor(e.y),t.z=Math.floor(e.z),t.w=Math.floor(e.w),t},e.min=function(t,e,n){return t.x=Math.min(e.x,n.x),t.y=Math.min(e.y,n.y),t.z=Math.min(e.z,n.z),t.w=Math.min(e.w,n.w),t},e.max=function(t,e,n){return t.x=Math.max(e.x,n.x),t.y=Math.max(e.y,n.y),t.z=Math.max(e.z,n.z),t.w=Math.max(e.w,n.w),t},e.round=function(t,e){return t.x=Math.round(e.x),t.y=Math.round(e.y),t.z=Math.round(e.z),t.w=Math.round(e.w),t},e.multiplyScalar=function(t,e,n){return t.x=e.x*n,t.y=e.y*n,t.z=e.z*n,t.w=e.w*n,t},e.scaleAndAdd=function(t,e,n,i){return t.x=e.x+n.x*i,t.y=e.y+n.y*i,t.z=e.z+n.z*i,t.w=e.w+n.w*i,t},e.distance=function(t,e){var n=e.x-t.x,i=e.y-t.y,r=e.z-t.z,a=e.w-t.w;return Math.sqrt(n*n+i*i+r*r+a*a)},e.squaredDistance=function(t,e){var n=e.x-t.x,i=e.y-t.y,r=e.z-t.z,a=e.w-t.w;return n*n+i*i+r*r+a*a},e.len=function(t){var e=t.x,n=t.y,i=t.z,r=t.w;return Math.sqrt(e*e+n*n+i*i+r*r)},e.lengthSqr=function(t){var e=t.x,n=t.y,i=t.z,r=t.w;return e*e+n*n+i*i+r*r},e.negate=function(t,e){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t.w=-e.w,t},e.inverse=function(t,e){return t.x=1/e.x,t.y=1/e.y,t.z=1/e.z,t.w=1/e.w,t},e.inverseSafe=function(t,e){var n=e.x,i=e.y,r=e.z,a=e.w;return Math.abs(n)<Wn?t.x=0:t.x=1/n,Math.abs(i)<Wn?t.y=0:t.y=1/i,Math.abs(r)<Wn?t.z=0:t.z=1/r,Math.abs(a)<Wn?t.w=0:t.w=1/a,t},e.normalize=function(t,e){var n=e.x,i=e.y,r=e.z,a=e.w,o=n*n+i*i+r*r+a*a;return o>0&&(o=1/Math.sqrt(o),t.x=n*o,t.y=i*o,t.z=r*o,t.w=a*o),t},e.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z+t.w*e.w},e.lerp=function(t,e,n,i){return t.x=e.x+i*(n.x-e.x),t.y=e.y+i*(n.y-e.y),t.z=e.z+i*(n.z-e.z),t.w=e.w+i*(n.w-e.w),t},e.random=function(t,e){e=e||1;var n=2*$n()*Math.PI,i=2*$n()-1,r=Math.sqrt(1-i*i);return t.x=r*Math.cos(n)*e,t.y=r*Math.sin(n)*e,t.z=i*e,t.w=0,t},e.transformMat4=function(t,e,n){var i=e.x,r=e.y,a=e.z,o=e.w;return t.x=n.m00*i+n.m04*r+n.m08*a+n.m12*o,t.y=n.m01*i+n.m05*r+n.m09*a+n.m13*o,t.z=n.m02*i+n.m06*r+n.m10*a+n.m14*o,t.w=n.m03*i+n.m07*r+n.m11*a+n.m15*o,t},e.transformAffine=function(t,e,n){var i=e.x,r=e.y,a=e.z,o=e.w;return t.x=n.m00*i+n.m01*r+n.m02*a+n.m03*o,t.y=n.m04*i+n.m05*r+n.m06*a+n.m07*o,t.x=n.m08*i+n.m09*r+n.m10*a+n.m11*o,t.w=e.w,t},e.transformQuat=function(t,e,n){var i=e.x,r=e.y,a=e.z,o=n.x,s=n.y,c=n.z,l=n.w,u=l*i+s*a-c*r,h=l*r+c*i-o*a,f=l*a+o*r-s*i,_=-o*i-s*r-c*a;return t.x=u*l+_*-o+h*-c-f*-s,t.y=h*l+_*-s+f*-o-u*-c,t.z=f*l+_*-c+u*-s-h*-o,t.w=e.w,t},e.toArray=function(t,e,n){return void 0===n&&(n=0),t[n+0]=e.x,t[n+1]=e.y,t[n+2]=e.z,t[n+3]=e.w,t},e.fromArray=function(t,e,n){return void 0===n&&(n=0),t.x=e[n+0],t.y=e[n+1],t.z=e[n+2],t.w=e[n+3],t},e.strictEquals=function(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z&&t.w===e.w},e.equals=function(t,e,n){return void 0===n&&(n=Wn),Math.abs(t.x-e.x)<=n*Math.max(1,Math.abs(t.x),Math.abs(e.x))&&Math.abs(t.y-e.y)<=n*Math.max(1,Math.abs(t.y),Math.abs(e.y))&&Math.abs(t.z-e.z)<=n*Math.max(1,Math.abs(t.z),Math.abs(e.z))&&Math.abs(t.w-e.w)<=n*Math.max(1,Math.abs(t.w),Math.abs(e.w))};var n=e.prototype;return n.clone=function(){return new e(this.x,this.y,this.z,this.w)},n.set=function(t,e,n,i){return t&&"object"==typeof t?(this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w):(this.x=t||0,this.y=e||0,this.z=n||0,this.w=i||0),this},n.equals=function(t,e){return void 0===e&&(e=Wn),Math.abs(this.x-t.x)<=e*Math.max(1,Math.abs(this.x),Math.abs(t.x))&&Math.abs(this.y-t.y)<=e*Math.max(1,Math.abs(this.y),Math.abs(t.y))&&Math.abs(this.z-t.z)<=e*Math.max(1,Math.abs(this.z),Math.abs(t.z))&&Math.abs(this.w-t.w)<=e*Math.max(1,Math.abs(this.w),Math.abs(t.w))},n.equals4f=function(t,e,n,i,r){return void 0===r&&(r=Wn),Math.abs(this.x-t)<=r*Math.max(1,Math.abs(this.x),Math.abs(t))&&Math.abs(this.y-e)<=r*Math.max(1,Math.abs(this.y),Math.abs(e))&&Math.abs(this.z-n)<=r*Math.max(1,Math.abs(this.z),Math.abs(n))&&Math.abs(this.w-i)<=r*Math.max(1,Math.abs(this.w),Math.abs(i))},n.strictEquals=function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},n.strictEquals4f=function(t,e,n,i){return this.x===t&&this.y===e&&this.z===n&&this.w===i},n.lerp=function(t,e){var n=this.x,i=this.y,r=this.z,a=this.w;return this.x=n+e*(t.x-n),this.y=i+e*(t.y-i),this.z=r+e*(t.z-r),this.w=a+e*(t.w-a),this},n.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.z.toFixed(2)+", "+this.w.toFixed(2)+")"},n.clampf=function(t,e){return this.x=Yn(this.x,t.x,e.x),this.y=Yn(this.y,t.y,e.y),this.z=Yn(this.z,t.z,e.z),this.w=Yn(this.w,t.w,e.w),this},n.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},n.add4f=function(t,e,n,i){return this.x+=t,this.y+=e,this.z+=n,this.w+=i,this},n.subtract=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this},n.subtract4f=function(t,e,n,i){return this.x-=t,this.y-=e,this.z-=n,this.w-=i,this},n.multiplyScalar=function(t){return"object"==typeof t&&console.warn("should use Vec4.multiply for vector * vector operation"),this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},n.multiply=function(t){return"object"!=typeof t&&console.warn("should use Vec4.scale for vector * scalar operation"),this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this},n.multiply4f=function(t,e,n,i){return this.x*=t,this.y*=e,this.z*=n,this.w*=i,this},n.divide=function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this},n.divide4f=function(t,e,n,i){return this.x/=t,this.y/=e,this.z/=n,this.w/=i,this},n.negative=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},n.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},n.cross=function(t){var e=this.x,n=this.y,i=this.z,r=t.x,a=t.y,o=t.z;return this.x=n*o-i*a,this.y=i*r-e*o,this.z=e*a-n*r,this},n.length=function(){var t=this.x,e=this.y,n=this.z,i=this.w;return Math.sqrt(t*t+e*e+n*n+i*i)},n.lengthSqr=function(){var t=this.x,e=this.y,n=this.z,i=this.w;return t*t+e*e+n*n+i*i},n.normalize=function(){var t=this.x,e=this.y,n=this.z,i=this.w,r=t*t+e*e+n*n+i*i;return r>0&&(r=1/Math.sqrt(r),this.x=t*r,this.y=e*r,this.z=n*r,this.w=i*r),this},n.transformMat4=function(t){var e=this.x,n=this.y,i=this.z,r=this.w;return this.x=t.m00*e+t.m04*n+t.m08*i+t.m12*r,this.y=t.m01*e+t.m05*n+t.m09*i+t.m13*r,this.z=t.m02*e+t.m06*n+t.m10*i+t.m14*r,this.w=t.m03*e+t.m07*n+t.m11*i+t.m15*r,this},e}(Jt));function Ui(t,e,n,i){return new zi(t,e,n,i)}zi.ZERO=Object.freeze(new zi(0,0,0,0)),zi.ONE=Object.freeze(new zi(1,1,1,1)),zi.NEG_ONE=Object.freeze(new zi(-1,-1,-1,-1)),Ge.fastDefine("cc.Vec4",zi,{x:0,y:0,z:0,w:0}),i.Vec4=zi,i.v4=Ui,Nn(Ni,"Vec2",[{name:"sub",newName:"subtract",target:Ni,targetName:"Vec2"},{name:"mul",newName:"multiply",target:Ni,targetName:"Vec2"},{name:"div",newName:"divide",target:Ni,targetName:"Vec2"},{name:"dist",newName:"distance",target:Ni,targetName:"Vec2"},{name:"sqrDist",newName:"squaredDistance",target:Ni,targetName:"Vec2"},{name:"mag",newName:"len",target:Ni,targetName:"Vec2"},{name:"sqrMag",newName:"lengthSqr",target:Ni,targetName:"Vec2"},{name:"scale",newName:"multiplyScalar",target:Ni,targetName:"Vec2"},{name:"exactEquals",newName:"strictEquals",target:Ni,targetName:"Vec2"}]),Nn(Ni.prototype,"Vec2",[{name:"mag",newName:"length",target:Ni.prototype,targetName:"Vec2"},{name:"magSqr",newName:"lengthSqr",target:Ni.prototype,targetName:"Vec2"},{name:"scale",newName:"multiplyScalar",target:Ni.prototype,targetName:"Vec2"},{name:"exactEquals",newName:"strictEquals",target:Ni.prototype,targetName:"Vec2"}]),Nn(di,"Vec3",[{name:"sub",newName:"subtract",target:di,targetName:"Vec3"},{name:"mul",newName:"multiply",target:di,targetName:"Vec3"},{name:"div",newName:"divide",target:di,targetName:"Vec3"},{name:"dist",newName:"distance",target:di,targetName:"Vec3"},{name:"sqrDist",newName:"squaredDistance",target:di,targetName:"Vec3"},{name:"mag",newName:"len",target:di,targetName:"Vec3"},{name:"sqrMag",newName:"lengthSqr",target:di,targetName:"Vec3"},{name:"scale",newName:"multiplyScalar",target:di,targetName:"Vec3"},{name:"exactEquals",newName:"strictEquals",target:di,targetName:"Vec3"}]),Nn(di.prototype,"Vec3",[{name:"mag",newName:"length",target:di.prototype,targetName:"Vec3"},{name:"magSqr",newName:"lengthSqr",target:di.prototype,targetName:"Vec3"},{name:"scale",newName:"multiplyScalar",target:di.prototype,targetName:"Vec3"},{name:"exactEquals",newName:"strictEquals",target:di.prototype,targetName:"Vec3"}]),Nn(zi,"Vec4",[{name:"sub",newName:"subtract",target:zi,targetName:"Vec4"},{name:"mul",newName:"multiply",target:zi,targetName:"Vec4"},{name:"div",newName:"divide",target:zi,targetName:"Vec4"},{name:"dist",newName:"distance",target:zi,targetName:"Vec4"},{name:"sqrDist",newName:"squaredDistance",target:zi,targetName:"Vec4"},{name:"mag",newName:"len",target:zi,targetName:"Vec4"},{name:"sqrMag",newName:"lengthSqr",target:zi,targetName:"Vec4"},{name:"scale",newName:"multiplyScalar",target:zi,targetName:"Vec4"},{name:"exactEquals",newName:"strictEquals",target:zi,targetName:"Vec4"}]),Nn(zi.prototype,"Vec4",[{name:"mag",newName:"length",target:zi.prototype,targetName:"Vec4"},{name:"magSqr",newName:"lengthSqr",target:zi.prototype,targetName:"Vec4"},{name:"scale",newName:"multiplyScalar",target:zi.prototype,targetName:"Vec4"},{name:"exactEquals",newName:"strictEquals",target:zi.prototype,targetName:"Vec4"}]),Nn(Ti,"Quat",[{name:"mag",newName:"len",target:Ti,targetName:"Quat"},{name:"mul",newName:"multiply",target:Ti,targetName:"Quat"},{name:"sqrMag",newName:"lengthSqr",target:Ti,targetName:"Quat"},{name:"scale",newName:"multiplyScalar",target:Ti,targetName:"Quat"},{name:"exactEquals",newName:"strictEquals",target:Ti,targetName:"Quat"}]),Nn(Ti.prototype,"Quat",[{name:"scale",newName:"multiplyScalar",target:Ti.prototype,targetName:"Quat"},{name:"exactEquals",newName:"strictEquals",target:Ti.prototype,targetName:"Quat"}]),Nn(_i,"Color",[{name:"sub",newName:"subtract",target:_i,targetName:"Color"},{name:"mul",newName:"multiply",target:_i,targetName:"Color"},{name:"div",newName:"divide",target:_i,targetName:"Color"},{name:"exactEquals",newName:"strictEquals",target:_i,targetName:"Color"},{name:"fromHex",newName:"fromHEX",customFunction:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=e[1].toString(16);return i.Color.fromHEX(e[0],r)}}]),Nn(yi,"Mat3",[{name:"sub",newName:"subtract",target:yi,targetName:"Mat3"},{name:"mul",newName:"multiply",target:yi,targetName:"Mat3"},{name:"exactEquals",newName:"strictEquals",target:yi,targetName:"Mat3"},{name:"transfrom",newName:"transform",target:yi,targetName:"Mat3"}]),Nn(yi.prototype,"Mat3",[{name:"sub",newName:"subtract",target:yi.prototype,targetName:"Mat3"},{name:"mul",newName:"multiply",target:yi.prototype,targetName:"Mat3"},{name:"mulScalar",newName:"multiplyScalar",target:yi.prototype,targetName:"Mat3"},{name:"exactEquals",newName:"strictEquals",target:yi.prototype,targetName:"Mat3"}]),Nn(Ri,"Mat4",[{name:"sub",newName:"subtract",target:Ri,targetName:"Mat4"},{name:"mul",newName:"multiply",target:Ri,targetName:"Mat4"},{name:"exactEquals",newName:"strictEquals",target:Ri,targetName:"Mat4"}]),Nn(Ri.prototype,"Mat4",[{name:"sub",newName:"subtract",target:Ri.prototype,targetName:"Mat4"},{name:"mul",newName:"multiply",target:Ri.prototype,targetName:"Mat4"},{name:"mulScalar",newName:"multiplyScalar",target:Ri.prototype,targetName:"Mat4"},{name:"exactEquals",newName:"strictEquals",target:Ri.prototype,targetName:"Mat4"}]);var ki=t("AffineTransform",function(){function t(t,e,n,i,r,a){void 0===t&&(t=1),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=1),void 0===r&&(r=0),void 0===a&&(a=0),this.a=t,this.b=e,this.c=n,this.d=i,this.tx=r,this.ty=a}return t.identity=function(){return new t},t.clone=function(e){return new t(e.a,e.b,e.c,e.d,e.tx,e.ty)},t.concat=function(t,e,n){var i=e.a,r=e.b,a=e.c,o=e.d,s=e.tx,c=e.ty;t.a=i*n.a+r*n.c,t.b=i*n.b+r*n.d,t.c=a*n.a+o*n.c,t.d=a*n.b+o*n.d,t.tx=s*n.a+c*n.c+n.tx,t.ty=s*n.b+c*n.d+n.ty},t.invert=function(t,e){var n=1/(e.a*e.d-e.b*e.c);t.a=n*e.d,t.b=-n*e.b,t.c=-n*e.c,t.d=n*e.a,t.tx=n*(e.c*e.ty-e.d*e.tx),t.ty=n*(e.b*e.tx-e.a*e.ty)},t.fromMat4=function(t,e){t.a=e.m00,t.b=e.m01,t.c=e.m04,t.d=e.m05,t.tx=e.m12,t.ty=e.m13},t.transformVec2=function(t,e,n,i){var r,a;void 0===i?(i=n,r=e.x,a=e.y):(r=e,a=n),t.x=i.a*r+i.c*a+i.tx,t.y=i.b*r+i.d*a+i.ty},t.transformSize=function(t,e,n){t.width=n.a*e.width+n.c*e.height,t.height=n.b*e.width+n.d*e.height},t.transformRect=function(t,e,n){var i=e.x+e.width,r=e.y+e.height,a=n.a*e.x+n.c*e.y+n.tx,o=n.b*e.x+n.d*e.y+n.ty,s=n.a*i+n.c*e.y+n.tx,c=n.b*i+n.d*e.y+n.ty,l=n.a*e.x+n.c*r+n.tx,u=n.b*e.x+n.d*r+n.ty,h=n.a*i+n.c*r+n.tx,f=n.b*i+n.d*r+n.ty,_=Math.min(a,s,l,h),p=Math.max(a,s,l,h),d=Math.min(o,c,u,f),m=Math.max(o,c,u,f);t.x=_,t.y=d,t.width=p-_,t.height=m-d},t.transformObb=function(t,e,n,i,r,a){var o=a.a*r.x+a.c*r.y+a.tx,s=a.b*r.x+a.d*r.y+a.ty,c=a.a*r.width,l=a.b*r.width,u=a.c*r.height,h=a.d*r.height;e.x=o,e.y=s,n.x=c+o,n.y=l+s,t.x=u+o,t.y=h+s,i.x=c+u+o,i.y=l+h+s},t}());i.AffineTransform=ki;var Gi=t("Size",function(t){function e(e,n){var i;return i=t.call(this)||this,e&&"object"==typeof e?(i.width=e.width,i.height=e.height):(i.width=e||0,i.height=n||0),i}F(e,t),e.lerp=function(t,e,n,i){return t.width=e.width+(n.width-e.width)*i,t.height=e.height+(n.height-e.height)*i,t};var n=e.prototype;return n.clone=function(){return new e(this.width,this.height)},n.set=function(t,e){return t&&"object"==typeof t?(this.height=t.height,this.width=t.width):(this.width=t||0,this.height=e||0),this},n.equals=function(t){return this.width===t.width&&this.height===t.height},n.lerp=function(t,e){return this.width+=(t.width-this.width)*e,this.height+=(t.height-this.height)*e,this},n.toString=function(){return"("+this.width.toFixed(2)+", "+this.height.toFixed(2)+")"},L(e,[{key:"x",get:function(){return this.width},set:function(t){this.width=t}},{key:"y",get:function(){return this.height},set:function(t){this.height=t}}]),e}(Jt));function Hi(t,e){return void 0===t&&(t=0),void 0===e&&(e=0),new Gi(t,e)}Gi.ZERO=Object.freeze(new Gi(0,0)),Gi.ONE=Object.freeze(new Gi(1,1)),Ge.fastDefine("cc.Size",Gi,{width:0,height:0}),i.size=Hi,i.Size=Gi;var Vi=t("Rect",function(t){function e(e,n,i,r){var a;return a=t.call(this)||this,e&&"object"==typeof e?(a.y=e.y,a.width=e.width,a.height=e.height,a.x=e.x):(a.x=e||0,a.y=n||0,a.width=i||0,a.height=r||0),a}F(e,t),e.fromMinMax=function(t,e,n){var i=Math.min(e.x,n.x),r=Math.min(e.y,n.y),a=Math.max(e.x,n.x),o=Math.max(e.y,n.y);return t.x=i,t.y=r,t.width=a-i,t.height=o-r,t},e.lerp=function(t,e,n,i){var r=e.x,a=e.y,o=e.width,s=e.height;return t.x=r+(n.x-r)*i,t.y=a+(n.y-a)*i,t.width=o+(n.width-o)*i,t.height=s+(n.height-s)*i,t},e.intersection=function(t,e,n){var i=e.x,r=e.y,a=e.x+e.width,o=e.y+e.height,s=n.x,c=n.y,l=n.x+n.width,u=n.y+n.height;return t.x=Math.max(i,s),t.y=Math.max(r,c),t.width=Math.min(a,l)-t.x,t.height=Math.min(o,u)-t.y,t},e.union=function(t,e,n){var i=e.x,r=e.y,a=e.width,o=e.height,s=n.x,c=n.y,l=n.width,u=n.height;return t.x=Math.min(i,s),t.y=Math.min(r,c),t.width=Math.max(i+a,s+l)-t.x,t.height=Math.max(r+o,c+u)-t.y,t};var n=e.prototype;return n.clone=function(){return new e(this.x,this.y,this.width,this.height)},n.set=function(t,e,n,i){return t&&"object"==typeof t?(this.y=t.y,this.width=t.width,this.height=t.height,this.x=t.x):(this.x=t||0,this.y=e||0,this.width=n||0,this.height=i||0),this},n.equals=function(t){return this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height},n.lerp=function(t,e){var n=this.x,i=this.y,r=this.width,a=this.height;return this.x=n+(t.x-n)*e,this.y=i+(t.y-i)*e,this.width=r+(t.width-r)*e,this.height=a+(t.height-a)*e,this},n.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.width.toFixed(2)+", "+this.height.toFixed(2)+")"},n.intersects=function(t){var e=this.x+this.width,n=this.y+this.height,i=t.x+t.width,r=t.y+t.height;return!(e<t.x||i<this.x||n<t.y||r<this.y)},n.contains=function(t){return this.x<=t.x&&this.x+this.width>=t.x&&this.y<=t.y&&this.y+this.height>=t.y},n.containsRect=function(t){return this.x<=t.x&&this.x+this.width>=t.x+t.width&&this.y<=t.y&&this.y+this.height>=t.y+t.height},n.transformMat4=function(t){var e=this.x,n=this.y,i=e+this.width,r=n+this.height,a=t.m00*e+t.m04*n+t.m12,o=t.m01*e+t.m05*n+t.m13,s=t.m00*i+t.m04*n+t.m12,c=t.m01*i+t.m05*n+t.m13,l=t.m00*e+t.m04*r+t.m12,u=t.m01*e+t.m05*r+t.m13,h=t.m00*i+t.m04*r+t.m12,f=t.m01*i+t.m05*r+t.m13,_=Math.min(a,s,l,h),p=Math.max(a,s,l,h),d=Math.min(o,c,u,f),m=Math.max(o,c,u,f);return this.x=_,this.y=d,this.width=p-_,this.height=m-d,this},n.transformMat4ToPoints=function(t,e,n,i,r){var a=this.x,o=this.y,s=a+this.width,c=o+this.height;e.x=t.m00*a+t.m04*o+t.m12,e.y=t.m01*a+t.m05*o+t.m13,r.x=t.m00*s+t.m04*o+t.m12,r.y=t.m01*s+t.m05*o+t.m13,n.x=t.m00*a+t.m04*c+t.m12,n.y=t.m01*a+t.m05*c+t.m13,i.x=t.m00*s+t.m04*c+t.m12,i.y=t.m01*s+t.m05*c+t.m13},L(e,[{key:"xMin",get:function(){return this.x},set:function(t){this.width+=this.x-t,this.x=t}},{key:"yMin",get:function(){return this.y},set:function(t){this.height+=this.y-t,this.y=t}},{key:"xMax",get:function(){return this.x+this.width},set:function(t){this.width=t-this.x}},{key:"yMax",get:function(){return this.y+this.height},set:function(t){this.height=t-this.y}},{key:"center",get:function(){return new Ni(this.x+.5*this.width,this.y+.5*this.height)},set:function(t){this.x=t.x-.5*this.width,this.y=t.y-.5*this.height}},{key:"origin",get:function(){return new Ni(this.x,this.y)},set:function(t){this.x=t.x,this.y=t.y}},{key:"size",get:function(){return new Gi(this.width,this.height)},set:function(t){this.width=t.width,this.height=t.height}},{key:"z",get:function(){return this.width},set:function(t){this.width=t}},{key:"w",get:function(){return this.height},set:function(t){this.height=t}}]),e}(Jt));function ji(t,e,n,i){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),new Vi(t,e,n,i)}Ge.fastDefine("cc.Rect",Vi,{x:0,y:0,width:0,height:0}),i.Rect=Vi,i.rect=ji;var Wi=t("MATH_FLOAT_ARRAY",Float64Array),Xi=t("MathBase",function(t){function e(){return t.apply(this,arguments)||this}return F(e,t),e.createFloatArray=function(t){return new Wi(t)},L(e,[{key:"array",get:function(){return this._array}}]),e}(Jt)),qi=Object.freeze({__proto__:null,bits:Mn,Vec2:Ni,v2:Fi,Vec3:di,v3:vi,Vec4:zi,v4:Ui,Quat:Ti,quat:Pi,Mat3:yi,Mat4:Ri,mat4:Mi,AffineTransform:ki,Size:Gi,size:Hi,Rect:Vi,rect:ji,Color:_i,color:pi,EPSILON:Wn,equals:Xn,approx:qn,clamp:Yn,clamp01:Kn,lerp:Qn,toRadian:Zn,toDegree:Jn,random:$n,randomRange:ti,randomRangeInt:ei,pseudoRandom:ni,pseudoRandomRange:ii,pseudoRandomRangeInt:ri,nextPow2:ai,repeat:oi,pingPong:si,inverseLerp:ci,absMaxComponent:li,absMax:ui,enumerableProps:hi,MATH_FLOAT_ARRAY:Wi,MathBase:Xi});t("math",qi);var Yi=function(){function t(){this._groundAlbedoHDR=new zi(.2,.2,.2,1),this._skyColorHDR=new zi(.2,.5,.8,1),this._skyIllumHDR=0,this._groundAlbedoLDR=new zi(.2,.2,.2,1),this._skyColorLDR=new zi(.2,.5,.8,1),this._skyIllumLDR=0,this._mipmapCount=1,this._enabled=!1}var e=t.prototype;return e.initialize=function(t){this._skyColorHDR=t.skyColorHDR,this._groundAlbedoHDR.set(t.groundAlbedoHDR),this._skyIllumHDR=t.skyIllumHDR,this._skyColorLDR=t.skyColorLDR,this._groundAlbedoLDR.set(t.groundAlbedoLDR),this._skyIllumLDR=t.skyIllumLDR},e._destroy=function(){},e.destroy=function(){this._destroy()},L(t,[{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled=t}},{key:"skyColor",get:function(){return i.director.root.pipeline.pipelineSceneData.isHDR?this._skyColorHDR:this._skyColorLDR},set:function(t){i.director.root.pipeline.pipelineSceneData.isHDR?this._skyColorHDR.set(t):this._skyColorLDR.set(t)}},{key:"skyIllum",get:function(){return i.director.root.pipeline.pipelineSceneData.isHDR?this._skyIllumHDR:this._skyIllumLDR},set:function(t){i.director.root.pipeline.pipelineSceneData.isHDR?this._skyIllumHDR=t:this._skyIllumLDR=t}},{key:"groundAlbedo",get:function(){return i.director.root.pipeline.pipelineSceneData.isHDR?this._groundAlbedoHDR:this._groundAlbedoLDR},set:function(t){i.director.root.pipeline.pipelineSceneData.isHDR?this._groundAlbedoHDR.set(t):this._groundAlbedoLDR.set(t)}},{key:"mipmapCount",get:function(){return this._mipmapCount},set:function(t){this._mipmapCount=t}},{key:"native",get:function(){return this._nativeObj}}]),t}();Yi.SUN_ILLUM=65e3,Yi.SKY_ILLUM=2e4,i.Ambient=Yi;var Ki=function(){function t(){this._enabled=!1,this._minPos=new di(0,0,0),this._maxPos=new di(0,0,0),this._depth=0}var e=t.prototype;return e.initialize=function(t){this._enabled=t.enabled,this._minPos=t.minPos,this._maxPos=t.maxPos,this._depth=t.depth},e._destroy=function(){},e.destroy=function(){this._destroy()},L(t,[{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled=t}},{key:"minPos",get:function(){return this._minPos},set:function(t){this._minPos=t}},{key:"maxPos",get:function(){return this._maxPos},set:function(t){this._maxPos=t}},{key:"depth",get:function(){return this._depth},set:function(t){this._depth=t}},{key:"native",get:function(){return this._nativeObj}}]),t}(),Qi=new di,Zi=new di,Ji=new di,$i=new di,tr=new di,er=new di,nr=new Array(3),ir=new Array(3);function rr(t,e){return di.dot(e.n,t)-e.d}function ar(t,e,n){return di.copy(t,e),di.subtract(tr,n.center,n.halfExtents),di.add(er,n.center,n.halfExtents),t.x=t.x<tr.x?tr.x:t.x,t.y=t.y<tr.y?tr.y:t.y,t.z=t.z<tr.z?tr.z:t.z,t.x=t.x>er.x?er.x:t.x,t.y=t.y>er.y?er.y:t.y,t.z=t.z>er.z?er.z:t.z,t}function or(t,e,n){di.set(Qi,n.orientation.m00,n.orientation.m01,n.orientation.m02),di.set(Zi,n.orientation.m03,n.orientation.m04,n.orientation.m05),di.set(Ji,n.orientation.m06,n.orientation.m07,n.orientation.m08),nr[0]=Qi,nr[1]=Zi,nr[2]=Ji,ir[0]=n.halfExtents.x,ir[1]=n.halfExtents.y,ir[2]=n.halfExtents.z,di.subtract($i,e,n.center),di.set(t,n.center.x,n.center.y,n.center.z);for(var i=0;i<3;i++){var r=di.dot($i,nr[i]);r>ir[i]&&(r=ir[i]),r<-ir[i]&&(r=-ir[i]),t.x+=r*nr[i].x,t.y+=r*nr[i].y,t.z+=r*nr[i].z}return t}var sr=Object.freeze({__proto__:null,point_plane:rr,pt_point_plane:function(t,e,n){var i=rr(e,n);return di.subtract(t,e,di.multiplyScalar(t,n.n,i))},pt_point_aabb:ar,pt_point_obb:or,pt_point_line:function(t,e,n,i){di.subtract(Qi,n,i);var r=Qi,a=di.lengthSqr(r);if(0==a)di.copy(t,n);else{di.subtract(Qi,e,n);var o=di.dot(Qi,r)/a;o<0?di.copy(t,n):o>1?di.copy(t,i):di.scaleAndAdd(t,n,r,o)}}}),cr={SHAPE_RAY:1,SHAPE_LINE:2,SHAPE_SPHERE:4,SHAPE_AABB:8,SHAPE_OBB:16,SHAPE_PLANE:32,SHAPE_TRIANGLE:64,SHAPE_FRUSTUM:128,SHAPE_FRUSTUM_ACCURATE:256,SHAPE_CAPSULE:512},lr=function(){function t(t,e,n,i,r,a){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===a&&(a=-1),this.s=void 0,this.e=void 0,this._type=void 0,this._type=cr.SHAPE_LINE,this.s=new di(t,e,n),this.e=new di(i,r,a)}return t.create=function(e,n,i,r,a,o){return new t(e,n,i,r,a,o)},t.clone=function(e){return new t(e.s.x,e.s.y,e.s.z,e.e.x,e.e.y,e.e.z)},t.copy=function(t,e){return di.copy(t.s,e.s),di.copy(t.e,e.e),t},t.fromPoints=function(t,e,n){return di.copy(t.s,e),di.copy(t.e,n),t},t.set=function(t,e,n,i,r,a,o){return t.s.x=e,t.s.y=n,t.s.z=i,t.e.x=r,t.e.y=a,t.e.z=o,t},t.len=function(t){return di.distance(t.s,t.e)},t.prototype.length=function(){return di.distance(this.s,this.e)},L(t,[{key:"type",get:function(){return this._type}}]),t}(),ur=function(){function t(t,e,n,i,r,a){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===a&&(a=-1),this.o=void 0,this.d=void 0,this._type=void 0,this._type=cr.SHAPE_RAY,this.o=new di(t,e,n),this.d=new di(i,r,a)}return t.create=function(e,n,i,r,a,o){return void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===a&&(a=0),void 0===o&&(o=1),new t(e,n,i,r,a,o)},t.clone=function(e){return new t(e.o.x,e.o.y,e.o.z,e.d.x,e.d.y,e.d.z)},t.copy=function(t,e){return di.copy(t.o,e.o),di.copy(t.d,e.d),t},t.fromPoints=function(t,e,n){return di.copy(t.o,e),di.normalize(t.d,di.subtract(t.d,n,e)),t},t.set=function(t,e,n,i,r,a,o){return t.o.x=e,t.o.y=n,t.o.z=i,t.d.x=r,t.d.y=a,t.d.z=o,t},t.prototype.computeHit=function(t,e){di.normalize(t,this.d),di.scaleAndAdd(t,this.o,t,e)},L(t,[{key:"type",get:function(){return this._type}}]),t}(),hr=new di,fr=new di,_r=new di,pr=new di;function dr(t){return Math.max(Math.max(t.x,t.y),t.z)}var mr,gr,vr,yr,xr,Sr,Tr,Ar,Er,Cr,br,wr,Pr,Ir,Rr,Dr,Or,Mr,Nr,Lr,Br,Fr,zr,Ur,kr,Gr,Hr,Vr,jr,Wr,Xr,qr,Yr,Kr,Qr,Zr,Jr,$r,ta,ea,na,ia=function(){function t(t,e,n,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=1),this._center=new di(0,0,0),this._radius=0,this._type=void 0,this._type=cr.SHAPE_SPHERE,this._center=new di(t,e,n),this._radius=i}t.create=function(e,n,i,r){return new t(e,n,i,r)},t.clone=function(e){return new t(e.center.x,e.center.y,e.center.z,e.radius)},t.copy=function(t,e){return di.copy(t.center,e.center),t.radius=e.radius,t},t.fromPoints=function(t,e,n){return di.multiplyScalar(t.center,di.add(hr,e,n),.5),t.radius=.5*di.subtract(hr,n,e).length(),t},t.set=function(t,e,n,i,r){return t.center.x=e,t.center.y=n,t.center.z=i,t.radius=r,t};var e=t.prototype;return e.destroy=function(){},e.clone=function(){return t.clone(this)},e.copy=function(e){return t.copy(this,e)},e.getBoundary=function(t,e){di.set(t,this.center.x-this.radius,this.center.y-this.radius,this.center.z-this.radius),di.set(e,this.center.x+this.radius,this.center.y+this.radius,this.center.z+this.radius)},e.transform=function(t,e,n,i,r){di.transformMat4(r.center,this.center,t),r.radius=this.radius*dr(i)},e.translateAndRotate=function(t,e,n){di.transformMat4(n.center,this.center,t)},e.setScale=function(t,e){e.radius=this.radius*dr(t)},e.mergePoint=function(t){this.radius<0&&(this.center.set(t),this.radius=0),di.subtract(fr,t,this.center);var e=fr.length();if(e>this.radius){var n=.5*(e-this.radius);this.radius+=n,di.multiplyScalar(fr,fr,n/e),di.add(this.center,this.center,fr)}},e.mergePoints=function(t){var e=t.length;if(!(e<1)){this.radius=-1;for(var n=0;n<e;n++)this.mergePoint(t[n])}},e.mergeAABB=function(t){t.getBoundary(_r,pr),this.mergePoint(_r),this.mergePoint(pr)},L(t,[{key:"center",get:function(){return this._center},set:function(t){this._center=t}},{key:"radius",get:function(){return this._radius},set:function(t){this._radius=t}},{key:"type",get:function(){return this._type}}]),t}(),ra=function(){function t(t,e,n,i,r,a,o,s,c){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=1),void 0===r&&(r=0),void 0===a&&(a=0),void 0===o&&(o=0),void 0===s&&(s=1),void 0===c&&(c=0),this.a=void 0,this.b=void 0,this.c=void 0,this._type=void 0,this._type=cr.SHAPE_TRIANGLE,this.a=new di(t,e,n),this.b=new di(i,r,a),this.c=new di(o,s,c)}return t.create=function(e,n,i,r,a,o,s,c,l){return void 0===e&&(e=1),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===a&&(a=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===c&&(c=0),void 0===l&&(l=1),new t(e,n,i,r,a,o,s,c,l)},t.clone=function(e){return new t(e.a.x,e.a.y,e.a.z,e.b.x,e.b.y,e.b.z,e.c.x,e.c.y,e.c.z)},t.copy=function(t,e){return di.copy(t.a,e.a),di.copy(t.b,e.b),di.copy(t.c,e.c),t},t.fromPoints=function(t,e,n,i){return di.copy(t.a,e),di.copy(t.b,n),di.copy(t.c,i),t},t.set=function(t,e,n,i,r,a,o,s,c,l){return t.a.x=e,t.a.y=n,t.a.z=i,t.b.x=r,t.b.y=a,t.b.z=o,t.c.x=s,t.c.y=c,t.c.z=l,t},L(t,[{key:"type",get:function(){return this._type}}]),t}(),aa=function(t,e,n){for(var i=0;i<e.length;++i)t.length<=i&&t.push(new n),t[i].copy(e[i]);t.length=e.length};!function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.SWAPCHAIN=1]="SWAPCHAIN",t[t.BUFFER=2]="BUFFER",t[t.TEXTURE=3]="TEXTURE",t[t.RENDER_PASS=4]="RENDER_PASS",t[t.FRAMEBUFFER=5]="FRAMEBUFFER",t[t.SAMPLER=6]="SAMPLER",t[t.SHADER=7]="SHADER",t[t.DESCRIPTOR_SET_LAYOUT=8]="DESCRIPTOR_SET_LAYOUT",t[t.PIPELINE_LAYOUT=9]="PIPELINE_LAYOUT",t[t.PIPELINE_STATE=10]="PIPELINE_STATE",t[t.DESCRIPTOR_SET=11]="DESCRIPTOR_SET",t[t.INPUT_ASSEMBLER=12]="INPUT_ASSEMBLER",t[t.COMMAND_BUFFER=13]="COMMAND_BUFFER",t[t.QUEUE=14]="QUEUE",t[t.QUERY_POOL=15]="QUERY_POOL",t[t.GLOBAL_BARRIER=16]="GLOBAL_BARRIER",t[t.TEXTURE_BARRIER=17]="TEXTURE_BARRIER",t[t.BUFFER_BARRIER=18]="BUFFER_BARRIER",t[t.COUNT=19]="COUNT"}(mr||(mr={})),function(t){t[t.UNREADY=0]="UNREADY",t[t.FAILED=1]="FAILED",t[t.SUCCESS=2]="SUCCESS"}(gr||(gr={})),function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.GLES2=1]="GLES2",t[t.GLES3=2]="GLES3",t[t.METAL=3]="METAL",t[t.VULKAN=4]="VULKAN",t[t.WEBGL=5]="WEBGL",t[t.WEBGL2=6]="WEBGL2",t[t.WEBGPU=7]="WEBGPU"}(vr||(vr={})),function(t){t[t.IDENTITY=0]="IDENTITY",t[t.ROTATE_90=1]="ROTATE_90",t[t.ROTATE_180=2]="ROTATE_180",t[t.ROTATE_270=3]="ROTATE_270"}(yr||(yr={})),function(t){t[t.COLOR_FLOAT=0]="COLOR_FLOAT",t[t.COLOR_HALF_FLOAT=1]="COLOR_HALF_FLOAT",t[t.TEXTURE_FLOAT=2]="TEXTURE_FLOAT",t[t.TEXTURE_HALF_FLOAT=3]="TEXTURE_HALF_FLOAT",t[t.TEXTURE_FLOAT_LINEAR=4]="TEXTURE_FLOAT_LINEAR",t[t.TEXTURE_HALF_FLOAT_LINEAR=5]="TEXTURE_HALF_FLOAT_LINEAR",t[t.FORMAT_R11G11B10F=6]="FORMAT_R11G11B10F",t[t.FORMAT_SRGB=7]="FORMAT_SRGB",t[t.FORMAT_ETC1=8]="FORMAT_ETC1",t[t.FORMAT_ETC2=9]="FORMAT_ETC2",t[t.FORMAT_DXT=10]="FORMAT_DXT",t[t.FORMAT_PVRTC=11]="FORMAT_PVRTC",t[t.FORMAT_ASTC=12]="FORMAT_ASTC",t[t.FORMAT_RGB8=13]="FORMAT_RGB8",t[t.ELEMENT_INDEX_UINT=14]="ELEMENT_INDEX_UINT",t[t.INSTANCED_ARRAYS=15]="INSTANCED_ARRAYS",t[t.MULTIPLE_RENDER_TARGETS=16]="MULTIPLE_RENDER_TARGETS",t[t.BLEND_MINMAX=17]="BLEND_MINMAX",t[t.COMPUTE_SHADER=18]="COMPUTE_SHADER",t[t.INPUT_ATTACHMENT_BENEFIT=19]="INPUT_ATTACHMENT_BENEFIT",t[t.COUNT=20]="COUNT"}(xr||(xr={})),function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.A8=1]="A8",t[t.L8=2]="L8",t[t.LA8=3]="LA8",t[t.R8=4]="R8",t[t.R8SN=5]="R8SN",t[t.R8UI=6]="R8UI",t[t.R8I=7]="R8I",t[t.R16F=8]="R16F",t[t.R16UI=9]="R16UI",t[t.R16I=10]="R16I",t[t.R32F=11]="R32F",t[t.R32UI=12]="R32UI",t[t.R32I=13]="R32I",t[t.RG8=14]="RG8",t[t.RG8SN=15]="RG8SN",t[t.RG8UI=16]="RG8UI",t[t.RG8I=17]="RG8I",t[t.RG16F=18]="RG16F",t[t.RG16UI=19]="RG16UI",t[t.RG16I=20]="RG16I",t[t.RG32F=21]="RG32F",t[t.RG32UI=22]="RG32UI",t[t.RG32I=23]="RG32I",t[t.RGB8=24]="RGB8",t[t.SRGB8=25]="SRGB8",t[t.RGB8SN=26]="RGB8SN",t[t.RGB8UI=27]="RGB8UI",t[t.RGB8I=28]="RGB8I",t[t.RGB16F=29]="RGB16F",t[t.RGB16UI=30]="RGB16UI",t[t.RGB16I=31]="RGB16I",t[t.RGB32F=32]="RGB32F",t[t.RGB32UI=33]="RGB32UI",t[t.RGB32I=34]="RGB32I",t[t.RGBA8=35]="RGBA8",t[t.BGRA8=36]="BGRA8",t[t.SRGB8_A8=37]="SRGB8_A8",t[t.RGBA8SN=38]="RGBA8SN",t[t.RGBA8UI=39]="RGBA8UI",t[t.RGBA8I=40]="RGBA8I",t[t.RGBA16F=41]="RGBA16F",t[t.RGBA16UI=42]="RGBA16UI",t[t.RGBA16I=43]="RGBA16I",t[t.RGBA32F=44]="RGBA32F",t[t.RGBA32UI=45]="RGBA32UI",t[t.RGBA32I=46]="RGBA32I",t[t.R5G6B5=47]="R5G6B5",t[t.R11G11B10F=48]="R11G11B10F",t[t.RGB5A1=49]="RGB5A1",t[t.RGBA4=50]="RGBA4",t[t.RGB10A2=51]="RGB10A2",t[t.RGB10A2UI=52]="RGB10A2UI",t[t.RGB9E5=53]="RGB9E5",t[t.DEPTH=54]="DEPTH",t[t.DEPTH_STENCIL=55]="DEPTH_STENCIL",t[t.BC1=56]="BC1",t[t.BC1_ALPHA=57]="BC1_ALPHA",t[t.BC1_SRGB=58]="BC1_SRGB",t[t.BC1_SRGB_ALPHA=59]="BC1_SRGB_ALPHA",t[t.BC2=60]="BC2",t[t.BC2_SRGB=61]="BC2_SRGB",t[t.BC3=62]="BC3",t[t.BC3_SRGB=63]="BC3_SRGB",t[t.BC4=64]="BC4",t[t.BC4_SNORM=65]="BC4_SNORM",t[t.BC5=66]="BC5",t[t.BC5_SNORM=67]="BC5_SNORM",t[t.BC6H_UF16=68]="BC6H_UF16",t[t.BC6H_SF16=69]="BC6H_SF16",t[t.BC7=70]="BC7",t[t.BC7_SRGB=71]="BC7_SRGB",t[t.ETC_RGB8=72]="ETC_RGB8",t[t.ETC2_RGB8=73]="ETC2_RGB8",t[t.ETC2_SRGB8=74]="ETC2_SRGB8",t[t.ETC2_RGB8_A1=75]="ETC2_RGB8_A1",t[t.ETC2_SRGB8_A1=76]="ETC2_SRGB8_A1",t[t.ETC2_RGBA8=77]="ETC2_RGBA8",t[t.ETC2_SRGB8_A8=78]="ETC2_SRGB8_A8",t[t.EAC_R11=79]="EAC_R11",t[t.EAC_R11SN=80]="EAC_R11SN",t[t.EAC_RG11=81]="EAC_RG11",t[t.EAC_RG11SN=82]="EAC_RG11SN",t[t.PVRTC_RGB2=83]="PVRTC_RGB2",t[t.PVRTC_RGBA2=84]="PVRTC_RGBA2",t[t.PVRTC_RGB4=85]="PVRTC_RGB4",t[t.PVRTC_RGBA4=86]="PVRTC_RGBA4",t[t.PVRTC2_2BPP=87]="PVRTC2_2BPP",t[t.PVRTC2_4BPP=88]="PVRTC2_4BPP",t[t.ASTC_RGBA_4X4=89]="ASTC_RGBA_4X4",t[t.ASTC_RGBA_5X4=90]="ASTC_RGBA_5X4",t[t.ASTC_RGBA_5X5=91]="ASTC_RGBA_5X5",t[t.ASTC_RGBA_6X5=92]="ASTC_RGBA_6X5",t[t.ASTC_RGBA_6X6=93]="ASTC_RGBA_6X6",t[t.ASTC_RGBA_8X5=94]="ASTC_RGBA_8X5",t[t.ASTC_RGBA_8X6=95]="ASTC_RGBA_8X6",t[t.ASTC_RGBA_8X8=96]="ASTC_RGBA_8X8",t[t.ASTC_RGBA_10X5=97]="ASTC_RGBA_10X5",t[t.ASTC_RGBA_10X6=98]="ASTC_RGBA_10X6",t[t.ASTC_RGBA_10X8=99]="ASTC_RGBA_10X8",t[t.ASTC_RGBA_10X10=100]="ASTC_RGBA_10X10",t[t.ASTC_RGBA_12X10=101]="ASTC_RGBA_12X10",t[t.ASTC_RGBA_12X12=102]="ASTC_RGBA_12X12",t[t.ASTC_SRGBA_4X4=103]="ASTC_SRGBA_4X4",t[t.ASTC_SRGBA_5X4=104]="ASTC_SRGBA_5X4",t[t.ASTC_SRGBA_5X5=105]="ASTC_SRGBA_5X5",t[t.ASTC_SRGBA_6X5=106]="ASTC_SRGBA_6X5",t[t.ASTC_SRGBA_6X6=107]="ASTC_SRGBA_6X6",t[t.ASTC_SRGBA_8X5=108]="ASTC_SRGBA_8X5",t[t.ASTC_SRGBA_8X6=109]="ASTC_SRGBA_8X6",t[t.ASTC_SRGBA_8X8=110]="ASTC_SRGBA_8X8",t[t.ASTC_SRGBA_10X5=111]="ASTC_SRGBA_10X5",t[t.ASTC_SRGBA_10X6=112]="ASTC_SRGBA_10X6",t[t.ASTC_SRGBA_10X8=113]="ASTC_SRGBA_10X8",t[t.ASTC_SRGBA_10X10=114]="ASTC_SRGBA_10X10",t[t.ASTC_SRGBA_12X10=115]="ASTC_SRGBA_12X10",t[t.ASTC_SRGBA_12X12=116]="ASTC_SRGBA_12X12",t[t.COUNT=117]="COUNT"}(Sr||(Sr={})),function(t){t[t.NONE=0]="NONE",t[t.UNORM=1]="UNORM",t[t.SNORM=2]="SNORM",t[t.UINT=3]="UINT",t[t.INT=4]="INT",t[t.UFLOAT=5]="UFLOAT",t[t.FLOAT=6]="FLOAT"}(Tr||(Tr={})),function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.BOOL=1]="BOOL",t[t.BOOL2=2]="BOOL2",t[t.BOOL3=3]="BOOL3",t[t.BOOL4=4]="BOOL4",t[t.INT=5]="INT",t[t.INT2=6]="INT2",t[t.INT3=7]="INT3",t[t.INT4=8]="INT4",t[t.UINT=9]="UINT",t[t.UINT2=10]="UINT2",t[t.UINT3=11]="UINT3",t[t.UINT4=12]="UINT4",t[t.FLOAT=13]="FLOAT",t[t.FLOAT2=14]="FLOAT2",t[t.FLOAT3=15]="FLOAT3",t[t.FLOAT4=16]="FLOAT4",t[t.MAT2=17]="MAT2",t[t.MAT2X3=18]="MAT2X3",t[t.MAT2X4=19]="MAT2X4",t[t.MAT3X2=20]="MAT3X2",t[t.MAT3=21]="MAT3",t[t.MAT3X4=22]="MAT3X4",t[t.MAT4X2=23]="MAT4X2",t[t.MAT4X3=24]="MAT4X3",t[t.MAT4=25]="MAT4",t[t.SAMPLER1D=26]="SAMPLER1D",t[t.SAMPLER1D_ARRAY=27]="SAMPLER1D_ARRAY",t[t.SAMPLER2D=28]="SAMPLER2D",t[t.SAMPLER2D_ARRAY=29]="SAMPLER2D_ARRAY",t[t.SAMPLER3D=30]="SAMPLER3D",t[t.SAMPLER_CUBE=31]="SAMPLER_CUBE",t[t.SAMPLER=32]="SAMPLER",t[t.TEXTURE1D=33]="TEXTURE1D",t[t.TEXTURE1D_ARRAY=34]="TEXTURE1D_ARRAY",t[t.TEXTURE2D=35]="TEXTURE2D",t[t.TEXTURE2D_ARRAY=36]="TEXTURE2D_ARRAY",t[t.TEXTURE3D=37]="TEXTURE3D",t[t.TEXTURE_CUBE=38]="TEXTURE_CUBE",t[t.IMAGE1D=39]="IMAGE1D",t[t.IMAGE1D_ARRAY=40]="IMAGE1D_ARRAY",t[t.IMAGE2D=41]="IMAGE2D",t[t.IMAGE2D_ARRAY=42]="IMAGE2D_ARRAY",t[t.IMAGE3D=43]="IMAGE3D",t[t.IMAGE_CUBE=44]="IMAGE_CUBE",t[t.SUBPASS_INPUT=45]="SUBPASS_INPUT",t[t.COUNT=46]="COUNT"}(Ar||(Ar={})),function(t){t[t.NONE=0]="NONE",t[t.TRANSFER_SRC=1]="TRANSFER_SRC",t[t.TRANSFER_DST=2]="TRANSFER_DST",t[t.INDEX=4]="INDEX",t[t.VERTEX=8]="VERTEX",t[t.UNIFORM=16]="UNIFORM",t[t.STORAGE=32]="STORAGE",t[t.INDIRECT=64]="INDIRECT"}(Er||(Er={})),function(t){t[t.NONE=0]="NONE"}(Cr||(Cr={})),function(t){t[t.NONE=0]="NONE",t[t.READ_ONLY=1]="READ_ONLY",t[t.WRITE_ONLY=2]="WRITE_ONLY",t[t.READ_WRITE=3]="READ_WRITE"}(br||(br={})),function(t){t[t.NONE=0]="NONE",t[t.DEVICE=1]="DEVICE",t[t.HOST=2]="HOST"}(wr||(wr={})),function(t){t[t.TEX1D=0]="TEX1D",t[t.TEX2D=1]="TEX2D",t[t.TEX3D=2]="TEX3D",t[t.CUBE=3]="CUBE",t[t.TEX1D_ARRAY=4]="TEX1D_ARRAY",t[t.TEX2D_ARRAY=5]="TEX2D_ARRAY"}(Pr||(Pr={})),function(t){t[t.NONE=0]="NONE",t[t.TRANSFER_SRC=1]="TRANSFER_SRC",t[t.TRANSFER_DST=2]="TRANSFER_DST",t[t.SAMPLED=4]="SAMPLED",t[t.STORAGE=8]="STORAGE",t[t.COLOR_ATTACHMENT=16]="COLOR_ATTACHMENT",t[t.DEPTH_STENCIL_ATTACHMENT=32]="DEPTH_STENCIL_ATTACHMENT",t[t.INPUT_ATTACHMENT=64]="INPUT_ATTACHMENT"}(Ir||(Ir={})),function(t){t[t.NONE=0]="NONE",t[t.GEN_MIPMAP=1]="GEN_MIPMAP",t[t.GENERAL_LAYOUT=2]="GENERAL_LAYOUT"}(Rr||(Rr={})),function(t){t[t.ONE=0]="ONE",t[t.MULTIPLE_PERFORMANCE=1]="MULTIPLE_PERFORMANCE",t[t.MULTIPLE_BALANCE=2]="MULTIPLE_BALANCE",t[t.MULTIPLE_QUALITY=3]="MULTIPLE_QUALITY"}(Dr||(Dr={})),function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON",t[t.RELAXED=2]="RELAXED",t[t.MAILBOX=3]="MAILBOX",t[t.HALF=4]="HALF"}(Or||(Or={})),function(t){t[t.NONE=0]="NONE",t[t.POINT=1]="POINT",t[t.LINEAR=2]="LINEAR",t[t.ANISOTROPIC=3]="ANISOTROPIC"}(Mr||(Mr={})),function(t){t[t.WRAP=0]="WRAP",t[t.MIRROR=1]="MIRROR",t[t.CLAMP=2]="CLAMP",t[t.BORDER=3]="BORDER"}(Nr||(Nr={})),function(t){t[t.NEVER=0]="NEVER",t[t.LESS=1]="LESS",t[t.EQUAL=2]="EQUAL",t[t.LESS_EQUAL=3]="LESS_EQUAL",t[t.GREATER=4]="GREATER",t[t.NOT_EQUAL=5]="NOT_EQUAL",t[t.GREATER_EQUAL=6]="GREATER_EQUAL",t[t.ALWAYS=7]="ALWAYS"}(Lr||(Lr={})),function(t){t[t.ZERO=0]="ZERO",t[t.KEEP=1]="KEEP",t[t.REPLACE=2]="REPLACE",t[t.INCR=3]="INCR",t[t.DECR=4]="DECR",t[t.INVERT=5]="INVERT",t[t.INCR_WRAP=6]="INCR_WRAP",t[t.DECR_WRAP=7]="DECR_WRAP"}(Br||(Br={})),function(t){t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_ALPHA=2]="SRC_ALPHA",t[t.DST_ALPHA=3]="DST_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=4]="ONE_MINUS_SRC_ALPHA",t[t.ONE_MINUS_DST_ALPHA=5]="ONE_MINUS_DST_ALPHA",t[t.SRC_COLOR=6]="SRC_COLOR",t[t.DST_COLOR=7]="DST_COLOR",t[t.ONE_MINUS_SRC_COLOR=8]="ONE_MINUS_SRC_COLOR",t[t.ONE_MINUS_DST_COLOR=9]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=10]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=11]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=12]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=13]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=14]="ONE_MINUS_CONSTANT_ALPHA"}(Fr||(Fr={})),function(t){t[t.ADD=0]="ADD",t[t.SUB=1]="SUB",t[t.REV_SUB=2]="REV_SUB",t[t.MIN=3]="MIN",t[t.MAX=4]="MAX"}(zr||(zr={})),function(t){t[t.NONE=0]="NONE",t[t.R=1]="R",t[t.G=2]="G",t[t.B=4]="B",t[t.A=8]="A",t[t.ALL=15]="ALL"}(Ur||(Ur={})),function(t){t[t.NONE=0]="NONE",t[t.VERTEX=1]="VERTEX",t[t.CONTROL=2]="CONTROL",t[t.EVALUATION=4]="EVALUATION",t[t.GEOMETRY=8]="GEOMETRY",t[t.FRAGMENT=16]="FRAGMENT",t[t.COMPUTE=32]="COMPUTE",t[t.ALL=63]="ALL"}(kr||(kr={})),function(t){t[t.LOAD=0]="LOAD",t[t.CLEAR=1]="CLEAR",t[t.DISCARD=2]="DISCARD"}(Gr||(Gr={})),function(t){t[t.STORE=0]="STORE",t[t.DISCARD=1]="DISCARD"}(Hr||(Hr={})),function(t){t[t.NONE=0]="NONE",t[t.INDIRECT_BUFFER=1]="INDIRECT_BUFFER",t[t.INDEX_BUFFER=2]="INDEX_BUFFER",t[t.VERTEX_BUFFER=3]="VERTEX_BUFFER",t[t.VERTEX_SHADER_READ_UNIFORM_BUFFER=4]="VERTEX_SHADER_READ_UNIFORM_BUFFER",t[t.VERTEX_SHADER_READ_TEXTURE=5]="VERTEX_SHADER_READ_TEXTURE",t[t.VERTEX_SHADER_READ_OTHER=6]="VERTEX_SHADER_READ_OTHER",t[t.FRAGMENT_SHADER_READ_UNIFORM_BUFFER=7]="FRAGMENT_SHADER_READ_UNIFORM_BUFFER",t[t.FRAGMENT_SHADER_READ_TEXTURE=8]="FRAGMENT_SHADER_READ_TEXTURE",t[t.FRAGMENT_SHADER_READ_COLOR_INPUT_ATTACHMENT=9]="FRAGMENT_SHADER_READ_COLOR_INPUT_ATTACHMENT",t[t.FRAGMENT_SHADER_READ_DEPTH_STENCIL_INPUT_ATTACHMENT=10]="FRAGMENT_SHADER_READ_DEPTH_STENCIL_INPUT_ATTACHMENT",t[t.FRAGMENT_SHADER_READ_OTHER=11]="FRAGMENT_SHADER_READ_OTHER",t[t.COLOR_ATTACHMENT_READ=12]="COLOR_ATTACHMENT_READ",t[t.DEPTH_STENCIL_ATTACHMENT_READ=13]="DEPTH_STENCIL_ATTACHMENT_READ",t[t.COMPUTE_SHADER_READ_UNIFORM_BUFFER=14]="COMPUTE_SHADER_READ_UNIFORM_BUFFER",t[t.COMPUTE_SHADER_READ_TEXTURE=15]="COMPUTE_SHADER_READ_TEXTURE",t[t.COMPUTE_SHADER_READ_OTHER=16]="COMPUTE_SHADER_READ_OTHER",t[t.TRANSFER_READ=17]="TRANSFER_READ",t[t.HOST_READ=18]="HOST_READ",t[t.PRESENT=19]="PRESENT",t[t.VERTEX_SHADER_WRITE=20]="VERTEX_SHADER_WRITE",t[t.FRAGMENT_SHADER_WRITE=21]="FRAGMENT_SHADER_WRITE",t[t.COLOR_ATTACHMENT_WRITE=22]="COLOR_ATTACHMENT_WRITE",t[t.DEPTH_STENCIL_ATTACHMENT_WRITE=23]="DEPTH_STENCIL_ATTACHMENT_WRITE",t[t.COMPUTE_SHADER_WRITE=24]="COMPUTE_SHADER_WRITE",t[t.TRANSFER_WRITE=25]="TRANSFER_WRITE",t[t.HOST_PREINITIALIZED=26]="HOST_PREINITIALIZED",t[t.HOST_WRITE=27]="HOST_WRITE"}(Vr||(Vr={})),function(t){t[t.NONE=0]="NONE",t[t.SAMPLE_ZERO=1]="SAMPLE_ZERO",t[t.AVERAGE=2]="AVERAGE",t[t.MIN=3]="MIN",t[t.MAX=4]="MAX"}(jr||(jr={})),function(t){t[t.GRAPHICS=0]="GRAPHICS",t[t.COMPUTE=1]="COMPUTE",t[t.RAY_TRACING=2]="RAY_TRACING"}(Wr||(Wr={})),function(t){t[t.POINT_LIST=0]="POINT_LIST",t[t.LINE_LIST=1]="LINE_LIST",t[t.LINE_STRIP=2]="LINE_STRIP",t[t.LINE_LOOP=3]="LINE_LOOP",t[t.LINE_LIST_ADJACENCY=4]="LINE_LIST_ADJACENCY",t[t.LINE_STRIP_ADJACENCY=5]="LINE_STRIP_ADJACENCY",t[t.ISO_LINE_LIST=6]="ISO_LINE_LIST",t[t.TRIANGLE_LIST=7]="TRIANGLE_LIST",t[t.TRIANGLE_STRIP=8]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=9]="TRIANGLE_FAN",t[t.TRIANGLE_LIST_ADJACENCY=10]="TRIANGLE_LIST_ADJACENCY",t[t.TRIANGLE_STRIP_ADJACENCY=11]="TRIANGLE_STRIP_ADJACENCY",t[t.TRIANGLE_PATCH_ADJACENCY=12]="TRIANGLE_PATCH_ADJACENCY",t[t.QUAD_PATCH_LIST=13]="QUAD_PATCH_LIST"}(Xr||(Xr={})),function(t){t[t.FILL=0]="FILL",t[t.POINT=1]="POINT",t[t.LINE=2]="LINE"}(qr||(qr={})),function(t){t[t.GOURAND=0]="GOURAND",t[t.FLAT=1]="FLAT"}(Yr||(Yr={})),function(t){t[t.NONE=0]="NONE",t[t.FRONT=1]="FRONT",t[t.BACK=2]="BACK"}(Kr||(Kr={})),function(t){t[t.NONE=0]="NONE",t[t.LINE_WIDTH=1]="LINE_WIDTH",t[t.DEPTH_BIAS=2]="DEPTH_BIAS",t[t.BLEND_CONSTANTS=4]="BLEND_CONSTANTS",t[t.DEPTH_BOUNDS=8]="DEPTH_BOUNDS",t[t.STENCIL_WRITE_MASK=16]="STENCIL_WRITE_MASK",t[t.STENCIL_COMPARE_MASK=32]="STENCIL_COMPARE_MASK"}(Qr||(Qr={})),function(t){t[t.FRONT=1]="FRONT",t[t.BACK=2]="BACK",t[t.ALL=3]="ALL"}(Zr||(Zr={})),function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.UNIFORM_BUFFER=1]="UNIFORM_BUFFER",t[t.DYNAMIC_UNIFORM_BUFFER=2]="DYNAMIC_UNIFORM_BUFFER",t[t.STORAGE_BUFFER=4]="STORAGE_BUFFER",t[t.DYNAMIC_STORAGE_BUFFER=8]="DYNAMIC_STORAGE_BUFFER",t[t.SAMPLER_TEXTURE=16]="SAMPLER_TEXTURE",t[t.SAMPLER=32]="SAMPLER",t[t.TEXTURE=64]="TEXTURE",t[t.STORAGE_IMAGE=128]="STORAGE_IMAGE",t[t.INPUT_ATTACHMENT=256]="INPUT_ATTACHMENT"}(Jr||(Jr={})),function(t){t[t.GRAPHICS=0]="GRAPHICS",t[t.COMPUTE=1]="COMPUTE",t[t.TRANSFER=2]="TRANSFER"}($r||($r={})),function(t){t[t.OCCLUSION=0]="OCCLUSION",t[t.PIPELINE_STATISTICS=1]="PIPELINE_STATISTICS",t[t.TIMESTAMP=2]="TIMESTAMP"}(ta||(ta={})),function(t){t[t.PRIMARY=0]="PRIMARY",t[t.SECONDARY=1]="SECONDARY"}(ea||(ea={})),function(t){t[t.NONE=0]="NONE",t[t.COLOR=1]="COLOR",t[t.DEPTH=2]="DEPTH",t[t.STENCIL=4]="STENCIL",t[t.DEPTH_STENCIL=6]="DEPTH_STENCIL",t[t.ALL=7]="ALL"}(na||(na={}));var oa,sa=function(){function t(t,e,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),this.x=t,this.y=e,this.z=n}return t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},t}(),ca=function(){function t(t,e,n,i,r,a,o,s,c,l,u,h,f,_,p,d,m,g,v,y,x,S){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===a&&(a=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===c&&(c=0),void 0===l&&(l=0),void 0===u&&(u=0),void 0===h&&(h=0),void 0===f&&(f=0),void 0===_&&(_=1),void 0===p&&(p=0),void 0===d&&(d=0),void 0===m&&(m=new sa),void 0===g&&(g=new sa),void 0===v&&(v=!1),void 0===y&&(y=-1),void 0===x&&(x=1),void 0===S&&(S=1),this.maxVertexAttributes=t,this.maxVertexUniformVectors=e,this.maxFragmentUniformVectors=n,this.maxTextureUnits=i,this.maxImageUnits=r,this.maxVertexTextureUnits=a,this.maxColorRenderTargets=o,this.maxShaderStorageBufferBindings=s,this.maxShaderStorageBlockSize=c,this.maxUniformBufferBindings=l,this.maxUniformBlockSize=u,this.maxTextureSize=h,this.maxCubeMapTextureSize=f,this.uboOffsetAlignment=_,this.maxComputeSharedMemorySize=p,this.maxComputeWorkGroupInvocations=d,this.maxComputeWorkGroupSize=m,this.maxComputeWorkGroupCount=g,this.supportQuery=v,this.clipSpaceMinZ=y,this.screenSpaceSignY=x,this.clipSpaceSignY=S}return t.prototype.copy=function(t){return this.maxVertexAttributes=t.maxVertexAttributes,this.maxVertexUniformVectors=t.maxVertexUniformVectors,this.maxFragmentUniformVectors=t.maxFragmentUniformVectors,this.maxTextureUnits=t.maxTextureUnits,this.maxImageUnits=t.maxImageUnits,this.maxVertexTextureUnits=t.maxVertexTextureUnits,this.maxColorRenderTargets=t.maxColorRenderTargets,this.maxShaderStorageBufferBindings=t.maxShaderStorageBufferBindings,this.maxShaderStorageBlockSize=t.maxShaderStorageBlockSize,this.maxUniformBufferBindings=t.maxUniformBufferBindings,this.maxUniformBlockSize=t.maxUniformBlockSize,this.maxTextureSize=t.maxTextureSize,this.maxCubeMapTextureSize=t.maxCubeMapTextureSize,this.uboOffsetAlignment=t.uboOffsetAlignment,this.maxComputeSharedMemorySize=t.maxComputeSharedMemorySize,this.maxComputeWorkGroupInvocations=t.maxComputeWorkGroupInvocations,this.maxComputeWorkGroupSize.copy(t.maxComputeWorkGroupSize),this.maxComputeWorkGroupCount.copy(t.maxComputeWorkGroupCount),this.supportQuery=t.supportQuery,this.clipSpaceMinZ=t.clipSpaceMinZ,this.screenSpaceSignY=t.screenSpaceSignY,this.clipSpaceSignY=t.clipSpaceSignY,this},t}(),la=function(){function t(t,e,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),this.x=t,this.y=e,this.z=n}return t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},t}(),ua=function(){function t(t,e,n,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),this.x=t,this.y=e,this.width=n,this.height=i}return t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this},t}(),ha=function(){function t(t,e,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=1),this.width=t,this.height=e,this.depth=n}return t.prototype.copy=function(t){return this.width=t.width,this.height=t.height,this.depth=t.depth,this},t}(),fa=function(){function t(t,e,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=1),this.mipLevel=t,this.baseArrayLayer=e,this.layerCount=n}return t.prototype.copy=function(t){return this.mipLevel=t.mipLevel,this.baseArrayLayer=t.baseArrayLayer,this.layerCount=t.layerCount,this},t}(),_a=function(){function t(t,e,n,i){void 0===t&&(t=0),void 0===e&&(e=1),void 0===n&&(n=0),void 0===i&&(i=1),this.baseMipLevel=t,this.levelCount=e,this.baseArrayLayer=n,this.layerCount=i}return t.prototype.copy=function(t){return this.baseMipLevel=t.baseMipLevel,this.levelCount=t.levelCount,this.baseArrayLayer=t.baseArrayLayer,this.layerCount=t.layerCount,this},t}(),pa=function(){function t(t,e,n,i,r){void 0===t&&(t=new fa),void 0===e&&(e=new la),void 0===n&&(n=new fa),void 0===i&&(i=new la),void 0===r&&(r=new ha),this.srcSubres=t,this.srcOffset=e,this.dstSubres=n,this.dstOffset=i,this.extent=r}return t.prototype.copy=function(t){return this.srcSubres.copy(t.srcSubres),this.srcOffset.copy(t.srcOffset),this.dstSubres.copy(t.dstSubres),this.dstOffset.copy(t.dstOffset),this.extent.copy(t.extent),this},t}(),da=function(){function t(t,e,n,i,r,a){void 0===t&&(t=new fa),void 0===e&&(e=new la),void 0===n&&(n=new ha),void 0===i&&(i=new fa),void 0===r&&(r=new la),void 0===a&&(a=new ha),this.srcSubres=t,this.srcOffset=e,this.srcExtent=n,this.dstSubres=i,this.dstOffset=r,this.dstExtent=a}return t.prototype.copy=function(t){return this.srcSubres.copy(t.srcSubres),this.srcOffset.copy(t.srcOffset),this.srcExtent.copy(t.srcExtent),this.dstSubres.copy(t.dstSubres),this.dstOffset.copy(t.dstOffset),this.dstExtent.copy(t.dstExtent),this},t}(),ma=function(){function t(t,e,n,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=new la),void 0===i&&(i=new ha),void 0===r&&(r=new fa),this.buffStride=t,this.buffTexHeight=e,this.texOffset=n,this.texExtent=i,this.texSubres=r}return t.prototype.copy=function(t){return this.buffStride=t.buffStride,this.buffTexHeight=t.buffTexHeight,this.texOffset.copy(t.texOffset),this.texExtent.copy(t.texExtent),this.texSubres.copy(t.texSubres),this},t}(),ga=function(){function t(t,e,n,i,r,a){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===a&&(a=1),this.left=t,this.top=e,this.width=n,this.height=i,this.minDepth=r,this.maxDepth=a}return t.prototype.copy=function(t){return this.left=t.left,this.top=t.top,this.width=t.width,this.height=t.height,this.minDepth=t.minDepth,this.maxDepth=t.maxDepth,this},t}(),va=function(){function t(t,e,n,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),this.x=t,this.y=e,this.z=n,this.w=i}return t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},t}(),ya=function(){function t(t,e,n){void 0===t&&(t=[]),void 0===e&&(e=[]),void 0===n&&(n=0),this.bufferOffsets=t,this.samplerOffsets=e,this.flexibleSet=n}return t.prototype.copy=function(t){return this.bufferOffsets=t.bufferOffsets.slice(),this.samplerOffsets=t.samplerOffsets.slice(),this.flexibleSet=t.flexibleSet,this},t}(),xa=function(){function t(t,e,n,i){void 0===t&&(t=null),void 0===e&&(e=Or.ON),void 0===n&&(n=0),void 0===i&&(i=0),this.windowHandle=t,this.vsyncMode=e,this.width=n,this.height=i}return t.prototype.copy=function(t){return this.windowHandle=t.windowHandle,this.vsyncMode=t.vsyncMode,this.width=t.width,this.height=t.height,this},t}(),Sa=function(){function t(t){void 0===t&&(t=new ya),this.bindingMappingInfo=t}return t.prototype.copy=function(t){return this.bindingMappingInfo.copy(t.bindingMappingInfo),this},t}(),Ta=function(){function t(t,e,n,i,r){void 0===t&&(t=Er.NONE),void 0===e&&(e=wr.NONE),void 0===n&&(n=0),void 0===i&&(i=1),void 0===r&&(r=Cr.NONE),this.usage=t,this.memUsage=e,this.size=n,this.stride=i,this.flags=r}return t.prototype.copy=function(t){return this.usage=t.usage,this.memUsage=t.memUsage,this.size=t.size,this.stride=t.stride,this.flags=t.flags,this},t}(),Aa=function(){function t(t,e,n){void 0===t&&(t=null),void 0===e&&(e=0),void 0===n&&(n=0),this.buffer=t,this.offset=e,this.range=n}return t.prototype.copy=function(t){return this.buffer=t.buffer,this.offset=t.offset,this.range=t.range,this},t}(),Ea=function(){function t(t,e,n,i,r,a,o){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===a&&(a=0),void 0===o&&(o=0),this.vertexCount=t,this.firstVertex=e,this.indexCount=n,this.firstIndex=i,this.vertexOffset=r,this.instanceCount=a,this.firstInstance=o}return t.prototype.copy=function(t){return this.vertexCount=t.vertexCount,this.firstVertex=t.firstVertex,this.indexCount=t.indexCount,this.firstIndex=t.firstIndex,this.vertexOffset=t.vertexOffset,this.instanceCount=t.instanceCount,this.firstInstance=t.firstInstance,this},t}(),Ca=function(){function t(t,e,n,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=null),void 0===r&&(r=0),this.groupCountX=t,this.groupCountY=e,this.groupCountZ=n,this.indirectBuffer=i,this.indirectOffset=r}return t.prototype.copy=function(t){return this.groupCountX=t.groupCountX,this.groupCountY=t.groupCountY,this.groupCountZ=t.groupCountZ,this.indirectBuffer=t.indirectBuffer,this.indirectOffset=t.indirectOffset,this},t}(),ba=function(){function t(t){void 0===t&&(t=[]),this.drawInfos=t}return t.prototype.copy=function(t){return aa(this.drawInfos,t.drawInfos,Ea),this},t}(),wa=function(){function t(t,e,n,i,r,a,o,s,c,l,u){void 0===t&&(t=Pr.TEX2D),void 0===e&&(e=Ir.NONE),void 0===n&&(n=Sr.UNKNOWN),void 0===i&&(i=0),void 0===r&&(r=0),void 0===a&&(a=Rr.NONE),void 0===o&&(o=1),void 0===s&&(s=1),void 0===c&&(c=Dr.ONE),void 0===l&&(l=1),void 0===u&&(u=0),this.type=t,this.usage=e,this.format=n,this.width=i,this.height=r,this.flags=a,this.layerCount=o,this.levelCount=s,this.samples=c,this.depth=l,this.externalRes=u}return t.prototype.copy=function(t){return this.type=t.type,this.usage=t.usage,this.format=t.format,this.width=t.width,this.height=t.height,this.flags=t.flags,this.layerCount=t.layerCount,this.levelCount=t.levelCount,this.samples=t.samples,this.depth=t.depth,this.externalRes=t.externalRes,this},t}(),Pa=function(){function t(t,e,n,i,r,a,o){void 0===t&&(t=null),void 0===e&&(e=Pr.TEX2D),void 0===n&&(n=Sr.UNKNOWN),void 0===i&&(i=0),void 0===r&&(r=1),void 0===a&&(a=0),void 0===o&&(o=1),this.texture=t,this.type=e,this.format=n,this.baseLevel=i,this.levelCount=r,this.baseLayer=a,this.layerCount=o}return t.prototype.copy=function(t){return this.texture=t.texture,this.type=t.type,this.format=t.format,this.baseLevel=t.baseLevel,this.levelCount=t.levelCount,this.baseLayer=t.baseLayer,this.layerCount=t.layerCount,this},t}(),Ia=function(){function t(t,e,n,i,r,a,o,s){void 0===t&&(t=Mr.LINEAR),void 0===e&&(e=Mr.LINEAR),void 0===n&&(n=Mr.NONE),void 0===i&&(i=Nr.WRAP),void 0===r&&(r=Nr.WRAP),void 0===a&&(a=Nr.WRAP),void 0===o&&(o=0),void 0===s&&(s=Lr.ALWAYS),this.minFilter=t,this.magFilter=e,this.mipFilter=n,this.addressU=i,this.addressV=r,this.addressW=a,this.maxAnisotropy=o,this.cmpFunc=s}return t.prototype.copy=function(t){return this.minFilter=t.minFilter,this.magFilter=t.magFilter,this.mipFilter=t.mipFilter,this.addressU=t.addressU,this.addressV=t.addressV,this.addressW=t.addressW,this.maxAnisotropy=t.maxAnisotropy,this.cmpFunc=t.cmpFunc,this},t}(),Ra=function(){function t(t,e,n){void 0===t&&(t=""),void 0===e&&(e=Ar.UNKNOWN),void 0===n&&(n=0),this.name=t,this.type=e,this.count=n}return t.prototype.copy=function(t){return this.name=t.name,this.type=t.type,this.count=t.count,this},t}(),Da=function(){function t(t,e,n,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=""),void 0===i&&(i=[]),void 0===r&&(r=0),this.set=t,this.binding=e,this.name=n,this.members=i,this.count=r}return t.prototype.copy=function(t){return this.set=t.set,this.binding=t.binding,this.name=t.name,aa(this.members,t.members,Ra),this.count=t.count,this},t}(),Oa=function(){function t(t,e,n,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=""),void 0===i&&(i=Ar.UNKNOWN),void 0===r&&(r=0),this.set=t,this.binding=e,this.name=n,this.type=i,this.count=r}return t.prototype.copy=function(t){return this.set=t.set,this.binding=t.binding,this.name=t.name,this.type=t.type,this.count=t.count,this},t}(),Ma=function(){function t(t,e,n,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=""),void 0===i&&(i=0),this.set=t,this.binding=e,this.name=n,this.count=i}return t.prototype.copy=function(t){return this.set=t.set,this.binding=t.binding,this.name=t.name,this.count=t.count,this},t}(),Na=function(){function t(t,e,n,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=""),void 0===i&&(i=Ar.UNKNOWN),void 0===r&&(r=0),this.set=t,this.binding=e,this.name=n,this.type=i,this.count=r}return t.prototype.copy=function(t){return this.set=t.set,this.binding=t.binding,this.name=t.name,this.type=t.type,this.count=t.count,this},t}(),La=function(){function t(t,e,n,i,r,a){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=""),void 0===i&&(i=Ar.UNKNOWN),void 0===r&&(r=0),void 0===a&&(a=br.READ_WRITE),this.set=t,this.binding=e,this.name=n,this.type=i,this.count=r,this.memoryAccess=a}return t.prototype.copy=function(t){return this.set=t.set,this.binding=t.binding,this.name=t.name,this.type=t.type,this.count=t.count,this.memoryAccess=t.memoryAccess,this},t}(),Ba=function(){function t(t,e,n,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=""),void 0===i&&(i=0),void 0===r&&(r=br.READ_WRITE),this.set=t,this.binding=e,this.name=n,this.count=i,this.memoryAccess=r}return t.prototype.copy=function(t){return this.set=t.set,this.binding=t.binding,this.name=t.name,this.count=t.count,this.memoryAccess=t.memoryAccess,this},t}(),Fa=function(){function t(t,e,n,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=""),void 0===i&&(i=0),this.set=t,this.binding=e,this.name=n,this.count=i}return t.prototype.copy=function(t){return this.set=t.set,this.binding=t.binding,this.name=t.name,this.count=t.count,this},t}(),za=function(){function t(t,e){void 0===t&&(t=kr.NONE),void 0===e&&(e=""),this.stage=t,this.source=e}return t.prototype.copy=function(t){return this.stage=t.stage,this.source=t.source,this},t}(),Ua=function(){function t(t,e,n,i,r,a){void 0===t&&(t=""),void 0===e&&(e=Sr.UNKNOWN),void 0===n&&(n=!1),void 0===i&&(i=0),void 0===r&&(r=!1),void 0===a&&(a=0),this.name=t,this.format=e,this.isNormalized=n,this.stream=i,this.isInstanced=r,this.location=a}return t.prototype.copy=function(t){return this.name=t.name,this.format=t.format,this.isNormalized=t.isNormalized,this.stream=t.stream,this.isInstanced=t.isInstanced,this.location=t.location,this},t}(),ka=function(){function t(t,e,n,i,r,a,o,s,c,l){void 0===t&&(t=""),void 0===e&&(e=[]),void 0===n&&(n=[]),void 0===i&&(i=[]),void 0===r&&(r=[]),void 0===a&&(a=[]),void 0===o&&(o=[]),void 0===s&&(s=[]),void 0===c&&(c=[]),void 0===l&&(l=[]),this.name=t,this.stages=e,this.attributes=n,this.blocks=i,this.buffers=r,this.samplerTextures=a,this.samplers=o,this.textures=s,this.images=c,this.subpassInputs=l}return t.prototype.copy=function(t){return this.name=t.name,aa(this.stages,t.stages,za),aa(this.attributes,t.attributes,Ua),aa(this.blocks,t.blocks,Da),aa(this.buffers,t.buffers,Ba),aa(this.samplerTextures,t.samplerTextures,Oa),aa(this.samplers,t.samplers,Ma),aa(this.textures,t.textures,Na),aa(this.images,t.images,La),aa(this.subpassInputs,t.subpassInputs,Fa),this},t}(),Ga=function(){function t(t,e,n,i){void 0===t&&(t=[]),void 0===e&&(e=[]),void 0===n&&(n=null),void 0===i&&(i=null),this.attributes=t,this.vertexBuffers=e,this.indexBuffer=n,this.indirectBuffer=i}return t.prototype.copy=function(t){return aa(this.attributes,t.attributes,Ua),this.vertexBuffers=t.vertexBuffers.slice(),this.indexBuffer=t.indexBuffer,this.indirectBuffer=t.indirectBuffer,this},t}(),Ha=function(){function t(t,e,n,i,r,a,o){void 0===t&&(t=Sr.UNKNOWN),void 0===e&&(e=Dr.ONE),void 0===n&&(n=Gr.CLEAR),void 0===i&&(i=Hr.STORE),void 0===r&&(r=[]),void 0===a&&(a=[Vr.COLOR_ATTACHMENT_WRITE]),void 0===o&&(o=!1),this.format=t,this.sampleCount=e,this.loadOp=n,this.storeOp=i,this.beginAccesses=r,this.endAccesses=a,this.isGeneralLayout=o}return t.prototype.copy=function(t){return this.format=t.format,this.sampleCount=t.sampleCount,this.loadOp=t.loadOp,this.storeOp=t.storeOp,this.beginAccesses=t.beginAccesses.slice(),this.endAccesses=t.endAccesses.slice(),this.isGeneralLayout=t.isGeneralLayout,this},t}(),Va=function(){function t(t,e,n,i,r,a,o,s,c){void 0===t&&(t=Sr.UNKNOWN),void 0===e&&(e=Dr.ONE),void 0===n&&(n=Gr.CLEAR),void 0===i&&(i=Hr.STORE),void 0===r&&(r=Gr.CLEAR),void 0===a&&(a=Hr.STORE),void 0===o&&(o=[]),void 0===s&&(s=[Vr.DEPTH_STENCIL_ATTACHMENT_WRITE]),void 0===c&&(c=!1),this.format=t,this.sampleCount=e,this.depthLoadOp=n,this.depthStoreOp=i,this.stencilLoadOp=r,this.stencilStoreOp=a,this.beginAccesses=o,this.endAccesses=s,this.isGeneralLayout=c}return t.prototype.copy=function(t){return this.format=t.format,this.sampleCount=t.sampleCount,this.depthLoadOp=t.depthLoadOp,this.depthStoreOp=t.depthStoreOp,this.stencilLoadOp=t.stencilLoadOp,this.stencilStoreOp=t.stencilStoreOp,this.beginAccesses=t.beginAccesses.slice(),this.endAccesses=t.endAccesses.slice(),this.isGeneralLayout=t.isGeneralLayout,this},t}(),ja=function(){function t(t,e,n,i,r,a,o,s){void 0===t&&(t=[]),void 0===e&&(e=[]),void 0===n&&(n=[]),void 0===i&&(i=[]),void 0===r&&(r=-1),void 0===a&&(a=-1),void 0===o&&(o=jr.NONE),void 0===s&&(s=jr.NONE),this.inputs=t,this.colors=e,this.resolves=n,this.preserves=i,this.depthStencil=r,this.depthStencilResolve=a,this.depthResolveMode=o,this.stencilResolveMode=s}return t.prototype.copy=function(t){return this.inputs=t.inputs.slice(),this.colors=t.colors.slice(),this.resolves=t.resolves.slice(),this.preserves=t.preserves.slice(),this.depthStencil=t.depthStencil,this.depthStencilResolve=t.depthStencilResolve,this.depthResolveMode=t.depthResolveMode,this.stencilResolveMode=t.stencilResolveMode,this},t}(),Wa=function(){function t(t,e,n,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=[]),void 0===i&&(i=[]),this.srcSubpass=t,this.dstSubpass=e,this.srcAccesses=n,this.dstAccesses=i}return t.prototype.copy=function(t){return this.srcSubpass=t.srcSubpass,this.dstSubpass=t.dstSubpass,this.srcAccesses=t.srcAccesses.slice(),this.dstAccesses=t.dstAccesses.slice(),this},t}(),Xa=function(){function t(t,e,n,i){void 0===t&&(t=[]),void 0===e&&(e=new Va),void 0===n&&(n=[]),void 0===i&&(i=[]),this.colorAttachments=t,this.depthStencilAttachment=e,this.subpasses=n,this.dependencies=i}return t.prototype.copy=function(t){return aa(this.colorAttachments,t.colorAttachments,Ha),this.depthStencilAttachment.copy(t.depthStencilAttachment),aa(this.subpasses,t.subpasses,ja),aa(this.dependencies,t.dependencies,Wa),this},t}(),qa=function(){function t(t,e){void 0===t&&(t=[]),void 0===e&&(e=[]),this.prevAccesses=t,this.nextAccesses=e}return t.prototype.copy=function(t){return this.prevAccesses=t.prevAccesses.slice(),this.nextAccesses=t.nextAccesses.slice(),this},t}(),Ya=function(){function t(t,e,n,i,r){void 0===t&&(t=[]),void 0===e&&(e=[]),void 0===n&&(n=!1),void 0===i&&(i=null),void 0===r&&(r=null),this.prevAccesses=t,this.nextAccesses=e,this.discardContents=n,this.srcQueue=i,this.dstQueue=r}return t.prototype.copy=function(t){return this.prevAccesses=t.prevAccesses.slice(),this.nextAccesses=t.nextAccesses.slice(),this.discardContents=t.discardContents,this.srcQueue=t.srcQueue,this.dstQueue=t.dstQueue,this},t}(),Ka=function(){function t(t,e,n){void 0===t&&(t=null),void 0===e&&(e=[]),void 0===n&&(n=null),this.renderPass=t,this.colorTextures=e,this.depthStencilTexture=n}return t.prototype.copy=function(t){return this.renderPass=t.renderPass,this.colorTextures=t.colorTextures.slice(),this.depthStencilTexture=t.depthStencilTexture,this},t}(),Qa=function(){function t(t,e,n,i,r){void 0===t&&(t=-1),void 0===e&&(e=Jr.UNKNOWN),void 0===n&&(n=0),void 0===i&&(i=kr.NONE),void 0===r&&(r=[]),this.binding=t,this.descriptorType=e,this.count=n,this.stageFlags=i,this.immutableSamplers=r}return t.prototype.copy=function(t){return this.binding=t.binding,this.descriptorType=t.descriptorType,this.count=t.count,this.stageFlags=t.stageFlags,this.immutableSamplers=t.immutableSamplers.slice(),this},t}(),Za=function(){function t(t){void 0===t&&(t=[]),this.bindings=t}return t.prototype.copy=function(t){return aa(this.bindings,t.bindings,Qa),this},t}(),Ja=function(){function t(t){void 0===t&&(t=null),this.layout=t}return t.prototype.copy=function(t){return this.layout=t.layout,this},t}(),$a=function(){function t(t){void 0===t&&(t=[]),this.setLayouts=t}return t.prototype.copy=function(t){return this.setLayouts=t.setLayouts.slice(),this},t}(),to=function(){function t(t){void 0===t&&(t=[]),this.attributes=t}return t.prototype.copy=function(t){return aa(this.attributes,t.attributes,Ua),this},t}(),eo=function(){function t(t,e){void 0===t&&(t=null),void 0===e&&(e=ea.PRIMARY),this.queue=t,this.type=e}return t.prototype.copy=function(t){return this.queue=t.queue,this.type=t.type,this},t}(),no=function(){function t(t){void 0===t&&(t=$r.GRAPHICS),this.type=t}return t.prototype.copy=function(t){return this.type=t.type,this},t}(),io=function(){function t(t,e,n){void 0===t&&(t=ta.OCCLUSION),void 0===e&&(e=65536),void 0===n&&(n=!0),this.type=t,this.maxQueryObjects=e,this.forceWait=n}return t.prototype.copy=function(t){return this.type=t.type,this.maxQueryObjects=t.maxQueryObjects,this.forceWait=t.forceWait,this},t}(),ro=function(t,e,n,i,r,a,o,s){void 0===t&&(t=""),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=Tr.NONE),void 0===r&&(r=!1),void 0===a&&(a=!1),void 0===o&&(o=!1),void 0===s&&(s=!1),this.name=t,this.size=e,this.count=n,this.type=i,this.hasAlpha=r,this.hasDepth=a,this.hasStencil=o,this.isCompressed=s},ao=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.bufferSize=t,this.textureSize=e}return t.prototype.copy=function(t){return this.bufferSize=t.bufferSize,this.textureSize=t.textureSize,this},t}(),oo=function(){function t(t,e,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),this.writeMask=t,this.compareMask=e,this.reference=n}return t.prototype.copy=function(t){return this.writeMask=t.writeMask,this.compareMask=t.compareMask,this.reference=t.reference,this},t}(),so=function(){function t(t,e,n,i,r,a,o,s,c,l,u){void 0===t&&(t=new ga),void 0===e&&(e=new ua),void 0===n&&(n=new va),void 0===i&&(i=1),void 0===r&&(r=0),void 0===a&&(a=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===c&&(c=0),void 0===l&&(l=new oo),void 0===u&&(u=new oo),this.viewport=t,this.scissor=e,this.blendConstant=n,this.lineWidth=i,this.depthBiasConstant=r,this.depthBiasClamp=a,this.depthBiasSlope=o,this.depthMinBounds=s,this.depthMaxBounds=c,this.stencilStatesFront=l,this.stencilStatesBack=u}return t.prototype.copy=function(t){return this.viewport.copy(t.viewport),this.scissor.copy(t.scissor),this.blendConstant.copy(t.blendConstant),this.lineWidth=t.lineWidth,this.depthBiasConstant=t.depthBiasConstant,this.depthBiasClamp=t.depthBiasClamp,this.depthBiasSlope=t.depthBiasSlope,this.depthMinBounds=t.depthMinBounds,this.depthMaxBounds=t.depthMaxBounds,this.stencilStatesFront.copy(t.stencilStatesFront),this.stencilStatesBack.copy(t.stencilStatesBack),this},t}(),co=function(){function t(e){this._objectType=mr.UNKNOWN,this._objectID=0,this._typedID=0,this._objectType=e,this._objectID=t._idTable[mr.UNKNOWN]++,this._typedID=t._idTable[e]++}return L(t,[{key:"objectType",get:function(){return this._objectType}},{key:"objectID",get:function(){return this._objectID}},{key:"typedID",get:function(){return this._typedID}}]),t}();co._idTable=Array(mr.COUNT).fill(65536),function(t){t.ATTR_POSITION="a_position",t.ATTR_NORMAL="a_normal",t.ATTR_TANGENT="a_tangent",t.ATTR_BITANGENT="a_bitangent",t.ATTR_WEIGHTS="a_weights",t.ATTR_JOINTS="a_joints",t.ATTR_COLOR="a_color",t.ATTR_COLOR1="a_color1",t.ATTR_COLOR2="a_color2",t.ATTR_TEX_COORD="a_texCoord",t.ATTR_TEX_COORD1="a_texCoord1",t.ATTR_TEX_COORD2="a_texCoord2",t.ATTR_TEX_COORD3="a_texCoord3",t.ATTR_TEX_COORD4="a_texCoord4",t.ATTR_TEX_COORD5="a_texCoord5",t.ATTR_TEX_COORD6="a_texCoord6",t.ATTR_TEX_COORD7="a_texCoord7",t.ATTR_TEX_COORD8="a_texCoord8",t.ATTR_BATCH_ID="a_batch_id",t.ATTR_BATCH_UV="a_batch_uv"}(oa||(oa={}));var lo=Object.freeze([new ro("UNKNOWN",0,0,Tr.NONE,!1,!1,!1,!1),new ro("A8",1,1,Tr.UNORM,!0,!1,!1,!1),new ro("L8",1,1,Tr.UNORM,!1,!1,!1,!1),new ro("LA8",1,2,Tr.UNORM,!0,!1,!1,!1),new ro("R8",1,1,Tr.UNORM,!1,!1,!1,!1),new ro("R8SN",1,1,Tr.SNORM,!1,!1,!1,!1),new ro("R8UI",1,1,Tr.UINT,!1,!1,!1,!1),new ro("R8I",1,1,Tr.INT,!1,!1,!1,!1),new ro("R16F",2,1,Tr.FLOAT,!1,!1,!1,!1),new ro("R16UI",2,1,Tr.UINT,!1,!1,!1,!1),new ro("R16I",2,1,Tr.INT,!1,!1,!1,!1),new ro("R32F",4,1,Tr.FLOAT,!1,!1,!1,!1),new ro("R32UI",4,1,Tr.UINT,!1,!1,!1,!1),new ro("R32I",4,1,Tr.INT,!1,!1,!1,!1),new ro("RG8",2,2,Tr.UNORM,!1,!1,!1,!1),new ro("RG8SN",2,2,Tr.SNORM,!1,!1,!1,!1),new ro("RG8UI",2,2,Tr.UINT,!1,!1,!1,!1),new ro("RG8I",2,2,Tr.INT,!1,!1,!1,!1),new ro("RG16F",4,2,Tr.FLOAT,!1,!1,!1,!1),new ro("RG16UI",4,2,Tr.UINT,!1,!1,!1,!1),new ro("RG16I",4,2,Tr.INT,!1,!1,!1,!1),new ro("RG32F",8,2,Tr.FLOAT,!1,!1,!1,!1),new ro("RG32UI",8,2,Tr.UINT,!1,!1,!1,!1),new ro("RG32I",8,2,Tr.INT,!1,!1,!1,!1),new ro("RGB8",3,3,Tr.UNORM,!1,!1,!1,!1),new ro("SRGB8",3,3,Tr.UNORM,!1,!1,!1,!1),new ro("RGB8SN",3,3,Tr.SNORM,!1,!1,!1,!1),new ro("RGB8UI",3,3,Tr.UINT,!1,!1,!1,!1),new ro("RGB8I",3,3,Tr.INT,!1,!1,!1,!1),new ro("RGB16F",6,3,Tr.FLOAT,!1,!1,!1,!1),new ro("RGB16UI",6,3,Tr.UINT,!1,!1,!1,!1),new ro("RGB16I",6,3,Tr.INT,!1,!1,!1,!1),new ro("RGB32F",12,3,Tr.FLOAT,!1,!1,!1,!1),new ro("RGB32UI",12,3,Tr.UINT,!1,!1,!1,!1),new ro("RGB32I",12,3,Tr.INT,!1,!1,!1,!1),new ro("RGBA8",4,4,Tr.UNORM,!0,!1,!1,!1),new ro("BGRA8",4,4,Tr.UNORM,!0,!1,!1,!1),new ro("SRGB8_A8",4,4,Tr.UNORM,!0,!1,!1,!1),new ro("RGBA8SN",4,4,Tr.SNORM,!0,!1,!1,!1),new ro("RGBA8UI",4,4,Tr.UINT,!0,!1,!1,!1),new ro("RGBA8I",4,4,Tr.INT,!0,!1,!1,!1),new ro("RGBA16F",8,4,Tr.FLOAT,!0,!1,!1,!1),new ro("RGBA16UI",8,4,Tr.UINT,!0,!1,!1,!1),new ro("RGBA16I",8,4,Tr.INT,!0,!1,!1,!1),new ro("RGBA32F",16,4,Tr.FLOAT,!0,!1,!1,!1),new ro("RGBA32UI",16,4,Tr.UINT,!0,!1,!1,!1),new ro("RGBA32I",16,4,Tr.INT,!0,!1,!1,!1),new ro("R5G6B5",2,3,Tr.UNORM,!1,!1,!1,!1),new ro("R11G11B10F",4,3,Tr.FLOAT,!1,!1,!1,!1),new ro("RGB5A1",2,4,Tr.UNORM,!0,!1,!1,!1),new ro("RGBA4",2,4,Tr.UNORM,!0,!1,!1,!1),new ro("RGB10A2",2,4,Tr.UNORM,!0,!1,!1,!1),new ro("RGB10A2UI",2,4,Tr.UINT,!0,!1,!1,!1),new ro("RGB9E5",2,4,Tr.FLOAT,!0,!1,!1,!1),new ro("DEPTH",4,1,Tr.FLOAT,!1,!0,!1,!1),new ro("DEPTH_STENCIL",5,2,Tr.FLOAT,!1,!0,!0,!1),new ro("BC1",1,3,Tr.UNORM,!1,!1,!1,!0),new ro("BC1_ALPHA",1,4,Tr.UNORM,!0,!1,!1,!0),new ro("BC1_SRGB",1,3,Tr.UNORM,!1,!1,!1,!0),new ro("BC1_SRGB_ALPHA",1,4,Tr.UNORM,!0,!1,!1,!0),new ro("BC2",1,4,Tr.UNORM,!0,!1,!1,!0),new ro("BC2_SRGB",1,4,Tr.UNORM,!0,!1,!1,!0),new ro("BC3",1,4,Tr.UNORM,!0,!1,!1,!0),new ro("BC3_SRGB",1,4,Tr.UNORM,!0,!1,!1,!0),new ro("BC4",1,1,Tr.UNORM,!1,!1,!1,!0),new ro("BC4_SNORM",1,1,Tr.SNORM,!1,!1,!1,!0),new ro("BC5",1,2,Tr.UNORM,!1,!1,!1,!0),new ro("BC5_SNORM",1,2,Tr.SNORM,!1,!1,!1,!0),new ro("BC6H_UF16",1,3,Tr.UFLOAT,!1,!1,!1,!0),new ro("BC6H_SF16",1,3,Tr.FLOAT,!1,!1,!1,!0),new ro("BC7",1,4,Tr.UNORM,!0,!1,!1,!0),new ro("BC7_SRGB",1,4,Tr.UNORM,!0,!1,!1,!0),new ro("ETC_RGB8",1,3,Tr.UNORM,!1,!1,!1,!0),new ro("ETC2_RGB8",1,3,Tr.UNORM,!1,!1,!1,!0),new ro("ETC2_SRGB8",1,3,Tr.UNORM,!1,!1,!1,!0),new ro("ETC2_RGB8_A1",1,4,Tr.UNORM,!0,!1,!1,!0),new ro("ETC2_SRGB8_A1",1,4,Tr.UNORM,!0,!1,!1,!0),new ro("ETC2_RGBA8",2,4,Tr.UNORM,!0,!1,!1,!0),new ro("ETC2_SRGB8_A8",2,4,Tr.UNORM,!0,!1,!1,!0),new ro("EAC_R11",1,1,Tr.UNORM,!1,!1,!1,!0),new ro("EAC_R11SN",1,1,Tr.SNORM,!1,!1,!1,!0),new ro("EAC_RG11",2,2,Tr.UNORM,!1,!1,!1,!0),new ro("EAC_RG11SN",2,2,Tr.SNORM,!1,!1,!1,!0),new ro("PVRTC_RGB2",2,3,Tr.UNORM,!1,!1,!1,!0),new ro("PVRTC_RGBA2",2,4,Tr.UNORM,!0,!1,!1,!0),new ro("PVRTC_RGB4",2,3,Tr.UNORM,!1,!1,!1,!0),new ro("PVRTC_RGBA4",2,4,Tr.UNORM,!0,!1,!1,!0),new ro("PVRTC2_2BPP",2,4,Tr.UNORM,!0,!1,!1,!0),new ro("PVRTC2_4BPP",2,4,Tr.UNORM,!0,!1,!1,!0),new ro("ASTC_RGBA_4x4",1,4,Tr.UNORM,!0,!1,!1,!0),new ro("ASTC_RGBA_5x4",1,4,Tr.UNORM,!0,!1,!1,!0),new ro("ASTC_RGBA_5x5",1,4,Tr.UNORM,!0,!1,!1,!0),new ro("ASTC_RGBA_6x5",1,4,Tr.UNORM,!0,!1,!1,!0),new ro("ASTC_RGBA_6x6",1,4,Tr.UNORM,!0,!1,!1,!0),new ro("ASTC_RGBA_8x5",1,4,Tr.UNORM,!0,!1,!1,!0),new ro("ASTC_RGBA_8x6",1,4,Tr.UNORM,!0,!1,!1,!0),new ro("ASTC_RGBA_8x8",1,4,Tr.UNORM,!0,!1,!1,!0),new ro("ASTC_RGBA_10x5",1,4,Tr.UNORM,!0,!1,!1,!0),new ro("ASTC_RGBA_10x6",1,4,Tr.UNORM,!0,!1,!1,!0),new ro("ASTC_RGBA_10x8",1,4,Tr.UNORM,!0,!1,!1,!0),new ro("ASTC_RGBA_10x10",1,4,Tr.UNORM,!0,!1,!1,!0),new ro("ASTC_RGBA_12x10",1,4,Tr.UNORM,!0,!1,!1,!0),new ro("ASTC_RGBA_12x12",1,4,Tr.UNORM,!0,!1,!1,!0),new ro("ASTC_SRGBA_4x4",1,4,Tr.UNORM,!0,!1,!1,!0),new ro("ASTC_SRGBA_5x4",1,4,Tr.UNORM,!0,!1,!1,!0),new ro("ASTC_SRGBA_5x5",1,4,Tr.UNORM,!0,!1,!1,!0),new ro("ASTC_SRGBA_6x5",1,4,Tr.UNORM,!0,!1,!1,!0),new ro("ASTC_SRGBA_6x6",1,4,Tr.UNORM,!0,!1,!1,!0),new ro("ASTC_SRGBA_8x5",1,4,Tr.UNORM,!0,!1,!1,!0),new ro("ASTC_SRGBA_8x6",1,4,Tr.UNORM,!0,!1,!1,!0),new ro("ASTC_SRGBA_8x8",1,4,Tr.UNORM,!0,!1,!1,!0),new ro("ASTC_SRGBA_10x5",1,4,Tr.UNORM,!0,!1,!1,!0),new ro("ASTC_SRGBA_10x6",1,4,Tr.UNORM,!0,!1,!1,!0),new ro("ASTC_SRGBA_10x8",1,4,Tr.UNORM,!0,!1,!1,!0),new ro("ASTC_SRGBA_10x10",1,4,Tr.UNORM,!0,!1,!1,!0),new ro("ASTC_SRGBA_12x10",1,4,Tr.UNORM,!0,!1,!1,!0),new ro("ASTC_SRGBA_12x12",1,4,Tr.UNORM,!0,!1,!1,!0)]),uo=Jr.UNIFORM_BUFFER|Jr.DYNAMIC_UNIFORM_BUFFER|Jr.STORAGE_BUFFER|Jr.DYNAMIC_STORAGE_BUFFER,ho=Jr.SAMPLER_TEXTURE|Jr.SAMPLER|Jr.TEXTURE|Jr.STORAGE_IMAGE|Jr.INPUT_ATTACHMENT,fo=Jr.DYNAMIC_STORAGE_BUFFER|Jr.DYNAMIC_UNIFORM_BUFFER;function _o(t){return t>0&&0==(t&t-1)}function po(t,e,n,i){if(!lo[t].isCompressed)return e*n*i*lo[t].size;switch(t){case Sr.BC1:case Sr.BC1_ALPHA:case Sr.BC1_SRGB:case Sr.BC1_SRGB_ALPHA:return Math.ceil(e/4)*Math.ceil(n/4)*8*i;case Sr.BC2:case Sr.BC2_SRGB:case Sr.BC3:case Sr.BC3_SRGB:case Sr.BC4:case Sr.BC4_SNORM:case Sr.BC6H_SF16:case Sr.BC6H_UF16:case Sr.BC7:case Sr.BC7_SRGB:return Math.ceil(e/4)*Math.ceil(n/4)*16*i;case Sr.BC5:case Sr.BC5_SNORM:return Math.ceil(e/4)*Math.ceil(n/4)*32*i;case Sr.ETC_RGB8:case Sr.ETC2_RGB8:case Sr.ETC2_SRGB8:case Sr.ETC2_RGB8_A1:case Sr.EAC_R11:case Sr.EAC_R11SN:return Math.ceil(e/4)*Math.ceil(n/4)*8*i;case Sr.ETC2_RGBA8:case Sr.ETC2_SRGB8_A1:case Sr.EAC_RG11:case Sr.EAC_RG11SN:return Math.ceil(e/4)*Math.ceil(n/4)*16*i;case Sr.PVRTC_RGB2:case Sr.PVRTC_RGBA2:case Sr.PVRTC2_2BPP:return Math.ceil(Math.max(e,16)*Math.max(n,8)/4)*i;case Sr.PVRTC_RGB4:case Sr.PVRTC_RGBA4:case Sr.PVRTC2_4BPP:return Math.ceil(Math.max(e,8)*Math.max(n,8)/2)*i;case Sr.ASTC_RGBA_4X4:case Sr.ASTC_SRGBA_4X4:return Math.ceil(e/4)*Math.ceil(n/4)*16*i;case Sr.ASTC_RGBA_5X4:case Sr.ASTC_SRGBA_5X4:return Math.ceil(e/5)*Math.ceil(n/4)*16*i;case Sr.ASTC_RGBA_5X5:case Sr.ASTC_SRGBA_5X5:return Math.ceil(e/5)*Math.ceil(n/5)*16*i;case Sr.ASTC_RGBA_6X5:case Sr.ASTC_SRGBA_6X5:return Math.ceil(e/6)*Math.ceil(n/5)*16*i;case Sr.ASTC_RGBA_6X6:case Sr.ASTC_SRGBA_6X6:return Math.ceil(e/6)*Math.ceil(n/6)*16*i;case Sr.ASTC_RGBA_8X5:case Sr.ASTC_SRGBA_8X5:return Math.ceil(e/8)*Math.ceil(n/5)*16*i;case Sr.ASTC_RGBA_8X6:case Sr.ASTC_SRGBA_8X6:return Math.ceil(e/8)*Math.ceil(n/6)*16*i;case Sr.ASTC_RGBA_8X8:case Sr.ASTC_SRGBA_8X8:return Math.ceil(e/8)*Math.ceil(n/8)*16*i;case Sr.ASTC_RGBA_10X5:case Sr.ASTC_SRGBA_10X5:return Math.ceil(e/10)*Math.ceil(n/5)*16*i;case Sr.ASTC_RGBA_10X6:case Sr.ASTC_SRGBA_10X6:return Math.ceil(e/10)*Math.ceil(n/6)*16*i;case Sr.ASTC_RGBA_10X8:case Sr.ASTC_SRGBA_10X8:return Math.ceil(e/10)*Math.ceil(n/8)*16*i;case Sr.ASTC_RGBA_10X10:case Sr.ASTC_SRGBA_10X10:return Math.ceil(e/10)*Math.ceil(n/10)*16*i;case Sr.ASTC_RGBA_12X10:case Sr.ASTC_SRGBA_12X10:return Math.ceil(e/12)*Math.ceil(n/10)*16*i;case Sr.ASTC_RGBA_12X12:case Sr.ASTC_SRGBA_12X12:return Math.ceil(e/12)*Math.ceil(n/12)*16*i;default:return 0}}function mo(t,e,n,i,r){for(var a=0,o=0;o<r;++o)a+=po(t,e,n,i),e=Math.max(e>>1,1),n=Math.max(n>>1,1);return a}var go=[0,4,8,12,16,4,8,12,16,4,8,12,16,4,8,12,16,16,24,32,24,36,48,32,48,64,4,4,4,4,4,4];function vo(t){return go[t]||0}function yo(t){var e=t.size/t.count;switch(t.type){case Tr.UNORM:case Tr.UINT:switch(e){case 1:return Uint8Array;case 2:return Uint16Array;case 4:return Uint32Array}break;case Tr.SNORM:case Tr.INT:switch(e){case 1:return Int8Array;case 2:return Int16Array;case 4:return Int32Array}break;case Tr.FLOAT:return Float32Array}return Float32Array}var xo=Object.freeze({__proto__:null,get ObjectType(){return mr},get Status(){return gr},get API(){return vr},get SurfaceTransform(){return yr},get Feature(){return xr},get Format(){return Sr},get FormatType(){return Tr},get Type(){return Ar},get BufferUsageBit(){return Er},get BufferFlagBit(){return Cr},get MemoryAccessBit(){return br},get MemoryUsageBit(){return wr},get TextureType(){return Pr},get TextureUsageBit(){return Ir},get TextureFlagBit(){return Rr},get SampleCount(){return Dr},get VsyncMode(){return Or},get Filter(){return Mr},get Address(){return Nr},get ComparisonFunc(){return Lr},get StencilOp(){return Br},get BlendFactor(){return Fr},get BlendOp(){return zr},get ColorMask(){return Ur},get ShaderStageFlagBit(){return kr},get LoadOp(){return Gr},get StoreOp(){return Hr},get AccessType(){return Vr},get ResolveMode(){return jr},get PipelineBindPoint(){return Wr},get PrimitiveMode(){return Xr},get PolygonMode(){return qr},get ShadeModel(){return Yr},get CullMode(){return Kr},get DynamicStateFlagBit(){return Qr},get StencilFace(){return Zr},get DescriptorType(){return Jr},get QueueType(){return $r},get QueryType(){return ta},get CommandBufferType(){return ea},get ClearFlagBit(){return na},Size:sa,DeviceCaps:ca,Offset:la,Rect:ua,Extent:ha,TextureSubresLayers:fa,TextureSubresRange:_a,TextureCopy:pa,TextureBlit:da,BufferTextureCopy:ma,Viewport:ga,Color:va,BindingMappingInfo:ya,SwapchainInfo:xa,DeviceInfo:Sa,BufferInfo:Ta,BufferViewInfo:Aa,DrawInfo:Ea,DispatchInfo:Ca,IndirectBuffer:ba,TextureInfo:wa,TextureViewInfo:Pa,SamplerInfo:Ia,Uniform:Ra,UniformBlock:Da,UniformSamplerTexture:Oa,UniformSampler:Ma,UniformTexture:Na,UniformStorageImage:La,UniformStorageBuffer:Ba,UniformInputAttachment:Fa,ShaderStage:za,Attribute:Ua,ShaderInfo:ka,InputAssemblerInfo:Ga,ColorAttachment:Ha,DepthStencilAttachment:Va,SubpassInfo:ja,SubpassDependency:Wa,RenderPassInfo:Xa,GlobalBarrierInfo:qa,TextureBarrierInfo:Ya,FramebufferInfo:Ka,DescriptorSetLayoutBinding:Qa,DescriptorSetLayoutInfo:Za,DescriptorSetInfo:Ja,PipelineLayoutInfo:$a,InputState:to,CommandBufferInfo:eo,QueueInfo:no,QueryPoolInfo:io,FormatInfo:ro,MemoryStatus:ao,DynamicStencilStates:oo,DynamicStates:so,GFXObject:co,get AttributeName(){return oa},FormatInfos:lo,DESCRIPTOR_BUFFER_TYPE:uo,DESCRIPTOR_SAMPLER_TYPE:ho,DESCRIPTOR_DYNAMIC_TYPE:fo,DRAW_INFO_SIZE:28,IsPowerOf2:_o,FormatSize:po,FormatSurfaceSize:mo,GetTypeSize:vo,getTypedArrayConstructor:yo}),So=function(t){function e(){var e;return(e=t.call(this,mr.BUFFER)||this)._usage=Er.NONE,e._memUsage=wr.NONE,e._size=0,e._stride=1,e._count=0,e._flags=Cr.NONE,e._isBufferView=!1,e}return F(e,t),L(e,[{key:"usage",get:function(){return this._usage}},{key:"memUsage",get:function(){return this._memUsage}},{key:"size",get:function(){return this._size}},{key:"stride",get:function(){return this._stride}},{key:"count",get:function(){return this._count}},{key:"flags",get:function(){return this._flags}}]),e}(co),To=function(t){function e(){var e;return(e=t.call(this,mr.COMMAND_BUFFER)||this)._queue=null,e._type=ea.PRIMARY,e._numDrawCalls=0,e._numInstances=0,e._numTris=0,e}return F(e,t),L(e,[{key:"type",get:function(){return this._type}},{key:"queue",get:function(){return this._queue}},{key:"numDrawCalls",get:function(){return this._numDrawCalls}},{key:"numInstances",get:function(){return this._numInstances}},{key:"numTris",get:function(){return this._numTris}}]),e}(co),Ao=function(){function t(){this._gfxAPI=vr.UNKNOWN,this._renderer="",this._vendor="",this._features=new Array(xr.COUNT),this._queue=null,this._cmdBuff=null,this._numDrawCalls=0,this._numInstances=0,this._numTris=0,this._memoryStatus=new ao,this._caps=new ca,this._bindingMappingInfo=new ya,this._samplers=new Map,this._globalBarriers=new Map,this._textureBarriers=new Map}return t.prototype.hasFeature=function(t){return this._features[t]},L(t,[{key:"gfxAPI",get:function(){return this._gfxAPI}},{key:"queue",get:function(){return this._queue}},{key:"commandBuffer",get:function(){return this._cmdBuff}},{key:"renderer",get:function(){return this._renderer}},{key:"vendor",get:function(){return this._vendor}},{key:"numDrawCalls",get:function(){return this._numDrawCalls}},{key:"numInstances",get:function(){return this._numInstances}},{key:"numTris",get:function(){return this._numTris}},{key:"memoryStatus",get:function(){return this._memoryStatus}},{key:"capabilities",get:function(){return this._caps}},{key:"bindingMappingInfo",get:function(){return this._bindingMappingInfo}}]),t}();Ao.canvas=void 0;var Eo=function(t){function e(){var e;return(e=t.call(this,mr.SWAPCHAIN)||this)._transform=yr.IDENTITY,e._colorTexture=null,e._depthStencilTexture=null,e}return F(e,t),L(e,[{key:"colorTexture",get:function(){return this._colorTexture}},{key:"depthStencilTexture",get:function(){return this._depthStencilTexture}},{key:"surfaceTransform",get:function(){return this._transform}},{key:"width",get:function(){return this._colorTexture.width}},{key:"height",get:function(){return this._colorTexture.height}}]),e}(co),Co=function(t){function e(){var e;return(e=t.call(this,mr.FRAMEBUFFER)||this)._renderPass=null,e._colorTextures=[],e._depthStencilTexture=null,e}return F(e,t),L(e,[{key:"renderPass",get:function(){return this._renderPass}},{key:"colorTextures",get:function(){return this._colorTextures}},{key:"depthStencilTexture",get:function(){return this._depthStencilTexture}}]),e}(co),bo=String.prototype.charCodeAt;function wo(t){return this[t]}function Po(t,e){for(var n=t.length,i=e^n,r=0,a="string"==typeof t?bo:wo;n>=4;){var o=255&a.call(t,r)|(255&a.call(t,++r))<<8|(255&a.call(t,++r))<<16|(255&a.call(t,++r))<<24;o=1540483477*(65535&o)+((1540483477*(o>>>16)&65535)<<16),i=1540483477*(65535&i)+((1540483477*(i>>>16)&65535)<<16)^(o=1540483477*(65535&(o^=o>>>24))+((1540483477*(o>>>16)&65535)<<16)),n-=4,++r}switch(n){case 3:i^=(255&a.call(t,r+2))<<16;case 2:i^=(255&a.call(t,r+1))<<8;case 1:i=1540483477*(65535&(i^=255&a.call(t,r)))+((1540483477*(i>>>16)&65535)<<16)}return i=1540483477*(65535&(i^=i>>>13))+((1540483477*(i>>>16)&65535)<<16),(i^=i>>>15)>>>0}var Io=function(t){function e(){var e;return(e=t.call(this,mr.INPUT_ASSEMBLER)||this)._attributes=[],e._attributesHash=0,e._vertexBuffers=[],e._indexBuffer=null,e._indirectBuffer=null,e._drawInfo=new Ea,e}F(e,t);var n=e.prototype;return n.getVertexBuffer=function(t){return void 0===t&&(t=0),t<this._vertexBuffers.length?this._vertexBuffers[t]:null},n.computeAttributesHash=function(){for(var t="attrs",e=0;e<this.attributes.length;++e){var n=this.attributes[e];t+=","+n.name+","+n.format+","+n.isNormalized+","+n.stream+","+n.isInstanced}return Po(t,666)},L(e,[{key:"attributes",get:function(){return this._attributes}},{key:"vertexBuffers",get:function(){return this._vertexBuffers}},{key:"indexBuffer",get:function(){return this._indexBuffer}},{key:"indirectBuffer",get:function(){return this._indirectBuffer}},{key:"attributesHash",get:function(){return this._attributesHash}},{key:"vertexCount",get:function(){return this._drawInfo.vertexCount},set:function(t){this._drawInfo.vertexCount=t}},{key:"firstVertex",get:function(){return this._drawInfo.firstVertex},set:function(t){this._drawInfo.firstVertex=t}},{key:"indexCount",get:function(){return this._drawInfo.indexCount},set:function(t){this._drawInfo.indexCount=t}},{key:"firstIndex",get:function(){return this._drawInfo.firstIndex},set:function(t){this._drawInfo.firstIndex=t}},{key:"vertexOffset",get:function(){return this._drawInfo.vertexOffset},set:function(t){this._drawInfo.vertexOffset=t}},{key:"instanceCount",get:function(){return this._drawInfo.instanceCount},set:function(t){this._drawInfo.instanceCount=t}},{key:"firstInstance",get:function(){return this._drawInfo.firstInstance},set:function(t){this._drawInfo.firstInstance=t}},{key:"drawInfo",get:function(){return this._drawInfo}}]),e}(co),Ro=function(t){function e(){var e;return(e=t.call(this,mr.DESCRIPTOR_SET)||this)._layout=null,e._buffers=[],e._textures=[],e._samplers=[],e._isDirty=!1,e}F(e,t);var n=e.prototype;return n.bindBuffer=function(t,e,n){void 0===n&&(n=0);var i=this._layout.bindingIndices[t],r=this._layout.bindings[i];if(r&&r.descriptorType&uo){var a=this._layout.descriptorIndices[t];this._buffers[a+n]!==e&&(this._buffers[a+n]=e,this._isDirty=!0)}},n.bindSampler=function(t,e,n){void 0===n&&(n=0);var i=this._layout.bindingIndices[t],r=this._layout.bindings[i];if(r&&r.descriptorType&ho){var a=this._layout.descriptorIndices[t];this._samplers[a+n]!==e&&(this._samplers[a+n]=e,this._isDirty=!0)}},n.bindTexture=function(t,e,n){void 0===n&&(n=0);var i=this._layout.bindingIndices[t],r=this._layout.bindings[i];if(r&&r.descriptorType&ho){var a=this._layout.descriptorIndices[t];this._textures[a+n]!==e&&(this._textures[a+n]=e,this._isDirty=!0)}},n.getBuffer=function(t,e){void 0===e&&(e=0);var n=this._layout.descriptorIndices[t];return this._buffers[n+e]},n.getSampler=function(t,e){void 0===e&&(e=0);var n=this._layout.descriptorIndices[t];return this._samplers[n+e]},n.getTexture=function(t,e){void 0===e&&(e=0);var n=this._layout.descriptorIndices[t];return this._textures[n+e]},L(e,[{key:"layout",get:function(){return this._layout}}]),e}(co),Do=function(t){function e(){var e;return(e=t.call(this,mr.DESCRIPTOR_SET_LAYOUT)||this)._bindings=[],e._bindingIndices=[],e._descriptorIndices=[],e}return F(e,t),L(e,[{key:"bindings",get:function(){return this._bindings}},{key:"bindingIndices",get:function(){return this._bindingIndices}},{key:"descriptorIndices",get:function(){return this._descriptorIndices}}]),e}(co),Oo=function(t){function e(){var e;return(e=t.call(this,mr.PIPELINE_LAYOUT)||this)._setLayouts=[],e}return F(e,t),L(e,[{key:"setLayouts",get:function(){return this._setLayouts}}]),e}(co),Mo=function(){function t(t,e,n,i,r,a,o,s,c,l,u,h){void 0===t&&(t=!1),void 0===e&&(e=qr.FILL),void 0===n&&(n=Yr.GOURAND),void 0===i&&(i=Kr.BACK),void 0===r&&(r=!0),void 0===a&&(a=!1),void 0===o&&(o=0),void 0===s&&(s=0),void 0===c&&(c=0),void 0===l&&(l=!0),void 0===u&&(u=!1),void 0===h&&(h=1),this.isDiscard=t,this.polygonMode=e,this.shadeModel=n,this.cullMode=i,this.isFrontFaceCCW=r,this.depthBiasEnabled=a,this.depthBias=o,this.depthBiasClamp=s,this.depthBiasSlop=c,this.isDepthClip=l,this.isMultisample=u,this.lineWidth=h}var e=t.prototype;return e.reset=function(){this.isDiscard=!1,this.polygonMode=qr.FILL,this.shadeModel=Yr.GOURAND,this.cullMode=Kr.BACK,this.isFrontFaceCCW=!0,this.depthBiasEnabled=!1,this.depthBias=0,this.depthBiasClamp=0,this.depthBiasSlop=0,this.isDepthClip=!0,this.isMultisample=!1,this.lineWidth=1},e.assign=function(t){Object.assign(this,t)},e.destroy=function(){},L(t,[{key:"native",get:function(){return this}}]),t}(),No=function(){function t(t,e,n,i,r,a,o,s,c,l,u,h,f,_,p,d,m,g,v){void 0===t&&(t=!0),void 0===e&&(e=!0),void 0===n&&(n=Lr.LESS),void 0===i&&(i=!1),void 0===r&&(r=Lr.ALWAYS),void 0===a&&(a=65535),void 0===o&&(o=65535),void 0===s&&(s=Br.KEEP),void 0===c&&(c=Br.KEEP),void 0===l&&(l=Br.KEEP),void 0===u&&(u=1),void 0===h&&(h=!1),void 0===f&&(f=Lr.ALWAYS),void 0===_&&(_=65535),void 0===p&&(p=65535),void 0===d&&(d=Br.KEEP),void 0===m&&(m=Br.KEEP),void 0===g&&(g=Br.KEEP),void 0===v&&(v=1),this.depthTest=t,this.depthWrite=e,this.depthFunc=n,this.stencilTestFront=i,this.stencilFuncFront=r,this.stencilReadMaskFront=a,this.stencilWriteMaskFront=o,this.stencilFailOpFront=s,this.stencilZFailOpFront=c,this.stencilPassOpFront=l,this.stencilRefFront=u,this.stencilTestBack=h,this.stencilFuncBack=f,this.stencilReadMaskBack=_,this.stencilWriteMaskBack=p,this.stencilFailOpBack=d,this.stencilZFailOpBack=m,this.stencilPassOpBack=g,this.stencilRefBack=v}var e=t.prototype;return e.reset=function(){this.depthTest=!0,this.depthWrite=!0,this.depthFunc=Lr.LESS,this.stencilTestFront=!1,this.stencilFuncFront=Lr.ALWAYS,this.stencilReadMaskFront=65535,this.stencilWriteMaskFront=65535,this.stencilFailOpFront=Br.KEEP,this.stencilZFailOpFront=Br.KEEP,this.stencilPassOpFront=Br.KEEP,this.stencilRefFront=1,this.stencilTestBack=!1,this.stencilFuncBack=Lr.ALWAYS,this.stencilReadMaskBack=65535,this.stencilWriteMaskBack=65535,this.stencilFailOpBack=Br.KEEP,this.stencilZFailOpBack=Br.KEEP,this.stencilPassOpBack=Br.KEEP,this.stencilRefBack=1},e.assign=function(t){Object.assign(this,t)},e.destroy=function(){},L(t,[{key:"native",get:function(){return this}}]),t}(),Lo=function(){function t(t,e,n,i,r,a,o,s){void 0===t&&(t=!1),void 0===e&&(e=Fr.ONE),void 0===n&&(n=Fr.ZERO),void 0===i&&(i=zr.ADD),void 0===r&&(r=Fr.ONE),void 0===a&&(a=Fr.ZERO),void 0===o&&(o=zr.ADD),void 0===s&&(s=Ur.ALL),this.blend=t,this.blendSrc=e,this.blendDst=n,this.blendEq=i,this.blendSrcAlpha=r,this.blendDstAlpha=a,this.blendAlphaEq=o,this.blendColorMask=s}var e=t.prototype;return e.reset=function(){this.blend=!1,this.blendSrc=Fr.ONE,this.blendDst=Fr.ZERO,this.blendEq=zr.ADD,this.blendSrcAlpha=Fr.ONE,this.blendDstAlpha=Fr.ZERO,this.blendAlphaEq=zr.ADD,this.blendColorMask=Ur.ALL},e.assign=function(t){Object.assign(this,t)},e.destroy=function(){},t}(),Bo=function(){function t(t,e,n,i){void 0===t&&(t=!1),void 0===e&&(e=!1),void 0===n&&(n=new va),void 0===i&&(i=[new Lo]),this.isA2C=t,this.isIndepend=e,this.blendColor=n,this.targets=i}var e=t.prototype;return e.setTarget=function(t,e){var n=this.targets[t];n||(n=this.targets[t]=new Lo),Object.assign(n,e)},e.reset=function(){this.isA2C=!1,this.isIndepend=!1,this.blendColor.x=0,this.blendColor.y=0,this.blendColor.z=0,this.blendColor.w=0,this.targets.length=1,this.targets[0].reset()},e.destroy=function(){},L(t,[{key:"native",get:function(){return this}}]),t}(),Fo=function(t,e,n,i,r,a,o,s,c,l){void 0===t&&(t=null),void 0===e&&(e=null),void 0===n&&(n=null),void 0===i&&(i=new to),void 0===r&&(r=new Mo),void 0===a&&(a=new No),void 0===o&&(o=new Bo),void 0===s&&(s=Xr.TRIANGLE_LIST),void 0===c&&(c=Qr.NONE),void 0===l&&(l=Wr.GRAPHICS),this.shader=t,this.pipelineLayout=e,this.renderPass=n,this.inputState=i,this.rasterizerState=r,this.depthStencilState=a,this.blendState=o,this.primitive=s,this.dynamicStates=c,this.bindPoint=l},zo=function(t){function e(){var e;return(e=t.call(this,mr.PIPELINE_STATE)||this)._shader=null,e._pipelineLayout=null,e._primitive=Xr.TRIANGLE_LIST,e._is=null,e._rs=new Mo,e._dss=new No,e._bs=new Bo,e._dynamicStates=Qr.NONE,e._renderPass=null,e}return F(e,t),L(e,[{key:"shader",get:function(){return this._shader}},{key:"pipelineLayout",get:function(){return this._pipelineLayout}},{key:"primitive",get:function(){return this._primitive}},{key:"rasterizerState",get:function(){return this._rs}},{key:"depthStencilState",get:function(){return this._dss}},{key:"blendState",get:function(){return this._bs}},{key:"inputState",get:function(){return this._is}},{key:"dynamicStates",get:function(){return this._dynamicStates}},{key:"renderPass",get:function(){return this._renderPass}}]),e}(co),Uo=function(t){function e(){var e;return(e=t.call(this,mr.QUEUE)||this)._type=$r.GRAPHICS,e}return F(e,t),L(e,[{key:"type",get:function(){return this._type}}]),e}(co),ko=function(t){function e(){var e;return(e=t.call(this,mr.RENDER_PASS)||this)._colorInfos=[],e._depthStencilInfo=null,e._subpasses=[],e._hash=0,e}return F(e,t),e.prototype.computeHash=function(){var t="";if(this._subpasses.length)for(var e=0;e<this._subpasses.length;++e){var n=this._subpasses[e];if(n.inputs.length){t+="ia";for(var i=0;i<n.inputs.length;++i){var r=this._colorInfos[n.inputs[i]];t+=","+r.format+","+r.sampleCount}}if(n.colors.length){t+="ca";for(var a=0;a<n.inputs.length;++a){var o=this._colorInfos[n.inputs[a]];t+=","+o.format+","+o.sampleCount}}if(n.depthStencil>=0){var s=this._colorInfos[n.depthStencil];t+="ds,"+s.format+","+s.sampleCount}}else{t+="ca";for(var c=0;c<this._colorInfos.length;++c){var l=this._colorInfos[c];t+=","+l.format+","+l.sampleCount}var u=this._depthStencilInfo;u&&(t+="ds,"+u.format+","+u.sampleCount)}return Po(t,666)},L(e,[{key:"colorAttachments",get:function(){return this._colorInfos}},{key:"depthStencilAttachment",get:function(){return this._depthStencilInfo}},{key:"subPasses",get:function(){return this._subpasses}},{key:"hash",get:function(){return this._hash}}]),e}(co),Go=function(t){function e(e,n){var i;return(i=t.call(this,mr.SAMPLER)||this)._info=new Ia,i._hash=0,i._info.copy(e),i._hash=n,i}return F(e,t),e.computeHash=function(t){var e=t.minFilter;return e|=t.magFilter<<2,e|=t.mipFilter<<4,e|=t.addressU<<6,e|=t.addressV<<8,e|=t.addressW<<10,(e|=t.maxAnisotropy<<12)|t.cmpFunc<<16},e.unpackFromHash=function(t){var e=new Ia;return e.minFilter=(3&t)>>0,e.magFilter=(3&t)>>2,e.mipFilter=(3&t)>>4,e.addressU=(3&t)>>6,e.addressV=(3&t)>>8,e.addressW=(3&t)>>10,e.maxAnisotropy=(15&t)>>12,e.cmpFunc=(7&t)>>16,e},L(e,[{key:"info",get:function(){return this._info}},{key:"hash",get:function(){return this._hash}}]),e}(co),Ho=function(t){function e(){var e;return(e=t.call(this,mr.SHADER)||this)._name="",e._stages=[],e._attributes=[],e._blocks=[],e._samplers=[],e}return F(e,t),L(e,[{key:"name",get:function(){return this._name}},{key:"attributes",get:function(){return this._attributes}},{key:"blocks",get:function(){return this._blocks}},{key:"samplers",get:function(){return this._samplers}}]),e}(co),Vo=function(t){function e(){var e;return(e=t.call(this,mr.TEXTURE)||this)._type=Pr.TEX2D,e._usage=Ir.NONE,e._format=Sr.UNKNOWN,e._width=0,e._height=0,e._depth=1,e._layerCount=1,e._levelCount=1,e._samples=Dr.ONE,e._flags=Rr.NONE,e._isPowerOf2=!1,e._size=0,e}return F(e,t),L(e,[{key:"type",get:function(){return this._type}},{key:"usage",get:function(){return this._usage}},{key:"format",get:function(){return this._format}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"depth",get:function(){return this._depth}},{key:"layerCount",get:function(){return this._layerCount}},{key:"levelCount",get:function(){return this._levelCount}},{key:"samples",get:function(){return this._samples}},{key:"flags",get:function(){return this._flags}},{key:"size",get:function(){return this._size}}]),e}(co),jo=function(t){function e(e,n){var i;return(i=t.call(this,mr.GLOBAL_BARRIER)||this)._info=new qa,i._hash=0,i._info.copy(e),i._hash=n,i}return F(e,t),e.computeHash=function(t){for(var e="prev:",n=0;n<t.prevAccesses.length;++n)e+=" "+t.prevAccesses[n];e+="next:";for(var i=0;i<t.nextAccesses.length;++i)e+=" "+t.nextAccesses[i];return Po(e,666)},L(e,[{key:"info",get:function(){return this._info}},{key:"hash",get:function(){return this._hash}}]),e}(co),Wo=function(t){function e(e,n){var i;return(i=t.call(this,mr.TEXTURE_BARRIER)||this)._info=new Ya,i._hash=0,i._info.copy(e),i._hash=n,i}return F(e,t),e.computeHash=function(t){for(var e="prev:",n=0;n<t.prevAccesses.length;++n)e+=" "+t.prevAccesses[n];e+="next:";for(var i=0;i<t.nextAccesses.length;++i)e+=" "+t.nextAccesses[i];return e+=t.discardContents,e+=t.srcQueue?t.srcQueue.type:0,Po(e+=t.dstQueue?t.dstQueue.type:0,666)},L(e,[{key:"info",get:function(){return this._info}},{key:"hash",get:function(){return this._hash}}]),e}(co),Xo={Device:Ao,Swapchain:Eo,Buffer:So,Texture:Vo,Sampler:Go,Shader:Ho,InputAssembler:Io,RenderPass:ko,Framebuffer:Co,DescriptorSet:Ro,DescriptorSetLayout:Do,PipelineLayout:Oo,PipelineState:zo,CommandBuffer:To,Queue:Uo,GlobalBarrier:jo,TextureBarrier:Wo,RasterizerState:Mo,BlendState:Bo,BlendTarget:Lo,DepthStencilState:No,PipelineStateInfo:Fo};Object.assign(Xo,xo),i.gfx=Xo;var qo,Yo={Obj:"GFXObject",DRAW_INFO_SIZE:"GFX_DRAW_INFO_SIZE",DESCRIPTOR_BUFFER_TYPE:"",DESCRIPTOR_SAMPLER_TYPE:"",DESCRIPTOR_DYNAMIC_TYPE:"",getTypedArrayConstructor:""};for(var Ko in i.gfx)if("__esModule"!==Ko){var Qo=Yo[Ko];""===Qo?Qo=Ko:void 0===Qo&&(Qo="GFX"+Ko),Nn(i,"cc",[{name:Qo,newName:Ko,target:i.gfx,targetName:"cc.gfx"}])}t("gfx",Object.freeze({__proto__:null,DescriptorSet:Ro,Buffer:So,CommandBuffer:To,get ObjectType(){return mr},get Status(){return gr},get API(){return vr},get SurfaceTransform(){return yr},get Feature(){return xr},get Format(){return Sr},get FormatType(){return Tr},get Type(){return Ar},get BufferUsageBit(){return Er},get BufferFlagBit(){return Cr},get MemoryAccessBit(){return br},get MemoryUsageBit(){return wr},get TextureType(){return Pr},get TextureUsageBit(){return Ir},get TextureFlagBit(){return Rr},get SampleCount(){return Dr},get VsyncMode(){return Or},get Filter(){return Mr},get Address(){return Nr},get ComparisonFunc(){return Lr},get StencilOp(){return Br},get BlendFactor(){return Fr},get BlendOp(){return zr},get ColorMask(){return Ur},get ShaderStageFlagBit(){return kr},get LoadOp(){return Gr},get StoreOp(){return Hr},get AccessType(){return Vr},get ResolveMode(){return jr},get PipelineBindPoint(){return Wr},get PrimitiveMode(){return Xr},get PolygonMode(){return qr},get ShadeModel(){return Yr},get CullMode(){return Kr},get DynamicStateFlagBit(){return Qr},get StencilFace(){return Zr},get DescriptorType(){return Jr},get QueueType(){return $r},get QueryType(){return ta},get CommandBufferType(){return ea},get ClearFlagBit(){return na},Size:sa,DeviceCaps:ca,Offset:la,Rect:ua,Extent:ha,TextureSubresLayers:fa,TextureSubresRange:_a,TextureCopy:pa,TextureBlit:da,BufferTextureCopy:ma,Viewport:ga,Color:va,BindingMappingInfo:ya,SwapchainInfo:xa,DeviceInfo:Sa,BufferInfo:Ta,BufferViewInfo:Aa,DrawInfo:Ea,DispatchInfo:Ca,IndirectBuffer:ba,TextureInfo:wa,TextureViewInfo:Pa,SamplerInfo:Ia,Uniform:Ra,UniformBlock:Da,UniformSamplerTexture:Oa,UniformSampler:Ma,UniformTexture:Na,UniformStorageImage:La,UniformStorageBuffer:Ba,UniformInputAttachment:Fa,ShaderStage:za,Attribute:Ua,ShaderInfo:ka,InputAssemblerInfo:Ga,ColorAttachment:Ha,DepthStencilAttachment:Va,SubpassInfo:ja,SubpassDependency:Wa,RenderPassInfo:Xa,GlobalBarrierInfo:qa,TextureBarrierInfo:Ya,FramebufferInfo:Ka,DescriptorSetLayoutBinding:Qa,DescriptorSetLayoutInfo:Za,DescriptorSetInfo:Ja,PipelineLayoutInfo:$a,InputState:to,CommandBufferInfo:eo,QueueInfo:no,QueryPoolInfo:io,FormatInfo:ro,MemoryStatus:ao,DynamicStencilStates:oo,DynamicStates:so,GFXObject:co,get AttributeName(){return oa},FormatInfos:lo,DESCRIPTOR_BUFFER_TYPE:uo,DESCRIPTOR_SAMPLER_TYPE:ho,DESCRIPTOR_DYNAMIC_TYPE:fo,DRAW_INFO_SIZE:28,IsPowerOf2:_o,FormatSize:po,FormatSurfaceSize:mo,GetTypeSize:vo,getTypedArrayConstructor:yo,Device:Ao,Swapchain:Eo,Framebuffer:Co,InputAssembler:Io,DescriptorSetLayout:Do,PipelineLayout:Oo,RasterizerState:Mo,DepthStencilState:No,BlendTarget:Lo,BlendState:Bo,PipelineStateInfo:Fo,PipelineState:zo,Queue:Uo,RenderPass:ko,Sampler:Go,Shader:Ho,Texture:Vo,GlobalBarrier:jo,TextureBarrier:Wo})),function(t){t[t.ALL=0]="ALL",t[t.CLOSEST=1]="CLOSEST",t[t.ANY=2]="ANY"}(qo||(qo={}));var Zo,Jo,$o,ts,es,ns,is,rs,as=(Zo=new di(0,0,0),function(t,e){var n=di.dot(t.d,e.n);if(Math.abs(n)<Number.EPSILON)return 0;di.multiplyScalar(Zo,e.n,e.d);var i=di.dot(di.subtract(Zo,Zo,t.o),e.n)/n;return i<0?0:i}),os=(Jo=new di(0,0,0),$o=new di(0,0,0),ts=new di(0,0,0),es=new di(0,0,0),ns=new di(0,0,0),function(t,e,n){di.subtract(Jo,e.b,e.a),di.subtract($o,e.c,e.a),di.cross(ts,t.d,$o);var i=di.dot(Jo,ts);if(i<Number.EPSILON&&(!n||i>-Number.EPSILON))return 0;var r=1/i;di.subtract(es,t.o,e.a);var a=di.dot(es,ts)*r;if(a<0||a>1)return 0;di.cross(ns,es,Jo);var o=di.dot(t.d,ns)*r;if(o<0||a+o>1)return 0;var s=di.dot($o,ns)*r;return s<0?0:s}),ss=function(){var t=new di(0,0,0);return function(e,n){var i=n.radius,r=n.center,a=e.o,o=e.d,s=i*i;di.subtract(t,r,a);var c=t.lengthSqr(),l=di.dot(t,o),u=s-(c-l*l);if(u<0)return 0;var h=Math.sqrt(u),f=c<s?l+h:l-h;return f<0?0:f}}(),cs=(is=new di,rs=new di,function(t,e){return di.subtract(is,e.center,e.halfExtents),di.add(rs,e.center,e.halfExtents),ls(t,is,rs)});function ls(t,e,n){var i=t.o,r=t.d,a=1/r.x,o=1/r.y,s=1/r.z,c=(e.x-i.x)*a,l=(n.x-i.x)*a,u=(e.y-i.y)*o,h=(n.y-i.y)*o,f=(e.z-i.z)*s,_=(n.z-i.z)*s,p=Math.max(Math.max(Math.min(c,l),Math.min(u,h)),Math.min(f,_)),d=Math.min(Math.min(Math.max(c,l),Math.max(u,h)),Math.max(f,_));return d<0||p>d?0:p>0?p:d}var us,hs,fs,_s,ps=function(){var t=new di,e=new di,n=new di,i=new di,r=new di,a=new di,o=new di,s=new Array(3),c=new Array(3),l=new Array(3),u=new Array(6);return function(h,f){s[0]=f.halfExtents.x,s[1]=f.halfExtents.y,s[2]=f.halfExtents.z,t=f.center,e=h.o,n=h.d,di.set(i,f.orientation.m00,f.orientation.m01,f.orientation.m02),di.set(r,f.orientation.m03,f.orientation.m04,f.orientation.m05),di.set(a,f.orientation.m06,f.orientation.m07,f.orientation.m08),di.subtract(o,t,e),c[0]=di.dot(i,n),c[1]=di.dot(r,n),c[2]=di.dot(a,n),l[0]=di.dot(i,o),l[1]=di.dot(r,o),l[2]=di.dot(a,o);for(var _=0;_<3;++_){if(0===c[_]){if(-l[_]-s[_]>0||-l[_]+s[_]<0)return 0;c[_]=1e-7}u[2*_+0]=(l[_]+s[_])/c[_],u[2*_+1]=(l[_]-s[_])/c[_]}var p=Math.max(Math.max(Math.min(u[0],u[1]),Math.min(u[2],u[3])),Math.min(u[4],u[5])),d=Math.min(Math.min(Math.max(u[0],u[1]),Math.max(u[2],u[3])),Math.max(u[4],u[5]));return d<0||p>d?0:p>0?p:d}}(),ds=function(){var t=new di,e=new di,n=new di,i=new di,r=new di,a=new di,o=new di,s=new ia;return function(c,l){var u=l.radius*l.radius,h=di.normalize(t,c.d),f=l.ellipseCenter0,_=l.ellipseCenter1,p=di.subtract(e,_,f);if(p.equals(di.ZERO))return s.radius=l.radius,s.center.set(l.ellipseCenter0),$s.raySphere(c,s);var d=c.o,m=di.subtract(n,d,f),g=di.cross(i,h,p),v=g.lengthSqr();if(0===v){s.radius=l.radius;var y=di.subtract(r,_,d);return m.lengthSqr()<y.lengthSqr()?s.center.set(l.ellipseCenter0):s.center.set(l.ellipseCenter1),$s.raySphere(c,s)}var x=di.cross(r,m,p),S=p.lengthSqr(),T=2*di.dot(g,x),A=T*T-4*v*(x.lengthSqr()-u*S);if(A<0)return 0;var E=(-T-Math.sqrt(A))/(2*v);if(E<0){s.radius=l.radius;var C=di.subtract(a,_,d);return m.lengthSqr()<C.lengthSqr()?s.center.set(l.ellipseCenter0):s.center.set(l.ellipseCenter1),$s.raySphere(c,s)}var b=di.scaleAndAdd(a,c.o,h,E),w=di.subtract(o,b,f),P=di.dot(w,p)/S;return P>=0&&P<=1?E:P<0?(s.radius=l.radius,s.center.set(l.ellipseCenter0),$s.raySphere(c,s)):P>1?(s.radius=l.radius,s.center.set(l.ellipseCenter1),$s.raySphere(c,s)):0}}(),ms=(us=ra.create(),hs={distance:1/0,doubleSided:!1,mode:qo.ANY},fs=0,_s=function(t,e,n,i,r,a){t===qo.CLOSEST?(fs>e||0===fs)&&(fs=e,a&&(0===a.length?a.push({distance:e,vertexIndex0:n/3,vertexIndex1:i/3,vertexIndex2:r/3}):(a[0].distance=e,a[0].vertexIndex0=n/3,a[0].vertexIndex1=i/3,a[0].vertexIndex2=r/3))):(fs=e,a&&a.push({distance:e,vertexIndex0:n/3,vertexIndex1:i/3,vertexIndex2:r/3}))},function(t,e,n){if(fs=0,0===e.geometricInfo.positions.length)return fs;var i=void 0===n?hs:n;if(ls(t,e.geometricInfo.boundingBox.min,e.geometricInfo.boundingBox.max)){var r=e.primitiveMode,a=e.geometricInfo;!function(t,e,n,i,r){if(n===Xr.TRIANGLE_LIST)for(var a=e.length,o=0;o<a;o+=3){var s=3*e[o],c=3*e[o+1],l=3*e[o+2];di.set(us.a,t[s],t[s+1],t[s+2]),di.set(us.b,t[c],t[c+1],t[c+2]),di.set(us.c,t[l],t[l+1],t[l+2]);var u=$s.rayTriangle(i,us,r.doubleSided);if(!(0===u||u>r.distance)&&(_s(r.mode,u,s,c,l,r.result),r.mode===qo.ANY))return u}else if(n===Xr.TRIANGLE_STRIP)for(var h=e.length-2,f=0,_=0;_<h;_+=1){var p=3*e[_-f],d=3*e[_+f+1],m=3*e[_+2];di.set(us.a,t[p],t[p+1],t[p+2]),di.set(us.b,t[d],t[d+1],t[d+2]),di.set(us.c,t[m],t[m+1],t[m+2]),f=~f;var g=$s.rayTriangle(i,us,r.doubleSided);if(!(0===g||g>r.distance)&&(_s(r.mode,g,p,d,m,r.result),r.mode===qo.ANY))return g}else if(n===Xr.TRIANGLE_FAN){var v=e.length-1,y=3*e[0];di.set(us.a,t[y],t[y+1],t[y+2]);for(var x=1;x<v;x+=1){var S=3*e[x],T=3*e[x+1];di.set(us.b,t[S],t[S+1],t[S+2]),di.set(us.c,t[T],t[T+1],t[T+2]);var A=$s.rayTriangle(i,us,r.doubleSided);if(!(0===A||A>r.distance)&&(_s(r.mode,A,y,S,T,r.result),r.mode===qo.ANY))return A}}}(a.positions,a.indices,r,t,i)}return fs}),gs=function(){var t=0,e={distance:1/0,doubleSided:!1,mode:qo.ANY};return function(n,i,r){t=0;var a=void 0===r?e:r,o=i.renderingSubMeshes.length,s=i.struct.minPosition,c=i.struct.maxPosition;if(s&&c&&!ls(n,s,c))return t;for(var l=0;l<o;l++){var u=i.renderingSubMeshes[l],h=ms(n,u,a);if(h)if(a.mode===qo.CLOSEST)(0===t||t>h)&&(t=h,a.subIndices&&(a.subIndices[0]=l));else if(t=h,a.subIndices&&a.subIndices.push(l),a.mode===qo.ANY)return h}return t&&a.mode===qo.CLOSEST&&(a.result&&(a.result[0].distance=t,a.result.length=1),a.subIndices&&(a.subIndices.length=1)),t}}(),vs=function(){var t=0,e={distance:1/0,doubleSided:!1,mode:qo.ANY},n=new ur,i=new Ri;return function(r,a,o){t=0;var s=void 0===o?e:o,c=a.worldBounds;if(c&&!cs(r,c))return t;ur.copy(n,r),a.node&&(Ri.invert(i,a.node.getWorldMatrix(i)),di.transformMat4(n.o,r.o,i),di.transformMat4Normal(n.d,r.d,i));for(var l=a.subModels,u=0;u<l.length;u++){var h=l[u].subMesh,f=ms(n,h,s);if(f)if(s.mode===qo.CLOSEST)(0===t||t>f)&&(t=f,s.subIndices&&(s.subIndices[0]=u));else if(t=f,s.subIndices&&s.subIndices.push(u),s.mode===qo.ANY)return f}return t&&s.mode===qo.CLOSEST&&(s.result&&(s.result[0].distance=t,s.result.length=1),s.subIndices&&(s.subIndices.length=1)),t}}(),ys=function(){var t=new di(0,0,0);return function(e,n){di.subtract(t,e.e,e.s);var i=(n.d-di.dot(e.s,n.n))/di.dot(t,n.n);return i<0||i>1?0:i}}(),xs=function(){var t=new di(0,0,0),e=new di(0,0,0),n=new di(0,0,0),i=new di(0,0,0),r=new di(0,0,0),a=new di(0,0,0);return function(o,s,c){di.subtract(t,s.b,s.a),di.subtract(e,s.c,s.a),di.subtract(n,o.s,o.e),di.cross(r,t,e);var l=di.dot(n,r);if(l<=0)return 0;di.subtract(i,o.s,s.a);var u=di.dot(i,r);if(u<0||u>l)return 0;di.cross(a,n,i);var h=di.dot(e,a);if(h<0||h>l)return 0;var f=-di.dot(t,a);if(f<0||h+f>l)return 0;if(c){var _=1/l,p=1-(h*=_)-(f*=_);di.set(c,s.a.x*p+s.b.x*h+s.c.x*f,s.a.y*p+s.b.y*h+s.c.y*f,s.a.z*p+s.b.z*h+s.c.z*f)}return 1}}(),Ss=new ur;function Ts(t,e){Ss.o.set(t.s),di.subtract(Ss.d,t.e,t.s),Ss.d.normalize();var n=cs(Ss,e);return n<=t.length()?n:0}function As(t,e){Ss.o.set(t.s),di.subtract(Ss.d,t.e,t.s),Ss.d.normalize();var n=ps(Ss,e);return n<=t.length()?n:0}function Es(t,e){Ss.o.set(t.s),di.subtract(Ss.d,t.e,t.s),Ss.d.normalize();var n=ss(Ss,e);return n<=t.length()?n:0}var Cs,bs,ws,Ps,Is=(Cs=new di,bs=new di,ws=new di,Ps=new di,function(t,e){return di.subtract(Cs,t.center,t.halfExtents),di.add(bs,t.center,t.halfExtents),di.subtract(ws,e.center,e.halfExtents),di.add(Ps,e.center,e.halfExtents),Cs.x<=Ps.x&&bs.x>=ws.x&&Cs.y<=Ps.y&&bs.y>=ws.y&&Cs.z<=Ps.z&&bs.z>=ws.z});function Rs(t,e,n,i,r,a){di.set(a[0],t.x+n.x*e.x+i.x*e.y+r.x*e.z,t.y+n.y*e.x+i.y*e.y+r.y*e.z,t.z+n.z*e.x+i.z*e.y+r.z*e.z),di.set(a[1],t.x-n.x*e.x+i.x*e.y+r.x*e.z,t.y-n.y*e.x+i.y*e.y+r.y*e.z,t.z-n.z*e.x+i.z*e.y+r.z*e.z),di.set(a[2],t.x+n.x*e.x-i.x*e.y+r.x*e.z,t.y+n.y*e.x-i.y*e.y+r.y*e.z,t.z+n.z*e.x-i.z*e.y+r.z*e.z),di.set(a[3],t.x+n.x*e.x+i.x*e.y-r.x*e.z,t.y+n.y*e.x+i.y*e.y-r.y*e.z,t.z+n.z*e.x+i.z*e.y-r.z*e.z),di.set(a[4],t.x-n.x*e.x-i.x*e.y-r.x*e.z,t.y-n.y*e.x-i.y*e.y-r.y*e.z,t.z-n.z*e.x-i.z*e.y-r.z*e.z),di.set(a[5],t.x+n.x*e.x-i.x*e.y-r.x*e.z,t.y+n.y*e.x-i.y*e.y-r.y*e.z,t.z+n.z*e.x-i.z*e.y-r.z*e.z),di.set(a[6],t.x-n.x*e.x+i.x*e.y-r.x*e.z,t.y-n.y*e.x+i.y*e.y-r.y*e.z,t.z-n.z*e.x+i.z*e.y-r.z*e.z),di.set(a[7],t.x-n.x*e.x-i.x*e.y+r.x*e.z,t.y-n.y*e.x-i.y*e.y+r.y*e.z,t.z-n.z*e.x-i.z*e.y+r.z*e.z)}function Ds(t,e){for(var n=di.dot(e,t[0]),i=n,r=1;r<8;++r){var a=di.dot(e,t[r]);n=a<n?a:n,i=a>i?a:i}return[n,i]}var Os,Ms,Ns,Ls=function(){for(var t=new Array(15),e=0;e<15;e++)t[e]=new di(0,0,0);for(var n=new Array(8),i=new Array(8),r=0;r<8;r++)n[r]=new di(0,0,0),i[r]=new di(0,0,0);var a=new di,o=new di;return function(e,r){di.set(t[0],1,0,0),di.set(t[1],0,1,0),di.set(t[2],0,0,1),di.set(t[3],r.orientation.m00,r.orientation.m01,r.orientation.m02),di.set(t[4],r.orientation.m03,r.orientation.m04,r.orientation.m05),di.set(t[5],r.orientation.m06,r.orientation.m07,r.orientation.m08);for(var s=0;s<3;++s)di.cross(t[6+3*s],t[s],t[3]),di.cross(t[7+3*s],t[s],t[4]),di.cross(t[7+3*s],t[s],t[5]);di.subtract(a,e.center,e.halfExtents),di.add(o,e.center,e.halfExtents),function(t,e,n){di.set(n[0],t.x,e.y,e.z),di.set(n[1],t.x,e.y,t.z),di.set(n[2],t.x,t.y,e.z),di.set(n[3],t.x,t.y,t.z),di.set(n[4],e.x,e.y,e.z),di.set(n[5],e.x,e.y,t.z),di.set(n[6],e.x,t.y,e.z),di.set(n[7],e.x,t.y,t.z)}(a,o,n),Rs(r.center,r.halfExtents,t[3],t[4],t[5],i);for(var c=0;c<15;++c){var l=Ds(n,t[c]),u=Ds(i,t[c]);if(u[0]>l[1]||l[0]>u[1])return 0}return 1}}(),Bs=function(t,e){var n=t.halfExtents.x*Math.abs(e.n.x)+t.halfExtents.y*Math.abs(e.n.y)+t.halfExtents.z*Math.abs(e.n.z),i=di.dot(e.n,t.center);return i+n<e.d?-1:i-n>e.d?0:1},Fs=function(t,e){for(var n=0;n<e.planes.length;n++)if(-1===Bs(t,e.planes[n]))return 0;return 1},zs=function(){for(var t=new Array(8),e=0,n=0,i=0;i<t.length;i++)t[i]=new di(0,0,0);return function(i,r){for(var a=0,o=!1,s=0;s<r.planes.length;s++){if(-1===(a=Bs(i,r.planes[s])))return 0;1===a&&(o=!0)}if(!o)return 1;for(var c=0;c<r.vertices.length;c++)di.subtract(t[c],r.vertices[c],i.center);e=0,n=0;for(var l=0;l<r.vertices.length;l++)t[l].x>i.halfExtents.x?e++:t[l].x<-i.halfExtents.x&&n++;if(e===r.vertices.length||n===r.vertices.length)return 0;e=0,n=0;for(var u=0;u<r.vertices.length;u++)t[u].y>i.halfExtents.y?e++:t[u].y<-i.halfExtents.y&&n++;if(e===r.vertices.length||n===r.vertices.length)return 0;e=0,n=0;for(var h=0;h<r.vertices.length;h++)t[h].z>i.halfExtents.z?e++:t[h].z<-i.halfExtents.z&&n++;return e===r.vertices.length||n===r.vertices.length?0:1}}(),Us=(Os=new di(0,0,0),Ms=new yi,function(t,e){return di.subtract(Os,e,t.center),di.transformMat3(Os,Os,yi.transpose(Ms,t.orientation)),n=Os,i=t.halfExtents,Math.abs(n.x)<i.x&&Math.abs(n.y)<i.y&&Math.abs(n.z)<i.z;var n,i}),ks=(Ns=function(t,e,n,i){return Math.abs(t.x*e+t.y*n+t.z*i)},function(t,e){var n=t.halfExtents.x*Ns(e.n,t.orientation.m00,t.orientation.m01,t.orientation.m02)+t.halfExtents.y*Ns(e.n,t.orientation.m03,t.orientation.m04,t.orientation.m05)+t.halfExtents.z*Ns(e.n,t.orientation.m06,t.orientation.m07,t.orientation.m08),i=di.dot(e.n,t.center);return i+n<e.d?-1:i-n>e.d?0:1}),Gs=function(t,e){for(var n=0;n<e.planes.length;n++)if(-1===ks(t,e.planes[n]))return 0;return 1},Hs=function(){for(var t=new Array(8),e=0,n=0,i=0,r=0;r<t.length;r++)t[r]=new di(0,0,0);var a=function(t,e,n,i){return t.x*e+t.y*n+t.z*i};return function(r,o){for(var s=0,c=!1,l=0;l<o.planes.length;l++){if(-1===(s=ks(r,o.planes[l])))return 0;1===s&&(c=!0)}if(!c)return 1;for(var u=0;u<o.vertices.length;u++)di.subtract(t[u],o.vertices[u],r.center);n=0,i=0;for(var h=0;h<o.vertices.length;h++)(e=a(t[h],r.orientation.m00,r.orientation.m01,r.orientation.m02))>r.halfExtents.x?n++:e<-r.halfExtents.x&&i++;if(n===o.vertices.length||i===o.vertices.length)return 0;n=0,i=0;for(var f=0;f<o.vertices.length;f++)(e=a(t[f],r.orientation.m03,r.orientation.m04,r.orientation.m05))>r.halfExtents.y?n++:e<-r.halfExtents.y&&i++;if(n===o.vertices.length||i===o.vertices.length)return 0;n=0,i=0;for(var _=0;_<o.vertices.length;_++)(e=a(t[_],r.orientation.m06,r.orientation.m07,r.orientation.m08))>r.halfExtents.z?n++:e<-r.halfExtents.z&&i++;return n===o.vertices.length||i===o.vertices.length?0:1}}(),Vs=function(){for(var t=new Array(15),e=0;e<15;e++)t[e]=new di(0,0,0);for(var n=new Array(8),i=new Array(8),r=0;r<8;r++)n[r]=new di(0,0,0),i[r]=new di(0,0,0);return function(e,r){di.set(t[0],e.orientation.m00,e.orientation.m01,e.orientation.m02),di.set(t[1],e.orientation.m03,e.orientation.m04,e.orientation.m05),di.set(t[2],e.orientation.m06,e.orientation.m07,e.orientation.m08),di.set(t[3],r.orientation.m00,r.orientation.m01,r.orientation.m02),di.set(t[4],r.orientation.m03,r.orientation.m04,r.orientation.m05),di.set(t[5],r.orientation.m06,r.orientation.m07,r.orientation.m08);for(var a=0;a<3;++a)di.cross(t[6+3*a],t[a],t[3]),di.cross(t[7+3*a],t[a],t[4]),di.cross(t[8+3*a],t[a],t[5]);Rs(e.center,e.halfExtents,t[0],t[1],t[2],n),Rs(r.center,r.halfExtents,t[3],t[4],t[5],i);for(var o=0;o<15;++o){var s=Ds(n,t[o]),c=Ds(i,t[o]);if(c[0]>s[1]||s[0]>c[1])return 0}return 1}}(),js=function(){for(var t=new ia,e=new di,n=new di,i=new di,r=new Array(8),a=0;a<8;a++)r[a]=new di;for(var o=new Array(8),s=0;s<8;s++)o[s]=new di;return function(a,s){if(0===di.squaredDistance(s.ellipseCenter0,s.ellipseCenter1))return t.radius=s.radius,t.center.set(s.ellipseCenter0),$s.sphereOBB(t,a);e.x=a.orientation.m00,e.y=a.orientation.m01,e.z=a.orientation.m02,n.x=a.orientation.m03,n.y=a.orientation.m04,n.z=a.orientation.m05,i.x=a.orientation.m06,i.y=a.orientation.m07,i.z=a.orientation.m08,Rs(a.center,a.halfExtents,e,n,i,r);var c=o,l=di.copy(c[0],e),u=di.copy(c[1],n),h=di.copy(c[2],i);di.subtract(c[3],s.center,a.center).normalize();var f=di.subtract(c[4],s.ellipseCenter0,s.ellipseCenter1);f.normalize(),di.cross(c[5],l,f),di.cross(c[6],u,f),di.cross(c[7],h,f);for(var _=0;_<8;++_){var p=Ds(r,c[_]),d=di.dot(c[_],s.ellipseCenter0),m=di.dot(c[_],s.ellipseCenter1),g=Math.max(d,m),v=Math.min(d,m)-s.radius,y=g+s.radius;if(v>p[1]||p[0]>y)return 0}return 1}}(),Ws=function(t,e){var n=di.dot(e.n,t.center),i=t.radius*e.n.length();return n+i<e.d?-1:n-i>e.d?0:1},Xs=function(t,e){for(var n=0;n<e.planes.length;n++)if(-1===Ws(t,e.planes[n]))return 0;return 1},qs=function(){var t=new di(0,0,0),e=[1,-1,1,-1,1,-1];return function(n,i){for(var r=0;r<6;r++){var a=i.planes[r],o=n.radius,s=n.center,c=a.n,l=a.d,u=di.dot(c,s);if(u+o<l)return 0;if(!(u-o>l)){di.add(t,s,di.multiplyScalar(t,c,o));for(var h=0;h<6;h++)if(h!==r&&h!==r+e[r]){var f=i.planes[h];if(di.dot(f.n,t)<f.d)return 0}}}return 1}}(),Ys=function(t,e){var n=t.radius+e.radius;return di.squaredDistance(t.center,e.center)<n*n},Ks=function(){var t=new di;return function(e,n){return ar(t,e.center,n),di.squaredDistance(e.center,t)<e.radius*e.radius}}(),Qs=function(){var t=new di;return function(e,n){return or(t,e.center,n),di.squaredDistance(e.center,t)<e.radius*e.radius}}(),Zs=function(){var t=new di,e=new di;return function(n,i){var r=n.radius+i.radius,a=r*r,o=di.squaredDistance(i.ellipseCenter0,i.ellipseCenter1);if(0===o)return di.squaredDistance(n.center,i.center)<a;di.subtract(t,n.center,i.ellipseCenter0),di.subtract(e,i.ellipseCenter1,i.ellipseCenter0);var s=di.dot(t,e)/o;return s<0?di.squaredDistance(n.center,i.ellipseCenter0)<a:s>1?di.squaredDistance(n.center,i.ellipseCenter1)<a:(di.scaleAndAdd(t,i.ellipseCenter0,e,s),di.squaredDistance(n.center,t)<a)}}(),Js=function(){var t=new di,e=new di,n=new di,i=new di,r=new di,a=new di;return function(o,s){var c,l,u=di.subtract(t,o.ellipseCenter1,o.ellipseCenter0),h=di.subtract(e,s.ellipseCenter1,s.ellipseCenter0),f=di.subtract(n,o.ellipseCenter0,s.ellipseCenter0),_=di.dot(u,u),p=di.dot(u,h),d=di.dot(h,h),m=di.dot(u,f),g=di.dot(h,f),v=_*d-p*p,y=v,x=v;v<Wn?(c=0,y=1,l=g,x=d):(l=_*g-p*m,(c=p*g-d*m)<0?(c=0,l=g,x=d):c>y&&(c=y,l=g+p,x=d)),l<0?(l=0,-m<0?c=0:-m>_?c=y:(c=-m,y=_)):l>x&&(l=x,-m+p<0?c=0:-m+p>_?c=y:(c=-m+p,y=_));var S=Math.abs(c)<Wn?0:c/y,T=Math.abs(l)<Wn?0:l/x,A=i;A.set(f),A.add(di.multiplyScalar(r,u,S)),A.subtract(di.multiplyScalar(a,h,T));var E=o.radius+s.radius;return A.lengthSqr()<E*E}}(),$s={raySphere:ss,rayAABB:cs,rayOBB:ps,rayPlane:as,rayTriangle:os,rayCapsule:ds,raySubMesh:ms,rayMesh:gs,rayModel:vs,lineSphere:Es,lineAABB:Ts,lineOBB:As,linePlane:ys,lineTriangle:xs,sphereWithSphere:Ys,sphereAABB:Ks,sphereOBB:Qs,spherePlane:Ws,sphereFrustum:Xs,sphereFrustumAccurate:qs,sphereCapsule:Zs,aabbWithAABB:Is,aabbWithOBB:Ls,aabbPlane:Bs,aabbFrustum:Fs,aabbFrustumAccurate:zs,obbWithOBB:Vs,obbPlane:ks,obbFrustum:Gs,obbFrustumAccurate:Hs,obbPoint:Us,obbCapsule:js,capsuleWithCapsule:Js,resolve:function(t,e,n){void 0===n&&(n=null);var i=t._type,r=e._type,a=this[i|r];return i<r?a(t,e,n):a(e,t,n)}};$s[cr.SHAPE_RAY|cr.SHAPE_SPHERE]=ss,$s[cr.SHAPE_RAY|cr.SHAPE_AABB]=cs,$s[cr.SHAPE_RAY|cr.SHAPE_OBB]=ps,$s[cr.SHAPE_RAY|cr.SHAPE_PLANE]=as,$s[cr.SHAPE_RAY|cr.SHAPE_TRIANGLE]=os,$s[cr.SHAPE_RAY|cr.SHAPE_CAPSULE]=ds,$s[cr.SHAPE_LINE|cr.SHAPE_SPHERE]=Es,$s[cr.SHAPE_LINE|cr.SHAPE_AABB]=Ts,$s[cr.SHAPE_LINE|cr.SHAPE_OBB]=As,$s[cr.SHAPE_LINE|cr.SHAPE_PLANE]=ys,$s[cr.SHAPE_LINE|cr.SHAPE_TRIANGLE]=xs,$s[cr.SHAPE_SPHERE]=Ys,$s[cr.SHAPE_SPHERE|cr.SHAPE_AABB]=Ks,$s[cr.SHAPE_SPHERE|cr.SHAPE_OBB]=Qs,$s[cr.SHAPE_SPHERE|cr.SHAPE_PLANE]=Ws,$s[cr.SHAPE_SPHERE|cr.SHAPE_FRUSTUM]=Xs,$s[cr.SHAPE_SPHERE|cr.SHAPE_FRUSTUM_ACCURATE]=qs,$s[cr.SHAPE_SPHERE|cr.SHAPE_CAPSULE]=Zs,$s[cr.SHAPE_AABB]=Is,$s[cr.SHAPE_AABB|cr.SHAPE_OBB]=Ls,$s[cr.SHAPE_AABB|cr.SHAPE_PLANE]=Bs,$s[cr.SHAPE_AABB|cr.SHAPE_FRUSTUM]=Fs,$s[cr.SHAPE_AABB|cr.SHAPE_FRUSTUM_ACCURATE]=zs,$s[cr.SHAPE_OBB]=Vs,$s[cr.SHAPE_OBB|cr.SHAPE_PLANE]=ks,$s[cr.SHAPE_OBB|cr.SHAPE_FRUSTUM]=Gs,$s[cr.SHAPE_OBB|cr.SHAPE_FRUSTUM_ACCURATE]=Hs,$s[cr.SHAPE_OBB|cr.SHAPE_CAPSULE]=js,$s[cr.SHAPE_CAPSULE]=Js,Nn(lr.prototype,"line",[{name:"mag",newName:"len"},{name:"magnitude",newName:"len"}]),Ln($s,"intersect",[{name:"line_quad"}]);var tc,ec,nc,ic,rc,ac,oc,sc=new di(0,0,0),cc=new di(0,0,0),lc=i.mat4(),uc=i.v4(),hc=function(){function t(t,e,n,i){void 0===t&&(t=0),void 0===e&&(e=1),void 0===n&&(n=0),void 0===i&&(i=0),this.n=void 0,this.d=void 0,this._type=void 0,this._type=cr.SHAPE_PLANE,this.n=new di(t,e,n),this.d=i}return t.create=function(e,n,i,r){return new t(e,n,i,r)},t.clone=function(e){return new t(e.n.x,e.n.y,e.n.z,e.d)},t.copy=function(t,e){return di.copy(t.n,e.n),t.d=e.d,t},t.fromPoints=function(t,e,n,i){return di.subtract(sc,n,e),di.subtract(cc,i,e),di.normalize(t.n,di.cross(t.n,sc,cc)),t.d=di.dot(t.n,e),t},t.set=function(t,e,n,i,r){return t.n.x=e,t.n.y=n,t.n.z=i,t.d=r,t},t.fromNormalAndPoint=function(t,e,n){return di.copy(t.n,e),t.d=di.dot(e,n),t},t.normalize=function(t,e){var n=e.n.length();return di.normalize(t.n,e.n),n>0&&(t.d=e.d/n),t},t.prototype.transform=function(t){Ri.invert(lc,t),Ri.transpose(lc,lc),zi.set(uc,this.n.x,this.n.y,this.n.z,this.d),zi.transformMat4(uc,uc,lc),di.set(this.n,uc.x,uc.y,uc.z),this.d=uc.w},L(t,[{key:"type",get:function(){return this._type}},{key:"x",get:function(){return this.n.x},set:function(t){this.n.x=t}},{key:"y",get:function(){return this.n.y},set:function(t){this.n.y=t}},{key:"z",get:function(){return this.n.z},set:function(t){this.n.z=t}},{key:"w",get:function(){return this.d},set:function(t){this.d=t}}]),t}(),fc=function(){function t(t,e,n){this._arrayBuffers=[],this._chunkSize=void 0,this._chunkSize=n*(1<<e)}return t.prototype.allocateNewChunk=function(){return new ArrayBuffer(this._chunkSize)},t}();!function(t){t[t.UINT32=0]="UINT32",t[t.FLOAT32=1]="FLOAT32",t[t.NEVER=2]="NEVER"}(oc||(oc={}));var _c,pc,dc=function(){function t(t,e,n,i,r){void 0===r&&(r=8),this._dataType=void 0,this._dataMembers=void 0,this._elementCount=void 0,this._entryBits=void 0,this._stride=void 0,this._entriesPerChunk=void 0,this._entryMask=void 0,this._chunkMask=void 0,this._poolFlag=void 0,this._arrayBuffers=[],this._freeLists=[],this._uint32BufferViews=[],this._float32BufferViews=[],this._hasUint32=!1,this._hasFloat32=!1,this._nativePool=void 0,this._elementCount=i.COUNT,this._entryBits=r,this._dataType=e,this._dataMembers=n,this._stride=4*this._elementCount,this._entriesPerChunk=1<<r,this._entryMask=this._entriesPerChunk-1,this._poolFlag=1<<30,this._chunkMask=~(this._entryMask|this._poolFlag),this._nativePool=new fc(t,r,this._stride);var a=oc.NEVER,o=!1,s=!1;for(var c in e){if(o=this._hasFloat32,(s=this._hasUint32)&&o)break;a=e[c],o||a!==oc.FLOAT32?s||a!==oc.UINT32||(this._hasUint32=!0):this._hasFloat32=!0}}var e=t.prototype;return e.alloc=function(){for(var t=0;t<this._freeLists.length;t++){var e=this._freeLists[t];if(e.length){var n=e[e.length-1];return e.length--,(t<<this._entryBits)+n+this._poolFlag}}for(var i=this._nativePool.allocateNewChunk(),r=[],a=[],o=[],s=this._hasFloat32,c=this._hasUint32,l=0;l<this._entriesPerChunk;l++)s&&r.push(new Float32Array(i,this._stride*l,this._elementCount)),c&&a.push(new Uint32Array(i,this._stride*l,this._elementCount)),l&&o.push(l);return c&&this._uint32BufferViews.push(a),s&&this._float32BufferViews.push(r),this._freeLists.push(o),this._arrayBuffers.push(i),(t<<this._entryBits)+this._poolFlag},e.getBuffer=function(t){var e=(this._chunkMask&t)>>this._entryBits,n=this._entryMask&t;return(this._hasFloat32?this._float32BufferViews:this._uint32BufferViews)[e][n]},e.getTypedArray=function(t,e){var n=(this._chunkMask&t)>>this._entryBits,i=this._entryMask&t,r=e,a=(this._dataType[e]===oc.UINT32?this._uint32BufferViews:this._float32BufferViews)[n][i],o=this._dataMembers[e];return a.subarray(r,r+o)},e.free=function(t){var e=(this._chunkMask&t)>>this._entryBits,n=this._entryMask&t;(this._hasUint32?this._uint32BufferViews:this._float32BufferViews)[e][n].fill(0),this._freeLists[e].push(n)},t}();!function(t){t[t.NODE=0]="NODE",t[t.PASS=1]="PASS",t[t.AABB=2]="AABB"}(_c||(_c={})),function(t){t[t.DIRTY_FLAG=0]="DIRTY_FLAG",t[t.LAYER=1]="LAYER",t[t.WORLD_SCALE=2]="WORLD_SCALE",t[t.WORLD_POSITION=5]="WORLD_POSITION",t[t.WORLD_ROTATION=8]="WORLD_ROTATION",t[t.WORLD_MATRIX=12]="WORLD_MATRIX",t[t.LOCAL_SCALE=28]="LOCAL_SCALE",t[t.LOCAL_POSITION=31]="LOCAL_POSITION",t[t.LOCAL_ROTATION=34]="LOCAL_ROTATION",t[t.COUNT=38]="COUNT"}(pc||(pc={}));var mc,gc=((tc={})[pc.DIRTY_FLAG]=oc.UINT32,tc[pc.LAYER]=oc.UINT32,tc[pc.WORLD_SCALE]=oc.FLOAT32,tc[pc.WORLD_POSITION]=oc.FLOAT32,tc[pc.WORLD_ROTATION]=oc.FLOAT32,tc[pc.WORLD_MATRIX]=oc.FLOAT32,tc[pc.LOCAL_SCALE]=oc.FLOAT32,tc[pc.LOCAL_POSITION]=oc.FLOAT32,tc[pc.LOCAL_ROTATION]=oc.FLOAT32,tc[pc.COUNT]=oc.NEVER,tc),vc=((ec={})[pc.DIRTY_FLAG]=pc.LAYER-pc.DIRTY_FLAG,ec[pc.LAYER]=pc.WORLD_SCALE-pc.LAYER,ec[pc.WORLD_SCALE]=pc.WORLD_POSITION-pc.WORLD_SCALE,ec[pc.WORLD_POSITION]=pc.WORLD_ROTATION-pc.WORLD_POSITION,ec[pc.WORLD_ROTATION]=pc.WORLD_MATRIX-pc.WORLD_ROTATION,ec[pc.WORLD_MATRIX]=pc.LOCAL_SCALE-pc.WORLD_MATRIX,ec[pc.LOCAL_SCALE]=pc.LOCAL_POSITION-pc.LOCAL_SCALE,ec[pc.LOCAL_POSITION]=pc.LOCAL_ROTATION-pc.LOCAL_POSITION,ec[pc.LOCAL_ROTATION]=pc.COUNT-pc.LOCAL_ROTATION,ec[pc.COUNT]=1,ec),yc=new dc(_c.NODE,gc,vc,pc);!function(t){t[t.PRIORITY=0]="PRIORITY",t[t.STAGE=1]="STAGE",t[t.PHASE=2]="PHASE",t[t.PRIMITIVE=3]="PRIMITIVE",t[t.BATCHING_SCHEME=4]="BATCHING_SCHEME",t[t.DYNAMIC_STATE=5]="DYNAMIC_STATE",t[t.HASH=6]="HASH",t[t.COUNT=7]="COUNT"}(mc||(mc={}));var xc,Sc=((nc={})[mc.PRIORITY]=oc.UINT32,nc[mc.STAGE]=oc.UINT32,nc[mc.PHASE]=oc.UINT32,nc[mc.PRIMITIVE]=oc.UINT32,nc[mc.BATCHING_SCHEME]=oc.UINT32,nc[mc.DYNAMIC_STATE]=oc.UINT32,nc[mc.HASH]=oc.UINT32,nc[mc.COUNT]=oc.NEVER,nc),Tc=((ic={})[mc.PRIORITY]=mc.STAGE-mc.PRIORITY,ic[mc.STAGE]=mc.PHASE-mc.STAGE,ic[mc.PHASE]=mc.PRIMITIVE-mc.PHASE,ic[mc.PRIMITIVE]=mc.BATCHING_SCHEME-mc.PRIMITIVE,ic[mc.BATCHING_SCHEME]=mc.DYNAMIC_STATE-mc.BATCHING_SCHEME,ic[mc.DYNAMIC_STATE]=mc.HASH-mc.DYNAMIC_STATE,ic[mc.HASH]=mc.COUNT-mc.HASH,ic[mc.COUNT]=1,ic),Ac=new dc(_c.PASS,Sc,Tc,mc);!function(t){t[t.CENTER=0]="CENTER",t[t.HALFEXTENTS=3]="HALFEXTENTS",t[t.COUNT=6]="COUNT"}(xc||(xc={}));var Ec=((rc={})[xc.CENTER]=oc.FLOAT32,rc[xc.HALFEXTENTS]=oc.FLOAT32,rc[xc.COUNT]=oc.NEVER,rc),Cc=((ac={})[xc.CENTER]=xc.HALFEXTENTS-xc.CENTER,ac[xc.HALFEXTENTS]=xc.COUNT-xc.HALFEXTENTS,ac[xc.COUNT]=1,ac),bc=new dc(_c.AABB,Ec,Cc,xc),wc=new di,Pc=new di,Ic=new di,Rc=new di,Dc=new yi,Oc=function(t,e,n){Dc.m00=Math.abs(n.m00),Dc.m01=Math.abs(n.m01),Dc.m02=Math.abs(n.m02),Dc.m03=Math.abs(n.m04),Dc.m04=Math.abs(n.m05),Dc.m05=Math.abs(n.m06),Dc.m06=Math.abs(n.m08),Dc.m07=Math.abs(n.m09),Dc.m08=Math.abs(n.m10),di.transformMat3(t,e,Dc)},Mc=function(){function t(t,e,n,i,r,a){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=1),void 0===r&&(r=1),void 0===a&&(a=1),this.center=void 0,this.halfExtents=void 0,this._type=void 0,this._aabbHandle=0,this._type=cr.SHAPE_AABB,this.center=new di(t,e,n),this.halfExtents=new di(i,r,a)}t.create=function(e,n,i,r,a,o){return new t(e,n,i,r,a,o)},t.clone=function(e){return new t(e.center.x,e.center.y,e.center.z,e.halfExtents.x,e.halfExtents.y,e.halfExtents.z)},t.copy=function(t,e){return di.copy(t.center,e.center),di.copy(t.halfExtents,e.halfExtents),t},t.fromPoints=function(t,e,n){return di.add(wc,n,e),di.subtract(Pc,n,e),di.multiplyScalar(t.center,wc,.5),di.multiplyScalar(t.halfExtents,Pc,.5),t},t.set=function(t,e,n,i,r,a,o){return t.center.set(e,n,i),t.halfExtents.set(r,a,o),t},t.merge=function(e,n,i){return di.subtract(wc,n.center,n.halfExtents),di.subtract(Pc,i.center,i.halfExtents),di.add(Ic,n.center,n.halfExtents),di.add(Rc,i.center,i.halfExtents),di.max(Rc,Ic,Rc),di.min(Ic,wc,Pc),t.fromPoints(e,Ic,Rc)},t.toBoundingSphere=function(t,e){return t.center.set(e.center),t.radius=e.halfExtents.length(),t},t.transform=function(t,e,n){return di.transformMat4(t.center,e.center,n),Oc(t.halfExtents,e.halfExtents,n),t};var e=t.prototype;return e.getBoundary=function(t,e){di.subtract(t,this.center,this.halfExtents),di.add(e,this.center,this.halfExtents)},e.transform=function(t,e,n,i,r){di.transformMat4(r.center,this.center,t),Oc(r.halfExtents,this.halfExtents,t)},e.clone=function(){return t.clone(this)},e.copy=function(e){return t.copy(this,e)},e.mergePoint=function(t){this.getBoundary(wc,Pc),t.x<wc.x&&(wc.x=t.x),t.y<wc.y&&(wc.y=t.y),t.z<wc.z&&(wc.z=t.z),t.x>Pc.x&&(Pc.x=t.x),t.y>Pc.y&&(Pc.y=t.y),t.z>Pc.z&&(Pc.z=t.z),di.add(Ic,wc,Pc),this.center.set(di.multiplyScalar(Ic,Ic,.5)),this.halfExtents.set(Pc.x-Ic.x,Pc.y-Ic.y,Pc.z-Ic.z)},e.mergePoints=function(t){if(!(t.length<1))for(var e=0;e<t.length;e++)this.mergePoint(t[e])},e.mergeFrustum=function(t){return this.mergePoints(t.vertices)},L(t,[{key:"type",get:function(){return this._type}},{key:"native",get:function(){return this._nativeObj}}]),t}(),Nc=new di,Lc=new di,Bc=new yi,Fc=function(){function t(t,e,n,i,r,a,o,s,c,l,u,h,f,_,p){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=1),void 0===r&&(r=1),void 0===a&&(a=1),void 0===o&&(o=1),void 0===s&&(s=0),void 0===c&&(c=0),void 0===l&&(l=0),void 0===u&&(u=1),void 0===h&&(h=0),void 0===f&&(f=0),void 0===_&&(_=0),void 0===p&&(p=1),this.center=void 0,this.halfExtents=void 0,this.orientation=void 0,this._type=void 0,this._type=cr.SHAPE_OBB,this.center=new di(t,e,n),this.halfExtents=new di(i,r,a),this.orientation=new yi(o,s,c,l,u,h,f,_,p)}t.create=function(e,n,i,r,a,o,s,c,l,u,h,f,_,p,d){return new t(e,n,i,r,a,o,s,c,l,u,h,f,_,p,d)},t.clone=function(e){return new t(e.center.x,e.center.y,e.center.z,e.halfExtents.x,e.halfExtents.y,e.halfExtents.z,e.orientation.m00,e.orientation.m01,e.orientation.m02,e.orientation.m03,e.orientation.m04,e.orientation.m05,e.orientation.m06,e.orientation.m07,e.orientation.m08)},t.copy=function(t,e){return di.copy(t.center,e.center),di.copy(t.halfExtents,e.halfExtents),yi.copy(t.orientation,e.orientation),t},t.fromPoints=function(t,e,n){return di.multiplyScalar(t.center,di.add(Nc,e,n),.5),di.multiplyScalar(t.halfExtents,di.subtract(Lc,n,e),.5),yi.identity(t.orientation),t},t.set=function(t,e,n,i,r,a,o,s,c,l,u,h,f,_,p,d){return di.set(t.center,e,n,i),di.set(t.halfExtents,r,a,o),yi.set(t.orientation,s,c,l,u,h,f,_,p,d),t};var e=t.prototype;return e.getBoundary=function(t,e){!function(t,e,n){Bc.m00=Math.abs(n.m00),Bc.m01=Math.abs(n.m01),Bc.m02=Math.abs(n.m02),Bc.m03=Math.abs(n.m03),Bc.m04=Math.abs(n.m04),Bc.m05=Math.abs(n.m05),Bc.m06=Math.abs(n.m06),Bc.m07=Math.abs(n.m07),Bc.m08=Math.abs(n.m08),di.transformMat3(t,e,Bc)}(Nc,this.halfExtents,this.orientation),di.subtract(t,this.center,Nc),di.add(e,this.center,Nc)},e.transform=function(t,e,n,i,r){di.transformMat4(r.center,this.center,t),yi.fromQuat(r.orientation,n),di.multiply(r.halfExtents,this.halfExtents,i)},e.translateAndRotate=function(t,e,n){di.transformMat4(n.center,this.center,t),yi.fromQuat(n.orientation,e)},e.setScale=function(t,e){di.multiply(e.halfExtents,this.halfExtents,t)},L(t,[{key:"type",get:function(){return this._type}}]),t}(),zc=function(){function t(t,e,n){void 0===t&&(t=.5),void 0===e&&(e=.5),void 0===n&&(n=1),this._type=void 0,this.radius=void 0,this.halfHeight=void 0,this.axis=void 0,this.center=void 0,this.rotation=void 0,this.ellipseCenter0=void 0,this.ellipseCenter1=void 0,this._type=cr.SHAPE_CAPSULE,this.radius=t,this.halfHeight=e,this.axis=n,this.center=new di,this.rotation=new Ti,this.ellipseCenter0=new di(0,e,0),this.ellipseCenter1=new di(0,-e,0),this.updateCache()}var e=t.prototype;return e.transform=function(t,e,n,i,r){var a=i,o=li(a);r.radius=this.radius*Math.abs(o);var s=(this.halfHeight+this.radius)*Math.abs(a.y)-r.radius;s<0&&(s=0),r.halfHeight=s,di.transformMat4(r.center,this.center,t),Ti.multiply(r.rotation,this.rotation,n),r.updateCache()},e.updateCache=function(){this.updateLocalCenter(),di.transformQuat(this.ellipseCenter0,this.ellipseCenter0,this.rotation),di.transformQuat(this.ellipseCenter1,this.ellipseCenter1,this.rotation),this.ellipseCenter0.add(this.center),this.ellipseCenter1.add(this.center)},e.updateLocalCenter=function(){var t=this.halfHeight;switch(this.axis){case 0:this.ellipseCenter0.set(t,0,0),this.ellipseCenter1.set(-t,0,0);break;case 1:this.ellipseCenter0.set(0,t,0),this.ellipseCenter1.set(0,-t,0);break;case 2:this.ellipseCenter0.set(0,0,t),this.ellipseCenter1.set(0,0,-t)}},L(t,[{key:"type",get:function(){return this._type}}]),t}(),Uc=new Array(8);Uc[0]=new di(1,1,1),Uc[1]=new di(-1,1,1),Uc[2]=new di(-1,-1,1),Uc[3]=new di(1,-1,1),Uc[4]=new di(1,1,-1),Uc[5]=new di(-1,1,-1),Uc[6]=new di(-1,-1,-1),Uc[7]=new di(1,-1,-1);var kc,Gc,Hc=new di,Vc=new di,jc=new di,Wc=function(){function t(){this._type=void 0,this.planes=void 0,this.vertices=void 0,this._type=cr.SHAPE_FRUSTUM,this.planes=new Array(6);for(var t=0;t<6;++t)this.planes[t]=hc.create(0,0,0,0);this.vertices=new Array(8);for(var e=0;e<8;++e)this.vertices[e]=new di}t.createFromAABB=function(t,e){var n=new di,i=new di;return di.subtract(n,e.center,e.halfExtents),di.add(i,e.center,e.halfExtents),t.vertices[0].set(n.x,i.y,n.z),t.vertices[1].set(i.x,i.y,n.z),t.vertices[2].set(i.x,n.y,n.z),t.vertices[3].set(n.x,n.y,n.z),t.vertices[4].set(n.x,i.y,i.z),t.vertices[5].set(i.x,i.y,i.z),t.vertices[6].set(i.x,n.y,i.z),t.vertices[7].set(n.x,n.y,i.z),t._type!==cr.SHAPE_FRUSTUM_ACCURATE||t.updatePlanes(),t},t.split=function(t,e,n,i,r){var a=Math.tan(.5*e.fov),o=a*e.aspect;Hc.set(i*o,i*a,i),Vc.set(r*o,r*a,r);var s=t.vertices;return jc.set(Hc.x,Hc.y,Hc.z),di.transformMat4(s[0],jc,n),jc.set(-Hc.x,Hc.y,Hc.z),di.transformMat4(s[1],jc,n),jc.set(-Hc.x,-Hc.y,Hc.z),di.transformMat4(s[2],jc,n),jc.set(Hc.x,-Hc.y,Hc.z),di.transformMat4(s[3],jc,n),jc.set(Vc.x,Vc.y,Vc.z),di.transformMat4(s[4],jc,n),jc.set(-Vc.x,Vc.y,Vc.z),di.transformMat4(s[5],jc,n),jc.set(-Vc.x,-Vc.y,Vc.z),di.transformMat4(s[6],jc,n),jc.set(Vc.x,-Vc.y,Vc.z),di.transformMat4(s[7],jc,n),t.updatePlanes(),t},t.create=function(){return new t},t.clone=function(e){return t.copy(new t,e)},t.copy=function(t,e){t._type=e._type;for(var n=0;n<6;++n)hc.copy(t.planes[n],e.planes[n]);for(var i=0;i<8;++i)di.copy(t.vertices[i],e.vertices[i]);return t};var e=t.prototype;return e.update=function(t,e){if(di.set(this.planes[0].n,t.m03+t.m00,t.m07+t.m04,t.m11+t.m08),this.planes[0].d=-(t.m15+t.m12),di.set(this.planes[1].n,t.m03-t.m00,t.m07-t.m04,t.m11-t.m08),this.planes[1].d=-(t.m15-t.m12),di.set(this.planes[2].n,t.m03+t.m01,t.m07+t.m05,t.m11+t.m09),this.planes[2].d=-(t.m15+t.m13),di.set(this.planes[3].n,t.m03-t.m01,t.m07-t.m05,t.m11-t.m09),this.planes[3].d=-(t.m15-t.m13),di.set(this.planes[4].n,t.m03+t.m02,t.m07+t.m06,t.m11+t.m10),this.planes[4].d=-(t.m15+t.m14),di.set(this.planes[5].n,t.m03-t.m02,t.m07-t.m06,t.m11-t.m10),this.planes[5].d=-(t.m15-t.m14),this._type===cr.SHAPE_FRUSTUM_ACCURATE){for(var n=0;n<6;n++){var i=this.planes[n],r=1/i.n.length();di.multiplyScalar(i.n,i.n,r),i.d*=r}for(var a=0;a<8;a++)di.transformMat4(this.vertices[a],Uc[a],e)}},e.transform=function(t){if(this._type===cr.SHAPE_FRUSTUM_ACCURATE){for(var e=0;e<8;e++)di.transformMat4(this.vertices[e],this.vertices[e],t);hc.fromPoints(this.planes[0],this.vertices[1],this.vertices[6],this.vertices[5]),hc.fromPoints(this.planes[1],this.vertices[3],this.vertices[4],this.vertices[7]),hc.fromPoints(this.planes[2],this.vertices[6],this.vertices[3],this.vertices[7]),hc.fromPoints(this.planes[3],this.vertices[0],this.vertices[5],this.vertices[4]),hc.fromPoints(this.planes[4],this.vertices[2],this.vertices[0],this.vertices[3]),hc.fromPoints(this.planes[5],this.vertices[7],this.vertices[5],this.vertices[6])}},e.updatePlanes=function(){hc.fromPoints(this.planes[0],this.vertices[1],this.vertices[6],this.vertices[5]),hc.fromPoints(this.planes[1],this.vertices[3],this.vertices[4],this.vertices[7]),hc.fromPoints(this.planes[2],this.vertices[6],this.vertices[3],this.vertices[7]),hc.fromPoints(this.planes[3],this.vertices[0],this.vertices[5],this.vertices[4]),hc.fromPoints(this.planes[4],this.vertices[2],this.vertices[0],this.vertices[3]),hc.fromPoints(this.planes[5],this.vertices[7],this.vertices[5],this.vertices[6])},L(t,[{key:"accurate",set:function(t){this._type=t?cr.SHAPE_FRUSTUM_ACCURATE:cr.SHAPE_FRUSTUM}},{key:"type",get:function(){return this._type}}]),t}();Wc.createOrtho=function(t,e,n,i,r,a){var o=e/2,s=n/2;di.set(jc,o,s,-i),di.transformMat4(t.vertices[0],jc,a),di.set(jc,-o,s,-i),di.transformMat4(t.vertices[1],jc,a),di.set(jc,-o,-s,-i),di.transformMat4(t.vertices[2],jc,a),di.set(jc,o,-s,-i),di.transformMat4(t.vertices[3],jc,a),di.set(jc,o,s,-r),di.transformMat4(t.vertices[4],jc,a),di.set(jc,-o,s,-r),di.transformMat4(t.vertices[5],jc,a),di.set(jc,-o,-s,-r),di.transformMat4(t.vertices[6],jc,a),di.set(jc,o,-s,-r),di.transformMat4(t.vertices[7],jc,a),hc.fromPoints(t.planes[0],t.vertices[1],t.vertices[6],t.vertices[5]),hc.fromPoints(t.planes[1],t.vertices[3],t.vertices[4],t.vertices[7]),hc.fromPoints(t.planes[2],t.vertices[6],t.vertices[3],t.vertices[7]),hc.fromPoints(t.planes[3],t.vertices[0],t.vertices[5],t.vertices[4]),hc.fromPoints(t.planes[4],t.vertices[2],t.vertices[0],t.vertices[3]),hc.fromPoints(t.planes[5],t.vertices[7],t.vertices[5],t.vertices[6])},function(t){t[t.Default=0]="Default",t[t.Normal=1]="Normal",t[t.Loop=2]="Loop",t[t.ShouldWrap=4]="ShouldWrap",t[t.Clamp=8]="Clamp",t[t.PingPong=22]="PingPong",t[t.Reverse=36]="Reverse"}(kc||(kc={})),function(t){t[t.Default=kc.Default]="Default",t[t.Normal=kc.Normal]="Normal",t[t.Reverse=kc.Reverse]="Reverse",t[t.Loop=kc.Loop]="Loop",t[t.LoopReverse=kc.Loop|kc.Reverse]="LoopReverse",t[t.PingPong=kc.PingPong]="PingPong",t[t.PingPongReverse=kc.PingPong|kc.Reverse]="PingPongReverse"}(Gc||(Gc={})),Zt(Gc);var Xc=function(){function t(t){this.ratio=0,this.time=0,this.direction=1,this.stopped=!0,this.iterations=0,this.frameIndex=void 0,t&&this.set(t)}return t.prototype.set=function(t){this.ratio=t.ratio,this.time=t.time,this.direction=t.direction,this.stopped=t.stopped,this.iterations=t.iterations,this.frameIndex=t.frameIndex},t}();function qc(t,e,n){void 0===n&&(n=1e-6);for(var i=0,r=t.length-1,a=r>>>1;i<=r;a=i+r>>>1){var o=t[a];if(o>e+n)r=a-1;else{if(!(o<e-n))return a;i=a+1}}return~i}var Yc=function(){},Kc=function(){return Yc},Qc=Zc((function(){}));function Zc(t){return function(e){return"function"==typeof e?t(e):function(n){return t(n,e)}}}function Jc(t){return function(e){return function(n){!function(t,e,n){var i=tl(t);if(i){var r=el(i,"proto");el(r,"editor")[e]=n}}(n,t,e)}}}var $c="__ccclassCache__";function tl(t){return el(t,$c)}function el(t,e){return t[e]||(t[e]={})}var nl=Zc((function(t,e){var n=Gt.getSuper(t);n===Object&&(n=null);var i={name:e,extends:n,ctor:t},r=t[$c];if(r){var a=r.proto;a&&Gt.mixin(i,a),t[$c]=void 0}return Ge(i)})),il=Jc("requireComponent"),rl=Jc("executionOrder"),al=Qc;function ol(t,e,n){var i=null;function r(t,e,n){var r=tl(t.constructor);if(r){var a=el(r,"proto"),o=el(a,"properties");!function(t,e,n,i,r,a){var o,s=r&&(r.get||r.set);i&&(o=De(i,s));var c=e[n],l=Gt.mixin(c||{},o||i||{});if(s)r.get&&(l.get=r.get),r.set&&(l.set=r.set);else if(r)r.initializer&&(l.default=function(t){var e;try{e=t()}catch(e){return t}return"object"!=typeof e||null===e?e:t}(r.initializer));else{var u=a.default||(a.default=function(t){var e;try{e=new t}catch(t){return{}}return e}(t));u.hasOwnProperty(n)&&(l.default=u[n])}e[n]=l}(t.constructor,o,e,i,n,r)}}return void 0===t?ol({type:void 0}):void 0===e?(i=t,r):void r(t,e,n)}var sl=Symbol("cc:SerializationMetadata"),cl=function(t,e,n){return ol(hl({}))(t,e,n)};function ll(t){return ol(hl({formerlySerializedAs:t}))}var ul=function(t,e,n){return ol({editorOnly:!0})(t,e,n)};function hl(t){return t.__noImplicit=!0,"serializable"in t||(t.serializable=!0),t}var fl=Yc,_l=Qc,pl=Kc,dl=Qc,ml=Kc,gl=Kc,vl=Kc,yl=Yc,xl=Kc,Sl=Yc,Tl=Kc,Al=Kc,El=Kc,Cl=Kc,bl=Kc,wl=Kc,Pl=Yc,Il=Kc,Rl=Yc,Dl=Yc,Ol=Bl(Se),Ml=Bl(Te),Nl=Bl(Ae),Ll=Bl(Ee);function Bl(t){return ol({type:t})}var Fl,zl,Ul,kl,Gl,Hl,Vl,jl,Wl,Xl=function(t,e,n){return ol({__noImplicit:!0,override:!0})(t,e,n)},ql=nl("cc.KeyframeCurve")((Fl=Symbol.iterator,Hl=function(){function t(){X(this,"_times",kl,this),X(this,"_values",Gl,this)}var e=t.prototype;return e[Fl]=function(){var t=this,e=0;return{next:function(){if(e>=t._times.length)return{done:!0,value:void 0};var n=[t._times[e],t._values[e]];return++e,{done:!1,value:n}}}},e.keyframes=function(){return this},e.times=function(){return this._times},e.values=function(){return this._values},e.getKeyframeTime=function(t){return this._times[t]},e.getKeyframeValue=function(t){return this._values[t]},e.addKeyFrame=function(t,e){return this._insertNewKeyframe(t,e)},e.removeKeyframe=function(t){this._times.splice(t,1),this._values.splice(t,1)},e.indexOfKeyframe=function(t){return qc(this._times,t)},e.updateTime=function(t,e){var n=this._values[t];this.removeKeyframe(t),this._insertNewKeyframe(e,n)},e.assignSorted=function(t,e){if(void 0!==e)this.setKeyframes(t.slice(),e.slice());else{var n=Array.from(t);this.setKeyframes(n.map((function(t){return t[0]})),n.map((function(t){return t[1]})))}},e.clear=function(){this._times.length=0,this._values.length=0},e.searchKeyframe=function(t){return qc(this._times,t)},e.setKeyframes=function(t,e){t.length,e.length,function(t){t.every((function(t,e,n){return 0===e||t>n[e-1]||qn(t,n[e-1],1e-6)}))}(t),this._times=t,this._values=e},e._insertNewKeyframe=function(t,e){var n=this._times,i=this._values,r=n.length,a=qc(n,t);if(a>=0)return a;var o=~a;return 0===o?(n.unshift(t),i.unshift(e)):o===r?(n.push(t),i.push(e)):(n.splice(o-1,0,t),i.splice(o-1,0,e)),o},L(t,[{key:"keyFramesCount",get:function(){return this._times.length}},{key:"rangeMin",get:function(){return this._times[0]}},{key:"rangeMax",get:function(){return this._times[this._values.length-1]}}]),t}(),kl=q((Ul=Hl).prototype,"_times",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Gl=q(Ul.prototype,"_values",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),zl=Ul))||zl;function Yl(t){return t>-1e-9&&t<1e-9}!function(t){t[t.LINEAR=0]="LINEAR",t[t.CONSTANT=1]="CONSTANT",t[t.CUBIC=2]="CUBIC"}(Vl||(Vl=t("RealInterpolationMode",{}))),function(t){t[t.LINEAR=0]="LINEAR",t[t.CLAMP=1]="CLAMP",t[t.LOOP=2]="LOOP",t[t.PING_PONG=3]="PING_PONG"}(jl||(jl=t("ExtrapolationMode",{}))),function(t){t[t.NONE=0]="NONE",t[t.LEFT=1]="LEFT",t[t.RIGHT=2]="RIGHT",t[t.BOTH=3]="BOTH"}(Wl||(Wl=t("TangentWeightMode",{})));var Kl=function(){},Ql=Object.freeze({__proto__:null,uniquelyReferenced:fl,ccclass:nl,property:ol,requireComponent:il,executionOrder:rl,disallowMultiple:al,allowReplicated:function(t){Ge.Attr.setClassAttr(t,"replicated","visible",!0)},executeInEditMode:_l,menu:pl,playOnFocus:dl,inspector:ml,icon:gl,help:vl,type:Bl,integer:Ol,float:Ml,boolean:Nl,string:Ll});t("_decorator",Ql);var Zl=function(){function t(t){this._map=null,this._count=0,t?(this._map=t,this._count=Object.keys(t).length):(this._map=Gt.createMap(!0),this._count=0)}var e=t.prototype;return e.add=function(t,e){return t in this._map||this._count++,this._map[t]=e},e.get=function(t){return this._map[t]},e.has=function(t){return t in this._map},e.remove=function(t){var e=this._map[t];return t in this._map&&(delete this._map[t],this._count--),e},e.clear=function(){0!==this._count&&(this._map=Gt.createMap(!0),this._count=0)},e.forEach=function(t){for(var e in this._map)t(this._map[e],e)},e.find=function(t){for(var e in this._map)if(t(this._map[e],e))return this._map[e];return null},e.destroy=function(){this._map=null},L(t,[{key:"count",get:function(){return this._count}}]),t}(),Jl=function(){function t(e,n){this.id=t._pipelineId++,this.name="",this.pipes=[],this.name=e;for(var i=0,r=n.length;i<r;i++)this.pipes.push(n[i])}var e=t.prototype;return e.insert=function(t,e){return e>this.pipes.length?(E(4921),this):(this.pipes.splice(e,0,t),this)},e.append=function(t){return this.pipes.push(t),this},e.remove=function(t){return this.pipes.splice(t,1),this},e.sync=function(t){var e=this.pipes;if(0===e.length)return null;t.isFinish=!1;for(var n=0,i=e.length;n<i;){var r=(0,e[n])(t);if(r)return t.isFinish=!0,r;++n!==i&&(t.input=t.output,t.output=null)}return t.isFinish=!0,t.output},e.async=function(t){0!==this.pipes.length&&(t.isFinish=!1,this._flow(0,t))},e._flow=function(t,e){var n=this;(0,this.pipes[t])(e,(function(i){i?(e.isFinish=!0,e.dispatch("complete",i)):++t<n.pipes.length?(e.input=e.output,e.output=null,n._flow(t,e)):(e.isFinish=!0,e.dispatch("complete",i,e.output))}))},t}();Jl._pipelineId=0,function(){function t(t){if(this._weakMap={},void 0===window.WeakRef)throw new Error("this platform does not support WeakRef!");if(t)for(var e in t)this._weakMap[e]=new WeakRef(t[e])}var e=t.prototype;e.add=function(t,e){return this._weakMap[t]=new WeakRef(e),e},e.has=function(t){return t in this._weakMap&&!!this._weakMap[t].deref()},e.get=function(t){return this._weakMap[t]&&this._weakMap[t].deref()},e.remove=function(t){var e=this._weakMap[t];return delete this._weakMap[t],e&&e.deref()},e.clear=function(){this._weakMap=Gt.createMap(!0)},e.forEach=function(t){for(var e in this._weakMap){var n=this.get(e);n&&t(n,e)}},e.find=function(t){for(var e in this._weakMap){var n=this.get(e);if(n&&t(n,e))return this._weakMap[e].deref()}return null},e.destroy=function(){this._weakMap={}},L(t,[{key:"count",get:function(){return Object.values(this._weakMap).filter((function(t){return t.deref()})).length}}])}();var $l,tu=new Zl,eu=new Zl,nu=new Zl,iu=new Zl,ru=new Jl("normal load",[]),au=new Jl("fetch",[]),ou=new Jl("transform url",[]);!function(t){t.UUID="uuid",t.PATH="path",t.DIR="dir",t.URL="url",t.SCENE="scene"}($l||($l={}));var su,cu={default:{priority:0},preload:{maxConcurrency:6,maxRequestsPerFrame:2,priority:-1},scene:{maxConcurrency:20,maxRequestsPerFrame:20,priority:1},bundle:{maxConcurrency:20,maxRequestsPerFrame:20,priority:2},remote:{maxRetryCount:4}};!function(t){t.RESOURCES="resources",t.MAIN="main",t.START_SCENE="start-scene"}(su||(su={}));var lu=function(){function t(e){this.id=t._taskId++,this.onComplete=null,this.onProgress=null,this.onError=null,this.source=null,this.output=null,this.input=null,this.progress=null,this.options=null,this.isFinish=!0,this.set(e)}t.create=function(e){var n;return 0!==t._deadPool.length?(n=t._deadPool.pop()).set(e):n=new t(e),n};var e=t.prototype;return e.set=function(t){void 0===t&&(t=Object.create(null)),this.onComplete=t.onComplete||null,this.onProgress=t.onProgress||null,this.onError=t.onError||null,this.source=this.input=t.input,this.output=null,this.progress=t.progress,this.options=t.options||Object.create(null)},e.dispatch=function(t,e,n,i,r){switch(t){case"complete":this.onComplete&&this.onComplete(e,n);break;case"progress":this.onProgress&&this.onProgress(e,n,i,r);break;case"error":this.onError&&this.onError(e,n,i,r);break;default:var a="on"+t[0].toUpperCase()+t.substr(1);"function"==typeof this[a]&&this[a](e,n,i,r)}},e.recycle=function(){t._deadPool.length!==t.MAX_DEAD_NUM&&(this.onComplete=null,this.onProgress=null,this.onError=null,this.source=this.output=this.input=null,this.progress=null,this.options=null,t._deadPool.push(this))},t}();lu.MAX_DEAD_NUM=500,lu._taskId=0,lu._deadPool=[];var uu="0123456789abcdef".split(""),hu=["","","",""],fu=hu.concat(hu,"-",hu,"-",hu,"-",hu,"-",hu,hu,hu),_u=fu.map((function(t,e){return"-"===t?NaN:e})).filter(isFinite);function pu(t){var e=t.split("@")[0];if(22!==e.length)return t;fu[0]=t[0],fu[1]=t[1];for(var n=2,i=2;n<22;n+=2){var r=re[t.charCodeAt(n)],a=re[t.charCodeAt(n+1)];fu[_u[i++]]=uu[r>>2],fu[_u[i++]]=uu[(3&r)<<2|a>>4],fu[_u[i++]]=uu[15&a]}return t.replace(e,fu.join(""))}var du=/.*[/\\][0-9a-fA-F]{2}[/\\]([0-9a-fA-F-@]{8,}).*/;function mu(t){var e=du.exec(t);return e?e[1]:""}function gu(t,e){(e=e||Object.create(null)).__isNative__=e.isNative,e.ext=e.nativeExt;var n=iu.find((function(e){return!!e.getAssetInfo(t)}));return n&&(e.bundle=n.name),xu(t,e)}function vu(t){return!!t&&(t instanceof i.SceneAsset||t instanceof i.Scene)}function yu(t){return t&&(46===t.charCodeAt(0)&&47===t.charCodeAt(1)?t=t.slice(2):47===t.charCodeAt(0)&&(t=t.slice(1))),t}function xu(t,e){var n=lu.create({input:t,options:e}),i=[];try{for(var r,a=W(ou.sync(n));!(r=a()).done;){var o=r.value,s=o.url;o.recycle(),i.push(s)}}catch(t){for(var c,l=W(n.output);!(c=l()).done;)c.value.recycle();d(t.message,t.stack)}return n.recycle(),i.length>1?i:i[0]}var Su,Tu,Au,Eu,Cu,bu,wu,Pu,Iu=Object.freeze({__proto__:null,getUuidFromURL:mu,getUrlWithUuid:gu,isScene:vu,normalize:yu,transform:xu,decodeUuid:pu}),Ru=new(function(){function t(){this._finalizationRegistry=null}var e=t.prototype;return e.registerGCObject=function(t){return t},e.unregisterGCObject=function(){},e.init=function(){},e.finalizationRegistryCallback=function(t){t.isValid&&t.destroy()},e.destroy=function(){},t}()),Du=nl("cc.GCObject")(Su=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return e=t.call.apply(t,[this].concat(i))||this,Ru.registerGCObject(V(e))||V(e)}F(e,t);var n=e.prototype;return n.equals=function(t){return!!t&&t===this},n.destroy=function(){return Ru.unregisterGCObject(this),t.prototype.destroy.call(this)},e}(Ye))||Su,Ou=t("Asset",nl("cc.Asset")((Cu=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).loaded=!0,X(e,"_native",Eu,V(e)),e._nativeUrl="",e._file=null,e._ref=0,Object.defineProperty(V(e),"_uuid",{value:"",writable:!0}),e}F(e,t),e.deserialize=function(t){return i.deserialize(t)};var n=e.prototype;return n.toString=function(){return this.nativeUrl},n.serialize=function(){},n._setRawAsset=function(t,e){void 0===e&&(e=!0),this._native=!1!==e?t||"":"/"+t},n.addRef=function(){return this._ref++,this},n.decRef=function(t){return void 0===t&&(t=!0),this._ref>0&&this._ref--,t&&i.assetManager._releaseManager.tryRelease(this),this},n.onLoaded=function(){},n.initDefault=function(t){t&&(this._uuid=t),this.isDefault=!0},n.validate=function(){return!0},n.destroy=function(){return g(R(12101,this._uuid)),t.prototype.destroy.call(this)},L(e,[{key:"nativeUrl",get:function(){if(!this._nativeUrl){if(!this._native)return"";var t=this._native;if(47===t.charCodeAt(0))return t.slice(1);46===t.charCodeAt(0)?this._nativeUrl=gu(this._uuid,{nativeExt:t,isNative:!0}):this._nativeUrl=gu(this._uuid,{__nativeName__:t,nativeExt:vn(t),isNative:!0})}return this._nativeUrl}},{key:"_nativeAsset",get:function(){return this._file},set:function(t){this._file=t}},{key:"_nativeDep",get:function(){if(this._native)return{__isNative__:!0,uuid:this._uuid,ext:this._native}}},{key:"refCount",get:function(){return this._ref}}]),e}(an(Du)),Eu=q((Au=Cu).prototype,"_native",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),q(Au.prototype,"_nativeAsset",[ol],Object.getOwnPropertyDescriptor(Au.prototype,"_nativeAsset"),Au.prototype),Tu=Au))||Tu);Ou.prototype.createNode=null,i.Asset=Ou;var Mu=t("Script",nl("cc.Script")(bu=function(t){function e(){return t.apply(this,arguments)||this}return F(e,t),e}(Ou))||bu);i._Script=Mu;var Nu=t("JavaScript",nl("cc.JavaScript")(wu=function(t){function e(){return t.apply(this,arguments)||this}return F(e,t),e}(Mu))||wu);i._JavaScript=Nu;var Lu,Bu,Fu,zu,Uu,ku,Gu,Hu,Vu,ju,Wu,Xu=t("TypeScript",nl("cc.TypeScript")(Pu=function(t){function e(){return t.apply(this,arguments)||this}return F(e,t),e}(Mu))||Pu);i._TypeScript=Xu;var qu,Yu,Ku,Qu,Zu=new tt("Comp"),Ju=Ye.Flags.IsOnLoadCalled,$u=t("Component",(Lu=nl("cc.Component"),Bu=Tl(),Fu=Bl(Mu),zu=Al(),Lu((Wu=ju=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return X(e=t.call.apply(t,[this].concat(i))||this,"node",Gu,V(e)),X(e,"_enabled",Hu,V(e)),X(e,"__prefab",Vu,V(e)),e._sceneGetter=null,e._id=Zu.getNewId(),e}F(e,t);var n=e.prototype;return n._getRenderScene=function(){return this._sceneGetter?this._sceneGetter():this.node.scene.renderScene},n.addComponent=function(t){return this.node.addComponent(t)},n.getComponent=function(t){return this.node.getComponent(t)},n.getComponents=function(t){return this.node.getComponents(t)},n.getComponentInChildren=function(t){return this.node.getComponentInChildren(t)},n.getComponentsInChildren=function(t){return this.node.getComponentsInChildren(t)},n.destroy=function(){return!!t.prototype.destroy.call(this)&&(this._enabled&&this.node.activeInHierarchy&&i.director._compScheduler.disableComp(this),!0)},n._onPreDestroy=function(){this.unscheduleAllCallbacks(),i.director._nodeActivator.destroyComp(this),this.node._removeComponent(this)},n._instantiate=function(t){return t||(t=i.instantiate._clone(this,this)),t&&(t.node=null),t},n.schedule=function(t,e,n,r){void 0===e&&(e=0),void 0===n&&(n=i.macro.REPEAT_FOREVER),void 0===r&&(r=0),I(t,1619),I((e=e||0)>=0,1620),n=Number.isNaN(n)?i.macro.REPEAT_FOREVER:n,r=r||0;var a=i.director.getScheduler(),o=a.isTargetPaused(this);a.schedule(t,this,e,n,r,o)},n.scheduleOnce=function(t,e){void 0===e&&(e=0),this.schedule(t,0,0,e)},n.unschedule=function(t){t&&i.director.getScheduler().unschedule(t,this)},n.unscheduleAllCallbacks=function(){i.director.getScheduler().unscheduleAllForTarget(this)},L(e,[{key:"name",get:function(){if(this._name)return this._name;var t=_t(this),e=t.lastIndexOf(".");return e>=0&&(t=t.slice(e+1)),this.node?this.node.name+"<"+t+">":t},set:function(t){this._name=t}},{key:"uuid",get:function(){return this._id}},{key:"__scriptAsset",get:function(){return null}},{key:"enabled",get:function(){return this._enabled},set:function(t){if(this._enabled!==t&&(this._enabled=t,this.node.activeInHierarchy)){var e=i.director._compScheduler;t?e.enableComp(this):e.disableComp(this)}}},{key:"enabledInHierarchy",get:function(){return this._enabled&&this.node&&this.node.activeInHierarchy}},{key:"_isOnLoadCalled",get:function(){return this._objFlags&Ju}}]),e}(Ye),ju.system=null,q((ku=Wu).prototype,"__scriptAsset",[Bu,Fu,zu,Dl],Object.getOwnPropertyDescriptor(ku.prototype,"__scriptAsset"),ku.prototype),Gu=q(ku.prototype,"node",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Hu=q(ku.prototype,"_enabled",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Vu=q(ku.prototype,"__prefab",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Uu=ku))||Uu)),th=$u.prototype;th.update=null,th.lateUpdate=null,th.__preload=null,th.onLoad=null,th.start=null,th.onEnable=null,th.onDisable=null,th.onDestroy=null,th.onFocusInEditor=null,th.onLostFocusInEditor=null,th.resetInEditor=null,th._getLocalBounds=null,th.onRestore=null,$u._requireComponent=null,$u._executionOrder=0,ct($u,"_registerEditorProps",(function(t,e){var n=e.requireComponent;n&&(Array.isArray(n)&&(n=n.filter(Boolean)),t._requireComponent=n);var i=e.executionOrder;i&&"number"==typeof i&&(t._executionOrder=i)})),i.Component=$u;var eh,nh=t("MissingScript",nl("cc.MissingScript")(qu=ml()((Qu=function(t){function e(){var e;return X(e=t.call(this)||this,"_$erialized",Ku,V(e)),e}return F(e,t),e.safeFindClass=function(t){var e=Bt(t);if(e)return e;i.deserialize.reportMissingClass(t)},e.prototype.onLoad=function(){E(4600,this.node.name)},e}($u),Ku=q((Yu=Qu).prototype,"_$erialized",[cl,ul],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),qu=Yu))||qu)||qu);i._MissingScript=nh;try{var ih=nh.__values__;0!==ih.length&&"_$erialized"===ih[ih.length-1]||(d("The '_$erialized' prop in MissingScript is missing. Please contact jare."),d("    Error props: ['"+ih+"']"))}catch(ir){d("Error when checking MissingScript 5, "+ir)}!function(t){t[t.PORTRAIT=1]="PORTRAIT",t[t.PORTRAIT_UPSIDE_DOWN=2]="PORTRAIT_UPSIDE_DOWN",t[t.LANDSCAPE_LEFT=4]="LANDSCAPE_LEFT",t[t.LANDSCAPE_RIGHT=8]="LANDSCAPE_RIGHT",t[t.LANDSCAPE=12]="LANDSCAPE",t[t.AUTO=13]="AUTO"}(eh||(eh={}));var rh,ah={auto:eh.AUTO,landscape:eh.LANDSCAPE,portrait:eh.PORTRAIT};!function(t){t[t.Unknown=0]="Unknown",t[t.SubFrame=1]="SubFrame",t[t.BrowserWindow=2]="BrowserWindow",t[t.Fullscreen=3]="Fullscreen"}(rh||(rh={}));var oh=new(function(t){function e(){var e,n,i,r,a,o;(e=t.call(this)||this).isFrameRotated=!1,e.handleResizeEvent=!0,e._gameFrame=void 0,e._gameContainer=void 0,e._gameCanvas=void 0,e._isProportionalToFrame=!1,e._cachedFrameStyle={width:"0px",height:"0px"},e._cachedContainerStyle={width:"0px",height:"0px"},e._cbToUpdateFrameBuffer=void 0,e._supportFullScreen=!1,e._touchEventName=void 0,e._onFullscreenChange=void 0,e._onFullscreenError=void 0,e._orientationChangeTimeoutId=-1,e._cachedFrameSize=new Gi(0,0),e._exactFitScreen=!1,e._fn={},e._fnGroup=[["requestFullscreen","exitFullscreen","fullscreenchange","fullscreenEnabled","fullscreenElement","fullscreenerror"],["requestFullScreen","exitFullScreen","fullScreenchange","fullScreenEnabled","fullScreenElement","fullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitfullscreenchange","webkitIsFullScreen","webkitCurrentFullScreenElement","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozFullScreen","mozFullScreenElement","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","MSFullscreenChange","msFullscreenEnabled","msFullscreenElement","msfullscreenerror"]],e._resolutionScale=1,e._orientation=eh.AUTO,e._gameFrame=document.getElementById("GameDiv"),e._gameContainer=document.getElementById("Cocos3dGameContainer"),e._gameCanvas=document.getElementById("GameCanvas"),e._gameFrame||(e._gameFrame=document.createElement("div"),e._gameFrame.setAttribute("id","GameDiv"),null===(n=e._gameCanvas)||void 0===n||null===(i=n.parentNode)||void 0===i||i.insertBefore(e._gameFrame,e._gameCanvas),e._gameFrame.appendChild(e._gameCanvas)),e._gameContainer||(e._gameContainer=document.createElement("div"),e._gameContainer.setAttribute("id","Cocos3dGameContainer"),null===(r=e._gameCanvas)||void 0===r||null===(a=r.parentNode)||void 0===a||a.insertBefore(e._gameContainer,e._gameCanvas),e._gameContainer.appendChild(e._gameCanvas));for(var s=e._fnGroup,c=0;c<s.length;c++)if(o=s[c],void 0!==document[o[1]]){for(var l=0;l<o.length;l++)e._fn[s[0][l]]=o[l];break}return e._supportFullScreen=void 0!==e._fn.requestFullscreen,e._touchEventName="ontouchstart"in window?"touchend":"mousedown",e._registerEvent(),e}F(e,t);var n=e.prototype;return n.init=function(t,e){this._cbToUpdateFrameBuffer=e,this.orientation=ah[t.configOrientation],this._exactFitScreen=t.exactFitScreen,this._resizeFrame()},n.requestFullScreen=function(){var t=this;return new Promise((function(e,n){t.isFullScreen?e():(t._cachedFrameSize=t.windowSize,t._doRequestFullScreen().then((function(){e()})).catch((function(){var i=t._getFullscreenTarget();i?i.addEventListener(t._touchEventName,(function(){t._doRequestFullScreen().then((function(){e()})).catch(n)}),{once:!0,capture:!0}):n(new Error("Cannot access fullscreen target"))})))}))},n.exitFullScreen=function(){var t=this;return new Promise((function(e,n){var i=document[t._fn.exitFullscreen]();window.Promise&&i instanceof Promise?i.then((function(){t.windowSize=t._cachedFrameSize,e()})).catch(n):(t.windowSize=t._cachedFrameSize,e())}))},n._registerEvent=function(){var t=this;document.addEventListener(this._fn.fullscreenerror,(function(){var e;null===(e=t._onFullscreenError)||void 0===e||e.call(t)})),window.addEventListener("resize",(function(){t.handleResizeEvent&&t._resizeFrame()})),"function"==typeof window.matchMedia&&function e(){var n,i,r=window.devicePixelRatio;null===(n=window.matchMedia("(resolution: "+r+"dppx)"))||void 0===n||null===(i=n.addEventListener)||void 0===i||i.call(n,"change",(function(){t.emit("window-resize"),e()}),{once:!0})}(),window.addEventListener("orientationchange",(function(){-1!==t._orientationChangeTimeoutId&&clearTimeout(t._orientationChangeTimeoutId),t._orientationChangeTimeoutId=setTimeout((function(){t.handleResizeEvent&&(t._updateFrameState(),t._resizeFrame(),t.emit("orientation-change"),t._orientationChangeTimeoutId=-1)}),200)})),document.addEventListener(this._fn.fullscreenchange,(function(){var e;null===(e=t._onFullscreenChange)||void 0===e||e.call(t),t.emit("fullscreen-change")}))},n._convertToSizeInCssPixels=function(t){var e=t.clone(),n=this.devicePixelRatio;return e.width/=n,e.height/=n,e},n._resizeFrame=function(t){if(this._gameFrame){if(this._gameFrame.style.display="flex",this._gameFrame.style["justify-content"]="center",this._gameFrame.style["align-items"]="center",this._windowType===rh.SubFrame){if(!t)return void this._updateContainer();this._gameFrame.style.width=t.width+"px",this._gameFrame.style.height=t.height+"px"}else{var e=window.innerWidth,n=window.innerHeight;this.isFrameRotated?(this._gameFrame.style["-webkit-transform"]="rotate(90deg)",this._gameFrame.style.transform="rotate(90deg)",this._gameFrame.style["-webkit-transform-origin"]="0px 0px 0px",this._gameFrame.style.transformOrigin="0px 0px 0px",this._gameFrame.style.margin="0 0 0 "+e+"px",this._gameFrame.style.width=n+"px",this._gameFrame.style.height=e+"px"):(this._gameFrame.style["-webkit-transform"]="rotate(0deg)",this._gameFrame.style.transform="rotate(0deg)",this._gameFrame.style.margin="0px auto",this._gameFrame.style.width=e+"px",this._gameFrame.style.height=n+"px")}this._updateContainer()}},n._getFullscreenTarget=function(){var t=this._windowType;return t===rh.Fullscreen?document[this._fn.fullscreenElement]:t===rh.SubFrame?this._gameFrame:document.body},n._doRequestFullScreen=function(){var t=this;return new Promise((function(e,n){if(t._supportFullScreen){var i=t._getFullscreenTarget();if(i){t._onFullscreenChange=void 0,t._onFullscreenError=void 0;var r=i[t._fn.requestFullscreen]();window.Promise&&r instanceof Promise?r.then(e).catch(n):(t._onFullscreenChange=e,t._onFullscreenError=n)}else n(new Error("Cannot access fullscreen target"))}else n(new Error("fullscreen is not supported"))}))},n._updateFrameState=function(){var t=this.orientation,e=window.innerWidth>window.innerHeight;this.isFrameRotated=_n.isMobile&&(e&&t===eh.PORTRAIT||!e&&t===eh.LANDSCAPE)},n._updateContainer=function(){if(this._gameContainer){if(this.isProportionalToFrame){if(!this._gameFrame)return void E(9201);var t,e,n=i.view.getDesignResolutionSize(),r=this._gameFrame,a=r.clientWidth,o=r.clientHeight,s=n.width,c=n.height,l=a/s,u=o/c,h=this._gameContainer.style;l<u?(t=a,e=c*l):(t=s*u,e=o),h.width=t+"px",h.height=e+"px"}else{var f=this._gameContainer.style;f.width="100%",f.height="100%"}!this._gameFrame||this._cachedFrameStyle.width===this._gameFrame.style.width&&this._cachedFrameStyle.height===this._gameFrame.style.height&&this._cachedContainerStyle.width===this._gameContainer.style.width&&this._cachedContainerStyle.height===this._gameContainer.style.height||(this.emit("window-resize"),this._cachedFrameStyle.width=this._gameFrame.style.width,this._cachedFrameStyle.height=this._gameFrame.style.height,this._cachedContainerStyle.width=this._gameContainer.style.width,this._cachedContainerStyle.height=this._gameContainer.style.height)}else E(9201)},L(e,[{key:"supportFullScreen",get:function(){return this._supportFullScreen}},{key:"isFullScreen",get:function(){return!!this._supportFullScreen&&!!document[this._fn.fullscreenElement]}},{key:"devicePixelRatio",get:function(){var t;return Math.min(null!==(t=window.devicePixelRatio)&&void 0!==t?t:1,2)}},{key:"windowSize",get:function(){var t=this._windowSizeInCssPixels,e=this.devicePixelRatio;return t.width*=e,t.height*=e,t},set:function(t){this._windowType===rh.SubFrame?this._resizeFrame(this._convertToSizeInCssPixels(t)):E(9202)}},{key:"resolution",get:function(){var t=this.windowSize,e=this.resolutionScale;return new Gi(t.width*e,t.height*e)}},{key:"resolutionScale",get:function(){return this._resolutionScale},set:function(t){var e;t!==this._resolutionScale&&(this._resolutionScale=t,null===(e=this._cbToUpdateFrameBuffer)||void 0===e||e.call(this))}},{key:"orientation",get:function(){return this._orientation},set:function(t){this._orientation!==t&&(this._orientation=t,this._updateFrameState())}},{key:"safeAreaEdge",get:function(){return{top:0,bottom:0,left:0,right:0}}},{key:"isProportionalToFrame",get:function(){return this._isProportionalToFrame},set:function(t){this._isProportionalToFrame!==t&&(this._isProportionalToFrame=t,this._updateContainer())}},{key:"_windowSizeInCssPixels",get:function(){if(this.isProportionalToFrame)return this._gameContainer?new Gi(this._gameContainer.clientWidth,this._gameContainer.clientHeight):(E(9201),new Gi(0,0));var t,e,n;switch(this._windowType){case rh.SubFrame:return this._gameFrame?new Gi(this._gameFrame.clientWidth,this._gameFrame.clientHeight):(E(9201),new Gi(0,0));case rh.Fullscreen:return t=this._getFullscreenTarget(),e=this.isFrameRotated?t.clientHeight:t.clientWidth,n=this.isFrameRotated?t.clientWidth:t.clientHeight,new Gi(e,n);case rh.BrowserWindow:return e=this.isFrameRotated?window.innerHeight:window.innerWidth,n=this.isFrameRotated?window.innerWidth:window.innerHeight,new Gi(e,n);case rh.Unknown:default:return new Gi(0,0)}}},{key:"_windowType",get:function(){return this.isFullScreen?rh.Fullscreen:this._gameFrame?this._exactFitScreen?rh.BrowserWindow:rh.SubFrame:(E(9201),rh.Unknown)}}]),e}(fn)),sh=function(){function t(){}var e=t.prototype;return e._init=function(t){oh.init(t,(function(){var t,e=i.director;(null===(t=e.root)||void 0===t?void 0:t.pipeline)?e.root.pipeline.pipelineSceneData.shadingScale=oh.resolutionScale:E(1220)}))},e.fullScreen=function(){return oh.isFullScreen},e.requestFullScreen=function(t,e,n){return arguments.length>0&&E(1400,"screen.requestFullScreen(element, onFullScreenChange?, onFullScreenError?)","screen.requestFullScreen(): Promise"),oh.requestFullScreen().then((function(){null==e||e()})).catch((function(t){console.error(t),null==n||n()}))},e.exitFullScreen=function(){return oh.exitFullScreen()},e.autoFullScreen=function(t,e){var n;null===(n=this.requestFullScreen(t,e))||void 0===n||n.catch((function(){}))},e.disableAutoFullScreen=function(){},L(t,[{key:"devicePixelRatio",get:function(){return oh.devicePixelRatio}},{key:"windowSize",get:function(){return oh.windowSize},set:function(t){oh.windowSize=t}},{key:"resolution",get:function(){return oh.resolution}},{key:"supportsFullScreen",get:function(){return oh.supportFullScreen}}]),t}(),ch=t("screen",new sh);i.screen=ch;var lh=t("sys",{Feature:hn,hasFeature:function(t){return _n.hasFeature(t)},NetworkType:cn,Language:sn,OS:ln,Platform:un,BrowserType:on,isNative:_n.isNative,isBrowser:_n.isBrowser,isMobile:_n.isMobile,isLittleEndian:_n.isLittleEndian,platform:_n.platform,language:_n.language,languageCode:_n.nativeLanguage,os:_n.os,osVersion:_n.osVersion,osMainVersion:_n.osMainVersion,browserType:_n.browserType,browserVersion:_n.browserVersion,windowPixelResolution:ch.windowSize,capabilities:{canvas:!0,opengl:!0,webp:_n.hasFeature(hn.WEBP),imageBitmap:_n.hasFeature(hn.IMAGE_BITMAP),touches:_n.hasFeature(hn.INPUT_TOUCH),mouse:_n.hasFeature(hn.EVENT_MOUSE),keyboard:_n.hasFeature(hn.EVENT_KEYBOARD),accelerometer:_n.hasFeature(hn.EVENT_ACCELEROMETER)},localStorage:{},getNetworkType:function(){return _n.networkType},getBatteryLevel:function(){return _n.getBatteryLevel()},garbageCollect:function(){_n.triggerGC()},isObjectValid:function(t){return null!=t},dump:function(){var t="";t+="isMobile : "+this.isMobile+"\r\n",t+="language : "+this.language+"\r\n",t+="browserType : "+this.browserType+"\r\n",t+="browserVersion : "+this.browserVersion+"\r\n",t+="capabilities : "+JSON.stringify(this.capabilities)+"\r\n",t+="os : "+this.os+"\r\n",t+="osVersion : "+this.osVersion+"\r\n",t+="platform : "+this.platform+"\r\n",_(t+="Using "+(i.game.renderType===i.game.RENDER_TYPE_WEBGL?"WEBGL":"CANVAS")+" renderer.\r\n")},openURL:function(t){_n.openURL(t)},now:function(){return _n.now()},restartVM:function(){_n.restartJSVM()},getSafeAreaRect:function(){var t=i.view,e=oh.safeAreaEdge,n=oh.windowSize,r=new Ni(e.left,e.bottom),a=new Ni(n.width-e.right,n.height-e.top);t._convertToUISpace(r),t._convertToUISpace(a);var o=r.x,s=r.y,c=a.x-r.x,l=a.y-r.y;return new Vi(o,s,c,l)}});!function(){try{var t=lh.localStorage=window.localStorage;t.setItem("storage",""),t.removeItem("storage"),t=null}catch(t){var e=function(){E(5200)};lh.localStorage={getItem:e,setItem:e,clear:e,removeItem:e}}lh.__isWebIOS14OrIPadOS14Env=(lh.os===ln.IOS||lh.os===ln.OSX)&&_n.isBrowser&&/(OS 14)|(Version\/14)/.test(window.navigator.userAgent)}(),i.sys=lh;var uh=t("serializeTag",Symbol("[[Serialize]]")),hh=t("deserializeTag",Symbol("[[Deserialize]]")),fh=function(){function t(t,e){this._document=void 0,this._chunks=void 0,this._document=t,this._chunks=e}return L(t,[{key:"document",get:function(){return this._document}},{key:"chunks",get:function(){return this._chunks}}]),t}();function _h(t){var e=t;return{chunks:e.chunks,document:e.document}}function ph(t){if(t.length<16)throw new dh(R(13102));var e=new DataView(t.buffer,t.byteOffset,t.byteLength);if(1313817411!==e.getUint32(0,!0))throw new dh(R(13100));var n=e.getUint32(4,!0);if(1!==n)throw new dh(R(13101,n));if(e.getUint32(8,!0)!==e.byteLength)throw new dh(R(13102));var i=12,r=e.getUint32(i,!0);i+=4;var a=new Uint8Array(e.buffer,i+e.byteOffset,r);i+=r;var o,s=function(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);if("Buffer"in globalThis)return globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString();throw new Error(R(13104))}(a);try{o=JSON.parse(s)}catch(t){throw new dh(t)}for(var c=[];i<e.byteLength;){i%8!=0&&(i+=8-i%8);var l=e.getUint32(i,!0);i+=4,c.push(new Uint8Array(e.buffer,i+e.byteOffset,l)),i+=l}if(i!==e.byteLength)throw new dh(R(13102));return new fh(o,c)}var dh=function(t){function e(){return t.apply(this,arguments)||this}return F(e,t),e}(H(Error));function mh(t,e,n,r,a){if(e instanceof i.ValueType){a||t.push("if(prop){");var o=_t(e);t.push("s._deserializeFastDefinedObject(o"+n+",prop,"+o+");"),a||t.push("}else o"+n+"=null;")}else t.push("\nif (prop) {\n    s._deserializeAndAssignField(o, prop, "+r+");\n} else {\n    o"+n+"=null;\n}\n")}!function(){function t(){this._viewOrPaddings=[],this._length=0}var e=t.prototype;e.alignAs=function(t){if(0!==t){var e=this._length%t;if(0!==e){var n=t-e;return this._viewOrPaddings.push(n),this._length+=n,n}}return 0},e.append=function(t){var e=this._length;return this._viewOrPaddings.push(t),this._length+=t.byteLength,e},e.get=function(){var t=new Uint8Array(this._length),e=0;return this._viewOrPaddings.forEach((function(n){"number"==typeof n?e+=n:(t.set(new Uint8Array(n.buffer,n.byteOffset,n.byteLength),e),e+=n.byteLength)})),t},L(t,[{key:"byteLength",get:function(){return this._length}}])}(),i.internal.parseCCONJson=_h,i.internal.decodeCCONBinary=ph,i.internal.CCON=fh;var gh="$_$default",vh="$_$formerlySerializedAs",yh=function(t){function e(){return t.call(this,(function(t){t.clear()}),1)||this}return F(e,t),e.prototype.get=function(t,e,n,i,r){var a=this._get();return a?(a.reset(t,e,n,i,r),a):new xh(t,e,n,i,r)},e}(Ut),xh=function(){function t(t,e,n,i){this.deserializedList=void 0,this.deserializedData=void 0,this._ignoreEditorOnly=void 0,this.result=t,this.customEnv=i,this.deserializedList=[],this.deserializedData=null,this._classFinder=e,this._reportMissingClass=n,this._onDereferenced=null==e?void 0:e.onDereferenced}var e=t.prototype;return e.reset=function(t,e,n,i){this.result=t,this.customEnv=i,this._classFinder=e,this._reportMissingClass=n,this._onDereferenced=null==e?void 0:e.onDereferenced},e.clear=function(){this.result=null,this.customEnv=null,this.deserializedList.length=0,this.deserializedData=null,this._classFinder=null,this._reportMissingClass=null,this._onDereferenced=null},e.deserialize=function(t){var e,n=!1;t instanceof fh?(n=!0,e=t.document,t.chunks.length>0&&(t.chunks.length,this._mainBinChunk=t.chunks[0])):e=t,this._serializedData=e,this._context={fromCCON:n};var i=Array.isArray(e)?e[0]:e;return this.deserializedData=this._deserializeObject(i,0),this._serializedData=void 0,this._mainBinChunk=void 0,this._context=void 0,this.deserializedData},e._deserializeObject=function(t,e,n,i){switch(t.__type__){case"TypedArray":return this._deserializeTypedArrayView(t);case"TypedArrayRef":return this._deserializeTypedArrayViewRef(t);default:return t.__type__?this._deserializeTypeTaggedObject(t,e,n,i):Array.isArray(t)?this._deserializeArray(t):this._deserializePlainObject(t)}},e._deserializeTypedArrayView=function(t){return globalThis[t.ctor].from(t.array)},e._deserializeTypedArrayViewRef=function(t){var e=t.offset,n=t.length,i=t.ctor;return new globalThis[i](this._mainBinChunk.buffer,this._mainBinChunk.byteOffset+e,n)},e._deserializeArray=function(t){for(var e,n=new Array(t.length),i=0;i<t.length;i++)"object"==typeof(e=t[i])&&e?this._deserializeAndAssignField(n,e,""+i)&&(n[i]=null):n[i]=e;return n},e._deserializePlainObject=function(t){var e={};return this._fillPlainObject(e,t),e},e._deserializeTypeTaggedObject=function(t,e,n,i){var r=this,a=t.__type__,o=this._classFinder(a,t,n,i);if(!o)return this._classFinder===Bt&&this._reportMissingClass(a),null;var s=function(t){var n=new t;return e>=0&&(r.deserializedList[e]=n),n}(o);return this._deserializeInto(t,s,o),s},e._deserializeInto=function(t,e,n,r){void 0===r&&(r=!1),r||!e[hh]?e._deserialize?e._deserialize(t.content,this):i.Class._isCCClass(n)?this._deserializeFireClass(e,t,n):this._deserializeFastDefinedObject(e,t,n):this._runCustomizedDeserialize(t,e,n)},e._runCustomizedDeserialize=function(t,e,n){var i=this,r={readProperty:function(e){var n=t[e];return"object"==typeof n&&n?i._deserializeObjectField(n):n},readThis:function(){i._deserializeInto(t,e,n,!0)},readSuper:function(){var r=Ct(n);r&&i._deserializeInto(t,e,r)}};e[hh](r,this._context)},e._deserializeFireClass=function(t,e,n){var r;if(n.hasOwnProperty("__deserialize__"))r=n.__deserialize__;else{r=function(t,e){for(var n=ve(e),r=e.__values__,a=["var prop;"],o=te.test(zt(e)),s=0;s<r.length;s++){var c=r[s],l=void 0,u=void 0;Ge.IDENTIFIER_RE.test(c)?(u='"'+c+'"',l="."+c):l="["+(u=Ge.escapeForJS(c))+"]";var h=l;if(n[c+vh]){var f=n[c+vh];h=Ge.IDENTIFIER_RE.test(f)?"."+f:"["+Ge.escapeForJS(f)+"]"}a.push("prop=d"+h+";"),a.push('if(typeof prop!=="undefined"){');var _=Ge.getDefault(n[c+gh]);if(o){var p=void 0,d=n[c+"$_$type"];if(void 0===_&&d)p=d instanceof xe;else{var m=typeof _;p="string"===m||"number"===m||"boolean"===m}p?a.push("o"+l+"=prop;"):mh(a,_,l,u,!0)}else a.push('if(typeof prop!=="object"){o'+l+"=prop;}else{"),mh(a,_,l,u,!1),a.push("}");a.push("}")}return(i.js.isChildClassOf(e,i._BaseNode)||i.js.isChildClassOf(e,i.Component))&&a.push("d._id&&(o._id=d._id);"),"_$erialized"===r[r.length-1]&&(a.push("o._$erialized=JSON.parse(JSON.stringify(d));"),a.push("s._fillPlainObject(o._$erialized,d);")),Function("s","o","d","k",a.join(""))}(0,n);try{if(n===nh){var a=n.__values__;0!==a.length&&"_$erialized"===a[a.length-1]||(d("The '_$erialized' prop of MissingScript is missing. Will force the raw data to be save."),d("    Error props: ['"+a+"']. Please contact jare."));var o=r;r=function(t,e,n,i){try{JSON.parse(JSON.stringify(n._$erialized))||d("Unable to load previously serialized data. "+JSON.stringify(n))}catch(t){d("Error when checking MissingScript 7, "+t)}o(t,e,n,i)}}}catch(t){d("Error when checking MissingScript 6, "+t)}ct(n,"__deserialize__",r,!0)}r(this,t,e,n)},e._deserializeAndAssignField=function(t,e,n){var i=e.__id__;if("number"==typeof i){var r=this.deserializedList[i];if(r)t[n]=r;else{var a,o=this._serializedData[i];t[n]=this._deserializeObject(o,i,void 0,n),null===(a=this._onDereferenced)||void 0===a||a.call(this,this.deserializedList,i,t,n)}}else{var s=e.__uuid__;if(s){var c=e.__expectedType__;this.result.push(t,n,s,c)}else t[n]=this._deserializeObject(e,-1)}return!1},e._deserializeObjectField=function(t){var e=t.__id__;if("number"==typeof e){var n=this.deserializedList[e];if(n)return n;var i=this._serializedData[e];return this._deserializeObject(i,e,void 0,void 0)}if(t.__uuid__)throw t.__expectedType__,new Error("Asset reference field serialization is currently not supported in custom serialization.");return this._deserializeObject(t,-1)},e._fillPlainObject=function(t,e){for(var n in e)if(e.hasOwnProperty(n)){var i=e[n];"object"!=typeof i?"__type__"!==n&&(t[n]=i):i?this._deserializeAndAssignField(t,i,n)&&(t[n]=null):t[n]=null}},e._deserializeFastDefinedObject=function(t,e,n){if(n===i.Vec2)return t.x=e.x||0,void(t.y=e.y||0);if(n===i.Vec3)return t.x=e.x||0,t.y=e.y||0,void(t.z=e.z||0);if(n!==i.Color){if(n===i.Size)return t.width=e.width||0,void(t.height=e.height||0);for(var r=ve(n),a=n.__values__,o=0;o<a.length;o++){var s=a[o],c=e[s];void 0!==c||e.hasOwnProperty(s)||(c=Ge.getDefault(r[s+gh])),"object"!=typeof c?t[s]=c:c?this._deserializeAndAssignField(t,c,s):t[s]=null}}else{t.r=e.r||0,t.g=e.g||0,t.b=e.b||0;var l=e.a;t.a=void 0===l?255:l}},t}();xh.pool=new yh;var Sh=[Ni,di,zi,Ti,_i,Gi,Vi,Ri];function Th(t,e){t.x=e[1],t.y=e[2],t.z=e[3],t.w=e[4]}var Ah=[function(t,e){t.x=e[1],t.y=e[2]},function(t,e){t.x=e[1],t.y=e[2],t.z=e[3]},Th,Th,function(t,e){t._val=e[1]},function(t,e){t.width=e[1],t.height=e[2]},function(t,e){t.x=e[1],t.y=e[2],t.width=e[3],t.height=e[4]},function(t,e){Ri.fromArray(t,e,1)}],Eh=t("Details",function(){function t(){this.uuidObjList=null,this.uuidPropList=null,this.uuidList=null,this.uuidTypeList=[]}var e=t.prototype;return e.init=function(t){t?(this.uuidObjList=t[8],this.uuidPropList=t[9],this.uuidList=t[10]):this.uuidList||(this.uuidList=[],this.uuidObjList=[],this.uuidPropList=[],this.uuidTypeList=[])},e.reset=function(){this.uuidList&&(this.uuidList.length=0,this.uuidObjList.length=0,this.uuidPropList.length=0,this.uuidTypeList.length=0)},e.push=function(t,e,n,i){this.uuidObjList.push(t),this.uuidPropList.push(e),this.uuidList.push(n),this.uuidTypeList.push(i||"")},t}());function Ch(t,e){for(var n=t[4][e[0]],i=n[0],r=new(0,i[0]),a=i[1],o=i[2],s=n[n.length-1],c=1;c<s;++c)r[a[n[c]]]=e[c];for(;c<e.length;++c){var l=a[n[c]],u=i[n[c]+o];(0,Dh[u])(t,r,l,e[c])}return r}function bh(t,e,n){var i=new e;return i._deserialize?i._deserialize(n,t[0]):b(5303,_t(e)),i}function wh(t,e,n,i){i>=0?e[n]=t[5][i]:t[7][3*~i]=e}function Ph(t){return function(e,n,i,r){n[i]=r;for(var a=0;a<r.length;++a)t(e,r,a,r[a])}}function Ih(t,e,n,i){e[n]=null,t[8][i]=e}function Rh(t,e,n,i){e[n]=Ch(t,i)}Eh.pool=new Ut((function(t){t.reset()}),5),Eh.pool.get=function(){return this._get()||new Eh};var Dh=new Array(13);function Oh(t,e,n){return t||n(e),Object}function Mh(t,e,n,i,r,a,o){var s=t(e);if(!s){if(r)return void(n[i]=function(e,n,i){return function(){var r=t(i)||Oh(a,i,o);return e[n]=r,new r}}(n,i,e));s=Oh(a,e,o)}n[i]=s}function Nh(t,e,n,i){for(var r=n||Bt,a=t[3],o=0;o<a.length;++o){var s=a[o];"string"!=typeof s?Mh(r,s[0],s,0,e,n,i):Mh(r,s,a,o,e,n,i)}}function Lh(t){var e=t[4];if(e)for(var n=t[3],i=0;i<e.length;++i){var r=e[i];r[0]=n[r[0]]}}function Bh(t,e,n){"string"==typeof t&&(t=JSON.parse(t));var r,a=!e;if(e=e||Eh.pool.get(),function(t){if(Array.isArray(t)){var e=t[0];return"number"==typeof e||e instanceof Fh}return!1}(t)){e.init(t),n=n||{};var o,s=t[0],c=!1;if("object"==typeof s&&(c=s.preprocessed,s=s.version),s<1)throw new Error(R(5304,s));n._version=s,n.result=e,t[0]=n,c||(Nh(t,!1,n.classFinder,null!==(o=n.reportMissingClass)&&void 0!==o?o:Bh.reportMissingClass),Lh(t)),i.game._isCloning=!0;var l=t[5],u=function(t){var e=t[5],n=t[6],i=0===n?0:n.length,r=e[e.length-1],a=e.length-i;"number"!=typeof r?r=0:(r<0&&(r=~r),--a);for(var o=0;o<a;++o)e[o]=Ch(t,e[o]);for(var s=t[3],c=0;c<i;++c,++o){var l=n[c],u=e[o];if(l>=0){var h=s[l];e[o]=bh(t,h,u)}else(0,Dh[l=~l])(t,e,o,u)}return r}(t);i.game._isCloning=!1,t[7]&&function(t,e,n){for(var i=t.length-1,r=0,a=3*t[i];r<a;r+=3){var o=t[r],s=e[t[r+2]],c=t[r+1];c>=0?o[n[c]]=s:o[~c]=s}for(;r<i;r+=3){var l=e[t[r]],u=e[t[r+2]],h=t[r+1];h>=0?l[n[h]]=u:l[~h]=u}}(t[7],l,t[2]),function(t){for(var e=t[5],n=t[2],i=t[1],r=t[8],a=t[9],o=t[10],s=0;s<r.length;++s){var c=r[s];"number"==typeof c&&(r[s]=e[c]);var l=a[s];"number"==typeof l&&(l=l>=0?n[l]:~l,a[s]=l);var u=o[s];"number"==typeof u&&(o[s]=i[u])}}(t),r=l[u]}else r=function(t,e,n){var r,a=(n=n||{}).classFinder||Bt,o=n.createAssetRefs||lh.platform===un.EDITOR_CORE,s=n.customEnv,c=n.ignoreEditorOnly,l=null!==(r=n.reportMissingClass)&&void 0!==r?r:i.deserialize.reportMissingClass;e.init();var u=xh.pool.get(e,a,l,s,c);i.game._isCloning=!0;var h=u.deserialize(t);return i.game._isCloning=!1,xh.pool.put(u),o&&e.assignAssetsBy(EditorExtends.serialize.asAsset),h}(t,e,n);return a&&Eh.pool.put(e),r}Dh[0]=function(t,e,n,i){e[n]=i},Dh[1]=wh,Dh[2]=Ph(wh),Dh[3]=Ph(Ih),Dh[4]=Rh,Dh[5]=function(t,e,n,i){Ah[i[0]](e[n],i)},Dh[6]=Ih,Dh[7]=function(t,e,n,i){e[n].set(i)},Dh[8]=function(t,e,n,i){var r=new Sh[i[0]];Ah[i[0]](r,i),e[n]=r},Dh[9]=Ph(Rh),Dh[10]=function(t,e,n,i){var r=t[3][i[0]];e[n]=bh(t,r,i[1])},Dh[11]=function(t,e,n,i){var r=i[0];e[n]=r;for(var a=1;a<i.length;a+=3){var o=i[a],s=i[a+1],c=i[a+2];(0,Dh[s])(t,r,o,c)}},Dh[12]=function(t,e,n,i){var r=i[0];e[n]=r;for(var a=0;a<r.length;++a){var o=r[a],s=i[a+1];0!==s&&(0,Dh[s])(t,r,a,o)}},Bh.Details=Eh,Bh.reportMissingClass=function(t){b(5302,t)};var Fh=function(t){this.preprocessed=!0,this.version=t};function zh(t,e,n){return[1,0,0,[t],0,n?[e,-1]:[e],[0],0,[],[],[]]}i.deserialize=Bh;var Uh,kh,Gh,Hh,Vh,jh,Wh,Xh,qh,Yh,Kh,Qh=Ye.Flags.Destroyed,Zh=Ye.Flags.PersistentMask,Jh=[];function $h(t){var e;if(t instanceof Ye){if(t._instantiate)return i.game._isCloning=!0,e=t._instantiate(null,!0),i.game._isCloning=!1,e;if(t instanceof i.Asset)throw new TypeError(R(6903))}return i.game._isCloning=!0,e=tf(t),i.game._isCloning=!1,e}function tf(t,e){var n;ef(t,n=t._iN$t?t._iN$t:t.constructor?new(0,t.constructor):Object.create(null),e);for(var i=0,r=Jh.length;i<r;++i)Jh[i]._iN$t=null;return Jh.length=0,n}function ef(t,e,n){Gt.value(t,"_iN$t",e,!0),Jh.push(t);var r=t.constructor;if(i.Class._isCCClass(r))!function(t,e,n,i){for(var r=t.__values__,a=0;a<r.length;a++){var o=r[a],s=e[o];if("object"==typeof s&&s){var c=n[o];c instanceof Jt&&c.constructor===s.constructor?c.set(s):n[o]=s._iN$t||nf(s,i)}else n[o]=s}}(r,t,e,n);else for(var a in t)if(t.hasOwnProperty(a)&&(95!==a.charCodeAt(0)||95!==a.charCodeAt(1)||"__type__"===a||"__prefab"===a)){var o=t[a];if("object"==typeof o&&o){if(o===e)continue;e[a]=o._iN$t||nf(o,n)}else e[a]=o}t instanceof Ye&&(e._objFlags&=Zh)}function nf(t,e){if(t instanceof Jt)return t.clone();if(t instanceof i.Asset)return t;var n;if(ArrayBuffer.isView(t)){var r=t.length;n=new t.constructor(r),t._iN$t=n,Jh.push(t);for(var a=0;a<r;++a)n[a]=t[a];return n}if(Array.isArray(t)){var o=t.length;n=new Array(o),t._iN$t=n,Jh.push(t);for(var s=0;s<o;++s){var c=t[s];n[s]="object"==typeof c&&c?c._iN$t||nf(c,e):c}return n}if(t._objFlags&Qh)return null;var l=t.constructor;if(i.Class._isCCClass(l)){if(e)if(e instanceof i.Component){if(t instanceof i._BaseNode||t instanceof i.Component)return t}else if(e instanceof i._BaseNode)if(t instanceof i._BaseNode){if(!t.isChildOf(e))return t}else if(t instanceof i.Component&&t.node&&!t.node.isChildOf(e))return t;n=new l}else if(l===Object)n={};else{if(l)return t;n=Object.create(null)}return ef(t,n,e),n}function rf(t,e){return(e<<3)+t}function af(t){return sf[t]}function of(t){switch(t){case Yh.Uint8:return Uint8Array;case Yh.Uint16:return Uint16Array;case Yh.Uint32:return Uint32Array;case Yh.Int8:return Int8Array;case Yh.Int16:return Int16Array;case Yh.Int32:return Int32Array;case Yh.Float32:return Float32Array;case Yh.Float64:return Float64Array}}$h._clone=tf,i.instantiate=$h,function(t){t[t.Uint8=0]="Uint8",t[t.Uint16=1]="Uint16",t[t.Uint32=2]="Uint32",t[t.Int8=3]="Int8",t[t.Int16=4]="Int16",t[t.Int32=5]="Int32",t[t.Float32=6]="Float32",t[t.Float64=7]="Float64"}(Yh||(Yh={})),function(t){t[t.Scalar=0]="Scalar",t[t.Vec2=1]="Vec2",t[t.Vec3=2]="Vec3",t[t.Vec4=3]="Vec4",t[t.Quat=4]="Quat",t[t.Mat4=5]="Mat4"}(Kh||(Kh={})),t("CompactValueTypeArray",nl("cc.CompactValueTypeArray")((Xh=Wh=function(){function t(){X(this,"_byteOffset",Gh,this),X(this,"_unitCount",Hh,this),X(this,"_unitElement",Vh,this),X(this,"_length",jh,this)}return t.lengthFor=function(t,e,n){return af(e).requiredUnits*t.length*of(n).BYTES_PER_ELEMENT},t.compress=function(e,n,i,r,a,o){for(var s=af(n),c=of(i),l=s.requiredUnits*e.length,u=new c(r,a,l),h=0;h<e.length;++h)s.compress(u,h,e[h]);var f=new t;return f._unitElement=rf(i,n),f._byteOffset=o,f._unitCount=l,f._length=e.length,f},t.prototype.decompress=function(t){for(var e,n={storageUnit:7&(e=this._unitElement),elementType:e>>3},i=n.storageUnit,r=af(n.elementType),a=new(of(i))(t,this._byteOffset,this._unitCount),o=new Array(this._length),s=0;s<this._length;++s)o[s]=r.decompress(a,s);return o},t}(),Wh.StorageUnit=Yh,Wh.ElementType=Kh,Gh=q((kh=Xh).prototype,"_byteOffset",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Hh=q(kh.prototype,"_unitCount",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Vh=q(kh.prototype,"_unitElement",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return rf(Yh.Uint8,Kh.Scalar)}}),jh=q(kh.prototype,"_length",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Uh=kh))||Uh);var sf=((qh={})[Kh.Scalar]={requiredUnits:1,compress:function(t,e,n){t[e]=n},decompress:function(t,e){return t[e]}},qh[Kh.Vec2]={requiredUnits:2,compress:function(t,e,n){t[2*e]=n.x,t[2*e+1]=n.y},decompress:function(t,e){return new di(t[2*e],t[2*e+1])}},qh[Kh.Vec3]={requiredUnits:3,compress:function(t,e,n){t[3*e]=n.x,t[3*e+1]=n.y,t[3*e+2]=n.z},decompress:function(t,e){return new di(t[3*e],t[3*e+1],t[3*e+2])}},qh[Kh.Vec4]={requiredUnits:4,compress:function(t,e,n){t[4*e]=n.x,t[4*e+1]=n.y,t[4*e+2]=n.z,t[4*e+3]=n.w},decompress:function(t,e){return new zi(t[4*e],t[4*e+1],t[4*e+2],t[4*e+3])}},qh[Kh.Quat]={requiredUnits:4,compress:function(t,e,n){t[4*e]=n.x,t[4*e+1]=n.y,t[4*e+2]=n.z,t[4*e+3]=n.w},decompress:function(t,e){return new Ti(t[4*e],t[4*e+1],t[4*e+2],t[4*e+3])}},qh[Kh.Mat4]={requiredUnits:16,compress:function(t,e,n){Ri.toArray(t,n,16*e)},decompress:function(t,e){return Ri.fromArray(new Ri,t,16*e)}},qh);function cf(){return 0}function lf(t){return t}function uf(t){return t*t}function hf(t){return t*(2-t)}function ff(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}function _f(t){return t*t*t}function pf(t){return--t*t*t+1}function df(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}function mf(t){return t*t*t*t}function gf(t){return 1- --t*t*t*t}function vf(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}function yf(t){return t*t*t*t*t}function xf(t){return--t*t*t*t*t+1}function Sf(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}function Tf(t){return 1===t?1:1-Math.cos(t*Math.PI/2)}function Af(t){return Math.sin(t*Math.PI/2)}function Ef(t){return.5*(1-Math.cos(Math.PI*t))}function Cf(t){return 0===t?0:Math.pow(1024,t-1)}function bf(t){return 1===t?1:1-Math.pow(2,-10*t)}function wf(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}function Pf(t){return 1-Math.sqrt(1-t*t)}function If(t){return Math.sqrt(1- --t*t)}function Rf(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}function Df(t){var e,n=.1;return 0===t?0:1===t?1:(!n||n<1?(n=1,e=.1):e=.4*Math.asin(1/n)/(2*Math.PI),-n*Math.pow(2,10*(t-=1))*Math.sin(2*(t-e)*Math.PI/.4))}function Of(t){var e,n=.1;return 0===t?0:1===t?1:(!n||n<1?(n=1,e=.1):e=.4*Math.asin(1/n)/(2*Math.PI),n*Math.pow(2,-10*t)*Math.sin(2*(t-e)*Math.PI/.4)+1)}function Mf(t){var e,n=.1;return 0===t?0:1===t?1:(!n||n<1?(n=1,e=.1):e=.4*Math.asin(1/n)/(2*Math.PI),(t*=2)<1?n*Math.pow(2,10*(t-=1))*Math.sin(2*(t-e)*Math.PI/.4)*-.5:n*Math.pow(2,-10*(t-=1))*Math.sin(2*(t-e)*Math.PI/.4)*.5+1)}function Nf(t){if(1===t)return 1;var e=1.70158;return t*t*((e+1)*t-e)}function Lf(t){if(0===t)return 0;var e=1.70158;return--t*t*((e+1)*t+e)+1}function Bf(t){var e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}function Ff(t){return 1-zf(1-t)}function zf(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}function Uf(t){return t<.5?.5*Ff(2*t):.5*zf(2*t-1)+.5}function kf(t){return t<=0?0:t>=1?1:t*t*(3-2*t)}function Gf(t){return t<=0?0:t>=1?1:t*t*t*(t*(6*t-15)+10)}i._decorator=Ql;var Hf=Jf(uf,hf),Vf=Jf(_f,pf),jf=Jf(mf,gf),Wf=Jf(yf,xf),Xf=Jf(Tf,Af),qf=Jf(Cf,bf),Yf=Jf(Pf,If),Kf=Jf(Df,Of),Qf=Jf(Nf,Lf),Zf=Jf(Ff,zf);function Jf(t,e){return function(n){return n<.5?e(2*n)/2:t(2*n-1)/2+.5}}var $f,t_,e_=Object.freeze({__proto__:null,constant:cf,linear:lf,quadIn:uf,quadOut:hf,quadInOut:ff,cubicIn:_f,cubicOut:pf,cubicInOut:df,quartIn:mf,quartOut:gf,quartInOut:vf,quintIn:yf,quintOut:xf,quintInOut:Sf,sineIn:Tf,sineOut:Af,sineInOut:Ef,expoIn:Cf,expoOut:bf,expoInOut:wf,circIn:Pf,circOut:If,circInOut:Rf,elasticIn:Df,elasticOut:Of,elasticInOut:Mf,backIn:Nf,backOut:Lf,backInOut:Bf,bounceIn:Ff,bounceOut:zf,bounceInOut:Uf,smooth:kf,fade:Gf,quadOutIn:Hf,cubicOutIn:Vf,quartOutIn:jf,quintOutIn:Wf,sineOutIn:Xf,expoOutIn:qf,circOutIn:Yf,elasticOutIn:Kf,backOutIn:Qf,bounceOutIn:Zf});t("easing",e_),function(t){t[t.LINEAR=0]="LINEAR",t[t.CONSTANT=1]="CONSTANT",t[t.QUAD_IN=2]="QUAD_IN",t[t.QUAD_OUT=3]="QUAD_OUT",t[t.QUAD_IN_OUT=4]="QUAD_IN_OUT",t[t.QUAD_OUT_IN=5]="QUAD_OUT_IN",t[t.CUBIC_IN=6]="CUBIC_IN",t[t.CUBIC_OUT=7]="CUBIC_OUT",t[t.CUBIC_IN_OUT=8]="CUBIC_IN_OUT",t[t.CUBIC_OUT_IN=9]="CUBIC_OUT_IN",t[t.QUART_IN=10]="QUART_IN",t[t.QUART_OUT=11]="QUART_OUT",t[t.QUART_IN_OUT=12]="QUART_IN_OUT",t[t.QUART_OUT_IN=13]="QUART_OUT_IN",t[t.QUINT_IN=14]="QUINT_IN",t[t.QUINT_OUT=15]="QUINT_OUT",t[t.QUINT_IN_OUT=16]="QUINT_IN_OUT",t[t.QUINT_OUT_IN=17]="QUINT_OUT_IN",t[t.SINE_IN=18]="SINE_IN",t[t.SINE_OUT=19]="SINE_OUT",t[t.SINE_IN_OUT=20]="SINE_IN_OUT",t[t.SINE_OUT_IN=21]="SINE_OUT_IN",t[t.EXPO_IN=22]="EXPO_IN",t[t.EXPO_OUT=23]="EXPO_OUT",t[t.EXPO_IN_OUT=24]="EXPO_IN_OUT",t[t.EXPO_OUT_IN=25]="EXPO_OUT_IN",t[t.CIRC_IN=26]="CIRC_IN",t[t.CIRC_OUT=27]="CIRC_OUT",t[t.CIRC_IN_OUT=28]="CIRC_IN_OUT",t[t.CIRC_OUT_IN=29]="CIRC_OUT_IN",t[t.ELASTIC_IN=30]="ELASTIC_IN",t[t.ELASTIC_OUT=31]="ELASTIC_OUT",t[t.ELASTIC_IN_OUT=32]="ELASTIC_IN_OUT",t[t.ELASTIC_OUT_IN=33]="ELASTIC_OUT_IN",t[t.BACK_IN=34]="BACK_IN",t[t.BACK_OUT=35]="BACK_OUT",t[t.BACK_IN_OUT=36]="BACK_IN_OUT",t[t.BACK_OUT_IN=37]="BACK_OUT_IN",t[t.BOUNCE_IN=38]="BOUNCE_IN",t[t.BOUNCE_OUT=39]="BOUNCE_OUT",t[t.BOUNCE_IN_OUT=40]="BOUNCE_IN_OUT",t[t.BOUNCE_OUT_IN=41]="BOUNCE_OUT_IN",t[t.SMOOTH=42]="SMOOTH",t[t.FADE=43]="FADE"}(t_||(t_={}));var n_,i_,r_,a_,o_,s_=(($f={})[t_.CONSTANT]=cf,$f[t_.LINEAR]=lf,$f[t_.QUAD_IN]=uf,$f[t_.QUAD_OUT]=hf,$f[t_.QUAD_IN_OUT]=ff,$f[t_.QUAD_OUT_IN]=Hf,$f[t_.CUBIC_IN]=_f,$f[t_.CUBIC_OUT]=pf,$f[t_.CUBIC_IN_OUT]=df,$f[t_.CUBIC_OUT_IN]=Vf,$f[t_.QUART_IN]=mf,$f[t_.QUART_OUT]=gf,$f[t_.QUART_IN_OUT]=vf,$f[t_.QUART_OUT_IN]=jf,$f[t_.QUINT_IN]=yf,$f[t_.QUINT_OUT]=xf,$f[t_.QUINT_IN_OUT]=Sf,$f[t_.QUINT_OUT_IN]=Wf,$f[t_.SINE_IN]=Tf,$f[t_.SINE_OUT]=Af,$f[t_.SINE_IN_OUT]=Ef,$f[t_.SINE_OUT_IN]=Xf,$f[t_.EXPO_IN]=Cf,$f[t_.EXPO_OUT]=bf,$f[t_.EXPO_IN_OUT]=wf,$f[t_.EXPO_OUT_IN]=qf,$f[t_.CIRC_IN]=Pf,$f[t_.CIRC_OUT]=If,$f[t_.CIRC_IN_OUT]=Rf,$f[t_.CIRC_OUT_IN]=Yf,$f[t_.ELASTIC_IN]=Df,$f[t_.ELASTIC_OUT]=Of,$f[t_.ELASTIC_IN_OUT]=Mf,$f[t_.ELASTIC_OUT_IN]=Kf,$f[t_.BACK_IN]=Nf,$f[t_.BACK_OUT]=Lf,$f[t_.BACK_IN_OUT]=Bf,$f[t_.BACK_OUT_IN]=Qf,$f[t_.BOUNCE_IN]=Ff,$f[t_.BOUNCE_OUT]=zf,$f[t_.BOUNCE_IN_OUT]=Uf,$f[t_.BOUNCE_OUT_IN]=Zf,$f[t_.SMOOTH]=kf,$f[t_.FADE]=Gf,$f);function c_(t){return s_[t]}var l_,u_,h_,f_=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).interpolationMode=Vl.LINEAR,e.tangentWeightMode=Wl.NONE,e.value=0,e.rightTangent=0,e.rightTangentWeight=0,e.leftTangent=0,e.leftTangentWeight=0,e.easingMethod=t_.LINEAR,e}return F(e,t),e}(Kl);function __(t){var e=new f_;if("number"==typeof t)e.value=t;else{var n=t.interpolationMode,i=t.tangentWeightMode,r=t.value,a=t.rightTangent,o=t.rightTangentWeight,s=t.leftTangent,c=t.leftTangentWeight,l=t.easingMethod,u=t[We];e.value=null!=r?r:e.value,e.rightTangent=null!=a?a:e.rightTangent,e.rightTangentWeight=null!=o?o:e.rightTangentWeight,e.leftTangent=null!=s?s:e.leftTangent,e.leftTangentWeight=null!=c?c:e.leftTangentWeight,e.interpolationMode=null!=n?n:e.interpolationMode,e.tangentWeightMode=null!=i?i:e.tangentWeightMode,e.easingMethod=null!=l?l:e.easingMethod,u&&(e[We]=u)}return e}Ge.fastDefine("cc.RealKeyframeValue",f_,{interpolationMode:Vl.LINEAR,tangentWeightMode:Wl.NONE,value:0,rightTangent:0,rightTangentWeight:0,leftTangent:0,leftTangentWeight:0,easingMethod:t_.LINEAR}),Ge.Attr.setClassAttr(f_,We,"editorOnly",!0),(l_=f_,null!==(h_=(u_=l_)[sl])&&void 0!==h_?h_:u_[sl]={}).uniquelyReferenced=!0;var p_,d_=t("RealCurve",nl("cc.RealCurve")((o_=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return X(e=t.call.apply(t,[this].concat(i))||this,"preExtrapolation",r_,V(e)),X(e,"postExtrapolation",a_,V(e)),e}F(e,t);var n=e.prototype;return n.evaluate=function(t){var e=this._times,n=this._values,i=e.length;if(0===i)return 0;var r=e[0],a=e[i-1];if(t<r){var o=this.preExtrapolation,s=n[0];if(o===jl.CLAMP||i<2)return s.value;switch(o){case jl.LINEAR:return D_(r,n[0].value,e[1],n[1].value,t);case jl.LOOP:t=I_(t,r,a);break;case jl.PING_PONG:t=R_(t,r,a);break;default:return s.value}}else if(t>a){var c=this.postExtrapolation,l=n[i-1];if(c===jl.CLAMP||i<2)return l.value;switch(c){case jl.LINEAR:return D_(a,l.value,e[i-2],n[i-2].value,t);case jl.LOOP:t=I_(t,r,a);break;case jl.PING_PONG:t=R_(t,r,a);break;default:return l.value}}var u=qc(e,t);if(u>=0)return n[u].value;var h=~u,f=h-1,_=e[f],p=n[f],d=e[h];return function(t,e,n,i,r){var a=n-t;switch(e.interpolationMode){default:case Vl.CONSTANT:return e.value;case Vl.LINEAR:var o=e.easingMethod===t_.LINEAR?r:c_(e.easingMethod)(r);return Qn(e.value,i.value,o);case Vl.CUBIC:var s=1/3,c=e.rightTangent,l=e.rightTangentWeight,u=0!=(e.tangentWeightMode&Wl.RIGHT),h=i.leftTangent,f=i.leftTangentWeight,_=0!=(i.tangentWeightMode&Wl.LEFT);if(u||_){var p=0;if(u)p=l;else{var d=a,m=a*c;p=Math.sqrt(d*d+m*m)*s}var g=Math.atan(c),v=Math.cos(g)*p+t,y=Math.sin(g)*p+e.value,x=0;if(_)x=f;else{var S=a,T=a*h;x=Math.sqrt(S*S+T*T)*s}var A=Math.atan(h),E=(v-t)/a,C=(-Math.cos(A)*x+n-t)/a,b=y,w=-Math.sin(A)*x+i.value,P=[0,0,0],I=function(t,e,n,i,r){var a=n/i,o=e/i,s=a*a,c=1/3*(-1/3*s+o),l=.5*(2/27*a*s-1/3*a*o+t/i),u=c*c*c,h=l*l+u,f=0;if(Yl(h)){if(Yl(l))return r[0]=0,1;var _=Math.cbrt(-l);return r[0]=2*_,r[1]=-_,2}if(h<0){var p=1/3*Math.acos(-l/Math.sqrt(-u)),d=2*Math.sqrt(-c);r[0]=d*Math.cos(p),r[1]=-d*Math.cos(p+Math.PI/3),r[2]=-d*Math.cos(p-Math.PI/3),f=3}else{var m=Math.sqrt(h),g=Math.cbrt(m-l),v=-Math.cbrt(m+l);r[0]=g+v,f=1}for(var y=1/3*a,x=0;x<f;++x)r[x]-=y;return f}(0-r,3*E,3*C-6*E,3*(E-C)+1,P),R=function(t,e,n){var i=n;if(1===e)i=t[0];else{i=-1/0;for(var r=0;r<e;++r){var a=t[r];a>=0&&a<=1&&a>i&&(i=a)}i===-1/0&&(i=0)}return i}(P,I,r);return O_(e.value,b,w,i.value,R)}var D=e.value+s*c*a,O=i.value-s*h*a;return O_(e.value,D,O,i.value,r)}}(_,p,d,n[h],(t-_)/(d-_))},n.addKeyFrame=function(e,n){return t.prototype.addKeyFrame.call(this,e,__(n))},n.assignSorted=function(t,e){if(void 0!==e)this.setKeyframes(t.slice(),e.map((function(t){return __(t)})));else{var n=Array.from(t);this.setKeyframes(n.map((function(t){return t[0]})),n.map((function(t){return __(t[1])})))}},n.isConstant=function(t){if(this._values.length<=1)return!0;var e=this._values[0].value;return this._values.every((function(n){return qn(n.value,e,t)}))},n[uh]=function(t,e){if(e.toCCON){var n=this._times,i=this._values,r=n.length,a=new DataView(new ArrayBuffer(0+m_+m_+g_+v_*r+b_*r)),o=0;a.setUint8(o,this.preExtrapolation),o+=m_,a.setUint8(o,this.postExtrapolation),o+=m_,a.setUint32(o,r,!0),o+=g_,n.forEach((function(t,e){return a.setFloat32(o+v_*e,t,!0)})),o+=v_*r;for(var s,c=W(i);!(s=c()).done;){var l=s.value;o=w_(a,l,o)}var u=new Uint8Array(a.buffer,0,o);t.writeProperty("bytes",u);var h=i.map((function(t){return t[We]}));h.some((function(t){return void 0!==t}))&&t.writeProperty("keyframeValueEditorExtras",h)}else t.writeThis()},n[hh]=function(t,e){if(e.fromCCON){var n=t.readProperty("bytes"),i=new DataView(n.buffer,n.byteOffset,n.byteLength),r=0;this.preExtrapolation=i.getUint8(r),r+=m_,this.postExtrapolation=i.getUint8(r),r+=m_;var a=i.getUint32(r,!0);r+=g_;var o=Array.from({length:a},(function(t,e){return i.getFloat32(r+v_*e,!0)}));r+=v_*a;for(var s=new Array(a),c=0;c<a;++c){var l=__({});r=P_(i,l,r),s[c]=l}n.byteLength;var u=t.readProperty("keyframeValueEditorExtras");u&&(u.length,u.forEach((function(t,e){return s[e][We]=t}))),this._times=o,this._values=s}else t.readThis()},e}(ql),r_=q((i_=o_).prototype,"preExtrapolation",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return jl.CLAMP}}),a_=q(i_.prototype,"postExtrapolation",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return jl.CLAMP}}),n_=i_))||n_);!function(t){t[t.VALUE=1]="VALUE",t[t.INTERPOLATION_MODE=2]="INTERPOLATION_MODE",t[t.TANGENT_WEIGHT_MODE=4]="TANGENT_WEIGHT_MODE",t[t.LEFT_TANGENT=8]="LEFT_TANGENT",t[t.LEFT_TANGENT_WEIGHT=16]="LEFT_TANGENT_WEIGHT",t[t.RIGHT_TANGENT=32]="RIGHT_TANGENT",t[t.RIGHT_TANGENT_WEIGHT=64]="RIGHT_TANGENT_WEIGHT"}(p_||(p_={}));var m_=1,g_=4,v_=4,y_=__({}),x_=y_.interpolationMode,S_=y_.tangentWeightMode,T_=y_.leftTangent,A_=y_.leftTangentWeight,E_=y_.rightTangent,C_=y_.rightTangentWeight,b_=26;function w_(t,e,n){var i=0,r=n,a=r;r+=4;var o=e.value,s=e.interpolationMode,c=e.tangentWeightMode,l=e.rightTangent,u=e.rightTangentWeight,h=e.leftTangent,f=e.leftTangentWeight,_=e.easingMethod;return t.setFloat32(r,o,!0),r+=4,s!==x_&&(i|=p_.INTERPOLATION_MODE,t.setUint8(r,s),r+=1),c!==S_&&(i|=p_.TANGENT_WEIGHT_MODE,t.setUint8(r,c),r+=1),h!==T_&&(i|=p_.LEFT_TANGENT,t.setFloat32(r,h,!0),r+=4),f!==A_&&(i|=p_.LEFT_TANGENT_WEIGHT,t.setFloat32(r,f,!0),r+=4),l!==E_&&(i|=p_.RIGHT_TANGENT,t.setFloat32(r,l,!0),r+=4),u!==C_&&(i|=p_.RIGHT_TANGENT_WEIGHT,t.setFloat32(r,u,!0),r+=4),i|=_<<8,t.setUint32(a,i,!0),r}function P_(t,e,n){var i=n,r=t.getUint32(i,!0);i+=4,e.value=t.getFloat32(i,!0),i+=4,r&p_.INTERPOLATION_MODE&&(e.interpolationMode=t.getUint8(i),i+=1),r&p_.TANGENT_WEIGHT_MODE&&(e.tangentWeightMode=t.getUint8(i),i+=1),r&p_.LEFT_TANGENT&&(e.leftTangent=t.getFloat32(i,!0),i+=4),r&p_.LEFT_TANGENT_WEIGHT&&(e.leftTangentWeight=t.getFloat32(i,!0),i+=4),r&p_.RIGHT_TANGENT&&(e.rightTangent=t.getFloat32(i,!0),i+=4),r&p_.RIGHT_TANGENT_WEIGHT&&(e.rightTangentWeight=t.getFloat32(i,!0),i+=4);var a=(65280&r)>>8;return e.easingMethod=a,i}function I_(t,e,n){return e+oi(t-e,n-e)}function R_(t,e,n){return e+si(t-e,n-e)}function D_(t,e,n,i,r){return e+(i-e)/(n-t)*(r-t)}function O_(t,e,n,i,r){var a=1-r;return a*a*a*t+3*a*a*r*e+3*a*r*r*n+r*r*r*i}function M_(t,e,n,i,r){var a=1-r;return a*(a*(t+(3*e-t)*r)+3*n*r*r)+i*r*r*r}i.bezier=M_;var N_,L_,B_,F_,z_,U_,k_,G_,H_,V_,j_,W_=Math.cos,X_=Math.acos,q_=Math.max,Y_=2*Math.PI,K_=Math.sqrt;function Q_(t){return t<0?-Math.pow(-t,1/3):Math.pow(t,1/3)}function Z_(t,e){var n=function(t,e){var n,i,r,a,o=e-0,s=e-t[0],c=3*o,l=3*s,u=3*(e-t[2]),h=1/(-o+l-u+(e-1)),f=1/3,_=(c-6*s+u)*h,p=_*f,d=(-c+l)*h,m=(3*d-_*_)*f,g=m*f,v=(2*_*_*_-9*_*d+o*h*27)/27,y=v/2,x=y*y+g*g*g;if(x<0){var S=-m*f,T=K_(S*S*S),A=-v/(2*T),E=X_(A<-1?-1:A>1?1:A),C=2*Q_(T);return i=C*W_(E*f)-p,r=C*W_((E+Y_)*f)-p,a=C*W_((E+2*Y_)*f)-p,i>=0&&i<=1?r>=0&&r<=1?a>=0&&a<=1?q_(i,r,a):q_(i,r):a>=0&&a<=1?q_(i,a):i:r>=0&&r<=1?a>=0&&a<=1?q_(r,a):r:a}if(0===x)return r=-(n=y<0?Q_(-y):-Q_(y))-p,(i=2*n-p)>=0&&i<=1?r>=0&&r<=1?q_(i,r):i:r;var b=K_(x);return(n=Q_(-y+b))-Q_(y+b)-p}(t,e),i=t[1];return((1-n)*(i+(t[3]-i)*n)*3+n*n)*n}i.bezierByTime=Z_,function(t){t[t.SLERP=0]="SLERP",t[t.CONSTANT=1]="CONSTANT"}(j_||(j_=t("QuatInterpolationMode",{})));var J_=nl("cc.QuatKeyframeValue")(N_=fl((B_=q((L_=function(t){var e=void 0===t?{}:t,n=e.value,i=e.interpolationMode,r=e.easingMethod;X(this,"interpolationMode",B_,this),X(this,"value",F_,this),X(this,"easingMethod",z_,this),this.value=n?Ti.clone(n):this.value,this.interpolationMode=null!=i?i:this.interpolationMode,this.easingMethod=null!=r?r:this.easingMethod}).prototype,"interpolationMode",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return j_.SLERP}}),F_=q(L_.prototype,"value",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ti.clone(Ti.IDENTITY)}}),z_=q(L_.prototype,"easingMethod",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return t_.LINEAR}}),N_=L_))||N_)||N_;function $_(t){return new J_(t)}var tp,ep=t("QuatCurve",nl("cc.QuatCurve")((V_=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return X(e=t.call.apply(t,[this].concat(i))||this,"preExtrapolation",G_,V(e)),X(e,"postExtrapolation",H_,V(e)),e}F(e,t);var n=e.prototype;return n.evaluate=function(t,e){var n;null!==(n=e)&&void 0!==n||(e=new Ti);var i=this._times,r=this._values,a=this.postExtrapolation,o=this.preExtrapolation,s=i.length;if(0===s)return e;var c=i[0],l=i[s-1];if(t<c){var u=r[0];switch(o){case jl.LOOP:t=c+oi(t-c,l-c);break;case jl.PING_PONG:t=c+si(t-c,l-c);break;case jl.CLAMP:default:return Ti.copy(e,u.value)}}else if(t>l){var h=r[s-1];switch(a){case jl.LOOP:t=c+oi(t-c,l-c);break;case jl.PING_PONG:t=c+si(t-c,l-c);break;case jl.CLAMP:default:return Ti.copy(e,h.value)}}var f=qc(i,t);if(f>=0)return Ti.copy(e,r[f].value);var _=~f,p=_-1,d=i[p],m=r[p],g=i[_],v=r[_],y=(t-d)/(g-d);switch(m.interpolationMode){default:case j_.CONSTANT:return Ti.copy(e,m.value);case j_.SLERP:var x=m.easingMethod,S=x===t_.LINEAR?y:Array.isArray(x)?Z_(x,y):c_(x)(y);return Ti.slerp(e,m.value,v.value,S)}},n.addKeyFrame=function(e,n){var i=new J_(n);return t.prototype.addKeyFrame.call(this,e,i)},n.assignSorted=function(t,e){if(void 0!==e)this.setKeyframes(t.slice(),e.map((function(t){return $_(t)})));else{var n=Array.from(t);this.setKeyframes(n.map((function(t){return t[0]})),n.map((function(t){return $_(t[1])})))}},n[uh]=function(t,e){if(e.toCCON){var n=this._times,i=this._values,r=!0;i.forEach((function(t,e,n){var i=n[0];r&&t.interpolationMode!==i.interpolationMode&&(r=!1)}));var a=n.length,o=fp*(r?1:a),s=i.reduce((function(t,e){var n=e.easingMethod;return t+(Array.isArray(n)?_p+4*dp:_p)}),0),c=0,l=new DataView(new ArrayBuffer(c+=cp+lp+up*a+4*hp*a+s+o+0)),u=0,h=0;r&&(h|=tp.INTERPOLATION_MODE),l.setUint32(u,h,!0),u+=cp,l.setUint32(u,a,!0),u+=lp,n.forEach((function(t,e){return l.setFloat32(u+up*e,t,!0)})),u+=up*a,i.forEach((function(t,e){var n=t.value,i=n.x,r=n.y,a=n.z,o=n.w,s=u+4*hp*e;l.setFloat32(s+0*hp,i,!0),l.setFloat32(s+1*hp,r,!0),l.setFloat32(s+2*hp,a,!0),l.setFloat32(s+3*hp,o,!0)})),u+=4*hp*a,i.forEach((function(t){var e=t.easingMethod;Array.isArray(e)?(l.setUint8(u,pp),++u,l.setFloat32(u+0*dp,e[0],!0),l.setFloat32(u+1*dp,e[1],!0),l.setFloat32(u+2*dp,e[2],!0),l.setFloat32(u+3*dp,e[3],!0),u+=4*dp):(l.setUint8(u,e),++u)}));var f=u;u+=o;var _=f;i.forEach((function(t){var e=t.interpolationMode;l.setUint8(_,e),r||(_+=fp)}));var p=new Uint8Array(l.buffer);t.writeProperty("bytes",p)}else t.writeThis()},n[hh]=function(t,e){if(e.fromCCON){var n=t.readProperty("bytes"),i=new DataView(n.buffer,n.byteOffset,n.byteLength),r=0,a=i.getUint32(r,!0);r+=cp;var o=a&tp.INTERPOLATION_MODE,s=i.getUint32(r,!0);r+=lp;var c=Array.from({length:s},(function(t,e){return i.getFloat32(r+up*e,!0)})),l=r+=up*s;r+=4*hp*s;var u=Array.from({length:s},(function(t,e){var n=l+4*hp*e,a=i.getFloat32(n+0*hp,!0),o=i.getFloat32(n+1*hp,!0),s=i.getFloat32(n+2*hp,!0),c=i.getFloat32(n+3*hp,!0),u=i.getUint8(r);++r;var h=$_({value:{x:a,y:o,z:s,w:c}});return u!==pp?h.easingMethod=u:(h.easingMethod=[i.getFloat32(r+0*dp,!0),i.getFloat32(r+1*dp,!0),i.getFloat32(r+2*dp,!0),i.getFloat32(r+3*dp,!0)],r+=4*dp),h}));if(o){var h=i.getUint8(r);++r;for(var f=0;f<s;++f)u[f].interpolationMode=h}else{for(var _=0;_<s;++_){var p=i.getUint8(r+_);u[_].interpolationMode=p}r+=s}this._times=c,this._values=u}else t.readThis()},e}(ql),G_=q((k_=V_).prototype,"preExtrapolation",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return jl.CLAMP}}),H_=q(k_.prototype,"postExtrapolation",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return jl.CLAMP}}),U_=k_))||U_);!function(t){t[t.INTERPOLATION_MODE=1]="INTERPOLATION_MODE"}(tp||(tp={}));var np,ip,rp,ap,op,sp,cp=1,lp=4,up=4,hp=4,fp=1,_p=1,pp=255,dp=4,mp=t("ObjectCurve",nl("cc.ObjectCurve")(np=function(t){function e(){return t.apply(this,arguments)||this}return F(e,t),e.prototype.evaluate=function(t){var e=this.searchKeyframe(t);if(e>=0)return this._values[e];var n=Yn(~e-1,0,this._values.length-1);return this._values[n]},e}(ql))||np),gp=function(){this.time=0,this.value=0,this.inTangent=0,this.outTangent=0};Ge.fastDefine("cc.Keyframe",gp,{time:0,value:0,inTangent:0,outTangent:0});var vp=function(){function t(){this.index=void 0,this.time=void 0,this.endTime=void 0,this.coefficient=void 0,this.index=-1,this.time=0,this.endTime=0,this.coefficient=new Float32Array(4)}return t.prototype.evaluate=function(t){return e=t-this.time,n=this.coefficient,e*(e*(e*n[0]+n[1])+n[2])+n[3];var e,n},t}(),yp=nl("cc.AnimationCurve")((sp=op=function(){function t(t){if(void 0===t&&(t=null),X(this,"_curve",ap,this),this.cachedKey=void 0,t instanceof d_)this._curve=t;else{var e=new d_;this._curve=e,e.preExtrapolation=jl.LOOP,e.postExtrapolation=jl.CLAMP,t?e.assignSorted(t.map((function(t){return[t.time,{interpolationMode:Vl.CUBIC,value:t.value,leftTangent:t.inTangent,rightTangent:t.outTangent}]}))):e.assignSorted([[0,{interpolationMode:Vl.CUBIC,value:1}],[1,{interpolationMode:Vl.CUBIC,value:1}]])}this.cachedKey=new vp}var e=t.prototype;return e.addKey=function(t){t?this._curve.addKeyFrame(t.time,{interpolationMode:Vl.CUBIC,value:t.value,leftTangent:t.inTangent,rightTangent:t.outTangent}):this._curve.clear()},e.evaluate_slow=function(t){return this._curve.evaluate(t)},e.evaluate=function(t){var e=this.cachedKey,n=this._curve,i=n.keyFramesCount-1,r=t,a=t<0?n.preExtrapolation:n.postExtrapolation,o=n.getKeyframeTime(0),s=n.getKeyframeTime(i);switch(a){case jl.LOOP:r=oi(t-o,s-o)+o;break;case jl.PING_PONG:r=si(t-o,s-o)+o;break;case jl.CLAMP:default:r=Yn(t,o,s)}if(r>=e.time&&r<e.endTime)return e.evaluate(r);var c=this.findIndex(e,r),l=Math.min(c+1,i);return this.calcOptimizedKey(e,c,l),e.evaluate(r)},e.calcOptimizedKey=function(t,e,n){var i=this._curve.getKeyframeTime(e),r=this._curve.getKeyframeTime(n),a=this._curve.getKeyframeValue(e),o=a.value,s=a.leftTangent,c=this._curve.getKeyframeValue(n),l=c.value,u=c.rightTangent;t.index=e,t.time=i,t.endTime=r;var h=r-i,f=l-o,_=1/(h*h),p=s*h,d=u*h;t.coefficient[0]=(p+d-f-f)*_/h,t.coefficient[1]=(f+f+f-p-p-d)*_,t.coefficient[2]=s,t.coefficient[3]=o},e.findIndex=function(t,e){var n=this._curve,i=n.keyFramesCount,r=t.index;if(-1!==r)if(e>n.getKeyframeTime(r))for(var a=0;a<3;a++){var o=r+a;if(o+1<i&&n.getKeyframeTime(o+1)>e)return o}else for(var s=0;s<3;s++){var c=r-s;if(c>=0&&n.getKeyframeTime(c-1)<=e)return c-1}for(var l,u=0,h=i;h-u>1;)l=Math.floor((u+h)/2),n.getKeyframeTime(l)>=e?h=l:u=l;return u},L(t,[{key:"_internalCurve",get:function(){return this._curve}},{key:"keyFrames",get:function(){return Array.from(this._curve.keyframes()).map((function(t){var e=t[0],n=t[1],i=new gp;return i.time=e,i.value=n.value,i.inTangent=n.leftTangent,i.outTangent=n.rightTangent,i}))},set:function(t){this._curve.assignSorted(t.map((function(t){return[t.time,{interpolationMode:Vl.CUBIC,value:t.value,leftTangent:t.inTangent,rightTangent:t.outTangent}]})))}},{key:"preWrapMode",get:function(){return Sp(this._curve.preExtrapolation)},set:function(t){this._curve.preExtrapolation=xp(t)}},{key:"postWrapMode",get:function(){return Sp(this._curve.postExtrapolation)},set:function(t){this._curve.postExtrapolation=xp(t)}}]),t}(),op.defaultKF=[{time:0,value:1,inTangent:0,outTangent:0},{time:1,value:1,inTangent:0,outTangent:0}],ap=q((rp=sp).prototype,"_curve",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ip=rp))||ip;function xp(t){switch(t){default:case kc.Default:case kc.Normal:case kc.Clamp:return jl.CLAMP;case kc.PingPong:return jl.PING_PONG;case kc.Loop:return jl.LOOP}}function Sp(t){switch(t){default:case jl.LINEAR:case jl.CLAMP:return kc.Clamp;case jl.PING_PONG:return kc.PingPong;case jl.LOOP:return kc.Loop}}function Tp(t,e){console.warn(t+" is deprecated, please use "+e+" instead.")}Nn($s,"intersect",[{name:"ray_aabb",newName:"rayAABB"},{name:"ray_plane",newName:"rayPlane"},{name:"ray_triangle",newName:"rayTriangle"},{name:"ray_sphere",newName:"raySphere"},{name:"ray_obb",newName:"rayOBB"},{name:"ray_capsule",newName:"rayCapsule"},{name:"ray_subMesh",newName:"raySubMesh"},{name:"ray_mesh",newName:"rayMesh"},{name:"ray_model",newName:"rayModel"},{name:"line_plane",newName:"linePlane"},{name:"line_triangle",newName:"lineTriangle"},{name:"line_aabb",newName:"lineAABB"},{name:"line_obb",newName:"lineOBB"},{name:"line_sphere",newName:"lineSphere"},{name:"aabb_aabb",newName:"aabbWithAABB"},{name:"aabb_obb",newName:"aabbWithOBB"},{name:"aabb_plane",newName:"aabbPlane"},{name:"aabb_frustum",newName:"aabbFrustum"},{name:"aabbFrustum_accurate",newName:"aabbFrustumAccurate"},{name:"obb_point",newName:"obbPoint"},{name:"obb_plane",newName:"obbPlane"},{name:"obb_frustum",newName:"obbFrustum"},{name:"obbFrustum_accurate",newName:"obbFrustumAccurate"},{name:"obb_obb",newName:"obbWithOBB"},{name:"obb_capsule",newName:"obbCapsule"},{name:"sphere_plane",newName:"spherePlane"},{name:"sphere_frustum",newName:"sphereFrustum"},{name:"sphereFrustum_accurate",newName:"sphereFrustumAccurate"},{name:"sphere_sphere",newName:"sphereWithSphere"},{name:"sphere_aabb",newName:"sphereAABB"},{name:"sphere_obb",newName:"sphereOBB"},{name:"sphere_capsule",newName:"sphereCapsule"},{name:"capsule_capsule",newName:"capsuleWithCapsule"}]);var Ap=function(t){function e(){var e;return e=t.call(this)||this,Tp("line","Line"),e}return F(e,t),e}(lr),Ep=function(t){function e(){var e;return e=t.call(this)||this,Tp("plane","Plane"),e}return F(e,t),e}(hc),Cp=function(t){function e(){var e;return e=t.call(this)||this,Tp("ray","Ray"),e}return F(e,t),e}(ur),bp=function(t){function e(){var e;return e=t.call(this)||this,Tp("triangle","Triangle"),e}return F(e,t),e}(ra),wp=function(t){function e(){var e;return e=t.call(this)||this,Tp("sphere","Sphere"),e}return F(e,t),e}(ia),Pp=function(t){function e(){var e;return e=t.call(this)||this,Tp("aabb","AABB"),e}return F(e,t),e}(Mc),Ip=function(t){function e(){var e;return e=t.call(this)||this,Tp("obb","OBB"),e}return F(e,t),e}(Fc),Rp=function(t){function e(){var e;return e=t.call(this)||this,Tp("capsule","Capsule"),e}return F(e,t),e}(zc),Dp=function(t){function e(){var e;return e=t.call(this)||this,Tp("frustum","Frustum"),e}return F(e,t),e}(Wc),Op=Object.freeze({__proto__:null,distance:sr,enums:cr,intersect:$s,Line:lr,Plane:hc,Ray:ur,Triangle:ra,Sphere:ia,AABB:Mc,OBB:Fc,Capsule:zc,Frustum:Wc,Keyframe:gp,AnimationCurve:yp,get ERaycastMode(){return qo},line:Ap,plane:Ep,ray:Cp,triangle:bp,sphere:wp,aabb:Pp,obb:Ip,capsule:Rp,frustum:Dp});t("geometry",Op);var Mp={NONE:0,IGNORE_RAYCAST:1<<20,GIZMOS:1<<21,EDITOR:1<<22,UI_3D:1<<23,SCENE_GIZMO:1<<24,UI_2D:1<<25,PROFILER:1<<28,DEFAULT:1<<30,ALL:4294967295},Np=t("Layers",function(){function t(){}return t.makeMaskInclude=function(t){for(var e,n=0,i=W(t);!(e=i()).done;)n|=e.value;return n},t.makeMaskExclude=function(e){return~t.makeMaskInclude(e)},t.addLayer=function(e,n){if(void 0!==n)if(n>19||n<0)console.warn("maximum layers reached.");else{var i=1<<n;t.Enum[e],R(2104,e),t.Enum[e]=i,Gt.value(t.Enum,String(i),e),t.BitMask[e]=i,Gt.value(t.BitMask,String(i),e)}else console.warn("bitNum can't be undefined")},t.deleteLayer=function(e){if(e>19||e<0)console.warn("do not change buildin layers.");else{var n=1<<e;delete t.Enum[t.Enum[n]],delete t.Enum[n],delete t.BitMask[t.BitMask[n]],delete t.BitMask[n]}},t.nameToLayer=function(e){return void 0===e?(console.warn("name can't be undefined"),-1):In(t.Enum[e])},t.layerToName=function(e){return e>31||e<0?(console.warn("Unable to access unknown layer."),""):t.Enum[1<<e]},t}());Np.Enum=Yt(Mp),Np.BitMask=qt(B({},Mp)),i.Layers=Np;var Lp,Bp,Fp="MainFlow",zp="ForwardFlow",Up="ShadowFlow";!function(t){t[t.DEFAULT=100]="DEFAULT",t[t.UI=200]="UI"}(Lp||(Lp={})),i.RenderPassStage=Lp,function(t){t[t.MIN=0]="MIN",t[t.MAX=255]="MAX",t[t.DEFAULT=128]="DEFAULT"}(Bp||(Bp={}));var kp,Gp={bindings:[],layouts:{}},Hp={bindings:[],layouts:{}};!function(t){t[t.UBO_GLOBAL=0]="UBO_GLOBAL",t[t.UBO_CAMERA=1]="UBO_CAMERA",t[t.UBO_SHADOW=2]="UBO_SHADOW",t[t.SAMPLER_SHADOWMAP=3]="SAMPLER_SHADOWMAP",t[t.SAMPLER_ENVIRONMENT=4]="SAMPLER_ENVIRONMENT",t[t.SAMPLER_SPOT_LIGHTING_MAP=5]="SAMPLER_SPOT_LIGHTING_MAP",t[t.SAMPLER_DIFFUSEMAP=6]="SAMPLER_DIFFUSEMAP",t[t.COUNT=7]="COUNT"}(kp||(kp={}));var Vp,jp=kp.SAMPLER_SHADOWMAP,Wp=kp.COUNT-jp;!function(t){t[t.UBO_LOCAL=0]="UBO_LOCAL",t[t.UBO_FORWARD_LIGHTS=1]="UBO_FORWARD_LIGHTS",t[t.UBO_SKINNING_ANIMATION=2]="UBO_SKINNING_ANIMATION",t[t.UBO_SKINNING_TEXTURE=3]="UBO_SKINNING_TEXTURE",t[t.UBO_MORPH=4]="UBO_MORPH",t[t.UBO_UI_LOCAL=5]="UBO_UI_LOCAL",t[t.SAMPLER_JOINTS=6]="SAMPLER_JOINTS",t[t.SAMPLER_MORPH_POSITION=7]="SAMPLER_MORPH_POSITION",t[t.SAMPLER_MORPH_NORMAL=8]="SAMPLER_MORPH_NORMAL",t[t.SAMPLER_MORPH_TANGENT=9]="SAMPLER_MORPH_TANGENT",t[t.SAMPLER_LIGHTMAP=10]="SAMPLER_LIGHTMAP",t[t.SAMPLER_SPRITE=11]="SAMPLER_SPRITE",t[t.SAMPLER_REFLECTION=12]="SAMPLER_REFLECTION",t[t.STORAGE_REFLECTION=13]="STORAGE_REFLECTION",t[t.COUNT=14]="COUNT"}(Vp||(Vp={}));var Xp,qp=Vp.SAMPLER_JOINTS,Yp=Vp.COUNT-qp;!function(t){t[t.GLOBAL=0]="GLOBAL",t[t.MATERIAL=1]="MATERIAL",t[t.LOCAL=2]="LOCAL"}(Xp||(Xp={}));var Kp=new ya;Kp.bufferOffsets=[0,jp+qp,jp],Kp.samplerOffsets=[-jp,Wp+Yp,Wp-qp],Kp.flexibleSet=1;var Qp=function(){};Qp.SIZE=4*(Qp.COUNT=4+(Qp.SCREEN_SIZE_OFFSET=4+(Qp.NATIVE_SIZE_OFFSET=4+(Qp.TIME_OFFSET=0)))),Qp.NAME="CCGlobal",Qp.BINDING=kp.UBO_GLOBAL,Qp.DESCRIPTOR=new Qa(Qp.BINDING,Jr.UNIFORM_BUFFER,1,kr.ALL),Qp.LAYOUT=new Da(Xp.GLOBAL,Qp.BINDING,Qp.NAME,[new Ra("cc_time",Ar.FLOAT4,1),new Ra("cc_screenSize",Ar.FLOAT4,1),new Ra("cc_nativeSize",Ar.FLOAT4,1)],1),Gp.layouts[Qp.NAME]=Qp.LAYOUT,Gp.bindings[Qp.BINDING]=Qp.DESCRIPTOR;var Zp=function(){};Zp.SIZE=4*(Zp.COUNT=4+(Zp.VIEW_PORT_OFFSET=4+(Zp.NEAR_FAR_OFFSET=4+(Zp.GLOBAL_FOG_ADD_OFFSET=4+(Zp.GLOBAL_FOG_BASE_OFFSET=4+(Zp.GLOBAL_FOG_COLOR_OFFSET=4+(Zp.AMBIENT_GROUND_OFFSET=4+(Zp.AMBIENT_SKY_OFFSET=4+(Zp.MAIN_LIT_COLOR_OFFSET=4+(Zp.MAIN_LIT_DIR_OFFSET=4+(Zp.EXPOSURE_OFFSET=4+(Zp.SCREEN_SCALE_OFFSET=4+(Zp.CAMERA_POS_OFFSET=16+(Zp.MAT_VIEW_PROJ_INV_OFFSET=16+(Zp.MAT_VIEW_PROJ_OFFSET=16+(Zp.MAT_PROJ_INV_OFFSET=16+(Zp.MAT_PROJ_OFFSET=16+(Zp.MAT_VIEW_INV_OFFSET=16+(Zp.MAT_VIEW_OFFSET=0))))))))))))))))))),Zp.NAME="CCCamera",Zp.BINDING=kp.UBO_CAMERA,Zp.DESCRIPTOR=new Qa(Zp.BINDING,Jr.UNIFORM_BUFFER,1,kr.ALL),Zp.LAYOUT=new Da(Xp.GLOBAL,Zp.BINDING,Zp.NAME,[new Ra("cc_matView",Ar.MAT4,1),new Ra("cc_matViewInv",Ar.MAT4,1),new Ra("cc_matProj",Ar.MAT4,1),new Ra("cc_matProjInv",Ar.MAT4,1),new Ra("cc_matViewProj",Ar.MAT4,1),new Ra("cc_matViewProjInv",Ar.MAT4,1),new Ra("cc_cameraPos",Ar.FLOAT4,1),new Ra("cc_screenScale",Ar.FLOAT4,1),new Ra("cc_exposure",Ar.FLOAT4,1),new Ra("cc_mainLitDir",Ar.FLOAT4,1),new Ra("cc_mainLitColor",Ar.FLOAT4,1),new Ra("cc_ambientSky",Ar.FLOAT4,1),new Ra("cc_ambientGround",Ar.FLOAT4,1),new Ra("cc_fogColor",Ar.FLOAT4,1),new Ra("cc_fogBase",Ar.FLOAT4,1),new Ra("cc_fogAdd",Ar.FLOAT4,1),new Ra("cc_nearFar",Ar.FLOAT4,1),new Ra("cc_viewPort",Ar.FLOAT4,1)],1),Gp.layouts[Zp.NAME]=Zp.LAYOUT,Gp.bindings[Zp.BINDING]=Zp.DESCRIPTOR;var Jp=function(){};Jp.SIZE=4*(Jp.COUNT=4+(Jp.PLANAR_NORMAL_DISTANCE_INFO_OFFSET=4+(Jp.SHADOW_COLOR_OFFSET=4+(Jp.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET=4+(Jp.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET=4+(Jp.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET=4+(Jp.SHADOW_PROJ_INFO_OFFSET=4+(Jp.SHADOW_PROJ_DEPTH_INFO_OFFSET=4+(Jp.SHADOW_INV_PROJ_DEPTH_INFO_OFFSET=16+(Jp.MAT_LIGHT_VIEW_PROJ_OFFSET=16+(Jp.MAT_LIGHT_VIEW_OFFSET=16+(Jp.MAT_LIGHT_PLANE_PROJ_OFFSET=0)))))))))))),Jp.NAME="CCShadow",Jp.BINDING=kp.UBO_SHADOW,Jp.DESCRIPTOR=new Qa(Jp.BINDING,Jr.UNIFORM_BUFFER,1,kr.ALL),Jp.LAYOUT=new Da(Xp.GLOBAL,Jp.BINDING,Jp.NAME,[new Ra("cc_matLightPlaneProj",Ar.MAT4,1),new Ra("cc_matLightView",Ar.MAT4,1),new Ra("cc_matLightViewProj",Ar.MAT4,1),new Ra("cc_shadowInvProjDepthInfo",Ar.FLOAT4,1),new Ra("cc_shadowProjDepthInfo",Ar.FLOAT4,1),new Ra("cc_shadowProjInfo",Ar.FLOAT4,1),new Ra("cc_shadowNFLSInfo",Ar.FLOAT4,1),new Ra("cc_shadowWHPBInfo",Ar.FLOAT4,1),new Ra("cc_shadowLPNNInfo",Ar.FLOAT4,1),new Ra("cc_shadowColor",Ar.FLOAT4,1),new Ra("cc_planarNDInfo",Ar.FLOAT4,1)],1),Gp.layouts[Jp.NAME]=Jp.LAYOUT,Gp.bindings[Jp.BINDING]=Jp.DESCRIPTOR;var $p=kp.SAMPLER_SHADOWMAP,td=new Qa($p,Jr.SAMPLER_TEXTURE,1,kr.FRAGMENT),ed=new Oa(Xp.GLOBAL,$p,"cc_shadowMap",Ar.SAMPLER2D,1);Gp.layouts.cc_shadowMap=ed,Gp.bindings[$p]=td;var nd=kp.SAMPLER_ENVIRONMENT,id=new Qa(nd,Jr.SAMPLER_TEXTURE,1,kr.FRAGMENT),rd=new Oa(Xp.GLOBAL,nd,"cc_environment",Ar.SAMPLER_CUBE,1);Gp.layouts.cc_environment=rd,Gp.bindings[nd]=id;var ad=kp.SAMPLER_DIFFUSEMAP,od=new Qa(ad,Jr.SAMPLER_TEXTURE,1,kr.FRAGMENT),sd=new Oa(Xp.GLOBAL,ad,"cc_diffuseMap",Ar.SAMPLER_CUBE,1);Gp.layouts.cc_diffuseMap=sd,Gp.bindings[ad]=od;var cd=kp.SAMPLER_SPOT_LIGHTING_MAP,ld=new Qa(cd,Jr.SAMPLER_TEXTURE,1,kr.FRAGMENT),ud=new Oa(Xp.GLOBAL,cd,"cc_spotLightingMap",Ar.SAMPLER2D,1);Gp.layouts.cc_spotLightingMap=ud,Gp.bindings[cd]=ld;var hd=function(){};hd.SIZE=4*(hd.COUNT=4+(hd.LIGHTINGMAP_UVPARAM=16+(hd.MAT_WORLD_IT_OFFSET=16+(hd.MAT_WORLD_OFFSET=0)))),hd.NAME="CCLocal",hd.BINDING=Vp.UBO_LOCAL,hd.DESCRIPTOR=new Qa(hd.BINDING,Jr.UNIFORM_BUFFER,1,kr.VERTEX|kr.COMPUTE),hd.LAYOUT=new Da(Xp.LOCAL,hd.BINDING,hd.NAME,[new Ra("cc_matWorld",Ar.MAT4,1),new Ra("cc_matWorldIT",Ar.MAT4,1),new Ra("cc_lightingMapUVParam",Ar.FLOAT4,1)],1),Hp.layouts[hd.NAME]=hd.LAYOUT,Hp.bindings[hd.BINDING]=hd.DESCRIPTOR;var fd=function(){};fd.SIZE=4*(fd.COUNT=4+(fd.WORLD_BOUND_HALF_EXTENTS=4+(fd.WORLD_BOUND_CENTER=0))),fd.NAME="CCWorldBound",fd.BINDING=Vp.UBO_LOCAL,fd.DESCRIPTOR=new Qa(fd.BINDING,Jr.UNIFORM_BUFFER,1,kr.VERTEX|kr.COMPUTE),fd.LAYOUT=new Da(Xp.LOCAL,fd.BINDING,fd.NAME,[new Ra("cc_worldBoundCenter",Ar.FLOAT4,1),new Ra("cc_worldBoundHalfExtents",Ar.FLOAT4,1)],1),Hp.layouts[fd.NAME]=fd.LAYOUT,Hp.bindings[fd.BINDING]=fd.DESCRIPTOR;var _d="a_matWorld0",pd=function(){};pd.BATCHING_COUNT=10,pd.MAT_WORLDS_OFFSET=0,pd.SIZE=4*(pd.COUNT=16*pd.BATCHING_COUNT),pd.NAME="CCLocalBatched",pd.BINDING=Vp.UBO_LOCAL,pd.DESCRIPTOR=new Qa(pd.BINDING,Jr.UNIFORM_BUFFER,1,kr.VERTEX|kr.COMPUTE),pd.LAYOUT=new Da(Xp.LOCAL,pd.BINDING,pd.NAME,[new Ra("cc_matWorlds",Ar.MAT4,pd.BATCHING_COUNT)],1),Hp.layouts[pd.NAME]=pd.LAYOUT,Hp.bindings[pd.BINDING]=pd.DESCRIPTOR;var dd=function(){};dd.LIGHTS_PER_PASS=1,dd.SIZE=4*(dd.COUNT=(dd.LIGHT_DIR_OFFSET=(dd.LIGHT_SIZE_RANGE_ANGLE_OFFSET=(dd.LIGHT_COLOR_OFFSET=(dd.LIGHT_POS_OFFSET=0)+4*dd.LIGHTS_PER_PASS)+4*dd.LIGHTS_PER_PASS)+4*dd.LIGHTS_PER_PASS)+4*dd.LIGHTS_PER_PASS),dd.NAME="CCForwardLight",dd.BINDING=Vp.UBO_FORWARD_LIGHTS,dd.DESCRIPTOR=new Qa(dd.BINDING,Jr.DYNAMIC_UNIFORM_BUFFER,1,kr.FRAGMENT),dd.LAYOUT=new Da(Xp.LOCAL,dd.BINDING,dd.NAME,[new Ra("cc_lightPos",Ar.FLOAT4,dd.LIGHTS_PER_PASS),new Ra("cc_lightColor",Ar.FLOAT4,dd.LIGHTS_PER_PASS),new Ra("cc_lightSizeRangeAngle",Ar.FLOAT4,dd.LIGHTS_PER_PASS),new Ra("cc_lightDir",Ar.FLOAT4,dd.LIGHTS_PER_PASS)],1),Hp.layouts[dd.NAME]=dd.LAYOUT,Hp.bindings[dd.BINDING]=dd.DESCRIPTOR;var md=function(){};md.LIGHTS_PER_PASS=10;var gd=function(){};gd.SIZE=4*(gd.COUNT=4+(gd.JOINTS_TEXTURE_INFO_OFFSET=0)),gd.NAME="CCSkinningTexture",gd.BINDING=Vp.UBO_SKINNING_TEXTURE,gd.DESCRIPTOR=new Qa(gd.BINDING,Jr.UNIFORM_BUFFER,1,kr.VERTEX),gd.LAYOUT=new Da(Xp.LOCAL,gd.BINDING,gd.NAME,[new Ra("cc_jointTextureInfo",Ar.FLOAT4,1)],1),Hp.layouts[gd.NAME]=gd.LAYOUT,Hp.bindings[gd.BINDING]=gd.DESCRIPTOR;var vd=function(){};vd.SIZE=4*(vd.COUNT=4+(vd.JOINTS_ANIM_INFO_OFFSET=0)),vd.NAME="CCSkinningAnimation",vd.BINDING=Vp.UBO_SKINNING_ANIMATION,vd.DESCRIPTOR=new Qa(vd.BINDING,Jr.UNIFORM_BUFFER,1,kr.VERTEX),vd.LAYOUT=new Da(Xp.LOCAL,vd.BINDING,vd.NAME,[new Ra("cc_jointAnimInfo",Ar.FLOAT4,1)],1),Hp.layouts[vd.NAME]=vd.LAYOUT,Hp.bindings[vd.BINDING]=vd.DESCRIPTOR;var yd=function(){};yd.SIZE=4*(yd.COUNT=360+(yd.JOINTS_OFFSET=0)),yd.NAME="CCSkinning",yd.BINDING=Vp.UBO_SKINNING_TEXTURE,yd.DESCRIPTOR=new Qa(yd.BINDING,Jr.UNIFORM_BUFFER,1,kr.VERTEX),yd.LAYOUT=new Da(Xp.LOCAL,yd.BINDING,yd.NAME,[new Ra("cc_joints",Ar.FLOAT4,90)],1),Hp.layouts[yd.NAME]=yd.LAYOUT,Hp.bindings[yd.BINDING]=yd.DESCRIPTOR;var xd=function(){};xd.MAX_MORPH_TARGET_COUNT=60,xd.OFFSET_OF_WEIGHTS=0,xd.OFFSET_OF_VERTICES_COUNT=4+(xd.OFFSET_OF_DISPLACEMENT_TEXTURE_HEIGHT=4+(xd.OFFSET_OF_DISPLACEMENT_TEXTURE_WIDTH=4*xd.MAX_MORPH_TARGET_COUNT)),xd.COUNT_BASE_4_BYTES=4*Math.ceil(xd.MAX_MORPH_TARGET_COUNT/4)+4,xd.SIZE=4*xd.COUNT_BASE_4_BYTES,xd.NAME="CCMorph",xd.BINDING=Vp.UBO_MORPH,xd.DESCRIPTOR=new Qa(xd.BINDING,Jr.UNIFORM_BUFFER,1,kr.VERTEX),xd.LAYOUT=new Da(Xp.LOCAL,xd.BINDING,xd.NAME,[new Ra("cc_displacementWeights",Ar.FLOAT4,xd.MAX_MORPH_TARGET_COUNT/4),new Ra("cc_displacementTextureInfo",Ar.FLOAT4,1)],1),Hp.layouts[xd.NAME]=xd.LAYOUT,Hp.bindings[xd.BINDING]=xd.DESCRIPTOR;var Sd=function(){};Sd.NAME="CCUILocal",Sd.BINDING=Vp.UBO_UI_LOCAL,Sd.DESCRIPTOR=new Qa(Sd.BINDING,Jr.DYNAMIC_UNIFORM_BUFFER,1,kr.VERTEX),Sd.LAYOUT=new Da(Xp.LOCAL,Sd.BINDING,Sd.NAME,[new Ra("cc_local_data",Ar.FLOAT4,1)],1),Hp.layouts[Sd.NAME]=Sd.LAYOUT,Hp.bindings[Sd.BINDING]=Sd.DESCRIPTOR;var Td=Vp.SAMPLER_JOINTS,Ad=new Qa(Td,Jr.SAMPLER_TEXTURE,1,kr.VERTEX),Ed=new Oa(Xp.LOCAL,Td,"cc_jointTexture",Ar.SAMPLER2D,1);Hp.layouts.cc_jointTexture=Ed,Hp.bindings[Td]=Ad;var Cd=Vp.SAMPLER_MORPH_POSITION,bd=new Qa(Cd,Jr.SAMPLER_TEXTURE,1,kr.VERTEX),wd=new Oa(Xp.LOCAL,Cd,"cc_PositionDisplacements",Ar.SAMPLER2D,1);Hp.layouts.cc_PositionDisplacements=wd,Hp.bindings[Cd]=bd;var Pd=Vp.SAMPLER_MORPH_NORMAL,Id=new Qa(Pd,Jr.SAMPLER_TEXTURE,1,kr.VERTEX),Rd=new Oa(Xp.LOCAL,Pd,"cc_NormalDisplacements",Ar.SAMPLER2D,1);Hp.layouts.cc_NormalDisplacements=Rd,Hp.bindings[Pd]=Id;var Dd=Vp.SAMPLER_MORPH_TANGENT,Od=new Qa(Dd,Jr.SAMPLER_TEXTURE,1,kr.VERTEX),Md=new Oa(Xp.LOCAL,Dd,"cc_TangentDisplacements",Ar.SAMPLER2D,1);Hp.layouts.cc_TangentDisplacements=Md,Hp.bindings[Dd]=Od;var Nd=Vp.SAMPLER_LIGHTMAP,Ld=new Qa(Nd,Jr.SAMPLER_TEXTURE,1,kr.FRAGMENT),Bd=new Oa(Xp.LOCAL,Nd,"cc_lightingMap",Ar.SAMPLER2D,1);Hp.layouts.cc_lightingMap=Bd,Hp.bindings[Nd]=Ld;var Fd=Vp.SAMPLER_SPRITE,zd=new Qa(Fd,Jr.SAMPLER_TEXTURE,1,kr.FRAGMENT),Ud=new Oa(Xp.LOCAL,Fd,"cc_spriteTexture",Ar.SAMPLER2D,1);Hp.layouts.cc_spriteTexture=Ud,Hp.bindings[Fd]=zd;var kd=Vp.SAMPLER_REFLECTION,Gd=new Qa(kd,Jr.SAMPLER_TEXTURE,1,kr.FRAGMENT),Hd=new Oa(Xp.LOCAL,kd,"cc_reflectionTexture",Ar.SAMPLER2D,1);Hp.layouts.cc_reflectionTexture=Hd,Hp.bindings[kd]=Gd;var Vd=Vp.STORAGE_REFLECTION,jd=new Qa(Vd,Jr.STORAGE_IMAGE,1,kr.COMPUTE),Wd=new La(Xp.LOCAL,Vd,"cc_reflectionStorage",Ar.IMAGE2D,1);Hp.layouts.cc_reflectionStorage=Wd,Hp.bindings[Vd]=jd;var Xd,qd,Yd,Kd,Qd,Zd=Np.makeMaskExclude([Np.BitMask.UI_2D,Np.BitMask.GIZMOS,Np.BitMask.EDITOR,Np.BitMask.SCENE_GIZMO,Np.BitMask.PROFILER]),Jd=Np.makeMaskExclude([Np.BitMask.UI_2D,Np.BitMask.PROFILER]),$d=Np.Enum.ALL;function tm(t){return t.hasFeature(xr.COLOR_FLOAT)&&t.hasFeature(xr.TEXTURE_FLOAT)&&!(t.gfxAPI===vr.WEBGL)}t("pipeline",Object.freeze({__proto__:null,PIPELINE_FLOW_MAIN:Fp,PIPELINE_FLOW_FORWARD:zp,PIPELINE_FLOW_SHADOW:Up,PIPELINE_FLOW_SMAA:"SMAAFlow",PIPELINE_FLOW_TONEMAP:"ToneMapFlow",get RenderPassStage(){return Lp},get RenderPriority(){return Bp},globalDescriptorSetLayout:Gp,localDescriptorSetLayout:Hp,get PipelineGlobalBindings(){return kp},get ModelLocalBindings(){return Vp},get SetIndex(){return Xp},bindingMappingInfo:Kp,UBOGlobal:Qp,UBOCamera:Zp,UBOShadow:Jp,UNIFORM_SHADOWMAP_BINDING:$p,UNIFORM_ENVIRONMENT_BINDING:nd,UNIFORM_DIFFUSEMAP_BINDING:ad,UNIFORM_SPOT_LIGHTING_MAP_TEXTURE_BINDING:cd,UBOLocal:hd,UBOWorldBound:fd,INST_MAT_WORLD:_d,UBOLocalBatched:pd,UBOForwardLight:dd,UBODeferredLight:md,JOINT_UNIFORM_CAPACITY:30,UBOSkinningTexture:gd,UBOSkinningAnimation:vd,INST_JOINT_ANIM_INFO:"a_jointAnimInfo",UBOSkinning:yd,UBOMorph:xd,UBOUILocal:Sd,UNIFORM_JOINT_TEXTURE_BINDING:Td,UNIFORM_POSITION_MORPH_TEXTURE_BINDING:Cd,UNIFORM_NORMAL_MORPH_TEXTURE_BINDING:Pd,UNIFORM_TANGENT_MORPH_TEXTURE_BINDING:Dd,UNIFORM_LIGHTMAP_TEXTURE_BINDING:Nd,UNIFORM_SPRITE_TEXTURE_BINDING:Fd,UNIFORM_REFLECTION_TEXTURE_BINDING:kd,UNIFORM_REFLECTION_STORAGE_BINDING:Vd,CAMERA_DEFAULT_MASK:Zd,CAMERA_EDITOR_MASK:Jd,MODEL_ALWAYS_MASK:$d,supportsHalfFloatTexture:function(t){return t.hasFeature(xr.COLOR_HALF_FLOAT)&&t.hasFeature(xr.TEXTURE_HALF_FLOAT)&&!(t.gfxAPI===vr.WEBGL)},supportsFloatTexture:tm})),function(t){t[t.VERTICAL=0]="VERTICAL",t[t.HORIZONTAL=1]="HORIZONTAL"}(Xd||(Xd={})),function(t){t[t.ORTHO=0]="ORTHO",t[t.PERSPECTIVE=1]="PERSPECTIVE"}(qd||(qd={})),function(t){t[t.F1_8=0]="F1_8",t[t.F2_0=1]="F2_0",t[t.F2_2=2]="F2_2",t[t.F2_5=3]="F2_5",t[t.F2_8=4]="F2_8",t[t.F3_2=5]="F3_2",t[t.F3_5=6]="F3_5",t[t.F4_0=7]="F4_0",t[t.F4_5=8]="F4_5",t[t.F5_0=9]="F5_0",t[t.F5_6=10]="F5_6",t[t.F6_3=11]="F6_3",t[t.F7_1=12]="F7_1",t[t.F8_0=13]="F8_0",t[t.F9_0=14]="F9_0",t[t.F10_0=15]="F10_0",t[t.F11_0=16]="F11_0",t[t.F13_0=17]="F13_0",t[t.F14_0=18]="F14_0",t[t.F16_0=19]="F16_0",t[t.F18_0=20]="F18_0",t[t.F20_0=21]="F20_0",t[t.F22_0=22]="F22_0"}(Yd||(Yd={})),function(t){t[t.ISO100=0]="ISO100",t[t.ISO200=1]="ISO200",t[t.ISO400=2]="ISO400",t[t.ISO800=3]="ISO800"}(Kd||(Kd={})),function(t){t[t.D1=0]="D1",t[t.D2=1]="D2",t[t.D4=2]="D4",t[t.D8=3]="D8",t[t.D15=4]="D15",t[t.D30=5]="D30",t[t.D60=6]="D60",t[t.D125=7]="D125",t[t.D250=8]="D250",t[t.D500=9]="D500",t[t.D1000=10]="D1000",t[t.D2000=11]="D2000",t[t.D4000=12]="D4000"}(Qd||(Qd={}));var em,nm,im,rm,am,om,sm,cm=[1.8,2,2.2,2.5,2.8,3.2,3.5,4,4.5,5,5.6,6.3,7.1,8,9,10,11,13,14,16,18,20,22],lm=[1,.5,1/4,1/8,1/15,1/30,1/60,.008,.004,.002,.001,5e-4,1/4e3],um=[100,200,400,800],hm=new di,fm=new di,_m=new Ri,pm=na.STENCIL<<1,dm=[],mm=function(){function t(t){if(this.isWindowSize=!0,this.screenScale=void 0,this._device=void 0,this._scene=null,this._node=null,this._name=null,this._enabled=!1,this._proj=-1,this._aspect=void 0,this._orthoHeight=10,this._fovAxis=Xd.VERTICAL,this._fov=Zn(45),this._nearClip=1,this._farClip=1e3,this._clearColor=new va(.2,.2,.2,1),this._viewport=new Vi(0,0,1,1),this._orientedViewport=new Vi(0,0,1,1),this._curTransform=yr.IDENTITY,this._isProjDirty=!0,this._matView=new Ri,this._matProj=new Ri,this._matProjInv=new Ri,this._matViewProj=new Ri,this._matViewProjInv=new Ri,this._frustum=new Wc,this._forward=new di,this._position=new di,this._priority=0,this._aperture=Yd.F16_0,this._apertureValue=void 0,this._shutter=Qd.D125,this._shutterValue=0,this._iso=Kd.ISO100,this._isoValue=0,this._ec=0,this._window=null,this._width=1,this._height=1,this._clearFlag=na.NONE,this._clearDepth=1,this._visibility=Zd,this._exposure=0,this._clearStencil=0,this._device=t,this._apertureValue=cm[this._aperture],this._shutterValue=lm[this._shutter],this._isoValue=um[this._iso],this._aspect=this.screenScale=1,this._frustum.accurate=!0,!dm.length){var e=t.capabilities.clipSpaceSignY;dm[yr.IDENTITY]=new Ri(1,0,0,0,0,e),dm[yr.ROTATE_90]=new Ri(0,1,0,0,-e,0),dm[yr.ROTATE_180]=new Ri(-1,0,0,0,0,-e),dm[yr.ROTATE_270]=new Ri(0,-1,0,0,e,0)}}var e=t.prototype;return e._setWidth=function(t){this._width=t},e._setHeight=function(t){this._height=t},e._setScene=function(t){this._scene=t},e._updateAspect=function(t){if(void 0===t&&(t=!0),this._aspect=this.window.width*this._viewport.width/(this.window.height*this._viewport.height),t){var e=this.window.swapchain;(e&&e.surfaceTransform||yr.IDENTITY)%2&&(this._aspect=1/this._aspect)}this._isProjDirty=!0},e._init=function(){},e.initialize=function(t){this._init(t),this.node=t.node,this._setWidth(1),this._setHeight(1),this.clearFlag=na.NONE,this.clearDepth=1,this.visibility=Zd,this._name=t.name,this._proj=t.projection,this._priority=t.priority||0,this._aspect=this.screenScale=1,this.updateExposure(),this.changeTargetWindow(t.window)},e._destroy=function(){},e.destroy=function(){this._window&&(this._window.detachCamera(this),this.window=null),this._name=null,this._destroy()},e.attachToScene=function(t){this._enabled=!0,this._setScene(t)},e.detachFromScene=function(){this._enabled=!1,this._setScene(null)},e.resize=function(t,e){this._window&&(this._setWidth(t),this._setHeight(e),this._updateAspect())},e.setFixedSize=function(t,e){this._setWidth(t),this._setHeight(e),this._updateAspect(!1),this.isWindowSize=!1},e.syncCameraEditor=function(){},e.update=function(t){var e;if(void 0===t&&(t=!1),this._node){var n=!1;(this._node.hasChangedFlags||t)&&(Ri.invert(this._matView,this._node.worldMatrix),this._forward.x=-this._matView.m02,this._forward.y=-this._matView.m06,this._forward.z=-this._matView.m10,this._node.getWorldPosition(this._position),n=!0);var i=null===(e=this.window)||void 0===e?void 0:e.swapchain,r=i&&i.surfaceTransform||yr.IDENTITY;if(this._isProjDirty||this._curTransform!==r){this._curTransform=r;var a=this._device.capabilities.clipSpaceSignY;if(this._proj===qd.PERSPECTIVE)Ri.perspective(this._matProj,this._fov,this._aspect,this._nearClip,this._farClip,this._fovAxis===Xd.VERTICAL,this._device.capabilities.clipSpaceMinZ,a,r);else{var o=this._orthoHeight*this._aspect,s=this._orthoHeight;Ri.ortho(this._matProj,-o,o,-s,s,this._nearClip,this._farClip,this._device.capabilities.clipSpaceMinZ,a,r)}Ri.invert(this._matProjInv,this._matProj),n=!0,this._isProjDirty=!1}n&&(Ri.multiply(this._matViewProj,this._matProj,this._matView),Ri.invert(this._matViewProjInv,this._matViewProj),this._frustum.update(this._matViewProj,this._matViewProjInv))}},e.setViewportInOrientedSpace=function(t){var e,n=t.x,i=t.width,r=t.height,a=this._device.capabilities.screenSpaceSignY<0?1-t.y-r:t.y,o=null===(e=this.window)||void 0===e?void 0:e.swapchain;switch(o&&o.surfaceTransform||yr.IDENTITY){case yr.ROTATE_90:this._viewport.x=1-a-r,this._viewport.y=n,this._viewport.width=r,this._viewport.height=i;break;case yr.ROTATE_180:this._viewport.x=1-n-i,this._viewport.y=1-a-r,this._viewport.width=i,this._viewport.height=r;break;case yr.ROTATE_270:this._viewport.x=a,this._viewport.y=1-n-i,this._viewport.width=r,this._viewport.height=i;break;case yr.IDENTITY:this._viewport.x=n,this._viewport.y=a,this._viewport.width=i,this._viewport.height=r}this._orientedViewport.x=n,this._orientedViewport.y=a,this._orientedViewport.width=i,this._orientedViewport.height=r,this.resize(this.width,this.height)},e.changeTargetWindow=function(t){void 0===t&&(t=null),this._window&&this._window.detachCamera(this);var e=t||i.director.root.mainWindow;if(e){e.attachCamera(this),this.window=e;var n=e.swapchain;(n&&n.surfaceTransform||yr.IDENTITY)%2?this.resize(e.height,e.width):this.resize(e.width,e.height)}},e.detachCamera=function(){this._window&&this._window.detachCamera(this)},e.screenPointToRay=function(t,e,n){if(!this._node)return null;var i=this.width,r=this.height,a=this._orientedViewport.x*i,o=this._orientedViewport.y*r,s=this._orientedViewport.width*i,c=this._orientedViewport.height*r,l=this._proj===qd.PERSPECTIVE,u=this._device.capabilities.clipSpaceSignY,h=Ii[this._curTransform];di.set(hm,(e-a)/s*2-1,(n-o)/c*2-1,l?1:-1);var f=hm.x,_=hm.y;return hm.x=f*h[0]+_*h[2]*u,hm.y=f*h[1]+_*h[3]*u,di.transformMat4(l?hm:t.o,hm,this._matViewProjInv),l?(this._node.getWorldPosition(fm),ur.fromPoints(t,fm,hm)):di.transformQuat(t.d,di.FORWARD,this._node.worldRotation),t},e.screenToWorld=function(t,e){var n=this.width,i=this.height,r=this._orientedViewport.x*n,a=this._orientedViewport.y*i,o=this._orientedViewport.width*n,s=this._orientedViewport.height*i,c=this._device.capabilities.clipSpaceSignY,l=Ii[this._curTransform];if(this._proj===qd.PERSPECTIVE){di.set(t,(e.x-r)/o*2-1,(e.y-a)/s*2-1,1);var u=t.x,h=t.y;t.x=u*l[0]+h*l[2]*c,t.y=u*l[1]+h*l[3]*c,di.transformMat4(t,t,this._matViewProjInv),this._node&&this._node.getWorldPosition(hm),di.lerp(t,hm,t,Qn(this._nearClip/this._farClip,1,e.z))}else{di.set(t,(e.x-r)/o*2-1,(e.y-a)/s*2-1,2*e.z-1);var f=t.x,_=t.y;t.x=f*l[0]+_*l[2]*c,t.y=f*l[1]+_*l[3]*c,di.transformMat4(t,t,this._matViewProjInv)}return t},e.worldToScreen=function(t,e){var n=this._device.capabilities.clipSpaceSignY,i=Ii[this._curTransform];di.transformMat4(t,e,this._matViewProj);var r=t.x,a=t.y;t.x=r*i[0]+a*i[2]*n,t.y=r*i[1]+a*i[3]*n;var o=this.width,s=this.height,c=this._orientedViewport.x*o,l=this._orientedViewport.y*s,u=this._orientedViewport.width*o,h=this._orientedViewport.height*s;return t.x=c+.5*(t.x+1)*u,t.y=l+.5*(t.y+1)*h,t.z=.5*t.z+.5,t},e.worldMatrixToScreen=function(t,e,n,i){Ri.multiply(t,this._matViewProj,e),Ri.multiply(t,dm[this._curTransform],t);var r=n/2,a=i/2;return Ri.identity(_m),Ri.transform(_m,_m,di.set(hm,r,a,0)),Ri.scale(_m,_m,di.set(hm,r,a,1)),Ri.multiply(t,_m,t),t},e.setExposure=function(t){this._exposure=.833333/Math.pow(2,t)},e.updateExposure=function(){var t=Math.log2(this._apertureValue*this._apertureValue/this._shutterValue*100/this._isoValue);this.setExposure(t)},L(t,[{key:"node",get:function(){return this._node},set:function(t){this._node=t}},{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled=t}},{key:"orthoHeight",get:function(){return this._orthoHeight},set:function(t){this._orthoHeight=t,this._isProjDirty=!0}},{key:"projectionType",get:function(){return this._proj},set:function(t){this._proj=t,this._isProjDirty=!0}},{key:"fovAxis",get:function(){return this._fovAxis},set:function(t){this._fovAxis=t,this._isProjDirty=!0}},{key:"fov",get:function(){return this._fov},set:function(t){this._fov=t,this._isProjDirty=!0}},{key:"nearClip",get:function(){return this._nearClip},set:function(t){this._nearClip=t,this._isProjDirty=!0}},{key:"farClip",get:function(){return this._farClip},set:function(t){this._farClip=t,this._isProjDirty=!0}},{key:"clearColor",get:function(){return this._clearColor},set:function(t){this._clearColor.x=t.x,this._clearColor.y=t.y,this._clearColor.z=t.z,this._clearColor.w=t.w}},{key:"viewport",get:function(){return this._viewport},set:function(t){E(8302),this.setViewportInOrientedSpace(t)}},{key:"scene",get:function(){return this._scene}},{key:"name",get:function(){return this._name}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"aspect",get:function(){return this._aspect}},{key:"matView",get:function(){return this._matView}},{key:"matProj",get:function(){return this._matProj}},{key:"matProjInv",get:function(){return this._matProjInv}},{key:"matViewProj",get:function(){return this._matViewProj}},{key:"matViewProjInv",get:function(){return this._matViewProjInv}},{key:"frustum",get:function(){return this._frustum},set:function(t){this._frustum=t}},{key:"window",get:function(){return this._window},set:function(t){this._window=t}},{key:"forward",get:function(){return this._forward},set:function(t){this._forward=t}},{key:"position",get:function(){return this._position},set:function(t){this._position=t}},{key:"visibility",get:function(){return this._visibility},set:function(t){this._visibility=t}},{key:"priority",get:function(){return this._priority},set:function(t){this._priority=t}},{key:"aperture",get:function(){return this._aperture},set:function(t){this._aperture=t,this._apertureValue=cm[this._aperture],this.updateExposure()}},{key:"apertureValue",get:function(){return this._apertureValue}},{key:"shutter",get:function(){return this._shutter},set:function(t){this._shutter=t,this._shutterValue=lm[this._shutter],this.updateExposure()}},{key:"shutterValue",get:function(){return this._shutterValue}},{key:"iso",get:function(){return this._iso},set:function(t){this._iso=t,this._isoValue=um[this._iso],this.updateExposure()}},{key:"isoValue",get:function(){return this._isoValue}},{key:"ec",get:function(){return this._ec},set:function(t){this._ec=t}},{key:"exposure",get:function(){return this._exposure}},{key:"clearFlag",get:function(){return this._clearFlag},set:function(t){this._clearFlag=t}},{key:"clearDepth",get:function(){return this._clearDepth},set:function(t){this._clearDepth=t}},{key:"clearStencil",get:function(){return this._clearStencil},set:function(t){this._clearStencil=t}},{key:"native",get:function(){return this._nativeObj}}],[{key:"standardExposureValue",get:function(){return 1/38400}},{key:"standardLightMeterScale",get:function(){return 1e4}}]),t}(),gm=1024;function vm(t){return!!(i.sys.hasFeature(i.sys.Feature.IMAGE_BITMAP)&&t instanceof ImageBitmap)}!function(t){t[t.RGB565=Sr.R5G6B5]="RGB565",t[t.RGB5A1=Sr.RGB5A1]="RGB5A1",t[t.RGBA4444=Sr.RGBA4]="RGBA4444",t[t.RGB888=Sr.RGB8]="RGB888",t[t.RGB32F=Sr.RGB32F]="RGB32F",t[t.RGBA8888=Sr.RGBA8]="RGBA8888",t[t.RGBA32F=Sr.RGBA32F]="RGBA32F",t[t.A8=Sr.A8]="A8",t[t.I8=Sr.L8]="I8",t[t.AI8=Sr.LA8]="AI8",t[t.RGB_PVRTC_2BPPV1=Sr.PVRTC_RGB2]="RGB_PVRTC_2BPPV1",t[t.RGBA_PVRTC_2BPPV1=Sr.PVRTC_RGBA2]="RGBA_PVRTC_2BPPV1",t[t.RGB_A_PVRTC_2BPPV1=gm++]="RGB_A_PVRTC_2BPPV1",t[t.RGB_PVRTC_4BPPV1=Sr.PVRTC_RGB4]="RGB_PVRTC_4BPPV1",t[t.RGBA_PVRTC_4BPPV1=Sr.PVRTC_RGBA4]="RGBA_PVRTC_4BPPV1",t[t.RGB_A_PVRTC_4BPPV1=gm++]="RGB_A_PVRTC_4BPPV1",t[t.RGB_ETC1=Sr.ETC_RGB8]="RGB_ETC1",t[t.RGBA_ETC1=gm++]="RGBA_ETC1",t[t.RGB_ETC2=Sr.ETC2_RGB8]="RGB_ETC2",t[t.RGBA_ETC2=Sr.ETC2_RGBA8]="RGBA_ETC2",t[t.RGBA_ASTC_4x4=Sr.ASTC_RGBA_4X4]="RGBA_ASTC_4x4",t[t.RGBA_ASTC_5x4=Sr.ASTC_RGBA_5X4]="RGBA_ASTC_5x4",t[t.RGBA_ASTC_5x5=Sr.ASTC_RGBA_5X5]="RGBA_ASTC_5x5",t[t.RGBA_ASTC_6x5=Sr.ASTC_RGBA_6X5]="RGBA_ASTC_6x5",t[t.RGBA_ASTC_6x6=Sr.ASTC_RGBA_6X6]="RGBA_ASTC_6x6",t[t.RGBA_ASTC_8x5=Sr.ASTC_RGBA_8X5]="RGBA_ASTC_8x5",t[t.RGBA_ASTC_8x6=Sr.ASTC_RGBA_8X6]="RGBA_ASTC_8x6",t[t.RGBA_ASTC_8x8=Sr.ASTC_RGBA_8X8]="RGBA_ASTC_8x8",t[t.RGBA_ASTC_10x5=Sr.ASTC_RGBA_10X5]="RGBA_ASTC_10x5",t[t.RGBA_ASTC_10x6=Sr.ASTC_RGBA_10X6]="RGBA_ASTC_10x6",t[t.RGBA_ASTC_10x8=Sr.ASTC_RGBA_10X8]="RGBA_ASTC_10x8",t[t.RGBA_ASTC_10x10=Sr.ASTC_RGBA_10X10]="RGBA_ASTC_10x10",t[t.RGBA_ASTC_12x10=Sr.ASTC_RGBA_12X10]="RGBA_ASTC_12x10",t[t.RGBA_ASTC_12x12=Sr.ASTC_RGBA_12X12]="RGBA_ASTC_12x12"}(em||(em={})),function(t){t[t.REPEAT=Nr.WRAP]="REPEAT",t[t.CLAMP_TO_EDGE=Nr.CLAMP]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=Nr.MIRROR]="MIRRORED_REPEAT",t[t.CLAMP_TO_BORDER=Nr.BORDER]="CLAMP_TO_BORDER"}(nm||(nm={})),function(t){t[t.NONE=Mr.NONE]="NONE",t[t.LINEAR=Mr.LINEAR]="LINEAR",t[t.NEAREST=Mr.POINT]="NEAREST"}(im||(im={}));var ym,xm,Sm,Tm,Am,Em,Cm,bm,wm,Pm,Im,Rm,Dm=t("ImageAsset",nl("cc.ImageAsset")((sm=om=function(t){function e(e){var n;return(n=t.call(this)||this)._nativeData=void 0,n._exportedExts=void 0,n._format=em.RGBA8888,n._width=0,n._height=0,n._nativeData={_data:null,width:0,height:0,format:0,_compressed:!1},void 0!==e&&n.reset(e),n}F(e,t);var n=e.prototype;return n.reset=function(t){vm(t)||t instanceof HTMLElement?this._nativeData=t:(this._nativeData=t,this._format=t.format)},n.destroy=function(){return this.data&&this.data instanceof HTMLImageElement?(this.data.src="",this._setRawAsset("")):vm(this.data)&&this.data.close&&this.data.close(),t.prototype.destroy.call(this)},n._serialize=function(){},n._deserialize=function(t){var n="";"string"==typeof t?n=t:(this._width=t.w,this._height=t.h,n=t.fmt);for(var r,a=i.director.root?i.director.root.device:null,o=n.split("_"),s=Number.MAX_VALUE,c=this._format,l="",u=i.macro.SUPPORT_TEXTURE_FORMATS,h=W(o);!(r=h()).done;){var f=r.value.split("@"),_=parseInt(f[0],void 0),p=e.extnames[_]||f[0],d=u.indexOf(p);if(-1!==d&&d<s){var m=f[1]?parseInt(f[1]):this._format;if(!(".astc"!==p||a&&a.hasFeature(xr.FORMAT_ASTC)))continue;if(!(".pvr"!==p||a&&a.hasFeature(xr.FORMAT_PVRTC)))continue;if(!(m!==em.RGB_ETC1&&m!==em.RGBA_ETC1||a&&a.hasFeature(xr.FORMAT_ETC1)))continue;if(!(m!==em.RGB_ETC2&&m!==em.RGBA_ETC2||a&&a.hasFeature(xr.FORMAT_ETC2)))continue;if(".webp"===p&&!i.sys.hasFeature(i.sys.Feature.WEBP))continue;s=d,l=p,c=m}}l?(this._setRawAsset(l),this._format=c):E(3121)},n.initDefault=function(n){if(t.prototype.initDefault.call(this,n),e._sharedPlaceHolderCanvas)this.reset(e._sharedPlaceHolderCanvas);else{var i=document.createElement("canvas"),r=i.getContext("2d"),a=i.width=i.height=2;r.fillStyle="#ff00ff",r.fillRect(0,0,a,a),this.reset(i),e._sharedPlaceHolderCanvas=i}},n.validate=function(){return!!this.data},L(e,[{key:"_nativeAsset",get:function(){return this._nativeData},set:function(t){t instanceof HTMLElement||vm(t)||(t.format=t.format||this._format),this.reset(t)}},{key:"data",get:function(){return this._nativeData&&((t=this._nativeData)instanceof HTMLImageElement||t instanceof HTMLCanvasElement||vm(t))?this._nativeData:this._nativeData&&this._nativeData._data;var t}},{key:"width",get:function(){return this._nativeData.width||this._width}},{key:"height",get:function(){return this._nativeData.height||this._height}},{key:"format",get:function(){return this._format}},{key:"isCompressed",get:function(){return this._format>=em.RGB_ETC1&&this._format<=em.RGBA_ASTC_12x12||this._format>=em.RGB_A_PVRTC_2BPPV1&&this._format<=em.RGBA_ETC1}},{key:"url",get:function(){return this.nativeUrl}}]),e}(Ou),om.extnames=[".png",".jpg",".jpeg",".bmp",".webp",".pvr",".pkm",".astc"],om._sharedPlaceHolderCanvas=null,q((am=sm).prototype,"_nativeAsset",[Xl],Object.getOwnPropertyDescriptor(am.prototype,"_nativeAsset"),am.prototype),rm=am))||rm);i.ImageAsset=Dm,Zt(Sr);var Om=new tt("Tex"),Mm=nl("cc.TextureBase")((Rm=Im=function(t){function e(){var e;return X(e=t.call(this)||this,"_format",Sm,V(e)),X(e,"_minFilter",Tm,V(e)),X(e,"_magFilter",Am,V(e)),X(e,"_mipFilter",Em,V(e)),X(e,"_wrapS",Cm,V(e)),X(e,"_wrapT",bm,V(e)),X(e,"_wrapR",wm,V(e)),X(e,"_anisotropy",Pm,V(e)),e._width=1,e._height=1,e._id=void 0,e._samplerInfo=new Ia,e._gfxSampler=null,e._gfxDevice=null,e._textureHash=0,e._id=Om.getNewId(),e._gfxDevice=e._getGFXDevice(),e._textureHash=Po(e._id,666),e}F(e,t);var n=e.prototype;return n.getId=function(){return this._id},n.getPixelFormat=function(){return this._format},n.getAnisotropy=function(){return this._anisotropy},n.setWrapMode=function(t,e,n){void 0===n&&(n=t),this._wrapS=t,this._samplerInfo.addressU=t,this._wrapT=e,this._samplerInfo.addressV=e,this._wrapR=n,this._samplerInfo.addressW=n,this._gfxDevice&&(this._gfxSampler=this._gfxDevice.getSampler(this._samplerInfo))},n.setFilters=function(t,e){this._minFilter=t,this._samplerInfo.minFilter=t,this._magFilter=e,this._samplerInfo.magFilter=e,this._gfxDevice&&(this._gfxSampler=this._gfxDevice.getSampler(this._samplerInfo))},n.setMipFilter=function(t){this._mipFilter=t,this._samplerInfo.mipFilter=t,this._gfxDevice&&(this._gfxSampler=this._gfxDevice.getSampler(this._samplerInfo))},n.setAnisotropy=function(t){this._anisotropy=t,this._samplerInfo.maxAnisotropy=t,this._gfxDevice&&(this._gfxSampler=this._gfxDevice.getSampler(this._samplerInfo))},n.destroy=function(){var e,n=t.prototype.destroy.call(this);return n&&(null===(e=i.director.root)||void 0===e?void 0:e.batcher2D)&&i.director.root.batcher2D._releaseDescriptorSetCache(this._textureHash),n},n.getHash=function(){return this._textureHash},n.getGFXTexture=function(){return null},n.getSamplerInfo=function(){return this._samplerInfo},n.getGFXSampler=function(){return this._gfxSampler||(this._gfxDevice?this._gfxSampler=this._gfxDevice.getSampler(this._samplerInfo):b(9302)),this._gfxSampler},n._serialize=function(){return""},n._deserialize=function(t){var e=t.split(",");e.unshift(""),e.length>=5&&(this.setFilters(parseInt(e[1]),parseInt(e[2])),this.setWrapMode(parseInt(e[3]),parseInt(e[4]))),e.length>=7&&(this.setMipFilter(parseInt(e[5])),this.setAnisotropy(parseInt(e[6])))},n._getGFXDevice=function(){return i.director.root?i.director.root.device:null},n._getGFXFormat=function(){return this._getGFXPixelFormat(this._format)},n._setGFXFormat=function(t){this._format=void 0===t?em.RGBA8888:t},n._getGFXPixelFormat=function(t){return t===em.RGBA_ETC1?t=em.RGB_ETC1:t===em.RGB_A_PVRTC_4BPPV1?t=em.RGB_PVRTC_4BPPV1:t===em.RGB_A_PVRTC_2BPPV1&&(t=em.RGB_PVRTC_2BPPV1),t},L(e,[{key:"isCompressed",get:function(){return this._format>=em.RGB_ETC1&&this._format<=em.RGBA_ASTC_12x12||this._format>=em.RGB_A_PVRTC_2BPPV1&&this._format<=em.RGBA_ETC1}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}}]),e}(Ou),Im.PixelFormat=em,Im.WrapMode=nm,Im.Filter=im,Sm=q((xm=Rm).prototype,"_format",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return em.RGBA8888}}),Tm=q(xm.prototype,"_minFilter",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return im.LINEAR}}),Am=q(xm.prototype,"_magFilter",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return im.LINEAR}}),Em=q(xm.prototype,"_mipFilter",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return im.NONE}}),Cm=q(xm.prototype,"_wrapS",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return nm.REPEAT}}),bm=q(xm.prototype,"_wrapT",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return nm.REPEAT}}),wm=q(xm.prototype,"_wrapR",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return nm.REPEAT}}),Pm=q(xm.prototype,"_anisotropy",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ym=xm))||ym;i.TextureBase=Mm;var Nm=new WeakMap,Lm=new WeakSet,Bm=new WeakSet;function Fm(t,e){var n;n=nh.safeFindClass;var i,r=Eh.pool.get();try{i=Bh(t,r,{classFinder:n,customEnv:e})}catch(t){throw d(t),Eh.pool.put(r),t}i._uuid=e.__uuid__||"";for(var a=r.uuidList,o=r.uuidObjList,s=r.uuidPropList,c=r.uuidTypeList||[],l=[],u=0;u<a.length;u++){var h=a[u];l[u]={uuid:pu(h),owner:o[u],prop:s[u],type:Gt._getClassById(c[u])}}return Nm.set(i,l),i._native&&Lm.add(i),Eh.pool.put(r),i}var zm,Um=new(function(){function t(){this._depends=new Zl}var e=t.prototype;return e.init=function(){this._depends.clear()},e.getNativeDep=function(t){var e=this._depends.get(t);return e&&e.nativeDep?B({},e.nativeDep):null},e.getDeps=function(t){return this._depends.has(t)?this._depends.get(t).deps:[]},e.getDepsRecursively=function(t){var e=Object.create(null),n=[];return this._descend(t,e,n),n},e.remove=function(t){this._depends.remove(t)},e.parse=function(t,e){var n,i,r=null;if(Array.isArray(e)||e.__type__||e instanceof fh){if(this._depends.has(t))return this._depends.get(t);if(!Array.isArray(e)||"number"==typeof(i=(n=e[5])[n.length-1])&&i<0)try{var a=Fm(e,{__uuid__:t});(r=this._parseDepsFromAsset(a)).nativeDep&&(r.nativeDep.uuid=t),nu.add(t+"@import",a)}catch(e){eu.remove(t+"@import"),r={deps:[]}}else r={deps:this._parseDepsFromJson(e)}}else{if(this._depends.has(t)&&(r=this._depends.get(t)).parsedFromExistAsset)return r;r=this._parseDepsFromAsset(e)}return this._depends.add(t,r),r},e._parseDepsFromAsset=function(t){for(var e={deps:[],parsedFromExistAsset:!0},n=Nm.get(t),i=0,r=n.length;i<r;i++)e.deps.push(n[i].uuid);return Lm.has(t)&&(e.nativeDep=t._nativeDep),e},e._parseDepsFromJson=function(t){var e=function(t){return n=(e=t)[1],e[10].map((function(t){return n[t]}));var e,n}(t);return e.forEach((function(t,n){return e[n]=pu(t)})),e},e._descend=function(t,e,n){for(var i=this.getDeps(t),r=0;r<i.length;r++){var a=i[r];e[a]||(e[a]=!0,n.push(a),this._descend(a,e,n))}},t}()),km=[new ma];function Gm(t){return t&&0==(t&t-1)}var Hm,Vm,jm,Wm,Xm,qm,Ym=nl("cc.SimpleTexture")(zm=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._gfxTexture=null,e._mipmapLevel=1,e._textureWidth=0,e._textureHeight=0,e}F(e,t);var n=e.prototype;return n.getGFXTexture=function(){return this._gfxTexture},n.destroy=function(){return this._tryDestroyTexture(),t.prototype.destroy.call(this)},n.updateImage=function(){this.updateMipmaps(0)},n.updateMipmaps=function(){},n.uploadData=function(t,e,n){if(void 0===e&&(e=0),void 0===n&&(n=0),this._gfxTexture&&!(this._mipmapLevel<=e)){var i=this._getGFXDevice();if(i){var r=km[0];r.texExtent.width=this._textureWidth>>e,r.texExtent.height=this._textureHeight>>e,r.texSubres.mipLevel=e,r.texSubres.baseArrayLayer=n,ArrayBuffer.isView(t)?i.copyBuffersToTexture([t],this._gfxTexture,km):i.copyTexImagesToTexture([t],this._gfxTexture,km)}}},n._assignImage=function(t,e,n){var i=t.data;if(i&&(this.uploadData(i,e,n),this._checkTextureLoaded(),$t.CLEANUP_IMAGE_CACHE)){var r=Um.getDeps(this._uuid),a=r.indexOf(t._uuid);-1!==a&&(Q(r,a),t.decRef())}},n._checkTextureLoaded=function(){this._textureReady()},n._textureReady=function(){this.loaded=!0,this.emit("load")},n._setMipmapLevel=function(t){this._mipmapLevel=t<1?1:t},n._getGfxTextureCreateInfo=function(){return null},n._tryReset=function(){if(this._tryDestroyTexture(),0!==this._mipmapLevel){var t=this._getGFXDevice();t&&this._createTexture(t)}},n._createTexture=function(t){if(0!==this._width&&0!==this._height){var e=Rr.NONE;this._mipFilter!==im.NONE&&function(t,e,n){return!(t.gfxAPI===vr.WEBGL)||Gm(e)&&Gm(n)}(t,this._width,this._height)&&(this._mipmapLevel=function(t,e){for(var n=Math.max(t,e),i=0;n;)n>>=1,i++;return i}(this._width,this._height),e=Rr.GEN_MIPMAP);var n=this._getGfxTextureCreateInfo({usage:Ir.SAMPLED|Ir.TRANSFER_DST,format:this._getGFXFormat(),levelCount:this._mipmapLevel,flags:e});if(n){var i=t.createTexture(n);this._textureWidth=n.width,this._textureHeight=n.height,this._gfxTexture=i}}},n._tryDestroyTexture=function(){this._gfxTexture&&(this._gfxTexture.destroy(),this._gfxTexture=null)},L(e,[{key:"mipmapLevel",get:function(){return this._mipmapLevel}}]),e}(Mm))||zm;i.SimpleTexture=Ym;var Km,Qm,Zm,Jm,$m,tg,eg,ng=t("Texture2D",(Hm=nl("cc.Texture2D"),Vm=Bl([Dm]),Hm((qm=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return X(e=t.call.apply(t,[this].concat(i))||this,"_mipmaps",Xm,V(e)),e}F(e,t);var n=e.prototype;return n.initialize=function(){this.mipmaps=this._mipmaps},n.onLoaded=function(){this.initialize()},n.reset=function(t){this._width=t.width,this._height=t.height,this._setGFXFormat(t.format),this._setMipmapLevel(t.mipmapLevel||1),this._tryReset()},n.create=function(t,e,n,i){void 0===n&&(n=em.RGBA8888),void 0===i&&(i=1),this.reset({width:t,height:e,format:n,mipmapLevel:i})},n.toString=function(){return 0!==this._mipmaps.length?this._mipmaps[0].url:""},n.updateMipmaps=function(t,e){if(void 0===t&&(t=0),!(t>=this._mipmaps.length))for(var n=Math.min(void 0===e?this._mipmaps.length:e,this._mipmaps.length-t),i=0;i<n;++i){var r=t+i;this._assignImage(this._mipmaps[r],r)}},n.getHtmlElementObj=function(){return this._mipmaps[0]&&this._mipmaps[0].data instanceof HTMLElement?this._mipmaps[0].data:null},n.destroy=function(){return this._mipmaps=[],t.prototype.destroy.call(this)},n.description=function(){return"<cc.Texture2D | Name = "+(this._mipmaps[0]?this._mipmaps[0].url:"")+" | Dimension = "+this.width+" x "+this.height+">"},n.releaseTexture=function(){this.destroy()},n._serialize=function(){return null},n._deserialize=function(e,n){var i=e;t.prototype._deserialize.call(this,i.base,n),this._mipmaps=new Array(i.mipmaps.length);for(var r=0;r<i.mipmaps.length;++r)if(this._mipmaps[r]=new Dm,i.mipmaps[r]){var a=i.mipmaps[r];n.result.push(this._mipmaps,""+r,a,Gt._getClassId(Dm))}},n._getGfxTextureCreateInfo=function(t){var e=new wa(Pr.TEX2D);return e.width=this._width,e.height=this._height,Object.assign(e,t)},n.initDefault=function(e){t.prototype.initDefault.call(this,e);var n=new Dm;n.initDefault(),this.image=n},n.validate=function(){return this.mipmaps&&0!==this.mipmaps.length},L(e,[{key:"mipmaps",get:function(){return this._mipmaps},set:function(t){var e=this;if(this._mipmaps=t,this._setMipmapLevel(this._mipmaps.length),this._mipmaps.length>0){var n=this._mipmaps[0];this.reset({width:n.width,height:n.height,format:n.format,mipmapLevel:this._mipmaps.length}),this._mipmaps.forEach((function(t,n){e._assignImage(t,n)}))}else this.reset({width:0,height:0,mipmapLevel:this._mipmaps.length})}},{key:"image",get:function(){return 0===this._mipmaps.length?null:this._mipmaps[0]},set:function(t){this.mipmaps=t?[t]:[]}}]),e}(Ym),Xm=q((Wm=qm).prototype,"_mipmaps",[Vm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),jm=Wm))||jm));i.Texture2D=ng,function(t){t[t.right=0]="right",t[t.left=1]="left",t[t.top=2]="top",t[t.bottom=3]="bottom",t[t.front=4]="front",t[t.back=5]="back"}(eg||(eg={}));var ig=t("TextureCube",nl("cc.TextureCube")((tg=$m=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return X(e=t.call.apply(t,[this].concat(i))||this,"isRGBE",Zm,V(e)),X(e,"_mipmaps",Jm,V(e)),e}F(e,t),e.fromTexture2DArray=function(t,n){for(var i=[],r=t.length/6,a=0;a<r;a++){var o=6*a;i.push({front:t[o+eg.front].image,back:t[o+eg.back].image,left:t[o+eg.left].image,right:t[o+eg.right].image,top:t[o+eg.top].image,bottom:t[o+eg.bottom].image})}return(n=n||new e).mipmaps=i,n};var n=e.prototype;return n.onLoaded=function(){this.mipmaps=this._mipmaps},n.reset=function(t){this._width=t.width,this._height=t.height,this._setGFXFormat(t.format),this._setMipmapLevel(t.mipmapLevel||1),this._tryReset()},n.updateMipmaps=function(t,e){var n=this;if(void 0===t&&(t=0),!(t>=this._mipmaps.length))for(var i=Math.min(void 0===e?this._mipmaps.length:e,this._mipmaps.length-t),r=function(e){var i=t+e;rg(n._mipmaps[i],(function(t,e){n._assignImage(t,i,e)}))},a=0;a<i;++a)r(a)},n.destroy=function(){return this._mipmaps=[],t.prototype.destroy.call(this)},n.releaseTexture=function(){this.mipmaps=[]},n._serialize=function(){return null},n._deserialize=function(e,n){var i=e;t.prototype._deserialize.call(this,i.base,n),this.isRGBE=i.rgbe,this._mipmaps=new Array(i.mipmaps.length);for(var r=0;r<i.mipmaps.length;++r){this._mipmaps[r]={front:new Dm,back:new Dm,left:new Dm,right:new Dm,top:new Dm,bottom:new Dm};var a=i.mipmaps[r],o=Gt._getClassId(Dm);n.result.push(this._mipmaps[r],"front",a.front,o),n.result.push(this._mipmaps[r],"back",a.back,o),n.result.push(this._mipmaps[r],"left",a.left,o),n.result.push(this._mipmaps[r],"right",a.right,o),n.result.push(this._mipmaps[r],"top",a.top,o),n.result.push(this._mipmaps[r],"bottom",a.bottom,o)}},n._getGfxTextureCreateInfo=function(t){var e=new wa(Pr.CUBE);return e.width=this._width,e.height=this._height,e.layerCount=6,Object.assign(e,t),e},n.initDefault=function(e){t.prototype.initDefault.call(this,e);var n=new Dm;n.initDefault(),this.mipmaps=[{front:n,back:n,top:n,bottom:n,left:n,right:n}]},n.validate=function(){return 0!==this._mipmaps.length&&!this._mipmaps.find((function(t){return!(t.top&&t.bottom&&t.front&&t.back&&t.left&&t.right)}))},L(e,[{key:"mipmaps",get:function(){return this._mipmaps},set:function(t){var e=this;if(this._mipmaps=t,this._setMipmapLevel(this._mipmaps.length),this._mipmaps.length>0){var n=this._mipmaps[0].front;this.reset({width:n.width,height:n.height,format:n.format,mipmapLevel:this._mipmaps.length}),this._mipmaps.forEach((function(t,n){rg(t,(function(t,i){e._assignImage(t,n,i)}))}))}else this.reset({width:0,height:0,mipmapLevel:this._mipmaps.length})}},{key:"image",get:function(){return 0===this._mipmaps.length?null:this._mipmaps[0]},set:function(t){this.mipmaps=t?[t]:[]}}]),e}(Ym),$m.FaceIndex=eg,Zm=q((Qm=tg).prototype,"isRGBE",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Jm=q(Qm.prototype,"_mipmaps",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Km=Qm))||Km);function rg(t,e){e(t.front,eg.front),e(t.back,eg.back),e(t.left,eg.left),e(t.right,eg.right),e(t.top,eg.top),e(t.bottom,eg.bottom)}i.TextureCube=ig;var ag,og,sg=t("effects",[{name:"billboard",techniques:[{name:"add",passes:[{rasterizerState:{cullMode:0},blendState:{targets:[{blend:!0,blendSrc:2,blendDst:1,blendSrcAlpha:2,blendDstAlpha:1}]},program:"billboard|vert:vs_main|tinted-fs:add",depthStencilState:{depthTest:!0,depthWrite:!1},properties:{mainTexture:{value:"grey",type:28},mainTiling_Offset:{value:[1,1,0,0],type:16},tintColor:{value:[.5,.5,.5,.5],type:16}}}]}],shaders:[{name:"billboard|vert:vs_main|tinted-fs:add",hash:2909832090,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:53,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:40},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplerTextures:[],buffers:[],images:[]}},defines:[],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_texCoord",defines:[],format:21,location:1},{name:"a_color",defines:[],format:44,location:2}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:1,members:[{name:"mainTiling_Offset",type:16,count:1},{name:"frameTile_velLenScale",type:16,count:1},{name:"scale",type:16,count:1},{name:"nodeRotation",type:16,count:1}]},{name:"builtin",defines:[],binding:1,stageFlags:1,members:[{name:"cc_size_rotation",type:16,count:1}]},{name:"FragConstants",defines:[],binding:2,stageFlags:16,members:[{name:"tintColor",type:16,count:1}]}],samplerTextures:[{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:3}],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"clear-stencil",techniques:[{passes:[{blendState:{targets:[{blend:!0}]},rasterizerState:{cullMode:0},program:"clear-stencil|sprite-vs:vert|sprite-fs:frag",depthStencilState:{depthTest:!1,depthWrite:!1}}]}],shaders:[{name:"clear-stencil|sprite-vs:vert|sprite-fs:frag",hash:3507038093,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:0,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:0},globals:{blocks:[],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[],samplerTextures:[],buffers:[],images:[]}},defines:[],attributes:[{name:"a_position",defines:[],format:32,location:0}],blocks:[],samplerTextures:[],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"graphics",techniques:[{passes:[{blendState:{targets:[{blend:!0,blendSrc:1,blendDst:4,blendSrcAlpha:1,blendDstAlpha:4}]},rasterizerState:{cullMode:0},program:"graphics|vs:vert|fs:frag",depthStencilState:{depthTest:!1,depthWrite:!1}}]}],shaders:[{name:"graphics|vs:vert|fs:frag",hash:2610213142,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:48,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:0},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplerTextures:[],buffers:[],images:[]}},defines:[],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_color",defines:[],format:44,location:1},{name:"a_dist",defines:[],format:11,location:2}],blocks:[],samplerTextures:[],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"occlusion-query",techniques:[{passes:[{rasterizerState:{cullMode:2},blendState:{targets:[{blendColorMask:0}]},program:"occlusion-query|occlusion-query-vs:vert|occlusion-query-fs:frag",depthStencilState:{depthTest:!0,depthWrite:!1}}]}],shaders:[{name:"occlusion-query|occlusion-query-vs:vert|occlusion-query-fs:frag",hash:1571978323,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:41,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:0},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCWorldBound",defines:[]}],samplerTextures:[],buffers:[],images:[]}},defines:[],attributes:[{name:"a_position",defines:[],format:32,location:0}],blocks:[],samplerTextures:[],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"particle-gpu",techniques:[{name:"add",passes:[{rasterizerState:{cullMode:0},blendState:{targets:[{blend:!0,blendSrc:2,blendDst:1,blendSrcAlpha:2,blendDstAlpha:1}]},program:"particle-gpu|particle-vs-gpu:gpvs_main|tinted-fs:add",depthStencilState:{depthTest:!0,depthWrite:!1},properties:{mainTexture:{value:"grey",type:28},mainTiling_Offset:{value:[1,1,0,0],type:16},tintColor:{value:[.5,.5,.5,.5],type:16}}}]}],shaders:[{name:"particle-gpu|particle-vs-gpu:gpvs_main|tinted-fs:add",hash:1250077034,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:63,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:40},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplerTextures:[],buffers:[],images:[]}},defines:[{name:"CC_RENDER_MODE",type:"number",range:[0,4]},{name:"USE_VK_SHADER",type:"boolean"},{name:"COLOR_OVER_TIME_MODULE_ENABLE",type:"boolean"},{name:"ROTATION_OVER_TIME_MODULE_ENABLE",type:"boolean"},{name:"SIZE_OVER_TIME_MODULE_ENABLE",type:"boolean"},{name:"FORCE_OVER_TIME_MODULE_ENABLE",type:"boolean"},{name:"VELOCITY_OVER_TIME_MODULE_ENABLE",type:"boolean"},{name:"TEXTURE_ANIMATION_MODULE_ENABLE",type:"boolean"},{name:"CC_USE_WORLD_SPACE",type:"boolean"}],attributes:[{name:"a_position_starttime",defines:[],format:44,location:0},{name:"a_size_uv",defines:[],format:44,location:1},{name:"a_rotation_uv",defines:[],format:44,location:2},{name:"a_color",defines:[],format:44,location:3},{name:"a_dir_life",defines:[],format:44,location:4},{name:"a_rndSeed",defines:[],format:11,location:5},{name:"a_texCoord",defines:["CC_RENDER_MODE"],format:32,location:6},{name:"a_texCoord3",defines:["CC_RENDER_MODE"],format:32,location:7},{name:"a_normal",defines:["CC_RENDER_MODE"],format:32,location:8},{name:"a_color1",defines:["CC_RENDER_MODE"],format:44,location:9}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:1,members:[{name:"mainTiling_Offset",type:16,count:1},{name:"frameTile_velLenScale",type:16,count:1},{name:"scale",type:16,count:1},{name:"nodeRotation",type:16,count:1}]},{name:"SampleConstants",defines:[],binding:1,stageFlags:1,members:[{name:"u_sampleInfo",type:16,count:1}]},{name:"TickConstants",defines:[],binding:2,stageFlags:1,members:[{name:"u_worldRot",type:16,count:1},{name:"u_timeDelta",type:16,count:1}]},{name:"ColorConstant",defines:["COLOR_OVER_TIME_MODULE_ENABLE"],binding:3,stageFlags:1,members:[{name:"u_color_mode",type:5,count:1}]},{name:"RotationConstant",defines:["ROTATION_OVER_TIME_MODULE_ENABLE"],binding:4,stageFlags:1,members:[{name:"u_rotation_mode",type:5,count:1}]},{name:"SizeConstant",defines:["SIZE_OVER_TIME_MODULE_ENABLE"],binding:5,stageFlags:1,members:[{name:"u_size_mode",type:5,count:1}]},{name:"ForceConstant",defines:["FORCE_OVER_TIME_MODULE_ENABLE"],binding:6,stageFlags:1,members:[{name:"u_force_mode",type:5,count:1},{name:"u_force_space",type:5,count:1}]},{name:"VelocityConstant",defines:["VELOCITY_OVER_TIME_MODULE_ENABLE"],binding:7,stageFlags:1,members:[{name:"u_velocity_mode",type:5,count:1},{name:"u_velocity_space",type:5,count:1}]},{name:"AnimationConstant",defines:["TEXTURE_ANIMATION_MODULE_ENABLE"],binding:8,stageFlags:1,members:[{name:"u_anim_info",type:16,count:1}]},{name:"FragConstants",defines:[],binding:9,stageFlags:16,members:[{name:"tintColor",type:16,count:1}]}],samplerTextures:[{name:"color_over_time_tex0",type:28,count:1,defines:["COLOR_OVER_TIME_MODULE_ENABLE"],stageFlags:1,binding:10},{name:"rotation_over_time_tex0",type:28,count:1,defines:["ROTATION_OVER_TIME_MODULE_ENABLE"],stageFlags:1,binding:11},{name:"size_over_time_tex0",type:28,count:1,defines:["SIZE_OVER_TIME_MODULE_ENABLE"],stageFlags:1,binding:12},{name:"force_over_time_tex0",type:28,count:1,defines:["FORCE_OVER_TIME_MODULE_ENABLE"],stageFlags:1,binding:13},{name:"velocity_over_time_tex0",type:28,count:1,defines:["VELOCITY_OVER_TIME_MODULE_ENABLE"],stageFlags:1,binding:14},{name:"texture_animation_tex0",type:28,count:1,defines:["TEXTURE_ANIMATION_MODULE_ENABLE"],stageFlags:1,binding:15},{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:16}],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"particle-trail",techniques:[{name:"add",passes:[{rasterizerState:{cullMode:0},blendState:{targets:[{blend:!0,blendSrc:2,blendDst:1,blendSrcAlpha:2,blendDstAlpha:1}]},program:"particle-trail|particle-trail:vs_main|tinted-fs:add",depthStencilState:{depthTest:!0,depthWrite:!1},properties:{mainTexture:{value:"grey",type:28},mainTiling_Offset:{value:[1,1,0,0],type:16},frameTile_velLenScale:{value:[1,1,0,0],type:16},tintColor:{value:[.5,.5,.5,.5],type:16}}}]}],shaders:[{name:"particle-trail|particle-trail:vs_main|tinted-fs:add",hash:1437790364,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:52,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:40},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplerTextures:[],buffers:[],images:[]}},defines:[{name:"CC_RENDER_MODE",type:"number",range:[0,4]},{name:"CC_DRAW_WIRE_FRAME",type:"boolean"},{name:"CC_USE_WORLD_SPACE",type:"boolean"}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_texCoord",defines:[],format:44,location:1},{name:"a_texCoord1",defines:[],format:32,location:2},{name:"a_texCoord2",defines:[],format:32,location:3},{name:"a_color",defines:[],format:44,location:4}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:1,members:[{name:"mainTiling_Offset",type:16,count:1},{name:"frameTile_velLenScale",type:16,count:1},{name:"scale",type:16,count:1},{name:"nodeRotation",type:16,count:1}]},{name:"FragConstants",defines:[],binding:1,stageFlags:16,members:[{name:"tintColor",type:16,count:1}]}],samplerTextures:[{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:2}],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"particle",techniques:[{name:"add",passes:[{rasterizerState:{cullMode:0},blendState:{targets:[{blend:!0,blendSrc:2,blendDst:1,blendSrcAlpha:2,blendDstAlpha:1}]},program:"particle|particle-vs-legacy:lpvs_main|tinted-fs:add",depthStencilState:{depthTest:!0,depthWrite:!1},properties:{mainTexture:{value:"grey",type:28},mainTiling_Offset:{value:[1,1,0,0],type:16},tintColor:{value:[.5,.5,.5,.5],type:16}}}]}],shaders:[{name:"particle|particle-vs-legacy:lpvs_main|tinted-fs:add",hash:2554907268,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:52,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:40},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplerTextures:[],buffers:[],images:[]}},defines:[{name:"CC_RENDER_MODE",type:"number",range:[0,4]},{name:"CC_USE_WORLD_SPACE",type:"boolean"},{name:"ROTATION_OVER_TIME_MODULE_ENABLE",type:"boolean"}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_texCoord",defines:[],format:32,location:1},{name:"a_texCoord1",defines:[],format:32,location:2},{name:"a_texCoord2",defines:[],format:32,location:3},{name:"a_color",defines:[],format:44,location:4},{name:"a_color1",defines:["CC_RENDER_MODE"],format:32,location:8},{name:"a_texCoord3",defines:["CC_RENDER_MODE"],format:32,location:6},{name:"a_normal",defines:["CC_RENDER_MODE"],format:32,location:7}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:1,members:[{name:"mainTiling_Offset",type:16,count:1},{name:"frameTile_velLenScale",type:16,count:1},{name:"scale",type:16,count:1},{name:"nodeRotation",type:16,count:1}]},{name:"FragConstants",defines:[],binding:1,stageFlags:16,members:[{name:"tintColor",type:16,count:1}]}],samplerTextures:[{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:2}],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"spine",techniques:[{passes:[{blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},rasterizerState:{cullMode:0},program:"spine|sprite-vs:vert|sprite-fs:frag",depthStencilState:{depthTest:!1,depthWrite:!1},properties:{alphaThreshold:{value:[.5],type:13}}}]}],shaders:[{name:"spine|sprite-vs:vert|sprite-fs:frag",hash:3192452405,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:48,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:1},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCLocal",defines:["USE_LOCAL"]}],samplerTextures:[{name:"cc_spriteTexture",defines:[]}],buffers:[],images:[]}},defines:[{name:"USE_LOCAL",type:"boolean"},{name:"TWO_COLORED",type:"boolean"},{name:"USE_ALPHA_TEST",type:"boolean"}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_texCoord",defines:[],format:21,location:1},{name:"a_color",defines:[],format:44,location:2},{name:"a_color2",defines:["TWO_COLORED"],format:44,location:3}],blocks:[{name:"ALPHA_TEST_DATA",defines:["USE_ALPHA_TEST"],binding:0,stageFlags:16,members:[{name:"alphaThreshold",type:13,count:1}]}],samplerTextures:[],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"sprite",techniques:[{passes:[{blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},rasterizerState:{cullMode:0},program:"sprite|sprite-vs:vert|sprite-fs:frag",depthStencilState:{depthTest:!1,depthWrite:!1},properties:{alphaThreshold:{value:[.5],type:13}}}]}],shaders:[{name:"sprite|sprite-vs:vert|sprite-fs:frag",hash:1770338543,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:48,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:1},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCLocal",defines:["USE_LOCAL"]}],samplerTextures:[{name:"cc_spriteTexture",defines:["USE_TEXTURE"]}],buffers:[],images:[]}},defines:[{name:"USE_LOCAL",type:"boolean"},{name:"SAMPLE_FROM_RT",type:"boolean"},{name:"USE_PIXEL_ALIGNMENT",type:"boolean"},{name:"CC_USE_EMBEDDED_ALPHA",type:"boolean"},{name:"USE_ALPHA_TEST",type:"boolean"},{name:"USE_TEXTURE",type:"boolean"},{name:"IS_GRAY",type:"boolean"}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_texCoord",defines:[],format:21,location:1},{name:"a_color",defines:[],format:44,location:2}],blocks:[{name:"ALPHA_TEST_DATA",defines:["USE_ALPHA_TEST"],binding:0,stageFlags:16,members:[{name:"alphaThreshold",type:13,count:1}]}],samplerTextures:[],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"standard",techniques:[{name:"opaque",passes:[{program:"standard|standard-vs|standard-fs",properties:{tilingOffset:{value:[1,1,0,0],type:16},mainColor:{value:[1,1,1,1],linear:!0,type:16,handleInfo:["albedo",0,16]},albedoScale:{value:[1,1,1],type:15,handleInfo:["albedoScaleAndCutoff",0,15]},alphaThreshold:{value:[.5],type:13,handleInfo:["albedoScaleAndCutoff",3,13]},occlusion:{value:[1],type:13,handleInfo:["pbrParams",0,13]},roughness:{value:[.8],type:13,handleInfo:["pbrParams",1,13]},metallic:{value:[.6],type:13,handleInfo:["pbrParams",2,13]},SpecularIntensity:{value:[.5],type:13,handleInfo:["pbrParams",3,13]},emissive:{value:[0,0,0,1],linear:!0,type:16},emissiveScale:{value:[1,1,1],type:15,handleInfo:["emissiveScaleParam",0,15]},normalStrenth:{value:[1],type:13,handleInfo:["emissiveScaleParam",3,13]},mainTexture:{value:"grey",type:28,handleInfo:["albedoMap",0,28]},normalMap:{value:"normal",type:28},pbrMap:{value:"grey",type:28},metallicRoughnessMap:{value:"grey",type:28},occlusionMap:{value:"white",type:28},emissiveMap:{value:"grey",type:28},albedo:{type:16,value:[1,1,1,1]},albedoScaleAndCutoff:{type:16,value:[1,1,1,.5]},pbrParams:{type:16,value:[1,.8,.6,.5]},emissiveScaleParam:{type:16,value:[1,1,1,1]},albedoMap:{type:28,value:"grey"}}},{phase:"forward-add",propertyIndex:0,embeddedMacros:{CC_FORWARD_ADD:!0},blendState:{targets:[{blend:!0,blendSrc:1,blendDst:1,blendSrcAlpha:0,blendDstAlpha:1}]},program:"standard|standard-vs|standard-fs",depthStencilState:{depthFunc:2,depthTest:!0,depthWrite:!1}},{phase:"shadow-caster",propertyIndex:0,rasterizerState:{cullMode:1},program:"standard|shadow-caster-vs:vert|shadow-caster-fs:frag",properties:{tilingOffset:{value:[1,1,0,0],type:16},mainColor:{value:[1,1,1,1],type:16,handleInfo:["albedo",0,16]},albedoScale:{value:[1,1,1],type:15,handleInfo:["albedoScaleAndCutoff",0,15]},alphaThreshold:{value:[.5],type:13,handleInfo:["albedoScaleAndCutoff",3,13]},mainTexture:{value:"grey",type:28,handleInfo:["albedoMap",0,28]},albedo:{type:16,value:[1,1,1,1]},albedoScaleAndCutoff:{type:16,value:[1,1,1,.5]},albedoMap:{type:28,value:"grey"}}}]}],shaders:[{name:"standard|standard-vs|standard-fs",hash:4038009253,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:222,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:65},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]},{name:"CCShadow",defines:[]}],samplerTextures:[{name:"cc_shadowMap",defines:["CC_RECEIVE_SHADOW"]},{name:"cc_spotLightingMap",defines:["CC_RECEIVE_SHADOW"]},{name:"cc_environment",defines:["CC_USE_IBL"]},{name:"cc_diffuseMap",defines:["CC_USE_IBL","CC_USE_DIFFUSEMAP"]}],buffers:[],images:[]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]},{name:"CCLocalBatched",defines:["!USE_INSTANCING","USE_BATCHING"]},{name:"CCLocal",defines:["!USE_INSTANCING","!USE_BATCHING"]},{name:"CCForwardLight",defines:["CC_FORWARD_ADD","CC_ENABLE_CLUSTERED_LIGHT_CULLING"]}],samplerTextures:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"cc_lightingMap",defines:["USE_LIGHTMAP","!USE_BATCHING","!CC_FORWARD_ADD"]}],buffers:[],images:[]}},defines:[{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"USE_INSTANCING",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"USE_LIGHTMAP",type:"boolean"},{name:"CC_USE_FOG",type:"number",range:[0,4]},{name:"CC_USE_ACCURATE_FOG",type:"boolean"},{name:"CC_RECEIVE_SHADOW",type:"boolean"},{name:"USE_VERTEX_COLOR",type:"boolean"},{name:"USE_NORMAL_MAP",type:"boolean"},{name:"HAS_SECOND_UV",type:"boolean"},{name:"CC_FORWARD_ADD",type:"boolean"},{name:"USE_TWOSIDE",type:"boolean"},{name:"SAMPLE_FROM_RT",type:"boolean"},{name:"CC_USE_IBL",type:"number",range:[0,2]},{name:"CC_USE_DIFFUSEMAP",type:"number",range:[0,2]},{name:"USE_REFLECTION_DENOISE",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"},{name:"USE_ALBEDO_MAP",type:"boolean"},{name:"ALBEDO_UV",type:"string",options:["v_uv","v_uv1"]},{name:"NORMAL_UV",type:"string",options:["v_uv","v_uv1"]},{name:"PBR_UV",type:"string",options:["v_uv","v_uv1"]},{name:"USE_PBR_MAP",type:"boolean"},{name:"USE_METALLIC_ROUGHNESS_MAP",type:"boolean"},{name:"USE_OCCLUSION_MAP",type:"boolean"},{name:"USE_EMISSIVE_MAP",type:"boolean"},{name:"EMISSIVE_UV",type:"string",options:["v_uv","v_uv1"]},{name:"USE_ALPHA_TEST",type:"boolean"},{name:"ALPHA_TEST_CHANNEL",type:"string",options:["a","r"]},{name:"CC_PIPELINE_TYPE",type:"number",range:[0,1]},{name:"CC_FORCE_FORWARD_SHADING",type:"boolean"}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_normal",defines:[],format:32,location:1},{name:"a_texCoord",defines:[],format:21,location:2},{name:"a_tangent",defines:[],format:44,location:3},{name:"a_vertexId",defines:["CC_USE_MORPH"],format:11,location:6},{name:"a_joints",defines:["CC_USE_SKINNING"],location:4},{name:"a_weights",defines:["CC_USE_SKINNING"],format:44,location:5},{name:"a_jointAnimInfo",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION","USE_INSTANCING"],format:44,isInstanced:!0,location:7},{name:"a_matWorld0",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:8},{name:"a_matWorld1",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:9},{name:"a_matWorld2",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:10},{name:"a_lightingMapUVParam",defines:["USE_INSTANCING","USE_LIGHTMAP"],format:44,isInstanced:!0,location:11},{name:"a_dyn_batch_id",defines:["!USE_INSTANCING","USE_BATCHING"],format:11,location:12},{name:"a_color",defines:["USE_VERTEX_COLOR"],format:44,location:13},{name:"a_texCoord1",defines:[],format:21,location:14}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:17,members:[{name:"tilingOffset",type:16,count:1},{name:"albedo",type:16,count:1},{name:"albedoScaleAndCutoff",type:16,count:1},{name:"pbrParams",type:16,count:1},{name:"emissive",type:16,count:1},{name:"emissiveScaleParam",type:16,count:1}]}],samplerTextures:[{name:"albedoMap",type:28,count:1,defines:["USE_ALBEDO_MAP"],stageFlags:16,binding:1},{name:"normalMap",type:28,count:1,defines:["USE_NORMAL_MAP"],stageFlags:16,binding:2},{name:"pbrMap",type:28,count:1,defines:["USE_PBR_MAP"],stageFlags:16,binding:3},{name:"metallicRoughnessMap",type:28,count:1,defines:["USE_METALLIC_ROUGHNESS_MAP"],stageFlags:16,binding:4},{name:"occlusionMap",type:28,count:1,defines:["USE_OCCLUSION_MAP"],stageFlags:16,binding:5},{name:"emissiveMap",type:28,count:1,defines:["USE_EMISSIVE_MAP"],stageFlags:16,binding:6}],buffers:[{name:"b_ccLightsBuffer",memoryAccess:1,defines:["CC_FORWARD_ADD","CC_ENABLE_CLUSTERED_LIGHT_CULLING"],stageFlags:16,binding:7},{name:"b_clusterLightIndicesBuffer",memoryAccess:1,defines:["CC_FORWARD_ADD","CC_ENABLE_CLUSTERED_LIGHT_CULLING"],stageFlags:16,binding:8},{name:"b_clusterLightGridBuffer",memoryAccess:1,defines:["CC_FORWARD_ADD","CC_ENABLE_CLUSTERED_LIGHT_CULLING"],stageFlags:16,binding:9}],images:[],textures:[],samplers:[],subpassInputs:[]},{name:"standard|shadow-caster-vs:vert|shadow-caster-fs:frag",hash:210600745,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:183,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:65},globals:{blocks:[{name:"CCShadow",defines:[]},{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[{name:"cc_shadowMap",defines:["CC_RECEIVE_SHADOW"]},{name:"cc_spotLightingMap",defines:["CC_RECEIVE_SHADOW"]}],buffers:[],images:[]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]},{name:"CCLocalBatched",defines:["!USE_INSTANCING","USE_BATCHING"]},{name:"CCLocal",defines:["!USE_INSTANCING","!USE_BATCHING"]}],samplerTextures:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]}],buffers:[],images:[]}},defines:[{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"USE_INSTANCING",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"USE_LIGHTMAP",type:"boolean"},{name:"HAS_SECOND_UV",type:"boolean"},{name:"CC_RECEIVE_SHADOW",type:"boolean"},{name:"USE_ALBEDO_MAP",type:"boolean"},{name:"ALBEDO_UV",type:"string",options:["v_uv","v_uv1"]},{name:"USE_ALPHA_TEST",type:"boolean"},{name:"ALPHA_TEST_CHANNEL",type:"string",options:["a","r"]}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_normal",defines:[],format:32,location:1},{name:"a_texCoord",defines:[],format:21,location:2},{name:"a_tangent",defines:[],format:44,location:3},{name:"a_vertexId",defines:["CC_USE_MORPH"],format:11,location:6},{name:"a_joints",defines:["CC_USE_SKINNING"],location:4},{name:"a_weights",defines:["CC_USE_SKINNING"],format:44,location:5},{name:"a_jointAnimInfo",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION","USE_INSTANCING"],format:44,isInstanced:!0,location:7},{name:"a_matWorld0",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:8},{name:"a_matWorld1",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:9},{name:"a_matWorld2",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:10},{name:"a_lightingMapUVParam",defines:["USE_INSTANCING","USE_LIGHTMAP"],format:44,isInstanced:!0,location:11},{name:"a_dyn_batch_id",defines:["!USE_INSTANCING","USE_BATCHING"],format:11,location:12},{name:"a_texCoord1",defines:[],format:21,location:13}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:17,members:[{name:"tilingOffset",type:16,count:1},{name:"albedo",type:16,count:1},{name:"albedoScaleAndCutoff",type:16,count:1},{name:"pbrParams",type:16,count:1},{name:"emissive",type:16,count:1},{name:"emissiveScaleParam",type:16,count:1}]}],samplerTextures:[{name:"albedoMap",type:28,count:1,defines:["USE_ALBEDO_MAP"],stageFlags:16,binding:1}],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"terrain",techniques:[{name:"opaque",passes:[{program:"terrain|terrain-vs|terrain-fs",properties:{UVScale:{value:[1,1,1,1],type:16},lightMapUVParam:{value:[0,0,0,0],type:16},metallic:{value:[0,0,0,0],type:16},roughness:{value:[1,1,1,1],type:16},weightMap:{value:"black",type:28},detailMap0:{value:"grey",type:28},detailMap1:{value:"grey",type:28},detailMap2:{value:"grey",type:28},detailMap3:{value:"grey",type:28},normalMap0:{value:"normal",type:28},normalMap1:{value:"normal",type:28},normalMap2:{value:"normal",type:28},normalMap3:{value:"normal",type:28},lightMap:{value:"grey",type:28}}},{phase:"forward-add",propertyIndex:0,embeddedMacros:{CC_FORWARD_ADD:!0},blendState:{targets:[{blend:!0,blendSrc:1,blendDst:1,blendSrcAlpha:0,blendDstAlpha:1}]},program:"terrain|terrain-vs|terrain-fs",depthStencilState:{depthFunc:2,depthTest:!0,depthWrite:!1},properties:{UVScale:{value:[1,1,1,1],type:16},lightMapUVParam:{value:[0,0,0,0],type:16},metallic:{value:[0,0,0,0],type:16},roughness:{value:[1,1,1,1],type:16},weightMap:{value:"black",type:28},detailMap0:{value:"grey",type:28},detailMap1:{value:"grey",type:28},detailMap2:{value:"grey",type:28},detailMap3:{value:"grey",type:28},normalMap0:{value:"normal",type:28},normalMap1:{value:"normal",type:28},normalMap2:{value:"normal",type:28},normalMap3:{value:"normal",type:28},lightMap:{value:"grey",type:28}}},{phase:"shadow-add",propertyIndex:0,rasterizerState:{cullMode:2},program:"terrain|shadow-caster-vs:vert|shadow-caster-fs:frag"}]}],shaders:[{name:"terrain|terrain-vs|terrain-fs",hash:3916952624,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:70,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:61},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]},{name:"CCShadow",defines:[]}],samplerTextures:[{name:"cc_shadowMap",defines:["CC_RECEIVE_SHADOW"]},{name:"cc_spotLightingMap",defines:["CC_RECEIVE_SHADOW"]},{name:"cc_environment",defines:["CC_USE_IBL"]},{name:"cc_diffuseMap",defines:["CC_USE_IBL","CC_USE_DIFFUSEMAP"]}],buffers:[],images:[]},locals:{blocks:[{name:"CCLocal",defines:[]},{name:"CCForwardLight",defines:["CC_FORWARD_ADD","CC_ENABLE_CLUSTERED_LIGHT_CULLING"]}],samplerTextures:[{name:"cc_lightingMap",defines:["USE_LIGHTMAP","!USE_BATCHING","!CC_FORWARD_ADD"]}],buffers:[],images:[]}},defines:[{name:"CC_USE_FOG",type:"number",range:[0,4]},{name:"CC_USE_ACCURATE_FOG",type:"boolean"},{name:"CC_RECEIVE_SHADOW",type:"boolean"},{name:"USE_NORMALMAP",type:"boolean"},{name:"USE_LIGHTMAP",type:"boolean"},{name:"CC_USE_IBL",type:"number",range:[0,2]},{name:"CC_USE_DIFFUSEMAP",type:"number",range:[0,2]},{name:"USE_REFLECTION_DENOISE",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"CC_FORWARD_ADD",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"},{name:"LAYERS",type:"number",range:[0,4]},{name:"USE_PBR",type:"boolean"},{name:"CC_PIPELINE_TYPE",type:"number",range:[0,1]},{name:"CC_FORCE_FORWARD_SHADING",type:"boolean"}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_normal",defines:[],format:32,location:1},{name:"a_texCoord",defines:[],format:21,location:2}],blocks:[{name:"TexCoords",defines:[],binding:0,stageFlags:1,members:[{name:"UVScale",type:16,count:1},{name:"lightMapUVParam",type:16,count:1}]},{name:"PbrParams",defines:[],binding:1,stageFlags:16,members:[{name:"metallic",type:16,count:1},{name:"roughness",type:16,count:1}]}],samplerTextures:[{name:"weightMap",type:28,count:1,defines:[],stageFlags:16,binding:2},{name:"detailMap0",type:28,count:1,defines:[],stageFlags:16,binding:3},{name:"detailMap1",type:28,count:1,defines:[],stageFlags:16,binding:4},{name:"detailMap2",type:28,count:1,defines:[],stageFlags:16,binding:5},{name:"detailMap3",type:28,count:1,defines:[],stageFlags:16,binding:6},{name:"normalMap0",type:28,count:1,defines:[],stageFlags:16,binding:7},{name:"normalMap1",type:28,count:1,defines:[],stageFlags:16,binding:8},{name:"normalMap2",type:28,count:1,defines:[],stageFlags:16,binding:9},{name:"normalMap3",type:28,count:1,defines:[],stageFlags:16,binding:10},{name:"lightMap",type:28,count:1,defines:[],stageFlags:16,binding:11}],buffers:[{name:"b_ccLightsBuffer",memoryAccess:1,defines:["CC_FORWARD_ADD","CC_ENABLE_CLUSTERED_LIGHT_CULLING"],stageFlags:16,binding:12},{name:"b_clusterLightIndicesBuffer",memoryAccess:1,defines:["CC_FORWARD_ADD","CC_ENABLE_CLUSTERED_LIGHT_CULLING"],stageFlags:16,binding:13},{name:"b_clusterLightGridBuffer",memoryAccess:1,defines:["CC_FORWARD_ADD","CC_ENABLE_CLUSTERED_LIGHT_CULLING"],stageFlags:16,binding:14}],images:[],textures:[],samplers:[],subpassInputs:[]},{name:"terrain|shadow-caster-vs:vert|shadow-caster-fs:frag",hash:4270039829,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:68,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:0},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]},{name:"CCShadow",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplerTextures:[],buffers:[],images:[]}},defines:[],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_normal",defines:[],format:32,location:1},{name:"a_texCoord",defines:[],format:21,location:2}],blocks:[],samplerTextures:[],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"unlit",techniques:[{name:"opaque",passes:[{program:"unlit|unlit-vs:vert|unlit-fs:frag",properties:{mainTexture:{value:"grey",type:28},tilingOffset:{value:[1,1,0,0],type:16},mainColor:{value:[1,1,1,1],linear:!0,type:16},colorScale:{value:[1,1,1],type:15,handleInfo:["colorScaleAndCutoff",0,15]},alphaThreshold:{value:[.5],type:13,handleInfo:["colorScaleAndCutoff",3,13]},color:{linear:!0,type:16,handleInfo:["mainColor",0,16]},colorScaleAndCutoff:{type:16,value:[1,1,1,.5]}}}]}],shaders:[{name:"unlit|unlit-vs:vert|unlit-fs:frag",hash:3319190198,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:197,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:41},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]},{name:"CCLocalBatched",defines:["!USE_INSTANCING","USE_BATCHING"]},{name:"CCLocal",defines:["!USE_INSTANCING","!USE_BATCHING"]}],samplerTextures:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]}],buffers:[],images:[]}},defines:[{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"USE_INSTANCING",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"USE_LIGHTMAP",type:"boolean"},{name:"CC_USE_FOG",type:"number",range:[0,4]},{name:"CC_USE_ACCURATE_FOG",type:"boolean"},{name:"USE_VERTEX_COLOR",type:"boolean"},{name:"USE_TEXTURE",type:"boolean"},{name:"SAMPLE_FROM_RT",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"},{name:"USE_ALPHA_TEST",type:"boolean"},{name:"ALPHA_TEST_CHANNEL",type:"string",options:["a","r","g","b"]}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_normal",defines:[],format:32,location:1},{name:"a_texCoord",defines:[],format:21,location:2},{name:"a_tangent",defines:[],format:44,location:3},{name:"a_vertexId",defines:["CC_USE_MORPH"],format:11,location:6},{name:"a_joints",defines:["CC_USE_SKINNING"],location:4},{name:"a_weights",defines:["CC_USE_SKINNING"],format:44,location:5},{name:"a_jointAnimInfo",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION","USE_INSTANCING"],format:44,isInstanced:!0,location:7},{name:"a_matWorld0",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:8},{name:"a_matWorld1",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:9},{name:"a_matWorld2",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:10},{name:"a_lightingMapUVParam",defines:["USE_INSTANCING","USE_LIGHTMAP"],format:44,isInstanced:!0,location:11},{name:"a_dyn_batch_id",defines:["!USE_INSTANCING","USE_BATCHING"],format:11,location:12},{name:"a_color",defines:["USE_VERTEX_COLOR"],format:44,location:13}],blocks:[{name:"TexCoords",defines:["USE_TEXTURE"],binding:0,stageFlags:1,members:[{name:"tilingOffset",type:16,count:1}]},{name:"Constant",defines:[],binding:1,stageFlags:16,members:[{name:"mainColor",type:16,count:1},{name:"colorScaleAndCutoff",type:16,count:1}]}],samplerTextures:[{name:"mainTexture",type:28,count:1,defines:["USE_TEXTURE"],stageFlags:16,binding:2}],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"bloom",techniques:[{passes:[{phase:"bloom-prefilter",program:"bloom|bloom-vs|prefilter-fs",depthStencilState:{depthTest:!1,depthWrite:!1}},{phase:"bloom-downsample",program:"bloom|bloom-vs|downsample-fs",depthStencilState:{depthTest:!1,depthWrite:!1}},{phase:"bloom-downsample",program:"bloom|bloom-vs|downsample-fs",depthStencilState:{depthTest:!1,depthWrite:!1}},{phase:"bloom-downsample",program:"bloom|bloom-vs|downsample-fs",depthStencilState:{depthTest:!1,depthWrite:!1}},{phase:"bloom-downsample",program:"bloom|bloom-vs|downsample-fs",depthStencilState:{depthTest:!1,depthWrite:!1}},{phase:"bloom-downsample",program:"bloom|bloom-vs|downsample-fs",depthStencilState:{depthTest:!1,depthWrite:!1}},{phase:"bloom-downsample",program:"bloom|bloom-vs|downsample-fs",depthStencilState:{depthTest:!1,depthWrite:!1}},{phase:"bloom-upsample",program:"bloom|bloom-vs|upsample-fs",depthStencilState:{depthTest:!1,depthWrite:!1}},{phase:"bloom-upsample",program:"bloom|bloom-vs|upsample-fs",depthStencilState:{depthTest:!1,depthWrite:!1}},{phase:"bloom-upsample",program:"bloom|bloom-vs|upsample-fs",depthStencilState:{depthTest:!1,depthWrite:!1}},{phase:"bloom-upsample",program:"bloom|bloom-vs|upsample-fs",depthStencilState:{depthTest:!1,depthWrite:!1}},{phase:"bloom-upsample",program:"bloom|bloom-vs|upsample-fs",depthStencilState:{depthTest:!1,depthWrite:!1}},{phase:"bloom-upsample",program:"bloom|bloom-vs|upsample-fs",depthStencilState:{depthTest:!1,depthWrite:!1}},{phase:"bloom-combine",program:"bloom|bloom-vs|combine-fs",depthStencilState:{depthTest:!1,depthWrite:!1}}]}],shaders:[{name:"bloom|bloom-vs|prefilter-fs",hash:2185821616,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:147,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:40},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]}],samplerTextures:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]}],buffers:[],images:[]}},defines:[{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"USE_INSTANCING",type:"boolean"}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_normal",defines:[],format:32,location:1},{name:"a_texCoord",defines:[],format:21,location:2},{name:"a_tangent",defines:[],format:44,location:3},{name:"a_vertexId",defines:["CC_USE_MORPH"],format:11,location:6},{name:"a_joints",defines:["CC_USE_SKINNING"],location:4},{name:"a_weights",defines:["CC_USE_SKINNING"],format:44,location:5},{name:"a_jointAnimInfo",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION","USE_INSTANCING"],format:44,isInstanced:!0,location:7}],blocks:[{name:"BloomUBO",defines:[],binding:0,stageFlags:16,members:[{name:"texSize",type:16,count:1}]}],samplerTextures:[{name:"outputResultMap",type:28,count:1,defines:[],stageFlags:16,binding:1}],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]},{name:"bloom|bloom-vs|downsample-fs",hash:1780231359,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:147,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:40},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]}],samplerTextures:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]}],buffers:[],images:[]}},defines:[{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"USE_INSTANCING",type:"boolean"}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_normal",defines:[],format:32,location:1},{name:"a_texCoord",defines:[],format:21,location:2},{name:"a_tangent",defines:[],format:44,location:3},{name:"a_vertexId",defines:["CC_USE_MORPH"],format:11,location:6},{name:"a_joints",defines:["CC_USE_SKINNING"],location:4},{name:"a_weights",defines:["CC_USE_SKINNING"],format:44,location:5},{name:"a_jointAnimInfo",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION","USE_INSTANCING"],format:44,isInstanced:!0,location:7}],blocks:[{name:"BloomUBO",defines:[],binding:0,stageFlags:16,members:[{name:"texSize",type:16,count:1}]}],samplerTextures:[{name:"bloomTexture",type:28,count:1,defines:[],stageFlags:16,binding:1}],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]},{name:"bloom|bloom-vs|upsample-fs",hash:3580425335,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:147,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:40},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]}],samplerTextures:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]}],buffers:[],images:[]}},defines:[{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"USE_INSTANCING",type:"boolean"}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_normal",defines:[],format:32,location:1},{name:"a_texCoord",defines:[],format:21,location:2},{name:"a_tangent",defines:[],format:44,location:3},{name:"a_vertexId",defines:["CC_USE_MORPH"],format:11,location:6},{name:"a_joints",defines:["CC_USE_SKINNING"],location:4},{name:"a_weights",defines:["CC_USE_SKINNING"],format:44,location:5},{name:"a_jointAnimInfo",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION","USE_INSTANCING"],format:44,isInstanced:!0,location:7}],blocks:[{name:"BloomUBO",defines:[],binding:0,stageFlags:16,members:[{name:"texSize",type:16,count:1}]}],samplerTextures:[{name:"bloomTexture",type:28,count:1,defines:[],stageFlags:16,binding:1}],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]},{name:"bloom|bloom-vs|combine-fs",hash:3457196798,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:147,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:40},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]}],samplerTextures:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]}],buffers:[],images:[]}},defines:[{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"USE_INSTANCING",type:"boolean"}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_normal",defines:[],format:32,location:1},{name:"a_texCoord",defines:[],format:21,location:2},{name:"a_tangent",defines:[],format:44,location:3},{name:"a_vertexId",defines:["CC_USE_MORPH"],format:11,location:6},{name:"a_joints",defines:["CC_USE_SKINNING"],location:4},{name:"a_weights",defines:["CC_USE_SKINNING"],format:44,location:5},{name:"a_jointAnimInfo",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION","USE_INSTANCING"],format:44,isInstanced:!0,location:7}],blocks:[{name:"BloomUBO",defines:[],binding:0,stageFlags:16,members:[{name:"texSize",type:16,count:1}]}],samplerTextures:[{name:"outputResultMap",type:28,count:1,defines:[],stageFlags:16,binding:1},{name:"bloomTexture",type:28,count:1,defines:[],stageFlags:16,binding:2}],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"deferred-lighting",techniques:[{passes:[{phase:"deferred-lighting",program:"deferred-lighting|lighting-vs|lighting-fs",depthStencilState:{depthFunc:4,depthTest:!0,depthWrite:!1}}]}],shaders:[{name:"deferred-lighting|lighting-vs|lighting-fs",hash:3788484086,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:39,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:59},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]},{name:"CCShadow",defines:[]}],samplerTextures:[{name:"cc_shadowMap",defines:["CC_RECEIVE_SHADOW"]},{name:"cc_spotLightingMap",defines:["CC_RECEIVE_SHADOW"]},{name:"cc_environment",defines:["CC_USE_IBL"]},{name:"cc_diffuseMap",defines:["CC_USE_IBL","CC_USE_DIFFUSEMAP"]}],buffers:[],images:[]},locals:{blocks:[{name:"CCForwardLight",defines:["CC_ENABLE_CLUSTERED_LIGHT_CULLING"]}],samplerTextures:[],buffers:[],images:[]}},defines:[{name:"CC_RECEIVE_SHADOW",type:"boolean"},{name:"CC_USE_IBL",type:"number",range:[0,2]},{name:"CC_USE_DIFFUSEMAP",type:"number",range:[0,2]},{name:"USE_REFLECTION_DENOISE",type:"boolean"},{name:"USE_LIGHTMAP",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"CC_FORWARD_ADD",type:"boolean"},{name:"CC_PIPELINE_TYPE",type:"number",range:[0,1]},{name:"CC_FORCE_FORWARD_SHADING",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"},{name:"CC_USE_FOG",type:"number",range:[0,4]}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_normal",defines:[],format:32,location:1},{name:"a_texCoord",defines:[],format:21,location:2},{name:"a_tangent",defines:[],format:44,location:3}],blocks:[],samplerTextures:[{name:"depth_stencil",type:28,count:1,defines:[],stageFlags:16,binding:3}],buffers:[{name:"b_ccLightsBuffer",memoryAccess:1,defines:["CC_ENABLE_CLUSTERED_LIGHT_CULLING"],stageFlags:16,binding:4},{name:"b_clusterLightIndicesBuffer",memoryAccess:1,defines:["CC_ENABLE_CLUSTERED_LIGHT_CULLING"],stageFlags:16,binding:5},{name:"b_clusterLightGridBuffer",memoryAccess:1,defines:["CC_ENABLE_CLUSTERED_LIGHT_CULLING"],stageFlags:16,binding:6}],images:[],textures:[],samplers:[],subpassInputs:[{name:"gbuffer_albedoMap",count:1,defines:["CC_DEVICE_CAN_BENEFIT_FROM_INPUT_ATTACHMENT"],stageFlags:16,binding:0},{name:"gbuffer_normalMap",count:1,defines:["CC_DEVICE_CAN_BENEFIT_FROM_INPUT_ATTACHMENT"],stageFlags:16,binding:1},{name:"gbuffer_emissiveMap",count:1,defines:["CC_DEVICE_CAN_BENEFIT_FROM_INPUT_ATTACHMENT"],stageFlags:16,binding:2}]}]},{name:"planar-shadow",techniques:[{passes:[{phase:"planarShadow",blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},program:"planar-shadow|planar-shadow-vs:vert|planar-shadow-fs:frag",depthStencilState:{depthTest:!0,depthWrite:!1,stencilTestFront:!0,stencilFuncFront:5,stencilPassOpFront:2,stencilRefBack:128,stencilRefFront:128,stencilReadMaskBack:128,stencilReadMaskFront:128,stencilWriteMaskBack:128,stencilWriteMaskFront:128}}]}],shaders:[{name:"planar-shadow|planar-shadow-vs:vert|planar-shadow-fs:frag",hash:730673320,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:216,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:59},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]},{name:"CCShadow",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]},{name:"CCLocalBatched",defines:["!USE_INSTANCING","USE_BATCHING"]},{name:"CCLocal",defines:["!USE_INSTANCING","!USE_BATCHING"]}],samplerTextures:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]}],buffers:[],images:[]}},defines:[{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"USE_INSTANCING",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"USE_LIGHTMAP",type:"boolean"}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_normal",defines:[],format:32,location:1},{name:"a_texCoord",defines:[],format:21,location:2},{name:"a_tangent",defines:[],format:44,location:3},{name:"a_vertexId",defines:["CC_USE_MORPH"],format:11,location:6},{name:"a_joints",defines:["CC_USE_SKINNING"],location:4},{name:"a_weights",defines:["CC_USE_SKINNING"],format:44,location:5},{name:"a_jointAnimInfo",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION","USE_INSTANCING"],format:44,isInstanced:!0,location:7},{name:"a_matWorld0",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:8},{name:"a_matWorld1",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:9},{name:"a_matWorld2",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:10},{name:"a_lightingMapUVParam",defines:["USE_INSTANCING","USE_LIGHTMAP"],format:44,isInstanced:!0,location:11},{name:"a_dyn_batch_id",defines:["!USE_INSTANCING","USE_BATCHING"],format:11,location:12}],blocks:[],samplerTextures:[],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"post-process",techniques:[{passes:[{phase:"post-process",blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendSrcAlpha:2,blendDstAlpha:4}]},program:"post-process|post-process-vs|post-process-fs",depthStencilState:{depthTest:!1,depthWrite:!1}}]}],shaders:[{name:"post-process|post-process-vs|post-process-fs",hash:3237848814,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:147,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:39},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]}],samplerTextures:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]}],buffers:[],images:[]}},defines:[{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"USE_INSTANCING",type:"boolean"},{name:"ANTIALIAS_TYPE",type:"number",range:[0,3]}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_normal",defines:[],format:32,location:1},{name:"a_texCoord",defines:[],format:21,location:2},{name:"a_tangent",defines:[],format:44,location:3},{name:"a_vertexId",defines:["CC_USE_MORPH"],format:11,location:6},{name:"a_joints",defines:["CC_USE_SKINNING"],location:4},{name:"a_weights",defines:["CC_USE_SKINNING"],format:44,location:5},{name:"a_jointAnimInfo",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION","USE_INSTANCING"],format:44,isInstanced:!0,location:7}],blocks:[],samplerTextures:[{name:"outputResultMap",type:28,count:1,defines:[],stageFlags:16,binding:0}],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"skybox",techniques:[{passes:[{rasterizerState:{cullMode:0},program:"skybox|sky-vs:vert|sky-fs:frag",priority:245,depthStencilState:{depthTest:!0,depthWrite:!1}}]}],shaders:[{name:"skybox|sky-vs:vert|sky-fs:frag",hash:4277052359,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:39,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:39},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[{name:"cc_environment",defines:[]}],buffers:[],images:[]},locals:{blocks:[],samplerTextures:[],buffers:[],images:[]}},defines:[{name:"CC_USE_IBL",type:"number",range:[0,2]},{name:"CC_USE_HDR",type:"boolean"},{name:"USE_RGBE_CUBEMAP",type:"boolean"}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_normal",defines:[],format:32,location:1},{name:"a_texCoord",defines:[],format:21,location:2},{name:"a_tangent",defines:[],format:44,location:3}],blocks:[],samplerTextures:[],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"profiler",techniques:[{passes:[{blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},rasterizerState:{cullMode:0},program:"profiler|profiler-vs:vert|profiler-fs:frag",priority:255,depthStencilState:{depthTest:!1,depthWrite:!1}}]}],shaders:[{name:"profiler|profiler-vs:vert|profiler-fs:frag",hash:179162168,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:60,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:39},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[],samplerTextures:[],buffers:[],images:[]}},defines:[],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_color",defines:[],format:44,location:1}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:1,members:[{name:"offset",type:16,count:1}]},{name:"PerFrameInfo",defines:[],binding:1,stageFlags:1,members:[{name:"digits",type:16,count:20}]}],samplerTextures:[{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:2}],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"splash-screen",techniques:[{name:"default",passes:[{blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},rasterizerState:{cullMode:0},program:"splash-screen|splash-screen-vs:vert|splash-screen-fs:frag",depthStencilState:{depthTest:!1,depthWrite:!1},properties:{mainTexture:{value:"grey",type:28},resolution:{value:[640,960],type:14,handleInfo:["u_buffer0",0,14]},percent:{value:[.5],type:13,handleInfo:["u_percent",0,13]},scale:{value:[200,500],type:14,handleInfo:["u_buffer1",0,14]},translate:{value:[320,480],type:14,handleInfo:["u_buffer1",2,14]},u_buffer0:{type:16,value:[640,960,0,0]},u_percent:{type:13,value:[.5]},u_buffer1:{type:16,value:[200,500,320,480]}}}]}],shaders:[{name:"splash-screen|splash-screen-vs:vert|splash-screen-fs:frag",hash:3189094080,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:6,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:1},globals:{blocks:[],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[],samplerTextures:[],buffers:[],images:[]}},defines:[],attributes:[{name:"a_position",defines:[],format:21,location:0},{name:"a_texCoord",defines:[],format:21,location:1}],blocks:[{name:"Constant",defines:[],binding:0,stageFlags:1,members:[{name:"u_buffer0",type:16,count:1},{name:"u_buffer1",type:16,count:1},{name:"u_projection",type:25,count:1}]},{name:"Factor",defines:[],binding:1,stageFlags:16,members:[{name:"u_percent",type:13,count:1}]}],samplerTextures:[{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:2}],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]}]),cg=4227858432,lg=66060288,ug=1044480,hg=function(t,e,n,i){return void 0===i&&(i=0),e<<26&cg|t<<20&lg|n<<12&ug|4095&i},fg=function(t){return(t&cg)>>>26},_g=function(t){return(t&lg)>>>20},pg=function(t){return(t&ug)>>>12},dg=function(t){return 4095&t},mg=function(t,e){return 67108863&t|e<<26&cg},gg=((ag={})[Ar.UNKNOWN]=function(){return console.warn("illegal uniform handle")},ag[Ar.INT]=function(t,e,n){return void 0===n&&(n=0),t[n]},ag[Ar.INT2]=function(t,e,n){return void 0===n&&(n=0),Ni.fromArray(e,t,n)},ag[Ar.INT3]=function(t,e,n){return void 0===n&&(n=0),di.fromArray(e,t,n)},ag[Ar.INT4]=function(t,e,n){return void 0===n&&(n=0),zi.fromArray(e,t,n)},ag[Ar.FLOAT]=function(t,e,n){return void 0===n&&(n=0),t[n]},ag[Ar.FLOAT2]=function(t,e,n){return void 0===n&&(n=0),Ni.fromArray(e,t,n)},ag[Ar.FLOAT3]=function(t,e,n){return void 0===n&&(n=0),di.fromArray(e,t,n)},ag[Ar.FLOAT4]=function(t,e,n){return void 0===n&&(n=0),zi.fromArray(e,t,n)},ag[Ar.MAT3]=function(t,e,n){return void 0===n&&(n=0),yi.fromArray(e,t,n)},ag[Ar.MAT4]=function(t,e,n){return void 0===n&&(n=0),Ri.fromArray(e,t,n)},ag),vg=((og={})[Ar.UNKNOWN]=function(){return console.warn("illegal uniform handle")},og[Ar.INT]=function(t,e,n){return void 0===n&&(n=0),t[n]=e},og[Ar.INT2]=function(t,e,n){return void 0===n&&(n=0),Ni.toArray(t,e,n)},og[Ar.INT3]=function(t,e,n){return void 0===n&&(n=0),di.toArray(t,e,n)},og[Ar.INT4]=function(t,e,n){return void 0===n&&(n=0),zi.toArray(t,e,n)},og[Ar.FLOAT]=function(t,e,n){return void 0===n&&(n=0),t[n]=e},og[Ar.FLOAT2]=function(t,e,n){return void 0===n&&(n=0),Ni.toArray(t,e,n)},og[Ar.FLOAT3]=function(t,e,n){return void 0===n&&(n=0),di.toArray(t,e,n)},og[Ar.FLOAT4]=function(t,e,n){return void 0===n&&(n=0),zi.toArray(t,e,n)},og[Ar.MAT3]=function(t,e,n){return void 0===n&&(n=0),yi.toArray(t,e,n)},og[Ar.MAT4]=function(t,e,n){return void 0===n&&(n=0),Ri.toArray(t,e,n)},og),yg=[Object.freeze([0]),Object.freeze([0,0]),Object.freeze([0,0,0,0]),Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])];function xg(t){switch(t){case Ar.BOOL:case Ar.INT:case Ar.UINT:case Ar.FLOAT:return yg[0];case Ar.BOOL2:case Ar.INT2:case Ar.UINT2:case Ar.FLOAT2:return yg[1];case Ar.BOOL4:case Ar.INT4:case Ar.UINT4:case Ar.FLOAT4:return yg[2];case Ar.MAT4:return yg[3];case Ar.SAMPLER2D:return"default-texture";case Ar.SAMPLER_CUBE:return"default-cube-texture"}return yg[0]}function Sg(t,e){for(var n=Object.entries(e),i=!1,r=0;r<n.length;r++)t[n[r][0]]!==n[r][1]&&(t[n[r][0]]=n[r][1],i=!0);return i}var Tg=new Za;function Ag(t){return Math.ceil(Math.log2(Math.max(t,2)))}function Eg(t,e){switch(t.type){case"boolean":return"number"==typeof e?e.toString():e?"1":"0";case"string":return void 0!==e?e:t.options[0];case"number":return void 0!==e?e.toString():t.range[0].toString();default:return console.warn("unknown define type '"+t.type+"'"),"-1"}}function Cg(t,e,n,i,r){for(var a=t.builtins[i],o=[],s=function(t){var e=a.blocks[t],i=n.layouts[e.name],s=i&&n.bindings.find((function(t){return t.binding===i.binding}));if(!(i&&s&&s.descriptorType&uo))return console.warn("builtin UBO '"+e.name+"' not available!"),"continue";o.push(i),r&&!r.includes(s)&&r.push(s)},c=0;c<a.blocks.length;c++)s(c);Array.prototype.unshift.apply(e.shaderInfo.blocks,o);for(var l=[],u=function(t){var e=a.samplerTextures[t],i=n.layouts[e.name],o=i&&n.bindings.find((function(t){return t.binding===i.binding}));if(!(i&&o&&o.descriptorType&ho))return console.warn("builtin samplerTexture '"+e.name+"' not available!"),"continue";l.push(i),r&&!r.includes(o)&&r.push(o)},h=0;h<a.samplerTextures.length;h++)u(h);Array.prototype.unshift.apply(e.shaderInfo.samplerTextures,l),r&&r.sort((function(t,e){return t.binding-e.binding}))}function bg(t){return t.members.reduce((function(t,e){return t+vo(e.type)*e.count}),0)}function wg(t,e){for(var n=0;n<t.length;n++){var i=t[n];if("!"===i[0]){if(e[i.slice(1)])return!1}else if(!e[i])return!1}return!0}function Pg(t){switch(t.gfxAPI){case vr.GLES2:case vr.WEBGL:return"glsl1";case vr.GLES3:case vr.WEBGL2:return"glsl3";default:return"glsl4"}}var Ig=new(function(){function t(){this._templates={},this._cache={},this._templateInfos={}}var e=t.prototype;return e.register=function(t){for(var e=0;e<t.shaders.length;e++)this.define(t.shaders[e]).effectName=t.name;for(var n=0;n<t.techniques.length;n++)for(var i=t.techniques[n],r=0;r<i.passes.length;r++){var a=i.passes[r];void 0!==a.propertyIndex&&void 0===a.properties&&(a.properties=i.passes[a.propertyIndex].properties)}},e.define=function(t){var e=this._templates[t.name];if(e&&e.hash===t.hash)return e;for(var n=B({},t),i=0,r=function(t){var e=n.defines[t],r=1;if("number"===e.type){var a=e.range;r=Ag(a[1]-a[0]+1),e._map=function(t){return t-a[0]}}else"string"===e.type?(r=Ag(e.options.length),e._map=function(t){return Math.max(0,e.options.findIndex((function(e){return e===t})))}):"boolean"===e.type&&(e._map=function(t){return t?1:0});e._offset=i,i+=r},a=0;a<n.defines.length;a++)r(a);for(var o in i>31&&(n.uber=!0),n.constantMacros="",n.builtins.statistics)n.constantMacros+="#define "+o+" "+n.builtins.statistics[o]+"\n";if(this._templates[t.name]=n,!this._templateInfos[n.hash]){var s={};s.samplerStartBinding=n.blocks.length,s.shaderInfo=new ka,s.blockSizes=[],s.bindings=[];for(var c=0;c<n.blocks.length;c++){var l=n.blocks[c];s.blockSizes.push(bg(l)),s.bindings.push(new Qa(l.binding,Jr.UNIFORM_BUFFER,1,l.stageFlags)),s.shaderInfo.blocks.push(new Da(Xp.MATERIAL,l.binding,l.name,l.members.map((function(t){return new Ra(t.name,t.type,t.count)})),1))}for(var u=0;u<n.samplerTextures.length;u++){var h=n.samplerTextures[u];s.bindings.push(new Qa(h.binding,Jr.SAMPLER_TEXTURE,h.count,h.stageFlags)),s.shaderInfo.samplerTextures.push(new Oa(Xp.MATERIAL,h.binding,h.name,h.type,h.count))}for(var f=0;f<n.samplers.length;f++){var _=n.samplers[f];s.bindings.push(new Qa(_.binding,Jr.SAMPLER,_.count,_.stageFlags)),s.shaderInfo.samplers.push(new Ma(Xp.MATERIAL,_.binding,_.name,_.count))}for(var p=0;p<n.textures.length;p++){var d=n.textures[p];s.bindings.push(new Qa(d.binding,Jr.TEXTURE,d.count,d.stageFlags)),s.shaderInfo.textures.push(new Na(Xp.MATERIAL,d.binding,d.name,d.type,d.count))}for(var m=0;m<n.buffers.length;m++){var g=n.buffers[m];s.bindings.push(new Qa(g.binding,Jr.STORAGE_BUFFER,1,g.stageFlags)),s.shaderInfo.buffers.push(new Ba(Xp.MATERIAL,g.binding,g.name,1,g.memoryAccess))}for(var v=0;v<n.images.length;v++){var y=n.images[v];s.bindings.push(new Qa(y.binding,Jr.STORAGE_IMAGE,y.count,y.stageFlags)),s.shaderInfo.images.push(new La(Xp.MATERIAL,y.binding,y.name,y.type,y.count,y.memoryAccess))}for(var x=0;x<n.subpassInputs.length;x++){var S=n.subpassInputs[x];s.bindings.push(new Qa(S.binding,Jr.INPUT_ATTACHMENT,S.count,S.stageFlags)),s.shaderInfo.subpassInputs.push(new Fa(Xp.MATERIAL,S.binding,S.name,S.count))}s.gfxAttributes=[];for(var T=0;T<n.attributes.length;T++){var A=n.attributes[T];s.gfxAttributes.push(new Ua(A.name,A.format,A.isNormalized,0,A.isInstanced,A.location))}Cg(n,s,Hp,"locals"),s.shaderInfo.stages.push(new za(kr.VERTEX,"")),s.shaderInfo.stages.push(new za(kr.FRAGMENT,"")),s.handleMap=function(t){for(var e={},n=0;n<t.blocks.length;n++)for(var i=t.blocks[n],r=i.members,a=0,o=0;o<r.length;o++){var s=r[o];e[s.name]=hg(i.binding,s.type,s.count,a),a+=(vo(s.type)>>2)*s.count}for(var c=0;c<t.samplerTextures.length;c++){var l=t.samplerTextures[c];e[l.name]=hg(l.binding,l.type,l.count)}return e}(n),s.setLayouts=[],this._templateInfos[n.hash]=s}return n},e.getTemplate=function(t){return this._templates[t]},e.getTemplateInfo=function(t){var e=this._templates[t].hash;return this._templateInfos[e]},e.getDescriptorSetLayout=function(t,e,n){void 0===n&&(n=!1);var i=this._templates[e],r=this._templateInfos[i.hash];return r.setLayouts.length||(Tg.bindings=r.bindings,r.setLayouts[Xp.MATERIAL]=t.createDescriptorSetLayout(Tg),Tg.bindings=Hp.bindings,r.setLayouts[Xp.LOCAL]=t.createDescriptorSetLayout(Tg)),r.setLayouts[n?Xp.LOCAL:Xp.MATERIAL]},e.hasProgram=function(t){return void 0!==this._templates[t]},e.getKey=function(t,e){var n=this._templates[t],i=n.defines;if(n.uber){for(var r="",a=0;a<i.length;a++){var o=i[a],s=e[o.name];if(s&&o._map){var c=o._map(s);r+=""+o._offset+c+"|"}}return""+r+n.hash}for(var l=0,u=0;u<i.length;u++){var h=i[u],f=e[h.name];f&&h._map&&(l|=h._map(f)<<h._offset)}return l.toString(16)+"|"+n.hash},e.destroyShaderByDefines=function(t){var e=this,n=Object.keys(t);if(n.length)for(var i=n.map((function(e){var n=t[e];return"boolean"==typeof n&&(n=n?"1":"0"),new RegExp(""+e+n)})),r=Object.keys(this._cache).filter((function(t){return i.every((function(n){return n.test(e._cache[t].name)}))})),a=0;a<r.length;a++){var o=r[a],s=this._cache[o];g("destroyed shader "+s.name),s.destroy(),delete this._cache[o]}},e.getGFXShader=function(t,e,n,i,r){Object.assign(n,i.macros),r||(r=this.getKey(e,n));var a=this._cache[r];if(a)return a;var o=this._templates[e],s=this._templateInfos[o.hash];s.pipelineLayout||(this.getDescriptorSetLayout(t,e),Cg(o,s,Gp,"globals"),s.setLayouts[Xp.GLOBAL]=i.descriptorSetLayout,s.pipelineLayout=t.createPipelineLayout(new $a(s.setLayouts)));var c=function(t,e){for(var n=[],i=0;i<e.length;i++){var r=e[i],a=r.name,o=t[a],s=Eg(r,o),c=!o||"0"===o;n.push({name:a,value:s,isDefault:c})}return n}(n,o.defines),l=i.constantMacros+o.constantMacros+c.reduce((function(t,e){return t+"#define "+e.name+" "+e.value+"\n"}),""),u=o.glsl3,h=Pg(t);return h?u=o[h]:console.error("Invalid GFX API!"),s.shaderInfo.stages[0].source=l+u.vert,s.shaderInfo.stages[1].source=l+u.frag,s.shaderInfo.attributes=function(t,e,n){for(var i=[],r=t.attributes,a=e.gfxAttributes,o=0;o<r.length;o++)wg(r[o].defines,n)&&i.push(a[o]);return i}(o,s,n),s.shaderInfo.name=function(t,e){return t+e.reduce((function(t,e){return e.isDefault?t:t+"|"+e.name+e.value}),"")}(e,c),this._cache[r]=t.createShader(s.shaderInfo)},t}());i.programLib=Ig;var Rg,Dg,Og,Mg={glsl1:[[{vert:"\nprecision mediump float;\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matViewInv;\nuniform highp mat4 cc_matViewProj;\nuniform highp mat4 cc_matWorld;\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\nmat3 m = mat3(xAxis,yAxis,zAxis);\nfloat trace = m[0][0] + m[1][1] + m[2][2];\nvec4 quat;\nif (trace > 0.) {\nfloat s = 0.5 / sqrt(trace + 1.0);\nquat.w = 0.25 / s;\nquat.x = (m[2][1] - m[1][2]) * s;\nquat.y = (m[0][2] - m[2][0]) * s;\nquat.z = (m[1][0] - m[0][1]) * s;\n} else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\nfloat s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\nquat.w = (m[2][1] - m[1][2]) / s;\nquat.x = 0.25 * s;\nquat.y = (m[0][1] + m[1][0]) / s;\nquat.z = (m[0][2] + m[2][0]) / s;\n} else if (m[1][1] > m[2][2]) {\nfloat s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\nquat.w = (m[0][2] - m[2][0]) / s;\nquat.x = (m[0][1] + m[1][0]) / s;\nquat.y = 0.25 * s;\nquat.z = (m[1][2] + m[2][1]) / s;\n} else {\nfloat s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\nquat.w = (m[1][0] - m[0][1]) / s;\nquat.x = (m[0][2] + m[2][0]) / s;\nquat.y = (m[1][2] + m[2][1]) / s;\nquat.z = 0.25 * s;\n}\nfloat len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\nif (len > 0.) {\nlen = 1. / sqrt(len);\nquat.x = quat.x * len;\nquat.y = quat.y * len;\nquat.z = quat.z * len;\nquat.w = quat.w * len;\n}\nreturn quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\nfloat x = angle.x / 2.;\nfloat y = angle.y / 2.;\nfloat z = angle.z / 2.;\nfloat sx = sin(x);\nfloat cx = cos(x);\nfloat sy = sin(y);\nfloat cy = cos(y);\nfloat sz = sin(z);\nfloat cz = cos(z);\nvec4 quat = vec4(0);\nquat.x = sx * cy * cz + cx * sy * sz;\nquat.y = cx * sy * cz + sx * cy * sz;\nquat.z = cx * cy * sz - sx * sy * cz;\nquat.w = cx * cy * cz - sx * sy * sz;\nreturn quat;\n}\nvec4 quatMultiply (vec4 a, vec4 b){\nvec4 quat;\nquat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\nquat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\nquat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\nquat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\nreturn quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\nfloat ix = q.w * v.x + q.y * v.z - q.z * v.y;\nfloat iy = q.w * v.y + q.z * v.x - q.x * v.z;\nfloat iz = q.w * v.z + q.x * v.y - q.y * v.x;\nfloat iw = -q.x * v.x - q.y * v.y - q.z * v.z;\nv.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\nv.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\nv.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\nvec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\nvec4 rotQuat = quatMultiply(viewQuat, q);\nrotateVecFromQuat(pos, rotQuat);\nreturn pos;\n}\nvarying mediump vec2 uv;\nvarying mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n, mat4 viewInv\n) {\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\nvec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\nvec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n}\nattribute vec3 a_position;\nattribute vec2 a_texCoord;\nattribute vec4 a_color;\nuniform vec4 cc_size_rotation;\nvec4 vs_main() {\nvec4 pos = vec4(a_position, 1);\npos = cc_matWorld * pos;\nvec2 vertOffset = a_texCoord.xy - 0.5;\ncomputeVertPos(pos, vertOffset, quaternionFromEuler(vec3(0., 0., cc_size_rotation.z)), vec3(cc_size_rotation.xy, 0.), cc_matViewInv);\npos = cc_matViewProj * pos;\nuv = a_texCoord.xy;\ncolor = a_color;\nreturn pos;\n}\nvoid main() { gl_Position = vs_main(); }",frag:"\nprecision mediump float;\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nvarying vec2 uv;\nvarying vec4 color;\nuniform sampler2D mainTexture;\nuniform vec4 tintColor;\nvec4 add () {\nvec4 col = 2.0 * color * tintColor * texture2D(mainTexture, uv);\nreturn CCFragOutput(col);\n}\nvoid main() { gl_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nattribute vec3 a_position;\nvec4 vert () {\nvec4 pos = vec4(a_position, 1);\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 frag () {\nvec4 o = vec4(1.0);\nreturn o;\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nuniform highp mat4 cc_matViewProj;\nuniform highp mat4 cc_matWorld;\nattribute vec3 a_position;\nattribute vec4 a_color;\nvarying vec4 v_color;\nattribute float a_dist;\nvarying float v_dist;\nvec4 vert () {\nvec4 pos = vec4(a_position, 1);\npos = cc_matViewProj * cc_matWorld * pos;\nv_color = a_color;\nv_dist = a_dist;\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\n#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives: enable\n#endif\nprecision highp float;\nvarying vec4 v_color;\nvarying float v_dist;\nvec4 frag () {\nvec4 o = v_color;\n#ifdef GL_OES_standard_derivatives\nfloat aa = fwidth(v_dist);\n#else\nfloat aa = 0.05;\n#endif\nfloat alpha = 1. - smoothstep(-aa, 0., abs(v_dist) - 1.0);\no.rgb *= o.a;\no *= alpha;\nreturn o;\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nuniform highp mat4 cc_matViewProj;\nuniform highp vec4 cc_worldBoundCenter;\nuniform highp vec4 cc_worldBoundHalfExtents;\nattribute vec3 a_position;\nvec4 vert () {\nvec4 position;\nposition = vec4(a_position, 1.0);\nposition *= cc_worldBoundHalfExtents;\nposition += cc_worldBoundCenter;\nposition = cc_matViewProj * position;\nreturn position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nvec4 frag () {\nreturn vec4(1, 0, 0, 1);\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\nmat3 m = mat3(xAxis,yAxis,zAxis);\nfloat trace = m[0][0] + m[1][1] + m[2][2];\nvec4 quat;\nif (trace > 0.) {\nfloat s = 0.5 / sqrt(trace + 1.0);\nquat.w = 0.25 / s;\nquat.x = (m[2][1] - m[1][2]) * s;\nquat.y = (m[0][2] - m[2][0]) * s;\nquat.z = (m[1][0] - m[0][1]) * s;\n} else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\nfloat s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\nquat.w = (m[2][1] - m[1][2]) / s;\nquat.x = 0.25 * s;\nquat.y = (m[0][1] + m[1][0]) / s;\nquat.z = (m[0][2] + m[2][0]) / s;\n} else if (m[1][1] > m[2][2]) {\nfloat s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\nquat.w = (m[0][2] - m[2][0]) / s;\nquat.x = (m[0][1] + m[1][0]) / s;\nquat.y = 0.25 * s;\nquat.z = (m[1][2] + m[2][1]) / s;\n} else {\nfloat s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\nquat.w = (m[1][0] - m[0][1]) / s;\nquat.x = (m[0][2] + m[2][0]) / s;\nquat.y = (m[1][2] + m[2][1]) / s;\nquat.z = 0.25 * s;\n}\nfloat len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\nif (len > 0.) {\nlen = 1. / sqrt(len);\nquat.x = quat.x * len;\nquat.y = quat.y * len;\nquat.z = quat.z * len;\nquat.w = quat.w * len;\n}\nreturn quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\nfloat x = angle.x / 2.;\nfloat y = angle.y / 2.;\nfloat z = angle.z / 2.;\nfloat sx = sin(x);\nfloat cx = cos(x);\nfloat sy = sin(y);\nfloat cy = cos(y);\nfloat sz = sin(z);\nfloat cz = cos(z);\nvec4 quat = vec4(0);\nquat.x = sx * cy * cz + cx * sy * sz;\nquat.y = cx * sy * cz + sx * cy * sz;\nquat.z = cx * cy * sz - sx * sy * cz;\nquat.w = cx * cy * cz - sx * sy * sz;\nreturn quat;\n}\nmat4 matrixFromRT (vec4 q, vec3 p){\nfloat x2 = q.x + q.x;\nfloat y2 = q.y + q.y;\nfloat z2 = q.z + q.z;\nfloat xx = q.x * x2;\nfloat xy = q.x * y2;\nfloat xz = q.x * z2;\nfloat yy = q.y * y2;\nfloat yz = q.y * z2;\nfloat zz = q.z * z2;\nfloat wx = q.w * x2;\nfloat wy = q.w * y2;\nfloat wz = q.w * z2;\nreturn mat4(\n1. - (yy + zz), xy + wz, xz - wy, 0,\nxy - wz, 1. - (xx + zz), yz + wx, 0,\nxz + wy, yz - wx, 1. - (xx + yy), 0,\np.x, p.y, p.z, 1\n);\n}\nmat4 matFromRTS (vec4 q, vec3 t, vec3 s){\nfloat x = q.x, y = q.y, z = q.z, w = q.w;\nfloat x2 = x + x;\nfloat y2 = y + y;\nfloat z2 = z + z;\nfloat xx = x * x2;\nfloat xy = x * y2;\nfloat xz = x * z2;\nfloat yy = y * y2;\nfloat yz = y * z2;\nfloat zz = z * z2;\nfloat wx = w * x2;\nfloat wy = w * y2;\nfloat wz = w * z2;\nfloat sx = s.x;\nfloat sy = s.y;\nfloat sz = s.z;\nreturn mat4((1. - (yy + zz)) * sx, (xy + wz) * sx, (xz - wy) * sx, 0,\n(xy - wz) * sy, (1. - (xx + zz)) * sy, (yz + wx) * sy, 0,\n(xz + wy) * sz, (yz - wx) * sz, (1. - (xx + yy)) * sz, 0,\nt.x, t.y, t.z, 1);\n}\nvec4 quatMultiply (vec4 a, vec4 b){\nvec4 quat;\nquat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\nquat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\nquat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\nquat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\nreturn quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\nfloat ix = q.w * v.x + q.y * v.z - q.z * v.y;\nfloat iy = q.w * v.y + q.z * v.x - q.x * v.z;\nfloat iz = q.w * v.z + q.x * v.y - q.y * v.x;\nfloat iw = -q.x * v.x - q.y * v.y - q.z * v.z;\nv.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\nv.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\nv.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\nvec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\nvec4 rotQuat = quatMultiply(viewQuat, q);\nrotateVecFromQuat(pos, rotQuat);\nreturn pos;\n}\nmat3 quatToMat3(vec4 q) {\nvec3 m0 = vec3(\n1.0 - 2.0 * q.y * q.y - 2.0 * q.z * q.z,\n2.0 * q.x * q.y + 2.0 * q.w * q.z,\n2.0 * q.x * q.z - 2.0 * q.w * q.y);\nvec3 m1 = vec3(\n2.0 * q.x * q.y - 2.0 * q.w * q.z,\n1.0 - 2.0 * q.x * q.x - 2.0 * q.z * q.z,\n2.0 * q.y * q.z + 2.0 * q.w * q.x);\nvec3 m2 = vec3(\n2.0 * q.x * q.z + 2.0 * q.w * q.y,\n2.0 * q.y * q.z - 2.0 * q.w * q.x,\n1.0 - 2.0 * q.x * q.x - 2.0 * q.y * q.y);\nreturn mat3(m0, m1, m2);\n}\nvec4 mat3ToQuat(mat3 mat) {\nfloat tr = mat[0][0] + mat[1][1] + mat[2][2];\nfloat qw, qx, qy, qz;\nif (tr > 0.0) {\nfloat S = sqrt(tr + 1.0) * 2.0;\nfloat invS = 1.0 / S;\nqw = 0.25 * S;\nqx = (mat[1][2] - mat[2][1]) * invS;\nqy = (mat[2][0] - mat[0][2]) * invS;\nqz = (mat[0][1] - mat[1][0]) * invS;\n} else if ((mat[0][0] > mat[1][1])&&(mat[0][0] > mat[2][2])) {\nfloat S = sqrt(1.0 + mat[0][0] - mat[1][1] - mat[2][2]) * 2.0;\nfloat invS = 1.0 / S;\nqw = (mat[1][2] - mat[2][1]) * invS;\nqx = 0.25 * S;\nqy = (mat[1][0] + mat[0][1]) * invS;\nqz = (mat[2][0] + mat[0][2]) * invS;\n} else if (mat[1][1] > mat[2][2]) {\nfloat S = sqrt(1.0 + mat[1][1] - mat[0][0] - mat[2][2]) * 2.0;\nfloat invS = 1.0 / S;\nqw = (mat[2][0] - mat[0][2]) * invS;\nqx = (mat[1][0] + mat[0][1]) * invS;\nqy = 0.25 * S;\nqz = (mat[2][1] + mat[1][2]) * invS;\n} else {\nfloat S = sqrt(1.0 + mat[2][2] - mat[0][0] - mat[1][1]) * 2.0;\nfloat invS = 1.0 / S;\nqw = (mat[0][1] - mat[1][0]) * invS;\nqx = (mat[2][0] + mat[0][2]) * invS;\nqy = (mat[2][1] + mat[1][2]) * invS;\nqz = 0.25 * S;\n}\nreturn vec4(qx, qy, qz, qw);\n}\nvec4 eulerToQuat(vec3 euler) {\nvec3 er = euler * 0.5;\nfloat x = er.x, y = er.y, z = er.z;\nfloat sx = sin(x);\nfloat cx = cos(x);\nfloat sy = sin(y);\nfloat cy = cos(y);\nfloat sz = sin(z);\nfloat cz = cos(z);\nvec4 quat;\nquat.x = sx * cy * cz + cx * sy * sz;\nquat.y = cx * sy * cz + sx * cy * sz;\nquat.z = cx * cy * sz - sx * sy * cz;\nquat.w = cx * cy * cz - sx * sy * sz;\nreturn quat;\n}\nuniform vec4 mainTiling_Offset;\nuniform vec4 frameTile_velLenScale;\nuniform vec4 scale;\nuniform vec4 nodeRotation;\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matViewInv;\nuniform highp mat4 cc_matViewProj;\nuniform highp vec4 cc_cameraPos;\nuniform highp mat4 cc_matWorld;\nvarying mediump vec2 uv;\nvarying mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n, mat4 viewInv\n#endif\n#if CC_RENDER_MODE == 1\n, vec3 eye\n, vec4 velocity\n, float velocityScale\n, float lengthScale\n, float xIndex\n#endif\n) {\n#if CC_RENDER_MODE == 0\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\nvec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\nvec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n#elif CC_RENDER_MODE == 1\nvec3 camRight = normalize(cross(pos.xyz - eye, velocity.xyz)) * s.x;\nvec3 camUp = velocity.xyz * velocityScale + normalize(velocity.xyz) * lengthScale * s.y;\npos.xyz += (camRight * abs(vertOffset.x) * sign(vertOffset.y)) - camUp * xIndex;\n#elif CC_RENDER_MODE == 2\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = vec3(1, 0, 0);\nvec3 camY = vec3(0, 0, -1);\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, cross(camX, camY), q);\n#elif CC_RENDER_MODE == 3\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nrotateVecFromQuat(viewSpaceVert, q);\nvec3 camX = normalize(vec3(cc_matView[0][0], cc_matView[1][0], cc_matView[2][0]));\nvec3 camY = vec3(0, 1, 0);\nvec3 offset = camX * viewSpaceVert.x + camY * viewSpaceVert.y;\npos.xyz += offset;\n#else\npos.x += vertOffset.x;\npos.y += vertOffset.y;\n#endif\n}\nvec2 computeUV (float frameIndex, vec2 vertIndex, vec2 frameTile){\nvec2 aniUV = vec2(0, floor(frameIndex * frameTile.y));\naniUV.x = floor(frameIndex * frameTile.x * frameTile.y - aniUV.y * frameTile.x);\n#if CC_RENDER_MODE != 4\nvertIndex.y = 1. - vertIndex.y;\n#endif\nreturn (aniUV.xy + vertIndex) / vec2(frameTile.x, frameTile.y);\n}\nuniform vec4 u_sampleInfo;\nuniform vec4 u_worldRot;\nuniform vec4 u_timeDelta;\nattribute vec4 a_position_starttime;\nattribute vec4 a_size_uv;\nattribute vec4 a_rotation_uv;\nattribute vec4 a_color;\nattribute vec4 a_dir_life;\nattribute float a_rndSeed;\n#if CC_RENDER_MODE == 4\nattribute vec3 a_texCoord;\nattribute vec3 a_texCoord3;\nattribute vec3 a_normal;\nattribute vec4 a_color1;\n#endif\nvec3 unpackCurveData (sampler2D tex, vec2 coord) {\nvec4 a = texture2D(tex, coord);\nvec4 b = texture2D(tex, coord + u_sampleInfo.y);\nfloat c = fract(coord.x * u_sampleInfo.x);\nreturn mix(a.xyz, b.xyz, c);\n}\nvec3 unpackCurveData (sampler2D tex, vec2 coord, out float w) {\nvec4 a = texture2D(tex, coord);\nvec4 b = texture2D(tex, coord + u_sampleInfo.y);\nfloat c = fract(coord.x * u_sampleInfo.x);\nw = mix(a.w, b.w, c);\nreturn mix(a.xyz, b.xyz, c);\n}\nfloat pseudoRandom(float x) {\n#if USE_VK_SHADER\nfloat o = x;\nx = mod(x - 1.0, 2.0) - 1.0;\nfloat freqVar = 10.16640753482;\nfloat y = sin(freqVar * floor(o * 0.5 - 0.5));\nfloat v = max(0.0, 1.0-abs(x));\nv *= 0.7071067812;\nv = y < 0.0 ? -v : v;\nreturn v;\n#else\nfloat seed = mod(x, 233280.);\nfloat q = (seed * 9301. + 49297.) / 233280.;\nreturn fract(q);\n#endif\n}\n#if COLOR_OVER_TIME_MODULE_ENABLE\nuniform sampler2D color_over_time_tex0;\nuniform int u_color_mode;\n#endif\n#if ROTATION_OVER_TIME_MODULE_ENABLE\nuniform sampler2D rotation_over_time_tex0;\nuniform int u_rotation_mode;\n#endif\n#if SIZE_OVER_TIME_MODULE_ENABLE\nuniform sampler2D size_over_time_tex0;\nuniform int u_size_mode;\n#endif\n#if FORCE_OVER_TIME_MODULE_ENABLE\nuniform sampler2D force_over_time_tex0;\nuniform int u_force_mode;\nuniform int u_force_space;\n#endif\n#if VELOCITY_OVER_TIME_MODULE_ENABLE\nuniform sampler2D velocity_over_time_tex0;\nuniform int u_velocity_mode;\nuniform int u_velocity_space;\n#endif\n#if TEXTURE_ANIMATION_MODULE_ENABLE\nuniform sampler2D texture_animation_tex0;\nuniform vec4 u_anim_info;\n#endif\nfloat repeat (float t, float length) {\nreturn t - floor(t / length) * length;\n}\nvec4 rotateQuat (vec4 p, vec4 q) {\nvec3 iv = cross(q.xyz, p.xyz) + q.w * p.xyz;\nvec3 res = p.xyz + 2.0 * cross(q.xyz, iv);\nreturn vec4(res.xyz, p.w);\n}\nvec4 gpvs_main () {\nfloat activeTime = u_timeDelta.x - a_position_starttime.w;\nfloat normalizedTime = clamp(activeTime / a_dir_life.w, 0.0, 1.0);\nvec2 timeCoord0 = vec2(normalizedTime, 0.);\nvec2 timeCoord1 = vec2(normalizedTime, 1.);\n#if CC_RENDER_MODE == 4\nvec2 vertIdx = vec2(a_texCoord.x, a_texCoord.y);\n#else\nvec2 vertIdx = vec2(a_size_uv.w, a_rotation_uv.w);\n#endif\nvec4 velocity = vec4(a_dir_life.xyz, 0.);\nvec4 pos = vec4(a_position_starttime.xyz, 1.);\nvec3 size = a_size_uv.xyz;\n#if SIZE_OVER_TIME_MODULE_ENABLE\nif (u_size_mode == 1) {\nsize *= unpackCurveData(size_over_time_tex0, timeCoord0);\n} else {\nvec3 size_0 = unpackCurveData(size_over_time_tex0, timeCoord0);\nvec3 size_1 = unpackCurveData(size_over_time_tex0, timeCoord1);\nfloat factor_s = pseudoRandom(a_rndSeed + 39825.);\nsize *= mix(size_0, size_1, factor_s);\n}\n#endif\nvec3 compScale = scale.xyz * size;\n#if FORCE_OVER_TIME_MODULE_ENABLE\nvec3 forceAnim = vec3(0.);\nif (u_force_mode == 1) {\nforceAnim = unpackCurveData(force_over_time_tex0, timeCoord0);\n} else {\nvec3 force_0 = unpackCurveData(force_over_time_tex0, timeCoord0);\nvec3 force_1 = unpackCurveData(force_over_time_tex0, timeCoord1);\nfloat factor_f =  pseudoRandom(a_rndSeed + 212165.);\nforceAnim = mix(force_0, force_1, factor_f);\n}\nvec4 forceTrack = vec4(forceAnim, 0.);\nif (u_force_space == 0) {\nforceTrack = rotateQuat(forceTrack, u_worldRot);\n}\nvelocity.xyz += forceTrack.xyz;\n#endif\n#if VELOCITY_OVER_TIME_MODULE_ENABLE\nfloat speedModifier0 = 1.;\nfloat speedModifier1 = 1.;\nvec3 velocityAnim = vec3(0.);\nif (u_velocity_mode == 1) {\nvelocityAnim = unpackCurveData(velocity_over_time_tex0, timeCoord0, speedModifier0);\n} else {\nvec3 vectory_0 = unpackCurveData(velocity_over_time_tex0, timeCoord0, speedModifier0);\nvec3 vectory_1 = unpackCurveData(velocity_over_time_tex0, timeCoord1, speedModifier1);\nfloat factor_v = pseudoRandom(a_rndSeed + 197866.);\nvelocityAnim = mix(vectory_0, vectory_1, factor_v);\nspeedModifier0 = mix(speedModifier0, speedModifier1, factor_v);\n}\nvec4 velocityTrack = vec4(velocityAnim, 0.);\nif (u_velocity_space == 0) {\nvelocityTrack = rotateQuat(velocityTrack, u_worldRot);\n}\nvelocity.xyz += velocityTrack.xyz;\nvelocity.xyz *= speedModifier0;\n#endif\npos.xyz += velocity.xyz * normalizedTime * a_dir_life.w;\n#if !CC_USE_WORLD_SPACE\npos = cc_matWorld * pos;\n#if CC_RENDER_MODE == 1\nvelocity = rotateQuat(velocity, u_worldRot);\n#endif\n#endif\nvec3 startRotation = a_rotation_uv.xyz;\n#if CC_RENDER_MODE != 4\n#if CC_RENDER_MODE == 0\nvec3 rotEuler = startRotation.xyz;\n#elif CC_RENDER_MODE == 1\nvec3 rotEuler = vec3(0.);\n#else\nvec3 rotEuler = vec3(0., 0., startRotation.z);\n#endif\nvec4 rot = quaternionFromEuler(rotEuler);\n#else\nvec4 rot = quaternionFromEuler(startRotation);\n#endif\n#if ROTATION_OVER_TIME_MODULE_ENABLE\nif (u_rotation_mode == 1) {\nvec3 euler = unpackCurveData(rotation_over_time_tex0, timeCoord0) * normalizedTime * a_dir_life.w;\nvec4 quat = eulerToQuat(euler);\nmat3 mLocal = quatToMat3(quat);\nmat3 mStart = quatToMat3(rot);\nrot = mat3ToQuat(mStart * mLocal);\n} else {\nvec3 rotation_0 = unpackCurveData(rotation_over_time_tex0, timeCoord0);\nvec3 rotation_1 = unpackCurveData(rotation_over_time_tex0, timeCoord1);\nfloat factor_r = pseudoRandom(a_rndSeed + 125292.);\nvec3 euler = mix(rotation_0, rotation_1, factor_r) * normalizedTime * a_dir_life.w;\n#if CC_RENDER_MODE == 3 || CC_RENDER_MODE == 2\neuler = vec3(0.0, 0.0, euler.z);\n#endif\nvec4 quat = eulerToQuat(euler);\nmat3 mLocal = quatToMat3(quat);\nmat3 mStart = quatToMat3(rot);\nrot = mat3ToQuat(mStart * mLocal);\n}\n#endif\n#if COLOR_OVER_TIME_MODULE_ENABLE\nif (u_color_mode == 1) {\ncolor = a_color * texture2D(color_over_time_tex0, timeCoord0);\n} else {\nvec4 color_0 = texture2D(color_over_time_tex0, timeCoord0);\nvec4 color_1 = texture2D(color_over_time_tex0, timeCoord1);\nfloat factor_c = pseudoRandom(a_rndSeed + 91041.);\ncolor = a_color * mix(color_0, color_1, factor_c);\n}\n#else\ncolor = a_color;\n#endif\n#if CC_RENDER_MODE != 4\nvec2 cornerOffset = vec2((vertIdx - 0.5));\n#if CC_RENDER_MODE == 1\nrot = vec4(0.0, 0.0, 0.0, 1.0);\n#endif\ncomputeVertPos(pos, cornerOffset, rot, compScale\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n, cc_matViewInv\n#endif\n#if CC_RENDER_MODE == 1\n, cc_cameraPos.xyz\n, velocity\n, frameTile_velLenScale.z\n, frameTile_velLenScale.w\n, a_size_uv.w\n#endif\n);\n#else\nmat3 rotMat = quatToMat3(rot);\nmat3 nodeMat = quatToMat3(nodeRotation);\nrotMat = nodeMat * rotMat;\nrot = mat3ToQuat(rotMat);\nmat4 xformNoScale = matrixFromRT(rot, pos.xyz);\nmat4 xform = matFromRTS(rot, pos.xyz, compScale);\npos = xform * vec4(a_texCoord3, 1);\nvec4 normal = xformNoScale * vec4(a_normal, 0);\ncolor *= a_color1;\n#endif\npos = cc_matViewProj * pos;\nfloat frameIndex = 0.;\n#if TEXTURE_ANIMATION_MODULE_ENABLE\nfloat startFrame = 0.;\nvec3 frameInfo = vec3(0.);\nif (int(u_anim_info.x) == 1) {\nframeInfo = unpackCurveData(texture_animation_tex0, timeCoord0);\n} else {\nvec3 frameInfo0 = unpackCurveData(texture_animation_tex0, timeCoord0);\nvec3 frameInfo1 = unpackCurveData(texture_animation_tex0, timeCoord1);\nfloat factor_t = pseudoRandom(a_rndSeed + 90794.);\nframeInfo = mix(frameInfo0, frameInfo1, factor_t);\n}\nstartFrame = frameInfo.x / u_anim_info.y;\nframeIndex = repeat(u_anim_info.z * (frameInfo.y + startFrame), 1.);\n#endif\nuv = computeUV(frameIndex, vertIdx, frameTile_velLenScale.xy) * mainTiling_Offset.xy + mainTiling_Offset.zw;\nreturn pos;\n}\nvoid main() { gl_Position = gpvs_main(); }",frag:"\nprecision mediump float;\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nvarying vec2 uv;\nvarying vec4 color;\nuniform sampler2D mainTexture;\nuniform vec4 tintColor;\nvec4 add () {\nvec4 col = 2.0 * color * tintColor * texture2D(mainTexture, uv);\nreturn CCFragOutput(col);\n}\nvoid main() { gl_FragColor = add(); }"}],[{vert:"\nprecision mediump float;\nuniform vec4 mainTiling_Offset;\nuniform highp mat4 cc_matViewProj;\nuniform highp vec4 cc_cameraPos;\nuniform highp mat4 cc_matWorld;\nvarying mediump vec2 uv;\nvarying mediump vec4 color;\nattribute vec3 a_position;\nattribute vec4 a_texCoord;\nattribute vec3 a_texCoord1;\nattribute vec3 a_texCoord2;\nattribute vec4 a_color;\n#if CC_DRAW_WIRE_FRAME\nvarying vec3 vBarycentric;\n#endif\nvec4 vs_main() {\nhighp vec4 pos = vec4(a_position, 1);\nvec4 velocity = vec4(a_texCoord1.xyz, 0);\n#if !CC_USE_WORLD_SPACE\npos = cc_matWorld * pos;\nvelocity = cc_matWorld * velocity;\n#endif\nfloat vertOffset = (a_texCoord.x - 0.5) * a_texCoord.y;\nvec3 camUp = normalize(cross(pos.xyz - cc_cameraPos.xyz, velocity.xyz));\npos.xyz += camUp * vertOffset;\npos = cc_matViewProj * pos;\nuv = a_texCoord.zw * mainTiling_Offset.xy + mainTiling_Offset.zw;;\ncolor = a_color;\n#if CC_DRAW_WIRE_FRAME\nvBarycentric = a_texCoord2;\n#endif\nreturn pos;\n}\nvoid main() { gl_Position = vs_main(); }",frag:"\nprecision mediump float;\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nvarying vec2 uv;\nvarying vec4 color;\n#if CC_DRAW_WIRE_FRAME\nvarying vec3 vBarycentric;\n#endif\nuniform sampler2D mainTexture;\nuniform vec4 tintColor;\nvec4 add () {\nvec4 col = 2.0 * color * tintColor * texture2D(mainTexture, uv);\n#if CC_DRAW_WIRE_FRAME\nif (any(lessThan(vBarycentric, vec3(0.02)))) {\ncol = vec4(0., 1., 1., 1.);\n}\n#endif\nreturn CCFragOutput(col);\n}\nvoid main() { gl_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\nmat3 m = mat3(xAxis,yAxis,zAxis);\nfloat trace = m[0][0] + m[1][1] + m[2][2];\nvec4 quat;\nif (trace > 0.) {\nfloat s = 0.5 / sqrt(trace + 1.0);\nquat.w = 0.25 / s;\nquat.x = (m[2][1] - m[1][2]) * s;\nquat.y = (m[0][2] - m[2][0]) * s;\nquat.z = (m[1][0] - m[0][1]) * s;\n} else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\nfloat s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\nquat.w = (m[2][1] - m[1][2]) / s;\nquat.x = 0.25 * s;\nquat.y = (m[0][1] + m[1][0]) / s;\nquat.z = (m[0][2] + m[2][0]) / s;\n} else if (m[1][1] > m[2][2]) {\nfloat s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\nquat.w = (m[0][2] - m[2][0]) / s;\nquat.x = (m[0][1] + m[1][0]) / s;\nquat.y = 0.25 * s;\nquat.z = (m[1][2] + m[2][1]) / s;\n} else {\nfloat s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\nquat.w = (m[1][0] - m[0][1]) / s;\nquat.x = (m[0][2] + m[2][0]) / s;\nquat.y = (m[1][2] + m[2][1]) / s;\nquat.z = 0.25 * s;\n}\nfloat len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\nif (len > 0.) {\nlen = 1. / sqrt(len);\nquat.x = quat.x * len;\nquat.y = quat.y * len;\nquat.z = quat.z * len;\nquat.w = quat.w * len;\n}\nreturn quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\nfloat x = angle.x / 2.;\nfloat y = angle.y / 2.;\nfloat z = angle.z / 2.;\nfloat sx = sin(x);\nfloat cx = cos(x);\nfloat sy = sin(y);\nfloat cy = cos(y);\nfloat sz = sin(z);\nfloat cz = cos(z);\nvec4 quat = vec4(0);\nquat.x = sx * cy * cz + cx * sy * sz;\nquat.y = cx * sy * cz + sx * cy * sz;\nquat.z = cx * cy * sz - sx * sy * cz;\nquat.w = cx * cy * cz - sx * sy * sz;\nreturn quat;\n}\nmat4 matrixFromRT (vec4 q, vec3 p){\nfloat x2 = q.x + q.x;\nfloat y2 = q.y + q.y;\nfloat z2 = q.z + q.z;\nfloat xx = q.x * x2;\nfloat xy = q.x * y2;\nfloat xz = q.x * z2;\nfloat yy = q.y * y2;\nfloat yz = q.y * z2;\nfloat zz = q.z * z2;\nfloat wx = q.w * x2;\nfloat wy = q.w * y2;\nfloat wz = q.w * z2;\nreturn mat4(\n1. - (yy + zz), xy + wz, xz - wy, 0,\nxy - wz, 1. - (xx + zz), yz + wx, 0,\nxz + wy, yz - wx, 1. - (xx + yy), 0,\np.x, p.y, p.z, 1\n);\n}\nmat4 matFromRTS (vec4 q, vec3 t, vec3 s){\nfloat x = q.x, y = q.y, z = q.z, w = q.w;\nfloat x2 = x + x;\nfloat y2 = y + y;\nfloat z2 = z + z;\nfloat xx = x * x2;\nfloat xy = x * y2;\nfloat xz = x * z2;\nfloat yy = y * y2;\nfloat yz = y * z2;\nfloat zz = z * z2;\nfloat wx = w * x2;\nfloat wy = w * y2;\nfloat wz = w * z2;\nfloat sx = s.x;\nfloat sy = s.y;\nfloat sz = s.z;\nreturn mat4((1. - (yy + zz)) * sx, (xy + wz) * sx, (xz - wy) * sx, 0,\n(xy - wz) * sy, (1. - (xx + zz)) * sy, (yz + wx) * sy, 0,\n(xz + wy) * sz, (yz - wx) * sz, (1. - (xx + yy)) * sz, 0,\nt.x, t.y, t.z, 1);\n}\nvec4 quatMultiply (vec4 a, vec4 b){\nvec4 quat;\nquat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\nquat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\nquat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\nquat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\nreturn quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\nfloat ix = q.w * v.x + q.y * v.z - q.z * v.y;\nfloat iy = q.w * v.y + q.z * v.x - q.x * v.z;\nfloat iz = q.w * v.z + q.x * v.y - q.y * v.x;\nfloat iw = -q.x * v.x - q.y * v.y - q.z * v.z;\nv.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\nv.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\nv.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\nvec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\nvec4 rotQuat = quatMultiply(viewQuat, q);\nrotateVecFromQuat(pos, rotQuat);\nreturn pos;\n}\nmat3 quatToMat3(vec4 q) {\nvec3 m0 = vec3(\n1.0 - 2.0 * q.y * q.y - 2.0 * q.z * q.z,\n2.0 * q.x * q.y + 2.0 * q.w * q.z,\n2.0 * q.x * q.z - 2.0 * q.w * q.y);\nvec3 m1 = vec3(\n2.0 * q.x * q.y - 2.0 * q.w * q.z,\n1.0 - 2.0 * q.x * q.x - 2.0 * q.z * q.z,\n2.0 * q.y * q.z + 2.0 * q.w * q.x);\nvec3 m2 = vec3(\n2.0 * q.x * q.z + 2.0 * q.w * q.y,\n2.0 * q.y * q.z - 2.0 * q.w * q.x,\n1.0 - 2.0 * q.x * q.x - 2.0 * q.y * q.y);\nreturn mat3(m0, m1, m2);\n}\nvec4 mat3ToQuat(mat3 mat) {\nfloat tr = mat[0][0] + mat[1][1] + mat[2][2];\nfloat qw, qx, qy, qz;\nif (tr > 0.0) {\nfloat S = sqrt(tr + 1.0) * 2.0;\nfloat invS = 1.0 / S;\nqw = 0.25 * S;\nqx = (mat[1][2] - mat[2][1]) * invS;\nqy = (mat[2][0] - mat[0][2]) * invS;\nqz = (mat[0][1] - mat[1][0]) * invS;\n} else if ((mat[0][0] > mat[1][1])&&(mat[0][0] > mat[2][2])) {\nfloat S = sqrt(1.0 + mat[0][0] - mat[1][1] - mat[2][2]) * 2.0;\nfloat invS = 1.0 / S;\nqw = (mat[1][2] - mat[2][1]) * invS;\nqx = 0.25 * S;\nqy = (mat[1][0] + mat[0][1]) * invS;\nqz = (mat[2][0] + mat[0][2]) * invS;\n} else if (mat[1][1] > mat[2][2]) {\nfloat S = sqrt(1.0 + mat[1][1] - mat[0][0] - mat[2][2]) * 2.0;\nfloat invS = 1.0 / S;\nqw = (mat[2][0] - mat[0][2]) * invS;\nqx = (mat[1][0] + mat[0][1]) * invS;\nqy = 0.25 * S;\nqz = (mat[2][1] + mat[1][2]) * invS;\n} else {\nfloat S = sqrt(1.0 + mat[2][2] - mat[0][0] - mat[1][1]) * 2.0;\nfloat invS = 1.0 / S;\nqw = (mat[0][1] - mat[1][0]) * invS;\nqx = (mat[2][0] + mat[0][2]) * invS;\nqy = (mat[2][1] + mat[1][2]) * invS;\nqz = 0.25 * S;\n}\nreturn vec4(qx, qy, qz, qw);\n}\nuniform vec4 mainTiling_Offset;\nuniform vec4 frameTile_velLenScale;\nuniform vec4 scale;\nuniform vec4 nodeRotation;\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matViewInv;\nuniform highp mat4 cc_matViewProj;\nuniform highp vec4 cc_cameraPos;\nuniform highp mat4 cc_matWorld;\nvarying mediump vec2 uv;\nvarying mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n, mat4 viewInv\n#endif\n#if CC_RENDER_MODE == 1\n, vec3 eye\n, vec4 velocity\n, float velocityScale\n, float lengthScale\n, float xIndex\n#endif\n) {\n#if CC_RENDER_MODE == 0\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\nvec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\nvec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n#elif CC_RENDER_MODE == 1\nvec3 camRight = normalize(cross(pos.xyz - eye, velocity.xyz)) * s.x;\nvec3 camUp = velocity.xyz * velocityScale + normalize(velocity.xyz) * lengthScale * s.y;\npos.xyz += (camRight * abs(vertOffset.x) * sign(vertOffset.y)) - camUp * xIndex;\n#elif CC_RENDER_MODE == 2\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = vec3(1, 0, 0);\nvec3 camY = vec3(0, 0, -1);\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, cross(camX, camY), q);\n#elif CC_RENDER_MODE == 3\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nrotateVecFromQuat(viewSpaceVert, q);\nvec3 camX = normalize(vec3(cc_matView[0][0], cc_matView[1][0], cc_matView[2][0]));\nvec3 camY = vec3(0, 1, 0);\nvec3 offset = camX * viewSpaceVert.x + camY * viewSpaceVert.y;\npos.xyz += offset;\n#else\npos.x += vertOffset.x;\npos.y += vertOffset.y;\n#endif\n}\nvec2 computeUV (float frameIndex, vec2 vertIndex, vec2 frameTile){\nvec2 aniUV = vec2(0, floor(frameIndex * frameTile.y));\naniUV.x = floor(frameIndex * frameTile.x * frameTile.y - aniUV.y * frameTile.x);\n#if CC_RENDER_MODE != 4\nvertIndex.y = 1. - vertIndex.y;\n#endif\nreturn (aniUV.xy + vertIndex) / vec2(frameTile.x, frameTile.y);\n}\nattribute vec3 a_position;\nattribute vec3 a_texCoord;\nattribute vec3 a_texCoord1;\nattribute vec3 a_texCoord2;\nattribute vec4 a_color;\n#if CC_RENDER_MODE == 1\nattribute vec3 a_color1;\n#endif\n#if CC_RENDER_MODE == 4\nattribute vec3 a_texCoord3;\nattribute vec3 a_normal;\nattribute vec4 a_color1;\n#endif\nvec4 lpvs_main () {\nvec3 compScale = scale.xyz * a_texCoord1;\nvec4 pos = vec4(a_position, 1);\n#if CC_RENDER_MODE == 1\nvec4 velocity = vec4(a_color1.xyz, 0);\n#endif\n#if !CC_USE_WORLD_SPACE\npos = cc_matWorld * pos;\n#if CC_RENDER_MODE == 1\nvelocity = cc_matWorld * velocity;\n#endif\n#endif\n#if ROTATION_OVER_TIME_MODULE_ENABLE\nvec3 rotTmp = a_texCoord2;\nfloat mulFactor = 1.0;\nif (rotTmp.x > 10.0 * 0.5) {\nrotTmp.x -= 10.0;\nmulFactor = -1.0;\n}\nvec4 rot = vec4(rotTmp, 0.0);\nrot.w = mulFactor * sqrt(abs(1.0 - rot.x * rot.x - rot.y * rot.y - rot.z * rot.z));\n#else\n#if CC_RENDER_MODE != 4\n#if CC_RENDER_MODE == 0\nvec3 rotEuler = a_texCoord2;\n#elif CC_RENDER_MODE == 1\nvec3 rotEuler = vec3(0.);\n#else\nvec3 rotEuler = vec3(0., 0., a_texCoord2.z);\n#endif\nvec4 rot = quaternionFromEuler(rotEuler);\n#else\nvec4 rot = quaternionFromEuler(a_texCoord2);\n#endif\n#endif\n#if CC_RENDER_MODE != 4\nvec2 cornerOffset = vec2((a_texCoord.xy - 0.5));\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\ncomputeVertPos(pos, cornerOffset, rot, compScale, cc_matViewInv);\n#elif CC_RENDER_MODE == 1\ncomputeVertPos(pos, cornerOffset, rot, compScale, cc_cameraPos.xyz, velocity, frameTile_velLenScale.z, frameTile_velLenScale.w, a_texCoord.x);\n#elif 2\ncomputeVertPos(pos, cornerOffset, rot, compScale);\n#endif\ncolor = a_color;\n#else\nmat3 rotMat = quatToMat3(rot);\nmat3 nodeMat = quatToMat3(nodeRotation);\nrotMat = nodeMat * rotMat;\nrot = mat3ToQuat(rotMat);\nmat4 xformNoScale = matrixFromRT(rot, pos.xyz);\nmat4 xform = matFromRTS(rot, pos.xyz, compScale);\npos = xform * vec4(a_texCoord3, 1);\nvec4 normal = xformNoScale * vec4(a_normal, 0);\ncolor = a_color * a_color1;\n#endif\nuv = computeUV(a_texCoord.z, a_texCoord.xy, frameTile_velLenScale.xy) * mainTiling_Offset.xy + mainTiling_Offset.zw;\npos = cc_matViewProj * pos;\nreturn pos;\n}\nvoid main() { gl_Position = lpvs_main(); }",frag:"\nprecision mediump float;\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nvarying vec2 uv;\nvarying vec4 color;\nuniform sampler2D mainTexture;\nuniform vec4 tintColor;\nvec4 add () {\nvec4 col = 2.0 * color * tintColor * texture2D(mainTexture, uv);\nreturn CCFragOutput(col);\n}\nvoid main() { gl_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nuniform highp mat4 cc_matViewProj;\n#if USE_LOCAL\nuniform highp mat4 cc_matWorld;\n#endif\nattribute vec3 a_position;\nattribute vec2 a_texCoord;\nattribute vec4 a_color;\nvarying vec4 v_light;\nvarying vec2 uv0;\n#if TWO_COLORED\nattribute vec4 a_color2;\nvarying vec4 v_dark;\n#endif\nvec4 vert () {\nvec4 pos = vec4(a_position, 1);\n#if USE_LOCAL\npos = cc_matWorld * pos;\n#endif\npos = cc_matViewProj * pos;\nuv0 = a_texCoord;\nv_light = a_color;\n#if TWO_COLORED\nv_dark = a_color2;\n#endif\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\n#if USE_ALPHA_TEST\nuniform float alphaThreshold;\n#endif\nvoid ALPHA_TEST (in vec4 color) {\n#if USE_ALPHA_TEST\nif (color.a < alphaThreshold) discard;\n#endif\n}\nvoid ALPHA_TEST (in float alpha) {\n#if USE_ALPHA_TEST\nif (alpha < alphaThreshold) discard;\n#endif\n}\nvarying vec4 v_light;\n#if TWO_COLORED\nvarying vec4 v_dark;\n#endif\nvarying vec2 uv0;\nuniform sampler2D cc_spriteTexture;\nvec4 frag () {\nvec4 o = vec4(1, 1, 1, 1);\n#if TWO_COLORED\nvec4 texColor = vec4(1, 1, 1, 1);\ntexColor *= texture2D(cc_spriteTexture, uv0);\no.a = texColor.a * v_light.a;\no.rgb = ((texColor.a - 1.0) * v_dark.a + 1.0 - texColor.rgb) * v_dark.rgb + texColor.rgb * v_light.rgb;\n#else\no *= texture2D(cc_spriteTexture, uv0);\no *= v_light;\n#endif\nALPHA_TEST(o);\nreturn o;\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matProj;\nuniform highp mat4 cc_matViewProj;\nuniform highp vec4 cc_cameraPos;\n#if USE_LOCAL\nuniform highp mat4 cc_matWorld;\n#endif\n#if SAMPLE_FROM_RT\n#endif\nattribute vec3 a_position;\nattribute vec2 a_texCoord;\nattribute vec4 a_color;\nvarying vec4 color;\nvarying vec2 uv0;\nvec4 vert () {\nvec4 pos = vec4(a_position, 1);\n#if USE_LOCAL\npos = cc_matWorld * pos;\n#endif\n#if USE_PIXEL_ALIGNMENT\npos = cc_matView * pos;\npos.xyz = floor(pos.xyz);\npos = cc_matProj * pos;\n#else\npos = cc_matViewProj * pos;\n#endif\nuv0 = a_texCoord;\n#if SAMPLE_FROM_RT\nuv0 = cc_cameraPos.w > 1.0 ? vec2(uv0.x, 1.0 - uv0.y) : uv0;\n#endif\ncolor = a_color;\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 CCSampleWithAlphaSeparated(sampler2D tex, vec2 uv) {\n#if CC_USE_EMBEDDED_ALPHA\nreturn vec4(texture2D(tex, uv).rgb, texture2D(tex, uv + vec2(0.0, 0.5)).r);\n#else\nreturn texture2D(tex, uv);\n#endif\n}\n#if USE_ALPHA_TEST\nuniform float alphaThreshold;\n#endif\nvoid ALPHA_TEST (in vec4 color) {\n#if USE_ALPHA_TEST\nif (color.a < alphaThreshold) discard;\n#endif\n}\nvoid ALPHA_TEST (in float alpha) {\n#if USE_ALPHA_TEST\nif (alpha < alphaThreshold) discard;\n#endif\n}\nvarying vec4 color;\n#if USE_TEXTURE\nvarying vec2 uv0;\nuniform sampler2D cc_spriteTexture;\n#endif\nvec4 frag () {\nvec4 o = vec4(1, 1, 1, 1);\n#if USE_TEXTURE\no *= CCSampleWithAlphaSeparated(cc_spriteTexture, uv0);\n#if IS_GRAY\nfloat gray  = 0.2126 * o.r + 0.7152 * o.g + 0.0722 * o.b;\no.r = o.g = o.b = gray;\n#endif\n#endif\no *= color;\nALPHA_TEST(o);\nreturn o;\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_MORPH\nattribute float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\nuniform vec4 cc_displacementWeights[15];\nuniform vec4 cc_displacementTextureInfo;\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 uv = getPixelCoordFromLocation(location, cc_displacementTextureInfo.xy);\nreturn texture2D(tex, uv);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture2D(tex, x)),\ndecode32(texture2D(tex, y)),\ndecode32(texture2D(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nattribute vec4 a_joints;\nattribute vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nattribute highp vec4 a_jointAnimInfo;\n#endif\nuniform highp vec4 cc_jointTextureInfo;\nuniform highp vec4 cc_jointAnimInfo;\nuniform highp sampler2D cc_jointTexture;\n#else\nuniform highp vec4 cc_joints[90];\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matProj;\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_fogBase;\nuniform mediump vec4 cc_fogAdd;\n#if USE_INSTANCING\nattribute vec4 a_matWorld0;\nattribute vec4 a_matWorld1;\nattribute vec4 a_matWorld2;\n#if USE_LIGHTMAP\nattribute vec4 a_lightingMapUVParam;\n#endif\n#elif USE_BATCHING\nattribute float a_dyn_batch_id;\nuniform highp mat4 cc_matWorlds[10];\n#else\nuniform highp mat4 cc_matWorld;\nuniform highp mat4 cc_matWorldIT;\nuniform highp vec4 cc_lightingMapUVParam;\n#endif\nuniform vec4 tilingOffset;\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\n#if !CC_USE_ACCURATE_FOG\nvarying float v_fog_factor;\n#endif\nvoid CC_TRANSFER_FOG(vec4 pos) {\n#if !CC_USE_ACCURATE_FOG\nCC_TRANSFER_FOG_BASE(pos, v_fog_factor);\n#endif\n}\nvarying highp vec4 v_shadowPos;\nuniform highp mat4 cc_matLightViewProj;\n#if CC_RECEIVE_SHADOW\nuniform highp sampler2D cc_shadowMap;\nuniform highp sampler2D cc_spotLightingMap;\n#endif\n#if USE_VERTEX_COLOR\nattribute vec4 a_color;\nvarying vec4 v_color;\n#endif\nvarying vec3 v_position;\nvarying vec3 v_normal;\nvarying vec2 v_uv;\nvarying vec2 v_uv1;\n#if USE_NORMAL_MAP\nvarying vec3 v_tangent;\nvarying vec3 v_bitangent;\n#endif\n#if HAS_SECOND_UV || USE_LIGHTMAP\nattribute vec2 a_texCoord1;\n#endif\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nvarying vec3 v_luv;\nvoid CCLightingMapCaclUV()\n{\n#if !USE_INSTANCING\nv_luv.xy = cc_lightingMapUVParam.xy + a_texCoord1 * cc_lightingMapUVParam.zw;\nv_luv.z = cc_lightingMapUVParam.z;\n#else\nv_luv.xy = a_lightingMapUVParam.xy + a_texCoord1 * a_lightingMapUVParam.zw;\nv_luv.z = a_lightingMapUVParam.z;\n#endif\n}\n#endif\nvoid main () {\nStandardVertInput In;\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In);\n#endif\nmat4 matWorld, matWorldIT;\n#if USE_INSTANCING\nmatWorld = mat4(\nvec4(a_matWorld0.xyz, 0.0),\nvec4(a_matWorld1.xyz, 0.0),\nvec4(a_matWorld2.xyz, 0.0),\nvec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n);\nmatWorldIT = matWorld;\n#elif USE_BATCHING\nmatWorld = cc_matWorlds[int(a_dyn_batch_id)];\nmatWorldIT = matWorld;\n#else\nmatWorld = cc_matWorld;\nmatWorldIT = cc_matWorldIT;\n#endif\nvec4 pos = matWorld * In.position;\nv_position = pos.xyz;\nv_normal = normalize((matWorldIT * vec4(In.normal, 0.0)).xyz);\n#if USE_TWOSIDE\nvec3 viewDirect = normalize(cc_cameraPos.xyz - v_position);\nv_normal *= dot(v_normal, viewDirect) < 0.0 ? -1.0 : 1.0;\n#endif\n#if USE_NORMAL_MAP\nv_tangent = normalize((matWorld * vec4(In.tangent.xyz, 0.0)).xyz);\nv_bitangent = cross(v_normal, v_tangent) * In.tangent.w;\n#endif\nv_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n#if SAMPLE_FROM_RT\nv_uv = cc_cameraPos.w > 1.0 ? vec2(v_uv.x, 1.0 - v_uv.y) : v_uv;\n#endif\n#if HAS_SECOND_UV\nv_uv1 = a_texCoord1 * tilingOffset.xy + tilingOffset.zw;\n#if SAMPLE_FROM_RT\nv_uv1 = cc_cameraPos.w > 1.0 ? vec2(v_uv1.x, 1.0 - v_uv1.y) : v_uv1;\n#endif\n#endif\n#if USE_VERTEX_COLOR\nv_color = a_color;\n#endif\nCC_TRANSFER_FOG(pos);\nv_shadowPos = cc_matLightViewProj * pos;\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nCCLightingMapCaclUV();\n#endif\ngl_Position = cc_matProj * (cc_matView * matWorld) * In.position;\n}",frag:"\n#ifdef GL_EXT_draw_buffers\n#extension GL_EXT_draw_buffers: enable\n#endif\n#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives: enable\n#endif\n#ifdef GL_EXT_shader_texture_lod\n#extension GL_EXT_shader_texture_lod: enable\n#endif\nprecision highp float;\nuniform highp mat4 cc_matView;\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_mainLitDir;\nuniform mediump vec4 cc_mainLitColor;\nuniform mediump vec4 cc_ambientSky;\nuniform mediump vec4 cc_ambientGround;\nuniform mediump vec4 cc_fogColor;\nuniform mediump vec4 cc_fogBase;\nuniform mediump vec4 cc_fogAdd;\nuniform mediump vec4 cc_nearFar;\nuniform mediump vec4 cc_viewPort;\nuniform vec4 albedo;\nuniform vec4 albedoScaleAndCutoff;\nuniform vec4 pbrParams;\nuniform vec4 emissive;\nuniform vec4 emissiveScaleParam;\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\nvoid CC_APPLY_FOG_BASE(inout vec4 color, float factor) {\ncolor = vec4(mix(cc_fogColor.rgb, color.rgb, factor), color.a);\n}\n#if !CC_USE_ACCURATE_FOG\nvarying float v_fog_factor;\n#endif\nvoid CC_APPLY_FOG(inout vec4 color) {\n#if !CC_USE_ACCURATE_FOG\nCC_APPLY_FOG_BASE(color, v_fog_factor);\n#endif\n}\nvoid CC_APPLY_FOG(inout vec4 color, vec3 worldPos) {\n#if CC_USE_ACCURATE_FOG\nfloat factor;\nCC_TRANSFER_FOG_BASE(vec4(worldPos, 1.0), factor);\n#else\nfloat factor = v_fog_factor;\n#endif\nCC_APPLY_FOG_BASE(color, factor);\n}\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nuniform highp mat4 cc_matLightView;\nuniform highp vec4 cc_shadowInvProjDepthInfo;\nuniform highp vec4 cc_shadowProjDepthInfo;\nuniform highp vec4 cc_shadowProjInfo;\nuniform mediump vec4 cc_shadowNFLSInfo;\nuniform mediump vec4 cc_shadowWHPBInfo;\nuniform mediump vec4 cc_shadowLPNNInfo;\nhighp float unpackHighpData (float mainPart, float modPart) {\nhighp float data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out float mainPart, out float modPart, highp float data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp float unpackHighpData (float mainPart, float modPart, const float modValue) {\nhighp float data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out float mainPart, out float modPart, highp float data, const float modValue) {\nhighp float divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nhighp vec2 unpackHighpData (vec2 mainPart, vec2 modPart) {\nhighp vec2 data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out vec2 mainPart, out vec2 modPart, highp vec2 data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp vec2 unpackHighpData (vec2 mainPart, vec2 modPart, const float modValue) {\nhighp vec2 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out vec2 mainPart, out vec2 modPart, highp vec2 data, const float modValue) {\nhighp vec2 divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nhighp vec3 unpackHighpData (vec3 mainPart, vec3 modPart) {\nhighp vec3 data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out vec3 mainPart, out vec3 modPart, highp vec3 data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp vec3 unpackHighpData (vec3 mainPart, vec3 modPart, const float modValue) {\nhighp vec3 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out vec3 mainPart, out vec3 modPart, highp vec3 data, const float modValue) {\nhighp vec3 divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nhighp vec4 unpackHighpData (vec4 mainPart, vec4 modPart) {\nhighp vec4 data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out vec4 mainPart, out vec4 modPart, highp vec4 data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp vec4 unpackHighpData (vec4 mainPart, vec4 modPart, const float modValue) {\nhighp vec4 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out vec4 mainPart, out vec4 modPart, highp vec4 data, const float modValue) {\nhighp vec4 divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nfloat CCGetLinearDepthFromViewSpace(vec3 viewPos) {\nfloat dist = length(viewPos);\nreturn (dist - cc_shadowNFLSInfo.x) / (cc_shadowNFLSInfo.y - cc_shadowNFLSInfo.x);\n}\nfloat CCGetLinearDepth(vec3 worldPos) {\nvec4 viewStartPos = cc_matLightView * vec4(worldPos.xyz, 1.0);\nreturn CCGetLinearDepthFromViewSpace(viewStartPos.xyz);\n}\n#if CC_RECEIVE_SHADOW\nuniform highp sampler2D cc_shadowMap;\nuniform highp sampler2D cc_spotLightingMap;\nvec4 ApplyShadowDepthBias_FaceNormal(vec4 shadowPos, vec3 worldNormal)\n{\nvec4 newShadowPos = shadowPos;\nif(cc_shadowLPNNInfo.z > 0.0001)\n{\nvec4 viewNormal = cc_matLightView * vec4(worldNormal, 0.0);\nif(viewNormal.z < 0.1)\nnewShadowPos.xy += viewNormal.xy * cc_shadowProjInfo.xy * cc_shadowLPNNInfo.z * clamp(viewNormal.z, 0.001, 0.1);\n}\nreturn newShadowPos;\n}\nvec4 ApplyShadowDepthBias_Perspective(vec4 shadowPos, float viewspaceDepthBias)\n{\nvec3 viewSpacePos;\nviewSpacePos.xy = shadowPos.xy * cc_shadowProjInfo.zw;\nviewSpacePos.z = shadowPos.z * cc_shadowInvProjDepthInfo.x + shadowPos.w * cc_shadowInvProjDepthInfo.y;\nviewSpacePos.xyz += cc_shadowProjDepthInfo.z * normalize(viewSpacePos.xyz) * viewspaceDepthBias;\nvec4 clipSpacePos;\nclipSpacePos.xy = viewSpacePos.xy * cc_shadowProjInfo.xy;\nclipSpacePos.zw = viewSpacePos.z * cc_shadowProjDepthInfo.xz + vec2(cc_shadowProjDepthInfo.y, 0.0);\nif (cc_shadowNFLSInfo.z > 0.000001) {\nclipSpacePos.z = CCGetLinearDepthFromViewSpace(viewSpacePos.xyz);\nclipSpacePos.z = (clipSpacePos.z * 2.0 - 1.0) * clipSpacePos.w;\n}\nreturn clipSpacePos;\n}\nvec4 ApplyShadowDepthBias_Orthographic(vec4 shadowPos, float viewspaceDepthBias)\n{\nfloat coeffA = cc_shadowProjDepthInfo.x;\nfloat coeffB = cc_shadowProjDepthInfo.y;\nfloat viewSpacePos_z = (shadowPos.z - coeffB) / coeffA;\nviewSpacePos_z += viewspaceDepthBias;\nvec4 result = shadowPos;\nresult.z = viewSpacePos_z * coeffA + coeffB;\nreturn result;\n}\nfloat CCGetShadowFactorHard (vec4 shadowPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nclosestDepth = dot(texture2D(cc_shadowMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n} else {\nclosestDepth = texture2D(cc_shadowMap, clipPos.xy).x;\n}\nshadow = step(clipPos.z, closestDepth);\nreturn shadow;\n}\nfloat CCGetShadowFactorSoft (vec4 shadowPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat offsetDepth = clipPos.z;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nvec2 clipPos_offset = clipPos.xy + oneTap;\nfloat block0, block1, block2, block3;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x);\nblock1 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)).x);\nblock2 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)).x);\nblock3 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)).x);\n}\nfloat coefX   = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block2, block3, coefX);\nfloat coefY   = mod(clipPos.y, oneTap.y) * mapSize.y;\nreturn mix(resultX, resultY, coefY);\n}\nfloat CCGetShadowFactorSoft2X (vec4 shadowPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat offsetDepth = clipPos.z;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nfloat clipPos_offset_L = clipPos.x - oneTap.x;\nfloat clipPos_offset_R = clipPos.x + oneTap.x;\nfloat clipPos_offset_U = clipPos.y - oneTap.y;\nfloat clipPos_offset_D = clipPos.y + oneTap.y;\nfloat block0, block1, block2, block3, block4, block5, block6, block7, block8;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock4 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock5 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock6 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock7 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock8 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)).x);\nblock1 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)).x);\nblock2 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)).x);\nblock3 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)).x);\nblock4 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x);\nblock5 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)).x);\nblock6 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)).x);\nblock7 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)).x);\nblock8 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)).x);\n}\nfloat coefX = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat coefY = mod(clipPos.y, oneTap.y) * mapSize.y;\nfloat shadow = 0.0;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block3, block4, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block1, block2, coefX);\nresultY = mix(block4, block5, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block3, block4, coefX);\nresultY = mix(block6, block7, coefX);\nshadow += mix(resultX, resultY, coefY);\nresultX = mix(block4, block5, coefX);\nresultY = mix(block7, block8, coefX);\nshadow += mix(resultX, resultY, coefY);\nreturn shadow * 0.25;\n}\nfloat CCGetSpotLightShadowFactorHard (vec4 shadowPos, vec3 worldPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nfloat depth = clipPos.z;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nclosestDepth = dot(texture2D(cc_spotLightingMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n} else {\nclosestDepth = texture2D(cc_spotLightingMap, clipPos.xy).x;\n}\nshadow = step(depth, closestDepth);\nreturn shadow;\n}\nfloat CCGetSpotLightShadowFactorSoft (vec4 shadowPos, vec3 worldPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nfloat bias = cc_shadowWHPBInfo.w;\nvec2 oneTap = 1.0 / cc_shadowWHPBInfo.xy;\nvec2 clipPos_offset = clipPos.xy + oneTap;\nfloat block0, block1, block2, block3;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x);\nblock1 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos.y)).x);\nblock2 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset.y)).x);\nblock3 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos_offset.y)).x);\n}\nfloat coefX   = mod(clipPos.x, oneTap.x) * cc_shadowWHPBInfo.x;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block2, block3, coefX);\nfloat coefY   = mod(clipPos.y, oneTap.y) * cc_shadowWHPBInfo.y;\nreturn mix(resultX, resultY, coefY);\n}\nfloat CCGetSpotLightShadowFactorSoft2X (vec4 shadowPos, vec3 worldPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nfloat bias = cc_shadowWHPBInfo.w;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nfloat clipPos_offset_L = clipPos.x - oneTap.x;\nfloat clipPos_offset_R = clipPos.x + oneTap.x;\nfloat clipPos_offset_U = clipPos.y - oneTap.y;\nfloat clipPos_offset_D = clipPos.y + oneTap.y;\nfloat block0, block1, block2, block3, block4, block5, block6, block7, block8;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock4 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock5 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock6 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock7 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock8 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_U)).x);\nblock1 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_U)).x);\nblock2 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_U)).x);\nblock3 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos.y)).x);\nblock4 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x);\nblock5 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos.y)).x);\nblock6 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_D)).x);\nblock7 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_D)).x);\nblock8 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_D)).x);\n}\nfloat coefX = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat coefY = mod(clipPos.y, oneTap.y) * mapSize.y;\nfloat shadow = 0.0;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block3, block4, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block1, block2, coefX);\nresultY = mix(block4, block5, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block3, block4, coefX);\nresultY = mix(block6, block7, coefX);\nshadow += mix(resultX, resultY, coefY);\nresultX = mix(block4, block5, coefX);\nresultY = mix(block7, block8, coefX);\nshadow += mix(resultX, resultY, coefY);\nreturn shadow * 0.25;\n}\n#endif\n#if CC_USE_IBL\nuniform samplerCube cc_environment;\nvec4 fragTextureLod (sampler2D tex, vec2 coord, float lod) {\n#ifdef GL_EXT_shader_texture_lod\nreturn texture2DLodEXT(tex, coord, lod);\n#else\nreturn texture2D(tex, coord, lod);\n#endif\n}\nvec4 fragTextureLod (samplerCube tex, vec3 coord, float lod) {\n#ifdef GL_EXT_shader_texture_lod\nreturn textureCubeLodEXT(tex, coord, lod);\n#else\nreturn textureCube(tex, coord, lod);\n#endif\n}\nvec3 unpackRGBE (vec4 rgbe) {\nreturn rgbe.rgb * pow(1.1, rgbe.a * 255.0 - 128.0);\n}\n#if CC_USE_DIFFUSEMAP\nuniform samplerCube cc_diffuseMap;\n#endif\n#endif\nfloat GGXMobile (float roughness, float NoH, vec3 H, vec3 N) {\nvec3 NxH = cross(N, H);\nfloat OneMinusNoHSqr = dot(NxH, NxH);\nfloat a = roughness * roughness;\nfloat n = NoH * a;\nfloat p = a / (OneMinusNoHSqr + n * n);\nreturn p * p;\n}\nfloat CalcSpecular (float roughness, float NoH, vec3 H, vec3 N) {\nreturn (roughness * 0.25 + 0.25) * GGXMobile(roughness, NoH, H, N);\n}\nvec3 BRDFApprox (vec3 specular, float roughness, float NoV) {\nconst vec4 c0 = vec4(-1.0, -0.0275, -0.572, 0.022);\nconst vec4 c1 = vec4(1.0, 0.0425, 1.04, -0.04);\nvec4 r = roughness * c0 + c1;\nfloat a004 = min(r.x * r.x, exp2(-9.28 * NoV)) * r.x + r.y;\nvec2 AB = vec2(-1.04, 1.04) * a004 + r.zw;\nAB.y *= clamp(50.0 * specular.g, 0.0, 1.0);\nreturn specular * AB.x + AB.y;\n}\n#if USE_REFLECTION_DENOISE\nvec3 GetEnvReflectionWithMipFiltering(vec3 R, float roughness, float mipCount, float denoiseIntensity) {\n#if CC_USE_IBL\nfloat mip = roughness * mipCount;\nfloat delta = (dot(dFdx(R), dFdy(R))) * 1000.0;\nfloat mipBias = mix(0.0, 5.0, clamp(delta, 0.0, 1.0));\nvec4 biased = fragTextureLod(cc_environment, R, mip + mipBias);\nvec4 filtered = textureCube(cc_environment, R);\n#if CC_USE_IBL == 2\nbiased.rgb = unpackRGBE(biased);\nfiltered.rgb = unpackRGBE(filtered);\n#else\nbiased.rgb = SRGBToLinear(biased.rgb);\nfiltered.rgb = SRGBToLinear(filtered.rgb);\n#endif\nreturn mix(biased.rgb, filtered.rgb, denoiseIntensity);\n#else\nreturn vec3(0.0, 0.0, 0.0);\n#endif\n}\n#endif\nstruct StandardSurface {\nvec4 albedo;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nvec3 position, position_fract_part;\n#else\nvec3 position;\n#endif\nvec3 normal;\nvec3 emissive;\nvec3 lightmap;\nfloat lightmap_test;\nfloat roughness;\nfloat metallic;\nfloat occlusion;\n};\nvec4 CCStandardShadingBase (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.0);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 L = normalize(-cc_mainLitDir.xyz);\nvec3 H = normalize(L + V);\nfloat NH = max(dot(N, H), 0.0);\nfloat NL = max(dot(N, L), 0.0);\nvec3 finalColor = NL * cc_mainLitColor.rgb * cc_mainLitColor.w;\nvec3 diffuseContrib = diffuse;\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nif (s.lightmap_test > 0.0001) {\nfinalColor = s.lightmap.rgb;\n}\n#else\ndiffuseContrib /= 3.14159265359;\n#endif\nvec3 specularContrib = specular * CalcSpecular(s.roughness, NH, H, N);\nvec3 dirlightContrib = (diffuseContrib + specularContrib);\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (NL > 0.0 && cc_mainLitDir.w > 0.0) {\n{\nvec4 pos = ApplyShadowDepthBias_FaceNormal(shadowPos, N);\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) shadow = CCGetShadowFactorSoft2X(pos);\nelse if (pcf > 0.9) shadow = CCGetShadowFactorSoft(pos);\nelse shadow = CCGetShadowFactorHard(pos);\nshadow = mix(shadow, 1.0, cc_shadowNFLSInfo.w);\n}\n}\n#endif\ndirlightContrib *= shadow;\nfinalColor *= dirlightContrib;\nfloat fAmb = 0.5 - N.y * 0.5;\nvec3 ambDiff = mix(cc_ambientSky.rgb, cc_ambientGround.rgb, fAmb);\n#if CC_USE_IBL\n#if CC_USE_DIFFUSEMAP\nvec4 diffuseMap = textureCube(cc_diffuseMap, N);\n#if CC_USE_DIFFUSEMAP == 2\nambDiff = unpackRGBE(diffuseMap);\n#else\nambDiff = SRGBToLinear(diffuseMap.rgb);\n#endif\n#endif\nvec3 R = normalize(reflect(-V, N));\n#if USE_REFLECTION_DENOISE\nvec3 env = GetEnvReflectionWithMipFiltering(R, s.roughness, cc_ambientGround.w, 0.6);\n#else\nvec4 envmap = fragTextureLod(cc_environment, R, s.roughness * cc_ambientGround.w);\n#if CC_USE_IBL == 2\nvec3 env = unpackRGBE(envmap);\n#else\nvec3 env = SRGBToLinear(envmap.rgb);\n#endif\n#endif\nfinalColor += env * cc_ambientSky.w * specular * s.occlusion;\n#endif\nfinalColor += ambDiff.rgb * cc_ambientSky.w * diffuse * s.occlusion;\nfinalColor += s.emissive;\nreturn vec4(finalColor, s.albedo.a);\n}\nvec3 ACESToneMap (vec3 color) {\ncolor = min(color, vec3(8.0));\nconst float A = 2.51;\nconst float B = 0.03;\nconst float C = 2.43;\nconst float D = 0.59;\nconst float E = 0.14;\nreturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = ACESToneMap(color.rgb);\n#endif\ncolor.rgb = sqrt(color.rgb);\nreturn color;\n}\nvarying highp vec4 v_shadowPos;\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nvarying vec3 v_luv;\nuniform sampler2D cc_lightingMap;\nvec3 UnpackLightingmap(vec4 color) {\nvec3 c;\nfloat e = 1.0 + color.a * (8.0 - 1.0);\nc.r = color.r * e;\nc.g = color.g * e;\nc.b = color.b * e;\nreturn c;\n}\n#endif\nvarying vec3 v_position;\nvarying vec2 v_uv;\nvarying vec2 v_uv1;\nvarying vec3 v_normal;\n#if USE_VERTEX_COLOR\nvarying vec4 v_color;\n#endif\n#if USE_ALBEDO_MAP\nuniform sampler2D albedoMap;\n#endif\n#if USE_NORMAL_MAP\nvarying vec3 v_tangent;\nvarying vec3 v_bitangent;\nuniform sampler2D normalMap;\n#endif\n#if USE_PBR_MAP\nuniform sampler2D pbrMap;\n#endif\n#if USE_METALLIC_ROUGHNESS_MAP\nuniform sampler2D metallicRoughnessMap;\n#endif\n#if USE_OCCLUSION_MAP\nuniform sampler2D occlusionMap;\n#endif\n#if USE_EMISSIVE_MAP\nuniform sampler2D emissiveMap;\n#endif\n#if USE_ALPHA_TEST\n#endif\nvoid surf (out StandardSurface s) {\nvec4 baseColor = albedo;\n#if USE_VERTEX_COLOR\nbaseColor.rgb *= SRGBToLinear(v_color.rgb);\nbaseColor.a *= v_color.a;\n#endif\n#if USE_ALBEDO_MAP\nvec4 texColor = texture2D(albedoMap, ALBEDO_UV);\ntexColor.rgb = SRGBToLinear(texColor.rgb);\nbaseColor *= texColor;\n#endif\ns.albedo = baseColor;\ns.albedo.rgb *= albedoScaleAndCutoff.xyz;\n#if USE_ALPHA_TEST\nif (s.albedo.ALPHA_TEST_CHANNEL < albedoScaleAndCutoff.w) discard;\n#endif\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nvec4 lightColor = texture2D(cc_lightingMap, v_luv.xy);\ns.lightmap = UnpackLightingmap(lightColor);\ns.lightmap_test = v_luv.z;\n#endif\ns.normal = v_normal;\n#if USE_NORMAL_MAP\nvec3 nmmp = texture2D(normalMap, NORMAL_UV).xyz - vec3(0.5);\ns.normal =\n(nmmp.x * emissiveScaleParam.w) * normalize(v_tangent) +\n(nmmp.y * emissiveScaleParam.w) * normalize(v_bitangent) +\nnmmp.z * normalize(s.normal);\n#endif\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\npackHighpData(s.position, s.position_fract_part, v_position);\n#else\ns.position = v_position;\n#endif\nvec4 pbr = pbrParams;\n#if USE_PBR_MAP\nvec4 res = texture2D(pbrMap, PBR_UV);\npbr.x *= res.r;\npbr.y *= res.g;\npbr.z *= res.b;\npbr.w *= res.a;\n#endif\n#if USE_METALLIC_ROUGHNESS_MAP\nvec4 metallicRoughness = texture2D(metallicRoughnessMap, PBR_UV);\npbr.z *= metallicRoughness.b;\npbr.y *= metallicRoughness.g;\n#endif\n#if USE_OCCLUSION_MAP\npbr.x *= texture2D(occlusionMap, PBR_UV).r;\n#endif\ns.occlusion = pbr.x;\ns.roughness = pbr.y;\ns.metallic = pbr.z;\ns.emissive = emissive.rgb * emissiveScaleParam.xyz;\n#if USE_EMISSIVE_MAP\ns.emissive *= SRGBToLinear(texture2D(emissiveMap, EMISSIVE_UV).rgb);\n#endif\n}\n#if CC_FORWARD_ADD\n#if CC_PIPELINE_TYPE == 0\n# define LIGHTS_PER_PASS 1\n#else\n# define LIGHTS_PER_PASS 10\n#endif\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 0\nuniform highp vec4 cc_lightPos[LIGHTS_PER_PASS];\nuniform vec4 cc_lightColor[LIGHTS_PER_PASS];\nuniform vec4 cc_lightSizeRangeAngle[LIGHTS_PER_PASS];\nuniform vec4 cc_lightDir[LIGHTS_PER_PASS];\n#endif\nfloat SmoothDistAtt (float distSqr, float invSqrAttRadius) {\nfloat factor = distSqr * invSqrAttRadius;\nfloat smoothFactor = clamp(1.0 - factor * factor, 0.0, 1.0);\nreturn smoothFactor * smoothFactor;\n}\nfloat GetDistAtt (float distSqr, float invSqrAttRadius) {\nfloat attenuation = 1.0 / max(distSqr, 0.01*0.01);\nattenuation *= SmoothDistAtt(distSqr , invSqrAttRadius);\nreturn attenuation;\n}\nfloat GetAngleAtt (vec3 L, vec3 litDir, float litAngleScale, float litAngleOffset) {\nfloat cd = dot(litDir, L);\nfloat attenuation = clamp(cd * litAngleScale + litAngleOffset, 0.0, 1.0);\nreturn (attenuation * attenuation);\n}\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 0\nvec4 CCStandardShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / 3.14159265359;\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.0);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nint numLights = CC_PIPELINE_TYPE == 0 ? LIGHTS_PER_PASS : int(cc_lightDir[0].w);\nfor (int i = 0; i < LIGHTS_PER_PASS; i++) {\nif (i >= numLights) break;\nvec3 SLU = cc_lightPos[i].xyz - position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.0);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = cc_lightSizeRangeAngle[i].x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = 3.14159265359 * (litRadiusSqr / max(litRadiusSqr , distSqr));\nfloat attRadiusSqrInv = 1.0 / max(cc_lightSizeRangeAngle[i].y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (cc_lightPos[i].w > 0.0) {\nfloat cosInner = max(dot(-cc_lightDir[i].xyz, SL), 0.01);\nfloat cosOuter = cc_lightSizeRangeAngle[i].z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -cc_lightDir[i].xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = cc_lightColor[i].rgb;\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (cc_lightPos[i].w > 0.0 && cc_lightSizeRangeAngle[i].w > 0.0) {\n{\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) shadow = CCGetSpotLightShadowFactorSoft2X(shadowPos, position);\nelse if (pcf > 0.9) shadow = CCGetSpotLightShadowFactorSoft(shadowPos, position);\nelse shadow = CCGetSpotLightShadowFactorHard(shadowPos, position);\n}\n}\n#endif\nlightColor *= shadow;\nfinalColor += SNL * lightColor * cc_lightColor[i].w * illum * att * (diffuseContrib + lspec);\n}\nreturn vec4(finalColor, 0.0);\n}\n#endif\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 1\nreadonly buffer b_ccLightsBuffer { vec4 b_ccLights[]; };\nreadonly buffer b_clusterLightIndicesBuffer { uint b_clusterLightIndices[]; };\nreadonly buffer b_clusterLightGridBuffer { uvec4 b_clusterLightGrid[]; };\nstruct CCLight\n{\nvec4 cc_lightPos;\nvec4 cc_lightColor;\nvec4 cc_lightSizeRangeAngle;\nvec4 cc_lightDir;\n};\nstruct Cluster\n{\nvec3 minBounds;\nvec3 maxBounds;\n};\nstruct LightGrid\n{\nuint offset;\nuint ccLights;\n};\nCCLight getCCLight(uint i)\n{\nCCLight light;\nlight.cc_lightPos = b_ccLights[4u * i + 0u];\nlight.cc_lightColor = b_ccLights[4u * i + 1u];\nlight.cc_lightSizeRangeAngle = b_ccLights[4u * i + 2u];\nlight.cc_lightDir = b_ccLights[4u * i + 3u];\nreturn light;\n}\nLightGrid getLightGrid(uint cluster)\n{\nuvec4 gridvec = b_clusterLightGrid[cluster];\nLightGrid grid;\ngrid.offset = gridvec.x;\ngrid.ccLights = gridvec.y;\nreturn grid;\n}\nuint getGridLightIndex(uint start, uint offset)\n{\nreturn b_clusterLightIndices[start + offset];\n}\nuint getClusterZIndex(vec4 worldPos)\n{\nfloat scale = float(24) / log(cc_nearFar.y / cc_nearFar.x);\nfloat bias = -(float(24) * log(cc_nearFar.x) / log(cc_nearFar.y / cc_nearFar.x));\nfloat eyeDepth = -(cc_matView * worldPos).z;\nuint zIndex = uint(max(log(eyeDepth) * scale + bias, 0.0));\nreturn zIndex;\n}\nuint getClusterIndex(vec4 fragCoord, vec4 worldPos)\n{\nuint zIndex = getClusterZIndex(worldPos);\nfloat clusterSizeX = ceil(cc_viewPort.z / float(16));\nfloat clusterSizeY = ceil(cc_viewPort.w / float(8));\nuvec3 indices = uvec3(uvec2(fragCoord.xy / vec2(clusterSizeX, clusterSizeY)), zIndex);\nuint cluster = (16u * 8u) * indices.z + 16u * indices.y + indices.x;\nreturn cluster;\n}\nvec4 CCClusterShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / 3.14159265359;\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.001);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nuint cluster = getClusterIndex(gl_FragCoord, vec4(position, 1.0));\nLightGrid grid = getLightGrid(cluster);\nuint numLights = grid.ccLights;\nfor (uint i = 0u; i < 100u; i++) {\nif (i >= numLights) break;\nuint lightIndex = getGridLightIndex(grid.offset, i);\nCCLight light = getCCLight(lightIndex);\nvec3 SLU = light.cc_lightPos.xyz - position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.001);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = light.cc_lightSizeRangeAngle.x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = 3.14159265359 * (litRadiusSqr / max(litRadiusSqr , distSqr));\nfloat attRadiusSqrInv = 1.0 / max(light.cc_lightSizeRangeAngle.y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (light.cc_lightPos.w > 0.0) {\nfloat cosInner = max(dot(-light.cc_lightDir.xyz, SL), 0.01);\nfloat cosOuter = light.cc_lightSizeRangeAngle.z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -light.cc_lightDir.xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = light.cc_lightColor.rgb;\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (light.cc_lightPos.w > 0.0) {\n{\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) shadow = CCGetSpotLightShadowFactorSoft2X(shadowPos, position);\nelse if (pcf > 0.9) shadow = CCGetSpotLightShadowFactorSoft(shadowPos, position);\nelse shadow = CCGetSpotLightShadowFactorHard(shadowPos, position);\n}\n}\n#endif\nlightColor *= shadow;\nfinalColor += SNL * lightColor * light.cc_lightColor.w * illum * att * (diffuseContrib + lspec);\n}\nreturn vec4(finalColor, 0.0);\n}\n#endif\nvoid main () {\nStandardSurface s; surf(s);\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 1\nvec4 color = CCClusterShadingAdditive(s, v_shadowPos);\n#else\nvec4 color = CCStandardShadingAdditive(s, v_shadowPos);\n#endif\nCC_APPLY_FOG(color, s.position.xyz);\ngl_FragData[0] = CCFragOutput(color);\n}\n#elif (CC_PIPELINE_TYPE == 0 || CC_FORCE_FORWARD_SHADING)\nvoid main () {\nStandardSurface s; surf(s);\nvec4 color = CCStandardShadingBase(s, v_shadowPos);\nCC_APPLY_FOG(color, s.position.xyz);\ngl_FragData[0] = CCFragOutput(color);\n}\n#elif CC_PIPELINE_TYPE == 1\nvec2 signNotZero(vec2 v) {\nreturn vec2((v.x >= 0.0) ? +1.0 : -1.0, (v.y >= 0.0) ? +1.0 : -1.0);\n}\nvec2 float32x3_to_oct(in vec3 v) {\nvec2 p = v.xy * (1.0 / (abs(v.x) + abs(v.y) + abs(v.z)));\nreturn (v.z <= 0.0) ? ((1.0 - abs(p.yx)) * signNotZero(p)) : p;\n}\nvoid main () {\nStandardSurface s; surf(s);\ngl_FragData[0] = s.albedo;\ngl_FragData[1] = vec4(float32x3_to_oct(s.normal), s.roughness, s.metallic);\ngl_FragData[2] = vec4(s.emissive, s.occlusion);\n}\n#endif"},{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_MORPH\nattribute float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\nuniform vec4 cc_displacementWeights[15];\nuniform vec4 cc_displacementTextureInfo;\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 uv = getPixelCoordFromLocation(location, cc_displacementTextureInfo.xy);\nreturn texture2D(tex, uv);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture2D(tex, x)),\ndecode32(texture2D(tex, y)),\ndecode32(texture2D(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nattribute vec4 a_joints;\nattribute vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nattribute highp vec4 a_jointAnimInfo;\n#endif\nuniform highp vec4 cc_jointTextureInfo;\nuniform highp vec4 cc_jointAnimInfo;\nuniform highp sampler2D cc_jointTexture;\n#else\nuniform highp vec4 cc_joints[90];\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\n#if USE_INSTANCING\nattribute vec4 a_matWorld0;\nattribute vec4 a_matWorld1;\nattribute vec4 a_matWorld2;\n#if USE_LIGHTMAP\nattribute vec4 a_lightingMapUVParam;\n#endif\n#elif USE_BATCHING\nattribute float a_dyn_batch_id;\nuniform highp mat4 cc_matWorlds[10];\n#else\nuniform highp mat4 cc_matWorld;\nuniform highp mat4 cc_matWorldIT;\n#endif\nuniform vec4 tilingOffset;\nuniform highp mat4 cc_matLightViewProj;\n#if HAS_SECOND_UV || USE_LIGHTMAP\nattribute vec2 a_texCoord1;\n#endif\nvarying vec2 v_uv;\nvarying vec2 v_uv1;\nvarying vec4 v_worldPos;\nvarying float v_clip_depth;\nvec4 vert () {\nStandardVertInput In;\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In);\n#endif\nmat4 matWorld, matWorldIT;\n#if USE_INSTANCING\nmatWorld = mat4(\nvec4(a_matWorld0.xyz, 0.0),\nvec4(a_matWorld1.xyz, 0.0),\nvec4(a_matWorld2.xyz, 0.0),\nvec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n);\nmatWorldIT = matWorld;\n#elif USE_BATCHING\nmatWorld = cc_matWorlds[int(a_dyn_batch_id)];\nmatWorldIT = matWorld;\n#else\nmatWorld = cc_matWorld;\nmatWorldIT = cc_matWorldIT;\n#endif\nv_worldPos = matWorld * In.position;\nvec4 clipPos = cc_matLightViewProj * v_worldPos;\nv_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n#if HAS_SECOND_UV\nv_uv1 = a_texCoord1 * tilingOffset.xy + tilingOffset.zw;\n#endif\nv_clip_depth = clipPos.z / clipPos.w * 0.5 + 0.5;\nreturn clipPos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nuniform vec4 albedo;\nuniform vec4 albedoScaleAndCutoff;\nvec4 packDepthToRGBA (float depth) {\nvec4 ret = vec4(1.0, 255.0, 65025.0, 16581375.0) * depth;\nret = fract(ret);\nret -= vec4(ret.yzw, 0.0) / 255.0;\nreturn ret;\n}\nuniform highp mat4 cc_matLightView;\nuniform mediump vec4 cc_shadowNFLSInfo;\nuniform mediump vec4 cc_shadowLPNNInfo;\nfloat CCGetLinearDepthFromViewSpace(vec3 viewPos) {\nfloat dist = length(viewPos);\nreturn (dist - cc_shadowNFLSInfo.x) / (cc_shadowNFLSInfo.y - cc_shadowNFLSInfo.x);\n}\nfloat CCGetLinearDepth(vec3 worldPos) {\nvec4 viewStartPos = cc_matLightView * vec4(worldPos.xyz, 1.0);\nreturn CCGetLinearDepthFromViewSpace(viewStartPos.xyz);\n}\n#if CC_RECEIVE_SHADOW\nuniform highp sampler2D cc_shadowMap;\nuniform highp sampler2D cc_spotLightingMap;\n#endif\nvarying vec2 v_uv;\nvarying vec2 v_uv1;\nvarying vec4 v_worldPos;\nvarying float v_clip_depth;\n#if USE_ALBEDO_MAP\nuniform sampler2D albedoMap;\n#endif\n#if USE_ALPHA_TEST\n#endif\nvec4 frag () {\nvec4 baseColor = albedo;\n#if USE_ALBEDO_MAP\nbaseColor *= texture2D(albedoMap, ALBEDO_UV);\n#endif\n#if USE_ALPHA_TEST\nif (baseColor.ALPHA_TEST_CHANNEL < albedoScaleAndCutoff.w) discard;\n#endif\nif(cc_shadowLPNNInfo.x > 0.000001 && cc_shadowLPNNInfo.x < 1.999999) {\nif (cc_shadowNFLSInfo.z > 0.000001) {\nreturn vec4(CCGetLinearDepth(v_worldPos.xyz), 1.0, 1.0, 1.0);\n}\n}\nif (cc_shadowLPNNInfo.y > 0.000001) {\nreturn packDepthToRGBA(v_clip_depth);\n}\nreturn vec4(v_clip_depth, 1.0, 1.0, 1.0);\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nuniform highp mat4 cc_matViewProj;\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_fogBase;\nuniform mediump vec4 cc_fogAdd;\nuniform highp mat4 cc_matWorld;\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\n#if !CC_USE_ACCURATE_FOG\nvarying float v_fog_factor;\n#endif\nvoid CC_TRANSFER_FOG(vec4 pos) {\n#if !CC_USE_ACCURATE_FOG\nCC_TRANSFER_FOG_BASE(pos, v_fog_factor);\n#endif\n}\nvarying highp vec4 v_shadowPos;\nuniform highp mat4 cc_matLightViewProj;\n#if CC_RECEIVE_SHADOW\nuniform highp sampler2D cc_shadowMap;\nuniform highp sampler2D cc_spotLightingMap;\n#endif\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nvarying highp vec3 v_position;\nvarying mediump vec3 v_normal;\n#if USE_NORMALMAP\nvarying mediump vec3 v_tangent;\nvarying mediump vec3 v_binormal;\n#endif\nvarying mediump vec2 uvw;\nvarying mediump vec2 uv0;\nvarying mediump vec2 uv1;\nvarying mediump vec2 uv2;\nvarying mediump vec2 uv3;\nvarying mediump vec3 luv;\nvarying mediump vec3 diffuse;\nuniform vec4 UVScale;\nuniform vec4 lightMapUVParam;\nvoid main () {\nvec3 worldPos;\nworldPos.x = cc_matWorld[3][0] + a_position.x;\nworldPos.y = cc_matWorld[3][1] + a_position.y;\nworldPos.z = cc_matWorld[3][2] + a_position.z;\nvec4 pos = vec4(worldPos, 1.0);\npos = cc_matViewProj * pos;\nuvw = a_texCoord;\nuv0 = a_position.xz * UVScale.x;\nuv1 = a_position.xz * UVScale.y;\nuv2 = a_position.xz * UVScale.z;\nuv3 = a_position.xz * UVScale.w;\n#if USE_LIGHTMAP\nluv.xy = lightMapUVParam.xy + a_texCoord * lightMapUVParam.zw;\nluv.z = lightMapUVParam.z;\n#endif\nv_position = worldPos;\nv_normal = a_normal;\nCC_TRANSFER_FOG(vec4(worldPos, 1.0));\n#if USE_NORMALMAP\nv_tangent = vec3(1.0, 0.0, 0.0);\nv_binormal = vec3(0.0, 0.0, 1.0);\nv_binormal = cross(v_tangent, a_normal);\nv_tangent = cross(a_normal, v_binormal);\n#endif\nv_shadowPos = cc_matLightViewProj * vec4(worldPos, 1.0);\ngl_Position = pos;\n}",frag:"\n#ifdef GL_EXT_draw_buffers\n#extension GL_EXT_draw_buffers: enable\n#endif\n#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives: enable\n#endif\n#ifdef GL_EXT_shader_texture_lod\n#extension GL_EXT_shader_texture_lod: enable\n#endif\nprecision highp float;\nuniform highp mat4 cc_matView;\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_mainLitDir;\nuniform mediump vec4 cc_mainLitColor;\nuniform mediump vec4 cc_ambientSky;\nuniform mediump vec4 cc_ambientGround;\nuniform mediump vec4 cc_fogColor;\nuniform mediump vec4 cc_fogBase;\nuniform mediump vec4 cc_fogAdd;\nuniform mediump vec4 cc_nearFar;\nuniform mediump vec4 cc_viewPort;\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nuniform highp mat4 cc_matLightView;\nuniform highp vec4 cc_shadowInvProjDepthInfo;\nuniform highp vec4 cc_shadowProjDepthInfo;\nuniform highp vec4 cc_shadowProjInfo;\nuniform mediump vec4 cc_shadowNFLSInfo;\nuniform mediump vec4 cc_shadowWHPBInfo;\nuniform mediump vec4 cc_shadowLPNNInfo;\nhighp float unpackHighpData (float mainPart, float modPart) {\nhighp float data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out float mainPart, out float modPart, highp float data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp float unpackHighpData (float mainPart, float modPart, const float modValue) {\nhighp float data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out float mainPart, out float modPart, highp float data, const float modValue) {\nhighp float divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nhighp vec2 unpackHighpData (vec2 mainPart, vec2 modPart) {\nhighp vec2 data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out vec2 mainPart, out vec2 modPart, highp vec2 data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp vec2 unpackHighpData (vec2 mainPart, vec2 modPart, const float modValue) {\nhighp vec2 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out vec2 mainPart, out vec2 modPart, highp vec2 data, const float modValue) {\nhighp vec2 divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nhighp vec3 unpackHighpData (vec3 mainPart, vec3 modPart) {\nhighp vec3 data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out vec3 mainPart, out vec3 modPart, highp vec3 data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp vec3 unpackHighpData (vec3 mainPart, vec3 modPart, const float modValue) {\nhighp vec3 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out vec3 mainPart, out vec3 modPart, highp vec3 data, const float modValue) {\nhighp vec3 divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nhighp vec4 unpackHighpData (vec4 mainPart, vec4 modPart) {\nhighp vec4 data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out vec4 mainPart, out vec4 modPart, highp vec4 data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp vec4 unpackHighpData (vec4 mainPart, vec4 modPart, const float modValue) {\nhighp vec4 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out vec4 mainPart, out vec4 modPart, highp vec4 data, const float modValue) {\nhighp vec4 divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nfloat CCGetLinearDepthFromViewSpace(vec3 viewPos) {\nfloat dist = length(viewPos);\nreturn (dist - cc_shadowNFLSInfo.x) / (cc_shadowNFLSInfo.y - cc_shadowNFLSInfo.x);\n}\nfloat CCGetLinearDepth(vec3 worldPos) {\nvec4 viewStartPos = cc_matLightView * vec4(worldPos.xyz, 1.0);\nreturn CCGetLinearDepthFromViewSpace(viewStartPos.xyz);\n}\n#if CC_RECEIVE_SHADOW\nuniform highp sampler2D cc_shadowMap;\nuniform highp sampler2D cc_spotLightingMap;\nvec4 ApplyShadowDepthBias_FaceNormal(vec4 shadowPos, vec3 worldNormal)\n{\nvec4 newShadowPos = shadowPos;\nif(cc_shadowLPNNInfo.z > 0.0001)\n{\nvec4 viewNormal = cc_matLightView * vec4(worldNormal, 0.0);\nif(viewNormal.z < 0.1)\nnewShadowPos.xy += viewNormal.xy * cc_shadowProjInfo.xy * cc_shadowLPNNInfo.z * clamp(viewNormal.z, 0.001, 0.1);\n}\nreturn newShadowPos;\n}\nvec4 ApplyShadowDepthBias_Perspective(vec4 shadowPos, float viewspaceDepthBias)\n{\nvec3 viewSpacePos;\nviewSpacePos.xy = shadowPos.xy * cc_shadowProjInfo.zw;\nviewSpacePos.z = shadowPos.z * cc_shadowInvProjDepthInfo.x + shadowPos.w * cc_shadowInvProjDepthInfo.y;\nviewSpacePos.xyz += cc_shadowProjDepthInfo.z * normalize(viewSpacePos.xyz) * viewspaceDepthBias;\nvec4 clipSpacePos;\nclipSpacePos.xy = viewSpacePos.xy * cc_shadowProjInfo.xy;\nclipSpacePos.zw = viewSpacePos.z * cc_shadowProjDepthInfo.xz + vec2(cc_shadowProjDepthInfo.y, 0.0);\nif (cc_shadowNFLSInfo.z > 0.000001) {\nclipSpacePos.z = CCGetLinearDepthFromViewSpace(viewSpacePos.xyz);\nclipSpacePos.z = (clipSpacePos.z * 2.0 - 1.0) * clipSpacePos.w;\n}\nreturn clipSpacePos;\n}\nvec4 ApplyShadowDepthBias_Orthographic(vec4 shadowPos, float viewspaceDepthBias)\n{\nfloat coeffA = cc_shadowProjDepthInfo.x;\nfloat coeffB = cc_shadowProjDepthInfo.y;\nfloat viewSpacePos_z = (shadowPos.z - coeffB) / coeffA;\nviewSpacePos_z += viewspaceDepthBias;\nvec4 result = shadowPos;\nresult.z = viewSpacePos_z * coeffA + coeffB;\nreturn result;\n}\nfloat CCGetShadowFactorHard (vec4 shadowPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nclosestDepth = dot(texture2D(cc_shadowMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n} else {\nclosestDepth = texture2D(cc_shadowMap, clipPos.xy).x;\n}\nshadow = step(clipPos.z, closestDepth);\nreturn shadow;\n}\nfloat CCGetShadowFactorSoft (vec4 shadowPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat offsetDepth = clipPos.z;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nvec2 clipPos_offset = clipPos.xy + oneTap;\nfloat block0, block1, block2, block3;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x);\nblock1 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)).x);\nblock2 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)).x);\nblock3 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)).x);\n}\nfloat coefX   = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block2, block3, coefX);\nfloat coefY   = mod(clipPos.y, oneTap.y) * mapSize.y;\nreturn mix(resultX, resultY, coefY);\n}\nfloat CCGetShadowFactorSoft2X (vec4 shadowPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat offsetDepth = clipPos.z;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nfloat clipPos_offset_L = clipPos.x - oneTap.x;\nfloat clipPos_offset_R = clipPos.x + oneTap.x;\nfloat clipPos_offset_U = clipPos.y - oneTap.y;\nfloat clipPos_offset_D = clipPos.y + oneTap.y;\nfloat block0, block1, block2, block3, block4, block5, block6, block7, block8;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock4 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock5 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock6 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock7 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock8 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)).x);\nblock1 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)).x);\nblock2 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)).x);\nblock3 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)).x);\nblock4 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x);\nblock5 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)).x);\nblock6 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)).x);\nblock7 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)).x);\nblock8 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)).x);\n}\nfloat coefX = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat coefY = mod(clipPos.y, oneTap.y) * mapSize.y;\nfloat shadow = 0.0;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block3, block4, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block1, block2, coefX);\nresultY = mix(block4, block5, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block3, block4, coefX);\nresultY = mix(block6, block7, coefX);\nshadow += mix(resultX, resultY, coefY);\nresultX = mix(block4, block5, coefX);\nresultY = mix(block7, block8, coefX);\nshadow += mix(resultX, resultY, coefY);\nreturn shadow * 0.25;\n}\nfloat CCGetSpotLightShadowFactorHard (vec4 shadowPos, vec3 worldPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nfloat depth = clipPos.z;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nclosestDepth = dot(texture2D(cc_spotLightingMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n} else {\nclosestDepth = texture2D(cc_spotLightingMap, clipPos.xy).x;\n}\nshadow = step(depth, closestDepth);\nreturn shadow;\n}\nfloat CCGetSpotLightShadowFactorSoft (vec4 shadowPos, vec3 worldPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nfloat bias = cc_shadowWHPBInfo.w;\nvec2 oneTap = 1.0 / cc_shadowWHPBInfo.xy;\nvec2 clipPos_offset = clipPos.xy + oneTap;\nfloat block0, block1, block2, block3;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x);\nblock1 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos.y)).x);\nblock2 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset.y)).x);\nblock3 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos_offset.y)).x);\n}\nfloat coefX   = mod(clipPos.x, oneTap.x) * cc_shadowWHPBInfo.x;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block2, block3, coefX);\nfloat coefY   = mod(clipPos.y, oneTap.y) * cc_shadowWHPBInfo.y;\nreturn mix(resultX, resultY, coefY);\n}\nfloat CCGetSpotLightShadowFactorSoft2X (vec4 shadowPos, vec3 worldPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nfloat bias = cc_shadowWHPBInfo.w;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nfloat clipPos_offset_L = clipPos.x - oneTap.x;\nfloat clipPos_offset_R = clipPos.x + oneTap.x;\nfloat clipPos_offset_U = clipPos.y - oneTap.y;\nfloat clipPos_offset_D = clipPos.y + oneTap.y;\nfloat block0, block1, block2, block3, block4, block5, block6, block7, block8;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock4 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock5 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock6 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock7 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock8 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_U)).x);\nblock1 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_U)).x);\nblock2 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_U)).x);\nblock3 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos.y)).x);\nblock4 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x);\nblock5 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos.y)).x);\nblock6 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_D)).x);\nblock7 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_D)).x);\nblock8 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_D)).x);\n}\nfloat coefX = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat coefY = mod(clipPos.y, oneTap.y) * mapSize.y;\nfloat shadow = 0.0;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block3, block4, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block1, block2, coefX);\nresultY = mix(block4, block5, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block3, block4, coefX);\nresultY = mix(block6, block7, coefX);\nshadow += mix(resultX, resultY, coefY);\nresultX = mix(block4, block5, coefX);\nresultY = mix(block7, block8, coefX);\nshadow += mix(resultX, resultY, coefY);\nreturn shadow * 0.25;\n}\n#endif\n#if CC_USE_IBL\nuniform samplerCube cc_environment;\nvec4 fragTextureLod (sampler2D tex, vec2 coord, float lod) {\n#ifdef GL_EXT_shader_texture_lod\nreturn texture2DLodEXT(tex, coord, lod);\n#else\nreturn texture2D(tex, coord, lod);\n#endif\n}\nvec4 fragTextureLod (samplerCube tex, vec3 coord, float lod) {\n#ifdef GL_EXT_shader_texture_lod\nreturn textureCubeLodEXT(tex, coord, lod);\n#else\nreturn textureCube(tex, coord, lod);\n#endif\n}\nvec3 unpackRGBE (vec4 rgbe) {\nreturn rgbe.rgb * pow(1.1, rgbe.a * 255.0 - 128.0);\n}\n#if CC_USE_DIFFUSEMAP\nuniform samplerCube cc_diffuseMap;\n#endif\n#endif\nfloat GGXMobile (float roughness, float NoH, vec3 H, vec3 N) {\nvec3 NxH = cross(N, H);\nfloat OneMinusNoHSqr = dot(NxH, NxH);\nfloat a = roughness * roughness;\nfloat n = NoH * a;\nfloat p = a / (OneMinusNoHSqr + n * n);\nreturn p * p;\n}\nfloat CalcSpecular (float roughness, float NoH, vec3 H, vec3 N) {\nreturn (roughness * 0.25 + 0.25) * GGXMobile(roughness, NoH, H, N);\n}\nvec3 BRDFApprox (vec3 specular, float roughness, float NoV) {\nconst vec4 c0 = vec4(-1.0, -0.0275, -0.572, 0.022);\nconst vec4 c1 = vec4(1.0, 0.0425, 1.04, -0.04);\nvec4 r = roughness * c0 + c1;\nfloat a004 = min(r.x * r.x, exp2(-9.28 * NoV)) * r.x + r.y;\nvec2 AB = vec2(-1.04, 1.04) * a004 + r.zw;\nAB.y *= clamp(50.0 * specular.g, 0.0, 1.0);\nreturn specular * AB.x + AB.y;\n}\n#if USE_REFLECTION_DENOISE\nvec3 GetEnvReflectionWithMipFiltering(vec3 R, float roughness, float mipCount, float denoiseIntensity) {\n#if CC_USE_IBL\nfloat mip = roughness * mipCount;\nfloat delta = (dot(dFdx(R), dFdy(R))) * 1000.0;\nfloat mipBias = mix(0.0, 5.0, clamp(delta, 0.0, 1.0));\nvec4 biased = fragTextureLod(cc_environment, R, mip + mipBias);\nvec4 filtered = textureCube(cc_environment, R);\n#if CC_USE_IBL == 2\nbiased.rgb = unpackRGBE(biased);\nfiltered.rgb = unpackRGBE(filtered);\n#else\nbiased.rgb = SRGBToLinear(biased.rgb);\nfiltered.rgb = SRGBToLinear(filtered.rgb);\n#endif\nreturn mix(biased.rgb, filtered.rgb, denoiseIntensity);\n#else\nreturn vec3(0.0, 0.0, 0.0);\n#endif\n}\n#endif\nstruct StandardSurface {\nvec4 albedo;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nvec3 position, position_fract_part;\n#else\nvec3 position;\n#endif\nvec3 normal;\nvec3 emissive;\nvec3 lightmap;\nfloat lightmap_test;\nfloat roughness;\nfloat metallic;\nfloat occlusion;\n};\nvec4 CCStandardShadingBase (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.0);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 L = normalize(-cc_mainLitDir.xyz);\nvec3 H = normalize(L + V);\nfloat NH = max(dot(N, H), 0.0);\nfloat NL = max(dot(N, L), 0.0);\nvec3 finalColor = NL * cc_mainLitColor.rgb * cc_mainLitColor.w;\nvec3 diffuseContrib = diffuse;\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nif (s.lightmap_test > 0.0001) {\nfinalColor = s.lightmap.rgb;\n}\n#else\ndiffuseContrib /= 3.14159265359;\n#endif\nvec3 specularContrib = specular * CalcSpecular(s.roughness, NH, H, N);\nvec3 dirlightContrib = (diffuseContrib + specularContrib);\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (NL > 0.0 && cc_mainLitDir.w > 0.0) {\n{\nvec4 pos = ApplyShadowDepthBias_FaceNormal(shadowPos, N);\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) shadow = CCGetShadowFactorSoft2X(pos);\nelse if (pcf > 0.9) shadow = CCGetShadowFactorSoft(pos);\nelse shadow = CCGetShadowFactorHard(pos);\nshadow = mix(shadow, 1.0, cc_shadowNFLSInfo.w);\n}\n}\n#endif\ndirlightContrib *= shadow;\nfinalColor *= dirlightContrib;\nfloat fAmb = 0.5 - N.y * 0.5;\nvec3 ambDiff = mix(cc_ambientSky.rgb, cc_ambientGround.rgb, fAmb);\n#if CC_USE_IBL\n#if CC_USE_DIFFUSEMAP\nvec4 diffuseMap = textureCube(cc_diffuseMap, N);\n#if CC_USE_DIFFUSEMAP == 2\nambDiff = unpackRGBE(diffuseMap);\n#else\nambDiff = SRGBToLinear(diffuseMap.rgb);\n#endif\n#endif\nvec3 R = normalize(reflect(-V, N));\n#if USE_REFLECTION_DENOISE\nvec3 env = GetEnvReflectionWithMipFiltering(R, s.roughness, cc_ambientGround.w, 0.6);\n#else\nvec4 envmap = fragTextureLod(cc_environment, R, s.roughness * cc_ambientGround.w);\n#if CC_USE_IBL == 2\nvec3 env = unpackRGBE(envmap);\n#else\nvec3 env = SRGBToLinear(envmap.rgb);\n#endif\n#endif\nfinalColor += env * cc_ambientSky.w * specular * s.occlusion;\n#endif\nfinalColor += ambDiff.rgb * cc_ambientSky.w * diffuse * s.occlusion;\nfinalColor += s.emissive;\nreturn vec4(finalColor, s.albedo.a);\n}\nvec3 ACESToneMap (vec3 color) {\ncolor = min(color, vec3(8.0));\nconst float A = 2.51;\nconst float B = 0.03;\nconst float C = 2.43;\nconst float D = 0.59;\nconst float E = 0.14;\nreturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = ACESToneMap(color.rgb);\n#endif\ncolor.rgb = sqrt(color.rgb);\nreturn color;\n}\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\nvoid CC_APPLY_FOG_BASE(inout vec4 color, float factor) {\ncolor = vec4(mix(cc_fogColor.rgb, color.rgb, factor), color.a);\n}\n#if !CC_USE_ACCURATE_FOG\nvarying float v_fog_factor;\n#endif\nvoid CC_APPLY_FOG(inout vec4 color) {\n#if !CC_USE_ACCURATE_FOG\nCC_APPLY_FOG_BASE(color, v_fog_factor);\n#endif\n}\nvoid CC_APPLY_FOG(inout vec4 color, vec3 worldPos) {\n#if CC_USE_ACCURATE_FOG\nfloat factor;\nCC_TRANSFER_FOG_BASE(vec4(worldPos, 1.0), factor);\n#else\nfloat factor = v_fog_factor;\n#endif\nCC_APPLY_FOG_BASE(color, factor);\n}\nvarying highp vec4 v_shadowPos;\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nvarying vec3 v_luv;\nuniform sampler2D cc_lightingMap;\nvec3 UnpackLightingmap(vec4 color) {\nvec3 c;\nfloat e = 1.0 + color.a * (8.0 - 1.0);\nc.r = color.r * e;\nc.g = color.g * e;\nc.b = color.b * e;\nreturn c;\n}\n#endif\nvarying highp vec3 v_position;\nvarying mediump vec3 v_normal;\n#if USE_NORMALMAP\nvarying mediump vec3 v_tangent;\nvarying mediump vec3 v_binormal;\n#endif\nvarying mediump vec2 uvw;\nvarying mediump vec2 uv0;\nvarying mediump vec2 uv1;\nvarying mediump vec2 uv2;\nvarying mediump vec2 uv3;\nvarying mediump vec3 diffuse;\nvarying mediump vec3 luv;\nuniform vec4 metallic;\nuniform vec4 roughness;\nuniform sampler2D weightMap;\nuniform sampler2D detailMap0;\nuniform sampler2D detailMap1;\nuniform sampler2D detailMap2;\nuniform sampler2D detailMap3;\nuniform sampler2D normalMap0;\nuniform sampler2D normalMap1;\nuniform sampler2D normalMap2;\nuniform sampler2D normalMap3;\nuniform sampler2D lightMap;\nvoid surf (out StandardSurface s) {\n#if LAYERS > 1\nvec4 w = texture2D(weightMap, uvw);\n#endif\nvec4 baseColor = vec4(0, 0, 0, 0);\n#if LAYERS == 1\nbaseColor = texture2D(detailMap0, uv0);\n#elif LAYERS == 2\nbaseColor += texture2D(detailMap0, uv0) * w.r;\nbaseColor += texture2D(detailMap1, uv1) * w.g;\n#elif LAYERS == 3\nbaseColor += texture2D(detailMap0, uv0) * w.r;\nbaseColor += texture2D(detailMap1, uv1) * w.g;\nbaseColor += texture2D(detailMap2, uv2) * w.b;\n#elif LAYERS == 4\nbaseColor += texture2D(detailMap0, uv0) * w.r;\nbaseColor += texture2D(detailMap1, uv1) * w.g;\nbaseColor += texture2D(detailMap2, uv2) * w.b;\nbaseColor += texture2D(detailMap3, uv3) * w.a;\n#else\nbaseColor = texture2D(detailMap0, uv0);\n#endif\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\npackHighpData(s.position, s.position_fract_part, v_position);\n#else\ns.position = v_position;\n#endif\n#if USE_NORMALMAP\nvec4 baseNormal = vec4(0, 0, 0, 0);\n#if LAYERS == 1\nbaseNormal = texture2D(normalMap0, uv0);\n#elif LAYERS == 2\nbaseNormal += texture2D(normalMap0, uv0) * w.r;\nbaseNormal += texture2D(normalMap1, uv1) * w.g;\n#elif LAYERS == 3\nbaseNormal += texture2D(normalMap0, uv0) * w.r;\nbaseNormal += texture2D(normalMap1, uv1) * w.g;\nbaseNormal += texture2D(normalMap2, uv2) * w.b;\n#elif LAYERS == 4\nbaseNormal += texture2D(normalMap0, uv0) * w.r;\nbaseNormal += texture2D(normalMap1, uv1) * w.g;\nbaseNormal += texture2D(normalMap2, uv2) * w.b;\nbaseNormal += texture2D(normalMap3, uv3) * w.a;\n#else\nbaseNormal = texture2D(normalMap0, uv0);\n#endif\nvec3 nmmp = baseNormal.xyz - vec3(0.5);\ns.normal =\nnmmp.x * normalize(v_tangent) +\nnmmp.y * normalize(v_binormal) +\nnmmp.z * normalize(v_normal);\n#else\ns.normal = v_normal;\n#endif\ns.albedo = vec4(SRGBToLinear(baseColor.rgb), 1.0);\ns.occlusion = 1.0;\n#if USE_PBR\ns.roughness = 0.0;\n#if LAYERS == 1\ns.roughness = roughness.x;\n#elif LAYERS == 2\ns.roughness += roughness.x * w.r;\ns.roughness += roughness.y * w.g;\n#elif LAYERS == 3\ns.roughness += roughness.x * w.r;\ns.roughness += roughness.y * w.g;\ns.roughness += roughness.z * w.b;\n#elif LAYERS == 4\ns.roughness += roughness.x * w.r;\ns.roughness += roughness.y * w.g;\ns.roughness += roughness.z * w.b;\ns.roughness += roughness.w * w.a;\n#else\ns.roughness = 1.0;\n#endif\ns.metallic = 0.0;\n#if LAYERS == 1\ns.metallic = metallic.x;\n#elif LAYERS == 2\ns.metallic += metallic.x * w.r;\ns.metallic += metallic.y * w.g;\n#elif LAYERS == 3\ns.metallic += metallic.x * w.r;\ns.metallic += metallic.y * w.g;\ns.metallic += metallic.z * w.b;\n#elif LAYERS == 4\ns.metallic += metallic.x * w.r;\ns.metallic += metallic.y * w.g;\ns.metallic += metallic.z * w.b;\ns.metallic += metallic.w * w.a;\n#else\ns.metallic = 0.0;\n#endif\n#else\ns.roughness = 1.0;\ns.metallic = 0.0;\n#endif\ns.emissive = vec3(0.0, 0.0, 0.0);\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nvec4 lightColor = texture2D(lightMap, luv.xy);\ns.lightmap = UnpackLightingmap(lightColor);\ns.lightmap_test = luv.z;\n#endif\n}\n#if CC_FORWARD_ADD\n#if CC_PIPELINE_TYPE == 0\n# define LIGHTS_PER_PASS 1\n#else\n# define LIGHTS_PER_PASS 10\n#endif\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 0\nuniform highp vec4 cc_lightPos[LIGHTS_PER_PASS];\nuniform vec4 cc_lightColor[LIGHTS_PER_PASS];\nuniform vec4 cc_lightSizeRangeAngle[LIGHTS_PER_PASS];\nuniform vec4 cc_lightDir[LIGHTS_PER_PASS];\n#endif\nfloat SmoothDistAtt (float distSqr, float invSqrAttRadius) {\nfloat factor = distSqr * invSqrAttRadius;\nfloat smoothFactor = clamp(1.0 - factor * factor, 0.0, 1.0);\nreturn smoothFactor * smoothFactor;\n}\nfloat GetDistAtt (float distSqr, float invSqrAttRadius) {\nfloat attenuation = 1.0 / max(distSqr, 0.01*0.01);\nattenuation *= SmoothDistAtt(distSqr , invSqrAttRadius);\nreturn attenuation;\n}\nfloat GetAngleAtt (vec3 L, vec3 litDir, float litAngleScale, float litAngleOffset) {\nfloat cd = dot(litDir, L);\nfloat attenuation = clamp(cd * litAngleScale + litAngleOffset, 0.0, 1.0);\nreturn (attenuation * attenuation);\n}\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 0\nvec4 CCStandardShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / 3.14159265359;\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.0);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nint numLights = CC_PIPELINE_TYPE == 0 ? LIGHTS_PER_PASS : int(cc_lightDir[0].w);\nfor (int i = 0; i < LIGHTS_PER_PASS; i++) {\nif (i >= numLights) break;\nvec3 SLU = cc_lightPos[i].xyz - position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.0);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = cc_lightSizeRangeAngle[i].x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = 3.14159265359 * (litRadiusSqr / max(litRadiusSqr , distSqr));\nfloat attRadiusSqrInv = 1.0 / max(cc_lightSizeRangeAngle[i].y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (cc_lightPos[i].w > 0.0) {\nfloat cosInner = max(dot(-cc_lightDir[i].xyz, SL), 0.01);\nfloat cosOuter = cc_lightSizeRangeAngle[i].z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -cc_lightDir[i].xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = cc_lightColor[i].rgb;\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (cc_lightPos[i].w > 0.0 && cc_lightSizeRangeAngle[i].w > 0.0) {\n{\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) shadow = CCGetSpotLightShadowFactorSoft2X(shadowPos, position);\nelse if (pcf > 0.9) shadow = CCGetSpotLightShadowFactorSoft(shadowPos, position);\nelse shadow = CCGetSpotLightShadowFactorHard(shadowPos, position);\n}\n}\n#endif\nlightColor *= shadow;\nfinalColor += SNL * lightColor * cc_lightColor[i].w * illum * att * (diffuseContrib + lspec);\n}\nreturn vec4(finalColor, 0.0);\n}\n#endif\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 1\nreadonly buffer b_ccLightsBuffer { vec4 b_ccLights[]; };\nreadonly buffer b_clusterLightIndicesBuffer { uint b_clusterLightIndices[]; };\nreadonly buffer b_clusterLightGridBuffer { uvec4 b_clusterLightGrid[]; };\nstruct CCLight\n{\nvec4 cc_lightPos;\nvec4 cc_lightColor;\nvec4 cc_lightSizeRangeAngle;\nvec4 cc_lightDir;\n};\nstruct Cluster\n{\nvec3 minBounds;\nvec3 maxBounds;\n};\nstruct LightGrid\n{\nuint offset;\nuint ccLights;\n};\nCCLight getCCLight(uint i)\n{\nCCLight light;\nlight.cc_lightPos = b_ccLights[4u * i + 0u];\nlight.cc_lightColor = b_ccLights[4u * i + 1u];\nlight.cc_lightSizeRangeAngle = b_ccLights[4u * i + 2u];\nlight.cc_lightDir = b_ccLights[4u * i + 3u];\nreturn light;\n}\nLightGrid getLightGrid(uint cluster)\n{\nuvec4 gridvec = b_clusterLightGrid[cluster];\nLightGrid grid;\ngrid.offset = gridvec.x;\ngrid.ccLights = gridvec.y;\nreturn grid;\n}\nuint getGridLightIndex(uint start, uint offset)\n{\nreturn b_clusterLightIndices[start + offset];\n}\nuint getClusterZIndex(vec4 worldPos)\n{\nfloat scale = float(24) / log(cc_nearFar.y / cc_nearFar.x);\nfloat bias = -(float(24) * log(cc_nearFar.x) / log(cc_nearFar.y / cc_nearFar.x));\nfloat eyeDepth = -(cc_matView * worldPos).z;\nuint zIndex = uint(max(log(eyeDepth) * scale + bias, 0.0));\nreturn zIndex;\n}\nuint getClusterIndex(vec4 fragCoord, vec4 worldPos)\n{\nuint zIndex = getClusterZIndex(worldPos);\nfloat clusterSizeX = ceil(cc_viewPort.z / float(16));\nfloat clusterSizeY = ceil(cc_viewPort.w / float(8));\nuvec3 indices = uvec3(uvec2(fragCoord.xy / vec2(clusterSizeX, clusterSizeY)), zIndex);\nuint cluster = (16u * 8u) * indices.z + 16u * indices.y + indices.x;\nreturn cluster;\n}\nvec4 CCClusterShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / 3.14159265359;\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.001);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nuint cluster = getClusterIndex(gl_FragCoord, vec4(position, 1.0));\nLightGrid grid = getLightGrid(cluster);\nuint numLights = grid.ccLights;\nfor (uint i = 0u; i < 100u; i++) {\nif (i >= numLights) break;\nuint lightIndex = getGridLightIndex(grid.offset, i);\nCCLight light = getCCLight(lightIndex);\nvec3 SLU = light.cc_lightPos.xyz - position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.001);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = light.cc_lightSizeRangeAngle.x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = 3.14159265359 * (litRadiusSqr / max(litRadiusSqr , distSqr));\nfloat attRadiusSqrInv = 1.0 / max(light.cc_lightSizeRangeAngle.y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (light.cc_lightPos.w > 0.0) {\nfloat cosInner = max(dot(-light.cc_lightDir.xyz, SL), 0.01);\nfloat cosOuter = light.cc_lightSizeRangeAngle.z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -light.cc_lightDir.xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = light.cc_lightColor.rgb;\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (light.cc_lightPos.w > 0.0) {\n{\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) shadow = CCGetSpotLightShadowFactorSoft2X(shadowPos, position);\nelse if (pcf > 0.9) shadow = CCGetSpotLightShadowFactorSoft(shadowPos, position);\nelse shadow = CCGetSpotLightShadowFactorHard(shadowPos, position);\n}\n}\n#endif\nlightColor *= shadow;\nfinalColor += SNL * lightColor * light.cc_lightColor.w * illum * att * (diffuseContrib + lspec);\n}\nreturn vec4(finalColor, 0.0);\n}\n#endif\nvoid main () {\nStandardSurface s; surf(s);\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 1\nvec4 color = CCClusterShadingAdditive(s, v_shadowPos);\n#else\nvec4 color = CCStandardShadingAdditive(s, v_shadowPos);\n#endif\nCC_APPLY_FOG(color, s.position.xyz);\ngl_FragData[0] = CCFragOutput(color);\n}\n#elif (CC_PIPELINE_TYPE == 0 || CC_FORCE_FORWARD_SHADING)\nvoid main () {\nStandardSurface s; surf(s);\nvec4 color = CCStandardShadingBase(s, v_shadowPos);\nCC_APPLY_FOG(color, s.position.xyz);\ngl_FragData[0] = CCFragOutput(color);\n}\n#elif CC_PIPELINE_TYPE == 1\nvec2 signNotZero(vec2 v) {\nreturn vec2((v.x >= 0.0) ? +1.0 : -1.0, (v.y >= 0.0) ? +1.0 : -1.0);\n}\nvec2 float32x3_to_oct(in vec3 v) {\nvec2 p = v.xy * (1.0 / (abs(v.x) + abs(v.y) + abs(v.z)));\nreturn (v.z <= 0.0) ? ((1.0 - abs(p.yx)) * signNotZero(p)) : p;\n}\nvoid main () {\nStandardSurface s; surf(s);\ngl_FragData[0] = s.albedo;\ngl_FragData[1] = vec4(float32x3_to_oct(s.normal), s.roughness, s.metallic);\ngl_FragData[2] = vec4(s.emissive, s.occlusion);\n}\n#endif"},{vert:"\nprecision highp float;\nuniform highp mat4 cc_matWorld;\nuniform highp mat4 cc_matLightViewProj;\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nvarying vec2 v_clip_depth;\nvec4 vert () {\nvec4 worldPos;\nworldPos.x = cc_matWorld[3][0] + a_position.x;\nworldPos.y = cc_matWorld[3][1] + a_position.y;\nworldPos.z = cc_matWorld[3][2] + a_position.z;\nworldPos.w = 1.0;\nvec4 clipPos = cc_matLightViewProj * worldPos;\nv_clip_depth = clipPos.zw;\nreturn clipPos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 packDepthToRGBA (float depth) {\nvec4 ret = vec4(1.0, 255.0, 65025.0, 16581375.0) * depth;\nret = fract(ret);\nret -= vec4(ret.yzw, 0.0) / 255.0;\nreturn ret;\n}\nvarying vec2 v_clip_depth;\nvec4 frag () {\nreturn packDepthToRGBA(v_clip_depth.x / v_clip_depth.y * 0.5 + 0.5);\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_MORPH\nattribute float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\nuniform vec4 cc_displacementWeights[15];\nuniform vec4 cc_displacementTextureInfo;\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 uv = getPixelCoordFromLocation(location, cc_displacementTextureInfo.xy);\nreturn texture2D(tex, uv);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture2D(tex, x)),\ndecode32(texture2D(tex, y)),\ndecode32(texture2D(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nattribute vec4 a_joints;\nattribute vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nattribute highp vec4 a_jointAnimInfo;\n#endif\nuniform highp vec4 cc_jointTextureInfo;\nuniform highp vec4 cc_jointAnimInfo;\nuniform highp sampler2D cc_jointTexture;\n#else\nuniform highp vec4 cc_joints[90];\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matProj;\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_fogBase;\nuniform mediump vec4 cc_fogAdd;\n#if USE_INSTANCING\nattribute vec4 a_matWorld0;\nattribute vec4 a_matWorld1;\nattribute vec4 a_matWorld2;\n#if USE_LIGHTMAP\nattribute vec4 a_lightingMapUVParam;\n#endif\n#elif USE_BATCHING\nattribute float a_dyn_batch_id;\nuniform highp mat4 cc_matWorlds[10];\n#else\nuniform highp mat4 cc_matWorld;\n#endif\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\n#if !CC_USE_ACCURATE_FOG\nvarying float v_fog_factor;\n#endif\nvoid CC_TRANSFER_FOG(vec4 pos) {\n#if !CC_USE_ACCURATE_FOG\nCC_TRANSFER_FOG_BASE(pos, v_fog_factor);\n#endif\n}\n#if USE_VERTEX_COLOR\nattribute lowp vec4 a_color;\nvarying lowp vec4 v_color;\n#endif\n#if USE_TEXTURE\nvarying vec2 v_uv;\nuniform vec4 tilingOffset;\n#endif\nvec4 vert () {\nvec4 position;\nposition = vec4(a_position, 1.0);\n#if CC_USE_MORPH\napplyMorph(position);\n#endif\n#if CC_USE_SKINNING\nCCSkin(position);\n#endif\nmat4 matWorld;\n#if USE_INSTANCING\nmatWorld = mat4(\nvec4(a_matWorld0.xyz, 0.0),\nvec4(a_matWorld1.xyz, 0.0),\nvec4(a_matWorld2.xyz, 0.0),\nvec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n);\n#elif USE_BATCHING\nmatWorld = cc_matWorlds[int(a_dyn_batch_id)];\n#else\nmatWorld = cc_matWorld;\n#endif\n#if USE_TEXTURE\nv_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n#if SAMPLE_FROM_RT\nv_uv = cc_cameraPos.w > 1.0 ? vec2(v_uv.x, 1.0 - v_uv.y) : v_uv;\n#endif\n#endif\n#if USE_VERTEX_COLOR\nv_color = a_color;\n#endif\nCC_TRANSFER_FOG(matWorld * position);\nreturn cc_matProj * (cc_matView * matWorld) * position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec3 ACESToneMap (vec3 color) {\ncolor = min(color, vec3(8.0));\nconst float A = 2.51;\nconst float B = 0.03;\nconst float C = 2.43;\nconst float D = 0.59;\nconst float E = 0.14;\nreturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = ACESToneMap(color.rgb);\n#endif\ncolor.rgb = sqrt(color.rgb);\nreturn color;\n}\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_fogColor;\nuniform mediump vec4 cc_fogBase;\nuniform mediump vec4 cc_fogAdd;\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\nvoid CC_APPLY_FOG_BASE(inout vec4 color, float factor) {\ncolor = vec4(mix(cc_fogColor.rgb, color.rgb, factor), color.a);\n}\n#if !CC_USE_ACCURATE_FOG\nvarying float v_fog_factor;\n#endif\nvoid CC_APPLY_FOG(inout vec4 color) {\n#if !CC_USE_ACCURATE_FOG\nCC_APPLY_FOG_BASE(color, v_fog_factor);\n#endif\n}\nvoid CC_APPLY_FOG(inout vec4 color, vec3 worldPos) {\n#if CC_USE_ACCURATE_FOG\nfloat factor;\nCC_TRANSFER_FOG_BASE(vec4(worldPos, 1.0), factor);\n#else\nfloat factor = v_fog_factor;\n#endif\nCC_APPLY_FOG_BASE(color, factor);\n}\n#if USE_ALPHA_TEST\n#endif\n#if USE_TEXTURE\nvarying vec2 v_uv;\nuniform sampler2D mainTexture;\n#endif\nuniform vec4 mainColor;\nuniform vec4 colorScaleAndCutoff;\n#if USE_VERTEX_COLOR\nvarying lowp vec4 v_color;\n#endif\nvec4 frag () {\nvec4 o = mainColor;\no.rgb *= colorScaleAndCutoff.xyz;\n#if USE_VERTEX_COLOR\no.rgb *= SRGBToLinear(v_color.rgb);\no.a *= v_color.a;\n#endif\n#if USE_TEXTURE\nvec4 texColor = texture2D(mainTexture, v_uv);\ntexColor.rgb = SRGBToLinear(texColor.rgb);\no *= texColor;\n#endif\n#if USE_ALPHA_TEST\nif (o.ALPHA_TEST_CHANNEL < colorScaleAndCutoff.w) discard;\n#endif\nCC_APPLY_FOG(o);\nreturn CCFragOutput(o);\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_MORPH\nattribute float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\nuniform vec4 cc_displacementWeights[15];\nuniform vec4 cc_displacementTextureInfo;\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 uv = getPixelCoordFromLocation(location, cc_displacementTextureInfo.xy);\nreturn texture2D(tex, uv);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture2D(tex, x)),\ndecode32(texture2D(tex, y)),\ndecode32(texture2D(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nattribute vec4 a_joints;\nattribute vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nattribute highp vec4 a_jointAnimInfo;\n#endif\nuniform highp vec4 cc_jointTextureInfo;\nuniform highp vec4 cc_jointAnimInfo;\nuniform highp sampler2D cc_jointTexture;\n#else\nuniform highp vec4 cc_joints[90];\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nuniform highp vec4 cc_cameraPos;\nvarying vec2 v_uv;\nvoid main () {\nStandardVertInput In;\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In);\n#endif\nIn.position.xy = cc_cameraPos.w == 0.0 ? vec2(In.position.xy.x, -In.position.xy.y) : In.position.xy;\ngl_Position = In.position;\ngl_Position.y = gl_Position.y;\nv_uv = a_texCoord;\n}",frag:"\nprecision highp float;\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nvarying vec2 v_uv;\nuniform mediump vec4 texSize;\nuniform sampler2D outputResultMap;\nfloat luminance(vec3 color) {\nreturn dot(color, vec3(0.2126, 0.7152, 0.0722));\n}\nvoid main() {\nvec3 color = texture2D(outputResultMap, v_uv).xyz;\nif (luminance(SRGBToLinear(color)) > texSize.z) {\ngl_FragColor = vec4(color, 1.0);\n} else {\ngl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n}\n}"},{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_MORPH\nattribute float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\nuniform vec4 cc_displacementWeights[15];\nuniform vec4 cc_displacementTextureInfo;\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 uv = getPixelCoordFromLocation(location, cc_displacementTextureInfo.xy);\nreturn texture2D(tex, uv);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture2D(tex, x)),\ndecode32(texture2D(tex, y)),\ndecode32(texture2D(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nattribute vec4 a_joints;\nattribute vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nattribute highp vec4 a_jointAnimInfo;\n#endif\nuniform highp vec4 cc_jointTextureInfo;\nuniform highp vec4 cc_jointAnimInfo;\nuniform highp sampler2D cc_jointTexture;\n#else\nuniform highp vec4 cc_joints[90];\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nuniform highp vec4 cc_cameraPos;\nvarying vec2 v_uv;\nvoid main () {\nStandardVertInput In;\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In);\n#endif\nIn.position.xy = cc_cameraPos.w == 0.0 ? vec2(In.position.xy.x, -In.position.xy.y) : In.position.xy;\ngl_Position = In.position;\ngl_Position.y = gl_Position.y;\nv_uv = a_texCoord;\n}",frag:"\nprecision highp float;\nvarying vec2 v_uv;\nuniform mediump vec4 texSize;\nuniform sampler2D bloomTexture;\nvec3 downsample4taps(vec2 uv, vec2 halfpixel) {\nvec3 sum = texture2D(bloomTexture, uv + vec2(-halfpixel.x, halfpixel.y)).xyz;\nsum += texture2D(bloomTexture, uv + vec2(halfpixel.x, halfpixel.y)).xyz;\nsum += texture2D(bloomTexture, uv + vec2(halfpixel.x, -halfpixel.y)).xyz;\nsum += texture2D(bloomTexture, uv + vec2(-halfpixel.x, -halfpixel.y)).xyz;\nreturn sum / 4.0;\n}\nvoid main()\n{\nvec3 result = downsample4taps(v_uv, 1.0 / texSize.xy).rgb;\ngl_FragColor = vec4(result, 1.0);\n}"},{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_MORPH\nattribute float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\nuniform vec4 cc_displacementWeights[15];\nuniform vec4 cc_displacementTextureInfo;\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 uv = getPixelCoordFromLocation(location, cc_displacementTextureInfo.xy);\nreturn texture2D(tex, uv);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture2D(tex, x)),\ndecode32(texture2D(tex, y)),\ndecode32(texture2D(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nattribute vec4 a_joints;\nattribute vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nattribute highp vec4 a_jointAnimInfo;\n#endif\nuniform highp vec4 cc_jointTextureInfo;\nuniform highp vec4 cc_jointAnimInfo;\nuniform highp sampler2D cc_jointTexture;\n#else\nuniform highp vec4 cc_joints[90];\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nuniform highp vec4 cc_cameraPos;\nvarying vec2 v_uv;\nvoid main () {\nStandardVertInput In;\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In);\n#endif\nIn.position.xy = cc_cameraPos.w == 0.0 ? vec2(In.position.xy.x, -In.position.xy.y) : In.position.xy;\ngl_Position = In.position;\ngl_Position.y = gl_Position.y;\nv_uv = a_texCoord;\n}",frag:"\nprecision highp float;\nvarying vec2 v_uv;\nuniform mediump vec4 texSize;\nuniform sampler2D bloomTexture;\nvec3 upsample4taps(vec2 uv, vec2 halfpixel) {\nvec3 sum = texture2D(bloomTexture, uv + vec2(-halfpixel.x, halfpixel.y)).xyz;\nsum += texture2D(bloomTexture, uv + vec2(halfpixel.x, halfpixel.y)).xyz;\nsum += texture2D(bloomTexture, uv + vec2(halfpixel.x, -halfpixel.y)).xyz;\nsum += texture2D(bloomTexture, uv + vec2(-halfpixel.x, -halfpixel.y)).xyz;\nreturn sum / 4.0;\n}\nvoid main() {\nvec3 result = upsample4taps(v_uv, 0.5 / texSize.xy).rgb;\ngl_FragColor = vec4(result, 1.0);\n}"},{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_MORPH\nattribute float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\nuniform vec4 cc_displacementWeights[15];\nuniform vec4 cc_displacementTextureInfo;\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 uv = getPixelCoordFromLocation(location, cc_displacementTextureInfo.xy);\nreturn texture2D(tex, uv);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture2D(tex, x)),\ndecode32(texture2D(tex, y)),\ndecode32(texture2D(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nattribute vec4 a_joints;\nattribute vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nattribute highp vec4 a_jointAnimInfo;\n#endif\nuniform highp vec4 cc_jointTextureInfo;\nuniform highp vec4 cc_jointAnimInfo;\nuniform highp sampler2D cc_jointTexture;\n#else\nuniform highp vec4 cc_joints[90];\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nuniform highp vec4 cc_cameraPos;\nvarying vec2 v_uv;\nvoid main () {\nStandardVertInput In;\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In);\n#endif\nIn.position.xy = cc_cameraPos.w == 0.0 ? vec2(In.position.xy.x, -In.position.xy.y) : In.position.xy;\ngl_Position = In.position;\ngl_Position.y = gl_Position.y;\nv_uv = a_texCoord;\n}",frag:"\nprecision highp float;\nvarying vec2 v_uv;\nuniform mediump vec4 texSize;\nuniform sampler2D outputResultMap;\nuniform sampler2D bloomTexture;\nvoid main() {\nvec4 hdrColor = texture2D(outputResultMap, v_uv);\nvec3 bloomColor = texture2D(bloomTexture, v_uv).rgb;\nvec3 result = hdrColor.rgb + bloomColor * texSize.w * hdrColor.a;\ngl_FragColor = vec4(result, hdrColor.a);\n}"}],[{vert:"\nprecision highp float;\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\nuniform highp vec4 cc_cameraPos;\nvarying vec2 v_uv;\nvoid main () {\nvec4 position;\nposition = vec4(a_position, 1.0);\nposition.xy = cc_cameraPos.w == 0.0 ? vec2(position.xy.x, -position.xy.y) : position.xy;\ngl_Position = vec4(position.x, position.y, 1.0, 1.0);\nv_uv = a_texCoord;\n}",frag:"\n#ifdef GL_EXT_shader_framebuffer_fetch\n#extension GL_EXT_shader_framebuffer_fetch: enable\n#endif\n#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives: enable\n#endif\n#ifdef GL_EXT_shader_texture_lod\n#extension GL_EXT_shader_texture_lod: enable\n#endif\nprecision highp float;\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matViewProjInv;\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_mainLitDir;\nuniform mediump vec4 cc_mainLitColor;\nuniform mediump vec4 cc_ambientSky;\nuniform mediump vec4 cc_ambientGround;\nuniform mediump vec4 cc_fogColor;\nuniform mediump vec4 cc_fogBase;\nuniform mediump vec4 cc_fogAdd;\nuniform mediump vec4 cc_nearFar;\nuniform mediump vec4 cc_viewPort;\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nuniform highp mat4 cc_matLightView;\nuniform highp mat4 cc_matLightViewProj;\nuniform highp vec4 cc_shadowInvProjDepthInfo;\nuniform highp vec4 cc_shadowProjDepthInfo;\nuniform highp vec4 cc_shadowProjInfo;\nuniform mediump vec4 cc_shadowNFLSInfo;\nuniform mediump vec4 cc_shadowWHPBInfo;\nuniform mediump vec4 cc_shadowLPNNInfo;\nhighp float unpackHighpData (float mainPart, float modPart) {\nhighp float data = mainPart;\nreturn data + modPart;\n}\nhighp float unpackHighpData (float mainPart, float modPart, const float modValue) {\nhighp float data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nhighp vec2 unpackHighpData (vec2 mainPart, vec2 modPart) {\nhighp vec2 data = mainPart;\nreturn data + modPart;\n}\nhighp vec2 unpackHighpData (vec2 mainPart, vec2 modPart, const float modValue) {\nhighp vec2 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nhighp vec3 unpackHighpData (vec3 mainPart, vec3 modPart) {\nhighp vec3 data = mainPart;\nreturn data + modPart;\n}\nhighp vec3 unpackHighpData (vec3 mainPart, vec3 modPart, const float modValue) {\nhighp vec3 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nhighp vec4 unpackHighpData (vec4 mainPart, vec4 modPart) {\nhighp vec4 data = mainPart;\nreturn data + modPart;\n}\nhighp vec4 unpackHighpData (vec4 mainPart, vec4 modPart, const float modValue) {\nhighp vec4 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nfloat CCGetLinearDepthFromViewSpace(vec3 viewPos) {\nfloat dist = length(viewPos);\nreturn (dist - cc_shadowNFLSInfo.x) / (cc_shadowNFLSInfo.y - cc_shadowNFLSInfo.x);\n}\nfloat CCGetLinearDepth(vec3 worldPos) {\nvec4 viewStartPos = cc_matLightView * vec4(worldPos.xyz, 1.0);\nreturn CCGetLinearDepthFromViewSpace(viewStartPos.xyz);\n}\n#if CC_RECEIVE_SHADOW\nuniform highp sampler2D cc_shadowMap;\nuniform highp sampler2D cc_spotLightingMap;\nvec4 ApplyShadowDepthBias_FaceNormal(vec4 shadowPos, vec3 worldNormal)\n{\nvec4 newShadowPos = shadowPos;\nif(cc_shadowLPNNInfo.z > 0.0001)\n{\nvec4 viewNormal = cc_matLightView * vec4(worldNormal, 0.0);\nif(viewNormal.z < 0.1)\nnewShadowPos.xy += viewNormal.xy * cc_shadowProjInfo.xy * cc_shadowLPNNInfo.z * clamp(viewNormal.z, 0.001, 0.1);\n}\nreturn newShadowPos;\n}\nvec4 ApplyShadowDepthBias_Perspective(vec4 shadowPos, float viewspaceDepthBias)\n{\nvec3 viewSpacePos;\nviewSpacePos.xy = shadowPos.xy * cc_shadowProjInfo.zw;\nviewSpacePos.z = shadowPos.z * cc_shadowInvProjDepthInfo.x + shadowPos.w * cc_shadowInvProjDepthInfo.y;\nviewSpacePos.xyz += cc_shadowProjDepthInfo.z * normalize(viewSpacePos.xyz) * viewspaceDepthBias;\nvec4 clipSpacePos;\nclipSpacePos.xy = viewSpacePos.xy * cc_shadowProjInfo.xy;\nclipSpacePos.zw = viewSpacePos.z * cc_shadowProjDepthInfo.xz + vec2(cc_shadowProjDepthInfo.y, 0.0);\nif (cc_shadowNFLSInfo.z > 0.000001) {\nclipSpacePos.z = CCGetLinearDepthFromViewSpace(viewSpacePos.xyz);\nclipSpacePos.z = (clipSpacePos.z * 2.0 - 1.0) * clipSpacePos.w;\n}\nreturn clipSpacePos;\n}\nvec4 ApplyShadowDepthBias_Orthographic(vec4 shadowPos, float viewspaceDepthBias)\n{\nfloat coeffA = cc_shadowProjDepthInfo.x;\nfloat coeffB = cc_shadowProjDepthInfo.y;\nfloat viewSpacePos_z = (shadowPos.z - coeffB) / coeffA;\nviewSpacePos_z += viewspaceDepthBias;\nvec4 result = shadowPos;\nresult.z = viewSpacePos_z * coeffA + coeffB;\nreturn result;\n}\nfloat CCGetShadowFactorHard (vec4 shadowPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nclosestDepth = dot(texture2D(cc_shadowMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n} else {\nclosestDepth = texture2D(cc_shadowMap, clipPos.xy).x;\n}\nshadow = step(clipPos.z, closestDepth);\nreturn shadow;\n}\nfloat CCGetShadowFactorSoft (vec4 shadowPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat offsetDepth = clipPos.z;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nvec2 clipPos_offset = clipPos.xy + oneTap;\nfloat block0, block1, block2, block3;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x);\nblock1 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)).x);\nblock2 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)).x);\nblock3 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)).x);\n}\nfloat coefX   = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block2, block3, coefX);\nfloat coefY   = mod(clipPos.y, oneTap.y) * mapSize.y;\nreturn mix(resultX, resultY, coefY);\n}\nfloat CCGetShadowFactorSoft2X (vec4 shadowPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat offsetDepth = clipPos.z;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nfloat clipPos_offset_L = clipPos.x - oneTap.x;\nfloat clipPos_offset_R = clipPos.x + oneTap.x;\nfloat clipPos_offset_U = clipPos.y - oneTap.y;\nfloat clipPos_offset_D = clipPos.y + oneTap.y;\nfloat block0, block1, block2, block3, block4, block5, block6, block7, block8;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock4 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock5 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock6 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock7 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock8 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)).x);\nblock1 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)).x);\nblock2 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)).x);\nblock3 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)).x);\nblock4 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x);\nblock5 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)).x);\nblock6 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)).x);\nblock7 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)).x);\nblock8 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)).x);\n}\nfloat coefX = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat coefY = mod(clipPos.y, oneTap.y) * mapSize.y;\nfloat shadow = 0.0;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block3, block4, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block1, block2, coefX);\nresultY = mix(block4, block5, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block3, block4, coefX);\nresultY = mix(block6, block7, coefX);\nshadow += mix(resultX, resultY, coefY);\nresultX = mix(block4, block5, coefX);\nresultY = mix(block7, block8, coefX);\nshadow += mix(resultX, resultY, coefY);\nreturn shadow * 0.25;\n}\nfloat CCGetSpotLightShadowFactorHard (vec4 shadowPos, vec3 worldPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nfloat depth = clipPos.z;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nclosestDepth = dot(texture2D(cc_spotLightingMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n} else {\nclosestDepth = texture2D(cc_spotLightingMap, clipPos.xy).x;\n}\nshadow = step(depth, closestDepth);\nreturn shadow;\n}\nfloat CCGetSpotLightShadowFactorSoft (vec4 shadowPos, vec3 worldPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nfloat bias = cc_shadowWHPBInfo.w;\nvec2 oneTap = 1.0 / cc_shadowWHPBInfo.xy;\nvec2 clipPos_offset = clipPos.xy + oneTap;\nfloat block0, block1, block2, block3;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x);\nblock1 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos.y)).x);\nblock2 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset.y)).x);\nblock3 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos_offset.y)).x);\n}\nfloat coefX   = mod(clipPos.x, oneTap.x) * cc_shadowWHPBInfo.x;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block2, block3, coefX);\nfloat coefY   = mod(clipPos.y, oneTap.y) * cc_shadowWHPBInfo.y;\nreturn mix(resultX, resultY, coefY);\n}\nfloat CCGetSpotLightShadowFactorSoft2X (vec4 shadowPos, vec3 worldPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nfloat bias = cc_shadowWHPBInfo.w;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nfloat clipPos_offset_L = clipPos.x - oneTap.x;\nfloat clipPos_offset_R = clipPos.x + oneTap.x;\nfloat clipPos_offset_U = clipPos.y - oneTap.y;\nfloat clipPos_offset_D = clipPos.y + oneTap.y;\nfloat block0, block1, block2, block3, block4, block5, block6, block7, block8;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock4 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock5 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock6 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock7 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock8 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_U)).x);\nblock1 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_U)).x);\nblock2 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_U)).x);\nblock3 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos.y)).x);\nblock4 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x);\nblock5 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos.y)).x);\nblock6 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_D)).x);\nblock7 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_D)).x);\nblock8 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_D)).x);\n}\nfloat coefX = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat coefY = mod(clipPos.y, oneTap.y) * mapSize.y;\nfloat shadow = 0.0;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block3, block4, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block1, block2, coefX);\nresultY = mix(block4, block5, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block3, block4, coefX);\nresultY = mix(block6, block7, coefX);\nshadow += mix(resultX, resultY, coefY);\nresultX = mix(block4, block5, coefX);\nresultY = mix(block7, block8, coefX);\nshadow += mix(resultX, resultY, coefY);\nreturn shadow * 0.25;\n}\n#endif\n#if CC_USE_IBL\nuniform samplerCube cc_environment;\nvec4 fragTextureLod (sampler2D tex, vec2 coord, float lod) {\n#ifdef GL_EXT_shader_texture_lod\nreturn texture2DLodEXT(tex, coord, lod);\n#else\nreturn texture2D(tex, coord, lod);\n#endif\n}\nvec4 fragTextureLod (samplerCube tex, vec3 coord, float lod) {\n#ifdef GL_EXT_shader_texture_lod\nreturn textureCubeLodEXT(tex, coord, lod);\n#else\nreturn textureCube(tex, coord, lod);\n#endif\n}\nvec3 unpackRGBE (vec4 rgbe) {\nreturn rgbe.rgb * pow(1.1, rgbe.a * 255.0 - 128.0);\n}\n#if CC_USE_DIFFUSEMAP\nuniform samplerCube cc_diffuseMap;\n#endif\n#endif\nfloat GGXMobile (float roughness, float NoH, vec3 H, vec3 N) {\nvec3 NxH = cross(N, H);\nfloat OneMinusNoHSqr = dot(NxH, NxH);\nfloat a = roughness * roughness;\nfloat n = NoH * a;\nfloat p = a / (OneMinusNoHSqr + n * n);\nreturn p * p;\n}\nfloat CalcSpecular (float roughness, float NoH, vec3 H, vec3 N) {\nreturn (roughness * 0.25 + 0.25) * GGXMobile(roughness, NoH, H, N);\n}\nvec3 BRDFApprox (vec3 specular, float roughness, float NoV) {\nconst vec4 c0 = vec4(-1.0, -0.0275, -0.572, 0.022);\nconst vec4 c1 = vec4(1.0, 0.0425, 1.04, -0.04);\nvec4 r = roughness * c0 + c1;\nfloat a004 = min(r.x * r.x, exp2(-9.28 * NoV)) * r.x + r.y;\nvec2 AB = vec2(-1.04, 1.04) * a004 + r.zw;\nAB.y *= clamp(50.0 * specular.g, 0.0, 1.0);\nreturn specular * AB.x + AB.y;\n}\n#if USE_REFLECTION_DENOISE\nvec3 GetEnvReflectionWithMipFiltering(vec3 R, float roughness, float mipCount, float denoiseIntensity) {\n#if CC_USE_IBL\nfloat mip = roughness * mipCount;\nfloat delta = (dot(dFdx(R), dFdy(R))) * 1000.0;\nfloat mipBias = mix(0.0, 5.0, clamp(delta, 0.0, 1.0));\nvec4 biased = fragTextureLod(cc_environment, R, mip + mipBias);\nvec4 filtered = textureCube(cc_environment, R);\n#if CC_USE_IBL == 2\nbiased.rgb = unpackRGBE(biased);\nfiltered.rgb = unpackRGBE(filtered);\n#else\nbiased.rgb = SRGBToLinear(biased.rgb);\nfiltered.rgb = SRGBToLinear(filtered.rgb);\n#endif\nreturn mix(biased.rgb, filtered.rgb, denoiseIntensity);\n#else\nreturn vec3(0.0, 0.0, 0.0);\n#endif\n}\n#endif\nstruct StandardSurface {\nvec4 albedo;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nvec3 position, position_fract_part;\n#else\nvec3 position;\n#endif\nvec3 normal;\nvec3 emissive;\nvec3 lightmap;\nfloat lightmap_test;\nfloat roughness;\nfloat metallic;\nfloat occlusion;\n};\nvec4 CCStandardShadingBase (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.0);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 L = normalize(-cc_mainLitDir.xyz);\nvec3 H = normalize(L + V);\nfloat NH = max(dot(N, H), 0.0);\nfloat NL = max(dot(N, L), 0.0);\nvec3 finalColor = NL * cc_mainLitColor.rgb * cc_mainLitColor.w;\nvec3 diffuseContrib = diffuse;\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nif (s.lightmap_test > 0.0001) {\nfinalColor = s.lightmap.rgb;\n}\n#else\ndiffuseContrib /= 3.14159265359;\n#endif\nvec3 specularContrib = specular * CalcSpecular(s.roughness, NH, H, N);\nvec3 dirlightContrib = (diffuseContrib + specularContrib);\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (NL > 0.0 && cc_mainLitDir.w > 0.0) {\n{\nvec4 pos = ApplyShadowDepthBias_FaceNormal(shadowPos, N);\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) shadow = CCGetShadowFactorSoft2X(pos);\nelse if (pcf > 0.9) shadow = CCGetShadowFactorSoft(pos);\nelse shadow = CCGetShadowFactorHard(pos);\nshadow = mix(shadow, 1.0, cc_shadowNFLSInfo.w);\n}\n}\n#endif\ndirlightContrib *= shadow;\nfinalColor *= dirlightContrib;\nfloat fAmb = 0.5 - N.y * 0.5;\nvec3 ambDiff = mix(cc_ambientSky.rgb, cc_ambientGround.rgb, fAmb);\n#if CC_USE_IBL\n#if CC_USE_DIFFUSEMAP\nvec4 diffuseMap = textureCube(cc_diffuseMap, N);\n#if CC_USE_DIFFUSEMAP == 2\nambDiff = unpackRGBE(diffuseMap);\n#else\nambDiff = SRGBToLinear(diffuseMap.rgb);\n#endif\n#endif\nvec3 R = normalize(reflect(-V, N));\n#if USE_REFLECTION_DENOISE\nvec3 env = GetEnvReflectionWithMipFiltering(R, s.roughness, cc_ambientGround.w, 0.6);\n#else\nvec4 envmap = fragTextureLod(cc_environment, R, s.roughness * cc_ambientGround.w);\n#if CC_USE_IBL == 2\nvec3 env = unpackRGBE(envmap);\n#else\nvec3 env = SRGBToLinear(envmap.rgb);\n#endif\n#endif\nfinalColor += env * cc_ambientSky.w * specular * s.occlusion;\n#endif\nfinalColor += ambDiff.rgb * cc_ambientSky.w * diffuse * s.occlusion;\nfinalColor += s.emissive;\nreturn vec4(finalColor, s.albedo.a);\n}\n#if CC_PIPELINE_TYPE == 0\n# define LIGHTS_PER_PASS 1\n#else\n# define LIGHTS_PER_PASS 10\n#endif\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 0\nuniform highp vec4 cc_lightPos[LIGHTS_PER_PASS];\nuniform vec4 cc_lightColor[LIGHTS_PER_PASS];\nuniform vec4 cc_lightSizeRangeAngle[LIGHTS_PER_PASS];\nuniform vec4 cc_lightDir[LIGHTS_PER_PASS];\n#endif\nfloat SmoothDistAtt (float distSqr, float invSqrAttRadius) {\nfloat factor = distSqr * invSqrAttRadius;\nfloat smoothFactor = clamp(1.0 - factor * factor, 0.0, 1.0);\nreturn smoothFactor * smoothFactor;\n}\nfloat GetDistAtt (float distSqr, float invSqrAttRadius) {\nfloat attenuation = 1.0 / max(distSqr, 0.01*0.01);\nattenuation *= SmoothDistAtt(distSqr , invSqrAttRadius);\nreturn attenuation;\n}\nfloat GetAngleAtt (vec3 L, vec3 litDir, float litAngleScale, float litAngleOffset) {\nfloat cd = dot(litDir, L);\nfloat attenuation = clamp(cd * litAngleScale + litAngleOffset, 0.0, 1.0);\nreturn (attenuation * attenuation);\n}\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 0\nvec4 CCStandardShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / 3.14159265359;\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.0);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nint numLights = CC_PIPELINE_TYPE == 0 ? LIGHTS_PER_PASS : int(cc_lightDir[0].w);\nfor (int i = 0; i < LIGHTS_PER_PASS; i++) {\nif (i >= numLights) break;\nvec3 SLU = cc_lightPos[i].xyz - position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.0);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = cc_lightSizeRangeAngle[i].x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = 3.14159265359 * (litRadiusSqr / max(litRadiusSqr , distSqr));\nfloat attRadiusSqrInv = 1.0 / max(cc_lightSizeRangeAngle[i].y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (cc_lightPos[i].w > 0.0) {\nfloat cosInner = max(dot(-cc_lightDir[i].xyz, SL), 0.01);\nfloat cosOuter = cc_lightSizeRangeAngle[i].z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -cc_lightDir[i].xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = cc_lightColor[i].rgb;\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (cc_lightPos[i].w > 0.0 && cc_lightSizeRangeAngle[i].w > 0.0) {\n{\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) shadow = CCGetSpotLightShadowFactorSoft2X(shadowPos, position);\nelse if (pcf > 0.9) shadow = CCGetSpotLightShadowFactorSoft(shadowPos, position);\nelse shadow = CCGetSpotLightShadowFactorHard(shadowPos, position);\n}\n}\n#endif\nlightColor *= shadow;\nfinalColor += SNL * lightColor * cc_lightColor[i].w * illum * att * (diffuseContrib + lspec);\n}\nreturn vec4(finalColor, 0.0);\n}\n#endif\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 1\nreadonly buffer b_ccLightsBuffer { vec4 b_ccLights[]; };\nreadonly buffer b_clusterLightIndicesBuffer { uint b_clusterLightIndices[]; };\nreadonly buffer b_clusterLightGridBuffer { uvec4 b_clusterLightGrid[]; };\nstruct CCLight\n{\nvec4 cc_lightPos;\nvec4 cc_lightColor;\nvec4 cc_lightSizeRangeAngle;\nvec4 cc_lightDir;\n};\nstruct Cluster\n{\nvec3 minBounds;\nvec3 maxBounds;\n};\nstruct LightGrid\n{\nuint offset;\nuint ccLights;\n};\nCCLight getCCLight(uint i)\n{\nCCLight light;\nlight.cc_lightPos = b_ccLights[4u * i + 0u];\nlight.cc_lightColor = b_ccLights[4u * i + 1u];\nlight.cc_lightSizeRangeAngle = b_ccLights[4u * i + 2u];\nlight.cc_lightDir = b_ccLights[4u * i + 3u];\nreturn light;\n}\nLightGrid getLightGrid(uint cluster)\n{\nuvec4 gridvec = b_clusterLightGrid[cluster];\nLightGrid grid;\ngrid.offset = gridvec.x;\ngrid.ccLights = gridvec.y;\nreturn grid;\n}\nuint getGridLightIndex(uint start, uint offset)\n{\nreturn b_clusterLightIndices[start + offset];\n}\nuint getClusterZIndex(vec4 worldPos)\n{\nfloat scale = float(24) / log(cc_nearFar.y / cc_nearFar.x);\nfloat bias = -(float(24) * log(cc_nearFar.x) / log(cc_nearFar.y / cc_nearFar.x));\nfloat eyeDepth = -(cc_matView * worldPos).z;\nuint zIndex = uint(max(log(eyeDepth) * scale + bias, 0.0));\nreturn zIndex;\n}\nuint getClusterIndex(vec4 fragCoord, vec4 worldPos)\n{\nuint zIndex = getClusterZIndex(worldPos);\nfloat clusterSizeX = ceil(cc_viewPort.z / float(16));\nfloat clusterSizeY = ceil(cc_viewPort.w / float(8));\nuvec3 indices = uvec3(uvec2(fragCoord.xy / vec2(clusterSizeX, clusterSizeY)), zIndex);\nuint cluster = (16u * 8u) * indices.z + 16u * indices.y + indices.x;\nreturn cluster;\n}\nvec4 CCClusterShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / 3.14159265359;\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.001);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nuint cluster = getClusterIndex(gl_FragCoord, vec4(position, 1.0));\nLightGrid grid = getLightGrid(cluster);\nuint numLights = grid.ccLights;\nfor (uint i = 0u; i < 100u; i++) {\nif (i >= numLights) break;\nuint lightIndex = getGridLightIndex(grid.offset, i);\nCCLight light = getCCLight(lightIndex);\nvec3 SLU = light.cc_lightPos.xyz - position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.001);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = light.cc_lightSizeRangeAngle.x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = 3.14159265359 * (litRadiusSqr / max(litRadiusSqr , distSqr));\nfloat attRadiusSqrInv = 1.0 / max(light.cc_lightSizeRangeAngle.y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (light.cc_lightPos.w > 0.0) {\nfloat cosInner = max(dot(-light.cc_lightDir.xyz, SL), 0.01);\nfloat cosOuter = light.cc_lightSizeRangeAngle.z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -light.cc_lightDir.xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = light.cc_lightColor.rgb;\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (light.cc_lightPos.w > 0.0) {\n{\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) shadow = CCGetSpotLightShadowFactorSoft2X(shadowPos, position);\nelse if (pcf > 0.9) shadow = CCGetSpotLightShadowFactorSoft(shadowPos, position);\nelse shadow = CCGetSpotLightShadowFactorHard(shadowPos, position);\n}\n}\n#endif\nlightColor *= shadow;\nfinalColor += SNL * lightColor * light.cc_lightColor.w * illum * att * (diffuseContrib + lspec);\n}\nreturn vec4(finalColor, 0.0);\n}\n#endif\nvec3 ACESToneMap (vec3 color) {\ncolor = min(color, vec3(8.0));\nconst float A = 2.51;\nconst float B = 0.03;\nconst float C = 2.43;\nconst float D = 0.59;\nconst float E = 0.14;\nreturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = ACESToneMap(color.rgb);\n#endif\ncolor.rgb = sqrt(color.rgb);\nreturn color;\n}\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\nvoid CC_APPLY_FOG_BASE(inout vec4 color, float factor) {\ncolor = vec4(mix(cc_fogColor.rgb, color.rgb, factor), color.a);\n}\nvec2 signNotZero(vec2 v) {\nreturn vec2((v.x >= 0.0) ? +1.0 : -1.0, (v.y >= 0.0) ? +1.0 : -1.0);\n}\nvec3 oct_to_float32x3(vec2 e) {\nvec3 v = vec3(e.xy, 1.0 - abs(e.x) - abs(e.y));\nif (v.z < 0.0) v.xy = (1.0 - abs(v.yx)) * signNotZero(v.xy);\nreturn normalize(v);\n}\nvec4 screen2WS(vec3 coord) {\nvec3 ndc = vec3(\n2.0 * (coord.x - cc_viewPort.x) / cc_viewPort.z - 1.0,\n2.0 * (coord.y - cc_viewPort.y) / cc_viewPort.w - 1.0,\n2.0 * coord.z - 1.0);\nvec4 world = ((cc_matViewProjInv) * (vec4(ndc, 1.0)));\nworld      = world / world.w;\nreturn world;\n}\nvarying vec2 v_uv;\n#if CC_DEVICE_CAN_BENEFIT_FROM_INPUT_ATTACHMENT\n#else\nuniform sampler2D gbuffer_albedoMap;\nuniform sampler2D gbuffer_normalMap;\nuniform sampler2D gbuffer_emissiveMap;\n#endif\nuniform sampler2D depth_stencil;\n#if !CC_DEVICE_CAN_BENEFIT_FROM_INPUT_ATTACHMENT || __VERSION__ >= 450\n#endif\nvoid main () {\nStandardSurface s;\n#if CC_DEVICE_CAN_BENEFIT_FROM_INPUT_ATTACHMENT\nvec4 albedoMap = gl_LastFragData[0];\nvec4 normalMap = gl_LastFragData[1];\nvec4 emissiveMap = gl_LastFragDat[2];\n#else\nvec4 albedoMap = texture2D(gbuffer_albedoMap,v_uv);\nvec4 normalMap = texture2D(gbuffer_normalMap,v_uv);\nvec4 emissiveMap = texture2D(gbuffer_emissiveMap,v_uv);\n#endif\nfloat depth = texture2D(depth_stencil, v_uv).x;\ns.albedo = albedoMap;\nvec3 position = screen2WS(vec3(gl_FragCoord.xy, depth)).xyz;\ns.position = position;\ns.roughness = normalMap.z;\ns.normal = oct_to_float32x3(normalMap.xy);\ns.metallic = normalMap.w;\ns.emissive = emissiveMap.xyz;\ns.occlusion = emissiveMap.w;\nfloat fogFactor;\nCC_TRANSFER_FOG_BASE(vec4(position, 1), fogFactor);\nvec4 shadowPos;\nshadowPos = cc_matLightViewProj * vec4(position, 1);\nvec4 color = CCStandardShadingBase(s, shadowPos) +\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 1\nCCClusterShadingAdditive(s, shadowPos);\n#else\nCCStandardShadingAdditive(s, shadowPos);\n#endif\nCC_APPLY_FOG_BASE(color, fogFactor);\ncolor = CCFragOutput(color);\n#if CC_DEVICE_CAN_BENEFIT_FROM_INPUT_ATTACHMENT\ngl_FragData[2] = color;\n#else\ngl_FragColor = color;\n#endif\n}"}],[{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_MORPH\nattribute float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\nuniform vec4 cc_displacementWeights[15];\nuniform vec4 cc_displacementTextureInfo;\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 uv = getPixelCoordFromLocation(location, cc_displacementTextureInfo.xy);\nreturn texture2D(tex, uv);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture2D(tex, x)),\ndecode32(texture2D(tex, y)),\ndecode32(texture2D(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nattribute vec4 a_joints;\nattribute vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nattribute highp vec4 a_jointAnimInfo;\n#endif\nuniform highp vec4 cc_jointTextureInfo;\nuniform highp vec4 cc_jointAnimInfo;\nuniform highp sampler2D cc_jointTexture;\n#else\nuniform highp vec4 cc_joints[90];\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matProj;\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_mainLitDir;\n#if USE_INSTANCING\nattribute vec4 a_matWorld0;\nattribute vec4 a_matWorld1;\nattribute vec4 a_matWorld2;\n#if USE_LIGHTMAP\nattribute vec4 a_lightingMapUVParam;\n#endif\n#elif USE_BATCHING\nattribute float a_dyn_batch_id;\nuniform highp mat4 cc_matWorlds[10];\n#else\nuniform highp mat4 cc_matWorld;\n#endif\nuniform mediump vec4 cc_planarNDInfo;\nvarying float v_dist;\nvec4 vert () {\nvec4 position;\nposition = vec4(a_position, 1.0);\n#if CC_USE_MORPH\napplyMorph(position);\n#endif\n#if CC_USE_SKINNING\nCCSkin(position);\n#endif\nmat4 matWorld;\n#if USE_INSTANCING\nmatWorld = mat4(\nvec4(a_matWorld0.xyz, 0.0),\nvec4(a_matWorld1.xyz, 0.0),\nvec4(a_matWorld2.xyz, 0.0),\nvec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n);\n#elif USE_BATCHING\nmatWorld = cc_matWorlds[int(a_dyn_batch_id)];\n#else\nmatWorld = cc_matWorld;\n#endif\nvec3 P = (matWorld * position).xyz;\nvec3 L = cc_mainLitDir.xyz;\nvec3 N = cc_planarNDInfo.xyz;\nfloat d = cc_planarNDInfo.w + 0.001;\nfloat dist = (-d - dot(P, N)) / (dot(L, N) + 0.0001);\nvec3 shadowPos = P + L * dist;\nvec3 view = normalize(cc_cameraPos.xyz - shadowPos);\nfloat viewLength = length(cc_cameraPos.xyz - shadowPos);\nshadowPos += view * min(1.0, 0.005 * viewLength);\nposition = cc_matProj * cc_matView * vec4(shadowPos, 1.0);\nv_dist = dist;\nreturn position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nuniform lowp vec4 cc_shadowColor;\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nvarying float v_dist;\nvec4 frag () {\nif(v_dist < 0.0)\ndiscard;\nreturn CCFragOutput(cc_shadowColor);\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_MORPH\nattribute float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\nuniform vec4 cc_displacementWeights[15];\nuniform vec4 cc_displacementTextureInfo;\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 uv = getPixelCoordFromLocation(location, cc_displacementTextureInfo.xy);\nreturn texture2D(tex, uv);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture2D(tex, x)),\ndecode32(texture2D(tex, y)),\ndecode32(texture2D(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nattribute vec4 a_joints;\nattribute vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nattribute highp vec4 a_jointAnimInfo;\n#endif\nuniform highp vec4 cc_jointTextureInfo;\nuniform highp vec4 cc_jointAnimInfo;\nuniform highp sampler2D cc_jointTexture;\n#else\nuniform highp vec4 cc_joints[90];\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nuniform highp vec4 cc_cameraPos;\nvarying vec2 v_uv;\nvoid main () {\nStandardVertInput In;\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In);\n#endif\nIn.position.xy = cc_cameraPos.w == 0.0 ? vec2(In.position.xy.x, -In.position.xy.y) : In.position.xy;\ngl_Position = In.position;\ngl_Position.y = gl_Position.y;\nv_uv = a_texCoord;\n}",frag:"\nprecision highp float;\nuniform mediump vec4 cc_screenSize;\n#if ANTIALIAS_TYPE == 1\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 resolution,\nvec2 v_rgbNW, vec2 v_rgbNE,\nvec2 v_rgbSW, vec2 v_rgbSE,\nvec2 v_rgbM) {\nvec4 color;\nmediump vec2 inverseVP = vec2(1.0 / resolution.x, 1.0 / resolution.y);\nvec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\nvec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\nvec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\nvec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\nvec4 texColor = texture2D(tex, v_rgbM);\nvec3 rgbM  = texColor.xyz;\nvec3 luma = vec3(0.299, 0.587, 0.114);\nfloat lumaNW = dot(rgbNW, luma);\nfloat lumaNE = dot(rgbNE, luma);\nfloat lumaSW = dot(rgbSW, luma);\nfloat lumaSE = dot(rgbSE, luma);\nfloat lumaM  = dot(rgbM,  luma);\nfloat lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\nfloat lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\nmediump vec2 dir;\ndir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\ndir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\nfloat dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n(0.25 * (1.0 / 8.0)), (1.0/ 128.0));\nfloat rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\ndir = min(vec2(8.0, 8.0),\nmax(vec2(-8.0, -8.0),\ndir * rcpDirMin)) * inverseVP;\nvec3 rgbA = 0.5 * (\ntexture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\ntexture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\nvec3 rgbB = rgbA * 0.5 + 0.25 * (\ntexture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\ntexture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\nfloat lumaB = dot(rgbB, luma);\nif ((lumaB < lumaMin) || (lumaB > lumaMax))\ncolor = vec4(rgbA, texColor.a);\nelse\ncolor = vec4(rgbB, texColor.a);\nreturn color;\n}\n#endif\nvarying vec2 v_uv;\nuniform sampler2D outputResultMap;\nvoid texcoords(vec2 fragCoord, vec2 resolution,\nout vec2 v_rgbNW, out vec2 v_rgbNE,\nout vec2 v_rgbSW, out vec2 v_rgbSE,\nout vec2 v_rgbM) {\nvec2 inverseVP = 1.0 / resolution.xy;\nv_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\nv_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\nv_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\nv_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\nv_rgbM = vec2(fragCoord * inverseVP);\n}\nvoid main () {\nmediump vec2 v_rgbNW;\nmediump vec2 v_rgbNE;\nmediump vec2 v_rgbSW;\nmediump vec2 v_rgbSE;\nmediump vec2 v_rgbM;\n#if ANTIALIAS_TYPE == 1\nvec2 resolution = cc_screenSize.xy;\nvec2 fragCoord = v_uv * resolution;\ntexcoords(fragCoord, resolution, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\ngl_FragColor = fxaa(outputResultMap, fragCoord, resolution, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n#else\ngl_FragColor = texture2D(outputResultMap, v_uv);\n#endif\n}"}],[{vert:"\nprecision highp float;\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matProj;\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\nvarying mediump vec4 viewDir;\nvec4 vert () {\nviewDir = vec4(a_position, 1.0);\nmat4 matViewRotOnly = mat4(mat3(cc_matView));\nvec4 pos = matViewRotOnly * viewDir;\nif (cc_matProj[3].w > 0.0) {\nmat4 matProj = cc_matProj;\nmatProj[0].x = 5.2;\nmatProj[1].y = 2.6;\nmatProj[2].zw = vec2(-1.0);\nmatProj[3].zw = vec2(0.0);\npos = matProj * pos;\n} else {\npos = cc_matProj * pos;\n}\npos.z = 0.99999 * pos.w;\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nuniform mediump vec4 cc_ambientSky;\nuniform samplerCube cc_environment;\nvec3 unpackRGBE (vec4 rgbe) {\nreturn rgbe.rgb * pow(1.1, rgbe.a * 255.0 - 128.0);\n}\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nvec3 ACESToneMap (vec3 color) {\ncolor = min(color, vec3(8.0));\nconst float A = 2.51;\nconst float B = 0.03;\nconst float C = 2.43;\nconst float D = 0.59;\nconst float E = 0.14;\nreturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = ACESToneMap(color.rgb);\n#endif\ncolor.rgb = sqrt(color.rgb);\nreturn color;\n}\nvarying mediump vec4 viewDir;\nvec4 frag () {\n#if USE_RGBE_CUBEMAP\nvec3 c = unpackRGBE(textureCube(cc_environment, viewDir.xyz));\n#else\nvec3 c = SRGBToLinear(textureCube(cc_environment, viewDir.xyz).rgb);\n#endif\nreturn CCFragOutput(vec4(c * cc_ambientSky.w, 1.0));\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nuniform highp mat4 cc_matProj;\nattribute vec3 a_position;\nattribute vec4 a_color;\nvarying vec2 v_uv;\nuniform vec4 offset;\nuniform vec4 digits[20];\nfloat getComponent(vec4 v, float i) {\nif (i < 1.0) { return v.x; }\nelse if (i < 2.0) { return v.y; }\nelse if (i < 3.0) { return v.z; }\nelse { return v.w; }\n}\nvec4 vert () {\nmat2 proj = mat2(cc_matProj[0].xy, cc_matProj[1].xy);\nproj /= abs(proj[1].x + proj[1].y);\nvec2 position = proj * a_position.xy + offset.xy;\nv_uv = a_color.xy;\nif (a_color.z >= 0.0) {\nfloat n = getComponent(digits[int(a_color.z)], a_color.w);\nv_uv += vec2(offset.z * n, 0.0);\n}\nreturn vec4(position, 0.0, 1.0);\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nvarying vec2 v_uv;\nuniform sampler2D mainTexture;\nvec4 frag () {\nreturn CCFragOutput(texture2D(mainTexture, v_uv));\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nattribute vec2 a_position;\nattribute vec2 a_texCoord;\nvarying vec2 v_uv;\nuniform vec4 u_buffer0;\nuniform vec4 u_buffer1;\nuniform mat4 u_projection;\nvec4 vert () {\nvec2 worldPos = a_position * u_buffer1.xy + u_buffer1.zw;\nvec2 clipSpace = worldPos / u_buffer0.xy * 2.0 - 1.0;\nvec4 screenPos = u_projection * vec4(clipSpace, 0.0, 1.0);\nv_uv = a_texCoord;\nreturn screenPos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nvarying vec2 v_uv;\nuniform float u_percent;\nuniform sampler2D mainTexture;\nvec4 frag () {\nvec4 color = texture2D(mainTexture, v_uv);\nfloat percent = clamp(u_percent, 0.0, 1.0);\ncolor.xyz *= percent;\nreturn color;\n}\nvoid main() { gl_FragColor = frag(); }"}]],glsl3:[[{vert:"\nprecision mediump float;\nlayout(std140) uniform Constants {\nvec4 mainTiling_Offset;\nvec4 frameTile_velLenScale;\nvec4 scale;\nvec4 nodeRotation;\n};\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\nmat3 m = mat3(xAxis,yAxis,zAxis);\nfloat trace = m[0][0] + m[1][1] + m[2][2];\nvec4 quat;\nif (trace > 0.) {\nfloat s = 0.5 / sqrt(trace + 1.0);\nquat.w = 0.25 / s;\nquat.x = (m[2][1] - m[1][2]) * s;\nquat.y = (m[0][2] - m[2][0]) * s;\nquat.z = (m[1][0] - m[0][1]) * s;\n} else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\nfloat s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\nquat.w = (m[2][1] - m[1][2]) / s;\nquat.x = 0.25 * s;\nquat.y = (m[0][1] + m[1][0]) / s;\nquat.z = (m[0][2] + m[2][0]) / s;\n} else if (m[1][1] > m[2][2]) {\nfloat s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\nquat.w = (m[0][2] - m[2][0]) / s;\nquat.x = (m[0][1] + m[1][0]) / s;\nquat.y = 0.25 * s;\nquat.z = (m[1][2] + m[2][1]) / s;\n} else {\nfloat s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\nquat.w = (m[1][0] - m[0][1]) / s;\nquat.x = (m[0][2] + m[2][0]) / s;\nquat.y = (m[1][2] + m[2][1]) / s;\nquat.z = 0.25 * s;\n}\nfloat len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\nif (len > 0.) {\nlen = 1. / sqrt(len);\nquat.x = quat.x * len;\nquat.y = quat.y * len;\nquat.z = quat.z * len;\nquat.w = quat.w * len;\n}\nreturn quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\nfloat x = angle.x / 2.;\nfloat y = angle.y / 2.;\nfloat z = angle.z / 2.;\nfloat sx = sin(x);\nfloat cx = cos(x);\nfloat sy = sin(y);\nfloat cy = cos(y);\nfloat sz = sin(z);\nfloat cz = cos(z);\nvec4 quat = vec4(0);\nquat.x = sx * cy * cz + cx * sy * sz;\nquat.y = cx * sy * cz + sx * cy * sz;\nquat.z = cx * cy * sz - sx * sy * cz;\nquat.w = cx * cy * cz - sx * sy * sz;\nreturn quat;\n}\nvec4 quatMultiply (vec4 a, vec4 b){\nvec4 quat;\nquat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\nquat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\nquat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\nquat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\nreturn quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\nfloat ix = q.w * v.x + q.y * v.z - q.z * v.y;\nfloat iy = q.w * v.y + q.z * v.x - q.x * v.z;\nfloat iz = q.w * v.z + q.x * v.y - q.y * v.x;\nfloat iw = -q.x * v.x - q.y * v.y - q.z * v.z;\nv.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\nv.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\nv.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\nvec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\nvec4 rotQuat = quatMultiply(viewQuat, q);\nrotateVecFromQuat(pos, rotQuat);\nreturn pos;\n}\nout mediump vec2 uv;\nout mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n, mat4 viewInv\n) {\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\nvec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\nvec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n}\nin vec3 a_position;\nin vec2 a_texCoord;\nin vec4 a_color;\nlayout(std140) uniform builtin {\nvec4 cc_size_rotation;\n};\nvec4 vs_main() {\nvec4 pos = vec4(a_position, 1);\npos = cc_matWorld * pos;\nvec2 vertOffset = a_texCoord.xy - 0.5;\ncomputeVertPos(pos, vertOffset, quaternionFromEuler(vec3(0., 0., cc_size_rotation.z)), vec3(cc_size_rotation.xy, 0.), cc_matViewInv);\npos = cc_matViewProj * pos;\nuv = a_texCoord.xy;\ncolor = a_color;\nreturn pos;\n}\nvoid main() { gl_Position = vs_main(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nin vec2 uv;\nin vec4 color;\nuniform sampler2D mainTexture;\nlayout(std140) uniform FragConstants {\nvec4 tintColor;\n};\nvec4 add () {\nvec4 col = 2.0 * color * tintColor * texture(mainTexture, uv);\nreturn CCFragOutput(col);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nin vec3 a_position;\nvec4 vert () {\nvec4 pos = vec4(a_position, 1);\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 frag () {\nvec4 o = vec4(1.0);\nreturn o;\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\nin vec3 a_position;\nin vec4 a_color;\nout vec4 v_color;\nin float a_dist;\nout float v_dist;\nvec4 vert () {\nvec4 pos = vec4(a_position, 1);\npos = cc_matViewProj * cc_matWorld * pos;\nv_color = a_color;\nv_dist = a_dist;\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nin vec4 v_color;\nin float v_dist;\nvec4 frag () {\nvec4 o = v_color;\nfloat aa = fwidth(v_dist);\nfloat alpha = 1. - smoothstep(-aa, 0., abs(v_dist) - 1.0);\no.rgb *= o.a;\no *= alpha;\nreturn o;\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nlayout(std140) uniform CCWorldBound {\nhighp vec4 cc_worldBoundCenter;\nhighp vec4 cc_worldBoundHalfExtents;\n};\nin vec3 a_position;\nvec4 vert () {\nvec4 position;\nposition = vec4(a_position, 1.0);\nposition *= cc_worldBoundHalfExtents;\nposition += cc_worldBoundCenter;\nposition = cc_matViewProj * position;\nreturn position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nvec4 frag () {\nreturn vec4(1, 0, 0, 1);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\nmat3 m = mat3(xAxis,yAxis,zAxis);\nfloat trace = m[0][0] + m[1][1] + m[2][2];\nvec4 quat;\nif (trace > 0.) {\nfloat s = 0.5 / sqrt(trace + 1.0);\nquat.w = 0.25 / s;\nquat.x = (m[2][1] - m[1][2]) * s;\nquat.y = (m[0][2] - m[2][0]) * s;\nquat.z = (m[1][0] - m[0][1]) * s;\n} else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\nfloat s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\nquat.w = (m[2][1] - m[1][2]) / s;\nquat.x = 0.25 * s;\nquat.y = (m[0][1] + m[1][0]) / s;\nquat.z = (m[0][2] + m[2][0]) / s;\n} else if (m[1][1] > m[2][2]) {\nfloat s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\nquat.w = (m[0][2] - m[2][0]) / s;\nquat.x = (m[0][1] + m[1][0]) / s;\nquat.y = 0.25 * s;\nquat.z = (m[1][2] + m[2][1]) / s;\n} else {\nfloat s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\nquat.w = (m[1][0] - m[0][1]) / s;\nquat.x = (m[0][2] + m[2][0]) / s;\nquat.y = (m[1][2] + m[2][1]) / s;\nquat.z = 0.25 * s;\n}\nfloat len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\nif (len > 0.) {\nlen = 1. / sqrt(len);\nquat.x = quat.x * len;\nquat.y = quat.y * len;\nquat.z = quat.z * len;\nquat.w = quat.w * len;\n}\nreturn quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\nfloat x = angle.x / 2.;\nfloat y = angle.y / 2.;\nfloat z = angle.z / 2.;\nfloat sx = sin(x);\nfloat cx = cos(x);\nfloat sy = sin(y);\nfloat cy = cos(y);\nfloat sz = sin(z);\nfloat cz = cos(z);\nvec4 quat = vec4(0);\nquat.x = sx * cy * cz + cx * sy * sz;\nquat.y = cx * sy * cz + sx * cy * sz;\nquat.z = cx * cy * sz - sx * sy * cz;\nquat.w = cx * cy * cz - sx * sy * sz;\nreturn quat;\n}\nmat4 matrixFromRT (vec4 q, vec3 p){\nfloat x2 = q.x + q.x;\nfloat y2 = q.y + q.y;\nfloat z2 = q.z + q.z;\nfloat xx = q.x * x2;\nfloat xy = q.x * y2;\nfloat xz = q.x * z2;\nfloat yy = q.y * y2;\nfloat yz = q.y * z2;\nfloat zz = q.z * z2;\nfloat wx = q.w * x2;\nfloat wy = q.w * y2;\nfloat wz = q.w * z2;\nreturn mat4(\n1. - (yy + zz), xy + wz, xz - wy, 0,\nxy - wz, 1. - (xx + zz), yz + wx, 0,\nxz + wy, yz - wx, 1. - (xx + yy), 0,\np.x, p.y, p.z, 1\n);\n}\nmat4 matFromRTS (vec4 q, vec3 t, vec3 s){\nfloat x = q.x, y = q.y, z = q.z, w = q.w;\nfloat x2 = x + x;\nfloat y2 = y + y;\nfloat z2 = z + z;\nfloat xx = x * x2;\nfloat xy = x * y2;\nfloat xz = x * z2;\nfloat yy = y * y2;\nfloat yz = y * z2;\nfloat zz = z * z2;\nfloat wx = w * x2;\nfloat wy = w * y2;\nfloat wz = w * z2;\nfloat sx = s.x;\nfloat sy = s.y;\nfloat sz = s.z;\nreturn mat4((1. - (yy + zz)) * sx, (xy + wz) * sx, (xz - wy) * sx, 0,\n(xy - wz) * sy, (1. - (xx + zz)) * sy, (yz + wx) * sy, 0,\n(xz + wy) * sz, (yz - wx) * sz, (1. - (xx + yy)) * sz, 0,\nt.x, t.y, t.z, 1);\n}\nvec4 quatMultiply (vec4 a, vec4 b){\nvec4 quat;\nquat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\nquat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\nquat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\nquat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\nreturn quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\nfloat ix = q.w * v.x + q.y * v.z - q.z * v.y;\nfloat iy = q.w * v.y + q.z * v.x - q.x * v.z;\nfloat iz = q.w * v.z + q.x * v.y - q.y * v.x;\nfloat iw = -q.x * v.x - q.y * v.y - q.z * v.z;\nv.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\nv.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\nv.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\nvec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\nvec4 rotQuat = quatMultiply(viewQuat, q);\nrotateVecFromQuat(pos, rotQuat);\nreturn pos;\n}\nmat3 quatToMat3(vec4 q) {\nvec3 m0 = vec3(\n1.0 - 2.0 * q.y * q.y - 2.0 * q.z * q.z,\n2.0 * q.x * q.y + 2.0 * q.w * q.z,\n2.0 * q.x * q.z - 2.0 * q.w * q.y);\nvec3 m1 = vec3(\n2.0 * q.x * q.y - 2.0 * q.w * q.z,\n1.0 - 2.0 * q.x * q.x - 2.0 * q.z * q.z,\n2.0 * q.y * q.z + 2.0 * q.w * q.x);\nvec3 m2 = vec3(\n2.0 * q.x * q.z + 2.0 * q.w * q.y,\n2.0 * q.y * q.z - 2.0 * q.w * q.x,\n1.0 - 2.0 * q.x * q.x - 2.0 * q.y * q.y);\nreturn mat3(m0, m1, m2);\n}\nvec4 mat3ToQuat(mat3 mat) {\nfloat tr = mat[0][0] + mat[1][1] + mat[2][2];\nfloat qw, qx, qy, qz;\nif (tr > 0.0) {\nfloat S = sqrt(tr + 1.0) * 2.0;\nfloat invS = 1.0 / S;\nqw = 0.25 * S;\nqx = (mat[1][2] - mat[2][1]) * invS;\nqy = (mat[2][0] - mat[0][2]) * invS;\nqz = (mat[0][1] - mat[1][0]) * invS;\n} else if ((mat[0][0] > mat[1][1])&&(mat[0][0] > mat[2][2])) {\nfloat S = sqrt(1.0 + mat[0][0] - mat[1][1] - mat[2][2]) * 2.0;\nfloat invS = 1.0 / S;\nqw = (mat[1][2] - mat[2][1]) * invS;\nqx = 0.25 * S;\nqy = (mat[1][0] + mat[0][1]) * invS;\nqz = (mat[2][0] + mat[0][2]) * invS;\n} else if (mat[1][1] > mat[2][2]) {\nfloat S = sqrt(1.0 + mat[1][1] - mat[0][0] - mat[2][2]) * 2.0;\nfloat invS = 1.0 / S;\nqw = (mat[2][0] - mat[0][2]) * invS;\nqx = (mat[1][0] + mat[0][1]) * invS;\nqy = 0.25 * S;\nqz = (mat[2][1] + mat[1][2]) * invS;\n} else {\nfloat S = sqrt(1.0 + mat[2][2] - mat[0][0] - mat[1][1]) * 2.0;\nfloat invS = 1.0 / S;\nqw = (mat[0][1] - mat[1][0]) * invS;\nqx = (mat[2][0] + mat[0][2]) * invS;\nqy = (mat[2][1] + mat[1][2]) * invS;\nqz = 0.25 * S;\n}\nreturn vec4(qx, qy, qz, qw);\n}\nvec4 eulerToQuat(vec3 euler) {\nvec3 er = euler * 0.5;\nfloat x = er.x, y = er.y, z = er.z;\nfloat sx = sin(x);\nfloat cx = cos(x);\nfloat sy = sin(y);\nfloat cy = cos(y);\nfloat sz = sin(z);\nfloat cz = cos(z);\nvec4 quat;\nquat.x = sx * cy * cz + cx * sy * sz;\nquat.y = cx * sy * cz + sx * cy * sz;\nquat.z = cx * cy * sz - sx * sy * cz;\nquat.w = cx * cy * cz - sx * sy * sz;\nreturn quat;\n}\nlayout(std140) uniform Constants {\nvec4 mainTiling_Offset;\nvec4 frameTile_velLenScale;\nvec4 scale;\nvec4 nodeRotation;\n};\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\nout mediump vec2 uv;\nout mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n, mat4 viewInv\n#endif\n#if CC_RENDER_MODE == 1\n, vec3 eye\n, vec4 velocity\n, float velocityScale\n, float lengthScale\n, float xIndex\n#endif\n) {\n#if CC_RENDER_MODE == 0\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\nvec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\nvec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n#elif CC_RENDER_MODE == 1\nvec3 camRight = normalize(cross(pos.xyz - eye, velocity.xyz)) * s.x;\nvec3 camUp = velocity.xyz * velocityScale + normalize(velocity.xyz) * lengthScale * s.y;\npos.xyz += (camRight * abs(vertOffset.x) * sign(vertOffset.y)) - camUp * xIndex;\n#elif CC_RENDER_MODE == 2\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = vec3(1, 0, 0);\nvec3 camY = vec3(0, 0, -1);\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, cross(camX, camY), q);\n#elif CC_RENDER_MODE == 3\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nrotateVecFromQuat(viewSpaceVert, q);\nvec3 camX = normalize(vec3(cc_matView[0][0], cc_matView[1][0], cc_matView[2][0]));\nvec3 camY = vec3(0, 1, 0);\nvec3 offset = camX * viewSpaceVert.x + camY * viewSpaceVert.y;\npos.xyz += offset;\n#else\npos.x += vertOffset.x;\npos.y += vertOffset.y;\n#endif\n}\nvec2 computeUV (float frameIndex, vec2 vertIndex, vec2 frameTile){\nvec2 aniUV = vec2(0, floor(frameIndex * frameTile.y));\naniUV.x = floor(frameIndex * frameTile.x * frameTile.y - aniUV.y * frameTile.x);\n#if CC_RENDER_MODE != 4\nvertIndex.y = 1. - vertIndex.y;\n#endif\nreturn (aniUV.xy + vertIndex) / vec2(frameTile.x, frameTile.y);\n}\nlayout(std140) uniform SampleConstants {\nvec4 u_sampleInfo;\n};\nlayout(std140) uniform TickConstants {\nvec4 u_worldRot;\nvec4 u_timeDelta;\n};\nin vec4 a_position_starttime;\nin vec4 a_size_uv;\nin vec4 a_rotation_uv;\nin vec4 a_color;\nin vec4 a_dir_life;\nin float a_rndSeed;\n#if CC_RENDER_MODE == 4\nin vec3 a_texCoord;\nin vec3 a_texCoord3;\nin vec3 a_normal;\nin vec4 a_color1;\n#endif\nvec3 unpackCurveData (sampler2D tex, vec2 coord) {\nvec4 a = texture(tex, coord);\nvec4 b = texture(tex, coord + u_sampleInfo.y);\nfloat c = fract(coord.x * u_sampleInfo.x);\nreturn mix(a.xyz, b.xyz, c);\n}\nvec3 unpackCurveData (sampler2D tex, vec2 coord, out float w) {\nvec4 a = texture(tex, coord);\nvec4 b = texture(tex, coord + u_sampleInfo.y);\nfloat c = fract(coord.x * u_sampleInfo.x);\nw = mix(a.w, b.w, c);\nreturn mix(a.xyz, b.xyz, c);\n}\nfloat pseudoRandom(float x) {\n#if USE_VK_SHADER\nfloat o = x;\nx = mod(x - 1.0, 2.0) - 1.0;\nfloat freqVar = 10.16640753482;\nfloat y = sin(freqVar * floor(o * 0.5 - 0.5));\nfloat v = max(0.0, 1.0-abs(x));\nv *= 0.7071067812;\nv = y < 0.0 ? -v : v;\nreturn v;\n#else\nfloat seed = mod(x, 233280.);\nfloat q = (seed * 9301. + 49297.) / 233280.;\nreturn fract(q);\n#endif\n}\n#if COLOR_OVER_TIME_MODULE_ENABLE\nuniform sampler2D color_over_time_tex0;\nlayout(std140) uniform ColorConstant {\nint u_color_mode;\n};\n#endif\n#if ROTATION_OVER_TIME_MODULE_ENABLE\nuniform sampler2D rotation_over_time_tex0;\nlayout(std140) uniform RotationConstant {\nint u_rotation_mode;\n};\n#endif\n#if SIZE_OVER_TIME_MODULE_ENABLE\nuniform sampler2D size_over_time_tex0;\nlayout(std140) uniform SizeConstant {\nint u_size_mode;\n};\n#endif\n#if FORCE_OVER_TIME_MODULE_ENABLE\nuniform sampler2D force_over_time_tex0;\nlayout(std140) uniform ForceConstant {\nint u_force_mode;\nint u_force_space;\n};\n#endif\n#if VELOCITY_OVER_TIME_MODULE_ENABLE\nuniform sampler2D velocity_over_time_tex0;\nlayout(std140) uniform VelocityConstant {\nint u_velocity_mode;\nint u_velocity_space;\n};\n#endif\n#if TEXTURE_ANIMATION_MODULE_ENABLE\nuniform sampler2D texture_animation_tex0;\nlayout(std140) uniform AnimationConstant {\nvec4 u_anim_info;\n};\n#endif\nfloat repeat (float t, float length) {\nreturn t - floor(t / length) * length;\n}\nvec4 rotateQuat (vec4 p, vec4 q) {\nvec3 iv = cross(q.xyz, p.xyz) + q.w * p.xyz;\nvec3 res = p.xyz + 2.0 * cross(q.xyz, iv);\nreturn vec4(res.xyz, p.w);\n}\nvec4 gpvs_main () {\nfloat activeTime = u_timeDelta.x - a_position_starttime.w;\nfloat normalizedTime = clamp(activeTime / a_dir_life.w, 0.0, 1.0);\nvec2 timeCoord0 = vec2(normalizedTime, 0.);\nvec2 timeCoord1 = vec2(normalizedTime, 1.);\n#if CC_RENDER_MODE == 4\nvec2 vertIdx = vec2(a_texCoord.x, a_texCoord.y);\n#else\nvec2 vertIdx = vec2(a_size_uv.w, a_rotation_uv.w);\n#endif\nvec4 velocity = vec4(a_dir_life.xyz, 0.);\nvec4 pos = vec4(a_position_starttime.xyz, 1.);\nvec3 size = a_size_uv.xyz;\n#if SIZE_OVER_TIME_MODULE_ENABLE\nif (u_size_mode == 1) {\nsize *= unpackCurveData(size_over_time_tex0, timeCoord0);\n} else {\nvec3 size_0 = unpackCurveData(size_over_time_tex0, timeCoord0);\nvec3 size_1 = unpackCurveData(size_over_time_tex0, timeCoord1);\nfloat factor_s = pseudoRandom(a_rndSeed + 39825.);\nsize *= mix(size_0, size_1, factor_s);\n}\n#endif\nvec3 compScale = scale.xyz * size;\n#if FORCE_OVER_TIME_MODULE_ENABLE\nvec3 forceAnim = vec3(0.);\nif (u_force_mode == 1) {\nforceAnim = unpackCurveData(force_over_time_tex0, timeCoord0);\n} else {\nvec3 force_0 = unpackCurveData(force_over_time_tex0, timeCoord0);\nvec3 force_1 = unpackCurveData(force_over_time_tex0, timeCoord1);\nfloat factor_f =  pseudoRandom(a_rndSeed + 212165.);\nforceAnim = mix(force_0, force_1, factor_f);\n}\nvec4 forceTrack = vec4(forceAnim, 0.);\nif (u_force_space == 0) {\nforceTrack = rotateQuat(forceTrack, u_worldRot);\n}\nvelocity.xyz += forceTrack.xyz;\n#endif\n#if VELOCITY_OVER_TIME_MODULE_ENABLE\nfloat speedModifier0 = 1.;\nfloat speedModifier1 = 1.;\nvec3 velocityAnim = vec3(0.);\nif (u_velocity_mode == 1) {\nvelocityAnim = unpackCurveData(velocity_over_time_tex0, timeCoord0, speedModifier0);\n} else {\nvec3 vectory_0 = unpackCurveData(velocity_over_time_tex0, timeCoord0, speedModifier0);\nvec3 vectory_1 = unpackCurveData(velocity_over_time_tex0, timeCoord1, speedModifier1);\nfloat factor_v = pseudoRandom(a_rndSeed + 197866.);\nvelocityAnim = mix(vectory_0, vectory_1, factor_v);\nspeedModifier0 = mix(speedModifier0, speedModifier1, factor_v);\n}\nvec4 velocityTrack = vec4(velocityAnim, 0.);\nif (u_velocity_space == 0) {\nvelocityTrack = rotateQuat(velocityTrack, u_worldRot);\n}\nvelocity.xyz += velocityTrack.xyz;\nvelocity.xyz *= speedModifier0;\n#endif\npos.xyz += velocity.xyz * normalizedTime * a_dir_life.w;\n#if !CC_USE_WORLD_SPACE\npos = cc_matWorld * pos;\n#if CC_RENDER_MODE == 1\nvelocity = rotateQuat(velocity, u_worldRot);\n#endif\n#endif\nvec3 startRotation = a_rotation_uv.xyz;\n#if CC_RENDER_MODE != 4\n#if CC_RENDER_MODE == 0\nvec3 rotEuler = startRotation.xyz;\n#elif CC_RENDER_MODE == 1\nvec3 rotEuler = vec3(0.);\n#else\nvec3 rotEuler = vec3(0., 0., startRotation.z);\n#endif\nvec4 rot = quaternionFromEuler(rotEuler);\n#else\nvec4 rot = quaternionFromEuler(startRotation);\n#endif\n#if ROTATION_OVER_TIME_MODULE_ENABLE\nif (u_rotation_mode == 1) {\nvec3 euler = unpackCurveData(rotation_over_time_tex0, timeCoord0) * normalizedTime * a_dir_life.w;\nvec4 quat = eulerToQuat(euler);\nmat3 mLocal = quatToMat3(quat);\nmat3 mStart = quatToMat3(rot);\nrot = mat3ToQuat(mStart * mLocal);\n} else {\nvec3 rotation_0 = unpackCurveData(rotation_over_time_tex0, timeCoord0);\nvec3 rotation_1 = unpackCurveData(rotation_over_time_tex0, timeCoord1);\nfloat factor_r = pseudoRandom(a_rndSeed + 125292.);\nvec3 euler = mix(rotation_0, rotation_1, factor_r) * normalizedTime * a_dir_life.w;\n#if CC_RENDER_MODE == 3 || CC_RENDER_MODE == 2\neuler = vec3(0.0, 0.0, euler.z);\n#endif\nvec4 quat = eulerToQuat(euler);\nmat3 mLocal = quatToMat3(quat);\nmat3 mStart = quatToMat3(rot);\nrot = mat3ToQuat(mStart * mLocal);\n}\n#endif\n#if COLOR_OVER_TIME_MODULE_ENABLE\nif (u_color_mode == 1) {\ncolor = a_color * texture(color_over_time_tex0, timeCoord0);\n} else {\nvec4 color_0 = texture(color_over_time_tex0, timeCoord0);\nvec4 color_1 = texture(color_over_time_tex0, timeCoord1);\nfloat factor_c = pseudoRandom(a_rndSeed + 91041.);\ncolor = a_color * mix(color_0, color_1, factor_c);\n}\n#else\ncolor = a_color;\n#endif\n#if CC_RENDER_MODE != 4\nvec2 cornerOffset = vec2((vertIdx - 0.5));\n#if CC_RENDER_MODE == 1\nrot = vec4(0.0, 0.0, 0.0, 1.0);\n#endif\ncomputeVertPos(pos, cornerOffset, rot, compScale\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n, cc_matViewInv\n#endif\n#if CC_RENDER_MODE == 1\n, cc_cameraPos.xyz\n, velocity\n, frameTile_velLenScale.z\n, frameTile_velLenScale.w\n, a_size_uv.w\n#endif\n);\n#else\nmat3 rotMat = quatToMat3(rot);\nmat3 nodeMat = quatToMat3(nodeRotation);\nrotMat = nodeMat * rotMat;\nrot = mat3ToQuat(rotMat);\nmat4 xformNoScale = matrixFromRT(rot, pos.xyz);\nmat4 xform = matFromRTS(rot, pos.xyz, compScale);\npos = xform * vec4(a_texCoord3, 1);\nvec4 normal = xformNoScale * vec4(a_normal, 0);\ncolor *= a_color1;\n#endif\npos = cc_matViewProj * pos;\nfloat frameIndex = 0.;\n#if TEXTURE_ANIMATION_MODULE_ENABLE\nfloat startFrame = 0.;\nvec3 frameInfo = vec3(0.);\nif (int(u_anim_info.x) == 1) {\nframeInfo = unpackCurveData(texture_animation_tex0, timeCoord0);\n} else {\nvec3 frameInfo0 = unpackCurveData(texture_animation_tex0, timeCoord0);\nvec3 frameInfo1 = unpackCurveData(texture_animation_tex0, timeCoord1);\nfloat factor_t = pseudoRandom(a_rndSeed + 90794.);\nframeInfo = mix(frameInfo0, frameInfo1, factor_t);\n}\nstartFrame = frameInfo.x / u_anim_info.y;\nframeIndex = repeat(u_anim_info.z * (frameInfo.y + startFrame), 1.);\n#endif\nuv = computeUV(frameIndex, vertIdx, frameTile_velLenScale.xy) * mainTiling_Offset.xy + mainTiling_Offset.zw;\nreturn pos;\n}\nvoid main() { gl_Position = gpvs_main(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nin vec2 uv;\nin vec4 color;\nuniform sampler2D mainTexture;\nlayout(std140) uniform FragConstants {\nvec4 tintColor;\n};\nvec4 add () {\nvec4 col = 2.0 * color * tintColor * texture(mainTexture, uv);\nreturn CCFragOutput(col);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = add(); }"}],[{vert:"\nprecision mediump float;\nlayout(std140) uniform Constants {\nvec4 mainTiling_Offset;\nvec4 frameTile_velLenScale;\nvec4 scale;\nvec4 nodeRotation;\n};\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\nout mediump vec2 uv;\nout mediump vec4 color;\nin vec3 a_position;\nin vec4 a_texCoord;\nin vec3 a_texCoord1;\nin vec3 a_texCoord2;\nin vec4 a_color;\n#if CC_DRAW_WIRE_FRAME\nout vec3 vBarycentric;\n#endif\nvec4 vs_main() {\nhighp vec4 pos = vec4(a_position, 1);\nvec4 velocity = vec4(a_texCoord1.xyz, 0);\n#if !CC_USE_WORLD_SPACE\npos = cc_matWorld * pos;\nvelocity = cc_matWorld * velocity;\n#endif\nfloat vertOffset = (a_texCoord.x - 0.5) * a_texCoord.y;\nvec3 camUp = normalize(cross(pos.xyz - cc_cameraPos.xyz, velocity.xyz));\npos.xyz += camUp * vertOffset;\npos = cc_matViewProj * pos;\nuv = a_texCoord.zw * mainTiling_Offset.xy + mainTiling_Offset.zw;;\ncolor = a_color;\n#if CC_DRAW_WIRE_FRAME\nvBarycentric = a_texCoord2;\n#endif\nreturn pos;\n}\nvoid main() { gl_Position = vs_main(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nin vec2 uv;\nin vec4 color;\n#if CC_DRAW_WIRE_FRAME\nin vec3 vBarycentric;\n#endif\nuniform sampler2D mainTexture;\nlayout(std140) uniform FragConstants {\nvec4 tintColor;\n};\nvec4 add () {\nvec4 col = 2.0 * color * tintColor * texture(mainTexture, uv);\n#if CC_DRAW_WIRE_FRAME\nif (any(lessThan(vBarycentric, vec3(0.02)))) {\ncol = vec4(0., 1., 1., 1.);\n}\n#endif\nreturn CCFragOutput(col);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\nmat3 m = mat3(xAxis,yAxis,zAxis);\nfloat trace = m[0][0] + m[1][1] + m[2][2];\nvec4 quat;\nif (trace > 0.) {\nfloat s = 0.5 / sqrt(trace + 1.0);\nquat.w = 0.25 / s;\nquat.x = (m[2][1] - m[1][2]) * s;\nquat.y = (m[0][2] - m[2][0]) * s;\nquat.z = (m[1][0] - m[0][1]) * s;\n} else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\nfloat s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\nquat.w = (m[2][1] - m[1][2]) / s;\nquat.x = 0.25 * s;\nquat.y = (m[0][1] + m[1][0]) / s;\nquat.z = (m[0][2] + m[2][0]) / s;\n} else if (m[1][1] > m[2][2]) {\nfloat s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\nquat.w = (m[0][2] - m[2][0]) / s;\nquat.x = (m[0][1] + m[1][0]) / s;\nquat.y = 0.25 * s;\nquat.z = (m[1][2] + m[2][1]) / s;\n} else {\nfloat s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\nquat.w = (m[1][0] - m[0][1]) / s;\nquat.x = (m[0][2] + m[2][0]) / s;\nquat.y = (m[1][2] + m[2][1]) / s;\nquat.z = 0.25 * s;\n}\nfloat len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\nif (len > 0.) {\nlen = 1. / sqrt(len);\nquat.x = quat.x * len;\nquat.y = quat.y * len;\nquat.z = quat.z * len;\nquat.w = quat.w * len;\n}\nreturn quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\nfloat x = angle.x / 2.;\nfloat y = angle.y / 2.;\nfloat z = angle.z / 2.;\nfloat sx = sin(x);\nfloat cx = cos(x);\nfloat sy = sin(y);\nfloat cy = cos(y);\nfloat sz = sin(z);\nfloat cz = cos(z);\nvec4 quat = vec4(0);\nquat.x = sx * cy * cz + cx * sy * sz;\nquat.y = cx * sy * cz + sx * cy * sz;\nquat.z = cx * cy * sz - sx * sy * cz;\nquat.w = cx * cy * cz - sx * sy * sz;\nreturn quat;\n}\nmat4 matrixFromRT (vec4 q, vec3 p){\nfloat x2 = q.x + q.x;\nfloat y2 = q.y + q.y;\nfloat z2 = q.z + q.z;\nfloat xx = q.x * x2;\nfloat xy = q.x * y2;\nfloat xz = q.x * z2;\nfloat yy = q.y * y2;\nfloat yz = q.y * z2;\nfloat zz = q.z * z2;\nfloat wx = q.w * x2;\nfloat wy = q.w * y2;\nfloat wz = q.w * z2;\nreturn mat4(\n1. - (yy + zz), xy + wz, xz - wy, 0,\nxy - wz, 1. - (xx + zz), yz + wx, 0,\nxz + wy, yz - wx, 1. - (xx + yy), 0,\np.x, p.y, p.z, 1\n);\n}\nmat4 matFromRTS (vec4 q, vec3 t, vec3 s){\nfloat x = q.x, y = q.y, z = q.z, w = q.w;\nfloat x2 = x + x;\nfloat y2 = y + y;\nfloat z2 = z + z;\nfloat xx = x * x2;\nfloat xy = x * y2;\nfloat xz = x * z2;\nfloat yy = y * y2;\nfloat yz = y * z2;\nfloat zz = z * z2;\nfloat wx = w * x2;\nfloat wy = w * y2;\nfloat wz = w * z2;\nfloat sx = s.x;\nfloat sy = s.y;\nfloat sz = s.z;\nreturn mat4((1. - (yy + zz)) * sx, (xy + wz) * sx, (xz - wy) * sx, 0,\n(xy - wz) * sy, (1. - (xx + zz)) * sy, (yz + wx) * sy, 0,\n(xz + wy) * sz, (yz - wx) * sz, (1. - (xx + yy)) * sz, 0,\nt.x, t.y, t.z, 1);\n}\nvec4 quatMultiply (vec4 a, vec4 b){\nvec4 quat;\nquat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\nquat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\nquat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\nquat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\nreturn quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\nfloat ix = q.w * v.x + q.y * v.z - q.z * v.y;\nfloat iy = q.w * v.y + q.z * v.x - q.x * v.z;\nfloat iz = q.w * v.z + q.x * v.y - q.y * v.x;\nfloat iw = -q.x * v.x - q.y * v.y - q.z * v.z;\nv.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\nv.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\nv.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\nvec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\nvec4 rotQuat = quatMultiply(viewQuat, q);\nrotateVecFromQuat(pos, rotQuat);\nreturn pos;\n}\nmat3 quatToMat3(vec4 q) {\nvec3 m0 = vec3(\n1.0 - 2.0 * q.y * q.y - 2.0 * q.z * q.z,\n2.0 * q.x * q.y + 2.0 * q.w * q.z,\n2.0 * q.x * q.z - 2.0 * q.w * q.y);\nvec3 m1 = vec3(\n2.0 * q.x * q.y - 2.0 * q.w * q.z,\n1.0 - 2.0 * q.x * q.x - 2.0 * q.z * q.z,\n2.0 * q.y * q.z + 2.0 * q.w * q.x);\nvec3 m2 = vec3(\n2.0 * q.x * q.z + 2.0 * q.w * q.y,\n2.0 * q.y * q.z - 2.0 * q.w * q.x,\n1.0 - 2.0 * q.x * q.x - 2.0 * q.y * q.y);\nreturn mat3(m0, m1, m2);\n}\nvec4 mat3ToQuat(mat3 mat) {\nfloat tr = mat[0][0] + mat[1][1] + mat[2][2];\nfloat qw, qx, qy, qz;\nif (tr > 0.0) {\nfloat S = sqrt(tr + 1.0) * 2.0;\nfloat invS = 1.0 / S;\nqw = 0.25 * S;\nqx = (mat[1][2] - mat[2][1]) * invS;\nqy = (mat[2][0] - mat[0][2]) * invS;\nqz = (mat[0][1] - mat[1][0]) * invS;\n} else if ((mat[0][0] > mat[1][1])&&(mat[0][0] > mat[2][2])) {\nfloat S = sqrt(1.0 + mat[0][0] - mat[1][1] - mat[2][2]) * 2.0;\nfloat invS = 1.0 / S;\nqw = (mat[1][2] - mat[2][1]) * invS;\nqx = 0.25 * S;\nqy = (mat[1][0] + mat[0][1]) * invS;\nqz = (mat[2][0] + mat[0][2]) * invS;\n} else if (mat[1][1] > mat[2][2]) {\nfloat S = sqrt(1.0 + mat[1][1] - mat[0][0] - mat[2][2]) * 2.0;\nfloat invS = 1.0 / S;\nqw = (mat[2][0] - mat[0][2]) * invS;\nqx = (mat[1][0] + mat[0][1]) * invS;\nqy = 0.25 * S;\nqz = (mat[2][1] + mat[1][2]) * invS;\n} else {\nfloat S = sqrt(1.0 + mat[2][2] - mat[0][0] - mat[1][1]) * 2.0;\nfloat invS = 1.0 / S;\nqw = (mat[0][1] - mat[1][0]) * invS;\nqx = (mat[2][0] + mat[0][2]) * invS;\nqy = (mat[2][1] + mat[1][2]) * invS;\nqz = 0.25 * S;\n}\nreturn vec4(qx, qy, qz, qw);\n}\nlayout(std140) uniform Constants {\nvec4 mainTiling_Offset;\nvec4 frameTile_velLenScale;\nvec4 scale;\nvec4 nodeRotation;\n};\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\nout mediump vec2 uv;\nout mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n, mat4 viewInv\n#endif\n#if CC_RENDER_MODE == 1\n, vec3 eye\n, vec4 velocity\n, float velocityScale\n, float lengthScale\n, float xIndex\n#endif\n) {\n#if CC_RENDER_MODE == 0\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\nvec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\nvec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n#elif CC_RENDER_MODE == 1\nvec3 camRight = normalize(cross(pos.xyz - eye, velocity.xyz)) * s.x;\nvec3 camUp = velocity.xyz * velocityScale + normalize(velocity.xyz) * lengthScale * s.y;\npos.xyz += (camRight * abs(vertOffset.x) * sign(vertOffset.y)) - camUp * xIndex;\n#elif CC_RENDER_MODE == 2\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = vec3(1, 0, 0);\nvec3 camY = vec3(0, 0, -1);\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, cross(camX, camY), q);\n#elif CC_RENDER_MODE == 3\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nrotateVecFromQuat(viewSpaceVert, q);\nvec3 camX = normalize(vec3(cc_matView[0][0], cc_matView[1][0], cc_matView[2][0]));\nvec3 camY = vec3(0, 1, 0);\nvec3 offset = camX * viewSpaceVert.x + camY * viewSpaceVert.y;\npos.xyz += offset;\n#else\npos.x += vertOffset.x;\npos.y += vertOffset.y;\n#endif\n}\nvec2 computeUV (float frameIndex, vec2 vertIndex, vec2 frameTile){\nvec2 aniUV = vec2(0, floor(frameIndex * frameTile.y));\naniUV.x = floor(frameIndex * frameTile.x * frameTile.y - aniUV.y * frameTile.x);\n#if CC_RENDER_MODE != 4\nvertIndex.y = 1. - vertIndex.y;\n#endif\nreturn (aniUV.xy + vertIndex) / vec2(frameTile.x, frameTile.y);\n}\nin vec3 a_position;\nin vec3 a_texCoord;\nin vec3 a_texCoord1;\nin vec3 a_texCoord2;\nin vec4 a_color;\n#if CC_RENDER_MODE == 1\nin vec3 a_color1;\n#endif\n#if CC_RENDER_MODE == 4\nin vec3 a_texCoord3;\nin vec3 a_normal;\nin vec4 a_color1;\n#endif\nvec4 lpvs_main () {\nvec3 compScale = scale.xyz * a_texCoord1;\nvec4 pos = vec4(a_position, 1);\n#if CC_RENDER_MODE == 1\nvec4 velocity = vec4(a_color1.xyz, 0);\n#endif\n#if !CC_USE_WORLD_SPACE\npos = cc_matWorld * pos;\n#if CC_RENDER_MODE == 1\nvelocity = cc_matWorld * velocity;\n#endif\n#endif\n#if ROTATION_OVER_TIME_MODULE_ENABLE\nvec3 rotTmp = a_texCoord2;\nfloat mulFactor = 1.0;\nif (rotTmp.x > 10.0 * 0.5) {\nrotTmp.x -= 10.0;\nmulFactor = -1.0;\n}\nvec4 rot = vec4(rotTmp, 0.0);\nrot.w = mulFactor * sqrt(abs(1.0 - rot.x * rot.x - rot.y * rot.y - rot.z * rot.z));\n#else\n#if CC_RENDER_MODE != 4\n#if CC_RENDER_MODE == 0\nvec3 rotEuler = a_texCoord2;\n#elif CC_RENDER_MODE == 1\nvec3 rotEuler = vec3(0.);\n#else\nvec3 rotEuler = vec3(0., 0., a_texCoord2.z);\n#endif\nvec4 rot = quaternionFromEuler(rotEuler);\n#else\nvec4 rot = quaternionFromEuler(a_texCoord2);\n#endif\n#endif\n#if CC_RENDER_MODE != 4\nvec2 cornerOffset = vec2((a_texCoord.xy - 0.5));\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\ncomputeVertPos(pos, cornerOffset, rot, compScale, cc_matViewInv);\n#elif CC_RENDER_MODE == 1\ncomputeVertPos(pos, cornerOffset, rot, compScale, cc_cameraPos.xyz, velocity, frameTile_velLenScale.z, frameTile_velLenScale.w, a_texCoord.x);\n#elif 2\ncomputeVertPos(pos, cornerOffset, rot, compScale);\n#endif\ncolor = a_color;\n#else\nmat3 rotMat = quatToMat3(rot);\nmat3 nodeMat = quatToMat3(nodeRotation);\nrotMat = nodeMat * rotMat;\nrot = mat3ToQuat(rotMat);\nmat4 xformNoScale = matrixFromRT(rot, pos.xyz);\nmat4 xform = matFromRTS(rot, pos.xyz, compScale);\npos = xform * vec4(a_texCoord3, 1);\nvec4 normal = xformNoScale * vec4(a_normal, 0);\ncolor = a_color * a_color1;\n#endif\nuv = computeUV(a_texCoord.z, a_texCoord.xy, frameTile_velLenScale.xy) * mainTiling_Offset.xy + mainTiling_Offset.zw;\npos = cc_matViewProj * pos;\nreturn pos;\n}\nvoid main() { gl_Position = lpvs_main(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nin vec2 uv;\nin vec4 color;\nuniform sampler2D mainTexture;\nlayout(std140) uniform FragConstants {\nvec4 tintColor;\n};\nvec4 add () {\nvec4 col = 2.0 * color * tintColor * texture(mainTexture, uv);\nreturn CCFragOutput(col);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\n#if USE_LOCAL\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\n#endif\nin vec3 a_position;\nin vec2 a_texCoord;\nin vec4 a_color;\nout vec4 v_light;\nout vec2 uv0;\n#if TWO_COLORED\nin vec4 a_color2;\nout vec4 v_dark;\n#endif\nvec4 vert () {\nvec4 pos = vec4(a_position, 1);\n#if USE_LOCAL\npos = cc_matWorld * pos;\n#endif\npos = cc_matViewProj * pos;\nuv0 = a_texCoord;\nv_light = a_color;\n#if TWO_COLORED\nv_dark = a_color2;\n#endif\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\n#if USE_ALPHA_TEST\nlayout(std140) uniform ALPHA_TEST_DATA {\nfloat alphaThreshold;\n};\n#endif\nvoid ALPHA_TEST (in vec4 color) {\n#if USE_ALPHA_TEST\nif (color.a < alphaThreshold) discard;\n#endif\n}\nvoid ALPHA_TEST (in float alpha) {\n#if USE_ALPHA_TEST\nif (alpha < alphaThreshold) discard;\n#endif\n}\nin vec4 v_light;\n#if TWO_COLORED\nin vec4 v_dark;\n#endif\nin vec2 uv0;\nuniform sampler2D cc_spriteTexture;\nvec4 frag () {\nvec4 o = vec4(1, 1, 1, 1);\n#if TWO_COLORED\nvec4 texColor = vec4(1, 1, 1, 1);\ntexColor *= texture(cc_spriteTexture, uv0);\no.a = texColor.a * v_light.a;\no.rgb = ((texColor.a - 1.0) * v_dark.a + 1.0 - texColor.rgb) * v_dark.rgb + texColor.rgb * v_light.rgb;\n#else\no *= texture(cc_spriteTexture, uv0);\no *= v_light;\n#endif\nALPHA_TEST(o);\nreturn o;\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\n#if USE_LOCAL\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\n#endif\n#if SAMPLE_FROM_RT\n#endif\nin vec3 a_position;\nin vec2 a_texCoord;\nin vec4 a_color;\nout vec4 color;\nout vec2 uv0;\nvec4 vert () {\nvec4 pos = vec4(a_position, 1);\n#if USE_LOCAL\npos = cc_matWorld * pos;\n#endif\n#if USE_PIXEL_ALIGNMENT\npos = cc_matView * pos;\npos.xyz = floor(pos.xyz);\npos = cc_matProj * pos;\n#else\npos = cc_matViewProj * pos;\n#endif\nuv0 = a_texCoord;\n#if SAMPLE_FROM_RT\nuv0 = cc_cameraPos.w > 1.0 ? vec2(uv0.x, 1.0 - uv0.y) : uv0;\n#endif\ncolor = a_color;\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 CCSampleWithAlphaSeparated(sampler2D tex, vec2 uv) {\n#if CC_USE_EMBEDDED_ALPHA\nreturn vec4(texture(tex, uv).rgb, texture(tex, uv + vec2(0.0, 0.5)).r);\n#else\nreturn texture(tex, uv);\n#endif\n}\n#if USE_ALPHA_TEST\nlayout(std140) uniform ALPHA_TEST_DATA {\nfloat alphaThreshold;\n};\n#endif\nvoid ALPHA_TEST (in vec4 color) {\n#if USE_ALPHA_TEST\nif (color.a < alphaThreshold) discard;\n#endif\n}\nvoid ALPHA_TEST (in float alpha) {\n#if USE_ALPHA_TEST\nif (alpha < alphaThreshold) discard;\n#endif\n}\nin vec4 color;\n#if USE_TEXTURE\nin vec2 uv0;\nuniform sampler2D cc_spriteTexture;\n#endif\nvec4 frag () {\nvec4 o = vec4(1, 1, 1, 1);\n#if USE_TEXTURE\no *= CCSampleWithAlphaSeparated(cc_spriteTexture, uv0);\n#if IS_GRAY\nfloat gray  = 0.2126 * o.r + 0.7152 * o.g + 0.0722 * o.b;\no.r = o.g = o.b = gray;\n#endif\n#endif\no *= color;\nALPHA_TEST(o);\nreturn o;\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_MORPH\nin float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\nlayout(std140) uniform CCMorph {\nvec4 cc_displacementWeights[15];\nvec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\nivec2 texSize = textureSize(tex, 0);\nreturn texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture(tex, x)),\ndecode32(texture(tex, y)),\ndecode32(texture(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nin vec4 a_joints;\nin vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nin highp vec4 a_jointAnimInfo;\n#endif\nlayout(std140) uniform CCSkinningTexture {\nhighp vec4 cc_jointTextureInfo;\n};\nlayout(std140) uniform CCSkinningAnimation {\nhighp vec4 cc_jointAnimInfo;\n};\nuniform highp sampler2D cc_jointTexture;\n#else\nlayout(std140) uniform CCSkinning {\nhighp vec4 cc_joints[30 * 3];\n};\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\n#if USE_INSTANCING\nin vec4 a_matWorld0;\nin vec4 a_matWorld1;\nin vec4 a_matWorld2;\n#if USE_LIGHTMAP\nin vec4 a_lightingMapUVParam;\n#endif\n#elif USE_BATCHING\nin float a_dyn_batch_id;\nlayout(std140) uniform CCLocalBatched {\nhighp mat4 cc_matWorlds[10];\n};\n#else\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\n#endif\nlayout(std140) uniform Constants {\nvec4 tilingOffset;\nvec4 albedo;\nvec4 albedoScaleAndCutoff;\nvec4 pbrParams;\nvec4 emissive;\nvec4 emissiveScaleParam;\n};\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\n#if !CC_USE_ACCURATE_FOG\nout float v_fog_factor;\n#endif\nvoid CC_TRANSFER_FOG(vec4 pos) {\n#if !CC_USE_ACCURATE_FOG\nCC_TRANSFER_FOG_BASE(pos, v_fog_factor);\n#endif\n}\nout highp vec4 v_shadowPos;\nlayout(std140) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nhighp vec4 cc_shadowInvProjDepthInfo;\nhighp vec4 cc_shadowProjDepthInfo;\nhighp vec4 cc_shadowProjInfo;\nmediump vec4 cc_shadowNFLSInfo;\nmediump vec4 cc_shadowWHPBInfo;\nmediump vec4 cc_shadowLPNNInfo;\nlowp vec4 cc_shadowColor;\nmediump vec4 cc_planarNDInfo;\n};\n#if CC_RECEIVE_SHADOW\nuniform highp sampler2D cc_shadowMap;\nuniform highp sampler2D cc_spotLightingMap;\n#endif\n#if USE_VERTEX_COLOR\nin vec4 a_color;\nout vec4 v_color;\n#endif\nout vec3 v_position;\nout vec3 v_normal;\nout vec2 v_uv;\nout vec2 v_uv1;\n#if USE_NORMAL_MAP\nout vec3 v_tangent;\nout vec3 v_bitangent;\n#endif\n#if HAS_SECOND_UV || USE_LIGHTMAP\nin vec2 a_texCoord1;\n#endif\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nout vec3 v_luv;\nvoid CCLightingMapCaclUV()\n{\n#if !USE_INSTANCING\nv_luv.xy = cc_lightingMapUVParam.xy + a_texCoord1 * cc_lightingMapUVParam.zw;\nv_luv.z = cc_lightingMapUVParam.z;\n#else\nv_luv.xy = a_lightingMapUVParam.xy + a_texCoord1 * a_lightingMapUVParam.zw;\nv_luv.z = a_lightingMapUVParam.z;\n#endif\n}\n#endif\nvoid main () {\nStandardVertInput In;\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In);\n#endif\nmat4 matWorld, matWorldIT;\n#if USE_INSTANCING\nmatWorld = mat4(\nvec4(a_matWorld0.xyz, 0.0),\nvec4(a_matWorld1.xyz, 0.0),\nvec4(a_matWorld2.xyz, 0.0),\nvec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n);\nmatWorldIT = matWorld;\n#elif USE_BATCHING\nmatWorld = cc_matWorlds[int(a_dyn_batch_id)];\nmatWorldIT = matWorld;\n#else\nmatWorld = cc_matWorld;\nmatWorldIT = cc_matWorldIT;\n#endif\nvec4 pos = matWorld * In.position;\nv_position = pos.xyz;\nv_normal = normalize((matWorldIT * vec4(In.normal, 0.0)).xyz);\n#if USE_TWOSIDE\nvec3 viewDirect = normalize(cc_cameraPos.xyz - v_position);\nv_normal *= dot(v_normal, viewDirect) < 0.0 ? -1.0 : 1.0;\n#endif\n#if USE_NORMAL_MAP\nv_tangent = normalize((matWorld * vec4(In.tangent.xyz, 0.0)).xyz);\nv_bitangent = cross(v_normal, v_tangent) * In.tangent.w;\n#endif\nv_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n#if SAMPLE_FROM_RT\nv_uv = cc_cameraPos.w > 1.0 ? vec2(v_uv.x, 1.0 - v_uv.y) : v_uv;\n#endif\n#if HAS_SECOND_UV\nv_uv1 = a_texCoord1 * tilingOffset.xy + tilingOffset.zw;\n#if SAMPLE_FROM_RT\nv_uv1 = cc_cameraPos.w > 1.0 ? vec2(v_uv1.x, 1.0 - v_uv1.y) : v_uv1;\n#endif\n#endif\n#if USE_VERTEX_COLOR\nv_color = a_color;\n#endif\nCC_TRANSFER_FOG(pos);\nv_shadowPos = cc_matLightViewProj * pos;\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nCCLightingMapCaclUV();\n#endif\ngl_Position = cc_matProj * (cc_matView * matWorld) * In.position;\n}",frag:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nlayout(std140) uniform Constants {\nvec4 tilingOffset;\nvec4 albedo;\nvec4 albedoScaleAndCutoff;\nvec4 pbrParams;\nvec4 emissive;\nvec4 emissiveScaleParam;\n};\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\nvoid CC_APPLY_FOG_BASE(inout vec4 color, float factor) {\ncolor = vec4(mix(cc_fogColor.rgb, color.rgb, factor), color.a);\n}\n#if !CC_USE_ACCURATE_FOG\nin float v_fog_factor;\n#endif\nvoid CC_APPLY_FOG(inout vec4 color) {\n#if !CC_USE_ACCURATE_FOG\nCC_APPLY_FOG_BASE(color, v_fog_factor);\n#endif\n}\nvoid CC_APPLY_FOG(inout vec4 color, vec3 worldPos) {\n#if CC_USE_ACCURATE_FOG\nfloat factor;\nCC_TRANSFER_FOG_BASE(vec4(worldPos, 1.0), factor);\n#else\nfloat factor = v_fog_factor;\n#endif\nCC_APPLY_FOG_BASE(color, factor);\n}\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nlayout(std140) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nhighp vec4 cc_shadowInvProjDepthInfo;\nhighp vec4 cc_shadowProjDepthInfo;\nhighp vec4 cc_shadowProjInfo;\nmediump vec4 cc_shadowNFLSInfo;\nmediump vec4 cc_shadowWHPBInfo;\nmediump vec4 cc_shadowLPNNInfo;\nlowp vec4 cc_shadowColor;\nmediump vec4 cc_planarNDInfo;\n};\nhighp float unpackHighpData (float mainPart, float modPart) {\nhighp float data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out float mainPart, out float modPart, highp float data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp float unpackHighpData (float mainPart, float modPart, const float modValue) {\nhighp float data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out float mainPart, out float modPart, highp float data, const float modValue) {\nhighp float divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nhighp vec2 unpackHighpData (vec2 mainPart, vec2 modPart) {\nhighp vec2 data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out vec2 mainPart, out vec2 modPart, highp vec2 data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp vec2 unpackHighpData (vec2 mainPart, vec2 modPart, const float modValue) {\nhighp vec2 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out vec2 mainPart, out vec2 modPart, highp vec2 data, const float modValue) {\nhighp vec2 divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nhighp vec3 unpackHighpData (vec3 mainPart, vec3 modPart) {\nhighp vec3 data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out vec3 mainPart, out vec3 modPart, highp vec3 data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp vec3 unpackHighpData (vec3 mainPart, vec3 modPart, const float modValue) {\nhighp vec3 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out vec3 mainPart, out vec3 modPart, highp vec3 data, const float modValue) {\nhighp vec3 divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nhighp vec4 unpackHighpData (vec4 mainPart, vec4 modPart) {\nhighp vec4 data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out vec4 mainPart, out vec4 modPart, highp vec4 data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp vec4 unpackHighpData (vec4 mainPart, vec4 modPart, const float modValue) {\nhighp vec4 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out vec4 mainPart, out vec4 modPart, highp vec4 data, const float modValue) {\nhighp vec4 divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nfloat CCGetLinearDepthFromViewSpace(vec3 viewPos) {\nfloat dist = length(viewPos);\nreturn (dist - cc_shadowNFLSInfo.x) / (cc_shadowNFLSInfo.y - cc_shadowNFLSInfo.x);\n}\nfloat CCGetLinearDepth(vec3 worldPos) {\nvec4 viewStartPos = cc_matLightView * vec4(worldPos.xyz, 1.0);\nreturn CCGetLinearDepthFromViewSpace(viewStartPos.xyz);\n}\n#if CC_RECEIVE_SHADOW\nuniform highp sampler2D cc_shadowMap;\nuniform highp sampler2D cc_spotLightingMap;\nvec4 ApplyShadowDepthBias_FaceNormal(vec4 shadowPos, vec3 worldNormal)\n{\nvec4 newShadowPos = shadowPos;\nif(cc_shadowLPNNInfo.z > 0.0001)\n{\nvec4 viewNormal = cc_matLightView * vec4(worldNormal, 0.0);\nif(viewNormal.z < 0.1)\nnewShadowPos.xy += viewNormal.xy * cc_shadowProjInfo.xy * cc_shadowLPNNInfo.z * clamp(viewNormal.z, 0.001, 0.1);\n}\nreturn newShadowPos;\n}\nvec4 ApplyShadowDepthBias_Perspective(vec4 shadowPos, float viewspaceDepthBias)\n{\nvec3 viewSpacePos;\nviewSpacePos.xy = shadowPos.xy * cc_shadowProjInfo.zw;\nviewSpacePos.z = shadowPos.z * cc_shadowInvProjDepthInfo.x + shadowPos.w * cc_shadowInvProjDepthInfo.y;\nviewSpacePos.xyz += cc_shadowProjDepthInfo.z * normalize(viewSpacePos.xyz) * viewspaceDepthBias;\nvec4 clipSpacePos;\nclipSpacePos.xy = viewSpacePos.xy * cc_shadowProjInfo.xy;\nclipSpacePos.zw = viewSpacePos.z * cc_shadowProjDepthInfo.xz + vec2(cc_shadowProjDepthInfo.y, 0.0);\nif (cc_shadowNFLSInfo.z > 0.000001) {\nclipSpacePos.z = CCGetLinearDepthFromViewSpace(viewSpacePos.xyz);\nclipSpacePos.z = (clipSpacePos.z * 2.0 - 1.0) * clipSpacePos.w;\n}\nreturn clipSpacePos;\n}\nvec4 ApplyShadowDepthBias_Orthographic(vec4 shadowPos, float viewspaceDepthBias)\n{\nfloat coeffA = cc_shadowProjDepthInfo.x;\nfloat coeffB = cc_shadowProjDepthInfo.y;\nfloat viewSpacePos_z = (shadowPos.z - coeffB) / coeffA;\nviewSpacePos_z += viewspaceDepthBias;\nvec4 result = shadowPos;\nresult.z = viewSpacePos_z * coeffA + coeffB;\nreturn result;\n}\nfloat CCGetShadowFactorHard (vec4 shadowPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nclosestDepth = dot(texture(cc_shadowMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n} else {\nclosestDepth = texture(cc_shadowMap, clipPos.xy).x;\n}\nshadow = step(clipPos.z, closestDepth);\nreturn shadow;\n}\nfloat CCGetShadowFactorSoft (vec4 shadowPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat offsetDepth = clipPos.z;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nvec2 clipPos_offset = clipPos.xy + oneTap;\nfloat block0, block1, block2, block3;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x);\nblock1 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)).x);\nblock2 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)).x);\nblock3 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)).x);\n}\nfloat coefX   = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block2, block3, coefX);\nfloat coefY   = mod(clipPos.y, oneTap.y) * mapSize.y;\nreturn mix(resultX, resultY, coefY);\n}\nfloat CCGetShadowFactorSoft2X (vec4 shadowPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat offsetDepth = clipPos.z;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nfloat clipPos_offset_L = clipPos.x - oneTap.x;\nfloat clipPos_offset_R = clipPos.x + oneTap.x;\nfloat clipPos_offset_U = clipPos.y - oneTap.y;\nfloat clipPos_offset_D = clipPos.y + oneTap.y;\nfloat block0, block1, block2, block3, block4, block5, block6, block7, block8;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock4 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock5 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock6 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock7 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock8 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)).x);\nblock1 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)).x);\nblock2 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)).x);\nblock3 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)).x);\nblock4 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x);\nblock5 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)).x);\nblock6 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)).x);\nblock7 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)).x);\nblock8 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)).x);\n}\nfloat coefX = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat coefY = mod(clipPos.y, oneTap.y) * mapSize.y;\nfloat shadow = 0.0;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block3, block4, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block1, block2, coefX);\nresultY = mix(block4, block5, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block3, block4, coefX);\nresultY = mix(block6, block7, coefX);\nshadow += mix(resultX, resultY, coefY);\nresultX = mix(block4, block5, coefX);\nresultY = mix(block7, block8, coefX);\nshadow += mix(resultX, resultY, coefY);\nreturn shadow * 0.25;\n}\nfloat CCGetSpotLightShadowFactorHard (vec4 shadowPos, vec3 worldPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nfloat depth = clipPos.z;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nclosestDepth = dot(texture(cc_spotLightingMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n} else {\nclosestDepth = texture(cc_spotLightingMap, clipPos.xy).x;\n}\nshadow = step(depth, closestDepth);\nreturn shadow;\n}\nfloat CCGetSpotLightShadowFactorSoft (vec4 shadowPos, vec3 worldPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nfloat bias = cc_shadowWHPBInfo.w;\nvec2 oneTap = 1.0 / cc_shadowWHPBInfo.xy;\nvec2 clipPos_offset = clipPos.xy + oneTap;\nfloat block0, block1, block2, block3;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x);\nblock1 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos.y)).x);\nblock2 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset.y)).x);\nblock3 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos_offset.y)).x);\n}\nfloat coefX   = mod(clipPos.x, oneTap.x) * cc_shadowWHPBInfo.x;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block2, block3, coefX);\nfloat coefY   = mod(clipPos.y, oneTap.y) * cc_shadowWHPBInfo.y;\nreturn mix(resultX, resultY, coefY);\n}\nfloat CCGetSpotLightShadowFactorSoft2X (vec4 shadowPos, vec3 worldPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nfloat bias = cc_shadowWHPBInfo.w;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nfloat clipPos_offset_L = clipPos.x - oneTap.x;\nfloat clipPos_offset_R = clipPos.x + oneTap.x;\nfloat clipPos_offset_U = clipPos.y - oneTap.y;\nfloat clipPos_offset_D = clipPos.y + oneTap.y;\nfloat block0, block1, block2, block3, block4, block5, block6, block7, block8;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock4 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock5 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock6 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock7 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock8 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_U)).x);\nblock1 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_U)).x);\nblock2 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_U)).x);\nblock3 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos.y)).x);\nblock4 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x);\nblock5 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos.y)).x);\nblock6 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_D)).x);\nblock7 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_D)).x);\nblock8 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_D)).x);\n}\nfloat coefX = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat coefY = mod(clipPos.y, oneTap.y) * mapSize.y;\nfloat shadow = 0.0;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block3, block4, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block1, block2, coefX);\nresultY = mix(block4, block5, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block3, block4, coefX);\nresultY = mix(block6, block7, coefX);\nshadow += mix(resultX, resultY, coefY);\nresultX = mix(block4, block5, coefX);\nresultY = mix(block7, block8, coefX);\nshadow += mix(resultX, resultY, coefY);\nreturn shadow * 0.25;\n}\n#endif\n#if CC_USE_IBL\nuniform samplerCube cc_environment;\nvec4 fragTextureLod (sampler2D tex, vec2 coord, float lod) {\nreturn textureLod(tex, coord, lod);\n}\nvec4 fragTextureLod (samplerCube tex, vec3 coord, float lod) {\nreturn textureLod(tex, coord, lod);\n}\nvec3 unpackRGBE (vec4 rgbe) {\nreturn rgbe.rgb * pow(1.1, rgbe.a * 255.0 - 128.0);\n}\n#if CC_USE_DIFFUSEMAP\nuniform samplerCube cc_diffuseMap;\n#endif\n#endif\nfloat GGXMobile (float roughness, float NoH, vec3 H, vec3 N) {\nvec3 NxH = cross(N, H);\nfloat OneMinusNoHSqr = dot(NxH, NxH);\nfloat a = roughness * roughness;\nfloat n = NoH * a;\nfloat p = a / (OneMinusNoHSqr + n * n);\nreturn p * p;\n}\nfloat CalcSpecular (float roughness, float NoH, vec3 H, vec3 N) {\nreturn (roughness * 0.25 + 0.25) * GGXMobile(roughness, NoH, H, N);\n}\nvec3 BRDFApprox (vec3 specular, float roughness, float NoV) {\nconst vec4 c0 = vec4(-1.0, -0.0275, -0.572, 0.022);\nconst vec4 c1 = vec4(1.0, 0.0425, 1.04, -0.04);\nvec4 r = roughness * c0 + c1;\nfloat a004 = min(r.x * r.x, exp2(-9.28 * NoV)) * r.x + r.y;\nvec2 AB = vec2(-1.04, 1.04) * a004 + r.zw;\nAB.y *= clamp(50.0 * specular.g, 0.0, 1.0);\nreturn specular * AB.x + AB.y;\n}\n#if USE_REFLECTION_DENOISE\nvec3 GetEnvReflectionWithMipFiltering(vec3 R, float roughness, float mipCount, float denoiseIntensity) {\n#if CC_USE_IBL\nfloat mip = roughness * mipCount;\nfloat delta = (dot(dFdx(R), dFdy(R))) * 1000.0;\nfloat mipBias = mix(0.0, 5.0, clamp(delta, 0.0, 1.0));\nvec4 biased = fragTextureLod(cc_environment, R, mip + mipBias);\nvec4 filtered = texture(cc_environment, R);\n#if CC_USE_IBL == 2\nbiased.rgb = unpackRGBE(biased);\nfiltered.rgb = unpackRGBE(filtered);\n#else\nbiased.rgb = SRGBToLinear(biased.rgb);\nfiltered.rgb = SRGBToLinear(filtered.rgb);\n#endif\nreturn mix(biased.rgb, filtered.rgb, denoiseIntensity);\n#else\nreturn vec3(0.0, 0.0, 0.0);\n#endif\n}\n#endif\nstruct StandardSurface {\nvec4 albedo;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nvec3 position, position_fract_part;\n#else\nvec3 position;\n#endif\nvec3 normal;\nvec3 emissive;\nvec3 lightmap;\nfloat lightmap_test;\nfloat roughness;\nfloat metallic;\nfloat occlusion;\n};\nvec4 CCStandardShadingBase (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.0);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 L = normalize(-cc_mainLitDir.xyz);\nvec3 H = normalize(L + V);\nfloat NH = max(dot(N, H), 0.0);\nfloat NL = max(dot(N, L), 0.0);\nvec3 finalColor = NL * cc_mainLitColor.rgb * cc_mainLitColor.w;\nvec3 diffuseContrib = diffuse;\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nif (s.lightmap_test > 0.0001) {\nfinalColor = s.lightmap.rgb;\n}\n#else\ndiffuseContrib /= 3.14159265359;\n#endif\nvec3 specularContrib = specular * CalcSpecular(s.roughness, NH, H, N);\nvec3 dirlightContrib = (diffuseContrib + specularContrib);\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (NL > 0.0 && cc_mainLitDir.w > 0.0) {\n{\nvec4 pos = ApplyShadowDepthBias_FaceNormal(shadowPos, N);\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) shadow = CCGetShadowFactorSoft2X(pos);\nelse if (pcf > 0.9) shadow = CCGetShadowFactorSoft(pos);\nelse shadow = CCGetShadowFactorHard(pos);\nshadow = mix(shadow, 1.0, cc_shadowNFLSInfo.w);\n}\n}\n#endif\ndirlightContrib *= shadow;\nfinalColor *= dirlightContrib;\nfloat fAmb = 0.5 - N.y * 0.5;\nvec3 ambDiff = mix(cc_ambientSky.rgb, cc_ambientGround.rgb, fAmb);\n#if CC_USE_IBL\n#if CC_USE_DIFFUSEMAP\nvec4 diffuseMap = texture(cc_diffuseMap, N);\n#if CC_USE_DIFFUSEMAP == 2\nambDiff = unpackRGBE(diffuseMap);\n#else\nambDiff = SRGBToLinear(diffuseMap.rgb);\n#endif\n#endif\nvec3 R = normalize(reflect(-V, N));\n#if USE_REFLECTION_DENOISE\nvec3 env = GetEnvReflectionWithMipFiltering(R, s.roughness, cc_ambientGround.w, 0.6);\n#else\nvec4 envmap = fragTextureLod(cc_environment, R, s.roughness * cc_ambientGround.w);\n#if CC_USE_IBL == 2\nvec3 env = unpackRGBE(envmap);\n#else\nvec3 env = SRGBToLinear(envmap.rgb);\n#endif\n#endif\nfinalColor += env * cc_ambientSky.w * specular * s.occlusion;\n#endif\nfinalColor += ambDiff.rgb * cc_ambientSky.w * diffuse * s.occlusion;\nfinalColor += s.emissive;\nreturn vec4(finalColor, s.albedo.a);\n}\nvec3 ACESToneMap (vec3 color) {\ncolor = min(color, vec3(8.0));\nconst float A = 2.51;\nconst float B = 0.03;\nconst float C = 2.43;\nconst float D = 0.59;\nconst float E = 0.14;\nreturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = ACESToneMap(color.rgb);\n#endif\ncolor.rgb = sqrt(color.rgb);\nreturn color;\n}\nin highp vec4 v_shadowPos;\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nin vec3 v_luv;\nuniform sampler2D cc_lightingMap;\nvec3 UnpackLightingmap(vec4 color) {\nvec3 c;\nfloat e = 1.0 + color.a * (8.0 - 1.0);\nc.r = color.r * e;\nc.g = color.g * e;\nc.b = color.b * e;\nreturn c;\n}\n#endif\nin vec3 v_position;\nin vec2 v_uv;\nin vec2 v_uv1;\nin vec3 v_normal;\n#if USE_VERTEX_COLOR\nin vec4 v_color;\n#endif\n#if USE_ALBEDO_MAP\nuniform sampler2D albedoMap;\n#endif\n#if USE_NORMAL_MAP\nin vec3 v_tangent;\nin vec3 v_bitangent;\nuniform sampler2D normalMap;\n#endif\n#if USE_PBR_MAP\nuniform sampler2D pbrMap;\n#endif\n#if USE_METALLIC_ROUGHNESS_MAP\nuniform sampler2D metallicRoughnessMap;\n#endif\n#if USE_OCCLUSION_MAP\nuniform sampler2D occlusionMap;\n#endif\n#if USE_EMISSIVE_MAP\nuniform sampler2D emissiveMap;\n#endif\n#if USE_ALPHA_TEST\n#endif\nvoid surf (out StandardSurface s) {\nvec4 baseColor = albedo;\n#if USE_VERTEX_COLOR\nbaseColor.rgb *= SRGBToLinear(v_color.rgb);\nbaseColor.a *= v_color.a;\n#endif\n#if USE_ALBEDO_MAP\nvec4 texColor = texture(albedoMap, ALBEDO_UV);\ntexColor.rgb = SRGBToLinear(texColor.rgb);\nbaseColor *= texColor;\n#endif\ns.albedo = baseColor;\ns.albedo.rgb *= albedoScaleAndCutoff.xyz;\n#if USE_ALPHA_TEST\nif (s.albedo.ALPHA_TEST_CHANNEL < albedoScaleAndCutoff.w) discard;\n#endif\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nvec4 lightColor = texture(cc_lightingMap, v_luv.xy);\ns.lightmap = UnpackLightingmap(lightColor);\ns.lightmap_test = v_luv.z;\n#endif\ns.normal = v_normal;\n#if USE_NORMAL_MAP\nvec3 nmmp = texture(normalMap, NORMAL_UV).xyz - vec3(0.5);\ns.normal =\n(nmmp.x * emissiveScaleParam.w) * normalize(v_tangent) +\n(nmmp.y * emissiveScaleParam.w) * normalize(v_bitangent) +\nnmmp.z * normalize(s.normal);\n#endif\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\npackHighpData(s.position, s.position_fract_part, v_position);\n#else\ns.position = v_position;\n#endif\nvec4 pbr = pbrParams;\n#if USE_PBR_MAP\nvec4 res = texture(pbrMap, PBR_UV);\npbr.x *= res.r;\npbr.y *= res.g;\npbr.z *= res.b;\npbr.w *= res.a;\n#endif\n#if USE_METALLIC_ROUGHNESS_MAP\nvec4 metallicRoughness = texture(metallicRoughnessMap, PBR_UV);\npbr.z *= metallicRoughness.b;\npbr.y *= metallicRoughness.g;\n#endif\n#if USE_OCCLUSION_MAP\npbr.x *= texture(occlusionMap, PBR_UV).r;\n#endif\ns.occlusion = pbr.x;\ns.roughness = pbr.y;\ns.metallic = pbr.z;\ns.emissive = emissive.rgb * emissiveScaleParam.xyz;\n#if USE_EMISSIVE_MAP\ns.emissive *= SRGBToLinear(texture(emissiveMap, EMISSIVE_UV).rgb);\n#endif\n}\n#if CC_FORWARD_ADD\n#if CC_PIPELINE_TYPE == 0\n# define LIGHTS_PER_PASS 1\n#else\n# define LIGHTS_PER_PASS 10\n#endif\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 0\nlayout(std140) uniform CCForwardLight {\nhighp vec4 cc_lightPos[LIGHTS_PER_PASS];\nvec4 cc_lightColor[LIGHTS_PER_PASS];\nvec4 cc_lightSizeRangeAngle[LIGHTS_PER_PASS];\nvec4 cc_lightDir[LIGHTS_PER_PASS];\n};\n#endif\nfloat SmoothDistAtt (float distSqr, float invSqrAttRadius) {\nfloat factor = distSqr * invSqrAttRadius;\nfloat smoothFactor = clamp(1.0 - factor * factor, 0.0, 1.0);\nreturn smoothFactor * smoothFactor;\n}\nfloat GetDistAtt (float distSqr, float invSqrAttRadius) {\nfloat attenuation = 1.0 / max(distSqr, 0.01*0.01);\nattenuation *= SmoothDistAtt(distSqr , invSqrAttRadius);\nreturn attenuation;\n}\nfloat GetAngleAtt (vec3 L, vec3 litDir, float litAngleScale, float litAngleOffset) {\nfloat cd = dot(litDir, L);\nfloat attenuation = clamp(cd * litAngleScale + litAngleOffset, 0.0, 1.0);\nreturn (attenuation * attenuation);\n}\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 0\nvec4 CCStandardShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / 3.14159265359;\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.0);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nint numLights = CC_PIPELINE_TYPE == 0 ? LIGHTS_PER_PASS : int(cc_lightDir[0].w);\nfor (int i = 0; i < LIGHTS_PER_PASS; i++) {\nif (i >= numLights) break;\nvec3 SLU = cc_lightPos[i].xyz - position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.0);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = cc_lightSizeRangeAngle[i].x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = 3.14159265359 * (litRadiusSqr / max(litRadiusSqr , distSqr));\nfloat attRadiusSqrInv = 1.0 / max(cc_lightSizeRangeAngle[i].y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (cc_lightPos[i].w > 0.0) {\nfloat cosInner = max(dot(-cc_lightDir[i].xyz, SL), 0.01);\nfloat cosOuter = cc_lightSizeRangeAngle[i].z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -cc_lightDir[i].xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = cc_lightColor[i].rgb;\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (cc_lightPos[i].w > 0.0 && cc_lightSizeRangeAngle[i].w > 0.0) {\n{\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) shadow = CCGetSpotLightShadowFactorSoft2X(shadowPos, position);\nelse if (pcf > 0.9) shadow = CCGetSpotLightShadowFactorSoft(shadowPos, position);\nelse shadow = CCGetSpotLightShadowFactorHard(shadowPos, position);\n}\n}\n#endif\nlightColor *= shadow;\nfinalColor += SNL * lightColor * cc_lightColor[i].w * illum * att * (diffuseContrib + lspec);\n}\nreturn vec4(finalColor, 0.0);\n}\n#endif\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 1\nlayout(std430, binding = 4) readonly buffer b_ccLightsBuffer { vec4 b_ccLights[]; };\nlayout(std430, binding = 5) readonly buffer b_clusterLightIndicesBuffer { uint b_clusterLightIndices[]; };\nlayout(std430, binding = 6) readonly buffer b_clusterLightGridBuffer { uvec4 b_clusterLightGrid[]; };\nstruct CCLight\n{\nvec4 cc_lightPos;\nvec4 cc_lightColor;\nvec4 cc_lightSizeRangeAngle;\nvec4 cc_lightDir;\n};\nstruct Cluster\n{\nvec3 minBounds;\nvec3 maxBounds;\n};\nstruct LightGrid\n{\nuint offset;\nuint ccLights;\n};\nCCLight getCCLight(uint i)\n{\nCCLight light;\nlight.cc_lightPos = b_ccLights[4u * i + 0u];\nlight.cc_lightColor = b_ccLights[4u * i + 1u];\nlight.cc_lightSizeRangeAngle = b_ccLights[4u * i + 2u];\nlight.cc_lightDir = b_ccLights[4u * i + 3u];\nreturn light;\n}\nLightGrid getLightGrid(uint cluster)\n{\nuvec4 gridvec = b_clusterLightGrid[cluster];\nLightGrid grid;\ngrid.offset = gridvec.x;\ngrid.ccLights = gridvec.y;\nreturn grid;\n}\nuint getGridLightIndex(uint start, uint offset)\n{\nreturn b_clusterLightIndices[start + offset];\n}\nuint getClusterZIndex(vec4 worldPos)\n{\nfloat scale = float(24) / log(cc_nearFar.y / cc_nearFar.x);\nfloat bias = -(float(24) * log(cc_nearFar.x) / log(cc_nearFar.y / cc_nearFar.x));\nfloat eyeDepth = -(cc_matView * worldPos).z;\nuint zIndex = uint(max(log(eyeDepth) * scale + bias, 0.0));\nreturn zIndex;\n}\nuint getClusterIndex(vec4 fragCoord, vec4 worldPos)\n{\nuint zIndex = getClusterZIndex(worldPos);\nfloat clusterSizeX = ceil(cc_viewPort.z / float(16));\nfloat clusterSizeY = ceil(cc_viewPort.w / float(8));\nuvec3 indices = uvec3(uvec2(fragCoord.xy / vec2(clusterSizeX, clusterSizeY)), zIndex);\nuint cluster = (16u * 8u) * indices.z + 16u * indices.y + indices.x;\nreturn cluster;\n}\nvec4 CCClusterShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / 3.14159265359;\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.001);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nuint cluster = getClusterIndex(gl_FragCoord, vec4(position, 1.0));\nLightGrid grid = getLightGrid(cluster);\nuint numLights = grid.ccLights;\nfor (uint i = 0u; i < 100u; i++) {\nif (i >= numLights) break;\nuint lightIndex = getGridLightIndex(grid.offset, i);\nCCLight light = getCCLight(lightIndex);\nvec3 SLU = light.cc_lightPos.xyz - position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.001);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = light.cc_lightSizeRangeAngle.x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = 3.14159265359 * (litRadiusSqr / max(litRadiusSqr , distSqr));\nfloat attRadiusSqrInv = 1.0 / max(light.cc_lightSizeRangeAngle.y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (light.cc_lightPos.w > 0.0) {\nfloat cosInner = max(dot(-light.cc_lightDir.xyz, SL), 0.01);\nfloat cosOuter = light.cc_lightSizeRangeAngle.z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -light.cc_lightDir.xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = light.cc_lightColor.rgb;\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (light.cc_lightPos.w > 0.0) {\n{\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) shadow = CCGetSpotLightShadowFactorSoft2X(shadowPos, position);\nelse if (pcf > 0.9) shadow = CCGetSpotLightShadowFactorSoft(shadowPos, position);\nelse shadow = CCGetSpotLightShadowFactorHard(shadowPos, position);\n}\n}\n#endif\nlightColor *= shadow;\nfinalColor += SNL * lightColor * light.cc_lightColor.w * illum * att * (diffuseContrib + lspec);\n}\nreturn vec4(finalColor, 0.0);\n}\n#endif\nlayout(location = 0) out vec4 fragColorX;\nvoid main () {\nStandardSurface s; surf(s);\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 1\nvec4 color = CCClusterShadingAdditive(s, v_shadowPos);\n#else\nvec4 color = CCStandardShadingAdditive(s, v_shadowPos);\n#endif\nCC_APPLY_FOG(color, s.position.xyz);\nfragColorX = CCFragOutput(color);\n}\n#elif (CC_PIPELINE_TYPE == 0 || CC_FORCE_FORWARD_SHADING)\nlayout(location = 0) out vec4 fragColorX;\nvoid main () {\nStandardSurface s; surf(s);\nvec4 color = CCStandardShadingBase(s, v_shadowPos);\nCC_APPLY_FOG(color, s.position.xyz);\nfragColorX = CCFragOutput(color);\n}\n#elif CC_PIPELINE_TYPE == 1\nvec2 signNotZero(vec2 v) {\nreturn vec2((v.x >= 0.0) ? +1.0 : -1.0, (v.y >= 0.0) ? +1.0 : -1.0);\n}\nvec2 float32x3_to_oct(in vec3 v) {\nvec2 p = v.xy * (1.0 / (abs(v.x) + abs(v.y) + abs(v.z)));\nreturn (v.z <= 0.0) ? ((1.0 - abs(p.yx)) * signNotZero(p)) : p;\n}\nlayout(location = 0) out vec4 fragColor0;\nlayout(location = 1) out vec4 fragColor1;\nlayout(location = 2) out vec4 fragColor2;\nvoid main () {\nStandardSurface s; surf(s);\nfragColor0 = s.albedo;\nfragColor1 = vec4(float32x3_to_oct(s.normal), s.roughness, s.metallic);\nfragColor2 = vec4(s.emissive, s.occlusion);\n}\n#endif"},{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_MORPH\nin float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\nlayout(std140) uniform CCMorph {\nvec4 cc_displacementWeights[15];\nvec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\nivec2 texSize = textureSize(tex, 0);\nreturn texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture(tex, x)),\ndecode32(texture(tex, y)),\ndecode32(texture(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nin vec4 a_joints;\nin vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nin highp vec4 a_jointAnimInfo;\n#endif\nlayout(std140) uniform CCSkinningTexture {\nhighp vec4 cc_jointTextureInfo;\n};\nlayout(std140) uniform CCSkinningAnimation {\nhighp vec4 cc_jointAnimInfo;\n};\nuniform highp sampler2D cc_jointTexture;\n#else\nlayout(std140) uniform CCSkinning {\nhighp vec4 cc_joints[30 * 3];\n};\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\n#if USE_INSTANCING\nin vec4 a_matWorld0;\nin vec4 a_matWorld1;\nin vec4 a_matWorld2;\n#if USE_LIGHTMAP\nin vec4 a_lightingMapUVParam;\n#endif\n#elif USE_BATCHING\nin float a_dyn_batch_id;\nlayout(std140) uniform CCLocalBatched {\nhighp mat4 cc_matWorlds[10];\n};\n#else\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\n#endif\nlayout(std140) uniform Constants {\nvec4 tilingOffset;\nvec4 albedo;\nvec4 albedoScaleAndCutoff;\nvec4 pbrParams;\nvec4 emissive;\nvec4 emissiveScaleParam;\n};\nlayout(std140) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nhighp vec4 cc_shadowInvProjDepthInfo;\nhighp vec4 cc_shadowProjDepthInfo;\nhighp vec4 cc_shadowProjInfo;\nmediump vec4 cc_shadowNFLSInfo;\nmediump vec4 cc_shadowWHPBInfo;\nmediump vec4 cc_shadowLPNNInfo;\nlowp vec4 cc_shadowColor;\nmediump vec4 cc_planarNDInfo;\n};\n#if HAS_SECOND_UV || USE_LIGHTMAP\nin vec2 a_texCoord1;\n#endif\nout vec2 v_uv;\nout vec2 v_uv1;\nout vec4 v_worldPos;\nout float v_clip_depth;\nvec4 vert () {\nStandardVertInput In;\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In);\n#endif\nmat4 matWorld, matWorldIT;\n#if USE_INSTANCING\nmatWorld = mat4(\nvec4(a_matWorld0.xyz, 0.0),\nvec4(a_matWorld1.xyz, 0.0),\nvec4(a_matWorld2.xyz, 0.0),\nvec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n);\nmatWorldIT = matWorld;\n#elif USE_BATCHING\nmatWorld = cc_matWorlds[int(a_dyn_batch_id)];\nmatWorldIT = matWorld;\n#else\nmatWorld = cc_matWorld;\nmatWorldIT = cc_matWorldIT;\n#endif\nv_worldPos = matWorld * In.position;\nvec4 clipPos = cc_matLightViewProj * v_worldPos;\nv_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n#if HAS_SECOND_UV\nv_uv1 = a_texCoord1 * tilingOffset.xy + tilingOffset.zw;\n#endif\nv_clip_depth = clipPos.z / clipPos.w * 0.5 + 0.5;\nreturn clipPos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nlayout(std140) uniform Constants {\nvec4 tilingOffset;\nvec4 albedo;\nvec4 albedoScaleAndCutoff;\nvec4 pbrParams;\nvec4 emissive;\nvec4 emissiveScaleParam;\n};\nvec4 packDepthToRGBA (float depth) {\nvec4 ret = vec4(1.0, 255.0, 65025.0, 16581375.0) * depth;\nret = fract(ret);\nret -= vec4(ret.yzw, 0.0) / 255.0;\nreturn ret;\n}\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nlayout(std140) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nhighp vec4 cc_shadowInvProjDepthInfo;\nhighp vec4 cc_shadowProjDepthInfo;\nhighp vec4 cc_shadowProjInfo;\nmediump vec4 cc_shadowNFLSInfo;\nmediump vec4 cc_shadowWHPBInfo;\nmediump vec4 cc_shadowLPNNInfo;\nlowp vec4 cc_shadowColor;\nmediump vec4 cc_planarNDInfo;\n};\nfloat CCGetLinearDepthFromViewSpace(vec3 viewPos) {\nfloat dist = length(viewPos);\nreturn (dist - cc_shadowNFLSInfo.x) / (cc_shadowNFLSInfo.y - cc_shadowNFLSInfo.x);\n}\nfloat CCGetLinearDepth(vec3 worldPos) {\nvec4 viewStartPos = cc_matLightView * vec4(worldPos.xyz, 1.0);\nreturn CCGetLinearDepthFromViewSpace(viewStartPos.xyz);\n}\n#if CC_RECEIVE_SHADOW\nuniform highp sampler2D cc_shadowMap;\nuniform highp sampler2D cc_spotLightingMap;\n#endif\nin vec2 v_uv;\nin vec2 v_uv1;\nin vec4 v_worldPos;\nin float v_clip_depth;\n#if USE_ALBEDO_MAP\nuniform sampler2D albedoMap;\n#endif\n#if USE_ALPHA_TEST\n#endif\nvec4 frag () {\nvec4 baseColor = albedo;\n#if USE_ALBEDO_MAP\nbaseColor *= texture(albedoMap, ALBEDO_UV);\n#endif\n#if USE_ALPHA_TEST\nif (baseColor.ALPHA_TEST_CHANNEL < albedoScaleAndCutoff.w) discard;\n#endif\nif(cc_shadowLPNNInfo.x > 0.000001 && cc_shadowLPNNInfo.x < 1.999999) {\nif (cc_shadowNFLSInfo.z > 0.000001) {\nreturn vec4(CCGetLinearDepth(v_worldPos.xyz), 1.0, 1.0, 1.0);\n}\n}\nif (cc_shadowLPNNInfo.y > 0.000001) {\nreturn packDepthToRGBA(v_clip_depth);\n}\nreturn vec4(v_clip_depth, 1.0, 1.0, 1.0);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\n#if !CC_USE_ACCURATE_FOG\nout float v_fog_factor;\n#endif\nvoid CC_TRANSFER_FOG(vec4 pos) {\n#if !CC_USE_ACCURATE_FOG\nCC_TRANSFER_FOG_BASE(pos, v_fog_factor);\n#endif\n}\nout highp vec4 v_shadowPos;\nlayout(std140) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nhighp vec4 cc_shadowInvProjDepthInfo;\nhighp vec4 cc_shadowProjDepthInfo;\nhighp vec4 cc_shadowProjInfo;\nmediump vec4 cc_shadowNFLSInfo;\nmediump vec4 cc_shadowWHPBInfo;\nmediump vec4 cc_shadowLPNNInfo;\nlowp vec4 cc_shadowColor;\nmediump vec4 cc_planarNDInfo;\n};\n#if CC_RECEIVE_SHADOW\nuniform highp sampler2D cc_shadowMap;\nuniform highp sampler2D cc_spotLightingMap;\n#endif\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nout highp vec3 v_position;\nout mediump vec3 v_normal;\n#if USE_NORMALMAP\nout mediump vec3 v_tangent;\nout mediump vec3 v_binormal;\n#endif\nout mediump vec2 uvw;\nout mediump vec2 uv0;\nout mediump vec2 uv1;\nout mediump vec2 uv2;\nout mediump vec2 uv3;\nout mediump vec3 luv;\nout mediump vec3 diffuse;\nlayout(std140) uniform TexCoords {\nvec4 UVScale;\nvec4 lightMapUVParam;\n};\nvoid main () {\nvec3 worldPos;\nworldPos.x = cc_matWorld[3][0] + a_position.x;\nworldPos.y = cc_matWorld[3][1] + a_position.y;\nworldPos.z = cc_matWorld[3][2] + a_position.z;\nvec4 pos = vec4(worldPos, 1.0);\npos = cc_matViewProj * pos;\nuvw = a_texCoord;\nuv0 = a_position.xz * UVScale.x;\nuv1 = a_position.xz * UVScale.y;\nuv2 = a_position.xz * UVScale.z;\nuv3 = a_position.xz * UVScale.w;\n#if USE_LIGHTMAP\nluv.xy = lightMapUVParam.xy + a_texCoord * lightMapUVParam.zw;\nluv.z = lightMapUVParam.z;\n#endif\nv_position = worldPos;\nv_normal = a_normal;\nCC_TRANSFER_FOG(vec4(worldPos, 1.0));\n#if USE_NORMALMAP\nv_tangent = vec3(1.0, 0.0, 0.0);\nv_binormal = vec3(0.0, 0.0, 1.0);\nv_binormal = cross(v_tangent, a_normal);\nv_tangent = cross(a_normal, v_binormal);\n#endif\nv_shadowPos = cc_matLightViewProj * vec4(worldPos, 1.0);\ngl_Position = pos;\n}",frag:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nlayout(std140) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nhighp vec4 cc_shadowInvProjDepthInfo;\nhighp vec4 cc_shadowProjDepthInfo;\nhighp vec4 cc_shadowProjInfo;\nmediump vec4 cc_shadowNFLSInfo;\nmediump vec4 cc_shadowWHPBInfo;\nmediump vec4 cc_shadowLPNNInfo;\nlowp vec4 cc_shadowColor;\nmediump vec4 cc_planarNDInfo;\n};\nhighp float unpackHighpData (float mainPart, float modPart) {\nhighp float data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out float mainPart, out float modPart, highp float data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp float unpackHighpData (float mainPart, float modPart, const float modValue) {\nhighp float data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out float mainPart, out float modPart, highp float data, const float modValue) {\nhighp float divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nhighp vec2 unpackHighpData (vec2 mainPart, vec2 modPart) {\nhighp vec2 data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out vec2 mainPart, out vec2 modPart, highp vec2 data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp vec2 unpackHighpData (vec2 mainPart, vec2 modPart, const float modValue) {\nhighp vec2 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out vec2 mainPart, out vec2 modPart, highp vec2 data, const float modValue) {\nhighp vec2 divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nhighp vec3 unpackHighpData (vec3 mainPart, vec3 modPart) {\nhighp vec3 data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out vec3 mainPart, out vec3 modPart, highp vec3 data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp vec3 unpackHighpData (vec3 mainPart, vec3 modPart, const float modValue) {\nhighp vec3 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out vec3 mainPart, out vec3 modPart, highp vec3 data, const float modValue) {\nhighp vec3 divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nhighp vec4 unpackHighpData (vec4 mainPart, vec4 modPart) {\nhighp vec4 data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out vec4 mainPart, out vec4 modPart, highp vec4 data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp vec4 unpackHighpData (vec4 mainPart, vec4 modPart, const float modValue) {\nhighp vec4 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out vec4 mainPart, out vec4 modPart, highp vec4 data, const float modValue) {\nhighp vec4 divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nfloat CCGetLinearDepthFromViewSpace(vec3 viewPos) {\nfloat dist = length(viewPos);\nreturn (dist - cc_shadowNFLSInfo.x) / (cc_shadowNFLSInfo.y - cc_shadowNFLSInfo.x);\n}\nfloat CCGetLinearDepth(vec3 worldPos) {\nvec4 viewStartPos = cc_matLightView * vec4(worldPos.xyz, 1.0);\nreturn CCGetLinearDepthFromViewSpace(viewStartPos.xyz);\n}\n#if CC_RECEIVE_SHADOW\nuniform highp sampler2D cc_shadowMap;\nuniform highp sampler2D cc_spotLightingMap;\nvec4 ApplyShadowDepthBias_FaceNormal(vec4 shadowPos, vec3 worldNormal)\n{\nvec4 newShadowPos = shadowPos;\nif(cc_shadowLPNNInfo.z > 0.0001)\n{\nvec4 viewNormal = cc_matLightView * vec4(worldNormal, 0.0);\nif(viewNormal.z < 0.1)\nnewShadowPos.xy += viewNormal.xy * cc_shadowProjInfo.xy * cc_shadowLPNNInfo.z * clamp(viewNormal.z, 0.001, 0.1);\n}\nreturn newShadowPos;\n}\nvec4 ApplyShadowDepthBias_Perspective(vec4 shadowPos, float viewspaceDepthBias)\n{\nvec3 viewSpacePos;\nviewSpacePos.xy = shadowPos.xy * cc_shadowProjInfo.zw;\nviewSpacePos.z = shadowPos.z * cc_shadowInvProjDepthInfo.x + shadowPos.w * cc_shadowInvProjDepthInfo.y;\nviewSpacePos.xyz += cc_shadowProjDepthInfo.z * normalize(viewSpacePos.xyz) * viewspaceDepthBias;\nvec4 clipSpacePos;\nclipSpacePos.xy = viewSpacePos.xy * cc_shadowProjInfo.xy;\nclipSpacePos.zw = viewSpacePos.z * cc_shadowProjDepthInfo.xz + vec2(cc_shadowProjDepthInfo.y, 0.0);\nif (cc_shadowNFLSInfo.z > 0.000001) {\nclipSpacePos.z = CCGetLinearDepthFromViewSpace(viewSpacePos.xyz);\nclipSpacePos.z = (clipSpacePos.z * 2.0 - 1.0) * clipSpacePos.w;\n}\nreturn clipSpacePos;\n}\nvec4 ApplyShadowDepthBias_Orthographic(vec4 shadowPos, float viewspaceDepthBias)\n{\nfloat coeffA = cc_shadowProjDepthInfo.x;\nfloat coeffB = cc_shadowProjDepthInfo.y;\nfloat viewSpacePos_z = (shadowPos.z - coeffB) / coeffA;\nviewSpacePos_z += viewspaceDepthBias;\nvec4 result = shadowPos;\nresult.z = viewSpacePos_z * coeffA + coeffB;\nreturn result;\n}\nfloat CCGetShadowFactorHard (vec4 shadowPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nclosestDepth = dot(texture(cc_shadowMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n} else {\nclosestDepth = texture(cc_shadowMap, clipPos.xy).x;\n}\nshadow = step(clipPos.z, closestDepth);\nreturn shadow;\n}\nfloat CCGetShadowFactorSoft (vec4 shadowPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat offsetDepth = clipPos.z;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nvec2 clipPos_offset = clipPos.xy + oneTap;\nfloat block0, block1, block2, block3;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x);\nblock1 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)).x);\nblock2 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)).x);\nblock3 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)).x);\n}\nfloat coefX   = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block2, block3, coefX);\nfloat coefY   = mod(clipPos.y, oneTap.y) * mapSize.y;\nreturn mix(resultX, resultY, coefY);\n}\nfloat CCGetShadowFactorSoft2X (vec4 shadowPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat offsetDepth = clipPos.z;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nfloat clipPos_offset_L = clipPos.x - oneTap.x;\nfloat clipPos_offset_R = clipPos.x + oneTap.x;\nfloat clipPos_offset_U = clipPos.y - oneTap.y;\nfloat clipPos_offset_D = clipPos.y + oneTap.y;\nfloat block0, block1, block2, block3, block4, block5, block6, block7, block8;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock4 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock5 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock6 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock7 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock8 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)).x);\nblock1 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)).x);\nblock2 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)).x);\nblock3 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)).x);\nblock4 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x);\nblock5 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)).x);\nblock6 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)).x);\nblock7 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)).x);\nblock8 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)).x);\n}\nfloat coefX = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat coefY = mod(clipPos.y, oneTap.y) * mapSize.y;\nfloat shadow = 0.0;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block3, block4, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block1, block2, coefX);\nresultY = mix(block4, block5, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block3, block4, coefX);\nresultY = mix(block6, block7, coefX);\nshadow += mix(resultX, resultY, coefY);\nresultX = mix(block4, block5, coefX);\nresultY = mix(block7, block8, coefX);\nshadow += mix(resultX, resultY, coefY);\nreturn shadow * 0.25;\n}\nfloat CCGetSpotLightShadowFactorHard (vec4 shadowPos, vec3 worldPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nfloat depth = clipPos.z;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nclosestDepth = dot(texture(cc_spotLightingMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n} else {\nclosestDepth = texture(cc_spotLightingMap, clipPos.xy).x;\n}\nshadow = step(depth, closestDepth);\nreturn shadow;\n}\nfloat CCGetSpotLightShadowFactorSoft (vec4 shadowPos, vec3 worldPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nfloat bias = cc_shadowWHPBInfo.w;\nvec2 oneTap = 1.0 / cc_shadowWHPBInfo.xy;\nvec2 clipPos_offset = clipPos.xy + oneTap;\nfloat block0, block1, block2, block3;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x);\nblock1 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos.y)).x);\nblock2 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset.y)).x);\nblock3 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos_offset.y)).x);\n}\nfloat coefX   = mod(clipPos.x, oneTap.x) * cc_shadowWHPBInfo.x;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block2, block3, coefX);\nfloat coefY   = mod(clipPos.y, oneTap.y) * cc_shadowWHPBInfo.y;\nreturn mix(resultX, resultY, coefY);\n}\nfloat CCGetSpotLightShadowFactorSoft2X (vec4 shadowPos, vec3 worldPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nfloat bias = cc_shadowWHPBInfo.w;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nfloat clipPos_offset_L = clipPos.x - oneTap.x;\nfloat clipPos_offset_R = clipPos.x + oneTap.x;\nfloat clipPos_offset_U = clipPos.y - oneTap.y;\nfloat clipPos_offset_D = clipPos.y + oneTap.y;\nfloat block0, block1, block2, block3, block4, block5, block6, block7, block8;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock4 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock5 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock6 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock7 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock8 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_U)).x);\nblock1 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_U)).x);\nblock2 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_U)).x);\nblock3 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos.y)).x);\nblock4 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x);\nblock5 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos.y)).x);\nblock6 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_D)).x);\nblock7 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_D)).x);\nblock8 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_D)).x);\n}\nfloat coefX = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat coefY = mod(clipPos.y, oneTap.y) * mapSize.y;\nfloat shadow = 0.0;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block3, block4, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block1, block2, coefX);\nresultY = mix(block4, block5, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block3, block4, coefX);\nresultY = mix(block6, block7, coefX);\nshadow += mix(resultX, resultY, coefY);\nresultX = mix(block4, block5, coefX);\nresultY = mix(block7, block8, coefX);\nshadow += mix(resultX, resultY, coefY);\nreturn shadow * 0.25;\n}\n#endif\n#if CC_USE_IBL\nuniform samplerCube cc_environment;\nvec4 fragTextureLod (sampler2D tex, vec2 coord, float lod) {\nreturn textureLod(tex, coord, lod);\n}\nvec4 fragTextureLod (samplerCube tex, vec3 coord, float lod) {\nreturn textureLod(tex, coord, lod);\n}\nvec3 unpackRGBE (vec4 rgbe) {\nreturn rgbe.rgb * pow(1.1, rgbe.a * 255.0 - 128.0);\n}\n#if CC_USE_DIFFUSEMAP\nuniform samplerCube cc_diffuseMap;\n#endif\n#endif\nfloat GGXMobile (float roughness, float NoH, vec3 H, vec3 N) {\nvec3 NxH = cross(N, H);\nfloat OneMinusNoHSqr = dot(NxH, NxH);\nfloat a = roughness * roughness;\nfloat n = NoH * a;\nfloat p = a / (OneMinusNoHSqr + n * n);\nreturn p * p;\n}\nfloat CalcSpecular (float roughness, float NoH, vec3 H, vec3 N) {\nreturn (roughness * 0.25 + 0.25) * GGXMobile(roughness, NoH, H, N);\n}\nvec3 BRDFApprox (vec3 specular, float roughness, float NoV) {\nconst vec4 c0 = vec4(-1.0, -0.0275, -0.572, 0.022);\nconst vec4 c1 = vec4(1.0, 0.0425, 1.04, -0.04);\nvec4 r = roughness * c0 + c1;\nfloat a004 = min(r.x * r.x, exp2(-9.28 * NoV)) * r.x + r.y;\nvec2 AB = vec2(-1.04, 1.04) * a004 + r.zw;\nAB.y *= clamp(50.0 * specular.g, 0.0, 1.0);\nreturn specular * AB.x + AB.y;\n}\n#if USE_REFLECTION_DENOISE\nvec3 GetEnvReflectionWithMipFiltering(vec3 R, float roughness, float mipCount, float denoiseIntensity) {\n#if CC_USE_IBL\nfloat mip = roughness * mipCount;\nfloat delta = (dot(dFdx(R), dFdy(R))) * 1000.0;\nfloat mipBias = mix(0.0, 5.0, clamp(delta, 0.0, 1.0));\nvec4 biased = fragTextureLod(cc_environment, R, mip + mipBias);\nvec4 filtered = texture(cc_environment, R);\n#if CC_USE_IBL == 2\nbiased.rgb = unpackRGBE(biased);\nfiltered.rgb = unpackRGBE(filtered);\n#else\nbiased.rgb = SRGBToLinear(biased.rgb);\nfiltered.rgb = SRGBToLinear(filtered.rgb);\n#endif\nreturn mix(biased.rgb, filtered.rgb, denoiseIntensity);\n#else\nreturn vec3(0.0, 0.0, 0.0);\n#endif\n}\n#endif\nstruct StandardSurface {\nvec4 albedo;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nvec3 position, position_fract_part;\n#else\nvec3 position;\n#endif\nvec3 normal;\nvec3 emissive;\nvec3 lightmap;\nfloat lightmap_test;\nfloat roughness;\nfloat metallic;\nfloat occlusion;\n};\nvec4 CCStandardShadingBase (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.0);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 L = normalize(-cc_mainLitDir.xyz);\nvec3 H = normalize(L + V);\nfloat NH = max(dot(N, H), 0.0);\nfloat NL = max(dot(N, L), 0.0);\nvec3 finalColor = NL * cc_mainLitColor.rgb * cc_mainLitColor.w;\nvec3 diffuseContrib = diffuse;\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nif (s.lightmap_test > 0.0001) {\nfinalColor = s.lightmap.rgb;\n}\n#else\ndiffuseContrib /= 3.14159265359;\n#endif\nvec3 specularContrib = specular * CalcSpecular(s.roughness, NH, H, N);\nvec3 dirlightContrib = (diffuseContrib + specularContrib);\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (NL > 0.0 && cc_mainLitDir.w > 0.0) {\n{\nvec4 pos = ApplyShadowDepthBias_FaceNormal(shadowPos, N);\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) shadow = CCGetShadowFactorSoft2X(pos);\nelse if (pcf > 0.9) shadow = CCGetShadowFactorSoft(pos);\nelse shadow = CCGetShadowFactorHard(pos);\nshadow = mix(shadow, 1.0, cc_shadowNFLSInfo.w);\n}\n}\n#endif\ndirlightContrib *= shadow;\nfinalColor *= dirlightContrib;\nfloat fAmb = 0.5 - N.y * 0.5;\nvec3 ambDiff = mix(cc_ambientSky.rgb, cc_ambientGround.rgb, fAmb);\n#if CC_USE_IBL\n#if CC_USE_DIFFUSEMAP\nvec4 diffuseMap = texture(cc_diffuseMap, N);\n#if CC_USE_DIFFUSEMAP == 2\nambDiff = unpackRGBE(diffuseMap);\n#else\nambDiff = SRGBToLinear(diffuseMap.rgb);\n#endif\n#endif\nvec3 R = normalize(reflect(-V, N));\n#if USE_REFLECTION_DENOISE\nvec3 env = GetEnvReflectionWithMipFiltering(R, s.roughness, cc_ambientGround.w, 0.6);\n#else\nvec4 envmap = fragTextureLod(cc_environment, R, s.roughness * cc_ambientGround.w);\n#if CC_USE_IBL == 2\nvec3 env = unpackRGBE(envmap);\n#else\nvec3 env = SRGBToLinear(envmap.rgb);\n#endif\n#endif\nfinalColor += env * cc_ambientSky.w * specular * s.occlusion;\n#endif\nfinalColor += ambDiff.rgb * cc_ambientSky.w * diffuse * s.occlusion;\nfinalColor += s.emissive;\nreturn vec4(finalColor, s.albedo.a);\n}\nvec3 ACESToneMap (vec3 color) {\ncolor = min(color, vec3(8.0));\nconst float A = 2.51;\nconst float B = 0.03;\nconst float C = 2.43;\nconst float D = 0.59;\nconst float E = 0.14;\nreturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = ACESToneMap(color.rgb);\n#endif\ncolor.rgb = sqrt(color.rgb);\nreturn color;\n}\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\nvoid CC_APPLY_FOG_BASE(inout vec4 color, float factor) {\ncolor = vec4(mix(cc_fogColor.rgb, color.rgb, factor), color.a);\n}\n#if !CC_USE_ACCURATE_FOG\nin float v_fog_factor;\n#endif\nvoid CC_APPLY_FOG(inout vec4 color) {\n#if !CC_USE_ACCURATE_FOG\nCC_APPLY_FOG_BASE(color, v_fog_factor);\n#endif\n}\nvoid CC_APPLY_FOG(inout vec4 color, vec3 worldPos) {\n#if CC_USE_ACCURATE_FOG\nfloat factor;\nCC_TRANSFER_FOG_BASE(vec4(worldPos, 1.0), factor);\n#else\nfloat factor = v_fog_factor;\n#endif\nCC_APPLY_FOG_BASE(color, factor);\n}\nin highp vec4 v_shadowPos;\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nin vec3 v_luv;\nuniform sampler2D cc_lightingMap;\nvec3 UnpackLightingmap(vec4 color) {\nvec3 c;\nfloat e = 1.0 + color.a * (8.0 - 1.0);\nc.r = color.r * e;\nc.g = color.g * e;\nc.b = color.b * e;\nreturn c;\n}\n#endif\nin highp vec3 v_position;\nin mediump vec3 v_normal;\n#if USE_NORMALMAP\nin mediump vec3 v_tangent;\nin mediump vec3 v_binormal;\n#endif\nin mediump vec2 uvw;\nin mediump vec2 uv0;\nin mediump vec2 uv1;\nin mediump vec2 uv2;\nin mediump vec2 uv3;\nin mediump vec3 diffuse;\nin mediump vec3 luv;\nlayout(std140) uniform PbrParams {\nvec4 metallic;\nvec4 roughness;\n};\nuniform sampler2D weightMap;\nuniform sampler2D detailMap0;\nuniform sampler2D detailMap1;\nuniform sampler2D detailMap2;\nuniform sampler2D detailMap3;\nuniform sampler2D normalMap0;\nuniform sampler2D normalMap1;\nuniform sampler2D normalMap2;\nuniform sampler2D normalMap3;\nuniform sampler2D lightMap;\nvoid surf (out StandardSurface s) {\n#if LAYERS > 1\nvec4 w = texture(weightMap, uvw);\n#endif\nvec4 baseColor = vec4(0, 0, 0, 0);\n#if LAYERS == 1\nbaseColor = texture(detailMap0, uv0);\n#elif LAYERS == 2\nbaseColor += texture(detailMap0, uv0) * w.r;\nbaseColor += texture(detailMap1, uv1) * w.g;\n#elif LAYERS == 3\nbaseColor += texture(detailMap0, uv0) * w.r;\nbaseColor += texture(detailMap1, uv1) * w.g;\nbaseColor += texture(detailMap2, uv2) * w.b;\n#elif LAYERS == 4\nbaseColor += texture(detailMap0, uv0) * w.r;\nbaseColor += texture(detailMap1, uv1) * w.g;\nbaseColor += texture(detailMap2, uv2) * w.b;\nbaseColor += texture(detailMap3, uv3) * w.a;\n#else\nbaseColor = texture(detailMap0, uv0);\n#endif\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\npackHighpData(s.position, s.position_fract_part, v_position);\n#else\ns.position = v_position;\n#endif\n#if USE_NORMALMAP\nvec4 baseNormal = vec4(0, 0, 0, 0);\n#if LAYERS == 1\nbaseNormal = texture(normalMap0, uv0);\n#elif LAYERS == 2\nbaseNormal += texture(normalMap0, uv0) * w.r;\nbaseNormal += texture(normalMap1, uv1) * w.g;\n#elif LAYERS == 3\nbaseNormal += texture(normalMap0, uv0) * w.r;\nbaseNormal += texture(normalMap1, uv1) * w.g;\nbaseNormal += texture(normalMap2, uv2) * w.b;\n#elif LAYERS == 4\nbaseNormal += texture(normalMap0, uv0) * w.r;\nbaseNormal += texture(normalMap1, uv1) * w.g;\nbaseNormal += texture(normalMap2, uv2) * w.b;\nbaseNormal += texture(normalMap3, uv3) * w.a;\n#else\nbaseNormal = texture(normalMap0, uv0);\n#endif\nvec3 nmmp = baseNormal.xyz - vec3(0.5);\ns.normal =\nnmmp.x * normalize(v_tangent) +\nnmmp.y * normalize(v_binormal) +\nnmmp.z * normalize(v_normal);\n#else\ns.normal = v_normal;\n#endif\ns.albedo = vec4(SRGBToLinear(baseColor.rgb), 1.0);\ns.occlusion = 1.0;\n#if USE_PBR\ns.roughness = 0.0;\n#if LAYERS == 1\ns.roughness = roughness.x;\n#elif LAYERS == 2\ns.roughness += roughness.x * w.r;\ns.roughness += roughness.y * w.g;\n#elif LAYERS == 3\ns.roughness += roughness.x * w.r;\ns.roughness += roughness.y * w.g;\ns.roughness += roughness.z * w.b;\n#elif LAYERS == 4\ns.roughness += roughness.x * w.r;\ns.roughness += roughness.y * w.g;\ns.roughness += roughness.z * w.b;\ns.roughness += roughness.w * w.a;\n#else\ns.roughness = 1.0;\n#endif\ns.metallic = 0.0;\n#if LAYERS == 1\ns.metallic = metallic.x;\n#elif LAYERS == 2\ns.metallic += metallic.x * w.r;\ns.metallic += metallic.y * w.g;\n#elif LAYERS == 3\ns.metallic += metallic.x * w.r;\ns.metallic += metallic.y * w.g;\ns.metallic += metallic.z * w.b;\n#elif LAYERS == 4\ns.metallic += metallic.x * w.r;\ns.metallic += metallic.y * w.g;\ns.metallic += metallic.z * w.b;\ns.metallic += metallic.w * w.a;\n#else\ns.metallic = 0.0;\n#endif\n#else\ns.roughness = 1.0;\ns.metallic = 0.0;\n#endif\ns.emissive = vec3(0.0, 0.0, 0.0);\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nvec4 lightColor = texture(lightMap, luv.xy);\ns.lightmap = UnpackLightingmap(lightColor);\ns.lightmap_test = luv.z;\n#endif\n}\n#if CC_FORWARD_ADD\n#if CC_PIPELINE_TYPE == 0\n# define LIGHTS_PER_PASS 1\n#else\n# define LIGHTS_PER_PASS 10\n#endif\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 0\nlayout(std140) uniform CCForwardLight {\nhighp vec4 cc_lightPos[LIGHTS_PER_PASS];\nvec4 cc_lightColor[LIGHTS_PER_PASS];\nvec4 cc_lightSizeRangeAngle[LIGHTS_PER_PASS];\nvec4 cc_lightDir[LIGHTS_PER_PASS];\n};\n#endif\nfloat SmoothDistAtt (float distSqr, float invSqrAttRadius) {\nfloat factor = distSqr * invSqrAttRadius;\nfloat smoothFactor = clamp(1.0 - factor * factor, 0.0, 1.0);\nreturn smoothFactor * smoothFactor;\n}\nfloat GetDistAtt (float distSqr, float invSqrAttRadius) {\nfloat attenuation = 1.0 / max(distSqr, 0.01*0.01);\nattenuation *= SmoothDistAtt(distSqr , invSqrAttRadius);\nreturn attenuation;\n}\nfloat GetAngleAtt (vec3 L, vec3 litDir, float litAngleScale, float litAngleOffset) {\nfloat cd = dot(litDir, L);\nfloat attenuation = clamp(cd * litAngleScale + litAngleOffset, 0.0, 1.0);\nreturn (attenuation * attenuation);\n}\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 0\nvec4 CCStandardShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / 3.14159265359;\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.0);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nint numLights = CC_PIPELINE_TYPE == 0 ? LIGHTS_PER_PASS : int(cc_lightDir[0].w);\nfor (int i = 0; i < LIGHTS_PER_PASS; i++) {\nif (i >= numLights) break;\nvec3 SLU = cc_lightPos[i].xyz - position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.0);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = cc_lightSizeRangeAngle[i].x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = 3.14159265359 * (litRadiusSqr / max(litRadiusSqr , distSqr));\nfloat attRadiusSqrInv = 1.0 / max(cc_lightSizeRangeAngle[i].y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (cc_lightPos[i].w > 0.0) {\nfloat cosInner = max(dot(-cc_lightDir[i].xyz, SL), 0.01);\nfloat cosOuter = cc_lightSizeRangeAngle[i].z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -cc_lightDir[i].xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = cc_lightColor[i].rgb;\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (cc_lightPos[i].w > 0.0 && cc_lightSizeRangeAngle[i].w > 0.0) {\n{\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) shadow = CCGetSpotLightShadowFactorSoft2X(shadowPos, position);\nelse if (pcf > 0.9) shadow = CCGetSpotLightShadowFactorSoft(shadowPos, position);\nelse shadow = CCGetSpotLightShadowFactorHard(shadowPos, position);\n}\n}\n#endif\nlightColor *= shadow;\nfinalColor += SNL * lightColor * cc_lightColor[i].w * illum * att * (diffuseContrib + lspec);\n}\nreturn vec4(finalColor, 0.0);\n}\n#endif\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 1\nlayout(std430, binding = 4) readonly buffer b_ccLightsBuffer { vec4 b_ccLights[]; };\nlayout(std430, binding = 5) readonly buffer b_clusterLightIndicesBuffer { uint b_clusterLightIndices[]; };\nlayout(std430, binding = 6) readonly buffer b_clusterLightGridBuffer { uvec4 b_clusterLightGrid[]; };\nstruct CCLight\n{\nvec4 cc_lightPos;\nvec4 cc_lightColor;\nvec4 cc_lightSizeRangeAngle;\nvec4 cc_lightDir;\n};\nstruct Cluster\n{\nvec3 minBounds;\nvec3 maxBounds;\n};\nstruct LightGrid\n{\nuint offset;\nuint ccLights;\n};\nCCLight getCCLight(uint i)\n{\nCCLight light;\nlight.cc_lightPos = b_ccLights[4u * i + 0u];\nlight.cc_lightColor = b_ccLights[4u * i + 1u];\nlight.cc_lightSizeRangeAngle = b_ccLights[4u * i + 2u];\nlight.cc_lightDir = b_ccLights[4u * i + 3u];\nreturn light;\n}\nLightGrid getLightGrid(uint cluster)\n{\nuvec4 gridvec = b_clusterLightGrid[cluster];\nLightGrid grid;\ngrid.offset = gridvec.x;\ngrid.ccLights = gridvec.y;\nreturn grid;\n}\nuint getGridLightIndex(uint start, uint offset)\n{\nreturn b_clusterLightIndices[start + offset];\n}\nuint getClusterZIndex(vec4 worldPos)\n{\nfloat scale = float(24) / log(cc_nearFar.y / cc_nearFar.x);\nfloat bias = -(float(24) * log(cc_nearFar.x) / log(cc_nearFar.y / cc_nearFar.x));\nfloat eyeDepth = -(cc_matView * worldPos).z;\nuint zIndex = uint(max(log(eyeDepth) * scale + bias, 0.0));\nreturn zIndex;\n}\nuint getClusterIndex(vec4 fragCoord, vec4 worldPos)\n{\nuint zIndex = getClusterZIndex(worldPos);\nfloat clusterSizeX = ceil(cc_viewPort.z / float(16));\nfloat clusterSizeY = ceil(cc_viewPort.w / float(8));\nuvec3 indices = uvec3(uvec2(fragCoord.xy / vec2(clusterSizeX, clusterSizeY)), zIndex);\nuint cluster = (16u * 8u) * indices.z + 16u * indices.y + indices.x;\nreturn cluster;\n}\nvec4 CCClusterShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / 3.14159265359;\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.001);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nuint cluster = getClusterIndex(gl_FragCoord, vec4(position, 1.0));\nLightGrid grid = getLightGrid(cluster);\nuint numLights = grid.ccLights;\nfor (uint i = 0u; i < 100u; i++) {\nif (i >= numLights) break;\nuint lightIndex = getGridLightIndex(grid.offset, i);\nCCLight light = getCCLight(lightIndex);\nvec3 SLU = light.cc_lightPos.xyz - position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.001);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = light.cc_lightSizeRangeAngle.x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = 3.14159265359 * (litRadiusSqr / max(litRadiusSqr , distSqr));\nfloat attRadiusSqrInv = 1.0 / max(light.cc_lightSizeRangeAngle.y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (light.cc_lightPos.w > 0.0) {\nfloat cosInner = max(dot(-light.cc_lightDir.xyz, SL), 0.01);\nfloat cosOuter = light.cc_lightSizeRangeAngle.z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -light.cc_lightDir.xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = light.cc_lightColor.rgb;\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (light.cc_lightPos.w > 0.0) {\n{\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) shadow = CCGetSpotLightShadowFactorSoft2X(shadowPos, position);\nelse if (pcf > 0.9) shadow = CCGetSpotLightShadowFactorSoft(shadowPos, position);\nelse shadow = CCGetSpotLightShadowFactorHard(shadowPos, position);\n}\n}\n#endif\nlightColor *= shadow;\nfinalColor += SNL * lightColor * light.cc_lightColor.w * illum * att * (diffuseContrib + lspec);\n}\nreturn vec4(finalColor, 0.0);\n}\n#endif\nlayout(location = 0) out vec4 fragColorX;\nvoid main () {\nStandardSurface s; surf(s);\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 1\nvec4 color = CCClusterShadingAdditive(s, v_shadowPos);\n#else\nvec4 color = CCStandardShadingAdditive(s, v_shadowPos);\n#endif\nCC_APPLY_FOG(color, s.position.xyz);\nfragColorX = CCFragOutput(color);\n}\n#elif (CC_PIPELINE_TYPE == 0 || CC_FORCE_FORWARD_SHADING)\nlayout(location = 0) out vec4 fragColorX;\nvoid main () {\nStandardSurface s; surf(s);\nvec4 color = CCStandardShadingBase(s, v_shadowPos);\nCC_APPLY_FOG(color, s.position.xyz);\nfragColorX = CCFragOutput(color);\n}\n#elif CC_PIPELINE_TYPE == 1\nvec2 signNotZero(vec2 v) {\nreturn vec2((v.x >= 0.0) ? +1.0 : -1.0, (v.y >= 0.0) ? +1.0 : -1.0);\n}\nvec2 float32x3_to_oct(in vec3 v) {\nvec2 p = v.xy * (1.0 / (abs(v.x) + abs(v.y) + abs(v.z)));\nreturn (v.z <= 0.0) ? ((1.0 - abs(p.yx)) * signNotZero(p)) : p;\n}\nlayout(location = 0) out vec4 fragColor0;\nlayout(location = 1) out vec4 fragColor1;\nlayout(location = 2) out vec4 fragColor2;\nvoid main () {\nStandardSurface s; surf(s);\nfragColor0 = s.albedo;\nfragColor1 = vec4(float32x3_to_oct(s.normal), s.roughness, s.metallic);\nfragColor2 = vec4(s.emissive, s.occlusion);\n}\n#endif"},{vert:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\nlayout(std140) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nhighp vec4 cc_shadowInvProjDepthInfo;\nhighp vec4 cc_shadowProjDepthInfo;\nhighp vec4 cc_shadowProjInfo;\nmediump vec4 cc_shadowNFLSInfo;\nmediump vec4 cc_shadowWHPBInfo;\nmediump vec4 cc_shadowLPNNInfo;\nlowp vec4 cc_shadowColor;\nmediump vec4 cc_planarNDInfo;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nout vec2 v_clip_depth;\nvec4 vert () {\nvec4 worldPos;\nworldPos.x = cc_matWorld[3][0] + a_position.x;\nworldPos.y = cc_matWorld[3][1] + a_position.y;\nworldPos.z = cc_matWorld[3][2] + a_position.z;\nworldPos.w = 1.0;\nvec4 clipPos = cc_matLightViewProj * worldPos;\nv_clip_depth = clipPos.zw;\nreturn clipPos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 packDepthToRGBA (float depth) {\nvec4 ret = vec4(1.0, 255.0, 65025.0, 16581375.0) * depth;\nret = fract(ret);\nret -= vec4(ret.yzw, 0.0) / 255.0;\nreturn ret;\n}\nin vec2 v_clip_depth;\nvec4 frag () {\nreturn packDepthToRGBA(v_clip_depth.x / v_clip_depth.y * 0.5 + 0.5);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_MORPH\nin float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\nlayout(std140) uniform CCMorph {\nvec4 cc_displacementWeights[15];\nvec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\nivec2 texSize = textureSize(tex, 0);\nreturn texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture(tex, x)),\ndecode32(texture(tex, y)),\ndecode32(texture(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nin vec4 a_joints;\nin vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nin highp vec4 a_jointAnimInfo;\n#endif\nlayout(std140) uniform CCSkinningTexture {\nhighp vec4 cc_jointTextureInfo;\n};\nlayout(std140) uniform CCSkinningAnimation {\nhighp vec4 cc_jointAnimInfo;\n};\nuniform highp sampler2D cc_jointTexture;\n#else\nlayout(std140) uniform CCSkinning {\nhighp vec4 cc_joints[30 * 3];\n};\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\n#if USE_INSTANCING\nin vec4 a_matWorld0;\nin vec4 a_matWorld1;\nin vec4 a_matWorld2;\n#if USE_LIGHTMAP\nin vec4 a_lightingMapUVParam;\n#endif\n#elif USE_BATCHING\nin float a_dyn_batch_id;\nlayout(std140) uniform CCLocalBatched {\nhighp mat4 cc_matWorlds[10];\n};\n#else\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\n#endif\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\n#if !CC_USE_ACCURATE_FOG\nout float v_fog_factor;\n#endif\nvoid CC_TRANSFER_FOG(vec4 pos) {\n#if !CC_USE_ACCURATE_FOG\nCC_TRANSFER_FOG_BASE(pos, v_fog_factor);\n#endif\n}\n#if USE_VERTEX_COLOR\nin lowp vec4 a_color;\nout lowp vec4 v_color;\n#endif\n#if USE_TEXTURE\nout vec2 v_uv;\nlayout(std140) uniform TexCoords {\nvec4 tilingOffset;\n};\n#endif\nvec4 vert () {\nvec4 position;\nposition = vec4(a_position, 1.0);\n#if CC_USE_MORPH\napplyMorph(position);\n#endif\n#if CC_USE_SKINNING\nCCSkin(position);\n#endif\nmat4 matWorld;\n#if USE_INSTANCING\nmatWorld = mat4(\nvec4(a_matWorld0.xyz, 0.0),\nvec4(a_matWorld1.xyz, 0.0),\nvec4(a_matWorld2.xyz, 0.0),\nvec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n);\n#elif USE_BATCHING\nmatWorld = cc_matWorlds[int(a_dyn_batch_id)];\n#else\nmatWorld = cc_matWorld;\n#endif\n#if USE_TEXTURE\nv_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n#if SAMPLE_FROM_RT\nv_uv = cc_cameraPos.w > 1.0 ? vec2(v_uv.x, 1.0 - v_uv.y) : v_uv;\n#endif\n#endif\n#if USE_VERTEX_COLOR\nv_color = a_color;\n#endif\nCC_TRANSFER_FOG(matWorld * position);\nreturn cc_matProj * (cc_matView * matWorld) * position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec3 ACESToneMap (vec3 color) {\ncolor = min(color, vec3(8.0));\nconst float A = 2.51;\nconst float B = 0.03;\nconst float C = 2.43;\nconst float D = 0.59;\nconst float E = 0.14;\nreturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = ACESToneMap(color.rgb);\n#endif\ncolor.rgb = sqrt(color.rgb);\nreturn color;\n}\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\nvoid CC_APPLY_FOG_BASE(inout vec4 color, float factor) {\ncolor = vec4(mix(cc_fogColor.rgb, color.rgb, factor), color.a);\n}\n#if !CC_USE_ACCURATE_FOG\nin float v_fog_factor;\n#endif\nvoid CC_APPLY_FOG(inout vec4 color) {\n#if !CC_USE_ACCURATE_FOG\nCC_APPLY_FOG_BASE(color, v_fog_factor);\n#endif\n}\nvoid CC_APPLY_FOG(inout vec4 color, vec3 worldPos) {\n#if CC_USE_ACCURATE_FOG\nfloat factor;\nCC_TRANSFER_FOG_BASE(vec4(worldPos, 1.0), factor);\n#else\nfloat factor = v_fog_factor;\n#endif\nCC_APPLY_FOG_BASE(color, factor);\n}\n#if USE_ALPHA_TEST\n#endif\n#if USE_TEXTURE\nin vec2 v_uv;\nuniform sampler2D mainTexture;\n#endif\nlayout(std140) uniform Constant {\nvec4 mainColor;\nvec4 colorScaleAndCutoff;\n};\n#if USE_VERTEX_COLOR\nin lowp vec4 v_color;\n#endif\nvec4 frag () {\nvec4 o = mainColor;\no.rgb *= colorScaleAndCutoff.xyz;\n#if USE_VERTEX_COLOR\no.rgb *= SRGBToLinear(v_color.rgb);\no.a *= v_color.a;\n#endif\n#if USE_TEXTURE\nvec4 texColor = texture(mainTexture, v_uv);\ntexColor.rgb = SRGBToLinear(texColor.rgb);\no *= texColor;\n#endif\n#if USE_ALPHA_TEST\nif (o.ALPHA_TEST_CHANNEL < colorScaleAndCutoff.w) discard;\n#endif\nCC_APPLY_FOG(o);\nreturn CCFragOutput(o);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_MORPH\nin float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\nlayout(std140) uniform CCMorph {\nvec4 cc_displacementWeights[15];\nvec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\nivec2 texSize = textureSize(tex, 0);\nreturn texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture(tex, x)),\ndecode32(texture(tex, y)),\ndecode32(texture(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nin vec4 a_joints;\nin vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nin highp vec4 a_jointAnimInfo;\n#endif\nlayout(std140) uniform CCSkinningTexture {\nhighp vec4 cc_jointTextureInfo;\n};\nlayout(std140) uniform CCSkinningAnimation {\nhighp vec4 cc_jointAnimInfo;\n};\nuniform highp sampler2D cc_jointTexture;\n#else\nlayout(std140) uniform CCSkinning {\nhighp vec4 cc_joints[30 * 3];\n};\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nout vec2 v_uv;\nvoid main () {\nStandardVertInput In;\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In);\n#endif\nIn.position.xy = cc_cameraPos.w == 0.0 ? vec2(In.position.xy.x, -In.position.xy.y) : In.position.xy;\ngl_Position = In.position;\ngl_Position.y = gl_Position.y;\nv_uv = a_texCoord;\n}",frag:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nin vec2 v_uv;\nlayout(std140) uniform BloomUBO {\nmediump vec4 texSize;\n};\nuniform sampler2D outputResultMap;\nlayout(location = 0) out vec4 fragColor;\nfloat luminance(vec3 color) {\nreturn dot(color, vec3(0.2126, 0.7152, 0.0722));\n}\nvoid main() {\nvec3 color = texture(outputResultMap, v_uv).xyz;\nif (luminance(SRGBToLinear(color)) > texSize.z) {\nfragColor = vec4(color, 1.0);\n} else {\nfragColor = vec4(0.0, 0.0, 0.0, 1.0);\n}\n}"},{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_MORPH\nin float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\nlayout(std140) uniform CCMorph {\nvec4 cc_displacementWeights[15];\nvec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\nivec2 texSize = textureSize(tex, 0);\nreturn texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture(tex, x)),\ndecode32(texture(tex, y)),\ndecode32(texture(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nin vec4 a_joints;\nin vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nin highp vec4 a_jointAnimInfo;\n#endif\nlayout(std140) uniform CCSkinningTexture {\nhighp vec4 cc_jointTextureInfo;\n};\nlayout(std140) uniform CCSkinningAnimation {\nhighp vec4 cc_jointAnimInfo;\n};\nuniform highp sampler2D cc_jointTexture;\n#else\nlayout(std140) uniform CCSkinning {\nhighp vec4 cc_joints[30 * 3];\n};\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nout vec2 v_uv;\nvoid main () {\nStandardVertInput In;\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In);\n#endif\nIn.position.xy = cc_cameraPos.w == 0.0 ? vec2(In.position.xy.x, -In.position.xy.y) : In.position.xy;\ngl_Position = In.position;\ngl_Position.y = gl_Position.y;\nv_uv = a_texCoord;\n}",frag:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nin vec2 v_uv;\nlayout(std140) uniform BloomUBO {\nmediump vec4 texSize;\n};\nuniform sampler2D bloomTexture;\nlayout(location = 0) out vec4 fragColor;\nvec3 downsample4taps(vec2 uv, vec2 halfpixel) {\nvec3 sum = texture(bloomTexture, uv + vec2(-halfpixel.x, halfpixel.y)).xyz;\nsum += texture(bloomTexture, uv + vec2(halfpixel.x, halfpixel.y)).xyz;\nsum += texture(bloomTexture, uv + vec2(halfpixel.x, -halfpixel.y)).xyz;\nsum += texture(bloomTexture, uv + vec2(-halfpixel.x, -halfpixel.y)).xyz;\nreturn sum / 4.0;\n}\nvoid main()\n{\nvec3 result = downsample4taps(v_uv, 1.0 / texSize.xy).rgb;\nfragColor = vec4(result, 1.0);\n}"},{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_MORPH\nin float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\nlayout(std140) uniform CCMorph {\nvec4 cc_displacementWeights[15];\nvec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\nivec2 texSize = textureSize(tex, 0);\nreturn texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture(tex, x)),\ndecode32(texture(tex, y)),\ndecode32(texture(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nin vec4 a_joints;\nin vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nin highp vec4 a_jointAnimInfo;\n#endif\nlayout(std140) uniform CCSkinningTexture {\nhighp vec4 cc_jointTextureInfo;\n};\nlayout(std140) uniform CCSkinningAnimation {\nhighp vec4 cc_jointAnimInfo;\n};\nuniform highp sampler2D cc_jointTexture;\n#else\nlayout(std140) uniform CCSkinning {\nhighp vec4 cc_joints[30 * 3];\n};\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nout vec2 v_uv;\nvoid main () {\nStandardVertInput In;\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In);\n#endif\nIn.position.xy = cc_cameraPos.w == 0.0 ? vec2(In.position.xy.x, -In.position.xy.y) : In.position.xy;\ngl_Position = In.position;\ngl_Position.y = gl_Position.y;\nv_uv = a_texCoord;\n}",frag:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nin vec2 v_uv;\nlayout(std140) uniform BloomUBO {\nmediump vec4 texSize;\n};\nuniform sampler2D bloomTexture;\nlayout(location = 0) out vec4 fragColor;\nvec3 upsample4taps(vec2 uv, vec2 halfpixel) {\nvec3 sum = texture(bloomTexture, uv + vec2(-halfpixel.x, halfpixel.y)).xyz;\nsum += texture(bloomTexture, uv + vec2(halfpixel.x, halfpixel.y)).xyz;\nsum += texture(bloomTexture, uv + vec2(halfpixel.x, -halfpixel.y)).xyz;\nsum += texture(bloomTexture, uv + vec2(-halfpixel.x, -halfpixel.y)).xyz;\nreturn sum / 4.0;\n}\nvoid main() {\nvec3 result = upsample4taps(v_uv, 0.5 / texSize.xy).rgb;\nfragColor = vec4(result, 1.0);\n}"},{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_MORPH\nin float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\nlayout(std140) uniform CCMorph {\nvec4 cc_displacementWeights[15];\nvec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\nivec2 texSize = textureSize(tex, 0);\nreturn texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture(tex, x)),\ndecode32(texture(tex, y)),\ndecode32(texture(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nin vec4 a_joints;\nin vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nin highp vec4 a_jointAnimInfo;\n#endif\nlayout(std140) uniform CCSkinningTexture {\nhighp vec4 cc_jointTextureInfo;\n};\nlayout(std140) uniform CCSkinningAnimation {\nhighp vec4 cc_jointAnimInfo;\n};\nuniform highp sampler2D cc_jointTexture;\n#else\nlayout(std140) uniform CCSkinning {\nhighp vec4 cc_joints[30 * 3];\n};\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nout vec2 v_uv;\nvoid main () {\nStandardVertInput In;\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In);\n#endif\nIn.position.xy = cc_cameraPos.w == 0.0 ? vec2(In.position.xy.x, -In.position.xy.y) : In.position.xy;\ngl_Position = In.position;\ngl_Position.y = gl_Position.y;\nv_uv = a_texCoord;\n}",frag:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nin vec2 v_uv;\nlayout(std140) uniform BloomUBO {\nmediump vec4 texSize;\n};\nuniform sampler2D outputResultMap;\nuniform sampler2D bloomTexture;\nlayout(location = 0) out vec4 fragColor;\nvoid main() {\nvec4 hdrColor = texture(outputResultMap, v_uv);\nvec3 bloomColor = texture(bloomTexture, v_uv).rgb;\nvec3 result = hdrColor.rgb + bloomColor * texSize.w * hdrColor.a;\nfragColor = vec4(result, hdrColor.a);\n}"}],[{vert:"\nprecision highp float;\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nout vec2 v_uv;\nvoid main () {\nvec4 position;\nposition = vec4(a_position, 1.0);\nposition.xy = cc_cameraPos.w == 0.0 ? vec2(position.xy.x, -position.xy.y) : position.xy;\ngl_Position = vec4(position.x, position.y, 1.0, 1.0);\nv_uv = a_texCoord;\n}",frag:"\n#ifdef GL_EXT_shader_framebuffer_fetch\n#extension GL_EXT_shader_framebuffer_fetch: enable\n#endif\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nlayout(std140) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nhighp vec4 cc_shadowInvProjDepthInfo;\nhighp vec4 cc_shadowProjDepthInfo;\nhighp vec4 cc_shadowProjInfo;\nmediump vec4 cc_shadowNFLSInfo;\nmediump vec4 cc_shadowWHPBInfo;\nmediump vec4 cc_shadowLPNNInfo;\nlowp vec4 cc_shadowColor;\nmediump vec4 cc_planarNDInfo;\n};\nhighp float unpackHighpData (float mainPart, float modPart) {\nhighp float data = mainPart;\nreturn data + modPart;\n}\nhighp float unpackHighpData (float mainPart, float modPart, const float modValue) {\nhighp float data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nhighp vec2 unpackHighpData (vec2 mainPart, vec2 modPart) {\nhighp vec2 data = mainPart;\nreturn data + modPart;\n}\nhighp vec2 unpackHighpData (vec2 mainPart, vec2 modPart, const float modValue) {\nhighp vec2 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nhighp vec3 unpackHighpData (vec3 mainPart, vec3 modPart) {\nhighp vec3 data = mainPart;\nreturn data + modPart;\n}\nhighp vec3 unpackHighpData (vec3 mainPart, vec3 modPart, const float modValue) {\nhighp vec3 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nhighp vec4 unpackHighpData (vec4 mainPart, vec4 modPart) {\nhighp vec4 data = mainPart;\nreturn data + modPart;\n}\nhighp vec4 unpackHighpData (vec4 mainPart, vec4 modPart, const float modValue) {\nhighp vec4 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nfloat CCGetLinearDepthFromViewSpace(vec3 viewPos) {\nfloat dist = length(viewPos);\nreturn (dist - cc_shadowNFLSInfo.x) / (cc_shadowNFLSInfo.y - cc_shadowNFLSInfo.x);\n}\nfloat CCGetLinearDepth(vec3 worldPos) {\nvec4 viewStartPos = cc_matLightView * vec4(worldPos.xyz, 1.0);\nreturn CCGetLinearDepthFromViewSpace(viewStartPos.xyz);\n}\n#if CC_RECEIVE_SHADOW\nuniform highp sampler2D cc_shadowMap;\nuniform highp sampler2D cc_spotLightingMap;\nvec4 ApplyShadowDepthBias_FaceNormal(vec4 shadowPos, vec3 worldNormal)\n{\nvec4 newShadowPos = shadowPos;\nif(cc_shadowLPNNInfo.z > 0.0001)\n{\nvec4 viewNormal = cc_matLightView * vec4(worldNormal, 0.0);\nif(viewNormal.z < 0.1)\nnewShadowPos.xy += viewNormal.xy * cc_shadowProjInfo.xy * cc_shadowLPNNInfo.z * clamp(viewNormal.z, 0.001, 0.1);\n}\nreturn newShadowPos;\n}\nvec4 ApplyShadowDepthBias_Perspective(vec4 shadowPos, float viewspaceDepthBias)\n{\nvec3 viewSpacePos;\nviewSpacePos.xy = shadowPos.xy * cc_shadowProjInfo.zw;\nviewSpacePos.z = shadowPos.z * cc_shadowInvProjDepthInfo.x + shadowPos.w * cc_shadowInvProjDepthInfo.y;\nviewSpacePos.xyz += cc_shadowProjDepthInfo.z * normalize(viewSpacePos.xyz) * viewspaceDepthBias;\nvec4 clipSpacePos;\nclipSpacePos.xy = viewSpacePos.xy * cc_shadowProjInfo.xy;\nclipSpacePos.zw = viewSpacePos.z * cc_shadowProjDepthInfo.xz + vec2(cc_shadowProjDepthInfo.y, 0.0);\nif (cc_shadowNFLSInfo.z > 0.000001) {\nclipSpacePos.z = CCGetLinearDepthFromViewSpace(viewSpacePos.xyz);\nclipSpacePos.z = (clipSpacePos.z * 2.0 - 1.0) * clipSpacePos.w;\n}\nreturn clipSpacePos;\n}\nvec4 ApplyShadowDepthBias_Orthographic(vec4 shadowPos, float viewspaceDepthBias)\n{\nfloat coeffA = cc_shadowProjDepthInfo.x;\nfloat coeffB = cc_shadowProjDepthInfo.y;\nfloat viewSpacePos_z = (shadowPos.z - coeffB) / coeffA;\nviewSpacePos_z += viewspaceDepthBias;\nvec4 result = shadowPos;\nresult.z = viewSpacePos_z * coeffA + coeffB;\nreturn result;\n}\nfloat CCGetShadowFactorHard (vec4 shadowPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nclosestDepth = dot(texture(cc_shadowMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n} else {\nclosestDepth = texture(cc_shadowMap, clipPos.xy).x;\n}\nshadow = step(clipPos.z, closestDepth);\nreturn shadow;\n}\nfloat CCGetShadowFactorSoft (vec4 shadowPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat offsetDepth = clipPos.z;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nvec2 clipPos_offset = clipPos.xy + oneTap;\nfloat block0, block1, block2, block3;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x);\nblock1 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)).x);\nblock2 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)).x);\nblock3 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)).x);\n}\nfloat coefX   = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block2, block3, coefX);\nfloat coefY   = mod(clipPos.y, oneTap.y) * mapSize.y;\nreturn mix(resultX, resultY, coefY);\n}\nfloat CCGetShadowFactorSoft2X (vec4 shadowPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat offsetDepth = clipPos.z;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nfloat clipPos_offset_L = clipPos.x - oneTap.x;\nfloat clipPos_offset_R = clipPos.x + oneTap.x;\nfloat clipPos_offset_U = clipPos.y - oneTap.y;\nfloat clipPos_offset_D = clipPos.y + oneTap.y;\nfloat block0, block1, block2, block3, block4, block5, block6, block7, block8;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock4 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock5 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock6 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock7 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock8 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)).x);\nblock1 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)).x);\nblock2 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)).x);\nblock3 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)).x);\nblock4 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x);\nblock5 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)).x);\nblock6 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)).x);\nblock7 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)).x);\nblock8 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)).x);\n}\nfloat coefX = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat coefY = mod(clipPos.y, oneTap.y) * mapSize.y;\nfloat shadow = 0.0;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block3, block4, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block1, block2, coefX);\nresultY = mix(block4, block5, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block3, block4, coefX);\nresultY = mix(block6, block7, coefX);\nshadow += mix(resultX, resultY, coefY);\nresultX = mix(block4, block5, coefX);\nresultY = mix(block7, block8, coefX);\nshadow += mix(resultX, resultY, coefY);\nreturn shadow * 0.25;\n}\nfloat CCGetSpotLightShadowFactorHard (vec4 shadowPos, vec3 worldPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nfloat depth = clipPos.z;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nclosestDepth = dot(texture(cc_spotLightingMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n} else {\nclosestDepth = texture(cc_spotLightingMap, clipPos.xy).x;\n}\nshadow = step(depth, closestDepth);\nreturn shadow;\n}\nfloat CCGetSpotLightShadowFactorSoft (vec4 shadowPos, vec3 worldPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nfloat bias = cc_shadowWHPBInfo.w;\nvec2 oneTap = 1.0 / cc_shadowWHPBInfo.xy;\nvec2 clipPos_offset = clipPos.xy + oneTap;\nfloat block0, block1, block2, block3;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x);\nblock1 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos.y)).x);\nblock2 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset.y)).x);\nblock3 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos_offset.y)).x);\n}\nfloat coefX   = mod(clipPos.x, oneTap.x) * cc_shadowWHPBInfo.x;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block2, block3, coefX);\nfloat coefY   = mod(clipPos.y, oneTap.y) * cc_shadowWHPBInfo.y;\nreturn mix(resultX, resultY, coefY);\n}\nfloat CCGetSpotLightShadowFactorSoft2X (vec4 shadowPos, vec3 worldPos) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, cc_shadowWHPBInfo.w);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > 0.000001) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nfloat bias = cc_shadowWHPBInfo.w;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nfloat clipPos_offset_L = clipPos.x - oneTap.x;\nfloat clipPos_offset_R = clipPos.x + oneTap.x;\nfloat clipPos_offset_U = clipPos.y - oneTap.y;\nfloat clipPos_offset_D = clipPos.y + oneTap.y;\nfloat block0, block1, block2, block3, block4, block5, block6, block7, block8;\nif (cc_shadowLPNNInfo.y > 0.000001) {\nblock0 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock4 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock5 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock6 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock7 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock8 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_U)).x);\nblock1 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_U)).x);\nblock2 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_U)).x);\nblock3 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos.y)).x);\nblock4 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x);\nblock5 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos.y)).x);\nblock6 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_D)).x);\nblock7 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_D)).x);\nblock8 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_D)).x);\n}\nfloat coefX = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat coefY = mod(clipPos.y, oneTap.y) * mapSize.y;\nfloat shadow = 0.0;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block3, block4, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block1, block2, coefX);\nresultY = mix(block4, block5, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block3, block4, coefX);\nresultY = mix(block6, block7, coefX);\nshadow += mix(resultX, resultY, coefY);\nresultX = mix(block4, block5, coefX);\nresultY = mix(block7, block8, coefX);\nshadow += mix(resultX, resultY, coefY);\nreturn shadow * 0.25;\n}\n#endif\n#if CC_USE_IBL\nuniform samplerCube cc_environment;\nvec4 fragTextureLod (sampler2D tex, vec2 coord, float lod) {\nreturn textureLod(tex, coord, lod);\n}\nvec4 fragTextureLod (samplerCube tex, vec3 coord, float lod) {\nreturn textureLod(tex, coord, lod);\n}\nvec3 unpackRGBE (vec4 rgbe) {\nreturn rgbe.rgb * pow(1.1, rgbe.a * 255.0 - 128.0);\n}\n#if CC_USE_DIFFUSEMAP\nuniform samplerCube cc_diffuseMap;\n#endif\n#endif\nfloat GGXMobile (float roughness, float NoH, vec3 H, vec3 N) {\nvec3 NxH = cross(N, H);\nfloat OneMinusNoHSqr = dot(NxH, NxH);\nfloat a = roughness * roughness;\nfloat n = NoH * a;\nfloat p = a / (OneMinusNoHSqr + n * n);\nreturn p * p;\n}\nfloat CalcSpecular (float roughness, float NoH, vec3 H, vec3 N) {\nreturn (roughness * 0.25 + 0.25) * GGXMobile(roughness, NoH, H, N);\n}\nvec3 BRDFApprox (vec3 specular, float roughness, float NoV) {\nconst vec4 c0 = vec4(-1.0, -0.0275, -0.572, 0.022);\nconst vec4 c1 = vec4(1.0, 0.0425, 1.04, -0.04);\nvec4 r = roughness * c0 + c1;\nfloat a004 = min(r.x * r.x, exp2(-9.28 * NoV)) * r.x + r.y;\nvec2 AB = vec2(-1.04, 1.04) * a004 + r.zw;\nAB.y *= clamp(50.0 * specular.g, 0.0, 1.0);\nreturn specular * AB.x + AB.y;\n}\n#if USE_REFLECTION_DENOISE\nvec3 GetEnvReflectionWithMipFiltering(vec3 R, float roughness, float mipCount, float denoiseIntensity) {\n#if CC_USE_IBL\nfloat mip = roughness * mipCount;\nfloat delta = (dot(dFdx(R), dFdy(R))) * 1000.0;\nfloat mipBias = mix(0.0, 5.0, clamp(delta, 0.0, 1.0));\nvec4 biased = fragTextureLod(cc_environment, R, mip + mipBias);\nvec4 filtered = texture(cc_environment, R);\n#if CC_USE_IBL == 2\nbiased.rgb = unpackRGBE(biased);\nfiltered.rgb = unpackRGBE(filtered);\n#else\nbiased.rgb = SRGBToLinear(biased.rgb);\nfiltered.rgb = SRGBToLinear(filtered.rgb);\n#endif\nreturn mix(biased.rgb, filtered.rgb, denoiseIntensity);\n#else\nreturn vec3(0.0, 0.0, 0.0);\n#endif\n}\n#endif\nstruct StandardSurface {\nvec4 albedo;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nvec3 position, position_fract_part;\n#else\nvec3 position;\n#endif\nvec3 normal;\nvec3 emissive;\nvec3 lightmap;\nfloat lightmap_test;\nfloat roughness;\nfloat metallic;\nfloat occlusion;\n};\nvec4 CCStandardShadingBase (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.0);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 L = normalize(-cc_mainLitDir.xyz);\nvec3 H = normalize(L + V);\nfloat NH = max(dot(N, H), 0.0);\nfloat NL = max(dot(N, L), 0.0);\nvec3 finalColor = NL * cc_mainLitColor.rgb * cc_mainLitColor.w;\nvec3 diffuseContrib = diffuse;\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nif (s.lightmap_test > 0.0001) {\nfinalColor = s.lightmap.rgb;\n}\n#else\ndiffuseContrib /= 3.14159265359;\n#endif\nvec3 specularContrib = specular * CalcSpecular(s.roughness, NH, H, N);\nvec3 dirlightContrib = (diffuseContrib + specularContrib);\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (NL > 0.0 && cc_mainLitDir.w > 0.0) {\n{\nvec4 pos = ApplyShadowDepthBias_FaceNormal(shadowPos, N);\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) shadow = CCGetShadowFactorSoft2X(pos);\nelse if (pcf > 0.9) shadow = CCGetShadowFactorSoft(pos);\nelse shadow = CCGetShadowFactorHard(pos);\nshadow = mix(shadow, 1.0, cc_shadowNFLSInfo.w);\n}\n}\n#endif\ndirlightContrib *= shadow;\nfinalColor *= dirlightContrib;\nfloat fAmb = 0.5 - N.y * 0.5;\nvec3 ambDiff = mix(cc_ambientSky.rgb, cc_ambientGround.rgb, fAmb);\n#if CC_USE_IBL\n#if CC_USE_DIFFUSEMAP\nvec4 diffuseMap = texture(cc_diffuseMap, N);\n#if CC_USE_DIFFUSEMAP == 2\nambDiff = unpackRGBE(diffuseMap);\n#else\nambDiff = SRGBToLinear(diffuseMap.rgb);\n#endif\n#endif\nvec3 R = normalize(reflect(-V, N));\n#if USE_REFLECTION_DENOISE\nvec3 env = GetEnvReflectionWithMipFiltering(R, s.roughness, cc_ambientGround.w, 0.6);\n#else\nvec4 envmap = fragTextureLod(cc_environment, R, s.roughness * cc_ambientGround.w);\n#if CC_USE_IBL == 2\nvec3 env = unpackRGBE(envmap);\n#else\nvec3 env = SRGBToLinear(envmap.rgb);\n#endif\n#endif\nfinalColor += env * cc_ambientSky.w * specular * s.occlusion;\n#endif\nfinalColor += ambDiff.rgb * cc_ambientSky.w * diffuse * s.occlusion;\nfinalColor += s.emissive;\nreturn vec4(finalColor, s.albedo.a);\n}\n#if CC_PIPELINE_TYPE == 0\n# define LIGHTS_PER_PASS 1\n#else\n# define LIGHTS_PER_PASS 10\n#endif\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 0\nlayout(std140) uniform CCForwardLight {\nhighp vec4 cc_lightPos[LIGHTS_PER_PASS];\nvec4 cc_lightColor[LIGHTS_PER_PASS];\nvec4 cc_lightSizeRangeAngle[LIGHTS_PER_PASS];\nvec4 cc_lightDir[LIGHTS_PER_PASS];\n};\n#endif\nfloat SmoothDistAtt (float distSqr, float invSqrAttRadius) {\nfloat factor = distSqr * invSqrAttRadius;\nfloat smoothFactor = clamp(1.0 - factor * factor, 0.0, 1.0);\nreturn smoothFactor * smoothFactor;\n}\nfloat GetDistAtt (float distSqr, float invSqrAttRadius) {\nfloat attenuation = 1.0 / max(distSqr, 0.01*0.01);\nattenuation *= SmoothDistAtt(distSqr , invSqrAttRadius);\nreturn attenuation;\n}\nfloat GetAngleAtt (vec3 L, vec3 litDir, float litAngleScale, float litAngleOffset) {\nfloat cd = dot(litDir, L);\nfloat attenuation = clamp(cd * litAngleScale + litAngleOffset, 0.0, 1.0);\nreturn (attenuation * attenuation);\n}\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 0\nvec4 CCStandardShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / 3.14159265359;\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.0);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nint numLights = CC_PIPELINE_TYPE == 0 ? LIGHTS_PER_PASS : int(cc_lightDir[0].w);\nfor (int i = 0; i < LIGHTS_PER_PASS; i++) {\nif (i >= numLights) break;\nvec3 SLU = cc_lightPos[i].xyz - position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.0);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = cc_lightSizeRangeAngle[i].x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = 3.14159265359 * (litRadiusSqr / max(litRadiusSqr , distSqr));\nfloat attRadiusSqrInv = 1.0 / max(cc_lightSizeRangeAngle[i].y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (cc_lightPos[i].w > 0.0) {\nfloat cosInner = max(dot(-cc_lightDir[i].xyz, SL), 0.01);\nfloat cosOuter = cc_lightSizeRangeAngle[i].z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -cc_lightDir[i].xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = cc_lightColor[i].rgb;\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (cc_lightPos[i].w > 0.0 && cc_lightSizeRangeAngle[i].w > 0.0) {\n{\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) shadow = CCGetSpotLightShadowFactorSoft2X(shadowPos, position);\nelse if (pcf > 0.9) shadow = CCGetSpotLightShadowFactorSoft(shadowPos, position);\nelse shadow = CCGetSpotLightShadowFactorHard(shadowPos, position);\n}\n}\n#endif\nlightColor *= shadow;\nfinalColor += SNL * lightColor * cc_lightColor[i].w * illum * att * (diffuseContrib + lspec);\n}\nreturn vec4(finalColor, 0.0);\n}\n#endif\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 1\nlayout(std430, binding = 4) readonly buffer b_ccLightsBuffer { vec4 b_ccLights[]; };\nlayout(std430, binding = 5) readonly buffer b_clusterLightIndicesBuffer { uint b_clusterLightIndices[]; };\nlayout(std430, binding = 6) readonly buffer b_clusterLightGridBuffer { uvec4 b_clusterLightGrid[]; };\nstruct CCLight\n{\nvec4 cc_lightPos;\nvec4 cc_lightColor;\nvec4 cc_lightSizeRangeAngle;\nvec4 cc_lightDir;\n};\nstruct Cluster\n{\nvec3 minBounds;\nvec3 maxBounds;\n};\nstruct LightGrid\n{\nuint offset;\nuint ccLights;\n};\nCCLight getCCLight(uint i)\n{\nCCLight light;\nlight.cc_lightPos = b_ccLights[4u * i + 0u];\nlight.cc_lightColor = b_ccLights[4u * i + 1u];\nlight.cc_lightSizeRangeAngle = b_ccLights[4u * i + 2u];\nlight.cc_lightDir = b_ccLights[4u * i + 3u];\nreturn light;\n}\nLightGrid getLightGrid(uint cluster)\n{\nuvec4 gridvec = b_clusterLightGrid[cluster];\nLightGrid grid;\ngrid.offset = gridvec.x;\ngrid.ccLights = gridvec.y;\nreturn grid;\n}\nuint getGridLightIndex(uint start, uint offset)\n{\nreturn b_clusterLightIndices[start + offset];\n}\nuint getClusterZIndex(vec4 worldPos)\n{\nfloat scale = float(24) / log(cc_nearFar.y / cc_nearFar.x);\nfloat bias = -(float(24) * log(cc_nearFar.x) / log(cc_nearFar.y / cc_nearFar.x));\nfloat eyeDepth = -(cc_matView * worldPos).z;\nuint zIndex = uint(max(log(eyeDepth) * scale + bias, 0.0));\nreturn zIndex;\n}\nuint getClusterIndex(vec4 fragCoord, vec4 worldPos)\n{\nuint zIndex = getClusterZIndex(worldPos);\nfloat clusterSizeX = ceil(cc_viewPort.z / float(16));\nfloat clusterSizeY = ceil(cc_viewPort.w / float(8));\nuvec3 indices = uvec3(uvec2(fragCoord.xy / vec2(clusterSizeX, clusterSizeY)), zIndex);\nuint cluster = (16u * 8u) * indices.z + 16u * indices.y + indices.x;\nreturn cluster;\n}\nvec4 CCClusterShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / 3.14159265359;\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.001);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nuint cluster = getClusterIndex(gl_FragCoord, vec4(position, 1.0));\nLightGrid grid = getLightGrid(cluster);\nuint numLights = grid.ccLights;\nfor (uint i = 0u; i < 100u; i++) {\nif (i >= numLights) break;\nuint lightIndex = getGridLightIndex(grid.offset, i);\nCCLight light = getCCLight(lightIndex);\nvec3 SLU = light.cc_lightPos.xyz - position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.001);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = light.cc_lightSizeRangeAngle.x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = 3.14159265359 * (litRadiusSqr / max(litRadiusSqr , distSqr));\nfloat attRadiusSqrInv = 1.0 / max(light.cc_lightSizeRangeAngle.y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (light.cc_lightPos.w > 0.0) {\nfloat cosInner = max(dot(-light.cc_lightDir.xyz, SL), 0.01);\nfloat cosOuter = light.cc_lightSizeRangeAngle.z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -light.cc_lightDir.xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = light.cc_lightColor.rgb;\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (light.cc_lightPos.w > 0.0) {\n{\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) shadow = CCGetSpotLightShadowFactorSoft2X(shadowPos, position);\nelse if (pcf > 0.9) shadow = CCGetSpotLightShadowFactorSoft(shadowPos, position);\nelse shadow = CCGetSpotLightShadowFactorHard(shadowPos, position);\n}\n}\n#endif\nlightColor *= shadow;\nfinalColor += SNL * lightColor * light.cc_lightColor.w * illum * att * (diffuseContrib + lspec);\n}\nreturn vec4(finalColor, 0.0);\n}\n#endif\nvec3 ACESToneMap (vec3 color) {\ncolor = min(color, vec3(8.0));\nconst float A = 2.51;\nconst float B = 0.03;\nconst float C = 2.43;\nconst float D = 0.59;\nconst float E = 0.14;\nreturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = ACESToneMap(color.rgb);\n#endif\ncolor.rgb = sqrt(color.rgb);\nreturn color;\n}\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\nvoid CC_APPLY_FOG_BASE(inout vec4 color, float factor) {\ncolor = vec4(mix(cc_fogColor.rgb, color.rgb, factor), color.a);\n}\nvec2 signNotZero(vec2 v) {\nreturn vec2((v.x >= 0.0) ? +1.0 : -1.0, (v.y >= 0.0) ? +1.0 : -1.0);\n}\nvec3 oct_to_float32x3(vec2 e) {\nvec3 v = vec3(e.xy, 1.0 - abs(e.x) - abs(e.y));\nif (v.z < 0.0) v.xy = (1.0 - abs(v.yx)) * signNotZero(v.xy);\nreturn normalize(v);\n}\nvec4 screen2WS(vec3 coord) {\nvec3 ndc = vec3(\n2.0 * (coord.x - cc_viewPort.x) / cc_viewPort.z - 1.0,\n2.0 * (coord.y - cc_viewPort.y) / cc_viewPort.w - 1.0,\n2.0 * coord.z - 1.0);\nvec4 world = ((cc_matViewProjInv) * (vec4(ndc, 1.0)));\nworld      = world / world.w;\nreturn world;\n}\nin vec2 v_uv;\n#if CC_DEVICE_CAN_BENEFIT_FROM_INPUT_ATTACHMENT\nlayout(location = 0) inout vec4 gbuffer_albedoMap;\nlayout(location = 1) inout vec4 gbuffer_normalMap;\nlayout(location = 2) inout vec4 gbuffer_emissiveMap;\n#else\nuniform sampler2D gbuffer_albedoMap;\nuniform sampler2D gbuffer_normalMap;\nuniform sampler2D gbuffer_emissiveMap;\n#endif\nuniform sampler2D depth_stencil;\n#if !CC_DEVICE_CAN_BENEFIT_FROM_INPUT_ATTACHMENT || __VERSION__ >= 450\nlayout(location = 0) out vec4 fragColor;\n#endif\nvoid main () {\nStandardSurface s;\n#if CC_DEVICE_CAN_BENEFIT_FROM_INPUT_ATTACHMENT\nvec4 albedoMap = gbuffer_albedoMap;\nvec4 normalMap = gbuffer_normalMap;\nvec4 emissiveMap = gbuffer_emissiveMap;\n#else\nvec4 albedoMap = texture(gbuffer_albedoMap,v_uv);\nvec4 normalMap = texture(gbuffer_normalMap,v_uv);\nvec4 emissiveMap = texture(gbuffer_emissiveMap,v_uv);\n#endif\nfloat depth = texture(depth_stencil, v_uv).x;\ns.albedo = albedoMap;\nvec3 position = screen2WS(vec3(gl_FragCoord.xy, depth)).xyz;\ns.position = position;\ns.roughness = normalMap.z;\ns.normal = oct_to_float32x3(normalMap.xy);\ns.metallic = normalMap.w;\ns.emissive = emissiveMap.xyz;\ns.occlusion = emissiveMap.w;\nfloat fogFactor;\nCC_TRANSFER_FOG_BASE(vec4(position, 1), fogFactor);\nvec4 shadowPos;\nshadowPos = cc_matLightViewProj * vec4(position, 1);\nvec4 color = CCStandardShadingBase(s, shadowPos) +\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 1\nCCClusterShadingAdditive(s, shadowPos);\n#else\nCCStandardShadingAdditive(s, shadowPos);\n#endif\nCC_APPLY_FOG_BASE(color, fogFactor);\ncolor = CCFragOutput(color);\n#if CC_DEVICE_CAN_BENEFIT_FROM_INPUT_ATTACHMENT\ngbuffer_emissiveMap = color;\n#else\nfragColor = color;\n#endif\n}"}],[{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_MORPH\nin float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\nlayout(std140) uniform CCMorph {\nvec4 cc_displacementWeights[15];\nvec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\nivec2 texSize = textureSize(tex, 0);\nreturn texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture(tex, x)),\ndecode32(texture(tex, y)),\ndecode32(texture(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nin vec4 a_joints;\nin vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nin highp vec4 a_jointAnimInfo;\n#endif\nlayout(std140) uniform CCSkinningTexture {\nhighp vec4 cc_jointTextureInfo;\n};\nlayout(std140) uniform CCSkinningAnimation {\nhighp vec4 cc_jointAnimInfo;\n};\nuniform highp sampler2D cc_jointTexture;\n#else\nlayout(std140) uniform CCSkinning {\nhighp vec4 cc_joints[30 * 3];\n};\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\n#if USE_INSTANCING\nin vec4 a_matWorld0;\nin vec4 a_matWorld1;\nin vec4 a_matWorld2;\n#if USE_LIGHTMAP\nin vec4 a_lightingMapUVParam;\n#endif\n#elif USE_BATCHING\nin float a_dyn_batch_id;\nlayout(std140) uniform CCLocalBatched {\nhighp mat4 cc_matWorlds[10];\n};\n#else\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\n};\n#endif\nlayout(std140) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nhighp vec4 cc_shadowInvProjDepthInfo;\nhighp vec4 cc_shadowProjDepthInfo;\nhighp vec4 cc_shadowProjInfo;\nmediump vec4 cc_shadowNFLSInfo;\nmediump vec4 cc_shadowWHPBInfo;\nmediump vec4 cc_shadowLPNNInfo;\nlowp vec4 cc_shadowColor;\nmediump vec4 cc_planarNDInfo;\n};\nout float v_dist;\nvec4 vert () {\nvec4 position;\nposition = vec4(a_position, 1.0);\n#if CC_USE_MORPH\napplyMorph(position);\n#endif\n#if CC_USE_SKINNING\nCCSkin(position);\n#endif\nmat4 matWorld;\n#if USE_INSTANCING\nmatWorld = mat4(\nvec4(a_matWorld0.xyz, 0.0),\nvec4(a_matWorld1.xyz, 0.0),\nvec4(a_matWorld2.xyz, 0.0),\nvec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n);\n#elif USE_BATCHING\nmatWorld = cc_matWorlds[int(a_dyn_batch_id)];\n#else\nmatWorld = cc_matWorld;\n#endif\nvec3 P = (matWorld * position).xyz;\nvec3 L = cc_mainLitDir.xyz;\nvec3 N = cc_planarNDInfo.xyz;\nfloat d = cc_planarNDInfo.w + 0.001;\nfloat dist = (-d - dot(P, N)) / (dot(L, N) + 0.0001);\nvec3 shadowPos = P + L * dist;\nvec3 view = normalize(cc_cameraPos.xyz - shadowPos);\nfloat viewLength = length(cc_cameraPos.xyz - shadowPos);\nshadowPos += view * min(1.0, 0.005 * viewLength);\nposition = cc_matProj * cc_matView * vec4(shadowPos, 1.0);\nv_dist = dist;\nreturn position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nhighp vec4 cc_shadowInvProjDepthInfo;\nhighp vec4 cc_shadowProjDepthInfo;\nhighp vec4 cc_shadowProjInfo;\nmediump vec4 cc_shadowNFLSInfo;\nmediump vec4 cc_shadowWHPBInfo;\nmediump vec4 cc_shadowLPNNInfo;\nlowp vec4 cc_shadowColor;\nmediump vec4 cc_planarNDInfo;\n};\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nin float v_dist;\nvec4 frag () {\nif(v_dist < 0.0)\ndiscard;\nreturn CCFragOutput(cc_shadowColor);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_MORPH\nin float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\nlayout(std140) uniform CCMorph {\nvec4 cc_displacementWeights[15];\nvec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\nivec2 texSize = textureSize(tex, 0);\nreturn texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture(tex, x)),\ndecode32(texture(tex, y)),\ndecode32(texture(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nattr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nattr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nattr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\nin vec4 a_joints;\nin vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n#if USE_INSTANCING\nin highp vec4 a_jointAnimInfo;\n#endif\nlayout(std140) uniform CCSkinningTexture {\nhighp vec4 cc_jointTextureInfo;\n};\nlayout(std140) uniform CCSkinningAnimation {\nhighp vec4 cc_jointAnimInfo;\n};\nuniform highp sampler2D cc_jointTexture;\n#else\nlayout(std140) uniform CCSkinning {\nhighp vec4 cc_joints[30 * 3];\n};\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\n#if USE_INSTANCING\nhighp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n#else\nhighp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n#endif\nhighp float invSize = cc_jointTextureInfo.w;\nhighp float y = floor(j * invSize);\nhighp float x = floor(j - y * cc_jointTextureInfo.x);\ny = (y + 0.5) * invSize;\nvec4 v1 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\nmat4 m = skinMatrix();\nattr.position = m * attr.position;\nattr.normal = (m * vec4(attr.normal, 0.0)).xyz;\nattr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nout vec2 v_uv;\nvoid main () {\nStandardVertInput In;\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In);\n#endif\nIn.position.xy = cc_cameraPos.w == 0.0 ? vec2(In.position.xy.x, -In.position.xy.y) : In.position.xy;\ngl_Position = In.position;\ngl_Position.y = gl_Position.y;\nv_uv = a_texCoord;\n}",frag:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\n#if ANTIALIAS_TYPE == 1\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 resolution,\nvec2 v_rgbNW, vec2 v_rgbNE,\nvec2 v_rgbSW, vec2 v_rgbSE,\nvec2 v_rgbM) {\nvec4 color;\nmediump vec2 inverseVP = vec2(1.0 / resolution.x, 1.0 / resolution.y);\nvec3 rgbNW = texture(tex, v_rgbNW).xyz;\nvec3 rgbNE = texture(tex, v_rgbNE).xyz;\nvec3 rgbSW = texture(tex, v_rgbSW).xyz;\nvec3 rgbSE = texture(tex, v_rgbSE).xyz;\nvec4 texColor = texture(tex, v_rgbM);\nvec3 rgbM  = texColor.xyz;\nvec3 luma = vec3(0.299, 0.587, 0.114);\nfloat lumaNW = dot(rgbNW, luma);\nfloat lumaNE = dot(rgbNE, luma);\nfloat lumaSW = dot(rgbSW, luma);\nfloat lumaSE = dot(rgbSE, luma);\nfloat lumaM  = dot(rgbM,  luma);\nfloat lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\nfloat lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\nmediump vec2 dir;\ndir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\ndir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\nfloat dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n(0.25 * (1.0 / 8.0)), (1.0/ 128.0));\nfloat rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\ndir = min(vec2(8.0, 8.0),\nmax(vec2(-8.0, -8.0),\ndir * rcpDirMin)) * inverseVP;\nvec3 rgbA = 0.5 * (\ntexture(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\ntexture(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\nvec3 rgbB = rgbA * 0.5 + 0.25 * (\ntexture(tex, fragCoord * inverseVP + dir * -0.5).xyz +\ntexture(tex, fragCoord * inverseVP + dir * 0.5).xyz);\nfloat lumaB = dot(rgbB, luma);\nif ((lumaB < lumaMin) || (lumaB > lumaMax))\ncolor = vec4(rgbA, texColor.a);\nelse\ncolor = vec4(rgbB, texColor.a);\nreturn color;\n}\n#endif\nin vec2 v_uv;\nuniform sampler2D outputResultMap;\nlayout(location = 0) out vec4 fragColor;\nvoid texcoords(vec2 fragCoord, vec2 resolution,\nout vec2 v_rgbNW, out vec2 v_rgbNE,\nout vec2 v_rgbSW, out vec2 v_rgbSE,\nout vec2 v_rgbM) {\nvec2 inverseVP = 1.0 / resolution.xy;\nv_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\nv_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\nv_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\nv_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\nv_rgbM = vec2(fragCoord * inverseVP);\n}\nvoid main () {\nmediump vec2 v_rgbNW;\nmediump vec2 v_rgbNE;\nmediump vec2 v_rgbSW;\nmediump vec2 v_rgbSE;\nmediump vec2 v_rgbM;\n#if ANTIALIAS_TYPE == 1\nvec2 resolution = cc_screenSize.xy;\nvec2 fragCoord = v_uv * resolution;\ntexcoords(fragCoord, resolution, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\nfragColor = fxaa(outputResultMap, fragCoord, resolution, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n#else\nfragColor = texture(outputResultMap, v_uv);\n#endif\n}"}],[{vert:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\nout mediump vec4 viewDir;\nvec4 vert () {\nviewDir = vec4(a_position, 1.0);\nmat4 matViewRotOnly = mat4(mat3(cc_matView));\nvec4 pos = matViewRotOnly * viewDir;\nif (cc_matProj[3].w > 0.0) {\nmat4 matProj = cc_matProj;\nmatProj[0].x = 5.2;\nmatProj[1].y = 2.6;\nmatProj[2].zw = vec2(-1.0);\nmatProj[3].zw = vec2(0.0);\npos = matProj * pos;\n} else {\npos = cc_matProj * pos;\n}\npos.z = 0.99999 * pos.w;\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nuniform samplerCube cc_environment;\nvec3 unpackRGBE (vec4 rgbe) {\nreturn rgbe.rgb * pow(1.1, rgbe.a * 255.0 - 128.0);\n}\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nvec3 ACESToneMap (vec3 color) {\ncolor = min(color, vec3(8.0));\nconst float A = 2.51;\nconst float B = 0.03;\nconst float C = 2.43;\nconst float D = 0.59;\nconst float E = 0.14;\nreturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = ACESToneMap(color.rgb);\n#endif\ncolor.rgb = sqrt(color.rgb);\nreturn color;\n}\nin mediump vec4 viewDir;\nvec4 frag () {\n#if USE_RGBE_CUBEMAP\nvec3 c = unpackRGBE(texture(cc_environment, viewDir.xyz));\n#else\nvec3 c = SRGBToLinear(texture(cc_environment, viewDir.xyz).rgb);\n#endif\nreturn CCFragOutput(vec4(c * cc_ambientSky.w, 1.0));\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nin vec3 a_position;\nin vec4 a_color;\nout vec2 v_uv;\nlayout(std140) uniform Constants {\nvec4 offset;\n};\nlayout(std140) uniform PerFrameInfo {\nvec4 digits[8 * 10 / 4];\n};\nfloat getComponent(vec4 v, float i) {\nif (i < 1.0) { return v.x; }\nelse if (i < 2.0) { return v.y; }\nelse if (i < 3.0) { return v.z; }\nelse { return v.w; }\n}\nvec4 vert () {\nmat2 proj = mat2(cc_matProj[0].xy, cc_matProj[1].xy);\nproj /= abs(proj[1].x + proj[1].y);\nvec2 position = proj * a_position.xy + offset.xy;\nv_uv = a_color.xy;\nif (a_color.z >= 0.0) {\nfloat n = getComponent(digits[int(a_color.z)], a_color.w);\nv_uv += vec2(offset.z * n, 0.0);\n}\nreturn vec4(position, 0.0, 1.0);\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nin vec2 v_uv;\nuniform sampler2D mainTexture;\nvec4 frag () {\nreturn CCFragOutput(texture(mainTexture, v_uv));\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nin vec2 a_position;\nin vec2 a_texCoord;\nout vec2 v_uv;\nlayout(std140) uniform Constant {\nvec4 u_buffer0;\nvec4 u_buffer1;\nmat4 u_projection;\n};\nvec4 vert () {\nvec2 worldPos = a_position * u_buffer1.xy + u_buffer1.zw;\nvec2 clipSpace = worldPos / u_buffer0.xy * 2.0 - 1.0;\nvec4 screenPos = u_projection * vec4(clipSpace, 0.0, 1.0);\nv_uv = a_texCoord;\nreturn screenPos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nin vec2 v_uv;\nlayout(std140) uniform Factor {\nfloat u_percent;\n};\nuniform sampler2D mainTexture;\nvec4 frag () {\nvec4 color = texture(mainTexture, v_uv);\nfloat percent = clamp(u_percent, 0.0, 1.0);\ncolor.xyz *= percent;\nreturn color;\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}]]},Ng=function(){function t(){this._device=null,this._resources={}}var e=t.prototype;return e.initBuiltinRes=function(t){var e=this;this._device=t;for(var n=this._resources,r=new Uint8Array(16),a=new Uint8Array(16),o=new Uint8Array(16),s=new Uint8Array(16),c=new Uint8Array(16),l=0,u=0;u<4;u++)r[l]=0,r[l+1]=0,r[l+2]=0,r[l+3]=255,a[l]=0,a[l+1]=0,a[l+2]=0,a[l+3]=0,o[l]=119,o[l+1]=119,o[l+2]=119,o[l+3]=255,s[l]=255,s[l+1]=255,s[l+2]=255,s[l+3]=255,c[l]=127,c[l+1]=127,c[l+2]=255,c[l+3]=255,l+=4;var h=new Uint8Array(1024);l=0;for(var f=0;f<256;f++)h[l]=221,h[l+1]=221,h[l+2]=221,h[l+3]=255,l+=4;l=0;for(var _=0;_<8;_++){for(var p=0;p<8;p++)h[l]=85,h[l+1]=85,h[l+2]=85,h[l+3]=255,l+=4;l+=32}l+=32;for(var d=0;d<8;d++){for(var m=0;m<8;m++)h[l]=85,h[l+1]=85,h[l+2]=85,h[l+3]=255,l+=4;l+=32}var g={width:2,height:2,_data:r,_compressed:!1,format:ng.PixelFormat.RGBA8888},v={width:2,height:2,_data:a,_compressed:!1,format:ng.PixelFormat.RGBA8888},y={width:2,height:2,_data:o,_compressed:!1,format:ng.PixelFormat.RGBA8888},x={width:2,height:2,_data:s,_compressed:!1,format:ng.PixelFormat.RGBA8888},S={width:2,height:2,_data:c,_compressed:!1,format:ng.PixelFormat.RGBA8888},T={width:16,height:16,_data:h,_compressed:!1,format:ng.PixelFormat.RGBA8888},A=new Dm(g),E=new ng;E._uuid="black-texture",E.image=A,n[E._uuid]=E;var C=new Dm(v),b=new ng;b._uuid="empty-texture",b.image=C,n[b._uuid]=b;var w=new ig;w._uuid="black-cube-texture",w.setMipFilter(ig.Filter.NEAREST),w.image={front:new Dm(g),back:new Dm(g),left:new Dm(g),right:new Dm(g),top:new Dm(g),bottom:new Dm(g)},n[w._uuid]=w;var P=new Dm(y),I=new ng;I._uuid="grey-texture",I.image=P,n[I._uuid]=I;var R=new Dm(x),D=new ng;D._uuid="white-texture",D.image=R,n[D._uuid]=D;var O=new ig;O._uuid="white-cube-texture",O.setMipFilter(ig.Filter.NEAREST),O.image={front:new Dm(x),back:new Dm(x),left:new Dm(x),right:new Dm(x),top:new Dm(x),bottom:new Dm(x)},n[O._uuid]=O;var M=new Dm(S),N=new ng;N._uuid="normal-texture",N.image=M,n[N._uuid]=N;var L=new Dm(T),B=new ng;B._uuid="default-texture",B.image=L,n[B._uuid]=B;var F=new ig;if(F.setMipFilter(ig.Filter.NEAREST),F._uuid="default-cube-texture",F.image={front:new Dm(T),back:new Dm(T),left:new Dm(T),right:new Dm(T),top:new Dm(T),bottom:new Dm(T)},n[F._uuid]=F,i.SpriteFrame){var z=new i.SpriteFrame,U=A,k=new ng;k.image=U,z.texture=k,z._uuid="default-spriteframe",n[z._uuid]=z}var G=Pg(t);if(!G)return Promise.reject(Error("Failed to initialize builtin shaders: unknown device."));var H=Mg[G];return H?Promise.resolve().then((function(){sg.forEach((function(t,e){var n=Object.assign(new i.EffectAsset,t);n.shaders.forEach((function(t,n){var i=H[e][n];i&&(t[G]=i)})),n.hideInEditor=!0,n.onLoaded()})),e._initMaterials()})):Promise.reject(Error("Current device is requiring builtin shaders of version "+G+" but shaders of that version are not assembled in this build."))},e.get=function(t){return this._resources[t]},e._initMaterials=function(){var t=this._resources,e=[],n=new i.Material;n._uuid="standard-material",n.initialize({effectName:"standard"}),t[n._uuid]=n,e.push(n);var r=new i.Material;r._uuid="missing-effect-material",r.initialize({effectName:"unlit",defines:{USE_COLOR:!0}}),r.setProperty("mainColor",i.color("#ffff00")),t[r._uuid]=r,e.push(r);var a=new i.Material;a._uuid="missing-material",a.initialize({effectName:"unlit",defines:{USE_COLOR:!0}}),a.setProperty("mainColor",i.color("#ff00ff")),t[a._uuid]=a,e.push(a);var o=new i.Material;o._uuid="default-clear-stencil",o.initialize({defines:{USE_TEXTURE:!1},effectName:"clear-stencil"}),t[o._uuid]=o,e.push(o);var s=new i.Material;s._uuid="ui-base-material",s.initialize({defines:{USE_TEXTURE:!1},effectName:"sprite"}),t[s._uuid]=s,e.push(s);var c=new i.Material;c._uuid="ui-sprite-material",c.initialize({defines:{USE_TEXTURE:!0,CC_USE_EMBEDDED_ALPHA:!1,IS_GRAY:!1},effectName:"sprite"}),t[c._uuid]=c,e.push(c);var l=new i.Material;l._uuid="ui-alpha-test-material",l.initialize({defines:{USE_TEXTURE:!0,USE_ALPHA_TEST:!0,CC_USE_EMBEDDED_ALPHA:!1,IS_GRAY:!1},effectName:"sprite"}),t[l._uuid]=l,e.push(l);var u=new i.Material;u._uuid="ui-sprite-gray-material",u.initialize({defines:{USE_TEXTURE:!0,CC_USE_EMBEDDED_ALPHA:!1,IS_GRAY:!0},effectName:"sprite"}),t[u._uuid]=u,e.push(u);var h=new i.Material;h._uuid="ui-sprite-alpha-sep-material",h.initialize({defines:{USE_TEXTURE:!0,CC_USE_EMBEDDED_ALPHA:!0,IS_GRAY:!1},effectName:"sprite"}),t[h._uuid]=h,e.push(h);var f=new i.Material;f._uuid="ui-sprite-gray-alpha-sep-material",f.initialize({defines:{USE_TEXTURE:!0,CC_USE_EMBEDDED_ALPHA:!0,IS_GRAY:!0},effectName:"sprite"}),t[f._uuid]=f,e.push(f);var _=new i.Material;_._uuid="ui-graphics-material",_.initialize({effectName:"graphics"}),t[_._uuid]=_,e.push(_);var p=new i.Material;p._uuid="default-particle-material",p.initialize({effectName:"particle"}),t[p._uuid]=p,e.push(p);var d=new i.Material;d._uuid="default-particle-gpu-material",d.initialize({effectName:"particle-gpu"}),t[d._uuid]=d,e.push(d);var m=new i.Material;m._uuid="default-trail-material",m.initialize({effectName:"particle-trail"}),t[m._uuid]=m,e.push(m);var g=new i.Material;g._uuid="default-billboard-material",g.initialize({effectName:"billboard"}),t[g._uuid]=g,e.push(g);var v=new i.Material;v._uuid="default-spine-material",v.initialize({defines:{USE_TEXTURE:!0,CC_USE_EMBEDDED_ALPHA:!1,IS_GRAY:!1},effectName:"spine"}),t[v._uuid]=v,e.push(v),i.game.on(i.Game.EVENT_GAME_INITED,(function(){for(var t=0;t<e.length;++t)for(var n=e[t],i=0;i<n.passes.length;++i)n.passes[i].tryCompile()}))},t}(),Lg=t("builtinResMgr",i.builtinResMgr=new Ng),Bg=t("getPhaseID",(Rg=new Map,Dg=0,function(t){return"number"==typeof t?t:(Rg.has(t)||(Rg.set(t,1<<Dg),Dg++),Rg.get(t))})),Fg=t("InstancedBuffer",function(){function t(t){this.instances=[],this.pass=void 0,this.hasPendingModels=!1,this.dynamicOffsets=[],this._device=void 0,this._device=t.device,this.pass=t}var e=t.prototype;return e.destroy=function(){for(var t=0;t<this.instances.length;++t){var e=this.instances[t];e.vb.destroy(),e.ia.destroy()}this.instances.length=0},e.merge=function(t,e,n,i){void 0===i&&(i=null);var r=e.buffer.length;if(r){var a=t.inputAssembler,o=t.descriptorSet.getTexture(Nd),s=i;s||(s=t.shaders[n]);for(var c=t.descriptorSet,l=0;l<this.instances.length;++l){var u=this.instances[l];if(!(u.ia.indexBuffer!==a.indexBuffer||u.count>=1024)&&u.lightingMap===o&&u.stride===r){if(u.count>=u.capacity){u.capacity<<=1;var h=u.stride*u.capacity,f=u.data;u.data=new Uint8Array(h),u.data.set(f),u.vb.resize(h)}return u.shader!==s&&(u.shader=s),u.descriptorSet!==c&&(u.descriptorSet=c),u.data.set(e.buffer,u.stride*u.count++),void(this.hasPendingModels=!0)}}for(var _=this._device.createBuffer(new Ta(Er.VERTEX|Er.TRANSFER_DST,wr.HOST|wr.DEVICE,32*r,r)),p=new Uint8Array(32*r),d=a.vertexBuffers.slice(),m=a.attributes.slice(),g=a.indexBuffer,v=0;v<e.attributes.length;v++){var y=e.attributes[v],x=new Ua(y.name,y.format,y.isNormalized,d.length,!0);m.push(x)}p.set(e.buffer),d.push(_);var S=new Ga(m,d,g),T=this._device.createInputAssembler(S);this.instances.push({count:1,capacity:32,vb:_,data:p,ia:T,stride:r,shader:s,descriptorSet:c,lightingMap:o}),this.hasPendingModels=!0}},e.uploadBuffers=function(t){for(var e=0;e<this.instances.length;++e){var n=this.instances[e];n.count&&(n.ia.instanceCount=n.count,t.updateBuffer(n.vb,n.data))}},e.clear=function(){for(var t=0;t<this.instances.length;++t)this.instances[t].count=0;this.hasPendingModels=!1},t}()),zg=function(){function t(t){this.batches=[],this.dynamicOffsets=[],this._device=void 0,this._device=t.device}var e=t.prototype;return e.destroy=function(){for(var t=0;t<this.batches.length;++t){for(var e=this.batches[t],n=0;n<e.vbs.length;++n)e.vbs[n].destroy();e.vbIdx.destroy(),e.ia.destroy(),e.ubo.destroy()}this.batches.length=0},e.merge=function(t,e,n){var i=t.subMesh.flatBuffers;if(0!==i.length){for(var r=0,a=0,o=i[0].count,s=t.passes[e],c=t.shaders[e],l=t.descriptorSet,u=!1,h=0;h<this.batches.length;++h){var f=this.batches[h];if(f.vbs.length===i.length&&f.mergeCount<pd.BATCHING_COUNT){u=!0;for(var _=0;_<f.vbs.length;++_)if(f.vbs[_].stride!==i[_].stride){u=!1;break}if(u){for(var p=0;p<f.vbs.length;++p){var d=i[p],m=f.vbs[p],g=f.vbDatas[p];(r=(o+f.vbCount)*d.stride)>m.size&&(m.resize(r),f.vbDatas[p]=new Uint8Array(r),f.vbDatas[p].set(g)),f.vbDatas[p].set(d.buffer,f.vbCount*d.stride)}var v=f.vbIdxData;(a=4*(o+f.vbCount))>f.vbIdx.size&&(f.vbIdx.resize(a),f.vbIdxData=new Float32Array(a/Float32Array.BYTES_PER_ELEMENT),f.vbIdxData.set(v),v=f.vbIdxData);var y=f.vbCount,x=y+o,S=f.mergeCount;if(v[y]!==S||v[x-1]!==S)for(var T=y;T<x;T++)v[T]=S+.1;return Ri.toArray(f.uboData,n.transform.worldMatrix,pd.MAT_WORLDS_OFFSET+16*f.mergeCount),f.mergeCount||(l.bindBuffer(pd.BINDING,f.ubo),l.update(),f.pass=s,f.shader=c,f.descriptorSet=l),++f.mergeCount,f.vbCount+=o,void(f.ia.vertexCount+=o)}}}for(var A=[],E=[],C=[],b=0;b<i.length;++b){var w=i[b],P=this._device.createBuffer(new Ta(Er.VERTEX|Er.TRANSFER_DST,wr.HOST|wr.DEVICE,w.count*w.stride,w.stride));P.update(w.buffer.buffer),A.push(P),E.push(new Uint8Array(P.size)),C.push(P)}var I=this._device.createBuffer(new Ta(Er.VERTEX|Er.TRANSFER_DST,wr.HOST|wr.DEVICE,4*o,4)),R=new Float32Array(o);R.fill(0),I.update(R),C.push(I);for(var D=t.inputAssembler.attributes,O=new Array(D.length+1),M=0;M<D.length;++M)O[M]=D[M];O[D.length]=new Ua("a_dyn_batch_id",Sr.R32F,!1,i.length);var N=new Ga(O,C),L=this._device.createInputAssembler(N),B=this._device.createBuffer(new Ta(Er.UNIFORM|Er.TRANSFER_DST,wr.HOST|wr.DEVICE,pd.SIZE,pd.SIZE));l.bindBuffer(pd.BINDING,B),l.update();var F=new Float32Array(pd.COUNT);Ri.toArray(F,n.transform.worldMatrix,pd.MAT_WORLDS_OFFSET),this.batches.push({mergeCount:1,vbs:A,vbDatas:E,vbIdx:I,vbIdxData:R,vbCount:o,ia:L,ubo:B,uboData:F,pass:s,shader:c,descriptorSet:l})}},e.clear=function(){for(var t=0;t<this.batches.length;++t){var e=this.batches[t];e.vbCount=0,e.mergeCount=0,e.ia.vertexCount=0}},t}(),Ug=new Ta(Er.UNIFORM|Er.TRANSFER_DST,wr.DEVICE),kg=new Aa(null),Gg=new Ja(null);!function(t){t[t.NONE=0]="NONE",t[t.INSTANCING=1]="INSTANCING",t[t.VB_MERGING=2]="VB_MERGING"}(Og||(Og={}));var Hg=function(){function t(t){this._rootBuffer=null,this._buffers=[],this._descriptorSet=null,this._pipelineLayout=null,this._passIndex=0,this._propertyIndex=0,this._programName="",this._dynamics={},this._propertyHandleMap={},this._rootBlock=null,this._blocksInt=[],this._blocks=[],this._shaderInfo=null,this._defines={},this._properties={},this._shader=null,this._bs=new Bo,this._dss=new No,this._rs=new Mo,this._priority=Bp.DEFAULT,this._stage=Lp.DEFAULT,this._phase=Bg("default"),this._primitive=Xr.TRIANGLE_LIST,this._batchingScheme=Og.NONE,this._dynamicStates=Qr.NONE,this._instancedBuffers={},this._batchedBuffers={},this._hash=0,this._root=void 0,this._device=void 0,this._passHandle=0,this._rootBufferDirty=!1,this._root=t,this._device=t.device}t.fillPipelineInfo=function(t,e){void 0!==e.priority&&t._setPriority(e.priority),void 0!==e.primitive&&t._setPrimitive(e.primitive),void 0!==e.stage&&t._setStage(e.stage),void 0!==e.dynamicStates&&t._setDynamicState(e.dynamicStates),void 0!==e.phase&&t._setPhase(Bg(e.phase));var n=t._bs;if(e.blendState){var i=e.blendState,r=i.targets;r&&r.forEach((function(t,e){n.setTarget(e,t)})),void 0!==i.isA2C&&(n.isA2C=i.isA2C),void 0!==i.isIndepend&&(n.isIndepend=i.isIndepend),void 0!==i.blendColor&&(n.blendColor=i.blendColor)}t._rs.assign(e.rasterizerState),t._dss.assign(e.depthStencilState)},t.getPassHash=function(t){var e,n=Ig.getKey(t.program,t.defines)+","+t._primitive+","+t._dynamicStates;return n+=function(t){for(var e,n=",bs,"+t.isA2C,i=W(t.targets);!(e=i()).done;){var r=e.value;n+=",bt,"+r.blend+","+r.blendEq+","+r.blendAlphaEq+","+r.blendColorMask,n+=","+r.blendSrc+","+r.blendDst+","+r.blendSrcAlpha+","+r.blendDstAlpha}return n}(t._bs),n+=function(t){var e=",dss,"+t.depthTest+","+t.depthWrite+","+t.depthFunc;return e+=","+t.stencilTestFront+","+t.stencilFuncFront+","+t.stencilRefFront+","+t.stencilReadMaskFront,e+=","+t.stencilFailOpFront+","+t.stencilZFailOpFront+","+t.stencilPassOpFront+","+t.stencilWriteMaskFront,(e+=","+t.stencilTestBack+","+t.stencilFuncBack+","+t.stencilRefBack+","+t.stencilReadMaskBack)+","+t.stencilFailOpBack+","+t.stencilZFailOpBack+","+t.stencilPassOpBack+","+t.stencilWriteMaskBack}(t._dss),Po(n+=",rs,"+(e=t._rs).cullMode+","+e.depthBias+","+e.isFrontFaceCCW,666)};var e=t.prototype;return e.initialize=function(t){this._doInit(t),this.resetUBOs(),this.resetTextures(),this.tryCompile()},e.getHandle=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=Ar.UNKNOWN);var i=this._propertyHandleMap[t];return i?(n?i=mg(i,n):e&&(i=mg(i,fg(i)-e)),i+e):0},e.getBinding=function(e){var n=this.getHandle(e);return n?t.getBindingFromHandle(n):-1},e.setUniform=function(e,n){var i=t.getBindingFromHandle(e),r=t.getTypeFromHandle(e),a=t.getOffsetFromHandle(e),o=this._getBlockView(r,i);vg[r](o,n,a),this._setRootBufferDirty(!0)},e.getUniform=function(e,n){var i=t.getBindingFromHandle(e),r=t.getTypeFromHandle(e),a=t.getOffsetFromHandle(e),o=this._getBlockView(r,i);return gg[r](o,n,a)},e.setUniformArray=function(e,n){for(var i=t.getBindingFromHandle(e),r=t.getTypeFromHandle(e),a=vo(r)>>2,o=this._getBlockView(r,i),s=t.getOffsetFromHandle(e),c=0;c<n.length;c++,s+=a)null!==n[c]&&vg[r](o,n[c],s);this._setRootBufferDirty(!0)},e.bindTexture=function(t,e,n){this._descriptorSet.bindTexture(t,e,n||0)},e.bindSampler=function(t,e,n){this._descriptorSet.bindSampler(t,e,n||0)},e.setDynamicState=function(t,e){var n=this._dynamics[t];n&&n.value===e||(n.value=e,n.dirty=!0)},e.overridePipelineStates=function(){console.warn("base pass cannot override states, please use pass instance instead.")},e._setRootBufferDirty=function(t){this._rootBufferDirty=t},e.update=function(){this._descriptorSet?(this._rootBuffer&&this._rootBufferDirty&&(this._rootBuffer.update(this._rootBlock),this._setRootBufferDirty(!1)),this._descriptorSet.update()):b(12006)},e.getInstancedBuffer=function(t){return void 0===t&&(t=0),this._instancedBuffers[t]||(this._instancedBuffers[t]=new Fg(this))},e.getBatchedBuffer=function(t){return void 0===t&&(t=0),this._batchedBuffers[t]||(this._batchedBuffers[t]=new zg(this))},e._initNative=function(){},e._destroy=function(){},e.destroy=function(){for(var t=0;t<this._shaderInfo.blocks.length;t++){var e=this._shaderInfo.blocks[t];this._buffers[e.binding].destroy()}for(var n in this._buffers=[],this._rootBuffer&&(this._rootBuffer.destroy(),this._rootBuffer=null),this._instancedBuffers)this._instancedBuffers[n].destroy();for(var i in this._batchedBuffers)this._batchedBuffers[i].destroy();this._descriptorSet.destroy(),this._rs.destroy(),this._dss.destroy(),this._bs.destroy(),this._destroy()},e.resetUniform=function(e){var n=this.getHandle(e);if(n){for(var i=t.getTypeFromHandle(n),r=t.getBindingFromHandle(n),a=t.getOffsetFromHandle(n),o=t.getCountFromHandle(n),s=this._getBlockView(i,r),c=this._properties[e],l=c&&c.value||xg(i),u=(vo(i)>>2)*o,h=0;h+l.length<=u;h+=l.length)s.set(l,a+h);this._setRootBufferDirty(!0)}},e.resetTexture=function(e,n){var i=this.getHandle(e);if(i){var r=t.getTypeFromHandle(i),a=t.getBindingFromHandle(i),o=this._properties[e],s=o&&o.value,c=s?s+"-texture":xg(r),l=Lg.get(c),u=l&&l.getGFXTexture(),h=o&&void 0!==o.samplerHash?Go.unpackFromHash(o.samplerHash):l&&l.getSamplerInfo(),f=this._device.getSampler(h);this._descriptorSet.bindSampler(a,f,n),this._descriptorSet.bindTexture(a,u,n)}},e.resetUBOs=function(){for(var t=0;t<this._shaderInfo.blocks.length;t++)for(var e=this._shaderInfo.blocks[t],n=0,i=0;i<e.members.length;i++){for(var r=e.members[i],a=this._getBlockView(r.type,e.binding),o=this._properties[r.name],s=o&&o.value||xg(r.type),c=(vo(r.type)>>2)*r.count,l=0;l+s.length<=c;l+=s.length)a.set(s,n+l);n+=c}this._setRootBufferDirty(!0)},e.resetTextures=function(){for(var t=0;t<this._shaderInfo.samplerTextures.length;t++)for(var e=this._shaderInfo.samplerTextures[t],n=0;n<e.count;n++)this.resetTexture(e.name,n)},e.tryCompile=function(){var e=this._root.pipeline;if(!e)return!1;this._syncBatchingScheme();var n=Ig.getGFXShader(this._device,this._programName,this._defines,e);return n?(this._shader=n,this._setPipelineLayout(Ig.getTemplateInfo(this._programName).pipelineLayout),this._setHash(t.getPassHash(this)),!0):(console.warn("create shader "+this._programName+" failed"),!1)},e.getShaderVariant=function(t){if(void 0===t&&(t=null),!this._shader&&!this.tryCompile())return console.warn("pass resources incomplete"),null;if(!t)return this._shader;for(var e=this._root.pipeline,n=0;n<t.length;n++){var i=t[n];this._defines[i.name]=i.value}for(var r=Ig.getGFXShader(this._device,this._programName,this._defines,e),a=0;a<t.length;a++){var o=t[a];delete this._defines[o.name]}return r},e.beginChangeStatesSilently=function(){},e.endChangeStatesSilently=function(){},e._setPriority=function(t){this._priority=t},e._setStage=function(t){this._stage=t},e._setPhase=function(t){this._phase=t},e._setPrimitive=function(t){this._primitive=t},e._setState=function(t,e,n,i){this._bs=t,this._dss=e,this._rs=n,this._descriptorSet=i},e._doInit=function(e,n){void 0===n&&(n=!1),this._initNative(),this._setPriority(Bp.DEFAULT),this._setStage(Lp.DEFAULT),this._setPhase(Bg("default")),this._setPrimitive(Xr.TRIANGLE_LIST),this._passIndex=e.passIndex,this._propertyIndex=void 0!==e.propertyIndex?e.propertyIndex:e.passIndex,this._programName=e.program,this._defines=n?B({},e.defines):e.defines,this._shaderInfo=Ig.getTemplate(e.program),this._properties=e.properties||this._properties;var i=this._device;t.fillPipelineInfo(this,e),e.stateOverrides&&t.fillPipelineInfo(this,e.stateOverrides),Gg.layout=Ig.getDescriptorSetLayout(this._device,e.program),this._descriptorSet=this._device.createDescriptorSet(Gg),this._setState(this._bs,this._dss,this._rs,this._descriptorSet);for(var r=this._shaderInfo.blocks,a=Ig.getTemplateInfo(e.program),o=a.blockSizes,s=a.handleMap,c=i.capabilities.uboOffsetAlignment,l=[],u=0,h=0,f=0;f<r.length;f++){var _=o[f];l.push(h),h+=Math.ceil(_/c)*c,u=_}var p=l[l.length-1]+u;p&&(Ug.size=16*Math.ceil(p/16),this._rootBuffer=i.createBuffer(Ug),this._rootBlock=new ArrayBuffer(p));for(var d=0,m=0;d<r.length;d++){var g=r[d].binding,v=o[d];kg.buffer=this._rootBuffer,kg.offset=l[m++],kg.range=16*Math.ceil(v/16);var y=this._buffers[g]=i.createBuffer(kg);this._blocks[g]=new Float32Array(this._rootBlock,kg.offset,v/Float32Array.BYTES_PER_ELEMENT),this._blocksInt[g]=new Int32Array(this._blocks[g].buffer,this._blocks[g].byteOffset,this._blocks[g].length),this._descriptorSet.bindBuffer(g,y)}var x=this._propertyHandleMap=s,S={};for(var T in this._properties){var A=this._properties[T];A.handleInfo&&(S[T]=this.getHandle.apply(this,A.handleInfo))}Object.assign(x,S)},e._syncBatchingScheme=function(){this._defines.USE_INSTANCING?this._device.hasFeature(xr.INSTANCED_ARRAYS)?this._setBatchingScheme(Og.INSTANCING):(this._defines.USE_INSTANCING=!1,this._setBatchingScheme(Og.NONE)):this._defines.USE_BATCHING?this._setBatchingScheme(Og.VB_MERGING):this._setBatchingScheme(Og.NONE)},e._setBatchingScheme=function(t){this._batchingScheme=t},e._setDynamicState=function(t){this._dynamicStates=t},e._setHash=function(t){this._hash=t},e._getBlockView=function(t,e){return t<Ar.FLOAT?this._blocksInt[e]:this._blocks[e]},e._setPipelineLayout=function(t){this._pipelineLayout=t},e._initPassFromTarget=function(t,e,n,i){this._initNative(),this._setPriority(t.priority),this._setStage(t.stage),this._setPhase(t.phase),this._setBatchingScheme(t.batchingScheme),this._setPrimitive(t.primitive),this._setDynamicState(t.dynamicStates),this._setState(n,e,t.rasterizerState,t.descriptorSet),this._passIndex=t.passIndex,this._propertyIndex=t.propertyIndex,this._programName=t.program,this._defines=t.defines,this._shaderInfo=t._shaderInfo,this._properties=t._properties,this._blocks=t._blocks,this._blocksInt=t._blocksInt,this._dynamics=t._dynamics,this._shader=t._shader,this._setPipelineLayout(Ig.getTemplateInfo(this._programName).pipelineLayout),this._setHash(t._hash^i)},L(t,[{key:"native",get:function(){return this._nativeObj}},{key:"root",get:function(){return this._root}},{key:"device",get:function(){return this._device}},{key:"shaderInfo",get:function(){return this._shaderInfo}},{key:"localSetLayout",get:function(){return Ig.getDescriptorSetLayout(this._device,this._programName,!0)}},{key:"program",get:function(){return this._programName}},{key:"properties",get:function(){return this._properties}},{key:"defines",get:function(){return this._defines}},{key:"passIndex",get:function(){return this._passIndex}},{key:"propertyIndex",get:function(){return this._propertyIndex}},{key:"dynamics",get:function(){return this._dynamics}},{key:"blocks",get:function(){return this._blocks}},{key:"blocksInt",get:function(){return this._blocksInt}},{key:"rootBufferDirty",get:function(){return this._rootBufferDirty}},{key:"priority",get:function(){return this._priority}},{key:"primitive",get:function(){return this._primitive}},{key:"stage",get:function(){return this._stage}},{key:"phase",get:function(){return this._phase}},{key:"rasterizerState",get:function(){return this._rs}},{key:"depthStencilState",get:function(){return this._dss}},{key:"blendState",get:function(){return this._bs}},{key:"dynamicStates",get:function(){return this._dynamicStates}},{key:"batchingScheme",get:function(){return this._batchingScheme}},{key:"descriptorSet",get:function(){return this._descriptorSet}},{key:"hash",get:function(){return this._hash}},{key:"pipelineLayout",get:function(){return this._pipelineLayout}}]),t}();Hg.getTypeFromHandle=fg,Hg.getBindingFromHandle=_g,Hg.getCountFromHandle=pg,Hg.getOffsetFromHandle=dg;var Vg,jg=new Ja(null),Wg=function(){function t(){this._device=null,this._passes=null,this._shaders=null,this._subMesh=null,this._patches=null,this._priority=Bp.DEFAULT,this._inputAssembler=null,this._descriptorSet=null,this._worldBoundDescriptorSet=null,this._planarInstanceShader=null,this._planarShader=null,this._reflectionTex=null,this._reflectionSampler=null}var e=t.prototype;return e._destroyDescriptorSet=function(){this._descriptorSet.destroy(),this._descriptorSet=null},e._destroyWorldBoundDescriptorSet=function(){this._worldBoundDescriptorSet.destroy(),this._worldBoundDescriptorSet=null},e._destroyInputAssembler=function(){this._inputAssembler.destroy(),this._inputAssembler=null},e._createDescriptorSet=function(t){this._descriptorSet=this._device.createDescriptorSet(t)},e._createWorldBoundDescriptorSet=function(t){this._worldBoundDescriptorSet=this._device.createDescriptorSet(t)},e._setInputAssembler=function(t){this._inputAssembler=this._device.createInputAssembler(t)},e._setSubMesh=function(t){this._subMesh=t},e._init=function(){},e.initialize=function(t,e,n){void 0===n&&(n=null);var r=i.director.root;this._device=r.device,jg.layout=e[0].localSetLayout,this._init(),this._setInputAssembler(t.iaInfo),this._createDescriptorSet(jg);var a=i.director.root.pipeline.pipelineSceneData.getOcclusionQueryPass(),o=new Ja(null);if(o.layout=a.localSetLayout,this._createWorldBoundDescriptorSet(o),this._setSubMesh(t),this._patches=n,this._passes=e,this._flushPassInfo(),e[0].batchingScheme===Og.VB_MERGING&&(this.subMesh.genFlatBuffers(),this._setSubMesh(this.subMesh)),this.priority=Bp.DEFAULT,e[0].phase===Bg("reflection")){var s=r.mainWindow.width,c=r.mainWindow.height,l=512;c<s?(s=l*s/c,c=l):c=l*c/(s=l),this._reflectionTex=this._device.createTexture(new wa(Pr.TEX2D,Ir.STORAGE|Ir.TRANSFER_SRC|Ir.SAMPLED,Sr.RGBA8,s,c)),this.descriptorSet.bindTexture(kd,this._reflectionTex),this._reflectionSampler=this._device.getSampler(new Ia(Mr.LINEAR,Mr.LINEAR,Mr.NONE,Nr.CLAMP,Nr.CLAMP,Nr.CLAMP)),this.descriptorSet.bindSampler(kd,this._reflectionSampler),this.descriptorSet.bindTexture(Vd,this._reflectionTex)}},e._initNativePlanarShadowShader=function(t){this._planarShader=t.getPlanarShader(this._patches)},e.initPlanarShadowShader=function(){var t=i.director.root.pipeline.pipelineSceneData.shadows;this._initNativePlanarShadowShader(t)},e._initNativePlanarShadowInstanceShader=function(t){this._planarInstanceShader=t.getPlanarInstanceShader(this._patches)},e.initPlanarShadowInstanceShader=function(){var t=i.director.root.pipeline.pipelineSceneData.shadows;this._initNativePlanarShadowInstanceShader(t)},e._destroy=function(){},e.destroy=function(){this._destroyDescriptorSet(),this._destroyWorldBoundDescriptorSet(),this._destroyInputAssembler(),this.priority=Bp.DEFAULT,this._patches=null,this._subMesh=null,this._passes=null,this._shaders=null,this._reflectionTex&&this._reflectionTex.destroy(),this._reflectionTex=null,this._reflectionSampler=null,this._destroy()},e.update=function(){for(var t=0;t<this._passes.length;++t)this._passes[t].update();this._descriptorSet.update(),this._worldBoundDescriptorSet.update()},e.onPipelineStateChanged=function(){var t=this._passes;if(t){for(var e=0;e<t.length;e++){var n=t[e];n.beginChangeStatesSilently(),n.tryCompile(),n.endChangeStatesSilently()}this._flushPassInfo()}},e.onMacroPatchesStateChanged=function(t){this._patches=t;var e=this._passes;if(e){for(var n=0;n<e.length;n++){var i=e[n];i.beginChangeStatesSilently(),i.tryCompile(),i.endChangeStatesSilently()}this._flushPassInfo()}},e._flushPassInfo=function(){var t=this._passes;if(t){this._shaders||(this._shaders=[]),this._shaders.length=t.length;for(var e=0,n=t.length;e<n;e++)this._shaders[e]=t[e].getShaderVariant(this.patches)}},L(t,[{key:"passes",get:function(){return this._passes},set:function(t){t.length>8?b(12004,8):(this._passes=t,this._flushPassInfo(),this._passes[0].batchingScheme===Og.VB_MERGING&&(this.subMesh.genFlatBuffers(),this._setSubMesh(this.subMesh)),this._descriptorSet&&(this._destroyDescriptorSet(),jg.layout=t[0].localSetLayout,this._createDescriptorSet(jg)))}},{key:"shaders",get:function(){return this._shaders}},{key:"subMesh",get:function(){return this._subMesh},set:function(t){this._inputAssembler.destroy(),this._inputAssembler.initialize(t.iaInfo),this._passes[0].batchingScheme===Og.VB_MERGING&&this.subMesh.genFlatBuffers(),this._setSubMesh(t)}},{key:"priority",get:function(){return this._priority},set:function(t){this._priority=t}},{key:"inputAssembler",get:function(){return this._inputAssembler}},{key:"descriptorSet",get:function(){return this._descriptorSet}},{key:"worldBoundDescriptorSet",get:function(){return this._worldBoundDescriptorSet}},{key:"patches",get:function(){return this._patches}},{key:"planarInstanceShader",get:function(){return this._planarInstanceShader}},{key:"planarShader",get:function(){return this._planarShader}},{key:"native",get:function(){return this._nativeObj}}]),t}(),Xg=new Ri,qg=[{name:"CC_RECEIVE_SHADOW",value:!0}];!function(t){t[t.DEFAULT=0]="DEFAULT",t[t.SKINNING=1]="SKINNING",t[t.BAKED_SKINNING=2]="BAKED_SKINNING",t[t.BATCH_2D=3]="BATCH_2D",t[t.PARTICLE_BATCH=4]="PARTICLE_BATCH",t[t.LINE=5]="LINE"}(Vg||(Vg={}));var Yg,Kg,Qg=new Ia(Mr.LINEAR,Mr.LINEAR,Mr.NONE,Nr.CLAMP,Nr.CLAMP,Nr.CLAMP),Zg=new Ia(Mr.LINEAR,Mr.LINEAR,Mr.LINEAR,Nr.CLAMP,Nr.CLAMP,Nr.CLAMP),Jg=function(){function t(){this.type=Vg.DEFAULT,this.scene=null,this.isDynamicBatching=!1,this.instancedAttributes={buffer:null,views:[],attributes:[]},this._worldBounds=null,this._modelBounds=null,this._subModels=[],this._node=null,this._transform=null,this._device=void 0,this._inited=!1,this._descriptorSetCount=1,this._updateStamp=-1,this._localDataUpdated=!0,this._localData=new Float32Array(hd.COUNT),this._localBuffer=null,this._instMatWorldIdx=-1,this._lightmap=null,this._lightmapUVParam=new zi,this._worldBoundBuffer=null,this._receiveShadow=!1,this._castShadow=!1,this._enabled=!0,this._visFlags=Np.Enum.NONE,this._device=i.director.root.device}var e=t.prototype;return e._setReceiveShadow=function(t){this._receiveShadow=t},e._init=function(){},e.initialize=function(){this._inited||(this._init(),this._setReceiveShadow(!0),this.castShadow=!1,this.enabled=!0,this.visFlags=Np.Enum.NONE,this._inited=!0)},e._destroySubmodel=function(t){t.destroy()},e._destroy=function(){},e.destroy=function(){for(var t=this._subModels,e=0;e<t.length;e++){var n=this._subModels[e];this._destroySubmodel(n)}this._localBuffer&&(this._localBuffer.destroy(),this._localBuffer=null),this._worldBoundBuffer&&(this._worldBoundBuffer.destroy(),this._worldBoundBuffer=null),this._worldBounds=null,this._modelBounds=null,this._subModels.length=0,this._inited=!1,this._localDataUpdated=!0,this._transform=null,this._node=null,this.isDynamicBatching=!1,this._destroy()},e.attachToScene=function(t){this.scene=t,this._localDataUpdated=!0},e.detachFromScene=function(){this.scene=null},e.updateTransform=function(){var t=this.transform;if(t.hasChangedFlags||t._dirtyFlags){t.updateWorldTransform(),this._localDataUpdated=!0;var e=this._worldBounds;this._modelBounds&&e&&this._modelBounds.transform(t._mat,t._pos,t._rot,t._scale,e)}},e.updateWorldBound=function(){var t=this.transform;if(null!==t){t.updateWorldTransform(),this._localDataUpdated=!0;var e=this._worldBounds;this._modelBounds&&e&&this._modelBounds.transform(t._mat,t._pos,t._rot,t._scale,e)}},e._applyLocalData=function(){},e._applyLocalBuffer=function(){},e._applyWorldBoundBuffer=function(){},e.updateUBOs=function(t){for(var e=this._subModels,n=0;n<e.length;n++)e[n].update();if(this._updateStamp=t,this._localDataUpdated){this._localDataUpdated=!1;var i=this.transform._mat,r=this._instMatWorldIdx;if(r>=0){var a=this.instancedAttributes.views;!function(t,e,n,i){e[0]=t.m00,e[1]=t.m01,e[2]=t.m02,e[3]=t.m12,n[0]=t.m04,n[1]=t.m05,n[2]=t.m06,n[3]=t.m13,i[0]=t.m08,i[1]=t.m09,i[2]=t.m10,i[3]=t.m14}(i,a[r],a[r+1],a[r+2])}else if(this._localBuffer){Ri.toArray(this._localData,i,hd.MAT_WORLD_OFFSET),Ri.inverseTranspose(Xg,i);var o=Math.abs(Ri.determinant(Xg)),s=1/Math.sqrt(o);Ri.multiplyScalar(Xg,Xg,s),Ri.toArray(this._localData,Xg,hd.MAT_WORLD_IT_OFFSET),this._localBuffer.update(this._localData),this._applyLocalData(),this._applyLocalBuffer()}}},e._updateNativeBounds=function(){},e.createBoundingShape=function(t,e){t&&e&&(this._modelBounds=Mc.fromPoints(Mc.create(),t,e),this._worldBounds=Mc.clone(this._modelBounds),this._updateNativeBounds())},e._createSubModel=function(){return new Wg},e.initSubModel=function(t,e,n){this.initialize(),null==this._subModels[t]?this._subModels[t]=this._createSubModel():this._subModels[t].destroy(),this._subModels[t].initialize(e,n.passes,this.getMacroPatches(t)),this._subModels[t].initPlanarShadowShader(),this._subModels[t].initPlanarShadowInstanceShader(),this._updateAttributesAndBinding(t)},e.setSubModelMesh=function(t,e){this._subModels[t]&&(this._subModels[t].subMesh=e)},e.setSubModelMaterial=function(t,e){this._subModels[t]&&(this._subModels[t].passes=e.passes,this._updateAttributesAndBinding(t))},e.onGlobalPipelineStateChanged=function(){for(var t=this._subModels,e=0;e<t.length;e++)t[e].onPipelineStateChanged()},e.onMacroPatchesStateChanged=function(){for(var t=this._subModels,e=0;e<t.length;e++)t[e].onMacroPatchesStateChanged(this.getMacroPatches(e))},e.updateLightingmap=function(t,e){zi.toArray(this._localData,e,hd.LIGHTINGMAP_UVPARAM),this._localDataUpdated=!0,this._lightmap=t,this._lightmapUVParam=e,null===t&&(t=Lg.get("empty-texture"));var n=t.getGFXTexture();if(n)for(var i=this._device.getSampler(t.mipmaps.length>1?Zg:Qg),r=this._subModels,a=0;a<r.length;a++){var o=r[a].descriptorSet;o.bindTexture(Nd,n),o.bindSampler(Nd,i),o.update()}},e.getMacroPatches=function(){return this.receiveShadow?qg:null},e._updateAttributesAndBinding=function(t){var e=this._subModels[t];if(e){this._initLocalDescriptors(t),this._updateLocalDescriptors(t,e.descriptorSet),this._initWorldBoundDescriptors(t),this._updateWorldBoundDescriptors(t,e.worldBoundDescriptorSet);var n=e.passes[0].getShaderVariant(e.patches);this._updateInstancedAttributes(n.attributes,e.passes[0])}},e._getInstancedAttributeIndex=function(t){for(var e=this.instancedAttributes.attributes,n=0;n<e.length;n++)if(e[n].name===t)return n;return-1},e._setInstMatWorldIdx=function(t){this._instMatWorldIdx=t},e._updateInstancedAttributes=function(t,e){if(e.device.hasFeature(xr.INSTANCED_ARRAYS)){for(var n=0,i=0;i<t.length;i++){var r=t[i];r.isInstanced&&(n+=lo[r.format].size)}var a=this.instancedAttributes;a.buffer=new Uint8Array(n),a.views.length=a.attributes.length=0;for(var o=0,s=0;s<t.length;s++){var c=t[s];if(c.isInstanced){var l=new Ua;l.format=c.format,l.name=c.name,l.isNormalized=c.isNormalized,l.location=c.location,a.attributes.push(l);var u=lo[c.format],h=new(yo(u))(a.buffer.buffer,o,u.count);a.views.push(h),o+=u.size}}e.batchingScheme===Og.INSTANCING&&e.getInstancedBuffer().destroy(),this._setInstMatWorldIdx(this._getInstancedAttributeIndex(_d)),this._localDataUpdated=!0}},e._initLocalDescriptors=function(){this._localBuffer||(this._localBuffer=this._device.createBuffer(new Ta(Er.UNIFORM|Er.TRANSFER_DST,wr.DEVICE,hd.SIZE,hd.SIZE)),this._applyLocalBuffer())},e._initWorldBoundDescriptors=function(){this._worldBoundBuffer||(this._worldBoundBuffer=this._device.createBuffer(new Ta(Er.UNIFORM|Er.TRANSFER_DST,wr.DEVICE,fd.SIZE,fd.SIZE)),this._applyWorldBoundBuffer())},e._updateLocalDescriptors=function(t,e){this._localBuffer&&e.bindBuffer(hd.BINDING,this._localBuffer)},e._updateWorldBoundDescriptors=function(t,e){this._worldBoundBuffer&&e.bindBuffer(fd.BINDING,this._worldBoundBuffer)},L(t,[{key:"subModels",get:function(){return this._subModels}},{key:"inited",get:function(){return this._inited}},{key:"worldBounds",get:function(){return this._worldBounds}},{key:"modelBounds",get:function(){return this._modelBounds}},{key:"localBuffer",get:function(){return this._localBuffer}},{key:"worldBoundBuffer",get:function(){return this._worldBoundBuffer}},{key:"updateStamp",get:function(){return this._updateStamp}},{key:"isInstancingEnabled",get:function(){return this._instMatWorldIdx>=0}},{key:"receiveShadow",get:function(){return this._receiveShadow},set:function(t){this._setReceiveShadow(t),this.onMacroPatchesStateChanged()}},{key:"castShadow",get:function(){return this._castShadow},set:function(t){this._castShadow=t}},{key:"node",get:function(){return this._node},set:function(t){this._node=t}},{key:"transform",get:function(){return this._transform},set:function(t){this._transform=t}},{key:"visFlags",get:function(){return this._visFlags},set:function(t){this._visFlags=t}},{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled=t}},{key:"native",get:function(){return this._nativeObj}}]),t}();!function(t){t[t.LOCAL=0]="LOCAL",t[t.WORLD=1]="WORLD"}(Yg||(Yg={})),function(t){t[t.NONE=0]="NONE",t[t.POSITION=1]="POSITION",t[t.ROTATION=2]="ROTATION",t[t.SCALE=4]="SCALE",t[t.RS=t.ROTATION|t.SCALE]="RS",t[t.TRS=t.POSITION|t.ROTATION|t.SCALE]="TRS",t[t.TRS_MASK=~t.TRS]="TRS_MASK"}(Kg||(Kg={})),i.internal.TransformBit=Kg;var $g,tv,ev,nv,iv,rv,av,ov,sv=function(){function t(t){this._root=void 0,this._name="",this._cameras=[],this._models=[],this._batches=[],this._directionalLights=[],this._sphereLights=[],this._spotLights=[],this._mainLight=null,this._modelId=0,this._root=t,this._createNativeObject()}t.registerCreateFunc=function(e){e._createSceneFun=function(e){return new t(e)}};var e=t.prototype;return e.initialize=function(t){return this._name=t.name,!0},e.activate=function(){},e.update=function(t){var e=this._mainLight;e&&e.update();for(var n=this._sphereLights,i=0;i<n.length;i++)n[i].update();for(var r=this._spotLights,a=0;a<r.length;a++)r[a].update();for(var o=this._models,s=0;s<o.length;s++){var c=o[s];c.enabled&&(c.updateTransform(t),c.updateUBOs(t))}},e._destroy=function(){},e.destroy=function(){this.removeCameras(),this.removeSphereLights(),this.removeSpotLights(),this.removeModels(),this._destroy()},e.addCamera=function(t){t.attachToScene(this),this._cameras.push(t)},e.removeCamera=function(t){for(var e=0;e<this._cameras.length;++e)if(this._cameras[e]===t)return this._cameras.splice(e,1),void t.detachFromScene()},e.removeCameras=function(){for(var t,e=W(this._cameras);!(t=e()).done;)t.value.detachFromScene();this._cameras.splice(0)},e.setMainLight=function(t){this._mainLight=t},e.unsetMainLight=function(t){if(this._mainLight===t){var e=this._directionalLights;if(e.length)return this.setMainLight(e[e.length-1]),void(this._mainLight.node&&(this._mainLight.node.hasChangedFlags|=Kg.ROTATION));this.setMainLight(null)}},e.addDirectionalLight=function(t){t.attachToScene(this),this._directionalLights.push(t)},e.removeDirectionalLight=function(t){for(var e=0;e<this._directionalLights.length;++e)if(this._directionalLights[e]===t)return t.detachFromScene(),void this._directionalLights.splice(e,1)},e.addSphereLight=function(t){t.attachToScene(this),this._sphereLights.push(t)},e.removeSphereLight=function(t){for(var e=0;e<this._sphereLights.length;++e)if(this._sphereLights[e]===t)return t.detachFromScene(),void this._sphereLights.splice(e,1)},e.addSpotLight=function(t){t.attachToScene(this),this._spotLights.push(t)},e.removeSpotLight=function(t){for(var e=0;e<this._spotLights.length;++e)if(this._spotLights[e]===t)return t.detachFromScene(),void this._spotLights.splice(e,1)},e.removeSphereLights=function(){for(var t=0;t<this._sphereLights.length;++t)this._sphereLights[t].detachFromScene();this._sphereLights.length=0},e.removeSpotLights=function(){for(var t=0;t<this._spotLights.length;++t)this._spotLights[t].detachFromScene();this._spotLights=[]},e.addModel=function(t){t.attachToScene(this),this._models.push(t)},e.removeModel=function(t){for(var e=0;e<this._models.length;++e)if(this._models[e]===t)return t.detachFromScene(),void this._models.splice(e,1)},e.removeModels=function(){for(var t,e=W(this._models);!(t=e()).done;){var n=t.value;n.detachFromScene(),n.destroy()}this._models.length=0},e.addBatch=function(t){this._batches.push(t)},e.removeBatch=function(t){for(var e=0;e<this._batches.length;++e)if(this._batches[e]===t)return void this._batches.splice(e,1)},e.removeBatches=function(){this._batches.length=0},e.onGlobalPipelineStateChanged=function(){for(var t,e=W(this._models);!(t=e()).done;)t.value.onGlobalPipelineStateChanged()},e.generateModelId=function(){return this._modelId++},e._createNativeObject=function(){},L(t,[{key:"root",get:function(){return this._root}},{key:"name",get:function(){return this._name}},{key:"cameras",get:function(){return this._cameras}},{key:"mainLight",get:function(){return this._mainLight}},{key:"sphereLights",get:function(){return this._sphereLights}},{key:"spotLights",get:function(){return this._spotLights}},{key:"models",get:function(){return this._models}},{key:"native",get:function(){return this._nativeObj}},{key:"batches",get:function(){return this._batches}}]),t}(),cv=t("EffectAsset",nl("cc.EffectAsset")((ov=av=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return X(e=t.call.apply(t,[this].concat(i))||this,"techniques",ev,V(e)),X(e,"shaders",nv,V(e)),X(e,"combinations",iv,V(e)),X(e,"hideInEditor",rv,V(e)),e}F(e,t),e.register=function(t){e._effects[t.name]=t},e.remove=function(t){if("string"!=typeof t)e._effects[t.name]&&e._effects[t.name].equals(t)&&delete e._effects[t.name];else{if(e._effects[t])return void delete e._effects[t];for(var n in e._effects)if(e._effects[n]._uuid===t)return void delete e._effects[n]}},e.get=function(t){if(e._effects[t])return e._effects[t];for(var n in e._effects)if(e._effects[n]._uuid===t)return e._effects[n];return null},e.getAll=function(){return e._effects};var n=e.prototype;return n.onLoaded=function(){Ig.register(this),e.register(this),i.game.once(i.Game.EVENT_ENGINE_INITED,this._precompile,this)},n._precompile=function(){for(var t=this,e=i.director.root,n=function(n){var i=t.shaders[n],r=t.combinations[n];if(!r)return"continue";Object.keys(r).reduce((function(t,e){return t.reduce((function(t,n){for(var i=r[e],a=0;a<i.length;++a){var o=B({},n);o[e]=i[a],t.push(o)}return t}),[])}),[{}]).forEach((function(t){return Ig.getGFXShader(e.device,i.name,t,e.pipeline)}))},r=0;r<this.shaders.length;r++)n(r)},n.destroy=function(){return e.remove(this),t.prototype.destroy.call(this)},n.initDefault=function(n){t.prototype.initDefault.call(this,n);var i=e.get("unlit");this.name="unlit",this.shaders=i.shaders,this.combinations=i.combinations,this.techniques=i.techniques},n.validate=function(){return this.techniques.length>0&&this.shaders.length>0},e}(Ou),av._effects={},ev=q((tv=ov).prototype,"techniques",[cl,yl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),nv=q(tv.prototype,"shaders",[cl,yl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),iv=q(tv.prototype,"combinations",[cl,yl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),rv=q(tv.prototype,"hideInEditor",[cl,ul],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),$g=tv))||$g);i.EffectAsset=cv;var lv=t("PipelineStateManager",function(){function t(){}return t.getOrCreatePipelineState=function(t,e,n,i,r){var a=e.hash^i.hash^r.attributesHash^n.typedID,o=this._PSOHashMap.get(a);if(!o){var s=e.pipelineLayout,c=new to(r.attributes),l=new Fo(n,s,i,c,e.rasterizerState,e.depthStencilState,e.blendState,e.primitive,e.dynamicStates);o=t.createPipelineState(l),this._PSOHashMap.set(a,o)}return o},t}());lv._PSOHashMap=new Map;var uv=new ga,hv=new ua;function fv(t,e){t.x=e.x*e.x,t.y=e.y*e.y,t.z=e.z*e.z}var _v,pv,dv,mv,gv,vv,yv,xv,Sv,Tv,Av=null;function Ev(t,e,n,i,r){if(i&&i.enabled&&r===Av){var a=i.subModels[0],o=a.inputAssembler,s=a.passes,c=a.shaders,l=a.descriptorSet;uv.width=hv.width=r.window.width,uv.height=hv.height=r.window.height;var u=lv.getOrCreatePipelineState(t,s[0],c[0],e,o);n.setViewport(uv),n.setScissor(hv),n.bindPipelineState(u),n.bindDescriptorSet(Xp.MATERIAL,s[0].descriptorSet),n.bindDescriptorSet(Xp.LOCAL,l),n.bindInputAssembler(o),n.draw(o)}}var Cv=new zi,bv=t("Material",(_v=nl("cc.Material"),pv=Bl(cv),_v((Tv=function(t){function e(){var e;return X(e=t.call(this)||this,"_effectAsset",gv,V(e)),X(e,"_techIdx",vv,V(e)),X(e,"_defines",yv,V(e)),X(e,"_states",xv,V(e)),X(e,"_props",Sv,V(e)),e._passes=[],e._hash=0,e}F(e,t),e.getHash=function(t){for(var e,n=0,i=W(t.passes);!(e=i()).done;)n^=e.value.hash;return n};var n=e.prototype;return n.initialize=function(t){this._passes.length?E(12005):(this._defines||(this._defines=[]),this._states||(this._states=[]),this._props||(this._props=[]),this._fillInfo(t),this._update())},n.reset=function(t){this.initialize(t)},n.destroy=function(){return this._doDestroy(),t.prototype.destroy.call(this)},n.recompileShaders=function(){console.warn("Shaders in material asset '"+this.name+"' cannot be modified at runtime, please instantiate the material first.")},n.overridePipelineStates=function(){console.warn("Pipeline states in material asset '"+this.name+"' cannot be modified at runtime, please instantiate the material first.")},n.onLoaded=function(){this._update()},n.resetUniforms=function(t){void 0===t&&(t=!0),this._props.length=this._passes.length;for(var e=0;e<this._props.length;e++)this._props[e]={};if(t)for(var n,i=W(this._passes);!(n=i()).done;){var r=n.value;r.resetUBOs(),r.resetTextures()}},n.setProperty=function(t,e,n){var i=!1;if(void 0===n)for(var r=this._passes,a=r.length,o=0;o<a;o++){var s=r[o];this._uploadProperty(s,t,e)&&(this._props[s.propertyIndex][t]=e,i=!0)}else{if(n>=this._passes.length)return void console.warn("illegal pass index: "+n+".");var c=this._passes[n];this._uploadProperty(c,t,e)&&(this._props[c.propertyIndex][t]=e,i=!0)}i||console.warn("illegal property name: "+t+".")},n.getProperty=function(t,e){if(void 0===e)for(var n=this._props,i=n.length,r=0;r<i;r++){var a=n[r];if(t in a)return a[t]}else{if(e>=this._props.length)return console.warn("illegal pass index: "+e+"."),null;var o=this._props[this._passes[e].propertyIndex];if(t in o)return o[t]}return null},n.copy=function(t,e){this._techIdx=t._techIdx,this._props.length=t._props.length;for(var n=0;n<t._props.length;n++)this._props[n]=B({},t._props[n]);this._defines.length=t._defines.length;for(var i=0;i<t._defines.length;i++)this._defines[i]=B({},t._defines[i]);this._states.length=t._states.length;for(var r=0;r<t._states.length;r++)this._states[r]=B({},t._states[r]);this._effectAsset=t._effectAsset,e&&this._fillInfo(e),this._update()},n._fillInfo=function(t){void 0!==t.technique&&(this._techIdx=t.technique),t.effectAsset?this._effectAsset=t.effectAsset:t.effectName&&(this._effectAsset=cv.get(t.effectName)),t.defines&&this._prepareInfo(t.defines,this._defines),t.states&&this._prepareInfo(t.states,this._states)},n._prepareInfo=function(t,e){var n=t;if(!Array.isArray(n)){var i=this._effectAsset?this._effectAsset.techniques[this._techIdx].passes.length:1;n=Array(i).fill(n)}for(var r=0;r<n.length;++r)Object.assign(e[r]||(e[r]={}),n[r])},n._createPasses=function(){var t=this._effectAsset.techniques[this._techIdx||0];if(!t)return[];for(var e=t.passes.length,n=[],r=0;r<e;++r){var a=t.passes[r],o=a.passIndex=r,s=a.defines=this._defines[o]||(this._defines[o]={});if(a.stateOverrides=this._states[o]||(this._states[o]={}),void 0!==a.propertyIndex&&Object.assign(s,this._defines[a.propertyIndex]),void 0!==a.embeddedMacros&&Object.assign(s,a.embeddedMacros),!a.switch||s[a.switch]){var c=new Hg(i.director.root);c.initialize(a),n.push(c)}}return n},n._update=function(t){var n=this;if(void 0===t&&(t=!0),this._effectAsset){this._passes=this._createPasses();var i=this._effectAsset.techniques[this._techIdx].passes.length;if(this._props.length=i,t)this._passes.forEach((function(t,e){var i=n._props[e];for(var r in i||(i=n._props[e]={}),void 0!==t.propertyIndex&&Object.assign(i,n._props[t.propertyIndex]),i)n._uploadProperty(t,r,i[r])}));else for(var r=0;r<this._props.length;r++)this._props[r]={}}this._hash=e.getHash(this)},n._uploadProperty=function(t,e,n){var i=t.getHandle(e);if(!i)return!1;if(Hg.getTypeFromHandle(i)<Ar.SAMPLER1D)if(Array.isArray(n))t.setUniformArray(i,n);else if(null!==n){var r;if(null===(r=t.properties[e])||void 0===r?void 0:r.linear){var a=n;fv(Cv,a),Cv.w=a.w,n=Cv}t.setUniform(i,n)}else t.resetUniform(e);else if(Array.isArray(n))for(var o=0;o<n.length;o++)this._bindTexture(t,i,n[o],o);else n?this._bindTexture(t,i,n):t.resetTexture(e);return!0},n._bindTexture=function(t,e,n,i){var r=Hg.getBindingFromHandle(e);if(n instanceof Vo)t.bindTexture(r,n,i);else if(n instanceof Mm){var a=n.getGFXTexture();if(!a||!a.width||!a.height)return;t.bindTexture(r,a,i),t.bindSampler(r,n.getGFXSampler(),i)}},n._doDestroy=function(){if(this._passes&&this._passes.length)for(var t,e=W(this._passes);!(t=e()).done;)t.value.destroy();this._passes.length=0},n.initDefault=function(e){t.prototype.initDefault.call(this,e),this.initialize({effectName:"unlit",defines:{USE_COLOR:!0}}),this.setProperty("mainColor",new _i("#ff00ff"))},n.validate=function(){return!!this._effectAsset&&!this._effectAsset.isDefault&&this.passes.length>0},L(e,[{key:"effectAsset",get:function(){return this._effectAsset}},{key:"effectName",get:function(){return this._effectAsset?this._effectAsset.name:""}},{key:"technique",get:function(){return this._techIdx}},{key:"passes",get:function(){return this._passes}},{key:"hash",get:function(){return this._hash}},{key:"parent",get:function(){return null}},{key:"owner",get:function(){return null}}]),e}(Ou),gv=q((mv=Tv).prototype,"_effectAsset",[pv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),vv=q(mv.prototype,"_techIdx",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),yv=q(mv.prototype,"_defines",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),xv=q(mv.prototype,"_states",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Sv=q(mv.prototype,"_props",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),dv=mv))||dv));i.Material=bv;var wv=Yt({Low_256x256:256,Medium_512x512:512,High_1024x1024:1024,Ultra_2048x2048:2048}),Pv=Yt({Planar:0,ShadowMap:1}),Iv=Yt({HARD:0,SOFT:1,SOFT_2X:2}),Rv=Pv.ShadowMap+1,Dv=function(){function t(){this.fixedSphere=new ia(0,0,0,.01),this.maxReceived=4,this.firstSetCSM=!1,this.shadowCameraFar=0,this.matShadowView=new Ri,this.matShadowProj=new Ri,this.matShadowViewProj=new Ri,this._normal=new di(0,1,0),this._shadowColor=new _i(0,0,0,76),this._matLight=new Ri,this._material=null,this._instancingMaterial=null,this._size=new Ni(512,512),this._enabled=!1,this._distance=0,this._type=Rv,this._near=.1,this._far=10,this._invisibleOcclusionRange=200,this._shadowDistance=100,this._orthoSize=1,this._pcf=0,this._shadowMapDirty=!1,this._bias=0,this._normalBias=0,this._fixedArea=!1,this._saturation=.75}var e=t.prototype;return e.getPlanarShader=function(t){return this._material||(this._material=new bv,this._material.initialize({effectName:"planar-shadow"})),this._material.passes[0].getShaderVariant(t)},e.getPlanarInstanceShader=function(t){return this._instancingMaterial||(this._instancingMaterial=new bv,this._instancingMaterial.initialize({effectName:"planar-shadow",defines:{USE_INSTANCING:!0}})),this._instancingMaterial.passes[0].getShaderVariant(t)},e._setEnable=function(t){this._enabled=t},e._setType=function(t){this._type=this.enabled?t:Rv},e.initialize=function(t){this.near=t.near,this.far=t.far,this.invisibleOcclusionRange=t.invisibleOcclusionRange,this.shadowDistance=t.shadowDistance,this.orthoSize=t.orthoSize,this.size=t.size,this.pcf=t.pcf,this.normal=t.normal,this.distance=t.distance,this.shadowColor=t.shadowColor,this.bias=t.bias,this.normalBias=t.normalBias,this.maxReceived=t.maxReceived,this.fixedArea=t.fixedArea,this._setEnable(t.enabled),this._setType(t.type),this.saturation=t.saturation},e.activate=function(){this.enabled&&this.type===Pv.Planar&&this._updatePlanarInfo()},e._updatePlanarInfo=function(){this._material||(this._material=new bv,this._material.initialize({effectName:"planar-shadow"})),this._instancingMaterial||(this._instancingMaterial=new bv,this._instancingMaterial.initialize({effectName:"planar-shadow",defines:{USE_INSTANCING:!0}}))},e._destroy=function(){},e.destroy=function(){this._destroy(),this._material&&this._material.destroy(),this._instancingMaterial&&this._instancingMaterial.destroy(),this.fixedSphere.destroy()},L(t,[{key:"enabled",get:function(){return this._enabled},set:function(t){this._setEnable(t),this.activate()}},{key:"normal",get:function(){return this._normal},set:function(t){di.copy(this._normal,t)}},{key:"distance",get:function(){return this._distance},set:function(t){this._distance=t}},{key:"shadowColor",get:function(){return this._shadowColor},set:function(t){this._shadowColor=t}},{key:"invisibleOcclusionRange",get:function(){return this._invisibleOcclusionRange},set:function(t){this._invisibleOcclusionRange=t}},{key:"shadowDistance",get:function(){return this._shadowDistance},set:function(t){this._shadowDistance=t}},{key:"type",get:function(){return this._type},set:function(t){this._setType(t),this.activate()}},{key:"near",get:function(){return this._near},set:function(t){this._near=t}},{key:"far",get:function(){return this._far},set:function(t){this._far=t}},{key:"orthoSize",get:function(){return this._orthoSize},set:function(t){this._orthoSize=t}},{key:"size",get:function(){return this._size},set:function(t){this._size.set(t)}},{key:"pcf",get:function(){return this._pcf},set:function(t){this._pcf=t}},{key:"shadowMapDirty",get:function(){return this._shadowMapDirty},set:function(t){this._shadowMapDirty=t}},{key:"bias",get:function(){return this._bias},set:function(t){this._bias=t}},{key:"normalBias",get:function(){return this._normalBias},set:function(t){this._normalBias=t}},{key:"saturation",get:function(){return this._saturation},set:function(t){this._saturation=t}},{key:"fixedArea",get:function(){return this._fixedArea},set:function(t){this._fixedArea=t}},{key:"matLight",get:function(){return this._matLight}},{key:"material",get:function(){return this._material}},{key:"instancingMaterial",get:function(){return this._instancingMaterial}},{key:"native",get:function(){return this._nativeObj}}]),t}();Dv.MAX_FAR=2e3,Dv.COEFFICIENT_OF_EXPANSION=2*Math.sqrt(3),i.Shadows=Dv,Ln(sv.prototype,"RenderScene.prototype",[{name:"raycastUI2DNode"},{name:"raycastUINode"}]),Ln(sv.prototype,"RenderScene.prototype",[{name:"raycastAll",suggest:"using intersect.rayModel in geometry"},{name:"raycastAllModels",suggest:"using intersect.rayModel in geometry"},{name:"raycastSingleModel",suggest:"using intersect.rayModel in geometry"},{name:"raycastAllCanvas",suggest:"using intersect.rayAABB in geometry"},{name:"rayResultCanvas"},{name:"rayResultModels"},{name:"rayResultAll"},{name:"rayResultSingleModel"}]);var Ov={};Ln(Ov,"CameraVisFlags",[{name:"GENERAL"}]),Nn(Ov,"CameraVisFlags",[{name:"PROFILER",newName:"PROFILER",target:Np.BitMask,targetName:"PROFILER"},{name:"GIZMOS",newName:"GIZMOS",target:Np.BitMask,targetName:"GIZMOS"},{name:"EDITOR",newName:"EDITOR",target:Np.BitMask,targetName:"EDITOR"},{name:"UI",newName:"UI",target:Np.BitMask,targetName:"UI_3D"},{name:"UI2D",newName:"UI2D",target:Np.BitMask,targetName:"UI_2D"}]),i.CameraVisFlags=Ov;var Mv,Nv={};function Lv(t,e){e<1e3?e=1e3:e>15e3&&(e=15e3);var n=e*e,i=(.860117757+.000154118254*e+1.28641212e-7*n)/(1+.000842420235*e+7.08145163e-7*n),r=(.317398726+422806245e-13*e+4.20481691e-8*n)/(1-289741816e-13*e+1.61456053e-7*n),a=2*i-8*r+4,o=3*i/a,s=2*r/a,c=1/s*o,l=1/s*(1-o-s);t.x=3.2404542*c-1.5371385+-.4985314*l,t.y=-.969266*c+1.8760108+.041556*l,t.z=.0556434*c-.2040259+1.0572252*l}Ln(Nv,"VisibilityFlags",[{name:"GENERAL"}]),Nn(Nv,"VisibilityFlags",[{name:"ALWALS",newName:"ALWALS",target:Np.Enum,targetName:"ALWALS"},{name:"PROFILER",newName:"PROFILER",target:Np.Enum,targetName:"PROFILER"},{name:"GIZMOS",newName:"GIZMOS",target:Np.Enum,targetName:"GIZMOS"},{name:"EDITOR",newName:"EDITOR",target:Np.Enum,targetName:"EDITOR"},{name:"UI",newName:"UI",target:Np.Enum,targetName:"UI_3D"},{name:"UI2D",newName:"UI2D",target:Np.Enum,targetName:"UI_2D"}]),i.VisibilityFlags=Nv,Nn(Hg.prototype,"Pass.prototype",[{name:"getBindingTypeFromHandle",newName:"getDescriptorTypeFromHandle"}]),Ln(mm.prototype,"Camera.prototype",[{name:"getSplitFrustum"},{name:"setMatView"},{name:"setMatViewInv"},{name:"setMatProjInv"},{name:"setMatViewProjInv"},{name:"setMatProj"},{name:"setMatViewProj"},{name:"getMatViewInv"}]),Ln(Dv.prototype,"Shadows.prototype",[{name:"aspect"},{name:"selfShadow"},{name:"linear"},{name:"packing"},{name:"autoAdapt"}]),function(t){t[t.DIRECTIONAL=0]="DIRECTIONAL",t[t.SPHERE=1]="SPHERE",t[t.SPOT=2]="SPOT",t[t.UNKNOWN=3]="UNKNOWN"}(Mv||(Mv={}));var Bv=function(t){return 4*Math.PI*Math.PI*t*t},Fv=function(){function t(){this._baked=!1,this._color=new di(1,1,1),this._colorTemp=6550,this._colorTempRGB=new di(1,1,1),this._scene=null,this._node=null,this._name=null,this._useColorTemperature=!1,this._type=Mv.UNKNOWN}var e=t.prototype;return e._init=function(){},e._destroy=function(){},e.initialize=function(){this._init(),this.color=new di(1,1,1),this.colorTemperature=6550},e.attachToScene=function(t){this._scene=t},e.detachFromScene=function(){this._scene=null},e.destroy=function(){this._name=null,this._node=null,this._destroy()},e.update=function(){},L(t,[{key:"baked",get:function(){return this._baked},set:function(t){this._baked=t}},{key:"color",get:function(){return this._color},set:function(t){this._color.set(t)}},{key:"useColorTemperature",get:function(){return this._useColorTemperature},set:function(t){this._useColorTemperature=t}},{key:"colorTemperature",get:function(){return this._colorTemp},set:function(t){this._colorTemp=t,Lv(this._colorTempRGB,this._colorTemp)}},{key:"colorTemperatureRGB",get:function(){return this._colorTempRGB}},{key:"node",get:function(){return this._node},set:function(t){this._node=t,this._node&&(this._node.hasChangedFlags|=Kg.ROTATION)}},{key:"type",get:function(){return this._type}},{key:"name",get:function(){return this._name},set:function(t){this._name=t}},{key:"scene",get:function(){return this._scene}},{key:"native",get:function(){return this._nativeObj}}]),t}(),zv=new di(0,0,-1),Uv=new di,kv=function(t){function e(){var e;return(e=t.call(this)||this)._dir=new di(1,-1,-1),e._illuminanceHDR=Yi.SUN_ILLUM,e._illuminanceLDR=1,e._type=Mv.DIRECTIONAL,e}F(e,t);var n=e.prototype;return n.initialize=function(){t.prototype.initialize.call(this),this.illuminance=Yi.SUN_ILLUM,this.direction=new di(1,-1,-1)},n.update=function(){this._node&&this._node.hasChangedFlags&&(this.direction=di.transformQuat(Uv,zv,this._node.worldRotation))},L(e,[{key:"direction",get:function(){return this._dir},set:function(t){di.normalize(this._dir,t)}},{key:"illuminance",get:function(){return i.director.root.pipeline.pipelineSceneData.isHDR?this._illuminanceHDR:this._illuminanceLDR},set:function(t){i.director.root.pipeline.pipelineSceneData.isHDR?this.illuminanceHDR=t:this.illuminanceLDR=t}},{key:"illuminanceHDR",get:function(){return this._illuminanceHDR},set:function(t){this._illuminanceHDR=t}},{key:"illuminanceLDR",get:function(){return this._illuminanceLDR},set:function(t){this._illuminanceLDR=t}}]),e}(Fv),Gv=function(t){function e(e,n){var i;(i=t.call(this,e.root)||this)._parent=void 0,i._owner=void 0,i._dontNotify=!1,i._parent=e,i._owner=n,i._doInit(i._parent,!0);for(var r=0;r<i._shaderInfo.blocks.length;r++){var a=i._shaderInfo.blocks[r],o=i._blocks[a.binding],s=i._parent.blocks[a.binding];o.set(s)}i._setRootBufferDirty(!0);for(var c=i._parent,l=0;l<i._shaderInfo.samplerTextures.length;l++)for(var u=i._shaderInfo.samplerTextures[l],h=0;h<u.count;h++){var f=c._descriptorSet.getSampler(u.binding,h),_=c._descriptorSet.getTexture(u.binding,h);i._descriptorSet.bindSampler(u.binding,f,h),i._descriptorSet.bindTexture(u.binding,_,h)}return t.prototype.tryCompile.call(V(i)),i}F(e,t);var n=e.prototype;return n.overridePipelineStates=function(t,e){this._bs.reset(),this._rs.reset(),this._dss.reset(),Hg.fillPipelineInfo(this,t),Hg.fillPipelineInfo(this,e),this._onStateChange()},n.tryCompile=function(e){if(e&&!Sg(this._defines,e))return!1;var n=t.prototype.tryCompile.call(this);return this._onStateChange(),n},n.beginChangeStatesSilently=function(){this._dontNotify=!0},n.endChangeStatesSilently=function(){this._dontNotify=!1},n._syncBatchingScheme=function(){this._defines.USE_BATCHING=this._defines.USE_INSTANCING=!1,this._setBatchingScheme(Og.NONE)},n._onStateChange=function(){this._setHash(Hg.getPassHash(this)),this._owner.onPassStateChange(this._dontNotify)},L(e,[{key:"parent",get:function(){return this._parent}}]),e}(Hg),Hv=function(t){function e(e){var n;return(n=t.call(this)||this)._passes=[],n._parent=void 0,n._owner=void 0,n._subModelIdx=0,n._parent=e.parent,n._owner=e.owner||null,n._subModelIdx=e.subModelIdx||0,n.copy(n._parent),n}F(e,t);var n=e.prototype;return n.recompileShaders=function(t,e){if(this._passes&&this.effectAsset)if(void 0===e)for(var n,i=W(this._passes);!(n=i()).done;)n.value.tryCompile(t);else this._passes[e].tryCompile(t)},n.overridePipelineStates=function(t,e){if(this._passes&&this.effectAsset){var n=this.effectAsset.techniques[this.technique].passes;if(void 0===e)for(var i=0;i<this._passes.length;i++){var r=this._passes[i],a=this._states[i]||(this._states[i]={});for(var o in t)a[o]=t[o];r.overridePipelineStates(n[r.passIndex],a)}else{var s=this._states[e]||(this._states[e]={});for(var c in t)s[c]=t[c];this._passes[e].overridePipelineStates(n[e],s)}}},n.destroy=function(){return this._doDestroy(),!0},n.onPassStateChange=function(t){this._hash=bv.getHash(this),!t&&this._owner&&this._owner._onRebuildPSO(this._subModelIdx,this)},n._createPasses=function(){var t=[],e=this._parent.passes;if(!e)return t;for(var n=0;n<e.length;++n)t.push(new Gv(e[n],this));return t},L(e,[{key:"parent",get:function(){return this._parent}},{key:"owner",get:function(){return this._owner}}]),e}(bv),Vv=null,jv=null,Wv=function(){function t(){this._envmapLDR=null,this._envmapHDR=null,this._diffuseMapLDR=null,this._diffuseMapHDR=null,this._globalDSManager=null,this._model=null,this._default=null,this._enabled=!1,this._useIBL=!1,this._useHDR=!0,this._useDiffuseMap=!1}var e=t.prototype;return e._setEnabled=function(t){this._enabled=t},e._setUseIBL=function(t){this._useIBL=t},e._setUseHDR=function(t){this._useHDR=t},e._setUseDiffuseMap=function(t){this._useDiffuseMap=t},e.initialize=function(t){this._setEnabled(t.enabled),this._setUseIBL(t.useIBL),this._setUseDiffuseMap(t.applyDiffuseMap),this._setUseHDR(t.useHDR)},e.setEnvMaps=function(t,e){this._envmapHDR=t,this._envmapLDR=e;var n=i.director.root;n.pipeline.pipelineSceneData.isHDR?t&&(n.pipeline.pipelineSceneData.ambient.mipmapCount=t.mipmapLevel):e&&(n.pipeline.pipelineSceneData.ambient.mipmapCount=e.mipmapLevel),this._updateGlobalBinding(),this._updatePipeline()},e.setDiffuseMaps=function(t,e){this._diffuseMapHDR=t,this._diffuseMapLDR=e,this._updateGlobalBinding(),this._updatePipeline()},e.activate=function(){var t=i.director.root.pipeline;this._globalDSManager=t.globalDSManager,this._default=Lg.get("default-cube-texture"),this._model||(this._model=i.director.root.createModel(i.renderer.scene.Model),this._model._initLocalDescriptors=function(){},this._model._initWorldBoundDescriptors=function(){});var e=this._default.isRGBE;if(this.envmap&&(e=this.envmap.isRGBE),!jv){var n=new bv;n.initialize({effectName:"skybox",defines:{USE_RGBE_CUBEMAP:e}}),jv=new Hv({parent:n})}this.enabled&&(Vv||(Vv=i.utils.createMesh(i.primitives.box({width:2,height:2,length:2}))),this._model.initSubModel(0,Vv.renderingSubMeshes[0],jv)),this.envmap||(this.envmap=this._default),this.diffuseMap||(this.diffuseMap=this._default),this._updateGlobalBinding(),this._updatePipeline()},e._updatePipeline=function(){var t=i.director.root,e=t.pipeline,n=this.useIBL?this.isRGBE?2:1:0,r=this.useIBL&&this.useDiffuseMap&&this.diffuseMap?this.isRGBE?2:1:0,a=this.useHDR;e.macros.CC_USE_IBL===n&&e.macros.CC_USE_DIFFUSEMAP===r&&e.macros.CC_USE_HDR===a||(e.macros.CC_USE_IBL=n,e.macros.CC_USE_DIFFUSEMAP=r,e.macros.CC_USE_HDR=a,t.onGlobalPipelineStateChanged()),this.enabled&&jv&&jv.recompileShaders({USE_RGBE_CUBEMAP:this.isRGBE}),this._model&&this._model.setSubModelMaterial(0,jv)},e._updateGlobalBinding=function(){if(this._globalDSManager){var t=i.director.root.device,e=this.envmap?this.envmap:this._default;if(e){var n=e.getGFXTexture(),r=t.getSampler(e.getSamplerInfo());this._globalDSManager.bindSampler(nd,r),this._globalDSManager.bindTexture(nd,n)}var a=this.diffuseMap?this.diffuseMap:this._default;if(a){var o=a.getGFXTexture(),s=t.getSampler(a.getSamplerInfo());this._globalDSManager.bindSampler(ad,s),this._globalDSManager.bindTexture(ad,o)}this._globalDSManager.update()}},e._destroy=function(){},e.destroy=function(){this._destroy()},L(t,[{key:"model",get:function(){return this._model}},{key:"enabled",get:function(){return this._enabled},set:function(t){this._setEnabled(t),t?this.activate():this._updatePipeline()}},{key:"useHDR",get:function(){return this._useHDR},set:function(t){this._setUseHDR(t),this.setEnvMaps(this._envmapHDR,this._envmapLDR)}},{key:"useIBL",get:function(){return this._useIBL},set:function(t){this._setUseIBL(t),this._updatePipeline()}},{key:"useDiffuseMap",get:function(){return this._useDiffuseMap},set:function(t){this._useDiffuseMap=t,this.setDiffuseMaps(null,null)}},{key:"isRGBE",get:function(){return!!this.envmap&&this.envmap.isRGBE}},{key:"envmap",get:function(){return i.director.root.pipeline.pipelineSceneData.isHDR?this._envmapHDR:this._envmapLDR},set:function(t){i.director.root.pipeline.pipelineSceneData.isHDR?this.setEnvMaps(t,this._envmapLDR):this.setEnvMaps(this._envmapHDR,t)}},{key:"diffuseMap",get:function(){return i.director.root.pipeline.pipelineSceneData.isHDR?this._diffuseMapHDR:this._diffuseMapLDR},set:function(t){i.director.root.pipeline.pipelineSceneData.isHDR?this.setDiffuseMaps(t,this._diffuseMapLDR):this.setDiffuseMaps(this._diffuseMapHDR,t)}},{key:"native",get:function(){return this._nativeObj}}]),t}();i.Skybox=Wv;var Xv,qv,Yv=function(t){F(n,t);var e=n.prototype;function n(){var e;return(e=t.call(this)||this)._needUpdate=!1,e._size=.15,e._range=1,e._luminanceHDR=0,e._luminanceLDR=0,e._pos=void 0,e._aabb=void 0,e._aabb=Mc.create(),e._pos=new di,e._type=Mv.SPHERE,e}return e._init=function(){t.prototype._init.call(this)},e._destroy=function(){t.prototype._destroy.call(this)},e.initialize=function(){t.prototype.initialize.call(this),this.size=.15,this.range=1,this.luminance=1700/Bv(.15),this.luminanceLDR=1},e.update=function(){if(this._node&&(this._node.hasChangedFlags||this._needUpdate)){this._node.getWorldPosition(this._pos);var t=this._range;Mc.set(this._aabb,this._pos.x,this._pos.y,this._pos.z,t,t,t),this._needUpdate=!1}},L(n,[{key:"position",get:function(){return this._pos}},{key:"size",get:function(){return this._size},set:function(t){this._size=t}},{key:"range",get:function(){return this._range},set:function(t){this._range=t,this._needUpdate=!0}},{key:"luminance",get:function(){return i.director.root.pipeline.pipelineSceneData.isHDR?this._luminanceHDR:this._luminanceLDR},set:function(t){i.director.root.pipeline.pipelineSceneData.isHDR?this.luminanceHDR=t:this.luminanceLDR=t}},{key:"luminanceHDR",get:function(){return this._luminanceHDR},set:function(t){this._luminanceHDR=t}},{key:"luminanceLDR",set:function(t){this._luminanceLDR=t}},{key:"aabb",get:function(){return this._aabb}}]),n}(Fv),Kv=new di(0,0,-1),Qv=new Ti,Zv=new Ri,Jv=new Ri,$v=new Ri,ty=new Ri,ey=function(t){F(n,t);var e=n.prototype;function n(){var e;return(e=t.call(this)||this)._dir=new di(1,-1,-1),e._range=5,e._spotAngle=Math.cos(Math.PI/6),e._pos=void 0,e._aabb=void 0,e._frustum=void 0,e._angle=0,e._needUpdate=!1,e._size=.15,e._luminanceHDR=0,e._luminanceLDR=0,e._aspect=0,e._aabb=Mc.create(),e._frustum=Wc.create(),e._pos=new di,e._type=Mv.SPOT,e}return e._init=function(){t.prototype._init.call(this)},e._destroy=function(){t.prototype._destroy.call(this)},e._setDirection=function(t){this._dir.set(t)},e.initialize=function(){t.prototype.initialize.call(this),this.size=.15,this.aspect=1,this.luminance=1700/Bv(.15),this.luminanceLDR=1,this.range=Math.cos(Math.PI/6),this._setDirection(new di(1,-1,-1))},e.update=function(){this._node&&(this._node.hasChangedFlags||this._needUpdate)&&(this._node.getWorldPosition(this._pos),di.transformQuat(this._dir,Kv,this._node.getWorldRotation(Qv)),di.normalize(this._dir,this._dir),Mc.set(this._aabb,this._pos.x,this._pos.y,this._pos.z,this._range,this._range,this._range),this._node.getWorldRT(Zv),Ri.invert(Zv,Zv),Ri.perspective(Jv,this._angle,1,.001,this._range),Ri.multiply($v,Jv,Zv),this._frustum.update($v,ty),this._needUpdate=!1)},L(n,[{key:"position",get:function(){return this._pos}},{key:"size",get:function(){return this._size},set:function(t){this._size=t}},{key:"range",get:function(){return this._range},set:function(t){this._range=t,this._needUpdate=!0}},{key:"luminance",get:function(){return i.director.root.pipeline.pipelineSceneData.isHDR?this._luminanceHDR:this._luminanceLDR},set:function(t){i.director.root.pipeline.pipelineSceneData.isHDR?this.luminanceHDR=t:this.luminanceLDR=t}},{key:"luminanceHDR",get:function(){return this._luminanceHDR},set:function(t){this._luminanceHDR=t}},{key:"luminanceLDR",get:function(){return this._luminanceLDR},set:function(t){this._luminanceLDR=t}},{key:"direction",get:function(){return this._dir}},{key:"spotAngle",get:function(){return this._spotAngle},set:function(t){this._angle=t,this._spotAngle=Math.cos(.5*t),this._needUpdate=!0}},{key:"angle",get:function(){return this._angle}},{key:"aspect",get:function(){return this._aspect},set:function(t){this._aspect=t,this._needUpdate=!0}},{key:"aabb",get:function(){return this._aabb}},{key:"frustum",get:function(){return this._frustum}}]),n}(Fv),ny=Object.freeze({__proto__:null,Ambient:Yi,Octree:Ki,get CameraFOVAxis(){return Xd},get CameraProjection(){return qd},get CameraAperture(){return Yd},get CameraISO(){return Kd},get CameraShutter(){return Qd},SKYBOX_FLAG:pm,Camera:mm,CameraVisFlags:Ov,VisibilityFlags:Nv,DirectionalLight:kv,ColorTemperatureToRGB:Lv,get LightType(){return Mv},nt2lm:Bv,Light:Fv,get ModelType(){return Vg},Model:Jg,ShadowSize:wv,ShadowType:Pv,PCFType:Iv,Shadows:Dv,RenderScene:sv,Skybox:Wv,SphereLight:Yv,SpotLight:ey,SubModel:Wg,NativeNode:null,NativeScene:null,NativeAABB:null,NativeModel:null,NativeSkinningModel:null,NativeBakedAnimInfo:null,NativeBakedJointInfo:null,NativeBakedSkinningModel:null,NativeLight:null,NativeDirectionalLight:null,NativeSphereLight:null,NativeSpotLight:null,NaitveSkybox:null,NativeFog:null,NativeRenderWindow:null,NativeCamera:null,NativePass:null,NativeSubModel:null,NativeDrawBatch2D:null,NativeRenderScene:null,NativeOctree:null,NativeAmbient:null,NativeShadow:null,NativeRoot:null,NativeJointTransform:null,NativeJointInfo:null,NativePipelineSharedSceneData:null});function iy(t){return--t,t|=t>>16,t|=t>>8,t|=t>>4,t|=t>>2,t|=t>>1,++t}function ry(t,e){return Math.ceil(t/e)*e}!function(t){t[t.OPAQUE=0]="OPAQUE",t[t.TRANSPARENT=1]="TRANSPARENT",t[t.OVERLAY=2]="OVERLAY"}(Xv||(Xv={})),function(t){t[t.DEFAULT=1]="DEFAULT",t[t.FORWARD=2]="FORWARD",t[t.SHADOWCAST=4]="SHADOWCAST"}(qv||(qv={}));var ay=function(){function t(t){this._device=void 0,this._format=Sr.UNKNOWN,this._formatSize=0,this._chunks=[],this._chunkCount=0,this._handles=[],this._region0=new ma,this._region1=new ma,this._region2=new ma,this._roundUpFn=null,this._bufferViewCtor=Uint8Array,this._channels=4,this._alignment=1,this._device=t}var e=t.prototype;return e.initialize=function(t){var e=lo[t.format];this._format=t.format,this._formatSize=e.size,this._channels=e.count,this._bufferViewCtor=yo(e),this._roundUpFn=t.roundUpFn||null,this._alignment=t.alignment||1,t.inOrderFree&&(this.alloc=this._McDonaldAlloc)},e.destroy=function(){for(var t=0;t<this._chunkCount;++t)this._chunks[t].texture.destroy();this._chunks.length=0,this._handles.length=0},e.alloc=function(t,e){t=ry(t,this._alignment);var n=-1,i=-1;if(void 0!==e&&(n=e,i=this._findAvailableSpace(t,n)),i<0)for(var r=0;r<this._chunkCount&&(n=r,!((i=this._findAvailableSpace(t,n))>=0));++r);if(i>=0){var a=this._chunks[n];a.start+=t;var o={chunkIdx:n,start:i,end:i+t,texture:a.texture};return this._handles.push(o),o}var s=Math.sqrt(t/this._formatSize),c=this._roundUpFn&&this._roundUpFn(s,this._formatSize)||Math.max(1024,iy(s)),l=this._chunks[this.createChunk(c)];l.start+=t;var u={chunkIdx:this._chunkCount-1,start:0,end:t,texture:l.texture};return this._handles.push(u),u},e.free=function(t){for(var e=0;e<this._handles.length;++e)if(this._handles[e]===t)return this._chunks[t.chunkIdx].end=t.end,void this._handles.splice(e,1)},e.createChunk=function(t){var e=t*t*this._formatSize;g("TextureBufferPool: Allocate chunk "+this._chunkCount+", size: "+e+", format: "+this._format);var n={texture:this._device.createTexture(new wa(Pr.TEX2D,Ir.SAMPLED|Ir.TRANSFER_DST,this._format,t,t)),size:e,start:0,end:e};return this._chunks[this._chunkCount]=n,this._chunkCount++},e.update=function(t,e){var n=[],i=[],r=t.start/this._formatSize,a=e.byteLength/this._formatSize,o=r%t.texture.width,s=Math.floor(r/t.texture.width),c=Math.min(t.texture.width-o,a),l=0;o>0&&(this._region0.texOffset.x=o,this._region0.texOffset.y=s,this._region0.texExtent.width=c,this._region0.texExtent.height=1,n.push(new this._bufferViewCtor(e,l*this._formatSize,c*this._channels)),i.push(this._region0),o=0,s+=1,a-=c,l+=c),a>0&&(this._region1.texOffset.x=o,this._region1.texOffset.y=s,a>t.texture.width?(this._region1.texExtent.width=t.texture.width,this._region1.texExtent.height=Math.floor(a/t.texture.width),c=this._region1.texExtent.width*this._region1.texExtent.height):(c=a,this._region1.texExtent.width=c,this._region1.texExtent.height=1),n.push(new this._bufferViewCtor(e,l*this._formatSize,c*this._channels)),i.push(this._region1),o=0,s+=this._region1.texExtent.height,a-=c,l+=c),a>0&&(this._region2.texOffset.x=o,this._region2.texOffset.y=s,this._region2.texExtent.width=a,this._region2.texExtent.height=1,n.push(new this._bufferViewCtor(e,l*this._formatSize,a*this._channels)),i.push(this._region2)),this._device.copyBuffersToTexture(n,t.texture,i)},e._findAvailableSpace=function(t,e){var n=this._chunks[e],i=!1,r=n.start;if(r+t<=n.size)i=!0;else{r=0;for(var a=this._handles.filter((function(t){return t.chunkIdx===e})).sort((function(t,e){return t.start-e.start})),o=0;o<a.length;o++){var s=a[o];if(r+t<=s.start){i=!0;break}r=s.end}!i&&r+t<=n.size&&(i=!0)}return i?r:-1},e._McDonaldAlloc=function(t){t=ry(t,this._alignment);for(var e=0;e<this._chunkCount;++e){var n=this._chunks[e],i=!1,r=n.start;if(r+t<=n.end?i=!0:r>n.end?r+t<=n.size?i=!0:t<=n.end&&(n.start=r=0,i=!0):r===n.end&&(n.start=r=0,n.end=n.size,t<=n.end&&(i=!0)),i){n.start+=t;var a={chunkIdx:e,start:r,end:r+t,texture:n.texture};return this._handles.push(a),a}}var o=Math.sqrt(t/this._formatSize),s=this._roundUpFn&&this._roundUpFn(o,this._formatSize)||Math.max(1024,iy(o)),c=this._chunks[this.createChunk(s)];c.start+=t;var l={chunkIdx:this._chunkCount,start:0,end:t,texture:c.texture};return this._handles.push(l),l},t}(),oy=function(t){if(void 0===Pn[t]){var e=1<<wn;Pn[t]=e,wn+=1}},sy=Object.freeze({__proto__:null,addStage:oy,scene:ny,createIA:function(t,e){if(!e.positions)return console.error("The data must have positions field"),null;for(var n=[],i=e.positions.length/3,r=0;r<i;++r)n.push(e.positions[3*r],e.positions[3*r+1],e.positions[3*r+2]),e.normals&&n.push(e.normals[3*r],e.normals[3*r+1],e.normals[3*r+2]),e.uvs&&n.push(e.uvs[2*r],e.uvs[2*r+1]),e.colors&&n.push(e.colors[3*r],e.colors[3*r+1],e.colors[3*r+2]);var a=[];a.push(new Ua(oa.ATTR_POSITION,Sr.RGB32F)),e.normals&&a.push(new Ua(oa.ATTR_NORMAL,Sr.RGB32F)),e.uvs&&a.push(new Ua(oa.ATTR_TEX_COORD,Sr.RG32F)),e.colors&&a.push(new Ua(oa.ATTR_COLOR,Sr.RGB32F));var o=t.createBuffer(new Ta(Er.VERTEX|Er.TRANSFER_DST,wr.DEVICE,4*n.length,4*n.length/i));o.update(new Float32Array(n));var s=null;return e.indices&&(s=t.createBuffer(new Ta(Er.INDEX|Er.TRANSFER_DST,wr.DEVICE,2*e.indices.length,2))).update(new Uint16Array(e.indices)),t.createInputAssembler(new Ga(a,[o],s))},get RenderQueue(){return Xv},get PassStage(){return qv},genHandle:hg,getTypeFromHandle:fg,getBindingFromHandle:_g,getCountFromHandle:pg,getOffsetFromHandle:dg,customizeType:mg,type2reader:gg,type2writer:vg,getDefaultFromType:xg,overrideMacros:Sg,get BatchingSchemes(){return Og},Pass:Hg,getDeviceShaderVersion:Pg,programLib:Ig,nearestPOT:iy,TextureBufferPool:ay,MaterialInstance:Hv,PassInstance:Gv,get PoolType(){return _c},NULL_HANDLE:0,get NodeView(){return pc},NodePool:yc,get PassView(){return mc},PassPool:Ac,get AABBView(){return xc},AABBPool:bc});t("renderer",sy);var cy=new di,ly=(new di,new di,new di),uy=new Ri,hy=new Mc,fy=new Mc,_y=!1,py=ia.create(0,0,0,1),dy=new ia,my=new Wc;my.accurate=!0;var gy=new Wc;gy.accurate=!0;var vy=new Wc,yy=new Ri,xy=new Ri,Sy=new Ri,Ty=new Ri,Ay=new Ri,Ey=new Ri,Cy=new Ri,by=new di,wy=new Ni,Py=new di,Iy=new di,Ry=new di(0,0,0),Dy=(new Mc,new jt((function(){return{model:null,depth:0}}),128)),Oy=new jt((function(){return{model:null,depth:0}}),128),My=new jt((function(){return{model:null,depth:0}}),128);function Ny(t,e){var n=0;t.node&&(di.subtract(cy,t.node.worldPosition,e.position),n=di.dot(cy,e.forward));var i=Dy.alloc();return i.model=t,i.depth=n,i}function Ly(t,e){var n=0;t.node&&(di.subtract(cy,t.node.worldPosition,e.position),n=di.dot(cy,e.forward));var i=Oy.alloc();return i.model=t,i.depth=n,i}function By(t,e){var n=0;t.node&&(di.subtract(cy,t.node.worldPosition,e.position),n=di.dot(cy,e.forward));var i=My.alloc();return i.model=t,i.depth=n,i}function Fy(t,e,n){var i=e.direction,r=t.normal,a=t.distance+.001,o=1/di.dot(r,i),s=i.x*o,c=i.y*o,l=i.z*o,u=r.x,h=r.y,f=r.z,_=t.matLight;_.m00=1-u*s,_.m01=-u*c,_.m02=-u*l,_.m03=0,_.m04=-h*s,_.m05=1-h*c,_.m06=-h*l,_.m07=0,_.m08=-f*s,_.m09=-f*c,_.m10=1-f*l,_.m11=0,_.m12=s*a,_.m13=c*a,_.m14=l*a,_.m15=1,Ri.toArray(n,_,Jp.MAT_LIGHT_PLANE_PROJ_OFFSET)}function zy(t,e){di.normalize(cy,t.normal),e[Jp.PLANAR_NORMAL_DISTANCE_INFO_OFFSET+0]=cy.x,e[Jp.PLANAR_NORMAL_DISTANCE_INFO_OFFSET+1]=cy.y,e[Jp.PLANAR_NORMAL_DISTANCE_INFO_OFFSET+2]=cy.z,e[Jp.PLANAR_NORMAL_DISTANCE_INFO_OFFSET+3]=t.distance}function Uy(t,e){var n=t.pipelineSceneData.validPunctualLights;n.length=0;for(var i=e.scene.spotLights,r=0;r<i.length;r++){var a=i[r];a.baked||(ia.set(py,a.position.x,a.position.y,a.position.z,a.range),$s.sphereFrustum(py,e.frustum)&&n.push(a))}for(var o=e.scene.sphereLights,s=0;s<o.length;s++){var c=o[s];c.baked||(ia.set(py,c.position.x,c.position.y,c.position.z,c.range),$s.sphereFrustum(py,e.frustum)&&n.push(c))}}function ky(t,e){var n=e.scene,i=n.mainLight,r=t.pipelineSceneData,a=r.shadows,o=r.skybox,s=r.renderObjects;Dy.freeArray(s),s.length=0;var c=r.castShadowObjects;My.freeArray(c),c.length=0,_y=!1;var l=null;if(a.enabled&&(t.pipelineUBO.updateShadowUBORange(Jp.SHADOW_COLOR_OFFSET,a.shadowColor),a.type===Pv.ShadowMap))if(l=t.pipelineSceneData.dirShadowObjects,Oy.freeArray(l),l.length=0,i&&i.node)!function(t,e,n,i,r){var a=e.device;if(r.fixedArea){var o=r.orthoSize,s=r.orthoSize,c=r.near,l=r.far;Ri.fromRT(yy,n.node.getWorldRotation(),n.node.getWorldPosition()),Ri.invert(xy,yy),Ri.ortho(Ty,-o,o,-s,s,c,l,a.capabilities.clipSpaceMinZ,a.capabilities.clipSpaceSignY),Ri.multiply(Ay,Ty,xy),Ri.invert(Sy,xy),r.matShadowView=xy,r.matShadowProj=Ty,r.matShadowViewProj=Ay,Wc.createOrtho(t,2*o,2*s,c,l,Sy)}else{var u=r.invisibleOcclusionRange,h=r.size.x;!function(t,e){if(e.node){var n=e.node,i=n.getWorldPosition(),r=n.getWorldRotation();Ri.fromRT(t,r,i),t.m08*=-1,t.m09*=-1,t.m10*=-1}}(uy,i),Wc.split(my,i,uy,.1,r.shadowDistance),gy=Wc.clone(my),Ri.fromRT(yy,n.node.rotation,Ry),Ri.invert(xy,yy),Ri.invert(Sy,xy);var f=xy.clone();gy.transform(xy),Mc.fromPoints(hy,new di(1e7,1e7,1e7),new di(-1e7,-1e7,-1e7)),hy.mergeFrustum(gy);var _=2*hy.halfExtents.z;ly.set(hy.center.x,hy.center.y,hy.center.z+hy.halfExtents.z+u),di.transformMat4(ly,ly,Sy),Ri.fromRT(yy,n.node.rotation,ly),Ri.invert(xy,yy),Ri.invert(Sy,xy);var p=di.distance(my.vertices[0],my.vertices[6]);dy.center.set(0,0,0),dy.radius=-1,dy.mergePoints(my.vertices);var d=.8*p+.4*dy.radius;r.shadowCameraFar=_+u;var m=.5*d;if(Ri.ortho(Ty,-m,m,-m,m,.1,r.shadowCameraFar,a.capabilities.clipSpaceMinZ,a.capabilities.clipSpaceSignY),h>0){Ri.multiply(Ey,Ty,f),di.transformMat4(by,ly,Ey);var g=2/h;wy.set(g,g);var v=by.x%wy.x,y=by.y%wy.y;Py.set(by.x-v,by.y-y,by.z),Ri.invert(Cy,Ey),di.transformMat4(Iy,Py,Cy),Ri.fromRT(yy,n.node.rotation,Iy),Ri.invert(xy,yy),Ri.invert(Sy,xy),Wc.createOrtho(t,d,d,.1,r.shadowCameraFar,Sy)}else{for(var x=0;x<8;x++)t.vertices[x].set(0,0,0);t.updatePlanes()}Ri.multiply(Ay,Ty,xy),r.matShadowView=xy,r.matShadowProj=Ty,r.matShadowViewProj=Ay}}(vy,t,i,e,a);else{for(var u=0;u<8;u++)vy.vertices[u].set(0,0,0);vy.updatePlanes()}i&&a.type===Pv.Planar&&function(t,e){var n=t.pipelineSceneData.shadows,i=e.direction,r=n.normal,a=n.distance+.001,o=1/di.dot(r,i),s=i.x*o,c=i.y*o,l=i.z*o,u=r.x,h=r.y,f=r.z,_=n.matLight;_.m00=1-u*s,_.m01=-u*c,_.m02=-u*l,_.m03=0,_.m04=-h*s,_.m05=1-h*c,_.m06=-h*l,_.m07=0,_.m08=-f*s,_.m09=-f*c,_.m10=1-f*l,_.m11=0,_.m12=s*a,_.m13=c*a,_.m14=l*a,_.m15=1,t.pipelineUBO.updateShadowUBORange(Jp.MAT_LIGHT_PLANE_PROJ_OFFSET,n.matLight)}(t,i),o.enabled&&o.model&&e.clearFlag&pm&&s.push(Ny(o.model,e));for(var h=n.models,f=e.visibility,_=0;_<h.length;_++){var p=h[_];if(p.enabled&&(p.castShadow&&c.push(By(p,e)),a.firstSetCSM&&p.worldBounds&&(_y||(fy.copy(p.worldBounds),_y=!0),Mc.merge(fy,fy,p.worldBounds)),p.node&&(f&p.node.layer)===p.node.layer||f&p.visFlags)){if(null!=l&&p.castShadow&&p.worldBounds&&$s.aabbFrustum(p.worldBounds,vy)&&l.push(Ly(p,e)),p.worldBounds&&!$s.aabbFrustum(p.worldBounds,e.frustum))continue;s.push(Ny(p,e))}}a.firstSetCSM&&(a.shadowDistance=2*fy.halfExtents.length(),a.firstSetCSM=!1)}var Gy,Hy,Vy,jy,Wy,Xy,qy,Yy,Ky,Qy,Zy=new Ia(Mr.LINEAR,Mr.LINEAR,Mr.NONE,Nr.CLAMP,Nr.CLAMP,Nr.CLAMP),Jy=new Ia(Mr.POINT,Mr.POINT,Mr.NONE,Nr.CLAMP,Nr.CLAMP,Nr.CLAMP),$y=function(){function t(t){this._device=void 0,this._descriptorSetMap=new Map,this._globalDescriptorSet=void 0,this._descriptorSetLayout=void 0,this._linearSampler=void 0,this._pointSampler=void 0,this._device=t.device,this._linearSampler=this._device.getSampler(Zy),this._pointSampler=this._device.getSampler(Jy);var e=new Za(Gp.bindings);this._descriptorSetLayout=this._device.createDescriptorSetLayout(e),this._globalDescriptorSet=this._device.createDescriptorSet(new Ja(this._descriptorSetLayout))}var e=t.prototype;return e.bindBuffer=function(t,e){this._globalDescriptorSet.bindBuffer(t,e);for(var n=this._descriptorSetMap.values(),i=n.next();!i.done;)i.value.bindBuffer(t,e),i=n.next()},e.bindSampler=function(t,e){this._globalDescriptorSet.bindSampler(t,e);for(var n=this._descriptorSetMap.values(),i=n.next();!i.done;)i.value.bindSampler(t,e),i=n.next()},e.bindTexture=function(t,e){this._globalDescriptorSet.bindTexture(t,e);for(var n=this._descriptorSetMap.values(),i=n.next();!i.done;)i.value.bindTexture(t,e),i=n.next()},e.update=function(){this._globalDescriptorSet.update();for(var t=this._descriptorSetMap.values(),e=t.next();!e.done;)e.value.update(),e=t.next()},e.getOrCreateDescriptorSet=function(t){var e=this._device;if(!this._descriptorSetMap.has(t)){var n=this._globalDescriptorSet,i=e.createDescriptorSet(new Ja(this._descriptorSetLayout));this._descriptorSetMap.set(t,i);for(var r=kp.UBO_GLOBAL;r<kp.COUNT;r++)i.bindBuffer(r,n.getBuffer(r)),i.bindSampler(r,n.getSampler(r)),i.bindTexture(r,n.getTexture(r));var a=e.createBuffer(new Ta(Er.UNIFORM|Er.TRANSFER_DST,wr.HOST|wr.DEVICE,Jp.SIZE,Jp.SIZE));i.bindBuffer(Jp.BINDING,a),i.update()}return this._descriptorSetMap.get(t)},e.destroy=function(){this._descriptorSetLayout.destroy()},L(t,[{key:"descriptorSetMap",get:function(){return this._descriptorSetMap}},{key:"linearSampler",get:function(){return this._linearSampler}},{key:"pointSampler",get:function(){return this._pointSampler}},{key:"descriptorSetLayout",get:function(){return this._descriptorSetLayout}},{key:"globalDescriptorSet",get:function(){return this._globalDescriptorSet}}]),t}(),tx=new Ri,ex=new Ri,nx=new Ri,ix=new zi,rx=new zi(0,0,1,0),ax=function(){function t(){this._globalUBO=new Float32Array(Qp.COUNT),this._cameraUBO=new Float32Array(Zp.COUNT),this._shadowUBO=new Float32Array(Jp.COUNT)}t.updateGlobalUBOView=function(t,e){var n=i.director.root,r=e,a=Math.floor(t.width),o=Math.floor(t.height);r[Qp.TIME_OFFSET]=n.cumulativeTime,r[Qp.TIME_OFFSET+1]=n.frameTime,r[Qp.TIME_OFFSET+2]=i.director.getTotalFrames(),r[Qp.SCREEN_SIZE_OFFSET]=a,r[Qp.SCREEN_SIZE_OFFSET+1]=o,r[Qp.SCREEN_SIZE_OFFSET+2]=1/a,r[Qp.SCREEN_SIZE_OFFSET+3]=1/o,r[Qp.NATIVE_SIZE_OFFSET]=a,r[Qp.NATIVE_SIZE_OFFSET+1]=o,r[Qp.NATIVE_SIZE_OFFSET+2]=1/r[Qp.NATIVE_SIZE_OFFSET],r[Qp.NATIVE_SIZE_OFFSET+3]=1/r[Qp.NATIVE_SIZE_OFFSET+1]},t.updateCameraUBOView=function(t,e,n){var r=(n.scene?n.scene:i.director.getScene().renderScene).mainLight,a=t.pipelineSceneData,o=a.ambient,s=a.fog,c=a.shadows,l=e,u=n.exposure,h=a.isHDR;if(l[Zp.SCREEN_SCALE_OFFSET]=a.shadingScale,l[Zp.SCREEN_SCALE_OFFSET+1]=a.shadingScale,l[Zp.SCREEN_SCALE_OFFSET+2]=1/l[Zp.SCREEN_SCALE_OFFSET],l[Zp.SCREEN_SCALE_OFFSET+3]=1/l[Zp.SCREEN_SCALE_OFFSET+1],l[Zp.EXPOSURE_OFFSET]=u,l[Zp.EXPOSURE_OFFSET+1]=1/u,l[Zp.EXPOSURE_OFFSET+2]=h?1:0,l[Zp.EXPOSURE_OFFSET+3]=0,r){var f=c.enabled&&c.type===Pv.ShadowMap?1:0,_=r.direction;if(rx.set(_.x,_.y,_.z,f),zi.toArray(l,rx,Zp.MAIN_LIT_DIR_OFFSET),di.toArray(l,r.color,Zp.MAIN_LIT_COLOR_OFFSET),r.useColorTemperature){var p=r.colorTemperatureRGB;l[Zp.MAIN_LIT_COLOR_OFFSET]*=p.x,l[Zp.MAIN_LIT_COLOR_OFFSET+1]*=p.y,l[Zp.MAIN_LIT_COLOR_OFFSET+2]*=p.z}l[Zp.MAIN_LIT_COLOR_OFFSET+3]=h?r.illuminance*u:r.illuminance}else rx.set(0,0,1,0),zi.toArray(l,rx,Zp.MAIN_LIT_DIR_OFFSET),zi.toArray(l,zi.ZERO,Zp.MAIN_LIT_COLOR_OFFSET);var d=o.skyColor;d.w=h?o.skyIllum*u:o.skyIllum,l[Zp.AMBIENT_SKY_OFFSET+0]=d.x,l[Zp.AMBIENT_SKY_OFFSET+1]=d.y,l[Zp.AMBIENT_SKY_OFFSET+2]=d.z,l[Zp.AMBIENT_SKY_OFFSET+3]=d.w,l[Zp.AMBIENT_GROUND_OFFSET+0]=o.groundAlbedo.x,l[Zp.AMBIENT_GROUND_OFFSET+1]=o.groundAlbedo.y,l[Zp.AMBIENT_GROUND_OFFSET+2]=o.groundAlbedo.z,l[Zp.AMBIENT_GROUND_OFFSET+3]=o.mipmapCount,Ri.toArray(l,n.matView,Zp.MAT_VIEW_OFFSET),Ri.toArray(l,n.node.worldMatrix,Zp.MAT_VIEW_INV_OFFSET),di.toArray(l,n.position,Zp.CAMERA_POS_OFFSET),Ri.toArray(l,n.matProj,Zp.MAT_PROJ_OFFSET),Ri.toArray(l,n.matProjInv,Zp.MAT_PROJ_INV_OFFSET),Ri.toArray(l,n.matViewProj,Zp.MAT_VIEW_PROJ_OFFSET),Ri.toArray(l,n.matViewProjInv,Zp.MAT_VIEW_PROJ_INV_OFFSET),l[Zp.CAMERA_POS_OFFSET+3]=this.getCombineSignY();var m=s.colorArray;l[Zp.GLOBAL_FOG_COLOR_OFFSET]=m.x,l[Zp.GLOBAL_FOG_COLOR_OFFSET+1]=m.y,l[Zp.GLOBAL_FOG_COLOR_OFFSET+2]=m.z,l[Zp.GLOBAL_FOG_COLOR_OFFSET+3]=m.z,l[Zp.GLOBAL_FOG_BASE_OFFSET]=s.fogStart,l[Zp.GLOBAL_FOG_BASE_OFFSET+1]=s.fogEnd,l[Zp.GLOBAL_FOG_BASE_OFFSET+2]=s.fogDensity,l[Zp.GLOBAL_FOG_ADD_OFFSET]=s.fogTop,l[Zp.GLOBAL_FOG_ADD_OFFSET+1]=s.fogRange,l[Zp.GLOBAL_FOG_ADD_OFFSET+2]=s.fogAtten,l[Zp.NEAR_FAR_OFFSET]=n.nearClip,l[Zp.NEAR_FAR_OFFSET+1]=n.farClip,l[Zp.VIEW_PORT_OFFSET]=a.shadingScale*n.window.width*n.viewport.x,l[Zp.VIEW_PORT_OFFSET+1]=a.shadingScale*n.window.height*n.viewport.y,l[Zp.VIEW_PORT_OFFSET+2]=a.shadingScale*n.window.width*n.viewport.z,l[Zp.VIEW_PORT_OFFSET+3]=a.shadingScale*n.window.height*n.viewport.w},t.updateShadowUBOView=function(t,e,n){var i=t.device,r=n.scene.mainLight,a=t.pipelineSceneData.shadows,o=e;if(a.enabled){if(r&&a.type===Pv.ShadowMap){var s=.1,c=0,l=a.matShadowView,u=a.matShadowProj,h=a.matShadowViewProj;a.fixedArea?(s=a.near,c=a.far):(s=.1,c=a.shadowCameraFar),Ri.toArray(e,l,Jp.MAT_LIGHT_VIEW_OFFSET),o[Jp.SHADOW_PROJ_DEPTH_INFO_OFFSET+0]=u.m10,o[Jp.SHADOW_PROJ_DEPTH_INFO_OFFSET+1]=u.m14,o[Jp.SHADOW_PROJ_DEPTH_INFO_OFFSET+2]=u.m11,o[Jp.SHADOW_PROJ_DEPTH_INFO_OFFSET+3]=u.m15,o[Jp.SHADOW_PROJ_INFO_OFFSET+0]=u.m00,o[Jp.SHADOW_PROJ_INFO_OFFSET+1]=u.m05,o[Jp.SHADOW_PROJ_INFO_OFFSET+2]=1/u.m00,o[Jp.SHADOW_PROJ_INFO_OFFSET+3]=1/u.m05,Ri.toArray(e,h,Jp.MAT_LIGHT_VIEW_PROJ_OFFSET);var f=tm(i)?0:1;o[Jp.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET+0]=s,o[Jp.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET+1]=c,o[Jp.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET+2]=0,o[Jp.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET+3]=1-a.saturation,o[Jp.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+0]=a.size.x,o[Jp.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+1]=a.size.y,o[Jp.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+2]=a.pcf,o[Jp.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+3]=a.bias,o[Jp.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+0]=0,o[Jp.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+1]=f,o[Jp.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+2]=a.normalBias,o[Jp.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+3]=0}else r&&a.type===Pv.Planar&&(Fy(a,r,o),zy(a,o));_i.toArray(o,a.shadowColor,Jp.SHADOW_COLOR_OFFSET)}},t.updateShadowUBOLightView=function(t,e,n){var i=t.device,r=t.pipelineSceneData.shadows,a=e,o=tm(i)?0:1,s=.1,c=0,l=r.matShadowView,u=r.matShadowProj,h=r.matShadowViewProj;switch(n.type){case Mv.DIRECTIONAL:r.fixedArea?(s=r.near,c=r.far):(s=.1,c=r.shadowCameraFar),Ri.toArray(e,l,Jp.MAT_LIGHT_VIEW_OFFSET),a[Jp.SHADOW_PROJ_DEPTH_INFO_OFFSET+0]=u.m10,a[Jp.SHADOW_PROJ_DEPTH_INFO_OFFSET+1]=u.m14,a[Jp.SHADOW_PROJ_DEPTH_INFO_OFFSET+2]=u.m11,a[Jp.SHADOW_PROJ_DEPTH_INFO_OFFSET+3]=u.m15,a[Jp.SHADOW_PROJ_INFO_OFFSET+0]=u.m00,a[Jp.SHADOW_PROJ_INFO_OFFSET+1]=u.m05,a[Jp.SHADOW_PROJ_INFO_OFFSET+2]=1/u.m00,a[Jp.SHADOW_PROJ_INFO_OFFSET+3]=1/u.m05,Ri.toArray(e,h,Jp.MAT_LIGHT_VIEW_PROJ_OFFSET),ix.set(s,c,0,1-r.saturation),zi.toArray(a,ix,Jp.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET),ix.set(0,o,r.normalBias,0),zi.toArray(a,ix,Jp.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET);break;case Mv.SPOT:Ri.invert(tx,n.node.getWorldMatrix()),Ri.toArray(a,tx,Jp.MAT_LIGHT_VIEW_OFFSET),Ri.perspective(ex,n.angle,n.aspect,.001,n.range),Ri.multiply(nx,ex,tx),Ri.toArray(a,nx,Jp.MAT_LIGHT_VIEW_PROJ_OFFSET),ix.set(.01,n.range,0,1-r.saturation),zi.toArray(a,ix,Jp.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET),ix.set(1,o,r.normalBias,0),zi.toArray(a,ix,Jp.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET)}ix.set(r.size.x,r.size.y,r.pcf,r.bias),zi.toArray(a,ix,Jp.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET),_i.toArray(a,r.shadowColor,Jp.SHADOW_COLOR_OFFSET)},t.getCombineSignY=function(){return t._combineSignY};var e=t.prototype;return e._initCombineSignY=function(){var e=this._device;t._combineSignY=.5*e.capabilities.screenSpaceSignY+.5<<1|.5*e.capabilities.clipSpaceSignY+.5},e.activate=function(t,e){this._device=t,this._pipeline=e;var n=this._pipeline.descriptorSet;this._initCombineSignY();var i=t.createBuffer(new Ta(Er.UNIFORM|Er.TRANSFER_DST,wr.HOST|wr.DEVICE,Qp.SIZE,Qp.SIZE));n.bindBuffer(Qp.BINDING,i);var r=t.createBuffer(new Ta(Er.UNIFORM|Er.TRANSFER_DST,wr.HOST|wr.DEVICE,Zp.SIZE,Zp.SIZE));n.bindBuffer(Zp.BINDING,r);var a=t.createBuffer(new Ta(Er.UNIFORM|Er.TRANSFER_DST,wr.HOST|wr.DEVICE,Jp.SIZE,Jp.SIZE));n.bindBuffer(Jp.BINDING,a)},e.updateGlobalUBO=function(e){var n=this._pipeline.globalDSManager,i=this._pipeline.descriptorSet,r=this._pipeline.commandBuffers;i.update(),t.updateGlobalUBOView(e,this._globalUBO),r[0].updateBuffer(i.getBuffer(Qp.BINDING),this._globalUBO),n.bindBuffer(Qp.BINDING,i.getBuffer(Qp.BINDING)),n.update()},e.updateCameraUBO=function(e){var n=this._pipeline.globalDSManager,i=this._pipeline.descriptorSet,r=this._pipeline.commandBuffers;t.updateCameraUBOView(this._pipeline,this._cameraUBO,e),r[0].updateBuffer(i.getBuffer(Zp.BINDING),this._cameraUBO),n.bindBuffer(Zp.BINDING,i.getBuffer(Zp.BINDING)),n.update()},e.updateShadowUBO=function(e){var n=this._pipeline.pipelineSceneData;if(n.shadows.enabled){var i=this._pipeline.descriptorSet,r=this._pipeline.commandBuffers,a=n.shadowFrameBufferMap,o=e.scene.mainLight;o&&a.has(o)&&i.bindTexture($p,a.get(o).colorTextures[0]),t.updateShadowUBOView(this._pipeline,this._shadowUBO,e),i.update(),r[0].updateBuffer(i.getBuffer(Jp.BINDING),this._shadowUBO)}},e.updateShadowUBOLight=function(e,n){t.updateShadowUBOLightView(this._pipeline,this._shadowUBO,n),e.bindTexture($p,Lg.get("default-texture").getGFXTexture()),e.bindTexture(cd,Lg.get("default-texture").getGFXTexture()),e.update(),e.getBuffer(Jp.BINDING).update(this._shadowUBO)},e.updateShadowUBORange=function(t,e){e instanceof Ri?Ri.toArray(this._shadowUBO,e,t):e instanceof _i&&_i.toArray(this._shadowUBO,e,t)},e.destroy=function(){},t}();ax._combineSignY=0;var ox,sx,cx,lx,ux,hx,fx,_x,px,dx,mx,gx,vx,yx=t("RenderStage",(Gy=nl("RenderStage"),Hy=Il(),Vy=Il(),jy=Il(),Gy((Qy=function(){function t(){X(this,"_name",qy,this),X(this,"_priority",Yy,this),this._enabled=!0,X(this,"_tag",Ky,this)}var e=t.prototype;return e.initialize=function(t){return this._name=t.name,this._priority=t.priority,t.tag&&(this._tag=t.tag),!0},e.activate=function(t,e){this._pipeline=t,this._flow=e},L(t,[{key:"name",get:function(){return this._name}},{key:"priority",get:function(){return this._priority}},{key:"tag",get:function(){return this._tag}},{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled=t}}]),t}(),qy=q((Xy=Qy).prototype,"_name",[Hy,cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Yy=q(Xy.prototype,"_priority",[Vy,cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Ky=q(Xy.prototype,"_tag",[jy,cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Wy=Xy))||Wy));i.RenderStage=yx;var xx,Sx=t("RenderFlow",(ox=nl("RenderFlow"),sx=Il(),cx=Il(),lx=Il(),ux=Il(),hx=Bl([yx]),ox((vx=function(){function t(){X(this,"_name",px,this),X(this,"_priority",dx,this),X(this,"_tag",mx,this),X(this,"_stages",gx,this)}var e=t.prototype;return e.initialize=function(t){return this._name=t.name,this._priority=t.priority,this._stages=t.stages,t.tag&&(this._tag=t.tag),!0},e.activate=function(t){this._pipeline=t,this._stages.sort((function(t,e){return t.priority-e.priority}));for(var e=0,n=this._stages.length;e<n;e++)this._stages[e].activate(t,this)},e.render=function(t){for(var e=0,n=this._stages.length;e<n;e++)this._stages[e].enabled&&this._stages[e].render(t)},e.destroy=function(){for(var t=0,e=this._stages.length;t<e;t++)this._stages[t].destroy();this._stages.length=0},L(t,[{key:"name",get:function(){return this._name}},{key:"priority",get:function(){return this._priority}},{key:"tag",get:function(){return this._tag}},{key:"stages",get:function(){return this._stages}},{key:"pipeline",get:function(){return this._pipeline}}]),t}(),px=q((_x=vx).prototype,"_name",[sx,cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),dx=q(_x.prototype,"_priority",[cx,cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),mx=q(_x.prototype,"_tag",[lx,cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),gx=q(_x.prototype,"_stages",[ux,hx,cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),fx=_x))||fx));i.RenderFlow=Sx,function(t){t.RENDER_FRAME_BEGIN="render-frame-begin",t.RENDER_FRAME_END="render-frame-end",t.RENDER_CAMERA_BEGIN="render-camera-begin",t.RENDER_CAMERA_END="render-camera-end",t.ATTACHMENT_SCALE_CAHNGED="attachment-scale-changed"}(xx||(xx=t("PipelineEventType",{})));var Tx,Ax,Ex,Cx,bx,wx,Px,Ix,Rx,Dx,Ox,Mx,Nx,Lx,Bx,Fx=t("PipelineEventProcessor",function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).eventTargetOn=t.prototype.on,e.eventTargetOnce=t.prototype.once,e}F(e,t);var n=e.prototype;return n.on=function(t,e,n,i){return this.eventTargetOn(t,e,n,i)},n.once=function(t,e,n){return this.eventTargetOnce(t,e,n)},e}(fn)),zx=new ua,Ux=new ga,kx=function(){this.renderPass=null,this.sampler=null,this.prefiterTex=null,this.downsampleTexs=[],this.upsampleTexs=[],this.combineTex=null,this.prefilterFramebuffer=null,this.downsampleFramebuffers=[],this.upsampleFramebuffers=[],this.combineFramebuffer=null},Gx=function(){this.quadIB=null,this.quadVB=null,this.quadIA=null},Hx=t("RenderPipeline",(Tx=nl("cc.RenderPipeline"),Ax=Il(),Ex=Il(),Cx=Bl([Sx]),Tx((Rx=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return X(e=t.call.apply(t,[this].concat(i))||this,"_tag",Px,V(e)),X(e,"_flows",Ix,V(e)),e._quadIB=null,e._quadVBOnscreen=null,e._quadVBOffscreen=null,e._quadIAOnscreen=null,e._quadIAOffscreen=null,e._eventProcessor=new Fx,e._commandBuffers=[],e._pipelineUBO=new ax,e._macros={},e._constantMacros="",e._profiler=null,e._pipelineRenderData=null,e._renderPasses=new Map,e._width=0,e._height=0,e._lastUsedRenderArea=new ua,e._clusterEnabled=!1,e._bloomEnabled=!1,e}F(e,t);var n=e.prototype;return n.getPipelineRenderData=function(){return this._pipelineRenderData},n.initialize=function(t){return this._flows=t.flows,t.tag&&(this._tag=t.tag),!0},n.createRenderPass=function(t,e,n){var i=this._device,r=new Ha,a=new Va;r.format=e,a.format=n,a.stencilStoreOp=Hr.DISCARD,a.depthStoreOp=Hr.DISCARD,t&na.COLOR||(t&pm?r.loadOp=Gr.DISCARD:(r.loadOp=Gr.LOAD,r.beginAccesses=[Vr.COLOR_ATTACHMENT_WRITE])),(t&na.DEPTH_STENCIL)!==na.DEPTH_STENCIL&&(t&na.DEPTH||(a.depthLoadOp=Gr.LOAD),t&na.STENCIL||(a.stencilLoadOp=Gr.LOAD)),a.beginAccesses=[Vr.DEPTH_STENCIL_ATTACHMENT_WRITE];var o=new Xa([r],a);return i.createRenderPass(o)},n.getRenderPass=function(t,e){var n=this._renderPasses.get(t);return n||(n=this.createRenderPass(t,e.colorTextures[0].format,e.depthStencilTexture.format),this._renderPasses.set(t,n),n)},n.applyFramebufferRatio=function(t){for(var e=this.pipelineSceneData,n=this._width*e.shadingScale,i=this._height*e.shadingScale,r=t.colorTextures,a=0;a<r.length;a++)r[a].resize(n,i);t.depthStencilTexture&&t.depthStencilTexture.resize(n,i),t.destroy(),t.initialize(new Ka(t.renderPass,r,t.depthStencilTexture))},n.generateRenderArea=function(t,e){var n=t.viewport,i=t.window.width,r=t.window.height;e.x=n.x*i,e.y=n.y*r,e.width=n.width*i,e.height=n.height*r},n.generateViewport=function(t,e){this.generateRenderArea(t,zx),e||(e=Ux);var n=this.pipelineSceneData.shadingScale;return e.left=zx.x*n,e.top=zx.y*n,e.width=zx.width*n,e.height=zx.height*n,e},n.generateScissor=function(t,e){e||(e=zx),this.generateRenderArea(t,e);var n=this.pipelineSceneData.shadingScale;return e.x*=n,e.y*=n,e.width*=n,e.height*=n,e},n.activate=function(){var t=i.director.root;this._device=t.device,this._generateConstantMacros(),this._globalDSManager=new $y(this),this._descriptorSet=this._globalDSManager.globalDescriptorSet,this._pipelineUBO.activate(this._device,this),this._macros.CC_USE_HDR=this._pipelineSceneData.isHDR,this._generateConstantMacros(),this._pipelineSceneData.activate(this._device,this);for(var e=0;e<this._flows.length;e++)this._flows[e].activate(this);return!0},n._ensureEnoughSize=function(){},n.render=function(t){if(0!==t.length){this._commandBuffers[0].begin(),this.emit(xx.RENDER_FRAME_BEGIN,t),this._ensureEnoughSize(t),function(t){for(var e=t.length-1;e>=0;--e){var n=t[e];if(n.window.swapchain)return void(Av=n)}Av=null}(t);for(var e=0;e<t.length;e++){var n=t[e];if(n.scene){this.emit(xx.RENDER_CAMERA_BEGIN,n),Uy(this,n),ky(this,n),this._pipelineUBO.updateGlobalUBO(n.window),this._pipelineUBO.updateCameraUBO(n);for(var i=0;i<this._flows.length;i++)this._flows[i].render(n);this.emit(xx.RENDER_CAMERA_END,n)}}this.emit(xx.RENDER_FRAME_END,t),this._commandBuffers[0].end(),this._device.queue.submit(this._commandBuffers)}},n._destroyQuadInputAssembler=function(){this._quadIB&&(this._quadIB.destroy(),this._quadIB=null),this._quadVBOnscreen&&(this._quadVBOnscreen.destroy(),this._quadVBOnscreen=null),this._quadVBOffscreen&&(this._quadVBOffscreen.destroy(),this._quadVBOffscreen=null),this._quadIAOnscreen&&(this._quadIAOnscreen.destroy(),this._quadIAOnscreen=null),this._quadIAOffscreen&&(this._quadIAOffscreen.destroy(),this._quadIAOffscreen=null)},n._destroyBloomData=function(){var t,e=this._pipelineRenderData.bloom;if(null!==e){e.prefiterTex&&e.prefiterTex.destroy(),e.prefilterFramebuffer&&e.prefilterFramebuffer.destroy();for(var n=0;n<e.downsampleTexs.length;++n)e.downsampleTexs[n].destroy(),e.downsampleFramebuffers[n].destroy();e.downsampleTexs.length=0,e.downsampleFramebuffers.length=0;for(var i=0;i<e.upsampleTexs.length;++i)e.upsampleTexs[i].destroy(),e.upsampleFramebuffers[i].destroy();e.upsampleTexs.length=0,e.upsampleFramebuffers.length=0,e.combineTex&&e.combineTex.destroy(),e.combineFramebuffer&&e.combineFramebuffer.destroy(),null===(t=e.renderPass)||void 0===t||t.destroy(),this._pipelineRenderData.bloom=null}},n._genQuadVertexData=function(t,e){var n=new Float32Array(16),i=e.x/this._width,r=(e.x+e.width)/this._width,a=e.y/this._height,o=(e.y+e.height)/this._height;if(this.device.capabilities.screenSpaceSignY>0){var s=o;o=a,a=s}var c=0;switch(t){case yr.IDENTITY:c=0,n[c++]=-1,n[c++]=-1,n[c++]=i,n[c++]=o,n[c++]=1,n[c++]=-1,n[c++]=r,n[c++]=o,n[c++]=-1,n[c++]=1,n[c++]=i,n[c++]=a,n[c++]=1,n[c++]=1,n[c++]=r,n[c++]=a;break;case yr.ROTATE_90:c=0,n[c++]=-1,n[c++]=-1,n[c++]=r,n[c++]=o,n[c++]=1,n[c++]=-1,n[c++]=r,n[c++]=a,n[c++]=-1,n[c++]=1,n[c++]=i,n[c++]=o,n[c++]=1,n[c++]=1,n[c++]=i,n[c++]=a;break;case yr.ROTATE_180:c=0,n[c++]=-1,n[c++]=-1,n[c++]=i,n[c++]=a,n[c++]=1,n[c++]=-1,n[c++]=r,n[c++]=a,n[c++]=-1,n[c++]=1,n[c++]=i,n[c++]=o,n[c++]=1,n[c++]=1,n[c++]=r,n[c++]=o;break;case yr.ROTATE_270:c=0,n[c++]=-1,n[c++]=-1,n[c++]=i,n[c++]=a,n[c++]=1,n[c++]=-1,n[c++]=i,n[c++]=o,n[c++]=-1,n[c++]=1,n[c++]=r,n[c++]=a,n[c++]=1,n[c++]=1,n[c++]=r,n[c++]=o}return n},n._createQuadInputAssembler=function(){var t=new Gx,e=4*Float32Array.BYTES_PER_ELEMENT,n=4*e,i=this._device.createBuffer(new Ta(Er.VERTEX|Er.TRANSFER_DST,wr.DEVICE|wr.HOST,n,e));if(!i)return t;var r=Uint8Array.BYTES_PER_ELEMENT,a=6*r,o=this._device.createBuffer(new Ta(Er.INDEX|Er.TRANSFER_DST,wr.DEVICE,a,r));if(!o)return t;var s=new Uint8Array(6);s[0]=0,s[1]=1,s[2]=2,s[3]=1,s[4]=3,s[5]=2,o.update(s);var c=new Array(2);c[0]=new Ua("a_position",Sr.RG32F),c[1]=new Ua("a_texCoord",Sr.RG32F);var l=this._device.createInputAssembler(new Ga(c,[i],o));return t.quadIB=o,t.quadVB=i,t.quadIA=l,t},n.updateQuadVertexData=function(t,e){var n=this._lastUsedRenderArea;if(n.x!==t.x||n.y!==t.y||n.width!==t.width||n.height!==t.height){var i=this._genQuadVertexData(yr.IDENTITY,t);this._quadVBOffscreen.update(i);var r=this._genQuadVertexData(e.swapchain&&e.swapchain.surfaceTransform||yr.IDENTITY,t);this._quadVBOnscreen.update(r),n.copy(t)}},n.destroy=function(){for(var e,n,i=0;i<this._flows.length;i++)this._flows[i].destroy();this._flows.length=0,this._descriptorSet&&this._descriptorSet.destroy(),null===(e=this._globalDSManager)||void 0===e||e.destroy();for(var r=0;r<this._commandBuffers.length;r++)this._commandBuffers[r].destroy();return this._commandBuffers.length=0,this._pipelineUBO.destroy(),null===(n=this._pipelineSceneData)||void 0===n||n.destroy(),t.prototype.destroy.call(this)},n._generateConstantMacros=function(){var t="";t+="#define CC_DEVICE_SUPPORT_FLOAT_TEXTURE "+(this.device.hasFeature(xr.TEXTURE_FLOAT)?1:0)+"\n",t+="#define CC_ENABLE_CLUSTERED_LIGHT_CULLING "+(this._clusterEnabled?1:0)+"\n",t+="#define CC_DEVICE_MAX_VERTEX_UNIFORM_VECTORS "+this.device.capabilities.maxVertexUniformVectors+"\n",t+="#define CC_DEVICE_MAX_FRAGMENT_UNIFORM_VECTORS "+this.device.capabilities.maxFragmentUniformVectors+"\n",t+="#define CC_DEVICE_CAN_BENEFIT_FROM_INPUT_ATTACHMENT "+(this.device.hasFeature(xr.INPUT_ATTACHMENT_BENEFIT)?1:0)+"\n",t+="#define CC_PLATFORM_ANDROID_AND_WEBGL "+(_n.os===ln.ANDROID&&_n.isBrowser?1:0)+"\n",t+="#define CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES "+($t.ENABLE_WEBGL_HIGHP_STRUCT_VALUES?1:0)+"\n",this._constantMacros=t},n.generateBloomRenderData=function(){if(null==this._pipelineRenderData.bloom){var t=this._pipelineRenderData.bloom=new kx,e=this.device,n=new Ha;n.format=Sr.RGBA8,n.loadOp=Gr.CLEAR,n.storeOp=Hr.STORE,n.endAccesses=[Vr.COLOR_ATTACHMENT_WRITE],t.renderPass=e.createRenderPass(new Xa([n]));var i=this._width,r=this._height;t.prefiterTex=e.createTexture(new wa(Pr.TEX2D,Ir.COLOR_ATTACHMENT|Ir.SAMPLED,Sr.RGBA8,i>>1,r>>1)),t.prefilterFramebuffer=e.createFramebuffer(new Ka(t.renderPass,[t.prefiterTex])),i>>=1,r>>=1;for(var a=0;a<6;++a)t.downsampleTexs.push(e.createTexture(new wa(Pr.TEX2D,Ir.COLOR_ATTACHMENT|Ir.SAMPLED,Sr.RGBA8,i>>1,r>>1))),t.downsampleFramebuffers[a]=e.createFramebuffer(new Ka(t.renderPass,[t.downsampleTexs[a]])),t.upsampleTexs.push(e.createTexture(new wa(Pr.TEX2D,Ir.COLOR_ATTACHMENT|Ir.SAMPLED,Sr.RGBA8,i,r))),t.upsampleFramebuffers[a]=e.createFramebuffer(new Ka(t.renderPass,[t.upsampleTexs[a]])),i>>=1,r>>=1;t.combineTex=e.createTexture(new wa(Pr.TEX2D,Ir.COLOR_ATTACHMENT|Ir.SAMPLED,Sr.RGBA8,this._width,this._height)),t.combineFramebuffer=e.createFramebuffer(new Ka(t.renderPass,[t.combineTex])),t.sampler=this.globalDSManager.linearSampler}},n.on=function(t,e,n,i){return this._eventProcessor.on(t,e,n,i)},n.once=function(t,e,n){return this._eventProcessor.once(t,e,n)},n.off=function(t,e,n){this._eventProcessor.off(t,e,n)},n.emit=function(t,e,n,i,r,a){this._eventProcessor.emit(t,e,n,i,r,a)},n.targetOff=function(t){this._eventProcessor.targetOff(t)},n.removeAll=function(t){this._eventProcessor.removeAll(t)},n.hasEventListener=function(t,e,n){return this._eventProcessor.hasEventListener(t,e,n)},L(e,[{key:"tag",get:function(){return this._tag}},{key:"flows",get:function(){return this._flows}},{key:"quadIAOnscreen",get:function(){return this._quadIAOnscreen}},{key:"quadIAOffscreen",get:function(){return this._quadIAOffscreen}},{key:"constantMacros",get:function(){return this._constantMacros}},{key:"macros",get:function(){return this._macros}},{key:"device",get:function(){return this._device}},{key:"globalDSManager",get:function(){return this._globalDSManager}},{key:"descriptorSetLayout",get:function(){return this._globalDSManager.descriptorSetLayout}},{key:"descriptorSet",get:function(){return this._descriptorSet}},{key:"commandBuffers",get:function(){return this._commandBuffers}},{key:"pipelineUBO",get:function(){return this._pipelineUBO}},{key:"pipelineSceneData",get:function(){return this._pipelineSceneData}},{key:"profiler",get:function(){return this._profiler},set:function(t){this._profiler=t}},{key:"clusterEnabled",get:function(){return this._clusterEnabled},set:function(t){this._clusterEnabled=t}},{key:"bloomEnabled",get:function(){return this._bloomEnabled},set:function(t){this._bloomEnabled=t}}]),e}(Ou),Px=q((wx=Rx).prototype,"_tag",[Ax,cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Ix=q(wx.prototype,"_flows",[Ex,Cx,cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),bx=wx))||bx));i.RenderPipeline=Hx,function(t){t[t.BLOOM=18]="BLOOM",t[t.POST_PROCESS=19]="POST_PROCESS",t[t.UI=20]="UI"}(Dx||(Dx={})),function(t){t[t.FORWARD=10]="FORWARD"}(Ox||(Ox={})),function(t){t[t.SHADOW=0]="SHADOW",t[t.FORWARD=1]="FORWARD",t[t.UI=10]="UI"}(Mx||(Mx={})),function(t){t[t.GBUFFER=10]="GBUFFER",t[t.LIGHTING=15]="LIGHTING",t[t.TRANSPARENT=18]="TRANSPARENT"}(Nx||(Nx={})),function(t){t[t.SHADOW=0]="SHADOW",t[t.MAIN=1]="MAIN",t[t.UI=10]="UI"}(Lx||(Lx={}));var Vx=new Ha;Vx.format=Sr.RGBA8,Vx.beginAccesses=[Vr.FRAGMENT_SHADER_READ_TEXTURE],Vx.endAccesses=[Vr.FRAGMENT_SHADER_READ_TEXTURE];var jx=new Va;jx.format=Sr.DEPTH_STENCIL;var Wx,Xx,qx,Yx,Kx,Qx,Zx,Jx,$x,tS,eS,nS,iS,rS,aS,oS,sS,cS,lS,uS,hS,fS,_S,pS,dS,mS,gS,vS,yS,xS,SS,TS,AS,ES,CS,bS,wS,PS,IS,RS,DS,OS,MS,NS,LS,BS,FS,zS,US,kS,GS,HS,VS,jS,WS,XS,qS,YS,KS,QS,ZS,JS,$S,tT,eT,nT,iT,rT,aT,oT,sT,cT,lT,uT,hT,fT,_T,pT,dT,mT=new Xa([Vx],jx),gT={width:1,height:1,renderPassInfo:mT},vT=t("RenderTexture",nl("cc.RenderTexture")(Bx=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._window=null,e}F(e,t);var n=e.prototype;return n.initialize=function(t){this._name=t.name||"",this._width=t.width,this._height=t.height,this._initWindow(t)},n.reset=function(t){this.initialize(t)},n.destroy=function(){if(this._window){var e=i.director.root;null==e||e.destroyWindow(this._window),this._window=null}return t.prototype.destroy.call(this)},n.resize=function(t,e){this._width=Math.floor(Yn(t,1,2048)),this._height=Math.floor(Yn(e,1,2048)),this._window&&this._window.resize(this._width,this._height),this.emit("resize",this._window)},n._serialize=function(){return{}},n._deserialize=function(e,n){var i=e;this._width=i.w,this._height=i.h,this._name=i.n,t.prototype._deserialize.call(this,i.base,n)},n.getGFXTexture=function(){return this._window&&this._window.framebuffer.colorTextures[0]},n.onLoaded=function(){this._initWindow()},n._initWindow=function(t){var e=i.director.root;gT.title=this._name,gT.width=this._width,gT.height=this._height,gT.renderPassInfo=t&&t.passInfo?t.passInfo:mT,this._window?(this._window.destroy(),this._window.initialize(e.device,gT)):this._window=e.createWindow(gT)},n.initDefault=function(e){t.prototype.initDefault.call(this,e),this._width=this._height=1,this._initWindow()},n.validate=function(){return this.width>=1&&this.width<=2048&&this.height>=1&&this.height<=2048},n.readPixels=function(t,e,n,i,r){void 0===t&&(t=0),void 0===e&&(e=0),n=n||this.width,i=i||this.height;var a=this.getGFXTexture();if(!a)return b(7606),null;var o=4*n*i;if(void 0===r)r=new Uint8Array(o);else if(r.length<o)return b(7607,o),null;var s=this._getGFXDevice(),c=[],l=[],u=new ma;return u.texOffset.x=t,u.texOffset.y=e,u.texExtent.width=n,u.texExtent.height=i,l.push(u),c.push(r),null==s||s.copyTextureToBuffers(a,c,l),r},L(e,[{key:"window",get:function(){return this._window}}]),e}(Mm))||Bx);i.RenderTexture=vT,Zt(Pr),Zt(Ir),Zt(Hr),Zt(Gr),Zt(Vr),function(t){t[t.SCENE=0]="SCENE",t[t.POSTPROCESS=1]="POSTPROCESS",t[t.UI=2]="UI"}(dT||(dT={})),Zt(dT),Wx=nl("RenderTextureDesc"),Xx=Bl(Pr),qx=Bl(Ir),Yx=Bl(Sr),Wx((Qx=q((Kx=function(){X(this,"name",Qx,this),X(this,"type",Zx,this),X(this,"usage",Jx,this),X(this,"format",$x,this),X(this,"width",tS,this),X(this,"height",eS,this)}).prototype,"name",[cl,yl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Zx=q(Kx.prototype,"type",[Xx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Pr.TEX2D}}),Jx=q(Kx.prototype,"usage",[qx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ir.COLOR_ATTACHMENT}}),$x=q(Kx.prototype,"format",[Yx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Sr.UNKNOWN}}),tS=q(Kx.prototype,"width",[cl,yl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),eS=q(Kx.prototype,"height",[cl,yl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),Kx));var yT,xT=(nS=nl("RenderTextureConfig"),iS=Bl(vT),nS((oS=q((aS=function(){X(this,"name",oS,this),X(this,"texture",sS,this)}).prototype,"name",[cl,yl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),sS=q(aS.prototype,"texture",[iS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),rS=aS))||rS),ST=(cS=nl("MaterialConfig"),lS=Bl(bv),cS((hS=q((uS=function(){X(this,"name",hS,this),X(this,"material",fS,this)}).prototype,"name",[cl,yl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),fS=q(uS.prototype,"material",[lS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),uS)),_S=nl("FrameBufferDesc"),pS=Bl([Ee]),dS=Bl(vT),_S((gS=q((mS=function(){X(this,"name",gS,this),X(this,"renderPass",vS,this),X(this,"colorTextures",yS,this),X(this,"depthStencilTexture",xS,this),X(this,"texture",SS,this)}).prototype,"name",[cl,yl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),vS=q(mS.prototype,"renderPass",[cl,yl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),yS=q(mS.prototype,"colorTextures",[pS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),xS=q(mS.prototype,"depthStencilTexture",[cl,yl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),SS=q(mS.prototype,"texture",[dS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),mS)),TS=nl("ColorDesc"),AS=Bl(Sr),ES=Bl(Gr),CS=Bl(Hr),bS=Bl([Vr]),wS=Bl([Vr]),TS((RS=q((IS=function(){X(this,"format",RS,this),X(this,"loadOp",DS,this),X(this,"storeOp",OS,this),X(this,"sampleCount",MS,this),X(this,"beginAccesses",NS,this),X(this,"endAccesses",LS,this)}).prototype,"format",[AS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Sr.UNKNOWN}}),DS=q(IS.prototype,"loadOp",[ES],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Gr.CLEAR}}),OS=q(IS.prototype,"storeOp",[CS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Hr.STORE}}),MS=q(IS.prototype,"sampleCount",[cl,yl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),NS=q(IS.prototype,"beginAccesses",[bS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),LS=q(IS.prototype,"endAccesses",[wS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[Vr.COLOR_ATTACHMENT_WRITE]}}),PS=IS))||PS),TT=(BS=nl("DepthStencilDesc"),FS=Bl(Sr),zS=Bl(Gr),US=Bl(Hr),kS=Bl(Gr),GS=Bl(Hr),HS=Bl([Vr]),VS=Bl([Vr]),BS((XS=q((WS=function(){X(this,"format",XS,this),X(this,"depthLoadOp",qS,this),X(this,"depthStoreOp",YS,this),X(this,"stencilLoadOp",KS,this),X(this,"stencilStoreOp",QS,this),X(this,"sampleCount",ZS,this),X(this,"beginAccesses",JS,this),X(this,"endAccesses",$S,this)}).prototype,"format",[FS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Sr.UNKNOWN}}),qS=q(WS.prototype,"depthLoadOp",[zS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Gr.CLEAR}}),YS=q(WS.prototype,"depthStoreOp",[US],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Hr.STORE}}),KS=q(WS.prototype,"stencilLoadOp",[kS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Gr.CLEAR}}),QS=q(WS.prototype,"stencilStoreOp",[GS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Hr.STORE}}),ZS=q(WS.prototype,"sampleCount",[cl,yl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),JS=q(WS.prototype,"beginAccesses",[HS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),$S=q(WS.prototype,"endAccesses",[VS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[Vr.DEPTH_STENCIL_ATTACHMENT_WRITE]}}),jS=WS))||jS);tT=nl("RenderPassDesc"),eT=Bl([ST]),nT=Bl(TT),tT((rT=q((iT=function(){X(this,"index",rT,this),X(this,"colorAttachments",aT,this),X(this,"depthStencilAttachment",oT,this)}).prototype,"index",[cl,yl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),aT=q(iT.prototype,"colorAttachments",[eT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),oT=q(iT.prototype,"depthStencilAttachment",[nT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new TT}}),iT)),function(t){t[t.FRONT_TO_BACK=0]="FRONT_TO_BACK",t[t.BACK_TO_FRONT=1]="BACK_TO_FRONT"}(yT||(yT={})),Zt(yT);var AT=(sT=nl("RenderQueueDesc"),cT=Bl(yT),lT=Bl([Ee]),sT((fT=q((hT=function(){X(this,"isTransparent",fT,this),X(this,"sortMode",_T,this),X(this,"stages",pT,this)}).prototype,"isTransparent",[cl,yl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),_T=q(hT.prototype,"sortMode",[cT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return yT.FRONT_TO_BACK}}),pT=q(hT.prototype,"stages",[lT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),uT=hT))||uT);function ET(t,e){return t.hash-e.hash||t.depth-e.depth||t.shaderId-e.shaderId}function CT(t,e){return t.hash-e.hash||e.depth-t.depth||t.shaderId-e.shaderId}var bT=function(){function t(t){this.queue=void 0,this._passDesc=void 0,this._passPool=void 0,this._passDesc=t,this._passPool=new Wt((function(){return{hash:0,depth:0,shaderId:0,subModel:null,passIdx:0}}),64),this.queue=new Xt(64,this._passDesc.sortFunc)}var e=t.prototype;return e.clear=function(){this.queue.clear(),this._passPool.reset()},e.insertRenderPass=function(t,e,n){var i=t.model.subModels[e],r=i.passes[n],a=i.shaders[n];if(r.blendState.targets[0].blend!==this._passDesc.isTransparent||!(r.phase&this._passDesc.phases))return!1;var o=0|r.priority<<16|i.priority<<8|n,s=this._passPool.add();return s.hash=o,s.depth=t.depth||0,s.shaderId=a.typedID,s.subModel=i,s.passIdx=n,this.queue.push(s),!0},e.sort=function(){this.queue.sort()},e.recordCommandBuffer=function(t,e,n){for(var i=0;i<this.queue.length;++i){var r=this.queue.array[i],a=r.subModel,o=r.passIdx,s=a.inputAssembler,c=a.passes[o],l=a.shaders[o],u=lv.getOrCreatePipelineState(t,c,l,e,s);n.bindPipelineState(u),n.bindDescriptorSet(Xp.MATERIAL,c.descriptorSet),n.bindDescriptorSet(Xp.LOCAL,a.descriptorSet),n.bindInputAssembler(s),n.draw(s)}},t}();function wT(t){for(var e=0,n=0;n<t.stages.length;n++)e|=Bg(t.stages[n]);var i=ET;switch(t.sortMode){case yT.BACK_TO_FRONT:i=CT;break;case yT.FRONT_TO_BACK:i=ET}return new bT({isTransparent:t.isTransparent,phases:e,sortFunc:i})}function PT(t){t.clear()}function IT(t){t.sort()}var RT=function(){function t(){this.queue=new Set}var e=t.prototype;return e.clear=function(){for(var t=this.queue.values(),e=t.next();!e.done;)e.value.clear(),e=t.next();this.queue.clear()},e.uploadBuffers=function(t){for(var e=this.queue.values(),n=e.next();!n.done;){for(var i=0;i<n.value.batches.length;++i){var r=n.value.batches[i];if(r.mergeCount){for(var a=0;a<r.vbs.length;++a)r.vbs[a].update(r.vbDatas[a]);t.updateBuffer(r.vbIdx,r.vbIdxData.buffer),t.updateBuffer(r.ubo,r.uboData)}}n=e.next()}},e.recordCommandBuffer=function(t,e,n){for(var i=this.queue.values(),r=i.next();!r.done;){for(var a=!1,o=0;o<r.value.batches.length;++o){var s=r.value.batches[o];if(s.mergeCount){if(!a){var c=s.shader,l=lv.getOrCreatePipelineState(t,s.pass,c,e,s.ia);n.bindPipelineState(l),n.bindDescriptorSet(Xp.MATERIAL,s.pass.descriptorSet),a=!0}n.bindDescriptorSet(Xp.LOCAL,s.descriptorSet,r.value.dynamicOffsets),n.bindInputAssembler(s.ia),n.draw(s.ia)}}r=i.next()}},t}(),DT=function(){function t(){this.queue=new Set}var e=t.prototype;return e.clear=function(){for(var t=this.queue.values(),e=t.next();!e.done;)e.value.clear(),e=t.next();this.queue.clear()},e.uploadBuffers=function(t){for(var e=this.queue.values(),n=e.next();!n.done;)n.value.hasPendingModels&&n.value.uploadBuffers(t),n=e.next()},e.recordCommandBuffer=function(t,e,n){for(var i=this.queue.values(),r=i.next();!r.done;){var a=r.value,o=a.instances,s=a.pass;if(a.hasPendingModels){n.bindDescriptorSet(Xp.MATERIAL,s.descriptorSet);for(var c=null,l=0;l<o.length;++l){var u=o[l];if(u.count){var h=u.shader,f=lv.getOrCreatePipelineState(t,s,h,e,u.ia);c!==f&&(n.bindPipelineState(f),c=f),n.bindDescriptorSet(Xp.LOCAL,u.descriptorSet,r.value.dynamicOffsets),n.bindInputAssembler(u.ia),n.draw(u.ia)}}}r=i.next()}},t}(),OT=new jt((function(){return{subModel:null,passIdx:-1,dynamicOffsets:[],lights:[]}}),16),MT=new Float32Array(4),NT=[],LT=[],BT=new Ri,FT=new Ri;function zT(t,e){return!(!e.worldBounds||$s.aabbWithAABB(e.worldBounds,t.aabb))}function UT(t,e){return!(!e.worldBounds||$s.aabbWithAABB(e.worldBounds,t.aabb)&&$s.aabbFrustum(e.worldBounds,t.frustum))}var kT=Bg("forward-add"),GT=[];function HT(t,e){e.length=0;for(var n=!1,i=0;i<t.length;i++){for(var r=t[i].passes,a=-1,o=0;o<r.length;o++)if(r[o].phase===kT){a=o,n=!0;break}e.push(a)}return n}var VT,jT,WT,XT,qT,YT,KT,QT,ZT,JT,$T,tA=function(){function t(t){this._pipeline=void 0,this._device=void 0,this._lightPasses=[],this._shadowUBO=new Float32Array(Jp.COUNT),this._lightBufferCount=16,this._lightBufferStride=void 0,this._lightBufferElementCount=void 0,this._lightBuffer=void 0,this._firstLightBufferView=void 0,this._lightBufferData=void 0,this._instancedQueue=void 0,this._batchedQueue=void 0,this._lightMeterScale=1e4,this._pipeline=t,this._device=t.device,this._instancedQueue=new DT,this._batchedQueue=new RT;var e=this._device.capabilities.uboOffsetAlignment;this._lightBufferStride=Math.ceil(dd.SIZE/e)*e,this._lightBufferElementCount=this._lightBufferStride/Float32Array.BYTES_PER_ELEMENT,this._lightBuffer=this._device.createBuffer(new Ta(Er.UNIFORM|Er.TRANSFER_DST,wr.HOST|wr.DEVICE,this._lightBufferStride*this._lightBufferCount,this._lightBufferStride)),this._firstLightBufferView=this._device.createBuffer(new Aa(this._lightBuffer,0,dd.SIZE)),this._lightBufferData=new Float32Array(this._lightBufferElementCount*this._lightBufferCount)}var e=t.prototype;return e.clear=function(){this._instancedQueue.clear(),this._batchedQueue.clear();for(var t=0;t<this._lightPasses.length;t++){var e=this._lightPasses[t];e.dynamicOffsets.length=0,e.lights.length=0}OT.freeArray(this._lightPasses),this._lightPasses.length=0},e.destroy=function(){for(var t=this._pipeline.globalDSManager.descriptorSetMap,e=t.keys,n=0;n<e.length;n++){var i=e[n],r=t.get(i);r&&(r.getBuffer(Jp.BINDING).destroy(),r.getTexture($p).destroy(),r.getTexture(cd).destroy(),r.destroy()),t.delete(i)}},e.gatherLightPasses=function(t,e){this.clear();var n=this._pipeline.pipelineSceneData.validPunctualLights;if(n.length){this._updateUBOs(t,e),this._updateLightDescriptorSet(t,e);for(var i=this._pipeline.pipelineSceneData.renderObjects,r=0;r<i.length;r++){var a=i[r].model,o=a.subModels;if(HT(o,GT)&&(LT.length=0,this._lightCulling(a,n),LT.length))for(var s=0;s<o.length;s++){var c=GT[s];if(!(c<0)){var l=o[s],u=l.passes[c];l.passes[0].blendState.targets[0].blend||(l.descriptorSet.bindBuffer(dd.BINDING,this._firstLightBufferView),l.descriptorSet.update(),this._addRenderQueue(u,l,a,c))}}}this._instancedQueue.uploadBuffers(e),this._batchedQueue.uploadBuffers(e)}},e.recordCommandBuffer=function(t,e,n){this._instancedQueue.recordCommandBuffer(t,e,n),this._batchedQueue.recordCommandBuffer(t,e,n);for(var i=this._pipeline.globalDSManager,r=0;r<this._lightPasses.length;r++){var a=this._lightPasses[r],o=a.subModel,s=a.passIdx,c=a.dynamicOffsets,l=a.lights,u=o.passes[s],h=o.shaders[s],f=o.inputAssembler,_=lv.getOrCreatePipelineState(t,u,h,e,f),p=u.descriptorSet,d=o.descriptorSet;n.bindPipelineState(_),n.bindDescriptorSet(Xp.MATERIAL,p),n.bindInputAssembler(f);for(var m=0;m<c.length;++m){var g=l[m],v=i.getOrCreateDescriptorSet(g);NT[0]=c[m],n.bindDescriptorSet(Xp.GLOBAL,v),n.bindDescriptorSet(Xp.LOCAL,d,NT),n.draw(f)}}},e._lightCulling=function(t,e){for(var n=0;n<e.length;n++){var i=e[n],r=!1;switch(i.type){case Mv.SPHERE:r=zT(i,t);break;case Mv.SPOT:r=UT(i,t)}r||LT.push(n)}},e._addRenderQueue=function(t,e,n,i){var r=t.batchingScheme;if(r===Og.INSTANCING)for(var a=0;a<LT.length;a++){var o=LT[a],s=t.getInstancedBuffer(o);s.merge(e,n.instancedAttributes,i),s.dynamicOffsets[0]=this._lightBufferStride*o,this._instancedQueue.queue.add(s)}else if(r===Og.VB_MERGING)for(var c=0;c<LT.length;c++){var l=LT[c],u=t.getBatchedBuffer(l);u.merge(e,i,n),u.dynamicOffsets[0]=this._lightBufferStride*l,this._batchedQueue.queue.add(u)}else{var h=OT.alloc();h.subModel=e,h.passIdx=i;for(var f=0;f<LT.length;f++){var _=LT[f];h.lights.push(_),h.dynamicOffsets.push(this._lightBufferStride*_)}this._lightPasses.push(h)}},e._updateLightDescriptorSet=function(t,e){for(var n=this._pipeline.device,i=this._pipeline.pipelineSceneData,r=i.shadows,a=i.shadowFrameBufferMap,o=t.scene.mainLight,s=tm(n)?0:1,c=this._pipeline.globalDSManager,l=i.validPunctualLights,u=0;u<l.length;u++){var h=l[u],f=c.getOrCreateDescriptorSet(u);if(f){var _=void 0,p=void 0;switch(h.type){case Mv.SPHERE:o&&(Fy(r,o,this._shadowUBO),zy(r,this._shadowUBO)),this._shadowUBO[Jp.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+0]=r.size.x,this._shadowUBO[Jp.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+1]=r.size.y,this._shadowUBO[Jp.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+2]=r.pcf,this._shadowUBO[Jp.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+3]=r.bias,this._shadowUBO[Jp.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+0]=2,this._shadowUBO[Jp.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+1]=s,this._shadowUBO[Jp.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+2]=r.normalBias,this._shadowUBO[Jp.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+3]=0,_i.toArray(this._shadowUBO,r.shadowColor,Jp.SHADOW_COLOR_OFFSET);break;case Mv.SPOT:if(o&&(Fy(r,o,this._shadowUBO),zy(r,this._shadowUBO)),Ri.invert(BT,h.node.getWorldMatrix()),Ri.perspective(FT,h.angle,h.aspect,.001,h.range),_=FT.clone(),p=FT.clone().invert(),Ri.multiply(FT,FT,BT),Ri.toArray(this._shadowUBO,BT,Jp.MAT_LIGHT_VIEW_OFFSET),Ri.toArray(this._shadowUBO,FT,Jp.MAT_LIGHT_VIEW_PROJ_OFFSET),this._shadowUBO[Jp.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET+0]=.01,this._shadowUBO[Jp.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET+1]=h.range,this._shadowUBO[Jp.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET+2]=0,this._shadowUBO[Jp.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET+3]=1-r.saturation,this._shadowUBO[Jp.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+0]=r.size.x,this._shadowUBO[Jp.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+1]=r.size.y,this._shadowUBO[Jp.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+2]=r.pcf,this._shadowUBO[Jp.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+3]=r.bias,this._shadowUBO[Jp.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+0]=1,this._shadowUBO[Jp.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+1]=s,this._shadowUBO[Jp.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+2]=r.normalBias,this._shadowUBO[Jp.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+3]=0,this._shadowUBO[Jp.SHADOW_PROJ_DEPTH_INFO_OFFSET+0]=_.m10,this._shadowUBO[Jp.SHADOW_PROJ_DEPTH_INFO_OFFSET+1]=_.m14,this._shadowUBO[Jp.SHADOW_PROJ_DEPTH_INFO_OFFSET+2]=_.m11,this._shadowUBO[Jp.SHADOW_PROJ_DEPTH_INFO_OFFSET+3]=_.m15,this._shadowUBO[Jp.SHADOW_INV_PROJ_DEPTH_INFO_OFFSET+0]=p.m10,this._shadowUBO[Jp.SHADOW_INV_PROJ_DEPTH_INFO_OFFSET+1]=p.m14,this._shadowUBO[Jp.SHADOW_INV_PROJ_DEPTH_INFO_OFFSET+2]=p.m11,this._shadowUBO[Jp.SHADOW_INV_PROJ_DEPTH_INFO_OFFSET+3]=p.m15,this._shadowUBO[Jp.SHADOW_PROJ_INFO_OFFSET+0]=_.m00,this._shadowUBO[Jp.SHADOW_PROJ_INFO_OFFSET+1]=_.m05,this._shadowUBO[Jp.SHADOW_PROJ_INFO_OFFSET+2]=1/_.m00,this._shadowUBO[Jp.SHADOW_PROJ_INFO_OFFSET+3]=1/_.m05,_i.toArray(this._shadowUBO,r.shadowColor,Jp.SHADOW_COLOR_OFFSET),a.has(h)){var d,m=null===(d=a.get(h))||void 0===d?void 0:d.colorTextures[0];m&&f.bindTexture(cd,m)}}f.update(),e.updateBuffer(f.getBuffer(Jp.BINDING),this._shadowUBO)}}},e._updateUBOs=function(t,e){var n=t.exposure,i=this._pipeline.pipelineSceneData,r=i.isHDR,a=i.shadows,o=i.validPunctualLights;o.length>this._lightBufferCount&&(this._firstLightBufferView.destroy(),this._lightBufferCount=ai(o.length),this._lightBuffer.resize(this._lightBufferStride*this._lightBufferCount),this._lightBufferData=new Float32Array(this._lightBufferElementCount*this._lightBufferCount),this._firstLightBufferView.initialize(new Aa(this._lightBuffer,0,dd.SIZE)));for(var s=0,c=0;s<o.length;s++,c+=this._lightBufferElementCount){var l=o[s];switch(l.type){case Mv.SPHERE:if(di.toArray(MT,l.position),MT[3]=0,this._lightBufferData.set(MT,c+dd.LIGHT_POS_OFFSET),MT[0]=l.size,MT[1]=l.range,MT[2]=0,MT[3]=a.enabled&&a.type===Pv.ShadowMap?1:0,this._lightBufferData.set(MT,c+dd.LIGHT_SIZE_RANGE_ANGLE_OFFSET),di.toArray(MT,l.color),l.useColorTemperature){var u=l.colorTemperatureRGB;MT[0]*=u.x,MT[1]*=u.y,MT[2]*=u.z}MT[3]=r?l.luminance*n*this._lightMeterScale:l.luminance,this._lightBufferData.set(MT,c+dd.LIGHT_COLOR_OFFSET);break;case Mv.SPOT:if(di.toArray(MT,l.position),MT[3]=1,this._lightBufferData.set(MT,c+dd.LIGHT_POS_OFFSET),MT[0]=l.size,MT[1]=l.range,MT[2]=l.spotAngle,MT[3]=a.enabled&&a.type===Pv.ShadowMap?1:0,this._lightBufferData.set(MT,c+dd.LIGHT_SIZE_RANGE_ANGLE_OFFSET),di.toArray(MT,l.direction),this._lightBufferData.set(MT,c+dd.LIGHT_DIR_OFFSET),di.toArray(MT,l.color),l.useColorTemperature){var h=l.colorTemperatureRGB;MT[0]*=h.x,MT[1]*=h.y,MT[2]*=h.z}MT[3]=r?l.luminance*n*this._lightMeterScale:l.luminance,this._lightBufferData.set(MT,c+dd.LIGHT_COLOR_OFFSET)}}e.updateBuffer(this._lightBuffer,this._lightBufferData)},t}(),eA=new Mc,nA=function(){function t(t){this._pendingModels=[],this._castModels=[],this._instancedQueue=new DT,this._pipeline=void 0,this._pipeline=t}var e=t.prototype;return e.gatherShadowPasses=function(t,e){var n=this._pipeline.pipelineSceneData,i=(this._pipeline.pipelineUBO,n.shadows);if(this._instancedQueue.clear(),this._pendingModels.length=0,this._castModels.length=0,i.enabled&&i.type===Pv.Planar&&!(i.normal.length()<1e-6)){var r=t.scene,a=t.frustum,o=0!=(t.visibility&Np.BitMask.DEFAULT);if(r.mainLight&&o){for(var s=r.models,c=0;c<s.length;c++){var l=s[c];l.enabled&&l.node&&l.castShadow&&this._castModels.push(l)}var u=i.instancingMaterial.passes[0].getInstancedBuffer();this._instancedQueue.queue.add(u);for(var h=0;h<this._castModels.length;h++){var f=this._castModels[h];if(!f.worldBounds||(Mc.transform(eA,f.worldBounds,i.matLight),$s.aabbFrustum(eA,a)))if(f.isInstancingEnabled)for(var _=f.subModels,p=0;p<_.length;p++){var d=_[p];u.merge(d,f.instancedAttributes,0,d.planarInstanceShader)}else this._pendingModels.push(f)}this._instancedQueue.uploadBuffers(e)}}},e.recordCommandBuffer=function(t,e,n){var i=this._pipeline.pipelineSceneData.shadows;if(i.enabled&&i.type===Pv.Planar&&(this._instancedQueue.recordCommandBuffer(t,e,n),this._pendingModels.length)){var r=i.material.passes[0],a=r.descriptorSet;n.bindDescriptorSet(Xp.MATERIAL,a);for(var o=this._pendingModels.length,s=0;s<o;s++)for(var c=this._pendingModels[s],l=0;l<c.subModels.length;l++){var u=c.subModels[l],h=u.planarShader,f=u.inputAssembler,_=lv.getOrCreatePipelineState(t,r,h,e,f);n.bindPipelineState(_),n.bindDescriptorSet(Xp.LOCAL,u.descriptorSet),n.bindInputAssembler(f),n.draw(f)}}},t}(),iA=function(){function t(){this._phaseID=Bg("default")}var e=t.prototype;return e.activate=function(t){this._pipeline=t},e.render=function(t,e){for(var n=this._pipeline,i=n.device,r=n.commandBuffers[0],a=t.scene.batches,o=0;o<a.length;o++){var s=a[o],c=!1;if(t.visibility&s.visFlags&&(c=!0),c)for(var l=s.shaders.length,u=0;u<l;u++){var h=s.passes[u];if(h.phase===this._phaseID){var f=s.shaders[u],_=s.inputAssembler,p=lv.getOrCreatePipelineState(i,h,f,e,_);r.bindPipelineState(p),r.bindDescriptorSet(Xp.MATERIAL,h.descriptorSet);var d=s.descriptorSet;r.bindDescriptorSet(Xp.LOCAL,d),r.bindInputAssembler(_),r.draw(_)}}}},t}(),rA=[new va(0,0,0,1)],aA=t("ForwardStage",(VT=nl("ForwardStage"),jT=Bl([AT]),WT=Il(),VT((QT=KT=function(t){function e(){var e;return X(e=t.call(this)||this,"renderQueues",YT,V(e)),e._renderQueues=[],e._renderArea=new ua,e._batchedQueue=void 0,e._instancedQueue=void 0,e._phaseID=Bg("default"),e._clearFlag=4294967295,e._batchedQueue=new RT,e._instancedQueue=new DT,e._uiPhase=new iA,e}F(e,t);var n=e.prototype;return n.initialize=function(e){return t.prototype.initialize.call(this,e),e.renderQueues&&(this.renderQueues=e.renderQueues),!0},n.activate=function(e,n){t.prototype.activate.call(this,e,n);for(var i=0;i<this.renderQueues.length;i++)this._renderQueues[i]=wT(this.renderQueues[i]);this._additiveLightQueue=new tA(this._pipeline),this._planarQueue=new nA(this._pipeline),this._uiPhase.activate(e)},n.destroy=function(){},n.render=function(t){this._instancedQueue.clear(),this._batchedQueue.clear();var e=this._pipeline,n=e.device;this._renderQueues.forEach(PT);for(var i=e.pipelineSceneData.renderObjects,r=0,a=0,o=0,s=0;s<i.length;++s){var c=i[s],l=c.model.subModels;for(r=0;r<l.length;++r){var u=l[r],h=u.passes;for(a=0;a<h.length;++a){var f=h[a];if(f.phase===this._phaseID){var _=f.batchingScheme;if(_===Og.INSTANCING){var p=f.getInstancedBuffer();p.merge(u,c.model.instancedAttributes,a),this._instancedQueue.queue.add(p)}else if(_===Og.VB_MERGING){var d=f.getBatchedBuffer();d.merge(u,a,c.model),this._batchedQueue.queue.add(d)}else for(o=0;o<this._renderQueues.length;o++)this._renderQueues[o].insertRenderPass(c,r,a)}}}}this._renderQueues.forEach(IT);var m=e.commandBuffers[0];e.pipelineUBO.updateShadowUBO(t),this._instancedQueue.uploadBuffers(m),this._batchedQueue.uploadBuffers(m),this._additiveLightQueue.gatherLightPasses(t,m),this._planarQueue.gatherShadowPasses(t,m),t.clearFlag&na.COLOR&&(rA[0].x=t.clearColor.x,rA[0].y=t.clearColor.y,rA[0].z=t.clearColor.z,rA[0].w=t.clearColor.w),e.generateRenderArea(t,this._renderArea);var g=t.window.framebuffer,v=e.getRenderPass(t.clearFlag&this._clearFlag,g);m.beginRenderPass(v,g,this._renderArea,rA,t.clearDepth,t.clearStencil),m.bindDescriptorSet(Xp.GLOBAL,e.descriptorSet),this._renderQueues[0].recordCommandBuffer(n,v,m),this._instancedQueue.recordCommandBuffer(n,v,m),this._batchedQueue.recordCommandBuffer(n,v,m),this._additiveLightQueue.recordCommandBuffer(n,v,m),m.bindDescriptorSet(Xp.GLOBAL,e.descriptorSet),this._planarQueue.recordCommandBuffer(n,v,m),this._renderQueues[1].recordCommandBuffer(n,v,m),this._uiPhase.render(t,v),Ev(n,v,m,e.profiler,t),m.endRenderPass()},e}(yx),KT.initInfo={name:"ForwardStage",priority:Ox.FORWARD,tag:0,renderQueues:[{isTransparent:!1,sortMode:yT.FRONT_TO_BACK,stages:["default"]},{isTransparent:!0,sortMode:yT.BACK_TO_FRONT,stages:["default","planarShadow"]}]},YT=q((qT=QT).prototype,"renderQueues",[jT,cl,WT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),XT=qT))||XT)),oA=t("ForwardFlow",nl("ForwardFlow")(($T=JT=function(t){function e(){return t.apply(this,arguments)||this}F(e,t);var n=e.prototype;return n.initialize=function(e){if(t.prototype.initialize.call(this,e),0===this._stages.length){var n=new aA;n.initialize(aA.initInfo),this._stages.push(n)}return!0},n.activate=function(e){t.prototype.activate.call(this,e)},n.render=function(e){t.prototype.render.call(this,e)},n.destroy=function(){t.prototype.destroy.call(this)},e}(Sx),JT.initInfo={name:zp,priority:Mx.FORWARD,stages:[]},ZT=$T))||ZT),sA=new Ri,cA=new Ri,lA=new Ri,uA=new Mc,hA=Bg("shadow-caster"),fA=[];function _A(t,e){e.length=0;for(var n=!1,i=0;i<t.length;i++){for(var r=t[i].passes,a=-1,o=0;o<r.length;o++)if(r[o].phase===hA){a=o,n=!0;break}e.push(a)}return n}var pA,dA,mA,gA,vA,yA,xA=function(){function t(t){this._pipeline=void 0,this._subModelsArray=[],this._passArray=[],this._shaderArray=[],this._instancedQueue=void 0,this._batchedQueue=void 0,this._pipeline=t,this._instancedQueue=new DT,this._batchedQueue=new RT}var e=t.prototype;return e.gatherLightPasses=function(t,e,n,i){this.clear();var r=this._pipeline.pipelineSceneData,a=r.shadows;if(n&&a.enabled&&a.type===Pv.ShadowMap){var o=r.dirShadowObjects,s=r.castShadowObjects;switch(n.type){case Mv.DIRECTIONAL:for(var c=0;c<o.length;c++){var l=o[c].model;_A(l.subModels,fA)&&this.add(l,fA)}break;case Mv.SPOT:Ri.invert(sA,n.node.getWorldMatrix()),Ri.perspective(cA,n.angle,n.aspect,.001,n.range),Ri.multiply(lA,cA,sA);for(var u=0;u<s.length;u++){var h=s[u].model;_A(h.subModels,fA)&&(h.worldBounds&&(Mc.transform(uA,h.worldBounds,lA),!$s.aabbFrustum(uA,e.frustum))||this.add(h,fA))}}this._instancedQueue.uploadBuffers(i),this._batchedQueue.uploadBuffers(i)}},e.clear=function(){this._subModelsArray.length=0,this._shaderArray.length=0,this._passArray.length=0,this._instancedQueue.clear(),this._batchedQueue.clear()},e.add=function(t,e){for(var n=t.subModels,i=0;i<n.length;i++){var r=n[i],a=e[i],o=r.passes[a];if(o.batchingScheme===Og.INSTANCING){var s=o.getInstancedBuffer();s.merge(r,t.instancedAttributes,a),this._instancedQueue.queue.add(s)}else if(o.batchingScheme===Og.VB_MERGING){var c=o.getBatchedBuffer();c.merge(r,a,t),this._batchedQueue.queue.add(c)}else{var l=r.shaders[a];this._subModelsArray.push(r),l&&this._shaderArray.push(l),this._passArray.push(o)}}},e.recordCommandBuffer=function(t,e,n){this._instancedQueue.recordCommandBuffer(t,e,n),this._batchedQueue.recordCommandBuffer(t,e,n);for(var i=0;i<this._subModelsArray.length;++i){var r=this._subModelsArray[i],a=this._shaderArray[i],o=this._passArray[i],s=r.inputAssembler,c=lv.getOrCreatePipelineState(t,o,a,e,s),l=o.descriptorSet;n.bindPipelineState(c),n.bindDescriptorSet(Xp.MATERIAL,l),n.bindDescriptorSet(Xp.LOCAL,r.descriptorSet),n.bindInputAssembler(s),n.draw(s)}},t}(),SA=[new va(1,1,1,1)],TA=t("ShadowStage",nl("ShadowStage")((mA=dA=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._shadowFrameBuffer=null,e._renderArea=new ua,e._light=null,e._globalDS=null,e}F(e,t);var n=e.prototype;return n.setUsage=function(t,e,n){this._globalDS=t,this._light=e,this._shadowFrameBuffer=n},n.destroy=function(){var t;this._shadowFrameBuffer=null,this._globalDS=null,this._light=null,null===(t=this._additiveShadowQueue)||void 0===t||t.clear()},n.clearFramebuffer=function(t){if(this._light&&this._shadowFrameBuffer){SA[0].w=t.clearColor.w;var e=this._pipeline.commandBuffers[0],n=this._shadowFrameBuffer.renderPass;e.beginRenderPass(n,this._shadowFrameBuffer,this._renderArea,SA,t.clearDepth,t.clearStencil),e.endRenderPass()}},n.render=function(t){var e=this._pipeline,n=e.pipelineSceneData,i=n.shadows,r=n.shadingScale,a=this._globalDS,o=e.commandBuffers[0];if(this._light&&this._shadowFrameBuffer){this._pipeline.pipelineUBO.updateShadowUBOLight(a,this._light),this._additiveShadowQueue.gatherLightPasses(a,t,this._light,o);var s=t.viewport,c=i.size;this._renderArea.x=s.x*c.x,this._renderArea.y=s.y*c.y,this._renderArea.width=s.width*c.x*r,this._renderArea.height=s.height*c.y*r;var l=e.device,u=this._shadowFrameBuffer.renderPass;o.beginRenderPass(u,this._shadowFrameBuffer,this._renderArea,SA,t.clearDepth,t.clearStencil),o.bindDescriptorSet(Xp.GLOBAL,a),this._additiveShadowQueue.recordCommandBuffer(l,u,o),o.endRenderPass()}},n.activate=function(e,n){t.prototype.activate.call(this,e,n),this._additiveShadowQueue=new xA(e)},e}(yx),dA.initInfo={name:"ShadowStage",priority:Ox.FORWARD,tag:0},pA=mA))||pA),AA=[],EA=t("ShadowFlow",nl("ShadowFlow")((yA=vA=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._shadowRenderPass=null,e}F(e,t);var n=e.prototype;return n.initialize=function(e){if(t.prototype.initialize.call(this,e),0===this._stages.length){var n=new TA;n.initialize(TA.initInfo),this._stages.push(n)}return!0},n.render=function(t){var e=this._pipeline,n=e.pipelineSceneData.shadows,i=e.pipelineSceneData.shadowFrameBufferMap,r=e.pipelineSceneData.castShadowObjects,a=this._pipeline.pipelineSceneData.validPunctualLights;if(n.enabled&&n.type===Pv.ShadowMap){for(var o=0,s=0;o<n.maxReceived&&s<a.length;){var c=a[s];c.type===Mv.SPOT&&(AA.push(c),o++),s++}if(0!==r.length){n.shadowMapDirty&&this.resizeShadowMap();var l=t.scene.mainLight;if(l){var u=e.descriptorSet;i.has(l)||this._initShadowFrameBuffer(e,l,t.window.swapchain);for(var h=i.get(l),f=0;f<this._stages.length;f++){var _=this._stages[f];_.setUsage(u,l,h),_.render(t)}}for(var p=0;p<AA.length;p++){var d=AA[p],m=e.globalDSManager.getOrCreateDescriptorSet(p);i.has(d)||this._initShadowFrameBuffer(e,d,t.window.swapchain);for(var g=i.get(d),v=0;v<this._stages.length;v++){var y=this._stages[v];y.setUsage(m,d,g),y.render(t)}}AA.length=0}else this.clearShadowMap(AA,t)}},n.destroy=function(){if(t.prototype.destroy.call(this),this._pipeline){for(var e=this._pipeline.pipelineSceneData.shadowFrameBufferMap,n=Array.from(e.values()),i=0;i<n.length;i++){var r=n[i];if(r){for(var a=r.colorTextures,o=0;o<a.length;o++){var s=a[i];s&&s.destroy()}a.length=0;var c=r.depthStencilTexture;c&&c.destroy(),r.destroy()}}e.clear()}this._shadowRenderPass&&this._shadowRenderPass.destroy()},n._initShadowFrameBuffer=function(t,e){var n=t.device,i=t.pipelineSceneData.shadows.size,r=t.pipelineSceneData.shadowFrameBufferMap,a=tm(n)?Sr.R32F:Sr.RGBA8;if(!this._shadowRenderPass){var o=new Ha;o.format=a,o.loadOp=Gr.CLEAR,o.storeOp=Hr.STORE,o.sampleCount=1;var s=new Va;s.format=Sr.DEPTH_STENCIL,s.depthLoadOp=Gr.CLEAR,s.depthStoreOp=Hr.DISCARD,s.stencilLoadOp=Gr.CLEAR,s.stencilStoreOp=Hr.DISCARD,s.sampleCount=1;var c=new Xa([o],s);this._shadowRenderPass=n.createRenderPass(c)}var l=[];l.push(n.createTexture(new wa(Pr.TEX2D,Ir.COLOR_ATTACHMENT|Ir.SAMPLED,a,i.x,i.y)));var u=n.createTexture(new wa(Pr.TEX2D,Ir.DEPTH_STENCIL_ATTACHMENT,Sr.DEPTH_STENCIL,i.x,i.y)),h=n.createFramebuffer(new Ka(this._shadowRenderPass,l,u));r.set(e,h)},n.clearShadowMap=function(t,e){var n=this._pipeline,i=n.pipelineSceneData,r=e.scene.mainLight;if(r){var a=this._pipeline.descriptorSet;i.shadowFrameBufferMap.has(r)||this._initShadowFrameBuffer(this._pipeline,r,e.window.swapchain);for(var o=i.shadowFrameBufferMap.get(r),s=0;s<this._stages.length;s++){var c=this._stages[s];c.setUsage(a,r,o),c.render(e)}}for(var l=0;l<t.length;l++){var u=t[l],h=i.shadowFrameBufferMap.get(u),f=n.globalDSManager.getOrCreateDescriptorSet(l);if(i.shadowFrameBufferMap.has(u))for(var _=0;_<this._stages.length;_++){var p=this._stages[_];p.setUsage(f,u,h),p.clearFramebuffer(e)}}},n.resizeShadowMap=function(){for(var t=this._pipeline.pipelineSceneData.shadows,e=t.size,n=this._pipeline,i=n.device,r=n.pipelineSceneData.shadowFrameBufferMap,a=tm(i)?Sr.R32F:Sr.RGBA8,o=r.values(),s=o.next();!s.done;){var c=s.value;if(c){var l=[];l.push(n.device.createTexture(new wa(Pr.TEX2D,Ir.COLOR_ATTACHMENT|Ir.SAMPLED,a,e.x,e.y)));var u=c.depthStencilTexture;u&&u.resize(e.x,e.y);var h=c.renderPass;c.destroy(),c.initialize(new Ka(h,l,u)),s=o.next()}else s=o.next()}t.shadowMapDirty=!1},e}(Sx),vA.initInfo={name:Up,priority:Mx.SHADOW,tag:dT.SCENE,stages:[]},gA=yA))||gA),CA=new zi,bA=Yt({LINEAR:0,EXP:1,EXP_SQUARED:2,LAYERED:3}),wA=bA.LAYERED+1,PA=function(){function t(){this._fogColor=new _i("#C8C8C8"),this._colorArray=new zi(.2,.2,.2,1),this._enabled=!1,this._accurate=!1,this._type=0,this._fogDensity=.3,this._fogStart=.5,this._fogEnd=300,this._fogAtten=5,this._fogTop=1.5,this._fogRange=1.2}var e=t.prototype;return e._setType=function(t){this._type=this.enabled?t:wA},e._setEnable=function(t){this._enabled=t},e._setAccurate=function(t){this._accurate=t},e.initialize=function(t){this.fogColor=t.fogColor,this._setEnable(t.enabled),this._setAccurate(t.accurate),this._setType(t.type),this.fogDensity=t.fogDensity,this.fogStart=t.fogStart,this.fogEnd=t.fogEnd,this.fogAtten=t.fogAtten,this.fogTop=t.fogTop,this.fogRange=t.fogRange},e.activate=function(){this._updatePipeline()},e._updatePipeline=function(){var t=i.director.root,e=this.enabled?this.type:wA,n=this.accurate?1:0,r=t.pipeline;r.macros.CC_USE_FOG===e&&r.macros.CC_USE_ACCURATE_FOG===n||(r.macros.CC_USE_FOG=e,r.macros.CC_USE_ACCURATE_FOG=n,t.onGlobalPipelineStateChanged())},e._destroy=function(){},e.destroy=function(){this._destroy()},L(t,[{key:"enabled",get:function(){return this._enabled},set:function(t){this._setEnable(t),t?this.activate():(this._type=wA,this._updatePipeline())}},{key:"accurate",get:function(){return this._accurate},set:function(t){this._setAccurate(t),this._updatePipeline()}},{key:"fogColor",get:function(){return this._fogColor},set:function(t){this._fogColor.set(t),CA.set(t.x,t.y,t.z,t.w),fv(this._colorArray,CA)}},{key:"type",get:function(){return this._type},set:function(t){this._setType(t),this.enabled&&this._updatePipeline()}},{key:"fogDensity",get:function(){return this._fogDensity},set:function(t){this._fogDensity=t}},{key:"fogStart",get:function(){return this._fogStart},set:function(t){this._fogStart=t}},{key:"fogEnd",get:function(){return this._fogEnd},set:function(t){this._fogEnd=t}},{key:"fogAtten",get:function(){return this._fogAtten},set:function(t){this._fogAtten=t}},{key:"fogTop",get:function(){return this._fogTop},set:function(t){this._fogTop=t}},{key:"fogRange",get:function(){return this._fogRange},set:function(t){this._fogRange=t}},{key:"colorArray",get:function(){return this._colorArray}},{key:"native",get:function(){return this._nativeObj}}]),t}();function IA(t,e){for(var n,i=W(e);!(n=i()).done;){var r=n.value;Array.isArray(r)?IA(t,r):t.push(r)}}function RA(t){var e=[];return IA(e,t),e.join("")}i.Fog=PA;var DA=Ye.Flags.Destroyed,OA=Ye.Flags.PersistentMask,MA=Ge.IDENTIFIER_RE,NA="var ",LA="o",BA={"cc.ClickEvent":!1,"cc.PrefabInfo":!1},FA=Ge.escapeForJS,zA=function(){function t(t,e){this.varName=void 0,this.expression=void 0,this.varName=t,this.expression=e}return t.prototype.toString=function(){return NA+this.varName+"="+this.expression+";"},t}();function UA(t,e){return e instanceof zA?new zA(e.varName,t+e.expression):t+e}function kA(t,e,n){Array.isArray(n)?(n[0]=UA(e,n[0]),t.push(n)):t.push(UA(e,n)+";")}var GA=function(){function t(t){this._exps=void 0,this._targetExp=void 0,this._exps=[],this._targetExp=t}var e=t.prototype;return e.append=function(t,e){this._exps.push([t,e])},e.writeCode=function(t){var e;if(this._exps.length>1)t.push("t="+this._targetExp+";"),e="t";else{if(1!==this._exps.length)return;e=this._targetExp}for(var n=0;n<this._exps.length;n++){var i=this._exps[n];kA(t,e+HA(i[0])+"=",i[1])}},t}();function HA(t){return MA.test(t)?"."+t:"["+FA(t)+"]"}GA.pool=void 0,GA.pool=new Ut((function(t){t._exps.length=0,t._targetExp=null}),1),GA.pool.get=function(t){var e=this._get()||new GA;return e._targetExp=t,e};var VA=function(){function t(t,e){var n;this.parent=void 0,this.objsToClear_iN$t=void 0,this.codeArray=void 0,this.objs=void 0,this.funcs=void 0,this.funcModuleCache=void 0,this.globalVariables=void 0,this.globalVariableId=void 0,this.localVariableId=void 0,this.result=void 0,this.parent=e,this.objsToClear_iN$t=[],this.codeArray=[],this.objs=[],this.funcs=[],this.funcModuleCache=ft(),At(this.funcModuleCache,BA),this.globalVariables=[],this.globalVariableId=0,this.localVariableId=0,this.codeArray.push("var o,t;","if(R){","o=R;","}else{","o=R=new "+this.getFuncModule(t.constructor,!0)+"();","}"),t._iN$t={globalVar:"R"},this.objsToClear_iN$t.push(t),this.enumerateObject(this.codeArray,t),this.globalVariables.length>0&&(n=NA+this.globalVariables.join(",")+";");var i=RA(["return (function(R){",n||[],this.codeArray,"return o;","})"]);this.result=Function("O","F",i)(this.objs,this.funcs);for(var r=0,a=this.objsToClear_iN$t.length;r<a;++r)this.objsToClear_iN$t[r]._iN$t=null;this.objsToClear_iN$t.length=0}var e=t.prototype;return e.getFuncModule=function(t,e){var n=_t(t);if(n){var i=this.funcModuleCache[n];if(i)return i;if(void 0===i){var r=-1!==n.indexOf(".");if(r)try{if(r=t===Function("return "+n)())return this.funcModuleCache[n]=n,n}catch(t){}}}var a=this.funcs.indexOf(t);a<0&&(a=this.funcs.length,this.funcs.push(t));var o="F["+a+"]";return e&&(o="("+o+")"),this.funcModuleCache[n]=o,o},e.getObjRef=function(t){var e=this.objs.indexOf(t);return e<0&&(e=this.objs.length,this.objs.push(t)),"O["+e+"]"},e.setValueType=function(t,e,n,i){var r=GA.pool.get(i),a=e.constructor.__props__;a||(a=Object.keys(e));for(var o=0;o<a.length;o++){var s=a[o],c=n[s];if(e[s]!==c){var l=this.enumerateField(n,s,c);r.append(s,l)}}r.writeCode(t),GA.pool.put(r)},e.enumerateCCClass=function(t,e,n){for(var r=n.__values__,a=ve(n),o=0;o<r.length;o++){var s=r[o],c=e[s],l=a[s+"$_$default"];if(!jA(l,c))if("object"==typeof c&&c instanceof i.ValueType&&(l=Ge.getDefault(l))&&l.constructor===c.constructor){var u=LA+HA(s);this.setValueType(t,l,c,u)}else this.setObjProp(t,e,s,c)}},e.instantiateArray=function(t){if(0===t.length)return"[]";var e="a"+ ++this.localVariableId,n=[new zA(e,"new Array("+t.length+")")];t._iN$t={globalVar:"",source:n},this.objsToClear_iN$t.push(t);for(var i=0;i<t.length;++i)kA(n,e+"["+i+"]=",this.enumerateField(t,i,t[i]));return n},e.instantiateTypedArray=function(t){var e=t.constructor.name;if(0===t.length)return"new "+e;var n="a"+ ++this.localVariableId,i=[new zA(n,"new "+e+"("+t.length+")")];t._iN$t={globalVar:"",source:i},this.objsToClear_iN$t.push(t);for(var r=0;r<t.length;++r)0!==t[r]&&kA(i,n+"["+r+"]=",t[r]);return i},e.enumerateField=function(t,e,n){if("object"==typeof n&&n){var i=n._iN$t;if(i){var r=i.globalVar;if(!r){r=i.globalVar="v"+ ++this.globalVariableId,this.globalVariables.push(r);var a=i.source[0];i.source[0]=UA(r+"=",a)}return r}return ArrayBuffer.isView(n)?this.instantiateTypedArray(n):Array.isArray(n)?this.instantiateArray(n):this.instantiateObj(n)}return"function"==typeof n?this.getFuncModule(n):"string"==typeof n?FA(n):("_objFlags"===e&&t instanceof Ye&&(n&=OA),n)},e.setObjProp=function(t,e,n,i){kA(t,LA+HA(n)+"=",this.enumerateField(e,n,i))},e.enumerateObject=function(t,e){var n=e.constructor;if(i.Class._isCCClass(n))this.enumerateCCClass(t,e,n);else for(var r in e)if(e.hasOwnProperty(r)&&(95!==r.charCodeAt(0)||95!==r.charCodeAt(1)||"__type__"===r)){var a=e[r];"object"==typeof a&&a&&a===e._iN$t||this.setObjProp(t,e,r,a)}},e.instantiateObj=function(t){if(t instanceof i.ValueType)return Ge.getNewValueTypeCode(t);if(t instanceof i.Asset)return this.getObjRef(t);if(t._objFlags&DA)return null;var e,n=t.constructor;if(i.Class._isCCClass(n)){if(this.parent)if(this.parent instanceof i.Component){if(t instanceof i._BaseNode||t instanceof i.Component)return this.getObjRef(t)}else if(this.parent instanceof i._BaseNode)if(t instanceof i._BaseNode){if(!t.isChildOf(this.parent))return this.getObjRef(t)}else if(t instanceof i.Component){var r;if(!(null===(r=t.node)||void 0===r?void 0:r.isChildOf(this.parent)))return this.getObjRef(t)}e=new zA(LA,"new "+this.getFuncModule(n,!0)+"()")}else if(n===Object)e=new zA(LA,"{}");else{if(n)return this.getObjRef(t);e=new zA(LA,"Object.create(null)")}var a=[e];return t._iN$t={globalVar:"",source:a},this.objsToClear_iN$t.push(t),this.enumerateObject(a,t),["(function(){",a,"return o;})();"]},t}();function jA(t,e){if("function"==typeof t)try{t=t()}catch(t){return!1}if(t===e)return!0;if(t&&e&&"object"==typeof t&&"object"==typeof e&&t.constructor===e.constructor)if(t instanceof i.ValueType){if(t.equals(e))return!0}else{if(Array.isArray(t))return 0===t.length&&0===e.length;if(t.constructor===Object)return ot(t)&&ot(e)}return!1}var WA,XA,qA,YA,KA,QA,ZA,JA,$A,tE,eE=function(){function t(t){this._uiComp=null,this._opacity=1,this._localOpacity=1,this.colorDirty=!0,this._uiTransformComp=null,this._node=void 0,this._node=t}return t.prototype.applyOpacity=function(t){this._opacity=this._localOpacity*t},t.markOpacityTree=function(){},L(t,[{key:"uiTransformComp",get:function(){return this._uiTransformComp||(this._uiTransformComp=this._node.getComponent("cc.UITransform")),this._uiTransformComp},set:function(t){this._uiTransformComp=t}},{key:"uiComp",get:function(){return this._uiComp},set:function(t){this._uiComp&&t?E(12002):this._uiComp=t}},{key:"opacity",get:function(){return this._opacity}},{key:"localOpacity",get:function(){return this._localOpacity},set:function(t){this._localOpacity=t,this.colorDirty=!0}}]),t}();Ye.Flags.Destroying,function(t){t.TOUCH_START="touch-start",t.TOUCH_MOVE="touch-move",t.TOUCH_END="touch-end",t.TOUCH_CANCEL="touch-cancel",t.MOUSE_DOWN="mouse-down",t.MOUSE_MOVE="mouse-move",t.MOUSE_UP="mouse-up",t.MOUSE_WHEEL="mouse-wheel",t.MOUSE_ENTER="mouse-enter",t.MOUSE_LEAVE="mouse-leave",t.KEY_DOWN="keydown",t.KEY_UP="keyup",t.DEVICEMOTION="devicemotion",t.TRANSFORM_CHANGED="transform-changed",t.SCENE_CHANGED_FOR_PERSISTS="scene-changed-for-persists",t.SIZE_CHANGED="size-changed",t.ANCHOR_CHANGED="anchor-changed",t.COLOR_CHANGED="color-changed",t.CHILD_ADDED="child-added",t.CHILD_REMOVED="child-removed",t.PARENT_CHANGED="parent-changed",t.NODE_DESTROYED="node-destroyed",t.LAYER_CHANGED="layer-changed",t.SIBLING_ORDER_CHANGED="sibling-order-changed",t.ACTIVE_IN_HIERARCHY_CHANGED="active-in-hierarchy-changed"}(WA||(WA={}));var nE=Ye.Flags.Destroying,iE=Ye.Flags.DontDestroy,rE=Ye.Flags.Deactivating,aE=new tt("Node");function oE(t){return t?"string"==typeof t?Ft(t):t:(b(3804),null)}var sE,cE,lE,uE,hE,fE,_E,pE,dE,mE,gE,vE=t("BaseNode",nl("cc.BaseNode")((tE=$A=function(t){F(n,t),n._setScene=function(t){t._updateScene()},n._findComponent=function(t,e){var n=e,i=t._components;if(n._sealed)for(var r=0;r<i.length;++r){var a=i[r];if(a.constructor===e)return a}else for(var o=0;o<i.length;++o){var s=i[o];if(s instanceof e)return s}return null},n._findComponents=function(t,e,n){var i=e,r=t._components;if(i._sealed)for(var a=0;a<r.length;++a){var o=r[a];o.constructor===e&&n.push(o)}else for(var s=0;s<r.length;++s){var c=r[s];c instanceof e&&n.push(c)}},n._findChildComponent=function(t,e){for(var i=0;i<t.length;++i){var r=t[i],a=n._findComponent(r,e);if(a)return a;if(r._children.length>0&&(a=n._findChildComponent(r._children,e)))return a}return null},n._findChildComponents=function(t,e,i){for(var r=0;r<t.length;++r){var a=t[r];n._findComponents(a,e,i),a._children.length>0&&n._findChildComponents(a._children,e,i)}};var e=n.prototype;function n(e){var n;return X(n=t.call(this,e)||this,"_parent",YA,V(n)),X(n,"_children",KA,V(n)),X(n,"_active",QA,V(n)),X(n,"_components",ZA,V(n)),X(n,"_prefab",JA,V(n)),n._scene=null,n._activeInHierarchy=!1,n._id=aE.getNewId(),n._name=void 0,n._eventProcessor=new i.NodeEventProcessor(V(n)),n._eventMask=0,n._siblingIndex=0,n._originalSceneId="",n._registerIfAttached=void 0,n._name=void 0!==e?e:"New Node",n}return e._updateScene=function(){null==this._parent?d("Node %s(%s) has not attached to a scene.",this.name,this.uuid):this._scene=this._parent._scene},e.attr=function(t){At(this,t)},e.getParent=function(){return this._parent},e.setParent=function(t,e){if(void 0===e&&(e=!1),this._parent!==t){var n=this._parent,i=t;if(this._parent=i,this._siblingIndex=0,this._onSetParent(n,e),this.emit&&this.emit(WA.PARENT_CHANGED,n),n&&!(n._objFlags&nE)){var r=n._children.indexOf(this);n._children.splice(r,1),n._updateSiblingIndex(),n.emit&&n.emit(WA.CHILD_REMOVED,this)}i&&(i._children.push(this),this._siblingIndex=i._children.length-1,i.emit&&i.emit(WA.CHILD_ADDED,this)),this._onHierarchyChanged(n)}},e.getChildByUuid=function(t){if(!t)return _("Invalid uuid"),null;for(var e=this._children,n=0,i=e.length;n<i;n++)if(e[n]._id===t)return e[n];return null},e.getChildByName=function(t){if(!t)return _("Invalid name"),null;for(var e=this._children,n=0,i=e.length;n<i;n++)if(e[n]._name===t)return e[n];return null},e.getChildByPath=function(t){for(var e=t.split("/"),n=this,i=function(t){var i=e[t];if(0===i.length)return"continue";var r=n.children.find((function(t){return t.name===i}));if(!r)return{v:null};n=r},r=0;r<e.length;++r){var a=i(r);if("continue"!==a&&"object"==typeof a)return a.v}return n},e.addChild=function(t){t.setParent(this)},e.insertChild=function(t,e){t.parent=this,t.setSiblingIndex(e)},e.getSiblingIndex=function(){return this._siblingIndex},e.setSiblingIndex=function(t){if(this._parent)if(this._parent._objFlags&rE)b(3821);else{var e=this._parent._children;t=-1!==t?t:e.length-1;var n=e.indexOf(this);t!==n&&(e.splice(n,1),t<e.length?e.splice(t,0,this):e.push(this),this._parent._updateSiblingIndex(),this._onSiblingIndexChanged&&this._onSiblingIndexChanged(t))}},e.walk=function(t,e){var i=1,r=null,a=null,o=0,s=n._stacks[n._stackId];s||(s=[],n._stacks.push(s)),n._stackId++,s.length=0,s[0]=this;for(var c=null,l=!1;i;)if(a=s[--i])if(!l&&t?t(a):l&&e&&e(a),s[i]=null,l){if(c===this._parent)break;if(l=!1,r)if(r[++o])s[i]=r[o],i++;else if(c&&(s[i]=c,i++,l=!0,c._parent?(o=(r=c._parent._children).indexOf(c),c=c._parent):(c=null,r=null),o<0))break}else a._children.length>0?(c=a,r=a._children,o=0,s[i]=r[o],i++):(s[i]=a,i++,l=!0);s.length=0,n._stackId--},e.removeFromParent=function(){this._parent&&this._parent.removeChild(this)},e.removeChild=function(t){this._children.indexOf(t)>-1&&(t.parent=null)},e.removeAllChildren=function(){for(var t=this._children,e=t.length-1;e>=0;e--){var n=t[e];n&&(n.parent=null)}this._children.length=0},e.isChildOf=function(t){var e=this;do{if(e===t)return!0;e=e._parent}while(e);return!1},e.getComponent=function(t){var e=oE(t);return e?n._findComponent(this,e):null},e.getComponents=function(t){var e=oE(t),i=[];return e&&n._findComponents(this,e,i),i},e.getComponentInChildren=function(t){var e=oE(t);return e?n._findChildComponent(this._children,e):null},e.getComponentsInChildren=function(t){var e=oE(t),i=[];return e&&(n._findComponents(this,e,i),n._findChildComponents(this._children,e,i)),i},e.addComponent=function(t){var e;if("string"==typeof t){if(!(e=Ft(t)))throw i._RF.peek()&&b(3808,t),TypeError(R(3807,t))}else{if(!t)throw TypeError(R(3804));e=t}if("function"!=typeof e)throw TypeError(R(3809));if(!bt(e,i.Component))throw TypeError(R(3810));var n=e._requireComponent;if(n)if(Array.isArray(n))for(var r=0;r<n.length;r++){var a=n[r];this.getComponent(a)||this.addComponent(a)}else{var o=n;this.getComponent(o)||this.addComponent(o)}var s=new e;return s.node=this,this._components.push(s),this._activeInHierarchy&&i.director._nodeActivator.activateComp(s),s},e.removeComponent=function(t){if(t){var e=null;(e=t instanceof $u?t:this.getComponent(t))&&e.destroy()}else b(3813)},e.on=function(t,e,n,i){switch(void 0===i&&(i=!1),t){case WA.TRANSFORM_CHANGED:this._eventMask|=1}this._eventProcessor.on(t,e,n,i)},e.off=function(t,e,n,i){if(void 0===i&&(i=!1),this._eventProcessor.off(t,e,n,i),!this._eventProcessor.hasEventListener(t))switch(t){case WA.TRANSFORM_CHANGED:this._eventMask&=-2}},e.once=function(t,e,n,i){this._eventProcessor.once(t,e,n,i)},e.emit=function(t,e,n,i,r,a){this._eventProcessor.emit(t,e,n,i,r,a)},e.dispatchEvent=function(t){this._eventProcessor.dispatchEvent(t)},e.hasEventListener=function(t,e,n){return this._eventProcessor.hasEventListener(t,e,n)},e.targetOff=function(t){this._eventProcessor.targetOff(t),1&this._eventMask&&!this._eventProcessor.hasEventListener(WA.TRANSFORM_CHANGED)&&(this._eventMask&=-2)},e.destroy=function(){return!!t.prototype.destroy.call(this)&&(this.active=!1,!0)},e.destroyAllChildren=function(){for(var t=this._children,e=0;e<t.length;++e)t[e].destroy()},e._removeComponent=function(t){if(t){if(!(this._objFlags&nE)){var e=this._components.indexOf(t);-1!==e?this._components.splice(e,1):t.node!==this&&b(3815)}}else b(3814)},e._updateSiblingIndex=function(){for(var t=0;t<this._children.length;++t)this._children[t]._siblingIndex=t;this.emit(WA.SIBLING_ORDER_CHANGED)},e._onSetParent=function(t){this._parent&&(null!=t&&t._scene===this._parent._scene||null==this._parent._scene||this.walk(n._setScene))},e._onPostActivated=function(){},e._onBatchCreated=function(){this._parent&&(this._siblingIndex=this._parent.children.indexOf(this))},e._onPreDestroy=function(){this._onPreDestroyBase()},e._onHierarchyChanged=function(t){return this._onHierarchyChangedBase(t)},e._instantiate=function(t,e){return t||(t=i.instantiate._clone(this,this)),t._prefab,t._parent=null,t._onBatchCreated(e),t},e._onHierarchyChangedBase=function(){var t=this._parent;!this._persistNode||t instanceof i.Scene||i.game.removePersistRootNode(this);var e=this._active&&!(!t||!t._activeInHierarchy);this._activeInHierarchy!==e&&i.director._nodeActivator.activateNode(this,e)},e._onPreDestroyBase=function(){this._objFlags|=nE;var t=this._parent,e=!!t&&0!=(t._objFlags&nE);if(this._persistNode&&i.game.removePersistRootNode(this),!e&&t){this.emit(WA.PARENT_CHANGED,this);var n=t._children.indexOf(this);t._children.splice(n,1),this._siblingIndex=0,t._updateSiblingIndex(),t.emit&&t.emit(WA.CHILD_REMOVED,this)}this.emit(WA.NODE_DESTROYED,this),this._eventProcessor.destroy();for(var r=this._children,a=0;a<r.length;++a)r[a]._destroyImmediate();for(var o=this._components,s=0;s<o.length;++s)o[s]._destroyImmediate();return e},L(n,[{key:"components",get:function(){return this._components}},{key:"_persistNode",get:function(){return(this._objFlags&iE)>0},set:function(t){t?this._objFlags|=iE:this._objFlags&=~iE}},{key:"name",get:function(){return this._name},set:function(t){this._name=t}},{key:"uuid",get:function(){return this._id}},{key:"children",get:function(){return this._children}},{key:"active",get:function(){return this._active},set:function(t){if(this._active!==t){this._active=t;var e=this._parent;e&&e._activeInHierarchy&&i.director._nodeActivator.activateNode(this,t)}}},{key:"activeInHierarchy",get:function(){return this._activeInHierarchy}},{key:"parent",get:function(){return this._parent},set:function(t){this.setParent(t)}},{key:"scene",get:function(){return this._scene}},{key:"eventProcessor",get:function(){return this._eventProcessor}}]),n}(Ye),$A.idGenerator=aE,$A._stacks=[[]],$A._stackId=0,q((qA=tE).prototype,"_persistNode",[ol],Object.getOwnPropertyDescriptor(qA.prototype,"_persistNode"),qA.prototype),q(qA.prototype,"name",[yl],Object.getOwnPropertyDescriptor(qA.prototype,"name"),qA.prototype),q(qA.prototype,"children",[yl],Object.getOwnPropertyDescriptor(qA.prototype,"children"),qA.prototype),q(qA.prototype,"active",[yl],Object.getOwnPropertyDescriptor(qA.prototype,"active"),qA.prototype),q(qA.prototype,"activeInHierarchy",[yl],Object.getOwnPropertyDescriptor(qA.prototype,"activeInHierarchy"),qA.prototype),q(qA.prototype,"parent",[yl],Object.getOwnPropertyDescriptor(qA.prototype,"parent"),qA.prototype),YA=q(qA.prototype,"_parent",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),KA=q(qA.prototype,"_children",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),QA=q(qA.prototype,"_active",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),ZA=q(qA.prototype,"_components",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),JA=q(qA.prototype,"_prefab",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),XA=qA))||XA);i._BaseNode=vE;var yE=new di,xE=new Ti,SE=new Ti,TE=new Ti,AE=new yi,EE=new yi,CE=new Ri,bE=[],wE=[],PE=[],IE=function(){function t(){this._chunks=[],this._freelists=[],this._createChunk()}var e=t.prototype;return e.alloc=function(){for(var t=this._freelists.length,e=0;e<t;++e)if(this._freelists[e].length)return this._createView(e);return this._createChunk(),this._createView(t)},e.free=function(t,e){for(var n=this._freelists.length,i=0;i<n;++i)if(this._chunks[i]===t)return void this._freelists[i].push(e)},e.clear=function(){for(var t=this._chunks.length,e=0;e<t;++e)this._chunks[e].fill(0)},e._createChunk=function(){this._chunks.push(new Uint32Array(t.CAPACITY_PER_CHUNK));for(var e=[],n=t.CAPACITY_PER_CHUNK-1;n>=0;n--)e.push(n);this._freelists.push(e)},e._createView=function(t){return PE[0]=this._chunks[t],PE[1]=this._freelists[t].pop(),PE},t}();IE.CAPACITY_PER_CHUNK=256;var RE,DE,OE,ME,NE,LE,BE,FE,zE,UE,kE,GE,HE,VE,jE,WE,XE,qE,YE,KE,QE,ZE,JE,$E,tC,eC,nC,iC,rC,aC,oC,sC,cC,lC,uC,hC,fC,_C,pC,dC,mC,gC,vC,yC,xC,SC,TC,AC,EC,CC,bC,wC,PC,IC,RC,DC,OC,MC,NC,LC,BC,FC,zC,UC,kC,GC,HC,VC,jC,WC=new IE,XC=Symbol("ReserveContentsForAllSyncablePrefab"),qC=t("Node",(sE=nl("cc.Node"),cE=Bl(di),sE((gE=mE=function(t){F(n,t);var e=n.prototype;function n(e){var n;return(n=t.call(this,e)||this)._uiProps=new eE(V(n)),n._static=!1,X(n,"_lpos",hE,V(n)),X(n,"_lrot",fE,V(n)),X(n,"_lscale",_E,V(n)),X(n,"_layer",pE,V(n)),X(n,"_euler",dE,V(n)),n._dirtyFlagsPri=Kg.NONE,n._eulerDirty=!1,n._nodeHandle=0,n._init(),n}return e._init=function(){var t=WC.alloc(),e=t[0],n=t[1];this._hasChangedFlagsChunk=e,this._hasChangedFlagsOffset=n;var i=new Uint32Array(e.buffer,e.byteOffset+4*n,1);this._hasChangedFlags=i,this._pos=new di,this._rot=new Ti,this._scale=new di(1,1,1),this._mat=new Ri},n.isNode=function(t){return t instanceof n&&(t.constructor===n||!(t instanceof i.Scene))},e._onPreDestroy=function(){var t=this._onPreDestroyBase();return WC.free(this._hasChangedFlagsChunk,this._hasChangedFlagsOffset),t},e[uh]=function(t){t.writeThis()},e.setParent=function(e,n){void 0===n&&(n=!1),n&&this.updateWorldTransform(),t.prototype.setParent.call(this,e,n)},e._onSetParent=function(e,n){if(t.prototype._onSetParent.call(this,e,n),n){var i=this._parent;i?(i.updateWorldTransform(),Ri.multiply(CE,Ri.invert(CE,i._mat),this._mat),Ri.toRTS(CE,this._lrot,this._lpos,this._lscale)):(di.copy(this._lpos,this._pos),Ti.copy(this._lrot,this._rot),di.copy(this._lscale,this._scale)),this._eulerDirty=!0}this.invalidateChildren(Kg.TRS)},e._onHierarchyChanged=function(e){this.eventProcessor.reattach(),t.prototype._onHierarchyChangedBase.call(this,e)},e._onBatchCreated=function(t){this.hasChangedFlags=Kg.TRS,this._dirtyFlags|=Kg.TRS;for(var e=this._children.length,n=0;n<e;++n)this._children[n]._siblingIndex=n,this._children[n]._onBatchCreated(t)},e._onBeforeSerialize=function(){this.eulerAngles},e._onPostActivated=function(t){t?(this._eventProcessor.setEnabled(!0),this.invalidateChildren(Kg.TRS),this._uiProps&&this._uiProps.uiComp&&(this._uiProps.uiComp.setNodeDirty(),this._uiProps.uiComp.setTextureDirty(),this._uiProps.uiComp.markForUpdateRenderData())):this._eventProcessor.setEnabled(!1)},e.translate=function(t,e){var n=e||Yg.LOCAL;if(n===Yg.LOCAL)di.transformQuat(yE,t,this._lrot),this._lpos.x+=yE.x,this._lpos.y+=yE.y,this._lpos.z+=yE.z;else if(n===Yg.WORLD)if(this._parent){Ti.invert(xE,this._parent.worldRotation),di.transformQuat(yE,t,xE);var i=this.worldScale;this._lpos.x+=yE.x/i.x,this._lpos.y+=yE.y/i.y,this._lpos.z+=yE.z/i.z}else this._lpos.x+=t.x,this._lpos.y+=t.y,this._lpos.z+=t.z;this.invalidateChildren(Kg.POSITION),1&this._eventMask&&this.emit(WA.TRANSFORM_CHANGED,Kg.POSITION)},e.rotate=function(t,e){var n=e||Yg.LOCAL;if(Ti.normalize(xE,t),n===Yg.LOCAL)Ti.multiply(this._lrot,this._lrot,xE);else if(n===Yg.WORLD){var i=this.worldRotation;Ti.multiply(SE,xE,i),Ti.invert(xE,i),Ti.multiply(SE,xE,SE),Ti.multiply(this._lrot,this._lrot,SE)}this._eulerDirty=!0,this.invalidateChildren(Kg.ROTATION),1&this._eventMask&&this.emit(WA.TRANSFORM_CHANGED,Kg.ROTATION)},e.lookAt=function(t,e){this.getWorldPosition(yE),di.subtract(yE,yE,t),di.normalize(yE,yE),Ti.fromViewUp(xE,yE,e),this.setWorldRotation(xE)},e._setDirtyNode=function(t,e){bE[t]=e},e.invalidateChildren=function(t){var e,n,i,r=0,a=0,o=0,s=0,c=0,l=t|Kg.POSITION;for(bE[0]=this;r>=0;){if(c=(e=bE[r--])._hasChangedFlags[0],s=e._dirtyFlagsPri,e.isValid&&(s&c&t)!==t)for(s|=t,e._dirtyFlagsPri=s,e._hasChangedFlags[0]=c|t,o=(i=e._children).length,a=0;a<o;a++)n=i[a],bE[++r]=n;t=l}},e.updateWorldTransform=function(){if(this._dirtyFlags){for(var t,e=this,n=0;e&&e._dirtyFlags;)this._setDirtyNode(n++,e),e=e._parent;for(var i=0;n;)i|=(t=bE[--n])._dirtyFlags,e?(i&Kg.POSITION&&(di.transformMat4(t._pos,t._lpos,e._mat),t._mat.m12=t._pos.x,t._mat.m13=t._pos.y,t._mat.m14=t._pos.z),i&Kg.RS&&(Ri.fromRTS(t._mat,t._lrot,t._lpos,t._lscale),Ri.multiply(t._mat,e._mat,t._mat),i&Kg.ROTATION&&Ti.multiply(t._rot,e._rot,t._lrot),yi.fromQuat(AE,Ti.conjugate(TE,t._rot)),yi.multiplyMat4(AE,AE,t._mat),t._scale.x=AE.m00,t._scale.y=AE.m04,t._scale.z=AE.m08)):(i&Kg.POSITION&&(di.copy(t._pos,t._lpos),t._mat.m12=t._pos.x,t._mat.m13=t._pos.y,t._mat.m14=t._pos.z),i&Kg.RS&&(i&Kg.ROTATION&&Ti.copy(t._rot,t._lrot),i&Kg.SCALE&&(di.copy(t._scale,t._lscale),Ri.fromRTS(t._mat,t._rot,t._pos,t._scale)))),t._dirtyFlags=Kg.NONE,e=t}},e.setPosition=function(t,e,n){void 0===e&&void 0===n?di.copy(this._lpos,t):void 0===n?di.set(this._lpos,t,e,this._lpos.z):di.set(this._lpos,t,e,n),this.invalidateChildren(Kg.POSITION),1&this._eventMask&&this.emit(WA.TRANSFORM_CHANGED,Kg.POSITION)},e.getPosition=function(t){return t?di.set(t,this._lpos.x,this._lpos.y,this._lpos.z):di.copy(new di,this._lpos)},e.setRotation=function(t,e,n,i){void 0===e||void 0===n||void 0===i?Ti.copy(this._lrot,t):Ti.set(this._lrot,t,e,n,i),this._eulerDirty=!0,this.invalidateChildren(Kg.ROTATION),1&this._eventMask&&this.emit(WA.TRANSFORM_CHANGED,Kg.ROTATION)},e.setRotationFromEuler=function(t,e,n){var i=void 0===n?this._euler.z:n;void 0===e?(di.copy(this._euler,t),Ti.fromEuler(this._lrot,t.x,t.y,t.z)):(di.set(this._euler,t,e,i),Ti.fromEuler(this._lrot,t,e,i)),this._eulerDirty=!1,this.invalidateChildren(Kg.ROTATION),1&this._eventMask&&this.emit(WA.TRANSFORM_CHANGED,Kg.ROTATION)},e.getRotation=function(t){return t?Ti.set(t,this._lrot.x,this._lrot.y,this._lrot.z,this._lrot.w):Ti.copy(new Ti,this._lrot)},e.setScale=function(t,e,n){void 0===e&&void 0===n?di.copy(this._lscale,t):void 0===n?di.set(this._lscale,t,e,this._lscale.z):di.set(this._lscale,t,e,n),this.invalidateChildren(Kg.SCALE),1&this._eventMask&&this.emit(WA.TRANSFORM_CHANGED,Kg.SCALE)},e.getScale=function(t){return t?di.set(t,this._lscale.x,this._lscale.y,this._lscale.z):di.copy(new di,this._lscale)},e.inverseTransformPoint=function(t,e){di.copy(t,e);for(var n=this,i=0;n._parent;)this._setDirtyNode(i++,n),n=n._parent;for(;i>=0;)di.transformInverseRTS(t,t,n._lrot,n._lpos,n._lscale),n=bE[--i];return t},e.setWorldPosition=function(t,e,n){void 0===e||void 0===n?di.copy(this._pos,t):di.set(this._pos,t,e,n);var i=this._parent,r=this._lpos;i?(i.updateWorldTransform(),di.transformMat4(r,this._pos,Ri.invert(CE,i._mat))):di.copy(r,this._pos),this.invalidateChildren(Kg.POSITION),1&this._eventMask&&this.emit(WA.TRANSFORM_CHANGED,Kg.POSITION)},e.getWorldPosition=function(t){return this.updateWorldTransform(),t?di.copy(t,this._pos):di.copy(new di,this._pos)},e.setWorldRotation=function(t,e,n,i){void 0===e||void 0===n||void 0===i?Ti.copy(this._rot,t):Ti.set(this._rot,t,e,n,i),this._parent?(this._parent.updateWorldTransform(),Ti.multiply(this._lrot,Ti.conjugate(this._lrot,this._parent._rot),this._rot)):Ti.copy(this._lrot,this._rot),this._eulerDirty=!0,this.invalidateChildren(Kg.ROTATION),1&this._eventMask&&this.emit(WA.TRANSFORM_CHANGED,Kg.ROTATION)},e.setWorldRotationFromEuler=function(t,e,n){Ti.fromEuler(this._rot,t,e,n),this._parent?(this._parent.updateWorldTransform(),Ti.multiply(this._lrot,Ti.conjugate(this._lrot,this._parent._rot),this._rot)):Ti.copy(this._lrot,this._rot),this._eulerDirty=!0,this.invalidateChildren(Kg.ROTATION),1&this._eventMask&&this.emit(WA.TRANSFORM_CHANGED,Kg.ROTATION)},e.getWorldRotation=function(t){return this.updateWorldTransform(),t?Ti.copy(t,this._rot):Ti.copy(new Ti,this._rot)},e.setWorldScale=function(t,e,n){void 0===e||void 0===n?di.copy(this._scale,t):di.set(this._scale,t,e,n);var i=this._parent;i?(i.updateWorldTransform(),yi.fromQuat(AE,Ti.conjugate(TE,i._rot)),yi.multiplyMat4(AE,AE,i._mat),EE.m00=this._scale.x,EE.m04=this._scale.y,EE.m08=this._scale.z,yi.multiply(AE,EE,yi.invert(AE,AE)),this._lscale.x=di.set(yE,AE.m00,AE.m01,AE.m02).length(),this._lscale.y=di.set(yE,AE.m03,AE.m04,AE.m05).length(),this._lscale.z=di.set(yE,AE.m06,AE.m07,AE.m08).length()):di.copy(this._lscale,this._scale),this.invalidateChildren(Kg.SCALE),1&this._eventMask&&this.emit(WA.TRANSFORM_CHANGED,Kg.SCALE)},e.getWorldScale=function(t){return this.updateWorldTransform(),t?di.copy(t,this._scale):di.copy(new di,this._scale)},e.getWorldMatrix=function(t){this.updateWorldTransform();var e=t||new Ri;return Ri.copy(e,this._mat)},e.getWorldRS=function(t){this.updateWorldTransform();var e=t||new Ri;return Ri.copy(e,this._mat),e.m12=0,e.m13=0,e.m14=0,e},e.getWorldRT=function(t){this.updateWorldTransform();var e=t||new Ri;return Ri.fromRT(e,this._rot,this._pos)},e.setRTS=function(t,e,n){var i=0;t&&(i|=Kg.ROTATION,void 0!==t.w?(Ti.copy(this._lrot,t),this._eulerDirty=!0):(di.copy(this._euler,t),Ti.fromEuler(this._lrot,t.x,t.y,t.z),this._eulerDirty=!1)),e&&(di.copy(this._lpos,e),i|=Kg.POSITION),n&&(di.copy(this._lscale,n),i|=Kg.SCALE),i&&(this.invalidateChildren(i),1&this._eventMask&&this.emit(WA.TRANSFORM_CHANGED,i))},e.pauseSystemEvents=function(t){this._eventProcessor.setEnabled(!1,t)},e.resumeSystemEvents=function(t){this._eventProcessor.setEnabled(!0,t)},n.resetHasChangedFlags=function(){WC.clear()},n.clearNodeArray=function(){n.ClearFrame<n.ClearRound?n.ClearFrame++:(n.ClearFrame=0,bE.length=0,wE.length=0)},L(n,[{key:"_dirtyFlags",get:function(){return this._dirtyFlagsPri},set:function(t){this._dirtyFlagsPri=t}},{key:"native",get:function(){return this._nativeObj}},{key:"position",get:function(){return this._lpos},set:function(t){this.setPosition(t)}},{key:"worldPosition",get:function(){return this.updateWorldTransform(),this._pos},set:function(t){this.setWorldPosition(t)}},{key:"rotation",get:function(){return this._lrot},set:function(t){this.setRotation(t)}},{key:"eulerAngles",get:function(){return this._eulerDirty&&(Ti.toEuler(this._euler,this._lrot),this._eulerDirty=!1),this._euler},set:function(t){this.setRotationFromEuler(t.x,t.y,t.z)}},{key:"angle",get:function(){return this._euler.z},set:function(t){di.set(this._euler,0,0,t),Ti.fromAngleZ(this._lrot,t),this._eulerDirty=!1,this.invalidateChildren(Kg.ROTATION),1&this._eventMask&&this.emit(WA.TRANSFORM_CHANGED,Kg.ROTATION)}},{key:"worldRotation",get:function(){return this.updateWorldTransform(),this._rot},set:function(t){this.setWorldRotation(t)}},{key:"scale",get:function(){return this._lscale},set:function(t){this.setScale(t)}},{key:"worldScale",get:function(){return this.updateWorldTransform(),this._scale},set:function(t){this.setWorldScale(t)}},{key:"matrix",set:function(t){Ri.toRTS(t,this._lrot,this._lpos,this._lscale),this.invalidateChildren(Kg.TRS),this._eulerDirty=!0,1&this._eventMask&&this.emit(WA.TRANSFORM_CHANGED,Kg.TRS)}},{key:"worldMatrix",get:function(){return this.updateWorldTransform(),this._mat}},{key:"forward",get:function(){return di.transformQuat(new di,di.FORWARD,this.worldRotation)},set:function(t){var e=t.length();di.multiplyScalar(yE,t,-1/e),Ti.fromViewUp(xE,yE),this.setWorldRotation(xE)}},{key:"up",get:function(){return di.transformQuat(new di,di.UP,this.worldRotation)}},{key:"right",get:function(){return di.transformQuat(new di,di.RIGHT,this.worldRotation)}},{key:"layer",get:function(){return this._layer},set:function(t){this._layer=t,this._uiProps&&this._uiProps.uiComp&&(this._uiProps.uiComp.setNodeDirty(),this._uiProps.uiComp.markForUpdateRenderData()),this.emit(WA.LAYER_CHANGED,this._layer)}},{key:"hasChangedFlags",get:function(){return this._hasChangedFlagsChunk[this._hasChangedFlagsOffset]},set:function(t){this._hasChangedFlagsChunk[this._hasChangedFlagsOffset]=t}}]),n}(vE),mE.EventType=WA,mE.NodeSpace=Yg,mE.TransformDirtyBit=Kg,mE.TransformBit=Kg,mE.reserveContentsForAllSyncablePrefabTag=XC,mE.ClearFrame=0,mE.ClearRound=1e3,hE=q((uE=gE).prototype,"_lpos",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new di}}),fE=q(uE.prototype,"_lrot",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ti}}),_E=q(uE.prototype,"_lscale",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new di(1,1,1)}}),pE=q(uE.prototype,"_layer",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Np.Enum.DEFAULT}}),dE=q(uE.prototype,"_euler",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new di}}),q(uE.prototype,"eulerAngles",[cE],Object.getOwnPropertyDescriptor(uE.prototype,"eulerAngles"),uE.prototype),q(uE.prototype,"angle",[yl],Object.getOwnPropertyDescriptor(uE.prototype,"angle"),uE.prototype),q(uE.prototype,"layer",[yl],Object.getOwnPropertyDescriptor(uE.prototype,"layer"),uE.prototype),lE=uE))||lE));i.Node=qC;var YC=nl("cc.TargetInfo")((OE=q((DE=function(){X(this,"localID",OE,this)}).prototype,"localID",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),RE=DE))||RE,KC=(ME=nl("cc.TargetOverrideInfo"),NE=Bl(Ye),LE=Bl(YC),BE=Bl(qC),FE=Bl(YC),ME((kE=q((UE=function(){X(this,"source",kE,this),X(this,"sourceInfo",GE,this),X(this,"propertyPath",HE,this),X(this,"target",VE,this),X(this,"targetInfo",jE,this)}).prototype,"source",[cl,NE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),GE=q(UE.prototype,"sourceInfo",[cl,LE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),HE=q(UE.prototype,"propertyPath",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),VE=q(UE.prototype,"target",[cl,BE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),jE=q(UE.prototype,"targetInfo",[cl,FE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),zE=UE))||zE),QC=nl("cc.CompPrefabInfo")((qE=q((XE=function(){X(this,"fileId",qE,this)}).prototype,"fileId",[cl,yl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),WE=XE))||WE,ZC=(YE=nl("CCPropertyOverrideInfo"),KE=Bl(YC),YE((eC=function(){function t(){X(this,"targetInfo",JE,this),X(this,"propertyPath",$E,this),X(this,"value",tC,this)}return t.prototype.isTarget=function(){},t}(),JE=q((ZE=eC).prototype,"targetInfo",[cl,KE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$E=q(ZE.prototype,"propertyPath",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),tC=q(ZE.prototype,"value",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),QE=ZE))||QE),JC=(nC=nl("cc.MountedChildrenInfo"),iC=Bl(YC),rC=Bl([qC]),nC((lC=function(){function t(){X(this,"targetInfo",sC,this),X(this,"nodes",cC,this)}return t.prototype.isTarget=function(){},t}(),sC=q((oC=lC).prototype,"targetInfo",[cl,iC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),cC=q(oC.prototype,"nodes",[cl,rC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),aC=oC))||aC),$C=(uC=nl("cc.MountedComponentsInfo"),hC=Bl(YC),fC=Bl([$u]),uC((gC=function(){function t(){X(this,"targetInfo",dC,this),X(this,"components",mC,this)}return t.prototype.isTarget=function(){},t}(),dC=q((pC=gC).prototype,"targetInfo",[cl,hC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),mC=q(pC.prototype,"components",[cl,fC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),_C=pC))||_C),tb=(vC=nl("cc.PrefabInstance"),yC=Bl(qC),xC=Bl([JC]),SC=Bl([$C]),TC=Bl([ZC]),AC=Bl([YC]),vC((OC=function(){function t(){X(this,"fileId",bC,this),X(this,"prefabRootNode",wC,this),X(this,"mountedChildren",PC,this),X(this,"mountedComponents",IC,this),X(this,"propertyOverrides",RC,this),X(this,"removedComponents",DC,this),this.targetMap={}}var e=t.prototype;return e.findPropertyOverride=function(){},e.removePropertyOverride=function(){},t}(),bC=q((CC=OC).prototype,"fileId",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),wC=q(CC.prototype,"prefabRootNode",[cl,yC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PC=q(CC.prototype,"mountedChildren",[cl,xC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),IC=q(CC.prototype,"mountedComponents",[cl,SC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),RC=q(CC.prototype,"propertyOverrides",[cl,TC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),DC=q(CC.prototype,"removedComponents",[cl,AC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),EC=CC))||EC),eb=(MC=nl("cc.PrefabInfo"),NC=Bl(qC),LC=Bl(tb),BC=Bl([KC]),MC((UC=q((zC=function(){X(this,"root",UC,this),X(this,"asset",kC,this),X(this,"fileId",GC,this),X(this,"instance",HC,this),X(this,"targetOverrides",VC,this),X(this,"nestedPrefabInstanceRoots",jC,this)}).prototype,"root",[cl,NC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kC=q(zC.prototype,"asset",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GC=q(zC.prototype,"fileId",[cl,yl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),HC=q(zC.prototype,"instance",[cl,LC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VC=q(zC.prototype,"targetOverrides",[cl,BC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jC=q(zC.prototype,"nestedPrefabInstanceRoots",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FC=zC))||FC);function nb(t){var e=t._prefab;if(e&&e.instance){if(!e.asset)return b(3701,t.name),void(e.instance=void 0);var n=t._objFlags,r=t._parent,a=t._id,o=t._prefab;t[We],i.game._isCloning=!0,e.asset._doInstantiate(t),i.game._isCloning=!1,t._objFlags=n,t._parent=r,t._id=a,t._prefab&&(t._prefab.instance=null==o?void 0:o.instance)}}function ib(t,e,n){var i;if(e&&t){var r=e,a=null===(i=t._prefab)||void 0===i?void 0:i.instance;!n&&a&&(e[a.fileId]={},r=e[a.fileId]);var o=t._prefab;o&&(r[o.fileId]=t);for(var s=t.components,c=0;c<s.length;c++){var l=s[c];l.__prefab&&(r[l.__prefab.fileId]=l)}for(var u=0;u<t.children.length;u++)ib(t.children[u],r,!1)}}function rb(t,e){if(!t)return null;for(var n=e,i=0;i<t.length;i++){if(!n)return null;n=n[t[i]]}return n}function ab(t,e,n){if(e)for(var i=0;i<e.length;i++){var r=e[i];if(r&&r.targetInfo){var a=rb(r.targetInfo.localID,n);if(!a)continue;var o=n,s=r.targetInfo.localID;if(s.length>0)for(var c=0;c<s.length-1;c++)o=o[s[c]];if(r.nodes)for(var l=0;l<r.nodes.length;l++){var u=r.nodes[l];u&&(a._children.push(u),u._parent=a,ib(u,o,!1),u._siblingIndex=a._children.length-1,ub(u,!0))}}}}function ob(t,e,n){if(e)for(var i=0;i<e.length;i++){var r=e[i];if(r&&r.targetInfo){var a=rb(r.targetInfo.localID,n);if(!a)continue;if(r.components)for(var o=0;o<r.components.length;o++){var s=r.components[o];s&&(s.node=a,a._components.push(s))}}}}function sb(t,e,n){if(e)for(var i=0;i<e.length;i++){var r=e[i];if(r){var a=rb(r.localID,n);if(!a||!a.node)continue;var o=a.node.components.indexOf(a);o>=0&&a.node._components.splice(o,1)}}}function cb(t,e,n){if(!(e.length<=0))for(var i=null,r=0;r<e.length;r++){var a=e[r];if(a&&a.targetInfo){if(!(i=rb(a.targetInfo.localID,n)))continue;var o=i,s=a.propertyPath.slice();if(s.length>0){var c=s.pop();if(!c)continue;for(var l=0;l<s.length&&(o=o[s[l]]);l++);if(!o)continue;if(Array.isArray(o))if("length"===c)o[c]=a.value;else{var u=Number.parseInt(c);Number.isInteger(u)&&u<o.length&&(o[c]=a.value)}else o[c]instanceof Jt?o[c].set(a.value):o[c]=a.value}}}}function lb(t){var e,n=null===(e=t._prefab)||void 0===e?void 0:e.targetOverrides;if(n)for(var i=0;i<n.length;i++){var r,a,o=n[i],s=o.source,c=o.sourceInfo;if(c){var l,u,h=null===(l=o.source)||void 0===l||null===(u=l._prefab)||void 0===u?void 0:u.instance;h&&h.targetMap&&(s=rb(c.localID,h.targetMap))}if(s){var f,_=o.targetInfo;if(_){var p=null===(r=o.target)||void 0===r||null===(a=r._prefab)||void 0===a?void 0:a.instance;if(p&&p.targetMap&&(f=rb(_.localID,p.targetMap))){var d=o.propertyPath.slice(),m=s;if(d.length>0){var g=d.pop();if(!g)return;for(var v=0;v<d.length&&(m=m[d[v]]);v++);if(!m)continue;m[g]=f}}}}}}function ub(t,e){void 0===e&&(e=!1);var n=t._prefab,i=null==n?void 0:n.instance;if(i){nb(t);var r={};i.targetMap=r,ib(t,r,!0),ab(0,i.mountedChildren,r),sb(0,i.removedComponents,r),ob(0,i.mountedComponents,r),cb(0,i.propertyOverrides,r)}e&&t&&t.children&&t.children.forEach((function(t){ub(t,!0)}))}function hb(t){var e=t._prefab;e&&e.nestedPrefabInstanceRoots&&e.nestedPrefabInstanceRoots.forEach((function(t){ub(t)}))}i._PrefabInfo=eb;var fb,_b,pb,db,mb,gb,vb,yb,xb,Sb,Tb,Ab,Eb,Cb,bb=Object.freeze({__proto__:null,TargetInfo:YC,TargetOverrideInfo:KC,CompPrefabInfo:QC,PropertyOverrideInfo:ZC,MountedChildrenInfo:JC,MountedComponentsInfo:$C,PrefabInstance:tb,PrefabInfo:eb,createNodeWithPrefab:nb,generateTargetMap:ib,getTarget:rb,applyMountedChildren:ab,applyMountedComponents:ob,applyRemovedComponents:sb,applyPropertyOverrides:cb,applyTargetOverrides:lb,expandPrefabInstanceNode:ub,expandNestedPrefabInstanceNode:hb}),wb=Yt({AUTO:0,SINGLE_INSTANCE:1,MULTI_INSTANCE:2}),Pb=t("Prefab",nl("cc.Prefab")((vb=gb=function(t){function e(){var e;return X(e=t.call(this)||this,"data",pb,V(e)),X(e,"optimizationPolicy",db,V(e)),X(e,"persistent",mb,V(e)),e._createFunction=void 0,e._instantiatedTimes=void 0,e._createFunction=null,e._instantiatedTimes=0,e}F(e,t);var n=e.prototype;return n.createNode=function(t){var e=i.instantiate(this);e.name=this.name,t(null,e)},n.compileCreateFunction=function(){var t,e;this._createFunction=(e=(t=this.data)instanceof i._BaseNode&&t,new VA(t,e).result)},n._doInstantiate=function(t){return this.data._prefab||E(3700),this._createFunction||this.compileCreateFunction(),this._createFunction(t)},n._instantiate=function(){var t;return this.optimizationPolicy!==wb.SINGLE_INSTANCE&&(this.optimizationPolicy===wb.MULTI_INSTANCE||this._instantiatedTimes+1>=e.OptimizationPolicyThreshold)?(t=this._doInstantiate(),this.data._instantiate(t)):t=this.data._instantiate(),++this._instantiatedTimes,t},n.initDefault=function(e){t.prototype.initDefault.call(this,e),this.data=new qC,this.data.name="(Missing Node)";var n=new i._PrefabInfo;n.asset=this,n.root=this.data,this.data._prefab=n},n.validate=function(){return!!this.data},n.onLoaded=function(){var t=this.data;hb(t),lb(t)},e}(Ou),gb.OptimizationPolicy=wb,gb.OptimizationPolicyThreshold=3,pb=q((_b=vb).prototype,"data",[cl,yl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),db=q(_b.prototype,"optimizationPolicy",[cl,yl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return wb.AUTO}}),mb=q(_b.prototype,"persistent",[cl,yl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),fb=_b))||fb);Gt.value(Pb,"_utils",bb),i.Prefab=Pb,pt(i,"cc._Prefab","Prefab"),t("PrefabLink",(yb=nl("cc.PrefabLink"),xb=Bl(Pb),Sb=xl(),yb((Cb=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return X(e=t.call.apply(t,[this].concat(i))||this,"prefab",Eb,V(e)),e}return F(e,t),e}($u),Eb=q((Ab=Cb).prototype,"prefab",[xb,cl,Sb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Tb=Ab))||Tb));var Ib=new di;function Rb(t,e,n,i){i||(i=new di),t.convertToUINode(e,n,i);var r=n.position;return i.add(r),i}function Db(t,e,n){return n||(n=new di),t.worldToScreen(e,n),n.x/=i.view.getScaleX(),n.y/=i.view.getScaleY(),n}var Ob,Mb,Nb=t("convertUtils",{WorldNode3DToLocalNodeUI:Rb,WorldNode3DToWorldNodeUI:Db});i.pipelineUtils=Nb,Nn(i.pipelineUtils,"cc.pipelineUtils",[{name:"WorldNode3DToLocalNodeUI",newName:"convertToUINode",targetName:"cc.Camera.prototype",customFunction:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var i=e[0],r=e[3]||Ib;return i.convertToUINode(e[1],e[2],r),r.add(e[2].position),e[3]||r.clone()}}]),Ln(Mm.prototype,"TextureBase.prototype",[{name:"hasPremultipliedAlpha"},{name:"setPremultiplyAlpha"},{name:"setFlipY"}]),Nn(vT.prototype,"RenderTexture.prototype",[{name:"getGFXWindow",customFunction:function(){return this._window}}]);var Lb,Bb=t("BufferAsset",nl("cc.BufferAsset")((q((Mb=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._buffer=null,e}F(e,t);var n=e.prototype;return n.buffer=function(){return this._buffer},n.validate=function(){return!!this.buffer},L(e,[{key:"_nativeAsset",get:function(){return this._buffer},set:function(t){t instanceof ArrayBuffer?this._buffer=t:this._buffer=t.buffer}}]),e}(Ou)).prototype,"_nativeAsset",[Xl],Object.getOwnPropertyDescriptor(Mb.prototype,"_nativeAsset"),Mb.prototype),Ob=Mb))||Ob);i.BufferAsset=Bb;var Fb=((Lb={})[Tr.UNORM]="Uint",Lb[Tr.SNORM]="Int",Lb[Tr.UINT]="Uint",Lb[Tr.INT]="Int",Lb[Tr.UFLOAT]="Float",Lb[Tr.FLOAT]="Float",Lb.default="Uint",Lb);function zb(t){return""+(Fb[t.type]||Fb.default)+t.size/t.count*8}function Ub(t,e,n,i,r){void 0===n&&(n=Sr.R32F),void 0===i&&(i=0),void 0===r&&(r=0);var a=lo[n];r||(r=a.size);for(var o="set"+zb(a),s=a.size/a.count,c=Math.floor(e.length/a.count),l=lh.isLittleEndian,u=0;u<c;++u)for(var h=i+r*u,f=0;f<a.count;++f){var _=h+s*f;t[o](_,e[a.count*u+f],l)}}function kb(t,e,n,i,r,a,o){void 0===n&&(n=Sr.R32F),void 0===i&&(i=0),void 0===r&&(r=t.byteLength-i),void 0===a&&(a=0),o||(o=new DataView(t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)));var s=lo[n];a||(a=s.size);for(var c="set"+zb(s),l="get"+zb(s),u=s.size/s.count,h=Math.floor(r/a),f=lh.isLittleEndian,_=0;_<h;++_)for(var p=i+a*_,d=0;d<s.count;++d){var m=p+u*d,g=t[l](m,f);o[c](m,e(g,d,t),f)}return o}var Gb,Hb,Vb=t("RenderingSubMesh",function(){var t=e.prototype;function e(t,e,n,i,r){void 0===i&&(i=null),void 0===r&&(r=null),this.mesh=void 0,this.subMeshIdx=void 0,this._flatBuffers=[],this._jointMappedBuffers=void 0,this._jointMappedBufferIndices=void 0,this._vertexIdChannel=void 0,this._geometricInfo=void 0,this._vertexBuffers=void 0,this._attributes=void 0,this._indexBuffer=null,this._indirectBuffer=null,this._primitiveMode=void 0,this._iaInfo=void 0,this._attributes=e,this._vertexBuffers=t,this._indexBuffer=i,this._indirectBuffer=r,this._primitiveMode=n,this._iaInfo=new Ga(e,t,i,r),this._init()}return t._init=function(){},t.genFlatBuffers=function(){if(!this._flatBuffers.length&&this.mesh&&void 0!==this.subMeshIdx){var t=this.mesh,e=0,n=t.struct.primitives[this.subMeshIdx];n.indexView&&(e=n.indexView.count);for(var i=0;i<n.vertexBundelIndices.length;i++){var r=n.vertexBundelIndices[i],a=t.struct.vertexBundles[r],o=n.indexView?n.indexView.count:a.view.count,s=a.view.stride,c=s*o,l=new Uint8Array(t.data.buffer,a.view.offset,a.view.length),u=new Uint8Array(n.indexView?c:a.view.length);if(n.indexView){for(var h=t.readIndices(this.subMeshIdx),f=0;f<e;++f)for(var _=f*s,p=h[f]*s,d=0;d<s;++d)u[_+d]=l[p+d];this._flatBuffers.push({stride:s,count:o,buffer:u})}else u.set(t.data.subarray(a.view.offset,a.view.offset+a.view.length)),this._flatBuffers.push({stride:s,count:o,buffer:u})}}},t.destroy=function(){for(var t=0;t<this.vertexBuffers.length;t++)this.vertexBuffers[t].destroy();if(this.vertexBuffers.length=0,this._indexBuffer&&(this._indexBuffer.destroy(),this._indexBuffer=null),this._jointMappedBuffers&&this._jointMappedBufferIndices){for(var e=0;e<this._jointMappedBufferIndices.length;e++)this._jointMappedBuffers[this._jointMappedBufferIndices[e]].destroy();this._jointMappedBuffers=void 0,this._jointMappedBufferIndices=void 0}this._indirectBuffer&&(this._indirectBuffer.destroy(),this._indirectBuffer=null)},t.enableVertexIdChannel=function(t){if(!this._vertexIdChannel){var e=this.vertexBuffers.length,n=this.attributes.length,i=this._allocVertexIdBuffer(t);this._vertexBuffers.push(i),this._attributes.push(new Ua("a_vertexId",Sr.R32F,!1,e)),this._iaInfo.attributes=this._attributes,this._iaInfo.vertexBuffers=this._vertexBuffers,this._vertexIdChannel={stream:e,index:n}}},t._allocVertexIdBuffer=function(t){for(var e=0===this.vertexBuffers.length||0===this.vertexBuffers[0].stride?0:this.vertexBuffers[0].size/this.vertexBuffers[0].stride,n=new Float32Array(e),i=0;i<e;++i)n[i]=i+.5;var r=t.createBuffer(new Ta(Er.VERTEX|Er.TRANSFER_DST,wr.DEVICE,n.byteLength,n.BYTES_PER_ELEMENT));return r.update(n),r},L(e,[{key:"attributes",get:function(){return this._attributes}},{key:"vertexBuffers",get:function(){return this._vertexBuffers}},{key:"indexBuffer",get:function(){return this._indexBuffer}},{key:"indirectBuffer",get:function(){return this._indirectBuffer}},{key:"primitiveMode",get:function(){return this._primitiveMode}},{key:"geometricInfo",get:function(){if(this._geometricInfo)return this._geometricInfo;if(void 0===this.mesh)return{positions:new Float32Array,indices:new Uint8Array,boundingBox:{min:di.ZERO,max:di.ZERO}};if(void 0===this.subMeshIdx)return{positions:new Float32Array,indices:new Uint8Array,boundingBox:{min:di.ZERO,max:di.ZERO}};var t=this.mesh,e=this.subMeshIdx,n=t.readAttribute(e,oa.ATTR_POSITION),i=t.readIndices(e),r=new di,a=new di,o=this.attributes.find((function(t){return t.name===oa.ATTR_POSITION}));if(o){var s=lo[o.format].count;2===s?(r.set(n[0],n[1],0),a.set(n[0],n[1],0)):(r.set(n[0],n[1],n[2]),a.set(n[0],n[1],n[2]));for(var c=0;c<n.length;c+=s)2===s?(r.x=n[c]>r.x?n[c]:r.x,r.y=n[c+1]>r.y?n[c+1]:r.y,a.x=n[c]<a.x?n[c]:a.x,a.y=n[c+1]<a.y?n[c+1]:a.y):(r.x=n[c]>r.x?n[c]:r.x,r.y=n[c+1]>r.y?n[c+1]:r.y,r.z=n[c+2]>r.z?n[c+2]:r.z,a.x=n[c]<a.x?n[c]:a.x,a.y=n[c+1]<a.y?n[c+1]:a.y,a.z=n[c+2]<a.z?n[c+2]:a.z)}return this._geometricInfo={positions:n,indices:i,boundingBox:{max:r,min:a}},this._geometricInfo}},{key:"flatBuffers",get:function(){return this._flatBuffers}},{key:"jointMappedBuffers",get:function(){var t=this;if(this._jointMappedBuffers)return this._jointMappedBuffers;var e=this._jointMappedBuffers=[],n=this._jointMappedBufferIndices=[];if(!this.mesh||void 0===this.subMeshIdx)return this._jointMappedBuffers=this.vertexBuffers;var r,a,o=this.mesh.struct,s=o.primitives[this.subMeshIdx];if(!o.jointMaps||void 0===s.jointMapIndex||!o.jointMaps[s.jointMapIndex])return this._jointMappedBuffers=this.vertexBuffers;for(var c=i.director.root.device,l=0;l<s.vertexBundelIndices.length;l++){var u=o.vertexBundles[s.vertexBundelIndices[l]];a=0,r=Sr.UNKNOWN;for(var h=0;h<u.attributes.length;h++){var f=u.attributes[h];if(f.name===oa.ATTR_JOINTS){r=f.format;break}a+=lo[f.format].size}r?function(){var i=new Uint8Array(t.mesh.data.buffer,u.view.offset,u.view.length),h=new DataView(i.slice().buffer),f=o.jointMaps[s.jointMapIndex];kb(h,(function(t){return f.indexOf(t)}),r,a,u.view.length,u.view.stride,h);var _=c.createBuffer(new Ta(Er.VERTEX|Er.TRANSFER_DST,wr.DEVICE,u.view.length,u.view.stride));_.update(h.buffer),e.push(_),n.push(l)}():e.push(this.vertexBuffers[s.vertexBundelIndices[l]])}return this._vertexIdChannel&&e.push(this._allocVertexIdBuffer(c)),e}},{key:"iaInfo",get:function(){return this._iaInfo}}]),e}());!function(t){t.TOUCH_START="touch-start",t.TOUCH_MOVE="touch-move",t.TOUCH_END="touch-end",t.TOUCH_CANCEL="touch-cancel",t.MOUSE_DOWN="mouse-down",t.MOUSE_MOVE="mouse-move",t.MOUSE_UP="mouse-up",t.MOUSE_WHEEL="mouse-wheel",t.MOUSE_ENTER="mouse-enter",t.MOUSE_LEAVE="mouse-leave",t.KEY_DOWN="keydown",t.KEY_UP="keyup",t.DEVICEMOTION="devicemotion",t.TRANSFORM_CHANGED="transform-changed",t.SCENE_CHANGED_FOR_PERSISTS="scene-changed-for-persists",t.SIZE_CHANGED="size-changed",t.ANCHOR_CHANGED="anchor-changed",t.COLOR_CHANGED="color-changed",t.CHILD_ADDED="child-added",t.CHILD_REMOVED="child-removed",t.PARENT_CHANGED="parent-changed",t.NODE_DESTROYED="node-destroyed",t.LAYER_CHANGED="layer-changed",t.SIBLING_ORDER_CHANGED="sibling-order-changed"}(Gb||(Gb=t("SystemEventType",{}))),function(t){t.TOUCH_START="touch-start",t.TOUCH_MOVE="touch-move",t.TOUCH_END="touch-end",t.TOUCH_CANCEL="touch-cancel",t.MOUSE_DOWN="mouse-down",t.MOUSE_MOVE="mouse-move",t.MOUSE_UP="mouse-up",t.MOUSE_WHEEL="mouse-wheel",t.KEY_DOWN="keydown",t.KEY_PRESSING="key-pressing",t.KEY_UP="keyup",t.DEVICEMOTION="devicemotion"}(Hb||(Hb={})),i.SystemEventType=Gb;var jb,Wb=new Array(16),Xb=null,qb=new Ni,Yb=[WA.TOUCH_START,WA.TOUCH_MOVE,WA.TOUCH_END,WA.TOUCH_CANCEL],Kb=[WA.MOUSE_DOWN,WA.MOUSE_ENTER,WA.MOUSE_MOVE,WA.MOUSE_LEAVE,WA.MOUSE_UP,WA.MOUSE_WHEEL];!function(t){t[t.ADD_POINTER_EVENT_PROCESSOR=0]="ADD_POINTER_EVENT_PROCESSOR",t[t.REMOVE_POINTER_EVENT_PROCESSOR=1]="REMOVE_POINTER_EVENT_PROCESSOR",t[t.MARK_LIST_DIRTY=2]="MARK_LIST_DIRTY"}(jb||(jb={}));var Qb,Zb,Jb,$b,tw,ew,nw,iw,rw,aw,ow,sw,cw,lw,uw,hw,fw,_w,pw,dw,mw,gw,vw,yw,xw,Sw,Tw,Aw,Ew,Cw,bw,ww,Pw,Iw,Rw,Dw,Ow,Mw,Nw,Lw,Bw,Fw,zw,Uw,kw,Gw,Hw,Vw,jw,Ww,Xw,qw,Yw,Kw,Qw,Zw,Jw,$w,tP,eP,nP,iP,rP,aP,oP,sP,cP,lP,uP,hP,fP,_P,pP,dP,mP,gP,vP,yP,xP,SP,TP,AP,EP,CP,bP,wP,PP,IP,RP,DP,OP,MP,NP,LP,BP,FP,zP,UP,kP,GP,HP,VP,jP,WP,XP,qP,YP,KP,QP,ZP,JP,$P,tI,eI,nI,iI,rI,aI,oI,sI,cI,lI,uI,hI,fI,_I,pI,dI,mI,gI,vI,yI,xI,SI,TI,AI,EI,CI,bI,wI,PI,II,RI,DI,OI,MI,NI,LI,BI,FI,zI,UI,kI,GI,HI,VI,jI,WI,XI,qI,YI,KI,QI,ZI,JI,$I,tR,eR,nR,iR,rR,aR,oR,sR,cR,lR,uR,hR,fR,_R,pR,dR,mR,gR,vR,yR,xR,SR,TR,AR,ER,CR,bR,wR,PR,IR=function(){var t=e.prototype;function e(t){this._isEnabled=!1,this.claimedTouchIdList=[],this.maskList=null,this.cachedCameraPriority=0,this.previousMouseIn=!1,this.bubblingTarget=null,this.capturingTarget=null,this.shouldHandleEventMouse=!1,this.shouldHandleEventTouch=!1,this._node=void 0,this._node=t}return t.setEnabled=function(t,n){if(void 0===n&&(n=!1),this._isEnabled!==t){this._isEnabled=t;var i=this.node.children;if(t&&this._attachMask(),e.callbacksInvoker.emit(jb.MARK_LIST_DIRTY),n&&i.length>0)for(var r=0;r<i.length;++r)i[r]._eventProcessor.setEnabled(t,!0)}},t._searchComponentsInParent=function(t){var e=this.node;if(t){for(var n=0,i=[],r=e;r&&qC.isNode(r);r=r.parent,++n){var a=r.getComponent(t);if(a){var o={index:n,comp:a};i?i.push(o):i=[o]}}return i.length>0?i:null}return null},t._attachMask=function(){this.maskList=this._searchComponentsInParent(e._maskComp)},t.reattach=function(){var t,n=this;this.node.walk((function(i){t||(t=n._searchComponentsInParent(e._maskComp)),i.eventProcessor.maskList=t}))},t.destroy=function(){Xb===this._node&&(Xb=null),this.capturingTarget&&this.capturingTarget.clear(),this.bubblingTarget&&this.bubblingTarget.clear(),e.callbacksInvoker.emit(jb.REMOVE_POINTER_EVENT_PROCESSOR,this)},t._isTouchEvent=function(t){return-1!==Yb.indexOf(t)},t._isMouseEvent=function(t){return-1!==Kb.indexOf(t)},t._hasTouchListeners=function(){for(var t=0;t<Yb.length;++t){var e=Yb[t];if(this.hasEventListener(e))return!0}return!1},t._hasMouseListeners=function(){for(var t=0;t<Kb.length;++t){var e=Kb[t];if(this.hasEventListener(e))return!0}return!1},t._hasPointerListeners=function(){return!!this._hasTouchListeners()||this._hasMouseListeners()},t._tryEmittingAddEvent=function(t){var n=this._isTouchEvent(t),i=this._isMouseEvent(t);n?this.shouldHandleEventTouch=!0:i&&(this.shouldHandleEventMouse=!0),!n&&!i||this._hasPointerListeners()||e.callbacksInvoker.emit(jb.ADD_POINTER_EVENT_PROCESSOR,this)},t._newCallbacksInvoker=function(){var t=this,n=new rn;return n._registerOffCallback((function(){t.shouldHandleEventTouch&&!t._hasTouchListeners()&&(t.shouldHandleEventTouch=!1),t.shouldHandleEventMouse&&!t._hasMouseListeners()&&(t.shouldHandleEventMouse=!1),t._hasPointerListeners()||e.callbacksInvoker.emit(jb.REMOVE_POINTER_EVENT_PROCESSOR,t)})),n},t.on=function(t,e,n,i){var r,a;return this._tryEmittingAddEvent(t),((i=!!i)?null!==(r=this.capturingTarget)&&void 0!==r?r:this.capturingTarget=this._newCallbacksInvoker():null!==(a=this.bubblingTarget)&&void 0!==a?a:this.bubblingTarget=this._newCallbacksInvoker()).on(t,e,n),e},t.once=function(t,e,n,i){var r,a;return this._tryEmittingAddEvent(t),((i=!!i)?null!==(r=this.capturingTarget)&&void 0!==r?r:this.capturingTarget=this._newCallbacksInvoker():null!==(a=this.bubblingTarget)&&void 0!==a?a:this.bubblingTarget=this._newCallbacksInvoker()).on(t,e,n,!0),e},t.off=function(t,e,n,i){var r;null===(r=(i=!!i)?this.capturingTarget:this.bubblingTarget)||void 0===r||r.off(t,e,n)},t.targetOff=function(t){var n,i;null===(n=this.capturingTarget)||void 0===n||n.removeAll(t),null===(i=this.bubblingTarget)||void 0===i||i.removeAll(t),this.shouldHandleEventTouch&&!this._hasTouchListeners()&&(this.shouldHandleEventTouch=!1),this.shouldHandleEventMouse&&!this._hasMouseListeners()&&(this.shouldHandleEventMouse=!1),this._hasPointerListeners()||e.callbacksInvoker.emit(jb.REMOVE_POINTER_EVENT_PROCESSOR,this)},t.emit=function(t,e,n,i,r,a){var o;null===(o=this.bubblingTarget)||void 0===o||o.emit(t,e,n,i,r,a)},t.dispatchEvent=function(t){var e,n=this.node,i=0;for(t.target=n,Wb.length=0,this.getCapturingTargets(t.type,Wb),t.eventPhase=1,i=Wb.length-1;i>=0;--i)if((e=Wb[i]).eventProcessor.capturingTarget&&(t.currentTarget=e,e.eventProcessor.capturingTarget.emit(t.type,t,Wb),t.propagationStopped))return void(Wb.length=0);if(Wb.length=0,t.eventPhase=2,t.currentTarget=n,this.capturingTarget&&this.capturingTarget.emit(t.type,t),!t.propagationImmediateStopped&&this.bubblingTarget&&this.bubblingTarget.emit(t.type,t),!t.propagationStopped&&t.bubbles)for(this.getBubblingTargets(t.type,Wb),t.eventPhase=3,i=0;i<Wb.length;++i)if((e=Wb[i]).eventProcessor.bubblingTarget&&(t.currentTarget=e,e.eventProcessor.bubblingTarget.emit(t.type,t),t.propagationStopped))return void(Wb.length=0);Wb.length=0},t.hasEventListener=function(t,e,n){var i=!1;return this.bubblingTarget&&(i=this.bubblingTarget.hasEventListener(t,e,n)),!i&&this.capturingTarget&&(i=this.capturingTarget.hasEventListener(t,e,n)),i},t.getCapturingTargets=function(t,e){for(var n=this._node.parent;n;){var i;(null===(i=n.eventProcessor.capturingTarget)||void 0===i?void 0:i.hasEventListener(t))&&e.push(n),n=n.parent}},t.getBubblingTargets=function(t,e){for(var n=this._node.parent;n;){var i;(null===(i=n.eventProcessor.bubblingTarget)||void 0===i?void 0:i.hasEventListener(t))&&e.push(n),n=n.parent}},t._handleEventMouse=function(t){switch(t.type){case Hb.MOUSE_DOWN:return this._handleMouseDown(t);case Hb.MOUSE_MOVE:return this._handleMouseMove(t);case Hb.MOUSE_UP:return this._handleMouseUp(t);case Hb.MOUSE_WHEEL:return this._handleMouseWheel(t);default:return!1}},t._handleMouseDown=function(t){var e=this._node;return!(!e||!e._uiProps.uiTransformComp||(qb=t.getUILocation(),!e._uiProps.uiTransformComp.isHit(qb)||(t.type=WA.MOUSE_DOWN,t.bubbles=!0,e.dispatchEvent(t),t.propagationStopped=!0,0)))},t._handleMouseMove=function(t){var e=this._node;return!(!e||!e._uiProps.uiTransformComp||(qb=t.getUILocation(),e._uiProps.uiTransformComp.isHit(qb)?(this.previousMouseIn||(Xb&&Xb!==e&&(t.type=WA.MOUSE_LEAVE,Xb.dispatchEvent(t),Xb.eventProcessor.previousMouseIn=!1),Xb=e,t.type=WA.MOUSE_ENTER,e.dispatchEvent(t),this.previousMouseIn=!0),t.type=WA.MOUSE_MOVE,t.bubbles=!0,e.dispatchEvent(t),t.propagationStopped=!0,0):(this.previousMouseIn&&(t.type=WA.MOUSE_LEAVE,e.dispatchEvent(t),this.previousMouseIn=!1,Xb=null),1)))},t._handleMouseUp=function(t){var e=this._node;return!(!e||!e._uiProps.uiTransformComp||(qb=t.getUILocation(),!e._uiProps.uiTransformComp.isHit(qb)||(t.type=WA.MOUSE_UP,t.bubbles=!0,e.dispatchEvent(t),t.propagationStopped=!0,0)))},t._handleMouseWheel=function(t){var e=this._node;return!(!e||!e._uiProps.uiTransformComp||(qb=t.getUILocation(),!e._uiProps.uiTransformComp.isHit(qb)||(t.type=WA.MOUSE_WHEEL,t.bubbles=!0,e.dispatchEvent(t),t.propagationStopped=!0,0)))},t._handleEventTouch=function(t){switch(t.type){case Hb.TOUCH_START:return this._handleTouchStart(t);case Hb.TOUCH_MOVE:return this._handleTouchMove(t);case Hb.TOUCH_END:return this._handleTouchEnd(t);case Hb.TOUCH_CANCEL:return this._handleTouchCancel(t);default:return!1}},t._handleTouchStart=function(t){var e=this.node;return!(!e||!e._uiProps.uiTransformComp||(t.getUILocation(qb),!e._uiProps.uiTransformComp.isHit(qb)||(t.type=WA.TOUCH_START,t.bubbles=!0,e.dispatchEvent(t),0)))},t._handleTouchMove=function(t){var e=this.node;return!(!e||!e._uiProps.uiTransformComp||(t.type=WA.TOUCH_MOVE,t.bubbles=!0,e.dispatchEvent(t),0))},t._handleTouchEnd=function(t){var e=this.node;e&&e._uiProps.uiTransformComp&&(t.getUILocation(qb),e._uiProps.uiTransformComp.isHit(qb)?t.type=WA.TOUCH_END:t.type=WA.TOUCH_CANCEL,t.bubbles=!0,e.dispatchEvent(t))},t._handleTouchCancel=function(t){var e=this.node;e&&e._uiProps.uiTransformComp&&(t.type=WA.TOUCH_CANCEL,t.bubbles=!0,e.dispatchEvent(t))},L(e,[{key:"isEnabled",get:function(){return this._isEnabled}},{key:"node",get:function(){return this._node}}]),e}();IR._maskComp=null,IR.callbacksInvoker=new rn,i.NodeEventProcessor=IR;var RR=new di(0,1,0),DR=new di,OR=new zi,MR=new _i,NR=new Ti,LR=function(t){var e=1/Math.max(Math.max(Math.max(t.x,t.y),t.z),1e-4);e<1&&(t.x*=e,t.y*=e,t.z*=e)},BR=(Qb=nl("cc.AmbientInfo"),Zb=vl(),Jb=ll("_skyColor"),$b=ll("_skyIllum"),tw=ll("_groundAlbedo"),ew=xl(),nw=Al(),iw=Bl(Te),rw=Al(),aw=xl(),ow=Al(),Qb(sw=Zb((dw=function(){function t(){X(this,"_skyColorHDR",lw,this),X(this,"_skyIllumHDR",uw,this),X(this,"_groundAlbedoHDR",hw,this),X(this,"_skyColorLDR",fw,this),X(this,"_skyIllumLDR",_w,this),X(this,"_groundAlbedoLDR",pw,this),this._resource=null}return t.prototype.activate=function(t){this._resource=t,this._resource.initialize(this)},L(t,[{key:"skyColorHDR",get:function(){return this._skyColorHDR}},{key:"groundAlbedoHDR",get:function(){return this._groundAlbedoHDR}},{key:"skyIllumHDR",get:function(){return this._skyIllumHDR}},{key:"skyColorLDR",get:function(){return this._skyColorLDR}},{key:"groundAlbedoLDR",get:function(){return this._groundAlbedoLDR}},{key:"skyIllumLDR",get:function(){return this._skyIllumLDR}},{key:"skyLightingColor",get:function(){var t=i.director.root.pipeline.pipelineSceneData.isHDR;return OR.set(t?this._skyColorHDR:this._skyColorLDR),LR(OR),MR.set(255*OR.x,255*OR.y,255*OR.z,255)},set:function(t){OR.set(t.x,t.y,t.z,t.w),i.director.root.pipeline.pipelineSceneData.isHDR?this._skyColorHDR.set(OR):this._skyColorLDR.set(OR),this._resource&&this._resource.skyColor.set(OR)}},{key:"skyColor",set:function(t){i.director.root.pipeline.pipelineSceneData.isHDR?this._skyColorHDR.set(t):this._skyColorLDR.set(t),this._resource&&this._resource.skyColor.set(t)}},{key:"skyIllum",get:function(){return i.director.root.pipeline.pipelineSceneData.isHDR?this._skyIllumHDR:this._skyIllumLDR},set:function(t){i.director.root.pipeline.pipelineSceneData.isHDR?this._skyIllumHDR=t:this._skyIllumLDR=t,this._resource&&(this._resource.skyIllum=t)}},{key:"groundLightingColor",get:function(){var t=i.director.root.pipeline.pipelineSceneData.isHDR;return OR.set(t?this._groundAlbedoHDR:this._groundAlbedoLDR),LR(OR),MR.set(255*OR.x,255*OR.y,255*OR.z,255)},set:function(t){OR.set(t.x,t.y,t.z,t.w),i.director.root.pipeline.pipelineSceneData.isHDR?this._groundAlbedoHDR.set(OR):this._groundAlbedoLDR.set(OR),this._resource&&this._resource.groundAlbedo.set(OR)}},{key:"groundAlbedo",set:function(t){i.director.root.pipeline.pipelineSceneData.isHDR?this._groundAlbedoHDR.set(t):this._groundAlbedoLDR.set(t),this._resource&&this._resource.groundAlbedo.set(t)}}]),t}(),lw=q((cw=dw).prototype,"_skyColorHDR",[cl,Jb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new zi(.2,.5,.8,1)}}),uw=q(cw.prototype,"_skyIllumHDR",[cl,$b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Yi.SKY_ILLUM}}),hw=q(cw.prototype,"_groundAlbedoHDR",[cl,tw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new zi(.2,.2,.2,1)}}),fw=q(cw.prototype,"_skyColorLDR",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new zi(.2,.5,.8,1)}}),_w=q(cw.prototype,"_skyIllumLDR",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Yi.SKY_ILLUM}}),pw=q(cw.prototype,"_groundAlbedoLDR",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new zi(.2,.2,.2,1)}}),q(cw.prototype,"skyLightingColor",[ew,yl,nw],Object.getOwnPropertyDescriptor(cw.prototype,"skyLightingColor"),cw.prototype),q(cw.prototype,"skyIllum",[yl,iw,rw],Object.getOwnPropertyDescriptor(cw.prototype,"skyIllum"),cw.prototype),q(cw.prototype,"groundLightingColor",[aw,yl,ow],Object.getOwnPropertyDescriptor(cw.prototype,"groundLightingColor"),cw.prototype),sw=cw))||sw)||sw);i.AmbientInfo=BR;var FR=(mw=nl("cc.SkyboxInfo"),gw=vl(),vw=Bl(ig),yw=ll("_envmap"),xw=Bl(ig),Sw=Bl(ig),Tw=Bl(ig),Aw=xl(),Ew=Al(),Cw=Il(),bw=Al(),ww=Al(),Pw=Al(),Iw=Bl(ig),Rw=Al(),Dw=xl(),Ow=Bl(ig),Mw=Il(),mw(Nw=gw((jw=function(){function t(){X(this,"_applyDiffuseMap",Bw,this),X(this,"_envmapHDR",Fw,this),X(this,"_envmapLDR",zw,this),X(this,"_diffuseMapHDR",Uw,this),X(this,"_diffuseMapLDR",kw,this),X(this,"_enabled",Gw,this),X(this,"_useIBL",Hw,this),X(this,"_useHDR",Vw,this),this._resource=null}return t.prototype.activate=function(t){this._resource=t,this._resource.initialize(this),this._resource.setEnvMaps(this._envmapHDR,this._envmapLDR),this._resource.setDiffuseMaps(this._diffuseMapHDR,this._diffuseMapLDR),this._resource.activate()},L(t,[{key:"applyDiffuseMap",get:function(){return this._applyDiffuseMap},set:function(t){this._applyDiffuseMap=t,this._resource&&(this._resource.useDiffuseMap=t)}},{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled!==t&&(this._enabled=t,this._resource&&(this._resource.enabled=this._enabled))}},{key:"useIBL",get:function(){return this._useIBL},set:function(t){this._useIBL=t,this._resource&&(this._resource.useIBL=this._useIBL)}},{key:"useHDR",get:function(){return i.director.root.pipeline.pipelineSceneData.isHDR=this._useHDR,this._useHDR},set:function(t){i.director.root.pipeline.pipelineSceneData.isHDR=t,this._useHDR=t,this._resource&&(this.envmap=this._resource.envmap,this.diffuseMap=this._resource.diffuseMap,null==this.diffuseMap&&(this.applyDiffuseMap=!1)),this._resource&&(this._resource.useHDR=this._useHDR)}},{key:"envmap",get:function(){return i.director.root.pipeline.pipelineSceneData.isHDR?this._envmapHDR:this._envmapLDR},set:function(t){i.director.root.pipeline.pipelineSceneData.isHDR?this._envmapHDR=t:this._envmapLDR=t,this._envmapHDR||(this._diffuseMapHDR=null,this._applyDiffuseMap=!1,this.useIBL=!1),this._resource&&(this._resource.setEnvMaps(this._envmapHDR,this._envmapLDR),this._resource.setDiffuseMaps(this._diffuseMapHDR,this._diffuseMapLDR),this._resource.useDiffuseMap=this._applyDiffuseMap,this._resource.envmap=t)}},{key:"diffuseMap",get:function(){return i.director.root.pipeline.pipelineSceneData.isHDR?this._diffuseMapHDR:this._diffuseMapLDR},set:function(t){i.director.root.pipeline.pipelineSceneData.isHDR?this._diffuseMapHDR=t:this._diffuseMapLDR=t,this._resource&&this._resource.setDiffuseMaps(this._diffuseMapHDR,this._diffuseMapLDR)}}]),t}(),Bw=q((Lw=jw).prototype,"_applyDiffuseMap",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Fw=q(Lw.prototype,"_envmapHDR",[cl,vw,yw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),zw=q(Lw.prototype,"_envmapLDR",[cl,xw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Uw=q(Lw.prototype,"_diffuseMapHDR",[cl,Sw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),kw=q(Lw.prototype,"_diffuseMapLDR",[cl,Tw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Gw=q(Lw.prototype,"_enabled",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Hw=q(Lw.prototype,"_useIBL",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Vw=q(Lw.prototype,"_useHDR",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),q(Lw.prototype,"applyDiffuseMap",[Aw,yl,Ew,Cw],Object.getOwnPropertyDescriptor(Lw.prototype,"applyDiffuseMap"),Lw.prototype),q(Lw.prototype,"enabled",[yl,bw],Object.getOwnPropertyDescriptor(Lw.prototype,"enabled"),Lw.prototype),q(Lw.prototype,"useIBL",[yl,ww],Object.getOwnPropertyDescriptor(Lw.prototype,"useIBL"),Lw.prototype),q(Lw.prototype,"useHDR",[yl,Pw],Object.getOwnPropertyDescriptor(Lw.prototype,"useHDR"),Lw.prototype),q(Lw.prototype,"envmap",[yl,Iw,Rw],Object.getOwnPropertyDescriptor(Lw.prototype,"envmap"),Lw.prototype),q(Lw.prototype,"diffuseMap",[Dw,yl,Sl,Ow,Mw],Object.getOwnPropertyDescriptor(Lw.prototype,"diffuseMap"),Lw.prototype),Nw=Lw))||Nw)||Nw);i.SkyboxInfo=FR;var zR=(Ww=nl("cc.FogInfo"),Xw=vl(),qw=Al(),Yw=Il(),Kw=Al(),Qw=Il(),Zw=Al(),Jw=Bl(bA),$w=Il(),tP=Al(),eP=xl(),nP=Bl(Te),iP=El(),rP=wl(),aP=Al(),oP=xl(),sP=Bl(Te),cP=wl(),lP=Al(),uP=xl(),hP=Bl(Te),fP=wl(),_P=Al(),pP=xl(),dP=Bl(Te),mP=Cl(),gP=wl(),vP=Al(),yP=xl(),xP=Bl(Te),SP=wl(),TP=Al(),AP=xl(),EP=Bl(Te),CP=wl(),bP=Al(),Ww(wP=Xw((kP=UP=function(){function t(){X(this,"_type",IP,this),X(this,"_fogColor",RP,this),X(this,"_enabled",DP,this),X(this,"_fogDensity",OP,this),X(this,"_fogStart",MP,this),X(this,"_fogEnd",NP,this),X(this,"_fogAtten",LP,this),X(this,"_fogTop",BP,this),X(this,"_fogRange",FP,this),X(this,"_accurate",zP,this),this._resource=null}return t.prototype.activate=function(t){this._resource=t,this._resource.initialize(this),this._resource.activate()},L(t,[{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled!==t&&(this._enabled=t,this._resource&&(this._resource.enabled=t,t&&(this._resource.type=this._type)))}},{key:"accurate",get:function(){return this._accurate},set:function(t){this._accurate!==t&&(this._accurate=t,this._resource&&(this._resource.accurate=t,t&&(this._resource.type=this._type)))}},{key:"fogColor",get:function(){return this._fogColor},set:function(t){this._fogColor.set(t),this._resource&&(this._resource.fogColor=this._fogColor)}},{key:"type",get:function(){return this._type},set:function(t){this._type=t,this._resource&&(this._resource.type=t)}},{key:"fogDensity",get:function(){return this._fogDensity},set:function(t){this._fogDensity=t,this._resource&&(this._resource.fogDensity=t)}},{key:"fogStart",get:function(){return this._fogStart},set:function(t){this._fogStart=t,this._resource&&(this._resource.fogStart=t)}},{key:"fogEnd",get:function(){return this._fogEnd},set:function(t){this._fogEnd=t,this._resource&&(this._resource.fogEnd=t)}},{key:"fogAtten",get:function(){return this._fogAtten},set:function(t){this._fogAtten=t,this._resource&&(this._resource.fogAtten=t)}},{key:"fogTop",get:function(){return this._fogTop},set:function(t){this._fogTop=t,this._resource&&(this._resource.fogTop=t)}},{key:"fogRange",get:function(){return this._fogRange},set:function(t){this._fogRange=t,this._resource&&(this._resource.fogRange=t)}}]),t}(),UP.FogType=bA,IP=q((PP=kP).prototype,"_type",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return bA.LINEAR}}),RP=q(PP.prototype,"_fogColor",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new _i("#C8C8C8")}}),DP=q(PP.prototype,"_enabled",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),OP=q(PP.prototype,"_fogDensity",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),MP=q(PP.prototype,"_fogStart",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),NP=q(PP.prototype,"_fogEnd",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 300}}),LP=q(PP.prototype,"_fogAtten",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),BP=q(PP.prototype,"_fogTop",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.5}}),FP=q(PP.prototype,"_fogRange",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.2}}),zP=q(PP.prototype,"_accurate",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),q(PP.prototype,"enabled",[yl,qw,Yw],Object.getOwnPropertyDescriptor(PP.prototype,"enabled"),PP.prototype),q(PP.prototype,"accurate",[yl,Kw,Qw],Object.getOwnPropertyDescriptor(PP.prototype,"accurate"),PP.prototype),q(PP.prototype,"fogColor",[yl,Zw],Object.getOwnPropertyDescriptor(PP.prototype,"fogColor"),PP.prototype),q(PP.prototype,"type",[yl,Jw,$w,tP],Object.getOwnPropertyDescriptor(PP.prototype,"type"),PP.prototype),q(PP.prototype,"fogDensity",[eP,nP,iP,rP,Pl,aP],Object.getOwnPropertyDescriptor(PP.prototype,"fogDensity"),PP.prototype),q(PP.prototype,"fogStart",[oP,sP,cP,lP],Object.getOwnPropertyDescriptor(PP.prototype,"fogStart"),PP.prototype),q(PP.prototype,"fogEnd",[uP,hP,fP,_P],Object.getOwnPropertyDescriptor(PP.prototype,"fogEnd"),PP.prototype),q(PP.prototype,"fogAtten",[pP,dP,mP,gP,vP],Object.getOwnPropertyDescriptor(PP.prototype,"fogAtten"),PP.prototype),q(PP.prototype,"fogTop",[yP,xP,SP,TP],Object.getOwnPropertyDescriptor(PP.prototype,"fogTop"),PP.prototype),q(PP.prototype,"fogRange",[AP,EP,CP,bP],Object.getOwnPropertyDescriptor(PP.prototype,"fogRange"),PP.prototype),wP=PP))||wP)||wP),UR=(GP=nl("cc.ShadowsInfo"),HP=vl(),VP=Al(),jP=Bl(Pv),WP=xl(),XP=xl(),qP=Al(),YP=Bl(Te),KP=Al(),QP=xl(),ZP=El(),JP=Bl(Te),$P=Al(),tI=xl(),eI=Bl(Iv),nI=Al(),iI=xl(),rI=Bl(Se),aI=xl(),oI=Bl(Te),sI=Al(),cI=xl(),lI=Bl(Te),uI=Al(),hI=xl(),fI=Bl(wv),_I=Al(),pI=xl(),dI=Bl(Ae),mI=Al(),gI=xl(),vI=Bl(Te),yI=Al(),xI=xl(),SI=Bl(Te),TI=Al(),AI=xl(),EI=El(),CI=Bl(Te),bI=Al(),wI=xl(),PI=El(),II=Bl(Te),RI=Al(),DI=xl(),OI=Bl(Te),MI=Al(),NI=xl(),GP(LI=HP((eR=function(){function t(){X(this,"_type",FI,this),X(this,"_enabled",zI,this),X(this,"_normal",UI,this),X(this,"_distance",kI,this),X(this,"_shadowColor",GI,this),X(this,"_firstSetCSM",HI,this),X(this,"_fixedArea",VI,this),X(this,"_pcf",jI,this),X(this,"_bias",WI,this),X(this,"_normalBias",XI,this),X(this,"_near",qI,this),X(this,"_far",YI,this),X(this,"_shadowDistance",KI,this),X(this,"_invisibleOcclusionRange",QI,this),X(this,"_orthoSize",ZI,this),X(this,"_maxReceived",JI,this),X(this,"_size",$I,this),X(this,"_saturation",tR,this),this._resource=null}var e=t.prototype;return e.setPlaneFromNode=function(t){t.getWorldRotation(NR),this.normal=di.transformQuat(DR,RR,NR),t.getWorldPosition(DR),this.distance=di.dot(this._normal,DR)},e.activate=function(t){this.pcf=Math.min(this._pcf,Iv.SOFT_2X),this._resource=t,this._resource.initialize(this),this._resource.activate()},L(t,[{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled!==t&&(this._enabled=t,this._resource&&(this._resource.enabled=t,t&&(this._resource.type=this._type)))}},{key:"type",get:function(){return this._type},set:function(t){this._type=t,this._resource&&(this._resource.type=t)}},{key:"shadowColor",get:function(){return this._shadowColor},set:function(t){this._shadowColor.set(t),this._resource&&(this._resource.shadowColor=t)}},{key:"normal",get:function(){return this._normal},set:function(t){di.copy(this._normal,t),this._resource&&(this._resource.normal=t)}},{key:"distance",get:function(){return this._distance},set:function(t){this._distance=t,this._resource&&(this._resource.distance=t)}},{key:"saturation",get:function(){return this._saturation},set:function(t){t>1?(this._saturation=t/t,this._resource&&(this._resource.saturation=t/t)):(this._saturation=t,this._resource&&(this._resource.saturation=t))}},{key:"pcf",get:function(){return this._pcf},set:function(t){this._pcf=t,this._resource&&(this._resource.pcf=t)}},{key:"maxReceived",get:function(){return this._maxReceived},set:function(t){this._maxReceived=t,this._resource&&(this._resource.maxReceived=t)}},{key:"bias",get:function(){return this._bias},set:function(t){this._bias=t,this._resource&&(this._resource.bias=t)}},{key:"normalBias",get:function(){return this._normalBias},set:function(t){this._normalBias=t,this._resource&&(this._resource.normalBias=t)}},{key:"shadowMapSize",get:function(){return this._size.x},set:function(t){this._size.set(t,t),this._resource&&(this._resource.size.set(t,t),this._resource.shadowMapDirty=!0)}},{key:"size",get:function(){return this._size}},{key:"fixedArea",get:function(){return this._fixedArea},set:function(t){this._fixedArea=t,this._resource&&(this._resource.fixedArea=t)}},{key:"near",get:function(){return this._near},set:function(t){this._near=t,this._resource&&(this._resource.near=t)}},{key:"far",get:function(){return this._far},set:function(t){this._far=Math.min(t,Dv.MAX_FAR),this._resource&&(this._resource.far=this._far)}},{key:"invisibleOcclusionRange",get:function(){return this._invisibleOcclusionRange},set:function(t){this._invisibleOcclusionRange=Math.min(t,Dv.MAX_FAR),this._resource&&(this._resource.invisibleOcclusionRange=this._invisibleOcclusionRange)}},{key:"shadowDistance",get:function(){return this._shadowDistance},set:function(t){this._shadowDistance=Math.min(t,Dv.MAX_FAR),this._resource&&(this._resource.shadowDistance=this._shadowDistance)}},{key:"orthoSize",get:function(){return this._orthoSize},set:function(t){this._orthoSize=t,this._resource&&(this._resource.orthoSize=t)}}]),t}(),FI=q((BI=eR).prototype,"_type",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Pv.Planar}}),zI=q(BI.prototype,"_enabled",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),UI=q(BI.prototype,"_normal",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new di(0,1,0)}}),kI=q(BI.prototype,"_distance",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),GI=q(BI.prototype,"_shadowColor",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new _i(0,0,0,76)}}),HI=q(BI.prototype,"_firstSetCSM",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),VI=q(BI.prototype,"_fixedArea",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),jI=q(BI.prototype,"_pcf",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Iv.HARD}}),WI=q(BI.prototype,"_bias",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e-5}}),XI=q(BI.prototype,"_normalBias",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),qI=q(BI.prototype,"_near",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),YI=q(BI.prototype,"_far",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),KI=q(BI.prototype,"_shadowDistance",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),QI=q(BI.prototype,"_invisibleOcclusionRange",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 200}}),ZI=q(BI.prototype,"_orthoSize",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),JI=q(BI.prototype,"_maxReceived",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 4}}),$I=q(BI.prototype,"_size",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ni(512,512)}}),tR=q(BI.prototype,"_saturation",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.75}}),q(BI.prototype,"enabled",[yl,VP],Object.getOwnPropertyDescriptor(BI.prototype,"enabled"),BI.prototype),q(BI.prototype,"type",[yl,jP],Object.getOwnPropertyDescriptor(BI.prototype,"type"),BI.prototype),q(BI.prototype,"shadowColor",[WP],Object.getOwnPropertyDescriptor(BI.prototype,"shadowColor"),BI.prototype),q(BI.prototype,"normal",[XP,qP],Object.getOwnPropertyDescriptor(BI.prototype,"normal"),BI.prototype),q(BI.prototype,"distance",[YP,KP,QP],Object.getOwnPropertyDescriptor(BI.prototype,"distance"),BI.prototype),q(BI.prototype,"saturation",[yl,ZP,Pl,JP,$P,tI],Object.getOwnPropertyDescriptor(BI.prototype,"saturation"),BI.prototype),q(BI.prototype,"pcf",[eI,nI,iI],Object.getOwnPropertyDescriptor(BI.prototype,"pcf"),BI.prototype),q(BI.prototype,"maxReceived",[rI,aI],Object.getOwnPropertyDescriptor(BI.prototype,"maxReceived"),BI.prototype),q(BI.prototype,"bias",[oI,sI,cI],Object.getOwnPropertyDescriptor(BI.prototype,"bias"),BI.prototype),q(BI.prototype,"normalBias",[lI,uI,hI],Object.getOwnPropertyDescriptor(BI.prototype,"normalBias"),BI.prototype),q(BI.prototype,"shadowMapSize",[fI,_I,pI],Object.getOwnPropertyDescriptor(BI.prototype,"shadowMapSize"),BI.prototype),q(BI.prototype,"fixedArea",[dI,mI,gI],Object.getOwnPropertyDescriptor(BI.prototype,"fixedArea"),BI.prototype),q(BI.prototype,"near",[vI,yI,xI],Object.getOwnPropertyDescriptor(BI.prototype,"near"),BI.prototype),q(BI.prototype,"far",[SI,TI,AI],Object.getOwnPropertyDescriptor(BI.prototype,"far"),BI.prototype),q(BI.prototype,"invisibleOcclusionRange",[yl,EI,Pl,CI,bI,wI],Object.getOwnPropertyDescriptor(BI.prototype,"invisibleOcclusionRange"),BI.prototype),q(BI.prototype,"shadowDistance",[yl,PI,Pl,II,RI,DI],Object.getOwnPropertyDescriptor(BI.prototype,"shadowDistance"),BI.prototype),q(BI.prototype,"orthoSize",[OI,MI,NI],Object.getOwnPropertyDescriptor(BI.prototype,"orthoSize"),BI.prototype),LI=BI))||LI)||LI);i.ShadowsInfo=UR;var kR=new di(-1024,-1024,-1024),GR=new di(1024,1024,1024),HR=(nR=nl("cc.OctreeInfo"),iR=vl(),rR=Al(),aR=Al(),oR=Tl(),sR=Al(),cR=Tl(),lR=El(),uR=Bl(Se),hR=Al(),nR(fR=iR((vR=function(){function t(){X(this,"_enabled",pR,this),X(this,"_minPos",dR,this),X(this,"_maxPos",mR,this),X(this,"_depth",gR,this),this._resource=null}return t.prototype.activate=function(t){this._resource=t,this._resource.initialize(this)},L(t,[{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled!==t&&(this._enabled=t,this._resource&&(this._resource.enabled=t))}},{key:"minPos",get:function(){return this._minPos},set:function(t){this._minPos=t,this._resource&&(this._resource.minPos=t)}},{key:"maxPos",get:function(){return this._maxPos},set:function(t){this._maxPos=t,this._resource&&(this._resource.maxPos=t)}},{key:"depth",get:function(){return this._depth},set:function(t){this._depth=t,this._resource&&(this._resource.depth=t)}}]),t}(),pR=q((_R=vR).prototype,"_enabled",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),dR=q(_R.prototype,"_minPos",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new di(kR)}}),mR=q(_R.prototype,"_maxPos",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new di(GR)}}),gR=q(_R.prototype,"_depth",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 8}}),q(_R.prototype,"enabled",[yl,rR],Object.getOwnPropertyDescriptor(_R.prototype,"enabled"),_R.prototype),q(_R.prototype,"minPos",[yl,aR,oR],Object.getOwnPropertyDescriptor(_R.prototype,"minPos"),_R.prototype),q(_R.prototype,"maxPos",[yl,sR,cR],Object.getOwnPropertyDescriptor(_R.prototype,"maxPos"),_R.prototype),q(_R.prototype,"depth",[yl,lR,uR,hR],Object.getOwnPropertyDescriptor(_R.prototype,"depth"),_R.prototype),fR=_R))||fR)||fR),VR=(yR=nl("cc.SceneGlobals"),xR=Bl(FR),yR((PR=function(){function t(){X(this,"ambient",AR,this),X(this,"shadows",ER,this),X(this,"_skybox",CR,this),X(this,"fog",bR,this),X(this,"octree",wR,this)}return t.prototype.activate=function(){var t=i.director.root.pipeline.pipelineSceneData;this.skybox.activate(t.skybox),this.ambient.activate(t.ambient),this.shadows.activate(t.shadows),this.fog.activate(t.fog),this.octree.activate(t.octree)},L(t,[{key:"skybox",get:function(){return this._skybox},set:function(t){this._skybox=t}}]),t}(),AR=q((TR=PR).prototype,"ambient",[cl,yl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new BR}}),ER=q(TR.prototype,"shadows",[cl,yl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new UR}}),CR=q(TR.prototype,"_skybox",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new FR}}),bR=q(TR.prototype,"fog",[yl,cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new zR}}),q(TR.prototype,"skybox",[yl,xR],Object.getOwnPropertyDescriptor(TR.prototype,"skybox"),TR.prototype),wR=q(TR.prototype,"octree",[yl,cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new HR}}),SR=TR))||SR);i.SceneGlobals=VR;var jR=t("Event",function(){function t(t,e){this.type=void 0,this.bubbles=void 0,this.target=null,this.currentTarget=null,this.eventPhase=0,this.propagationStopped=!1,this.propagationImmediateStopped=!1,this.type=t,this.bubbles=!!e}var e=t.prototype;return e.unuse=function(){this.type=t.NO_TYPE,this.target=null,this.currentTarget=null,this.eventPhase=t.NONE,this.propagationStopped=!1,this.propagationImmediateStopped=!1},e.reuse=function(t,e){this.type=t,this.bubbles=e||!1},e.isStopped=function(){return this.propagationStopped||this.propagationImmediateStopped},e.getCurrentTarget=function(){return this.currentTarget},e.getType=function(){return this.type},t}());jR.NO_TYPE="no_type",jR.TOUCH="touch",jR.MOUSE="mouse",jR.KEYBOARD="keyboard",jR.ACCELERATION="acceleration",jR.NONE=0,jR.CAPTURING_PHASE=1,jR.AT_TARGET=2,jR.BUBBLING_PHASE=3,i.Event=jR;var WR=t("EventAcceleration",function(t){function e(e,n){var i;return(i=t.call(this,Gb.DEVICEMOTION,n)||this).acc=void 0,i.acc=e,i}return F(e,t),e}(jR));jR.EventAcceleration=WR;var XR=t("EventKeyboard",function(t){function e(e,n,i){var r;return"boolean"==typeof n&&(n=n?Gb.KEY_DOWN:Gb.KEY_UP),(r=t.call(this,n,i)||this).keyCode=void 0,r.rawEvent=void 0,r._isPressed=void 0,r._isPressed=n!==Gb.KEY_UP,"number"==typeof e?r.keyCode=e:(r.keyCode=e.keyCode,r.rawEvent=e),r}return F(e,t),L(e,[{key:"isPressed",get:function(){return this._isPressed}}]),e}(jR));jR.EventKeyboard=XR;var qR=t("EventMouse",function(t){function e(n,i,r){var a;return(a=t.call(this,n,i)||this).movementX=0,a.movementY=0,a.preventSwallow=!1,a._eventType=void 0,a._button=e.BUTTON_MISSING,a._x=0,a._y=0,a._prevX=0,a._prevY=0,a._scrollX=0,a._scrollY=0,a._eventType=n,r&&(a._prevX=r.x,a._prevY=r.y),a}F(e,t);var n=e.prototype;return n.setScrollData=function(t,e){this._scrollX=t,this._scrollY=e},n.getScrollX=function(){return this._scrollX},n.getScrollY=function(){return this._scrollY},n.setLocation=function(t,e){this._x=t,this._y=e},n.getLocation=function(t){return t||(t=new Ni),Ni.set(t,this._x,this._y),t},n.getLocationInView=function(t){return t||(t=new Ni),Ni.set(t,this._x,i.view._designResolutionSize.height-this._y),t},n.getUILocation=function(t){return t||(t=new Ni),Ni.set(t,this._x,this._y),i.view._convertToUISpace(t),t},n.getPreviousLocation=function(t){return t||(t=new Ni),Ni.set(t,this._prevX,this._prevY),t},n.getUIPreviousLocation=function(t){return t||(t=new Ni),Ni.set(t,this._prevX,this._prevY),i.view._convertToUISpace(t),t},n.getDelta=function(t){return t||(t=new Ni),Ni.set(t,this._x-this._prevX,this._y-this._prevY),t},n.getDeltaX=function(){return this._x-this._prevX},n.getDeltaY=function(){return this._y-this._prevY},n.getUIDelta=function(t){return t||(t=new Ni),Ni.set(t,(this._x-this._prevX)/i.view.getScaleX(),(this._y-this._prevY)/i.view.getScaleY()),t},n.getUIDeltaX=function(){return(this._x-this._prevX)/i.view.getScaleX()},n.getUIDeltaY=function(){return(this._y-this._prevY)/i.view.getScaleY()},n.setButton=function(t){this._button=t},n.getButton=function(){return this._button},n.getLocationX=function(){return this._x},n.getLocationY=function(){return this._y},n.getUILocationX=function(){var t=i.view.getViewportRect();return(this._x-t.x)/i.view.getScaleX()},n.getUILocationY=function(){var t=i.view.getViewportRect();return(this._y-t.y)/i.view.getScaleY()},L(e,[{key:"eventType",get:function(){return this._eventType}}]),e}(jR));qR.BUTTON_MISSING=-1,qR.BUTTON_LEFT=0,qR.BUTTON_RIGHT=2,qR.BUTTON_MIDDLE=1,qR.BUTTON_4=3,qR.BUTTON_5=4,qR.BUTTON_6=5,qR.BUTTON_7=6,qR.BUTTON_8=7,jR.EventMouse=qR;var YR=new Ni,KR=t("EventTouch",function(t){function e(e,n,i,r){var a;return void 0===r&&(r=[]),(a=t.call(this,i,n)||this).touch=null,a.simulate=!1,a.preventSwallow=!1,a._eventCode=void 0,a._touches=void 0,a._allTouches=void 0,a._eventCode=i,a._touches=e||[],a._allTouches=r,a}F(e,t);var n=e.prototype;return n.getEventCode=function(){return this._eventCode},n.getTouches=function(){return this._touches},n.getAllTouches=function(){return this._allTouches},n.setLocation=function(t,e){this.touch&&this.touch.setTouchInfo(this.touch.getID(),t,e)},n.getLocation=function(t){return this.touch?this.touch.getLocation(t):new Ni},n.getUILocation=function(t){return this.touch?this.touch.getUILocation(t):new Ni},n.getLocationInView=function(t){return this.touch?this.touch.getLocationInView(t):new Ni},n.getPreviousLocation=function(t){return this.touch?this.touch.getPreviousLocation(t):new Ni},n.getStartLocation=function(t){return this.touch?this.touch.getStartLocation(t):new Ni},n.getUIStartLocation=function(t){return this.touch?this.touch.getUIStartLocation(t):new Ni},n.getID=function(){return this.touch?this.touch.getID():null},n.getDelta=function(t){return this.touch?this.touch.getDelta(t):new Ni},n.getUIDelta=function(t){return this.touch?this.touch.getUIDelta(t):new Ni},n.getDeltaX=function(){return this.touch?this.touch.getDelta(YR).x:0},n.getDeltaY=function(){return this.touch?this.touch.getDelta(YR).y:0},n.getLocationX=function(){return this.touch?this.touch.getLocationX():0},n.getLocationY=function(){return this.touch?this.touch.getLocationY():0},e}(jR));KR.MAX_TOUCHES=5,jR.EventTouch=KR;var QR,ZR=t("Acceleration",(function(t,e,n,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),this.x=void 0,this.y=void 0,this.z=void 0,this.timestamp=void 0,this.x=t,this.y=e,this.z=n,this.timestamp=i}));!function(t){t[t.NONE=0]="NONE",t[t.MOBILE_BACK=6]="MOBILE_BACK",t[t.BACKSPACE=8]="BACKSPACE",t[t.TAB=9]="TAB",t[t.ENTER=13]="ENTER",t[t.SHIFT_LEFT=16]="SHIFT_LEFT",t[t.CTRL_LEFT=17]="CTRL_LEFT",t[t.ALT_LEFT=18]="ALT_LEFT",t[t.PAUSE=19]="PAUSE",t[t.CAPS_LOCK=20]="CAPS_LOCK",t[t.ESCAPE=27]="ESCAPE",t[t.SPACE=32]="SPACE",t[t.PAGE_UP=33]="PAGE_UP",t[t.PAGE_DOWN=34]="PAGE_DOWN",t[t.END=35]="END",t[t.HOME=36]="HOME",t[t.ARROW_LEFT=37]="ARROW_LEFT",t[t.ARROW_UP=38]="ARROW_UP",t[t.ARROW_RIGHT=39]="ARROW_RIGHT",t[t.ARROW_DOWN=40]="ARROW_DOWN",t[t.INSERT=45]="INSERT",t[t.DELETE=46]="DELETE",t[t.DIGIT_0=48]="DIGIT_0",t[t.DIGIT_1=49]="DIGIT_1",t[t.DIGIT_2=50]="DIGIT_2",t[t.DIGIT_3=51]="DIGIT_3",t[t.DIGIT_4=52]="DIGIT_4",t[t.DIGIT_5=53]="DIGIT_5",t[t.DIGIT_6=54]="DIGIT_6",t[t.DIGIT_7=55]="DIGIT_7",t[t.DIGIT_8=56]="DIGIT_8",t[t.DIGIT_9=57]="DIGIT_9",t[t.KEY_A=65]="KEY_A",t[t.KEY_B=66]="KEY_B",t[t.KEY_C=67]="KEY_C",t[t.KEY_D=68]="KEY_D",t[t.KEY_E=69]="KEY_E",t[t.KEY_F=70]="KEY_F",t[t.KEY_G=71]="KEY_G",t[t.KEY_H=72]="KEY_H",t[t.KEY_I=73]="KEY_I",t[t.KEY_J=74]="KEY_J",t[t.KEY_K=75]="KEY_K",t[t.KEY_L=76]="KEY_L",t[t.KEY_M=77]="KEY_M",t[t.KEY_N=78]="KEY_N",t[t.KEY_O=79]="KEY_O",t[t.KEY_P=80]="KEY_P",t[t.KEY_Q=81]="KEY_Q",t[t.KEY_R=82]="KEY_R",t[t.KEY_S=83]="KEY_S",t[t.KEY_T=84]="KEY_T",t[t.KEY_U=85]="KEY_U",t[t.KEY_V=86]="KEY_V",t[t.KEY_W=87]="KEY_W",t[t.KEY_X=88]="KEY_X",t[t.KEY_Y=89]="KEY_Y",t[t.KEY_Z=90]="KEY_Z",t[t.NUM_0=96]="NUM_0",t[t.NUM_1=97]="NUM_1",t[t.NUM_2=98]="NUM_2",t[t.NUM_3=99]="NUM_3",t[t.NUM_4=100]="NUM_4",t[t.NUM_5=101]="NUM_5",t[t.NUM_6=102]="NUM_6",t[t.NUM_7=103]="NUM_7",t[t.NUM_8=104]="NUM_8",t[t.NUM_9=105]="NUM_9",t[t.NUM_MULTIPLY=106]="NUM_MULTIPLY",t[t.NUM_PLUS=107]="NUM_PLUS",t[t.NUM_SUBTRACT=109]="NUM_SUBTRACT",t[t.NUM_DECIMAL=110]="NUM_DECIMAL",t[t.NUM_DIVIDE=111]="NUM_DIVIDE",t[t.F1=112]="F1",t[t.F2=113]="F2",t[t.F3=114]="F3",t[t.F4=115]="F4",t[t.F5=116]="F5",t[t.F6=117]="F6",t[t.F7=118]="F7",t[t.F8=119]="F8",t[t.F9=120]="F9",t[t.F10=121]="F10",t[t.F11=122]="F11",t[t.F12=123]="F12",t[t.NUM_LOCK=144]="NUM_LOCK",t[t.SCROLL_LOCK=145]="SCROLL_LOCK",t[t.SEMICOLON=186]="SEMICOLON",t[t.EQUAL=187]="EQUAL",t[t.COMMA=188]="COMMA",t[t.DASH=189]="DASH",t[t.PERIOD=190]="PERIOD",t[t.SLASH=191]="SLASH",t[t.BACK_QUOTE=192]="BACK_QUOTE",t[t.BRACKET_LEFT=219]="BRACKET_LEFT",t[t.BACKSLASH=220]="BACKSLASH",t[t.BRACKET_RIGHT=221]="BRACKET_RIGHT",t[t.QUOTE=222]="QUOTE",t[t.SHIFT_RIGHT=2e3]="SHIFT_RIGHT",t[t.CTRL_RIGHT=2001]="CTRL_RIGHT",t[t.ALT_RIGHT=2002]="ALT_RIGHT",t[t.NUM_ENTER=2003]="NUM_ENTER"}(QR||(QR=t("KeyCode",{})));var JR=new Ni,$R=t("Touch",function(){function t(t,e,n){void 0===n&&(n=0),this._point=new Ni,this._prevPoint=new Ni,this._lastModified=0,this._id=0,this._startPoint=new Ni,this._startPointCaptured=!1,this.setTouchInfo(n,t,e)}var e=t.prototype;return e.getLocation=function(t){return t||(t=new Ni),t.set(this._point.x,this._point.y),t},e.getLocationX=function(){return this._point.x},e.getLocationY=function(){return this._point.y},e.getUILocation=function(t){return t||(t=new Ni),t.set(this._point.x,this._point.y),i.view._convertToUISpace(t),t},e.getUILocationX=function(){var t=i.view.getViewportRect();return(this._point.x-t.x)/i.view.getScaleX()},e.getUILocationY=function(){var t=i.view.getViewportRect();return(this._point.y-t.y)/i.view.getScaleY()},e.getPreviousLocation=function(t){return t||(t=new Ni),t.set(this._prevPoint.x,this._prevPoint.y),t},e.getUIPreviousLocation=function(t){return t||(t=new Ni),t.set(this._prevPoint.x,this._prevPoint.y),i.view._convertToUISpace(t),t},e.getStartLocation=function(t){return t||(t=new Ni),t.set(this._startPoint.x,this._startPoint.y),t},e.getUIStartLocation=function(t){return t||(t=new Ni),t.set(this._startPoint.x,this._startPoint.y),i.view._convertToUISpace(t),t},e.getDelta=function(t){return t||(t=new Ni),t.set(this._point),t.subtract(this._prevPoint),t},e.getUIDelta=function(t){return t||(t=new Ni),JR.set(this._point),JR.subtract(this._prevPoint),t.set(i.view.getScaleX(),i.view.getScaleY()),Ni.divide(t,JR,t),t},e.getLocationInView=function(t){return t||(t=new Ni),t.set(this._point.x,i.view._designResolutionSize.height-this._point.y),t},e.getPreviousLocationInView=function(t){return t||(t=new Ni),t.set(this._prevPoint.x,i.view._designResolutionSize.height-this._prevPoint.y),t},e.getStartLocationInView=function(t){return t||(t=new Ni),t.set(this._startPoint.x,i.view._designResolutionSize.height-this._startPoint.y),t},e.getID=function(){return this._id},e.setTouchInfo=function(t,e,n){void 0===t&&(t=0),this._prevPoint=this._point,this._point=new Ni(e||0,n||0),this._id=t,this._startPointCaptured||(this._startPoint=new Ni(this._point),this._startPointCaptured=!0)},e.setPoint=function(t,e){"object"==typeof t?(this._point.x=t.x,this._point.y=t.y):(this._point.x=t||0,this._point.y=e||0),this._lastModified=i.game.frameStartTime},e.setPrevPoint=function(t,e){this._prevPoint="object"==typeof t?new Ni(t.x,t.y):new Ni(t||0,e||0),this._lastModified=i.game.frameStartTime},L(t,[{key:"lastModified",get:function(){return this._lastModified}}]),t}());i.Touch=$R;var tD,eD,nD=function(){function t(){this._intervalInMileSeconds=200,this._accelTimer=0,this._eventTarget=new fn,this._deviceEventName=void 0,this._globalEventClass=void 0,this._didAccelerateFunc=void 0,this._globalEventClass=window.DeviceMotionEvent||window.DeviceOrientationEvent,_n.browserType===on.MOBILE_QQ&&(this._globalEventClass=window.DeviceOrientationEvent),this._deviceEventName=this._globalEventClass===window.DeviceMotionEvent?"devicemotion":"deviceorientation",this._didAccelerateFunc=this._didAccelerate.bind(this)}var e=t.prototype;return e._registerEvent=function(){this._accelTimer=performance.now(),window.addEventListener(this._deviceEventName,this._didAccelerateFunc,!1)},e._unregisterEvent=function(){this._accelTimer=0,window.removeEventListener(this._deviceEventName,this._didAccelerateFunc,!1)},e._didAccelerate=function(t){var e=performance.now();if(!(e-this._accelTimer<this._intervalInMileSeconds)){this._accelTimer=e;var n=0,i=0,r=0;if(this._globalEventClass===window.DeviceMotionEvent){var a=t.accelerationIncludingGravity;n=.1*((null==a?void 0:a.x)||0),i=.1*((null==a?void 0:a.y)||0),r=.1*((null==a?void 0:a.z)||0)}else{var o=t;n=(o.gamma||0)/90*.981,i=-(o.beta||0)/90*.981,r=(o.alpha||0)/90*.981}if(oh.isFrameRotated){var s=n;n=-i,i=s}var c=n;90===window.orientation?(n=-i,i=c):-90===window.orientation?(n=i,i=-c):180===window.orientation&&(n=-n,i=-i),_n.os===ln.ANDROID&&_n.browserType!==on.MOBILE_QQ&&(n=-n,i=-i);var l=performance.now(),u=new ZR(n,i,r,l),h=new WR(u);this._eventTarget.emit(Hb.DEVICEMOTION,h)}},e.start=function(){var t=this;window.DeviceMotionEvent&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceMotionEvent.requestPermission().then((function(e){"granted"===e&&t._registerEvent()})).catch((function(){})):this._registerEvent()},e.stop=function(){this._unregisterEvent()},e.setInterval=function(t){this._intervalInMileSeconds=t},e.on=function(t,e,n){this._eventTarget.on(t,e,n)},t}(),iD={Backspace:QR.BACKSPACE,Tab:QR.TAB,Enter:QR.ENTER,ShiftLeft:QR.SHIFT_LEFT,ControlLeft:QR.CTRL_LEFT,AltLeft:QR.ALT_LEFT,ShiftRight:QR.SHIFT_RIGHT,ControlRight:QR.CTRL_RIGHT,AltRight:QR.ALT_RIGHT,Pause:QR.PAUSE,CapsLock:QR.CAPS_LOCK,Escape:QR.ESCAPE,Space:QR.SPACE,PageUp:QR.PAGE_UP,PageDown:QR.PAGE_DOWN,End:QR.END,Home:QR.HOME,ArrowLeft:QR.ARROW_LEFT,ArrowUp:QR.ARROW_UP,ArrowRight:QR.ARROW_RIGHT,ArrowDown:QR.ARROW_DOWN,Insert:QR.INSERT,Delete:QR.DELETE,Digit0:QR.DIGIT_0,Digit1:QR.DIGIT_1,Digit2:QR.DIGIT_2,Digit3:QR.DIGIT_3,Digit4:QR.DIGIT_4,Digit5:QR.DIGIT_5,Digit6:QR.DIGIT_6,Digit7:QR.DIGIT_7,Digit8:QR.DIGIT_8,Digit9:QR.DIGIT_9,KeyA:QR.KEY_A,KeyB:QR.KEY_B,KeyC:QR.KEY_C,KeyD:QR.KEY_D,KeyE:QR.KEY_E,KeyF:QR.KEY_F,KeyG:QR.KEY_G,KeyH:QR.KEY_H,KeyI:QR.KEY_I,KeyJ:QR.KEY_J,KeyK:QR.KEY_K,KeyL:QR.KEY_L,KeyM:QR.KEY_M,KeyN:QR.KEY_N,KeyO:QR.KEY_O,KeyP:QR.KEY_P,KeyQ:QR.KEY_Q,KeyR:QR.KEY_R,KeyS:QR.KEY_S,KeyT:QR.KEY_T,KeyU:QR.KEY_U,KeyV:QR.KEY_V,KeyW:QR.KEY_W,KeyX:QR.KEY_X,KeyY:QR.KEY_Y,KeyZ:QR.KEY_Z,Numpad0:QR.NUM_0,Numpad1:QR.NUM_1,Numpad2:QR.NUM_2,Numpad3:QR.NUM_3,Numpad4:QR.NUM_4,Numpad5:QR.NUM_5,Numpad6:QR.NUM_6,Numpad7:QR.NUM_7,Numpad8:QR.NUM_8,Numpad9:QR.NUM_9,NumpadMultiply:QR.NUM_MULTIPLY,NumpadAdd:QR.NUM_PLUS,NumpadSubtract:QR.NUM_SUBTRACT,NumpadDecimal:QR.NUM_DECIMAL,NumpadDivide:QR.NUM_DIVIDE,NumpadEnter:QR.NUM_ENTER,F1:QR.F1,F2:QR.F2,F3:QR.F3,F4:QR.F4,F5:QR.F5,F6:QR.F6,F7:QR.F7,F8:QR.F8,F9:QR.F9,F10:QR.F10,F11:QR.F11,F12:QR.F12,NumLock:QR.NUM_LOCK,ScrollLock:QR.SCROLL_LOCK,Semicolon:QR.SEMICOLON,Equal:QR.EQUAL,Comma:QR.COMMA,Minus:QR.DASH,Period:QR.PERIOD,Slash:QR.SLASH,Backquote:QR.BACK_QUOTE,BracketLeft:QR.BRACKET_LEFT,Backslash:QR.BACKSLASH,BracketRight:QR.BRACKET_RIGHT,Quote:QR.QUOTE},rD=function(){function t(){this._eventTarget=new fn,this._registerEvent()}var e=t.prototype;return e._registerEvent=function(){var t=this,e=document.getElementById("GameCanvas");null==e||e.addEventListener("keydown",(function(e){if(e.stopPropagation(),e.preventDefault(),e.repeat){var n=t._getInputEvent(e,Hb.KEY_PRESSING);t._eventTarget.emit(Hb.KEY_PRESSING,n)}else{var i=t._getInputEvent(e,Hb.KEY_DOWN);t._eventTarget.emit(Hb.KEY_DOWN,i)}})),null==e||e.addEventListener("keyup",(function(e){var n=t._getInputEvent(e,Hb.KEY_UP);e.stopPropagation(),e.preventDefault(),t._eventTarget.emit(Hb.KEY_UP,n)}))},e._getInputEvent=function(t,e){var n,i=(n=t.code,iD[n]||QR.NONE);return new XR(i,e)},e.on=function(t,e,n){this._eventTarget.on(t,e,n)},t}(),aD=function(){function t(){this._canvas=void 0,this._eventTarget=new fn,this._pointLocked=!1,this._isPressed=!1,this._preMousePos=new Ni,_n.hasFeature(hn.EVENT_MOUSE)&&(this._canvas=document.getElementById("GameCanvas"),this._canvas||console.warn("failed to access canvas"),this._registerEvent())}var e=t.prototype;return e._getCanvasRect=function(){var t=this._canvas,e=null==t?void 0:t.getBoundingClientRect();return e?new Vi(e.x,e.y,e.width,e.height):new Vi(0,0,0,0)},e._getLocation=function(t){var e=this._getCanvasRect(),n=oh.devicePixelRatio,i=this._pointLocked?this._preMousePos.x/n+t.movementX:t.clientX-e.x,r=this._pointLocked?this._preMousePos.y/n-t.movementY:e.y+e.height-t.clientY;return new Ni(i*=n,r*=n)},e._registerEvent=function(){var t,e,n,i,r=this;window.addEventListener("mousedown",(function(){r._isPressed=!0})),null===(t=this._canvas)||void 0===t||t.addEventListener("mousedown",this._createCallback(Hb.MOUSE_DOWN)),null===(e=this._canvas)||void 0===e||e.addEventListener("mousemove",this._createCallback(Hb.MOUSE_MOVE));var a=this._createCallback(Hb.MOUSE_UP);window.addEventListener("mouseup",a),null===(n=this._canvas)||void 0===n||n.addEventListener("mouseup",a),null===(i=this._canvas)||void 0===i||i.addEventListener("wheel",this._handleMouseWheel.bind(this)),this._registerPointerLockEvent()},e._registerPointerLockEvent=function(){var t=this,e=function(){var e=t._canvas;document.pointerLockElement===e||document.mozPointerLockElement===e?t._pointLocked=!0:t._pointLocked=!1};"onpointerlockchange"in document?document.addEventListener("pointerlockchange",e,!1):"onmozpointerlockchange"in document&&document.addEventListener("mozpointerlockchange",e,!1)},e._createCallback=function(t){var e=this;return function(n){var i,r=e._getLocation(n),a=n.button;switch(t){case Hb.MOUSE_DOWN:null===(i=e._canvas)||void 0===i||i.focus(),e._isPressed=!0;break;case Hb.MOUSE_UP:e._isPressed=!1;break;case Hb.MOUSE_MOVE:e._isPressed||(a=qR.BUTTON_MISSING)}var o=new qR(t,!1,e._preMousePos);o.setLocation(r.x,r.y),o.setButton(a),o.movementX=n.movementX,o.movementY=n.movementY,e._preMousePos.set(r.x,r.y),n.stopPropagation(),n.target===e._canvas&&n.preventDefault(),e._eventTarget.emit(t,o)}},e._handleMouseWheel=function(t){var e=Hb.MOUSE_WHEEL,n=this._getLocation(t),i=t.button,r=new qR(e,!1,this._preMousePos);r.setLocation(n.x,n.y),r.setButton(i),r.movementX=t.movementX,r.movementY=t.movementY,r.setScrollData(5*t.deltaX,5*-t.deltaY),this._preMousePos.set(n.x,n.y),t.stopPropagation(),t.target===this._canvas&&t.preventDefault(),this._eventTarget.emit(e,r)},e.on=function(t,e,n){this._eventTarget.on(t,e,n)},t}(),oD=new Ni,sD=new(function(){function t(){this._touchMap=void 0,this._maxTouches=8,this._touchMap=new Map}var e=t.prototype;return e._cloneTouch=function(t){var e=t.getID();t.getStartLocation(oD);var n=new $R(oD.x,oD.y,e);return t.getLocation(oD),n.setPoint(oD.x,oD.y),t.getPreviousLocation(oD),n.setPrevPoint(oD),n},e._createTouch=function(t,e,n){if(this._touchMap.has(t))console.log("Cannot create the same touch object.");else{if(!this._checkTouchMapSizeMoreThanMax(t)){var i=new $R(e,n,t);return this._touchMap.set(t,i),this._updateTouch(i,e,n),this._cloneTouch(i)}console.log("The touches is more than MAX_TOUCHES.")}},e.releaseTouch=function(t){this._touchMap.has(t)&&this._touchMap.delete(t)},e.getTouch=function(t,e,n){var i=this._touchMap.get(t);return i?this._updateTouch(i,e,n):i=this._createTouch(t,e,n),i?this._cloneTouch(i):void 0},e.getAllTouches=function(){var t=this,e=[];return this._touchMap.forEach((function(n){if(n){var i=t._cloneTouch(n);e.push(i)}})),e},e._updateTouch=function(t,e,n){t.getLocation(oD),t.setPrevPoint(oD),t.setPoint(e,n)},e._checkTouchMapSizeMoreThanMax=function(t){var e=this;if(this._touchMap.has(t))return!1;var n=$t.ENABLE_MULTI_TOUCH?this._maxTouches:1;if(this._touchMap.size<n)return!1;var i=performance.now();return this._touchMap.forEach((function(t){i-t.lastModified>$t.TOUCH_TIMEOUT&&(console.log("The touches is more than MAX_TOUCHES, release touch id "+t.getID()+"."),e.releaseTouch(t.getID()))})),n>=this._touchMap.size},t}()),cD=function(){function t(){this._canvas=void 0,this._eventTarget=new fn,_n.hasFeature(hn.INPUT_TOUCH)&&(this._canvas=document.getElementById("GameCanvas"),this._canvas||console.warn("failed to access canvas"),this._registerEvent())}var e=t.prototype;return e._registerEvent=function(){var t,e,n,i;null===(t=this._canvas)||void 0===t||t.addEventListener("touchstart",this._createCallback(Hb.TOUCH_START)),null===(e=this._canvas)||void 0===e||e.addEventListener("touchmove",this._createCallback(Hb.TOUCH_MOVE)),null===(n=this._canvas)||void 0===n||n.addEventListener("touchend",this._createCallback(Hb.TOUCH_END)),null===(i=this._canvas)||void 0===i||i.addEventListener("touchcancel",this._createCallback(Hb.TOUCH_CANCEL))},e._createCallback=function(t){var e=this;return function(n){for(var i,r=e._getCanvasRect(),a=[],o=n.changedTouches.length,s=0;s<o;++s){var c=n.changedTouches[s],l=c.identifier;if(null!==l){var u=e._getLocation(c,r),h=sD.getTouch(l,u.x,u.y);h&&(t!==Hb.TOUCH_END&&t!==Hb.TOUCH_CANCEL||sD.releaseTouch(l),a.push(h))}}if(n.stopPropagation(),n.target===e._canvas&&n.preventDefault(),t===Hb.TOUCH_START&&(null===(i=e._canvas)||void 0===i||i.focus()),a.length>0){var f=new KR(a,!1,t,$t.ENABLE_MULTI_TOUCH?sD.getAllTouches():a);e._eventTarget.emit(t,f)}}},e._getCanvasRect=function(){var t=this._canvas,e=null==t?void 0:t.getBoundingClientRect();return e?new Vi(e.x,e.y,e.width,e.height):new Vi(0,0,0,0)},e._getLocation=function(t,e){var n=t.clientX-e.x,i=e.y+e.height-t.clientY;if(oh.isFrameRotated){var r=n;n=e.height-i,i=r}var a=oh.devicePixelRatio;return new Ni(n*=a,i*=a)},e.on=function(t,e,n){this._eventTarget.on(t,e,n)},t}();!function(t){t[t.GLOBAL=0]="GLOBAL",t[t.UI=1]="UI"}(eD||(eD={}));var lD=function(){function t(t){this.priority=eD.GLOBAL,this._inputEventTarget=void 0,this._inputEventTarget=t}return t.prototype.dispatchEvent=function(t){return this._inputEventTarget.emit(t.type,t),!0},t}(),uD=((tD={})[Hb.MOUSE_DOWN]=Hb.TOUCH_START,tD[Hb.MOUSE_MOVE]=Hb.TOUCH_MOVE,tD[Hb.MOUSE_UP]=Hb.TOUCH_END,tD),hD=t("Input",function(){function t(){this._dispatchImmediately=!0,this._eventTarget=new fn,this._touchInput=new cD,this._mouseInput=new aD,this._keyboardInput=new rD,this._accelerometerInput=new nD,this._eventTouchList=[],this._eventMouseList=[],this._eventKeyboardList=[],this._eventAccelerationList=[],this._needSimulateTouchMoveEvent=!1,this._inputEventDispatcher=void 0,this._eventDispatcherList=[],this._registerEvent(),this._inputEventDispatcher=new lD(this._eventTarget),this._registerEventDispatcher(this._inputEventDispatcher)}var e=t.prototype;return e.on=function(t,e,n){return this._eventTarget.on(t,e,n),e},e.once=function(t,e,n){return this._eventTarget.once(t,e,n),e},e.off=function(t,e,n){this._eventTarget.off(t,e,n)},e.setAccelerometerEnabled=function(t){t?this._accelerometerInput.start():this._accelerometerInput.stop()},e.setAccelerometerInterval=function(t){this._accelerometerInput.setInterval(t)},e._simulateEventTouch=function(t){var e=uD[t.type],n=sD.getTouch(0,t.getLocationX(),t.getLocationY());if(n){var i=[n],r=new KR(i,!1,e,i);e===Hb.TOUCH_END&&sD.releaseTouch(0),this._dispatchOrPushEventTouch(r,this._eventTouchList)}},e._registerEventDispatcher=function(t){this._eventDispatcherList.push(t),this._eventDispatcherList.sort((function(t,e){return e.priority-t.priority}))},e._emitEvent=function(t){for(var e=this._eventDispatcherList.length,n=0;n<e&&this._eventDispatcherList[n].dispatchEvent(t);++n);},e._registerEvent=function(){var t=this;if(lh.hasFeature(lh.Feature.INPUT_TOUCH)){var e=this._eventTouchList;this._touchInput.on(Hb.TOUCH_START,(function(n){t._dispatchOrPushEventTouch(n,e)})),this._touchInput.on(Hb.TOUCH_MOVE,(function(n){t._dispatchOrPushEventTouch(n,e)})),this._touchInput.on(Hb.TOUCH_END,(function(n){t._dispatchOrPushEventTouch(n,e)})),this._touchInput.on(Hb.TOUCH_CANCEL,(function(n){t._dispatchOrPushEventTouch(n,e)}))}if(lh.hasFeature(lh.Feature.EVENT_MOUSE)){var n=this._eventMouseList;this._mouseInput.on(Hb.MOUSE_DOWN,(function(e){t._needSimulateTouchMoveEvent=!0,t._simulateEventTouch(e),t._dispatchOrPushEvent(e,n)})),this._mouseInput.on(Hb.MOUSE_MOVE,(function(e){t._needSimulateTouchMoveEvent&&t._simulateEventTouch(e),t._dispatchOrPushEvent(e,n)})),this._mouseInput.on(Hb.MOUSE_UP,(function(e){t._needSimulateTouchMoveEvent=!1,t._simulateEventTouch(e),t._dispatchOrPushEvent(e,n)})),this._mouseInput.on(Hb.MOUSE_WHEEL,(function(e){t._dispatchOrPushEvent(e,n)}))}if(lh.hasFeature(lh.Feature.EVENT_KEYBOARD)){var i=this._eventKeyboardList;this._keyboardInput.on(Hb.KEY_DOWN,(function(e){t._dispatchOrPushEvent(e,i)})),this._keyboardInput.on(Hb.KEY_PRESSING,(function(e){t._dispatchOrPushEvent(e,i)})),this._keyboardInput.on(Hb.KEY_UP,(function(e){t._dispatchOrPushEvent(e,i)}))}if(lh.hasFeature(lh.Feature.EVENT_ACCELEROMETER)){var r=this._eventAccelerationList;this._accelerometerInput.on(Hb.DEVICEMOTION,(function(e){t._dispatchOrPushEvent(e,r)}))}},e._clearEvents=function(){this._eventMouseList.length=0,this._eventTouchList.length=0,this._eventKeyboardList.length=0,this._eventAccelerationList.length=0},e._dispatchOrPushEvent=function(t,e){this._dispatchImmediately?this._emitEvent(t):e.push(t)},e._dispatchOrPushEventTouch=function(t,e){if(this._dispatchImmediately)for(var n=t.getTouches(),i=n.length,r=0;r<i;++r)t.touch=n[r],t.propagationStopped=t.propagationImmediateStopped=!1,this._emitEvent(t);else e.push(t)},e._frameDispatchEvents=function(){for(var t=this._eventMouseList,e=0,n=t.length;e<n;++e){var i=t[e];this._emitEvent(i)}for(var r=this._eventTouchList,a=0,o=r.length;a<o;++a)for(var s=r[a],c=s.getTouches(),l=c.length,u=0;u<l;++u)s.touch=c[u],s.propagationStopped=s.propagationImmediateStopped=!1,this._emitEvent(s);for(var h=this._eventKeyboardList,f=0,_=h.length;f<_;++f){var p=h[f];this._emitEvent(p)}for(var d=this._eventAccelerationList,m=0,g=d.length;m<g;++m){var v=d[m];this._emitEvent(v)}this._clearEvents()},t}());hD.EventType=Hb;var fD=t("input",new hD),_D=t("SystemEvent",function(t){function e(){var e;return e=t.call(this)||this,fD.on(Hb.MOUSE_DOWN,(function(t){e.emit(Gb.MOUSE_DOWN,t)})),fD.on(Hb.MOUSE_MOVE,(function(t){e.emit(Gb.MOUSE_MOVE,t)})),fD.on(Hb.MOUSE_UP,(function(t){e.emit(Gb.MOUSE_UP,t)})),fD.on(Hb.MOUSE_WHEEL,(function(t){e.emit(Gb.MOUSE_WHEEL,t)})),fD.on(Hb.TOUCH_START,(function(t){e.emit(Gb.TOUCH_START,t.touch,t)})),fD.on(Hb.TOUCH_MOVE,(function(t){e.emit(Gb.TOUCH_MOVE,t.touch,t)})),fD.on(Hb.TOUCH_END,(function(t){e.emit(Gb.TOUCH_END,t.touch,t)})),fD.on(Hb.TOUCH_CANCEL,(function(t){e.emit(Gb.TOUCH_CANCEL,t.touch,t)})),fD.on(Hb.KEY_DOWN,(function(t){e.emit(Gb.KEY_DOWN,t)})),fD.on(Hb.KEY_PRESSING,(function(t){e.emit(Gb.KEY_DOWN,t)})),fD.on(Hb.KEY_UP,(function(t){e.emit(Gb.KEY_UP,t)})),fD.on(Hb.DEVICEMOTION,(function(t){e.emit(Gb.DEVICEMOTION,t)})),e}F(e,t);var n=e.prototype;return n.setAccelerometerEnabled=function(t){fD.setAccelerometerEnabled(t)},n.setAccelerometerInterval=function(t){fD.setAccelerometerInterval(t)},n.on=function(e,n,i,r){return t.prototype.on.call(this,e,n,i,r),n},n.off=function(e,n,i){t.prototype.off.call(this,e,n,i)},e}(fn));_D.EventType=Gb,i.SystemEvent=_D;var pD,dD=t("systemEvent",new _D);i.systemEvent=dD,Nn(Gb,"Node.EventType",[{name:"POSITION_PART",newName:"TRANSFORM_CHANGED"},{name:"ROTATION_PART",newName:"TRANSFORM_CHANGED"},{name:"SCALE_PART",newName:"TRANSFORM_CHANGED"}]),Nn(jR,"Event",[{name:"ACCELERATION",newName:"DEVICEMOTION",target:_D.EventType,targetName:"SystemEvent.EventType"}]),Bn(jR,"Event",[{name:"TOUCH",suggest:"please use SystemEvent.EventType.TOUCH_START, SystemEvent.EventType.TOUCH_MOVE, SystemEvent.EventType.TOUCH_END and SystemEvent.EventType.TOUCH_CANCEL instead"},{name:"MOUSE",suggest:"please use SystemEvent.EventType.MOUSE_DOWN, SystemEvent.EventType.MOUSE_MOVE, SystemEvent.EventType.MOUSE_UP, SystemEvent.EventType.MOUSE_WHEEL, Node.EventType.MOUSE_ENTER and Node.EventType.MOUSE_LEAVE instead"},{name:"KEYBOARD",suggest:"please use SystemEvent.EventType.KEY_DOWN and SystemEvent.EventType.KEY_UP instead"}]),Nn(qR,"EventMouse",["DOWN","UP","MOVE"].map((function(t){return{name:t,newName:"MOUSE_"+t,target:_D.EventType,targetName:"SystemEvent.EventType"}}))),Nn(qR,"EventMouse",[{name:"SCROLL",newName:"MOUSE_WHEEL",target:_D.EventType,targetName:"SystemEvent.EventType"}]),Bn(qR.prototype,"EventMouse.prototype",[{name:"eventType",suggest:"please use EventMouse.prototype.type instead"}]),Nn(KR,"EventTouch",[{name:"BEGAN",newName:"TOUCH_START",target:_D.EventType,targetName:"SystemEvent.EventType"}]),Nn(KR,"EventTouch",[{name:"MOVED",newName:"TOUCH_MOVE",target:_D.EventType,targetName:"SystemEvent.EventType"}]),Nn(KR,"EventTouch",[{name:"ENDED",newName:"TOUCH_END",target:_D.EventType,targetName:"SystemEvent.EventType"}]),Nn(KR,"EventTouch",[{name:"CANCELLED",newName:"TOUCH_CANCEL",target:_D.EventType,targetName:"SystemEvent.EventType"}]),Bn(KR.prototype,"EventTouch.prototype",[{name:"getEventCode",suggest:"please use EventTouch.prototype.type instead"}]),Nn(KR.prototype,"EventTouch.prototype",[{name:"getUILocationInView",newName:"getLocationInView",target:KR,targetName:"EventTouch"}]),Bn($t.KEY,"macro.KEY",["back","menu","0","1","2","3","4","5","6","7","8","9","0","*","+","-","/",";","=",",",".","[","]","dpadLeft","dpadRight","dpadUp","dpadDown","dpadCenter"].map((function(t){return{name:t}}))),Bn($t.KEY,"macro.KEY",[{name:"shift",suggest:"please use KeyCode.SHIFT_LEFT instead"}]),Bn($t.KEY,"macro.KEY",[{name:"ctrl",suggest:"please use KeyCode.CTRL_LEFT instead"}]),Bn($t.KEY,"macro.KEY",[{name:"alt",suggest:"please use KeyCode.ALT_LEFT instead"}]),Bn($t,"macro",[{name:"KEY",suggest:"please use KeyCode instead"}]),Nn(vE.prototype,"BaseNode",[{name:"childrenCount",newName:"children.length",customGetter:function(){return this.children.length}}]),Nn(qC.prototype,"Node",[{name:"width",targetName:"node.getComponent(UITransform)",customGetter:function(){return this._uiProps.uiTransformComp.width},customSetter:function(t){this._uiProps.uiTransformComp.width=t}},{name:"height",targetName:"node.getComponent(UITransform)",customGetter:function(){return this._uiProps.uiTransformComp.height},customSetter:function(t){this._uiProps.uiTransformComp.height=t}},{name:"anchorX",targetName:"node.getComponent(UITransform)",customGetter:function(){return this._uiProps.uiTransformComp.anchorX},customSetter:function(t){this._uiProps.uiTransformComp.anchorX=t}},{name:"anchorY",targetName:"node.getComponent(UITransform)",customGetter:function(){return this._uiProps.uiTransformComp.anchorY},customSetter:function(t){this._uiProps.uiTransformComp.anchorY=t}},{name:"getAnchorPoint",targetName:"node.getComponent(UITransform)",customFunction:function(t){return t||(t=new Ni),t.set(this._uiProps.uiTransformComp.anchorPoint),t}},{name:"setAnchorPoint",targetName:"node.getComponent(UITransform)",customFunction:function(t,e){this._uiProps.uiTransformComp.setAnchorPoint(t,e)}},{name:"getContentSize",targetName:"node.getComponent(UITransform)",customFunction:function(t){return t||(t=new Gi),t.set(this._uiProps.uiTransformComp.contentSize),t}},{name:"setContentSize",targetName:"node.getComponent(UITransform)",customFunction:function(t,e){"number"==typeof t?this._uiProps.uiTransformComp.setContentSize(t,e):this._uiProps.uiTransformComp.setContentSize(t)}}]),Ln(VR.prototype,"SceneGlobals.prototype",[{name:"aspect"},{name:"selfShadow"},{name:"linear"},{name:"packing"},{name:"autoAdapt"}]),Ln(qC.prototype,"Node.prototype",[{name:"addLayer"},{name:"removeLayer"}]),Nn(eE.prototype,"NodeUIProperties",[{name:"opacityDirty",newName:"colorDirty"}]),Ln(Np,"Layers",[{name:"All"},{name:"RaycastMask"},{name:"check"}]),Nn(Np,"Layers",[{name:"Default",newName:"DEFAULT",target:Np.Enum,targetName:"Layers.Enum"},{name:"Always",newName:"ALWAYS",target:Np.Enum,targetName:"Layers.Enum"},{name:"IgnoreRaycast",newName:"IGNORE_RAYCAST",target:Np.Enum,targetName:"Layers.Enum"},{name:"Gizmos",newName:"GIZMOS",target:Np.Enum,targetName:"Layers.Enum"},{name:"Editor",newName:"EDITOR",target:Np.Enum,targetName:"Layers.Enum"},{name:"UI",newName:"UI_3D",target:Np.Enum,targetName:"Layers.Enum"},{name:"UI2D",newName:"UI_2D",target:Np.Enum,targetName:"Layers.Enum"},{name:"SceneGizmo",newName:"SCENE_GIZMO",target:Np.Enum,targetName:"Layers.Enum"},{name:"makeInclusiveMask",newName:"makeMaskInclude",target:Np,targetName:"Layers"},{name:"makeExclusiveMask",newName:"makeMaskExclude",target:Np,targetName:"Layers"}]),Ln(Np.Enum,"Layers.Enum",[{name:"ALWAYS"}]),Ln(Np.BitMask,"Layers.BitMask",[{name:"ALWAYS"}]);var mD,gD,vD,yD,xD=Ye.Flags.HideInHierarchy,SD=Ye.Flags.DontSave,TD=t("PrivateNode",nl("cc.PrivateNode")(pD=function(t){function e(e){var n;return E(12003,(n=t.call(this,e)||this).name),n.hideFlags|=SD|xD,n}return F(e,t),e}(qC))||pD);Nn(Gb,"SystemEventType",["MOUSE_ENTER","MOUSE_LEAVE","TRANSFORM_CHANGED","SCENE_CHANGED_FOR_PERSISTS","SIZE_CHANGED","ANCHOR_CHANGED","COLOR_CHANGED","CHILD_ADDED","CHILD_REMOVED","PARENT_CHANGED","NODE_DESTROYED","LAYER_CHANGED","SIBLING_ORDER_CHANGED"].map((function(t){return{name:t,target:qC.EventType,targetName:"Node.EventType"}}))),Nn(qC.EventType,"Node.EventType",[{name:"DEVICEMOTION",target:_D.EventType,targetName:"SystemEvent.EventType"},{name:"KEY_DOWN",target:_D.EventType,targetName:"SystemEvent.EventType"},{name:"KEY_UP",target:_D.EventType,targetName:"SystemEvent.EventType"}]),i.PrivateNode=TD;var AD=t("Scene",nl("cc.Scene")((q((gD=function(t){F(n,t);var e=n.prototype;function n(e){var n;return X(n=t.call(this,e)||this,"autoReleaseAssets",vD,V(n)),X(n,"_globals",yD,V(n)),n.dependAssets=null,n._renderScene=null,n._inited=void 0,n._prefabSyncedInLiveReload=!1,n._pos=di.ZERO,n._rot=Ti.IDENTITY,n._scale=di.ONE,n._mat=Ri.IDENTITY,n._dirtyFlags=0,n._lpos=di.ZERO,n._lrot=Ti.IDENTITY,n._lscale=di.ONE,n._activeInHierarchy=!1,i.director&&i.director.root&&(n._renderScene=i.director.root.createScene({})),n._inited=!i.game||!i.game._isCloning,n._init(),n}return e._updateScene=function(){this._scene=this},e._init=function(){},e.destroy=function(){var t=Ye.prototype.destroy.call(this);if(t)for(var e=this._children,n=0;n<e.length;++n)e[n].active=!1;return this._renderScene&&i.director.root.destroyScene(this._renderScene),this._active=!1,this._activeInHierarchy=!1,t},e.addComponent=function(){throw new Error(R(3822))},e._onHierarchyChanged=function(){},e._onBatchCreated=function(e){t.prototype._onBatchCreated.call(this,e);for(var n=this._children.length,i=0;i<n;++i)this.children[i]._siblingIndex=i,this._children[i]._onBatchCreated(e)},e.getPosition=function(t){return di.copy(t||new di,di.ZERO)},e.getRotation=function(t){return Ti.copy(t||new Ti,Ti.IDENTITY)},e.getScale=function(t){return di.copy(t||new di,di.ONE)},e.getWorldPosition=function(t){return di.copy(t||new di,di.ZERO)},e.getWorldRotation=function(t){return Ti.copy(t||new Ti,Ti.IDENTITY)},e.getWorldScale=function(t){return di.copy(t||new di,di.ONE)},e.getWorldMatrix=function(t){return Ri.copy(t||new Ri,Ri.IDENTITY)},e.getWorldRS=function(t){return Ri.copy(t||new Ri,Ri.IDENTITY)},e.getWorldRT=function(t){return Ri.copy(t||new Ri,Ri.IDENTITY)},e.updateWorldTransform=function(){},e._instantiate=function(){},e._load=function(){this._inited||(hb(this),lb(this),this._onBatchCreated(false),this._inited=!0),this.walk(vE._setScene)},e._activate=function(t){t=!1!==t,i.director._nodeActivator.activateNode(this,t),this._globals.activate(),this._renderScene&&this._renderScene.activate()},L(n,[{key:"renderScene",get:function(){return this._renderScene}},{key:"globals",get:function(){return this._globals}},{key:"native",get:function(){return this._nativeObj}},{key:"position",get:function(){return di.ZERO}},{key:"worldPosition",get:function(){return di.ZERO}},{key:"rotation",get:function(){return Ti.IDENTITY}},{key:"worldRotation",get:function(){return Ti.IDENTITY}},{key:"scale",get:function(){return di.ONE}},{key:"worldScale",get:function(){return di.ONE}},{key:"eulerAngles",get:function(){return di.ZERO}},{key:"worldMatrix",get:function(){return Ri.IDENTITY}}]),n}(vE)).prototype,"globals",[yl],Object.getOwnPropertyDescriptor(gD.prototype,"globals"),gD.prototype),vD=q(gD.prototype,"autoReleaseAssets",[cl,yl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),yD=q(gD.prototype,"_globals",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new VR}}),mD=gD))||mD);function ED(t,e){if(!e){var n=i.director.getScene();if(!n)return null;e=n}return e.getChildByPath(t)}i.Scene=AD,i.find=ED;var CD=kt.fastRemoveAt,bD=Ye.Flags.IsStartCalled,wD=Ye.Flags.IsOnEnableCalled;function PD(t,e){for(var n=e.constructor._executionOrder,i=e._id,r=0,a=t.length-1,o=a>>>1;r<=a;o=r+a>>>1){var s=t[o],c=s.constructor._executionOrder;if(c>n)a=o-1;else if(c<n)r=o+1;else{var l=s._id;if(l>i)a=o-1;else{if(!(l<i))return o;r=o+1}}}return~r}function ID(t,e){for(var n=t.array,i=t.i+1;i<n.length;){var r=n[i];r.node._activeInHierarchy?++i:(t.removeAt(i),e&&(r._objFlags&=~e))}}Ye.Flags.IsEditorOnEnableCalled;var RD=function(t){this._zero=void 0,this._neg=void 0,this._pos=void 0,this._invoke=void 0;var e=Y;this._zero=new e([]),this._neg=new e([]),this._pos=new e([]),this._invoke=t};function DD(t,e){return t.constructor._executionOrder-e.constructor._executionOrder}RD.stableRemoveInactive=ID;var OD=function(t){function e(){return t.apply(this,arguments)||this}F(e,t);var n=e.prototype;return n.add=function(t){var e=t.constructor._executionOrder;(0===e?this._zero:e<0?this._neg:this._pos).array.push(t)},n.remove=function(t){var e=t.constructor._executionOrder;(0===e?this._zero:e<0?this._neg:this._pos).fastRemove(t)},n.cancelInactive=function(t){ID(this._zero,t),ID(this._neg,t),ID(this._pos,t)},n.invoke=function(){var t=this._neg;t.array.length>0&&(t.array.sort(DD),this._invoke(t),t.array.length=0),this._invoke(this._zero),this._zero.array.length=0;var e=this._pos;e.array.length>0&&(e.array.sort(DD),this._invoke(e),e.array.length=0)},e}(RD),MD=function(t){function e(){return t.apply(this,arguments)||this}F(e,t);var n=e.prototype;return n.add=function(t){var e=t.constructor._executionOrder;if(0===e)this._zero.array.push(t);else{var n=e<0?this._neg.array:this._pos.array,i=PD(n,t);i<0&&n.splice(~i,0,t)}},n.remove=function(t){var e=t.constructor._executionOrder;if(0===e)this._zero.fastRemove(t);else{var n=e<0?this._neg:this._pos,i=PD(n.array,t);i>=0&&n.removeAt(i)}},n.invoke=function(t){this._neg.array.length>0&&this._invoke(this._neg,t),this._invoke(this._zero,t),this._pos.array.length>0&&this._invoke(this._pos,t)},e}(RD);function ND(t,e,n){var r="var a=it.array;for(it.i=0;it.i<a.length;++it.i){var c=a[it.i];"+t+"}",a=e?Function("it","dt",r):Function("it",r);return function(t,e,n){return function(r,a){try{e(r,a)}catch(e){i._throw(e);var o=r.array;for(n&&(o[r.i]._objFlags|=n),++r.i;r.i<o.length;++r.i)try{t(o[r.i],a)}catch(t){i._throw(t),n&&(o[r.i]._objFlags|=n)}}}}(Function("c","dt",t),a,n)}var LD=ND("c.start();c._objFlags|="+bD,!1,bD),BD=ND("c.update(dt)",!0),FD=ND("c.lateUpdate(dt)",!0),zD=function(t){var e=i.director._compScheduler,n=t.array;for(t.i=0;t.i<n.length;++t.i){var r=n[t.i];r._enabled&&(r.onEnable(),!r.node._activeInHierarchy||e._onEnabled(r))}},UD=function(){function t(){this._deferredComps=[],this.unscheduleAll()}var e=t.prototype;return e.unscheduleAll=function(){this.startInvoker=new OD(LD),this.updateInvoker=new MD(BD),this.lateUpdateInvoker=new MD(FD),this._updating=!1},e._onEnabled=function(t){i.director.getScheduler().resumeTarget(t),t._objFlags|=wD,this._updating?this._deferredComps.push(t):this._scheduleImmediate(t)},e._onDisabled=function(t){i.director.getScheduler().pauseTarget(t),t._objFlags&=~wD;var e=this._deferredComps.indexOf(t);e>=0?CD(this._deferredComps,e):(!t.start||t._objFlags&bD||this.startInvoker.remove(t),t.update&&this.updateInvoker.remove(t),t.lateUpdate&&this.lateUpdateInvoker.remove(t))},e.enableComp=function(t,e){if(!(t._objFlags&wD)){if(t.onEnable){if(e)return void e.add(t);if(t.onEnable(),!t.node._activeInHierarchy)return}this._onEnabled(t)}},e.disableComp=function(t){t._objFlags&wD&&(t.onDisable&&t.onDisable(),this._onDisabled(t))},e.startPhase=function(){this._updating=!0,this.startInvoker.invoke(),this._startForNewComps()},e.updatePhase=function(t){this.updateInvoker.invoke(t)},e.lateUpdatePhase=function(t){this.lateUpdateInvoker.invoke(t),this._updating=!1,this._startForNewComps()},e._startForNewComps=function(){this._deferredComps.length>0&&(this._deferredSchedule(),this.startInvoker.invoke())},e._scheduleImmediate=function(t){"function"!=typeof t.start||t._objFlags&bD||this.startInvoker.add(t),"function"==typeof t.update&&this.updateInvoker.add(t),"function"==typeof t.lateUpdate&&this.lateUpdateInvoker.add(t)},e._deferredSchedule=function(){for(var t=this._deferredComps,e=0,n=t.length;e<n;e++)this._scheduleImmediate(t[e]);t.length=0},t}(),kD=Ye.Flags.IsPreloadStarted,GD=Ye.Flags.IsOnLoadStarted,HD=Ye.Flags.IsOnLoadCalled,VD=Ye.Flags.Deactivating,jD=function(t){function e(){return t.apply(this,arguments)||this}F(e,t);var n=e.prototype;return n.add=function(t){this._zero.array.push(t)},n.remove=function(t){this._zero.fastRemove(t)},n.cancelInactive=function(t){RD.stableRemoveInactive(this._zero,t)},n.invoke=function(){this._invoke(this._zero),this._zero.array.length=0},e}(RD),WD=ND("c.__preload();"),XD=ND("c.onLoad();c._objFlags|="+HD,!1,HD),qD=new Ut(4);function YD(t,e,n){b(3817,t.name,n),console.log("Corrupted component value:",e),e?t._removeComponent(e):kt.removeAt(t._components,n)}qD.get=function(){var t=this._get()||{preload:new jD(WD),onLoad:new OD(XD),onEnable:new OD(zD)};t.preload._zero.i=-1;var e=t.onLoad;return e._zero.i=-1,e._neg.i=-1,e._pos.i=-1,(e=t.onEnable)._zero.i=-1,e._neg.i=-1,e._pos.i=-1,t};var KD,QD,ZD,JD,$D,tO,eO,nO,iO=t("NodeActivator",function(){function t(){this.resetComp=void 0,this.reset()}var e=t.prototype;return e.reset=function(){this._activatingStack=[]},e.activateNode=function(t,e){if(e){var n=qD.get();this._activatingStack.push(n),this._activateNodeRecursively(t,n.preload,n.onLoad,n.onEnable),n.preload.invoke(),n.onLoad.invoke(),n.onEnable.invoke(),this._activatingStack.pop(),qD.put(n)}else{this._deactivateNodeRecursively(t);for(var i,r=W(this._activatingStack);!(i=r()).done;){var a=i.value;a.preload.cancelInactive(kD),a.onLoad.cancelInactive(GD),a.onEnable.cancelInactive()}}t.emit(WA.ACTIVE_IN_HIERARCHY_CHANGED,t)},e.activateComp=function(t,e,n,r){if(Qe(t,!0)&&(t._objFlags&kD||(t._objFlags|=kD,t.__preload&&(e?e.add(t):t.__preload())),t._objFlags&GD||(t._objFlags|=GD,t.onLoad?n?n.add(t):(t.onLoad(),t._objFlags|=HD):t._objFlags|=HD),t._enabled)){if(!t.node._activeInHierarchy)return;i.director._compScheduler.enableComp(t,r)}},e.destroyComp=function(t){i.director._compScheduler.disableComp(t),t.onDestroy&&t._objFlags&HD&&t.onDestroy()},e._activateNodeRecursively=function(t,e,n,r){if(t._objFlags&VD)b(3816,t.name);else{t._activeInHierarchy=!0;for(var a=t._components.length,o=0;o<a;++o){var s=t._components[o];s instanceof i.Component?this.activateComp(s,e,n,r):(YD(t,s,o),--o,--a)}for(var c=0,l=t._children.length;c<l;++c){var u=t._children[c];u._active&&this._activateNodeRecursively(u,e,n,r)}t._onPostActivated(!0)}},e._deactivateNodeRecursively=function(t){t._objFlags|=VD,t._activeInHierarchy=!1;for(var e=t._components.length,n=0;n<e;++n){var r=t._components[n];if(r._enabled&&(i.director._compScheduler.disableComp(r),t._activeInHierarchy))return void(t._objFlags&=~VD)}for(var a=0,o=t._children.length;a<o;++a){var s=t._children[a];if(s._activeInHierarchy&&(this._deactivateNodeRecursively(s),t._activeInHierarchy))return void(t._objFlags&=~VD)}t._onPostActivated(!1),t._objFlags&=~VD},t}()),rO=t("SceneAsset",nl("cc.SceneAsset")((JD=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return X(e=t.call.apply(t,[this].concat(i))||this,"scene",ZD,V(e)),e}F(e,t);var n=e.prototype;return n.initDefault=function(e){t.prototype.initDefault.call(this,e),this.scene=new AD("New Scene")},n.validate=function(){return!!this.scene},e}(Ou),ZD=q((QD=JD).prototype,"scene",[yl,cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),KD=QD))||KD);i.SceneAsset=rO;var aO,oO,sO,cO,lO=t("TextAsset",nl("cc.TextAsset")((nO=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return X(e=t.call.apply(t,[this].concat(i))||this,"text",eO,V(e)),e}return F(e,t),e.prototype.toString=function(){return this.text},e}(Ou),eO=q((tO=nO).prototype,"text",[cl,yl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),$D=tO))||$D);i.TextAsset=lO;var uO=t("JsonAsset",nl("cc.JsonAsset")((cO=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return X(e=t.call.apply(t,[this].concat(i))||this,"json",sO,V(e)),e}return F(e,t),e}(Ou),sO=q((oO=cO).prototype,"json",[cl,yl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),aO=oO))||aO);i.JsonAsset=uO;var hO,fO,_O,pO,dO,mO,gO,vO,yO,xO,SO,TO,AO,EO,CO,bO,wO,PO,IO,RO,DO,OO,MO,NO,LO,BO,FO,zO,UO,kO,GO,HO,VO,jO,WO,XO,qO,YO,KO=function(){var t=e.prototype;function e(){this.fog=new PA,this.ambient=new Yi,this.skybox=new Wv,this.shadows=new Dv,this.octree=new Ki,this.validPunctualLights=[],this.renderObjects=[],this.castShadowObjects=[],this.dirShadowObjects=[],this.shadowFrameBufferMap=new Map,this._occlusionQueryVertexBuffer=null,this._occlusionQueryIndicesBuffer=null,this._occlusionQueryInputAssembler=null,this._occlusionQueryMaterial=null,this._occlusionQueryShader=null,this._isHDR=!0,this._shadingScale=1,this._init(),this.shadingScale=1}return t._init=function(){},t.activate=function(t,e){return this._device=t,this._pipeline=e,this.initOcclusionQuery(),!0},t.initOcclusionQuery=function(){if(this._occlusionQueryInputAssembler||(this._occlusionQueryInputAssembler=this._createOcclusionQueryIA()),!this._occlusionQueryMaterial){var t=new bv;t._uuid="default-occlusion-query-material",t.initialize({effectName:"occlusion-query"}),this._occlusionQueryMaterial=t,this._occlusionQueryShader=t.passes[0].getShaderVariant()}},t.getOcclusionQueryPass=function(){return this._occlusionQueryMaterial.passes[0]},t.onGlobalPipelineStateChanged=function(){},t.destroy=function(){var t,e,n;this.ambient.destroy(),this.skybox.destroy(),this.fog.destroy(),this.shadows.destroy(),this.octree.destroy(),this.validPunctualLights.length=0,null===(t=this._occlusionQueryInputAssembler)||void 0===t||t.destroy(),this._occlusionQueryInputAssembler=null,null===(e=this._occlusionQueryVertexBuffer)||void 0===e||e.destroy(),this._occlusionQueryVertexBuffer=null,null===(n=this._occlusionQueryIndicesBuffer)||void 0===n||n.destroy(),this._occlusionQueryIndicesBuffer=null},t._createOcclusionQueryIA=function(){var t=this._device,e=new Float32Array([-1,-1,-1,1,-1,-1,-1,1,-1,1,1,-1,-1,-1,1,1,-1,1,-1,1,1,1,1,1]),n=3*Float32Array.BYTES_PER_ELEMENT,i=8*n;this._occlusionQueryVertexBuffer=t.createBuffer(new Ta(Er.VERTEX|Er.TRANSFER_DST,wr.DEVICE,i,n)),this._occlusionQueryVertexBuffer.update(e);var r=new Uint16Array([0,2,1,1,2,3,4,5,6,5,7,6,1,3,7,1,7,5,0,4,6,0,6,2,0,1,5,0,5,4,2,6,7,2,7,3]),a=Uint16Array.BYTES_PER_ELEMENT,o=36*a;this._occlusionQueryIndicesBuffer=t.createBuffer(new Ta(Er.INDEX|Er.TRANSFER_DST,wr.DEVICE,o,a)),this._occlusionQueryIndicesBuffer.update(r);var s=[new Ua("a_position",Sr.RGB32F)],c=new Ga(s,[this._occlusionQueryVertexBuffer],this._occlusionQueryIndicesBuffer);return t.createInputAssembler(c)},L(e,[{key:"native",get:function(){return this._nativeObj}},{key:"isHDR",get:function(){return this._isHDR},set:function(t){this._isHDR=t}},{key:"shadingScale",get:function(){return this._shadingScale},set:function(t){this._shadingScale!==t&&(this._shadingScale=t,this._pipeline.emit(xx.ATTACHMENT_SCALE_CAHNGED,t))}}]),e}(),QO=t("ForwardPipeline",(hO=nl("ForwardPipeline"),fO=Bl([xT]),_O=Il(),hO((gO=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return X(e=t.call.apply(t,[this].concat(i))||this,"renderTextures",mO,V(e)),e._postRenderPass=null,e}F(e,t);var n=e.prototype;return n.initialize=function(e){if(t.prototype.initialize.call(this,e),0===this._flows.length){var n=new EA;n.initialize(EA.initInfo),this._flows.push(n);var i=new oA;i.initialize(oA.initInfo),this._flows.push(i)}return!0},n.activate=function(e){return this._macros={CC_PIPELINE_TYPE:0},this._pipelineSceneData=new KO,!(!t.prototype.activate.call(this,e)||!this._activeRenderer(e)&&(b(2402),1))},n._ensureEnoughSize=function(t){for(var e=this._width,n=this._height,i=0;i<t.length;++i){var r=t[i].window;e=Math.max(r.width,e),n=Math.max(r.height,n)}e===this._width&&n===this._height||(this._width=e,this._height=n)},n.destroy=function(){this._destroyUBOs(),this._destroyQuadInputAssembler();for(var e=this._renderPasses.values(),n=e.next();!n.done;)n.value.destroy(),n=e.next();return this._commandBuffers.length=0,t.prototype.destroy.call(this)},n._activeRenderer=function(){var t=this.device;this._commandBuffers.push(t.commandBuffer);var e=this.globalDSManager.pointSampler;return this._descriptorSet.bindSampler($p,e),this._descriptorSet.bindTexture($p,Lg.get("default-texture").getGFXTexture()),this._descriptorSet.bindSampler(cd,e),this._descriptorSet.bindTexture(cd,Lg.get("default-texture").getGFXTexture()),this._descriptorSet.update(),!0},n._destroyUBOs=function(){this._descriptorSet&&(this._descriptorSet.getBuffer(Qp.BINDING).destroy(),this._descriptorSet.getBuffer(Jp.BINDING).destroy(),this._descriptorSet.getBuffer(Zp.BINDING).destroy(),this._descriptorSet.getTexture($p).destroy(),this._descriptorSet.getTexture(cd).destroy())},L(e,[{key:"postRenderPass",get:function(){return this._postRenderPass}}]),e}(Hx),mO=q((dO=gO).prototype,"renderTextures",[fO,cl,_O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),pO=dO))||pO)),ZO=[new va(0,0,0,0),new va(0,0,0,0),new va(0,0,0,0)],JO=t("GbufferStage",(vO=nl("GbufferStage"),yO=Bl([AT]),xO=Il(),vO((CO=EO=function(t){function e(){var e;return X(e=t.call(this)||this,"renderQueues",AO,V(e)),e._renderQueues=[],e._renderArea=new ua,e._batchedQueue=void 0,e._instancedQueue=void 0,e._phaseID=Bg("default"),e._batchedQueue=new RT,e._instancedQueue=new DT,e}F(e,t);var n=e.prototype;return n.initialize=function(e){return t.prototype.initialize.call(this,e),e.renderQueues&&(this.renderQueues=e.renderQueues),!0},n.activate=function(e,n){t.prototype.activate.call(this,e,n);for(var i=0;i<this.renderQueues.length;i++)this._renderQueues[i]=wT(this.renderQueues[i])},n.destroy=function(){},n.render=function(t){this._instancedQueue.clear(),this._batchedQueue.clear();var e=this._pipeline,n=e.device;this._renderQueues.forEach(PT),e.generateRenderArea(t,this._renderArea),e.updateQuadVertexData(this._renderArea,t.window);for(var i=e.pipelineSceneData.renderObjects,r=0,a=0,o=0,s=0;s<i.length;++s){var c=i[s],l=c.model.subModels;for(r=0;r<l.length;++r){var u=l[r],h=u.passes;for(a=0;a<h.length;++a){var f=h[a];if(f.phase===this._phaseID){var _=f.batchingScheme;if(_===Og.INSTANCING){var p=f.getInstancedBuffer();p.merge(u,c.model.instancedAttributes,a),this._instancedQueue.queue.add(p)}else if(_===Og.VB_MERGING){var d=f.getBatchedBuffer();d.merge(u,a,c.model),this._batchedQueue.queue.add(d)}else for(o=0;o<this._renderQueues.length;o++)this._renderQueues[o].insertRenderPass(c,r,a)}}}}this._renderQueues.forEach(IT);var m=e.commandBuffers[0];this._instancedQueue.uploadBuffers(m),this._batchedQueue.uploadBuffers(m),t.clearFlag&na.COLOR&&(e.pipelineSceneData.isHDR?fv(ZO[0],t.clearColor):(ZO[0].x=t.clearColor.x,ZO[0].y=t.clearColor.y,ZO[0].z=t.clearColor.z)),ZO[0].w=t.clearColor.w;var g=e.getPipelineRenderData().gbufferFrameBuffer,v=g.renderPass;m.beginRenderPass(v,g,this._renderArea,ZO,t.clearDepth,t.clearStencil),m.setScissor(e.generateScissor(t)),m.setViewport(e.generateViewport(t)),m.bindDescriptorSet(Xp.GLOBAL,e.descriptorSet);for(var y=0;y<this.renderQueues.length;y++)this._renderQueues[y].recordCommandBuffer(n,v,m);this._instancedQueue.recordCommandBuffer(n,v,m),this._batchedQueue.recordCommandBuffer(n,v,m),m.endRenderPass()},e}(yx),EO.initInfo={name:"GbufferStage",priority:Nx.GBUFFER,tag:0,renderQueues:[{isTransparent:!1,sortMode:yT.FRONT_TO_BACK,stages:["default"]},{isTransparent:!0,sortMode:yT.BACK_TO_FRONT,stages:["default"]}]},AO=q((TO=CO).prototype,"renderQueues",[yO,cl,xO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),SO=TO))||SO)),$O=[new va(0,0,0,1)],tM=t("LightingStage",(bO=nl("LightingStage"),wO=Bl(bv),PO=Il(),IO=Bl([AT]),RO=Il(),bO((BO=LO=function(t){function e(){var e;return(e=t.call(this)||this)._deferredLitsBufs=null,e._maxDeferredLights=md.LIGHTS_PER_PASS,e._lightMeterScale=1e4,e._descriptorSet=null,e._renderArea=new ua,e._uiPhase=void 0,X(e,"_deferredMaterial",MO,V(e)),X(e,"renderQueues",NO,V(e)),e._phaseID=Bg("default"),e._renderQueues=[],e._uiPhase=new iA,e}F(e,t);var n=e.prototype;return n.initialize=function(e){return t.prototype.initialize.call(this,e),!0},n.gatherLights=function(t){for(var e=this._pipeline,n=e.commandBuffers[0],i=t.scene.sphereLights,r=t.scene.spotLights,a=ia.create(0,0,0,1),o=new Float32Array(4),s=t.exposure,c=0,l=zi.length,u=l*this._maxDeferredLights,h=0;h<i.length&&c<this._maxDeferredLights;h++,++c){var f=i[h];if(ia.set(a,f.position.x,f.position.y,f.position.z,f.range),$s.sphereFrustum(a,t.frustum)){if(di.toArray(o,f.position),o[3]=0,this._lightBufferData.set(o,c*l),di.toArray(o,f.color),f.useColorTemperature){var _=f.colorTemperatureRGB;o[0]*=_.x,o[1]*=_.y,o[2]*=_.z}e.pipelineSceneData.isHDR?o[3]=f.luminance*s*this._lightMeterScale:o[3]=f.luminance,this._lightBufferData.set(o,c*l+1*u),o[0]=f.size,o[1]=f.range,o[2]=0,this._lightBufferData.set(o,c*l+2*u)}}for(var p=0;p<r.length&&c<this._maxDeferredLights;p++,++c){var d=r[p];if(ia.set(a,d.position.x,d.position.y,d.position.z,d.range),$s.sphereFrustum(a,t.frustum)){if(di.toArray(o,d.position),o[3]=1,this._lightBufferData.set(o,c*l+0*u),di.toArray(o,d.color),d.useColorTemperature){var m=d.colorTemperatureRGB;o[0]*=m.x,o[1]*=m.y,o[2]*=m.z}e.pipelineSceneData.isHDR?o[3]=d.luminance*s*this._lightMeterScale:o[3]=d.luminance,this._lightBufferData.set(o,c*l+1*u),o[0]=d.size,o[1]=d.range,o[2]=d.spotAngle,this._lightBufferData.set(o,c*l+2*u),di.toArray(o,d.direction),this._lightBufferData.set(o,c*l+3*u)}}var g=3*u+3;this._lightBufferData.set([c],g),n.updateBuffer(this._deferredLitsBufs,this._lightBufferData)},n.activate=function(e,n){t.prototype.activate.call(this,e,n),this._uiPhase.activate(e);for(var i=e.device,r=0;r<this.renderQueues.length;r++)this._renderQueues[r]=wT(this.renderQueues[r]);var a=16*Float32Array.BYTES_PER_ELEMENT*this._maxDeferredLights;a=Math.ceil(a/i.capabilities.uboOffsetAlignment)*i.capabilities.uboOffsetAlignment,this._deferredLitsBufs=i.createBuffer(new Ta(Er.UNIFORM|Er.TRANSFER_DST,wr.HOST|wr.DEVICE,a,i.capabilities.uboOffsetAlignment));var o=i.createBuffer(new Aa(this._deferredLitsBufs,0,a));this._lightBufferData=new Float32Array(a/Float32Array.BYTES_PER_ELEMENT);var s=new Za(Hp.bindings);this._descriptorSetLayout=i.createDescriptorSetLayout(s),this._descriptorSet=i.createDescriptorSet(new Ja(this._descriptorSetLayout)),this._descriptorSet.bindBuffer(dd.BINDING,o),this._planarQueue=new nA(this._pipeline),this._deferredMaterial&&(e.pipelineSceneData.deferredLightingMaterial=this._deferredMaterial)},n.destroy=function(){var t;null===(t=this._deferredLitsBufs)||void 0===t||t.destroy(),this._deferredLitsBufs=null,this._descriptorSet=null},n.render=function(t){var e=this._pipeline,n=e.device,i=e.commandBuffers[0],r=e.pipelineSceneData,a=r.renderObjects;this.gatherLights(t),this._descriptorSet.update(),this._planarQueue.gatherShadowPasses(t,i),i.bindDescriptorSet(Xp.LOCAL,this._descriptorSet,[0]),e.generateRenderArea(t,this._renderArea),t.clearFlag&na.COLOR&&($O[0].x=t.clearColor.x,$O[0].y=t.clearColor.y,$O[0].z=t.clearColor.z),$O[0].w=0;var o=e.getPipelineRenderData(),s=o.outputFrameBuffer,c=s.renderPass;e.pipelineUBO.updateShadowUBO(t),i.beginRenderPass(c,s,this._renderArea,$O,t.clearDepth,t.clearStencil),i.setScissor(e.generateScissor(t)),i.setViewport(e.generateViewport(t)),i.bindDescriptorSet(Xp.GLOBAL,e.descriptorSet);for(var l=r.deferredLightingMaterial.passes[0],u=l.getShaderVariant(),h=0;h<3;++h)l.descriptorSet.bindTexture(h,o.gbufferRenderTargets[h]),l.descriptorSet.bindSampler(h,o.sampler);l.descriptorSet.bindTexture(3,o.outputDepth),l.descriptorSet.bindSampler(3,o.sampler),l.descriptorSet.update(),i.bindDescriptorSet(Xp.MATERIAL,l.descriptorSet);var f=e.quadIAOffscreen,_=null;null!=l&&null!=u&&null!=f&&(_=lv.getOrCreatePipelineState(n,l,u,c,f)),null!=_&&(i.bindPipelineState(_),i.bindInputAssembler(f),i.draw(f)),this._renderQueues.forEach(PT);for(var p=0,d=0,m=0,g=0;g<a.length;++g){var v=a[g],y=v.model.subModels;for(p=0;p<y.length;++p){var x=y[p].passes;for(d=0;d<x.length;++d)if(x[d].phase===this._phaseID)for(m=0;m<this._renderQueues.length;m++)this._renderQueues[m].insertRenderPass(v,p,d)}}if(a.length>0){this._renderQueues.forEach(IT);for(var S=0;S<this._renderQueues.length;S++)this._renderQueues[S].recordCommandBuffer(n,c,i);this._planarQueue.recordCommandBuffer(n,c,i)}this._uiPhase.render(t,c),i.endRenderPass()},e}(yx),LO.initInfo={name:"LightingStage",priority:Nx.LIGHTING,tag:0},MO=q((OO=BO).prototype,"_deferredMaterial",[wO,cl,PO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),NO=q(OO.prototype,"renderQueues",[IO,cl,RO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),DO=OO))||DO)),eM=[new va(0,0,0,1)],nM=t("PostProcessStage",(FO=nl("PostProcessStage"),zO=Bl(bv),UO=Il(),kO=Bl([AT]),GO=Il(),FO((qO=XO=function(t){function e(){var e;return X(e=t.call(this)||this,"_postProcessMaterial",jO,V(e)),X(e,"renderQueues",WO,V(e)),e._renderArea=new ua,e._uiPhase=new iA,e}F(e,t);var n=e.prototype;return n.initialize=function(e){return t.prototype.initialize.call(this,e),!0},n.activate=function(e,n){t.prototype.activate.call(this,e,n),this._postProcessMaterial&&(e.pipelineSceneData.postprocessMaterial=this._postProcessMaterial),this._uiPhase.activate(e)},n.destroy=function(){},n.render=function(t){var e=this._pipeline,n=e.device,i=e.pipelineSceneData,r=e.commandBuffers[0];e.pipelineUBO.updateCameraUBO(t);var a=t.viewport;this._renderArea.x=a.x*t.window.width,this._renderArea.y=a.y*t.window.height,this._renderArea.width=a.width*t.window.width,this._renderArea.height=a.height*t.window.height;var o=e.getPipelineRenderData(),s=t.window.framebuffer,c=e.getRenderPass(t.clearFlag,s);t.clearFlag&na.COLOR&&(eM[0].x=t.clearColor.x,eM[0].y=t.clearColor.y,eM[0].z=t.clearColor.z),eM[0].w=t.clearColor.w,r.beginRenderPass(c,s,this._renderArea,eM,t.clearDepth,t.clearStencil),r.bindDescriptorSet(Xp.GLOBAL,e.descriptorSet);var l=i.postprocessMaterial.passes[0],u=l.getShaderVariant();e.bloomEnabled?l.descriptorSet.bindTexture(0,o.bloom.combineTex):l.descriptorSet.bindTexture(0,o.outputRenderTargets[0]),l.descriptorSet.bindSampler(0,o.sampler),l.descriptorSet.update(),r.bindDescriptorSet(Xp.MATERIAL,l.descriptorSet);var h=t.window.swapchain?e.quadIAOnscreen:e.quadIAOffscreen,f=null;null!=l&&null!=u&&null!=h&&(f=lv.getOrCreatePipelineState(n,l,u,c,h));var _=e.pipelineSceneData.renderObjects;null!=f&&_.length>0&&(r.bindPipelineState(f),r.bindInputAssembler(h),r.draw(h)),this._uiPhase.render(t,c),Ev(n,c,r,e.profiler,t),r.endRenderPass()},e}(yx),XO.initInfo={name:"PostProcessStage",priority:Dx.POST_PROCESS,tag:0},jO=q((VO=qO).prototype,"_postProcessMaterial",[zO,cl,UO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),WO=q(VO.prototype,"renderQueues",[kO,cl,GO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),HO=VO))||HO));!function(t){t[t.NONE=0]="NONE",t[t.FXAA=1]="FXAA"}(YO||(YO={}));var iM,rM,aM,oM,sM,cM,lM,uM,hM=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._antiAliasing=YO.NONE,e}F(e,t);var n=e.prototype;return n.onGlobalPipelineStateChanged=function(){this.updatePipelinePassInfo()},n.updateBloomPass=function(){if(this._bloomMaterial){var t=this._bloomMaterial.passes[0];t.beginChangeStatesSilently(),t.tryCompile(),t.endChangeStatesSilently();for(var e=[],n=[],i=0;i<6;++i){var r=this._bloomMaterial.passes[1+i];r.beginChangeStatesSilently(),r.tryCompile(),r.endChangeStatesSilently();var a=this._bloomMaterial.passes[7+i];a.beginChangeStatesSilently(),a.tryCompile(),a.endChangeStatesSilently(),e.push(r.native),n.push(a.native)}var o=this._bloomMaterial.passes[13];o.beginChangeStatesSilently(),o.tryCompile(),o.endChangeStatesSilently()}},n.updatePostProcessPass=function(){if(this.postprocessMaterial){var t=this.postprocessMaterial.passes[0];t.beginChangeStatesSilently(),t.tryCompile(),t.endChangeStatesSilently()}},n.initPipelinePassInfo=function(){var t=new bv;t._uuid="builtin-deferred-material",t.initialize({effectName:"deferred-lighting"});for(var e=0;e<t.passes.length;++e)t.passes[e].tryCompile();this._deferredLightingMaterial=t;var n=new bv;n._uuid="builtin-bloom-material",n.initialize({effectName:"bloom"});for(var i=0;i<n.passes.length;++i)n.passes[i].tryCompile();this._bloomMaterial=n;var r=new bv;r._uuid="builtin-post-process-material",$t.ENABLE_ANTIALIAS_FXAA&&(this._antiAliasing=YO.FXAA),r.initialize({effectName:"post-process",defines:{ANTIALIAS_TYPE:this._antiAliasing}});for(var a=0;a<r.passes.length;++a)r.passes[a].tryCompile();this._postprocessMaterial=r,this.updatePipelinePassInfo()},n.updatePipelinePassInfo=function(){this.updateBloomPass(),this.updatePostProcessPass(),this.updateDeferredPassInfo()},n.activate=function(e,n){return t.prototype.activate.call(this,e,n),this.initPipelinePassInfo(),!0},n.updateDeferredPassInfo=function(){this.updateDeferredLightPass()},n.updateDeferredLightPass=function(){if(this._deferredLightingMaterial){this.shadows.enabled&&(this._pipeline.macros.CC_RECEIVE_SHADOW=1);var t=this._deferredLightingMaterial.passes[0];t.beginChangeStatesSilently(),t.tryCompile(),t.endChangeStatesSilently()}},L(e,[{key:"antiAliasing",get:function(){return this._antiAliasing},set:function(t){if(this._antiAliasing=t,this._postprocessMaterial){var e=this._postprocessMaterial.passes[0].defines;Object.assign(e,{ANTIALIAS_TYPE:t});var n=new bv;n.initialize({effectAsset:this._postprocessMaterial.effectAsset,defines:e});for(var i=0;i<n.passes.length;++i)n.passes[i].tryCompile();this._postprocessMaterial=n}}},{key:"bloomMaterial",get:function(){return this._bloomMaterial},set:function(t){this._bloomMaterial!==t&&t&&(this._bloomMaterial=t,this.updatePipelinePassInfo())}},{key:"postprocessMaterial",get:function(){return this._postprocessMaterial},set:function(t){this._postprocessMaterial!==t&&t&&(this._postprocessMaterial=t,this.updatePipelinePassInfo())}},{key:"deferredLightingMaterial",get:function(){return this._deferredLightingMaterial},set:function(t){this._deferredLightingMaterial!==t&&t&&(this._deferredLightingMaterial=t,this.updatePipelinePassInfo())}}]),e}(KO),fM=[new va(0,0,0,1)],_M=function(){};_M.SIZE=4*(_M.COUNT=4+(_M.TEXTURE_SIZE_OFFSET=0));var pM,dM,mM,gM,vM,yM,xM,SM,TM,AM,EM=t("BloomStage",(iM=nl("BloomStage"),rM=Bl(bv),aM=Il(),iM((uM=lM=function(t){function e(){var e;return(e=t.call(this)||this).threshold=1,e.intensity=.8,e.iterations=2,X(e,"_bloomMaterial",cM,V(e)),e._renderArea=new ua,e._bloomUBO=[],e}F(e,t);var n=e.prototype;return n.initialize=function(e){return t.prototype.initialize.call(this,e),!0},n.activate=function(e,n){t.prototype.activate.call(this,e,n),this._bloomMaterial&&(e.pipelineSceneData.bloomMaterial=this._bloomMaterial)},n.destroy=function(){},n.render=function(t){var e,n=this._pipeline;if(n.generateBloomRenderData(),((null===(e=t.window)||void 0===e?void 0:e.swapchain)||n.macros.CC_PIPELINE_TYPE)&&n.bloomEnabled&&0!==n.pipelineSceneData.renderObjects.length){if(0===this._bloomUBO.length)for(var i=0;i<14;++i)this._bloomUBO[i]=n.device.createBuffer(new Ta(Er.UNIFORM|Er.TRANSFER_DST,wr.HOST|wr.DEVICE,_M.SIZE,_M.SIZE));t.clearFlag&na.COLOR&&(fM[0].x=t.clearColor.x,fM[0].y=t.clearColor.y,fM[0].z=t.clearColor.z),fM[0].w=t.clearColor.w,this._prefilterPass(t,n),this._downsamplePass(t,n),this._upsamplePass(t,n),this._combinePass(t,n)}},n._prefilterPass=function(t,e){e.generateRenderArea(t,this._renderArea),this._renderArea.width>>=1,this._renderArea.height>>=1;var n=e.commandBuffers[0],i=e.pipelineSceneData.bloomMaterial.passes[0],r=e.getPipelineRenderData(),a=r.bloom,o=new Float32Array(_M.COUNT);o[_M.TEXTURE_SIZE_OFFSET+2]=this.threshold,n.updateBuffer(this._bloomUBO[0],o),n.beginRenderPass(a.renderPass,a.prefilterFramebuffer,this._renderArea,fM,0,0),n.bindDescriptorSet(Xp.GLOBAL,e.descriptorSet),i.descriptorSet.bindBuffer(0,this._bloomUBO[0]),i.descriptorSet.bindTexture(1,r.outputRenderTargets[0]),i.descriptorSet.bindSampler(1,a.sampler),i.descriptorSet.update(),n.bindDescriptorSet(Xp.MATERIAL,i.descriptorSet);var s=t.window.swapchain?e.quadIAOffscreen:e.quadIAOnscreen,c=null,l=i.getShaderVariant();null!=i&&null!=l&&null!=s&&(c=lv.getOrCreatePipelineState(e.device,i,l,a.renderPass,s)),null!=c&&(n.bindPipelineState(c),n.bindInputAssembler(s),n.draw(s)),n.endRenderPass()},n._downsamplePass=function(t,e){e.generateRenderArea(t,this._renderArea),this._renderArea.width>>=1,this._renderArea.height>>=1;for(var n=e.commandBuffers[0],i=e.pipelineSceneData.bloomMaterial,r=e.getPipelineRenderData().bloom,a=new Float32Array(_M.COUNT),o=0;o<this.iterations;++o){a[_M.TEXTURE_SIZE_OFFSET+0]=this._renderArea.width,a[_M.TEXTURE_SIZE_OFFSET+1]=this._renderArea.height,n.updateBuffer(this._bloomUBO[o+1],a),this._renderArea.width>>=1,this._renderArea.height>>=1,n.beginRenderPass(r.renderPass,r.downsampleFramebuffers[o],this._renderArea,fM,0,0);var s=i.passes[1+o],c=s.getShaderVariant();s.descriptorSet.bindBuffer(0,this._bloomUBO[o+1]),0===o?s.descriptorSet.bindTexture(1,r.prefiterTex):s.descriptorSet.bindTexture(1,r.downsampleTexs[o-1]),s.descriptorSet.bindSampler(1,r.sampler),s.descriptorSet.update(),n.bindDescriptorSet(Xp.MATERIAL,s.descriptorSet);var l=t.window.swapchain?e.quadIAOffscreen:e.quadIAOnscreen,u=null;null!=s&&null!=c&&null!=l&&(u=lv.getOrCreatePipelineState(e.device,s,c,r.renderPass,l)),null!=u&&(n.bindPipelineState(u),n.bindInputAssembler(l),n.draw(l)),n.endRenderPass()}},n._upsamplePass=function(t,e){var n=e.getPipelineRenderData().bloom;e.generateRenderArea(t,this._renderArea),this._renderArea.width>>=this.iterations+1,this._renderArea.height>>=this.iterations+1;for(var i=e.commandBuffers[0],r=e.pipelineSceneData.bloomMaterial,a=new Float32Array(_M.COUNT),o=0;o<this.iterations;++o){var s=o+6+1;a[_M.TEXTURE_SIZE_OFFSET+0]=this._renderArea.width,a[_M.TEXTURE_SIZE_OFFSET+1]=this._renderArea.height,i.updateBuffer(this._bloomUBO[s],a),this._renderArea.width<<=1,this._renderArea.height<<=1,i.beginRenderPass(n.renderPass,n.upsampleFramebuffers[this.iterations-1-o],this._renderArea,fM,0,0);var c=r.passes[7+o],l=c.getShaderVariant();c.descriptorSet.bindBuffer(0,this._bloomUBO[s]),0===o?c.descriptorSet.bindTexture(1,n.downsampleTexs[this.iterations-1]):c.descriptorSet.bindTexture(1,n.upsampleTexs[this.iterations-o]),c.descriptorSet.bindSampler(1,n.sampler),c.descriptorSet.update(),i.bindDescriptorSet(Xp.MATERIAL,c.descriptorSet);var u=t.window.swapchain?e.quadIAOffscreen:e.quadIAOnscreen,h=null;null!=c&&null!=l&&null!=u&&(h=lv.getOrCreatePipelineState(e.device,c,l,n.renderPass,u)),null!=h&&(i.bindPipelineState(h),i.bindInputAssembler(u),i.draw(u)),i.endRenderPass()}},n._combinePass=function(t,e){e.generateRenderArea(t,this._renderArea);var n=e.commandBuffers[0],i=e.pipelineSceneData.bloomMaterial,r=e.getPipelineRenderData(),a=r.bloom,o=new Float32Array(_M.COUNT);o[_M.TEXTURE_SIZE_OFFSET+3]=this.intensity,n.updateBuffer(this._bloomUBO[13],o),n.beginRenderPass(a.renderPass,a.combineFramebuffer,this._renderArea,fM,0,0),n.bindDescriptorSet(Xp.GLOBAL,e.descriptorSet);var s=i.passes[13];s.descriptorSet.bindBuffer(0,this._bloomUBO[13]),s.descriptorSet.bindTexture(1,r.outputRenderTargets[0]),s.descriptorSet.bindTexture(2,a.upsampleTexs[0]),s.descriptorSet.bindSampler(1,a.sampler),s.descriptorSet.bindSampler(2,a.sampler),s.descriptorSet.update(),n.bindDescriptorSet(Xp.MATERIAL,s.descriptorSet);var c=t.window.swapchain?e.quadIAOffscreen:e.quadIAOnscreen,l=null,u=s.getShaderVariant();null!=s&&null!=u&&null!=c&&(l=lv.getOrCreatePipelineState(e.device,s,u,a.renderPass,c)),null!=l&&(n.bindPipelineState(l),n.bindInputAssembler(c),n.draw(c)),n.endRenderPass()},e}(yx),lM.initInfo={name:"BloomStage",priority:Dx.BLOOM,tag:0},cM=q((sM=uM).prototype,"_bloomMaterial",[rM,cl,aM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),oM=sM))||oM)),CM=t("MainFlow",nl("MainFlow")((mM=dM=function(t){function e(){return t.apply(this,arguments)||this}F(e,t);var n=e.prototype;return n.initialize=function(e){if(t.prototype.initialize.call(this,e),0===this._stages.length){var n=new JO;n.initialize(JO.initInfo),this._stages.push(n);var i=new tM;i.initialize(tM.initInfo),this._stages.push(i);var r=new EM;r.initialize(EM.initInfo),this._stages.push(r);var a=new nM;a.initialize(nM.initInfo),this._stages.push(a)}return!0},n.activate=function(e){t.prototype.activate.call(this,e)},n.render=function(e){t.prototype.render.call(this,e)},n.destroy=function(){t.prototype.destroy.call(this)},e}(Sx),dM.initInfo={name:Fp,priority:Lx.MAIN,stages:[]},pM=mM))||pM),bM=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).gbufferFrameBuffer=null,e.gbufferRenderTargets=[],e}return F(e,t),e}((function(){this.outputFrameBuffer=null,this.outputRenderTargets=[],this.outputDepth=null,this.sampler=null,this.bloom=null})),wM=t("DeferredPipeline",(gM=nl("DeferredPipeline"),vM=Bl([xT]),yM=Il(),gM((AM=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._gbufferRenderPass=null,e._lightingRenderPass=null,X(e,"renderTextures",TM,V(e)),e}F(e,t);var n=e.prototype;return n.initialize=function(e){if(t.prototype.initialize.call(this,e),0===this._flows.length){var n=new EA;n.initialize(EA.initInfo),this._flows.push(n);var i=new CM;i.initialize(CM.initInfo),this._flows.push(i)}return!0},n.activate=function(e){return this._macros={CC_PIPELINE_TYPE:1},this._pipelineSceneData=new hM,!(!t.prototype.activate.call(this,e)||!this._activeRenderer(e)&&(b(2402),1))},n.destroy=function(){this._destroyUBOs(),this._destroyQuadInputAssembler(),this._destroyDeferredData();for(var e=this._renderPasses.values(),n=e.next();!n.done;)n.value.destroy(),n=e.next();return this._commandBuffers.length=0,t.prototype.destroy.call(this)},n.getPipelineRenderData=function(){return this._pipelineRenderData||this._generateDeferredRenderData(),this._pipelineRenderData},n._activeRenderer=function(t){var e=this.device;this._commandBuffers.push(e.commandBuffer);var n=this.globalDSManager.pointSampler;this._descriptorSet.bindSampler($p,n),this._descriptorSet.bindTexture($p,Lg.get("default-texture").getGFXTexture()),this._descriptorSet.bindSampler(cd,n),this._descriptorSet.bindTexture(cd,Lg.get("default-texture").getGFXTexture()),this._descriptorSet.update();var i=new Gx;if(!(i=this._createQuadInputAssembler()).quadIB||!i.quadVB||!i.quadIA)return!1;this._quadIB=i.quadIB,this._quadVBOffscreen=i.quadVB,this._quadIAOffscreen=i.quadIA;var r=this._createQuadInputAssembler();if(!r.quadIB||!r.quadVB||!r.quadIA)return!1;if(this._quadVBOnscreen=r.quadVB,this._quadIAOnscreen=r.quadIA,!this._gbufferRenderPass){var a=new Ha;a.format=Sr.RGBA16F,a.loadOp=Gr.CLEAR,a.storeOp=Hr.STORE;var o=new Ha;o.format=Sr.RGBA16F,o.loadOp=Gr.CLEAR,o.storeOp=Hr.STORE;var s=new Ha;s.format=Sr.RGBA16F,s.loadOp=Gr.CLEAR,s.storeOp=Hr.STORE;var c=new Va;c.format=Sr.DEPTH_STENCIL,c.depthLoadOp=Gr.CLEAR,c.depthStoreOp=Hr.STORE,c.stencilLoadOp=Gr.CLEAR,c.stencilStoreOp=Hr.STORE;var l=new Xa([a,o,s],c);this._gbufferRenderPass=e.createRenderPass(l)}if(!this._lightingRenderPass){var u=new Ha;u.format=Sr.RGBA8,u.loadOp=Gr.CLEAR,u.storeOp=Hr.STORE,u.endAccesses=[Vr.COLOR_ATTACHMENT_WRITE];var h=new Va;h.format=Sr.DEPTH_STENCIL,h.depthLoadOp=Gr.LOAD,h.depthStoreOp=Hr.DISCARD,h.stencilLoadOp=Gr.LOAD,h.stencilStoreOp=Hr.DISCARD,h.beginAccesses=[Vr.DEPTH_STENCIL_ATTACHMENT_WRITE],h.endAccesses=[Vr.DEPTH_STENCIL_ATTACHMENT_WRITE];var f=new Xa([u],h);this._lightingRenderPass=e.createRenderPass(f)}return this._width=t.width,this._height=t.height,this._generateDeferredRenderData(),!0},n._destroyUBOs=function(){this._descriptorSet&&(this._descriptorSet.getBuffer(Qp.BINDING).destroy(),this._descriptorSet.getBuffer(Jp.BINDING).destroy(),this._descriptorSet.getBuffer(Zp.BINDING).destroy(),this._descriptorSet.getTexture($p).destroy(),this._descriptorSet.getTexture(cd).destroy())},n._destroyDeferredData=function(){var t=this._pipelineRenderData;if(t){t.gbufferFrameBuffer&&t.gbufferFrameBuffer.destroy(),t.outputFrameBuffer&&t.outputFrameBuffer.destroy(),t.outputDepth&&t.outputDepth.destroy();for(var e=0;e<t.gbufferRenderTargets.length;e++)t.gbufferRenderTargets[e].destroy();t.gbufferRenderTargets.length=0;for(var n=0;n<t.outputRenderTargets.length;n++)t.outputRenderTargets[n].destroy();t.outputRenderTargets.length=0,this._destroyBloomData()}this._pipelineRenderData=null},n._ensureEnoughSize=function(t){for(var e=this._width,n=this._height,i=0;i<t.length;++i){var r=t[i].window;e=Math.max(r.width,e),n=Math.max(r.height,n)}e===this._width&&n===this._height||(this._width=e,this._height=n,this._destroyDeferredData(),this._generateDeferredRenderData())},n._generateDeferredRenderData=function(){for(var t=this,e=this.device,n=this._pipelineRenderData=new bM,i=this.pipelineSceneData,r=0;r<3;++r)n.gbufferRenderTargets.push(e.createTexture(new wa(Pr.TEX2D,Ir.COLOR_ATTACHMENT|Ir.SAMPLED,Sr.RGBA16F,this._width*i.shadingScale,this._height*i.shadingScale)));n.outputDepth=e.createTexture(new wa(Pr.TEX2D,Ir.DEPTH_STENCIL_ATTACHMENT|Ir.SAMPLED,Sr.DEPTH_STENCIL,this._width*i.shadingScale,this._height*i.shadingScale)),n.gbufferFrameBuffer=e.createFramebuffer(new Ka(this._gbufferRenderPass,n.gbufferRenderTargets,n.outputDepth)),n.outputRenderTargets.push(e.createTexture(new wa(Pr.TEX2D,Ir.COLOR_ATTACHMENT|Ir.SAMPLED,Sr.RGBA16F,this._width*i.shadingScale,this._height*i.shadingScale))),n.outputFrameBuffer=e.createFramebuffer(new Ka(this._lightingRenderPass,n.outputRenderTargets,null)),this.on(xx.ATTACHMENT_SCALE_CAHNGED,(function(e){n.sampler=e<1?t.globalDSManager.pointSampler:t.globalDSManager.linearSampler,t.applyFramebufferRatio(n.gbufferFrameBuffer),t.applyFramebufferRatio(n.outputFrameBuffer)})),n.sampler=this.globalDSManager.linearSampler},e}(Hx),TM=q((SM=AM).prototype,"renderTextures",[vM,cl,yM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),xM=SM))||xM));function PM(){var t=new QO;return t.initialize({flows:[]}),t}var IM=new Ni,RM=function(){var t=e.prototype;function e(){this.handle=0,this.callBack=null,this.cancelAnimate=!1,this.startTime=-1,this.isPause=!1,this._splashFinish=!1,this._loadFinish=!1,this._directCall=!1}return t.pauseRendering=function(){this.isPause=!0},t.resumeRendering=function(){this.isPause=!1},t.main=function(t){if(null!=t){if(window._CCSettings&&window._CCSettings.splashScreen){var e=this.settings=window._CCSettings.splashScreen;e.totalTime=null!=this.settings.totalTime?this.settings.totalTime:3e3,e.base64src=this.settings.base64src||"",e.effect=this.settings.effect||"FADE-INOUT",e.clearColor=this.settings.clearColor||new va(.88,.88,.88,1),e.displayRatio=null!=this.settings.displayRatio?this.settings.displayRatio:.4,e.displayWatermark=null==this.settings.displayWatermark||this.settings.displayWatermark}else this.settings={totalTime:3e3,base64src:"",effect:"FADE-INOUT",clearColor:new va(.88,.88,.88,1),displayRatio:.4,displayWatermark:!0};if(""===this.settings.base64src||this.settings.totalTime<=0)this.callBack&&this.callBack(),this.callBack=null,this.settings=null,this._directCall=!0;else{i.view.resizeWithBrowserSize(!0);var n=window._CCSettings.designResolution;n?i.view.setDesignResolutionSize(n.width,n.height,n.policy):i.view.setDesignResolutionSize(960,640,4),this.device=t.device,this.swapchain=t.mainWindow.swapchain,this.framebuffer=t.mainWindow.framebuffer,i.game.once(i.Game.EVENT_GAME_INITED,(function(){i.director._lateUpdate=performance.now()}),i.director),this.callBack=null,this.cancelAnimate=!1,this.startTime=-1,this.preInit(),this.logoImage=new Image,this.logoImage.onload=this.init.bind(this),this.logoImage.src=this.settings.base64src}}else d("RENDER ROOT IS NULL.")},t.setOnFinish=function(t){if(this._directCall&&t)return e._ins=void 0,void t();this.callBack=t},t._tryToStart=function(){this._splashFinish&&this._loadFinish&&this.callBack&&(this.callBack(),this.hide(),i.game.resume())},t.preInit=function(){var t=this.settings.clearColor;this.clearColors=[new va(t.x,t.y,t.z,t.w)];var e=this.device,n=this.swapchain;this.renderArea=new ua(0,0,n.width,n.height),this.cmdBuff=e.commandBuffer;var i=new Float32Array([.5,.5,1,0,-.5,.5,0,0,.5,-.5,1,1,-.5,-.5,0,1]),r=4*Float32Array.BYTES_PER_ELEMENT,a=4*r;this.vertexBuffers=e.createBuffer(new Ta(Er.VERTEX|Er.TRANSFER_DST,wr.DEVICE,a,r)),this.vertexBuffers.update(i);var o=new Uint16Array([0,1,2,1,3,2]),s=Uint16Array.BYTES_PER_ELEMENT,c=6*s;this.indicesBuffers=e.createBuffer(new Ta(Er.INDEX|Er.TRANSFER_DST,wr.DEVICE,c,s)),this.indicesBuffers.update(o);var l=[new Ua("a_position",Sr.RG32F),new Ua("a_texCoord",Sr.RG32F)],u=new Ga(l,[this.vertexBuffers],this.indicesBuffers);this.quadAssmebler=e.createInputAssembler(u),this.projection=new Ri,Ri.ortho(this.projection,-1,1,-1,1,-1,1,e.capabilities.clipSpaceMinZ,e.capabilities.clipSpaceSignY,n.surfaceTransform)},t.init=function(){var t=this;this.initLogo(),this.settings.displayWatermark&&this.initWarterMark(),i.game.pause(),this.handle=requestAnimationFrame((function e(n){if(!t.cancelAnimate){var i=t.settings,r=t.device,a=t.swapchain;Ri.ortho(t.projection,-1,1,-1,1,-1,1,r.capabilities.clipSpaceMinZ,r.capabilities.clipSpaceSignY,a.surfaceTransform);var o=a.width,s=a.height,c=o<s?o:s;t.startTime<0&&(t.startTime=n);var l=n-t.startTime,u=pf(Kn(l/i.totalTime));"NONE"===i.effect&&(u=1);var h=t.logoTexture.width,f=t.logoTexture.height,_=c*i.displayRatio,p=_*h/f,d=_;if(a.surfaceTransform!==yr.ROTATE_90&&a.surfaceTransform!==yr.ROTATE_270||(p=_*o/s,d=_*f/h*s/o),t.logoMat.setProperty("resolution",IM.set(o,s),0),t.logoMat.setProperty("scale",IM.set(p,d),0),t.logoMat.setProperty("translate",IM.set(.5*o,.5*s),0),t.logoMat.setProperty("percent",u),t.logoMat.setProperty("u_projection",t.projection),t.logoMat.passes[0].update(),i.displayWatermark&&t.watermarkMat){var m=.5*c,g=t.watermarkTexture.width,v=m,y=m*t.watermarkTexture.height/g;a.surfaceTransform!==yr.ROTATE_90&&a.surfaceTransform!==yr.ROTATE_270||(v=.5*m,y=m*o/s*.5),t.watermarkMat.setProperty("resolution",IM.set(o,s),0),t.watermarkMat.setProperty("scale",IM.set(v,y),0),t.watermarkMat.setProperty("translate",IM.set(.5*o,.1*s),0),t.watermarkMat.setProperty("percent",u),t.watermarkMat.setProperty("u_projection",t.projection),t.watermarkMat.passes[0].update()}t.isPause||(t.frame(),l>i.totalTime&&(t.splashFinish=!0)),requestAnimationFrame(e)}}))},t.hide=function(){cancelAnimationFrame(this.handle),this.cancelAnimate=!0,setTimeout(this.destroy.bind(this))},t.initLogo=function(){var t=this.device;this.logoMat=new bv,this.logoMat.initialize({effectName:"splash-screen"});var e=new Ia;e.addressU=Nr.CLAMP,e.addressV=Nr.CLAMP,e.addressW=Nr.CLAMP,this.sampler=t.getSampler(e),this.logoTexture=t.createTexture(new wa(Pr.TEX2D,Ir.SAMPLED|Ir.TRANSFER_DST,Sr.RGBA8,this.logoImage.width,this.logoImage.height));var n=this.logoMat.passes[0],i=n.getBinding("mainTexture");n.bindTexture(i,this.logoTexture),this.shader=n.getShaderVariant();var r=n.descriptorSet;r.bindSampler(i,this.sampler),r.update();var a=new ma;a.texExtent.width=this.logoImage.width,a.texExtent.height=this.logoImage.height,a.texExtent.depth=1,t.copyTexImagesToTexture([this.logoImage],this.logoTexture,[a])},t.initWarterMark=function(){var t=document.createElement("canvas");t.width=330,t.height=30,t.style.width=""+t.width,t.style.height=""+t.height;var e=t.getContext("2d");e.font="18px Arial",e.textBaseline="top",e.textAlign="left",e.fillStyle="`#424242`";var n="Powered by Cocos Creator",i=e.measureText(n);e.fillText(n,(330-i.width)/2,6);var r=new ma;r.texExtent.width=t.width,r.texExtent.height=t.height,r.texExtent.depth=1,this.watermarkTexture=this.device.createTexture(new wa(Pr.TEX2D,Ir.SAMPLED|Ir.TRANSFER_DST,Sr.RGBA8,t.width,t.height)),this.device.copyTexImagesToTexture([t],this.watermarkTexture,[r]),this.watermarkMat=new bv,this.watermarkMat.initialize({effectName:"splash-screen"});var a=this.watermarkMat.passes[0],o=a.getBinding("mainTexture");a.bindTexture(o,this.watermarkTexture),a.descriptorSet.update()},t.frame=function(){var t=this.device,e=this.swapchain;t.acquire([e]);var n=this.cmdBuff,i=this.framebuffer,r=this.renderArea;r.width=e.width,r.height=e.height,n.begin(),n.beginRenderPass(i.renderPass,i,r,this.clearColors,1,0);var a=this.logoMat.passes[0],o=lv.getOrCreatePipelineState(t,a,this.shader,i.renderPass,this.quadAssmebler);if(n.bindPipelineState(o),n.bindDescriptorSet(Xp.MATERIAL,a.descriptorSet),n.bindInputAssembler(this.quadAssmebler),n.draw(this.quadAssmebler),this.settings.displayWatermark&&this.watermarkMat){var s=this.watermarkMat.passes[0],c=lv.getOrCreatePipelineState(t,s,this.shader,i.renderPass,this.quadAssmebler);n.bindPipelineState(c),n.bindDescriptorSet(Xp.MATERIAL,s.descriptorSet),n.bindInputAssembler(this.quadAssmebler),n.draw(this.quadAssmebler)}n.endRenderPass(),n.end(),t.flushCommands([n]),t.queue.submit([n]),t.present()},t.destroy=function(){this.callBack=null,this.device=null,this.swapchain=null,this.clearColors=null,this.logoImage.destroy&&this.logoImage.destroy(),this.logoImage=null,this.framebuffer=null,this.renderArea=null,this.cmdBuff=null,this.shader=null,this.logoMat.destroy(),this.logoMat=null,this.logoTexture.destroy(),this.logoTexture=null,this.quadAssmebler.destroy(),this.quadAssmebler=null,this.vertexBuffers.destroy(),this.vertexBuffers=null,this.indicesBuffers.destroy(),this.indicesBuffers=null,this.sampler=null,this.watermarkTexture&&(this.watermarkMat.destroy(),this.watermarkMat=null,this.watermarkTexture.destroy(),this.watermarkTexture=null),this.settings=null,e._ins=void 0},L(e,[{key:"splashFinish",set:function(t){this._splashFinish=t,this._tryToStart()}},{key:"loadFinish",set:function(t){this._loadFinish=t,this._tryToStart()}}],[{key:"instance",get:function(){return e._ins||(e._ins=new e),e._ins}}]),e}();RM._ins=void 0,i.internal.SplashScreen=RM;var DM=t("System",function(){function t(){this._id="",this._priority=0,this._executeInEditMode=!1}t.sortByPriority=function(t,e){return t._priority<e._priority?1:t._priority>e.priority?-1:0};var e=t.prototype;return e.init=function(){},e.update=function(){},e.postUpdate=function(){},L(t,[{key:"priority",get:function(){return this._priority},set:function(t){this._priority=t}},{key:"id",get:function(){return this._id},set:function(t){this._id=t}}]),t}());DM.Priority=Yt({LOW:0,MEDIUM:100,HIGH:200,SCHEDULER:1<<31>>>0});var OM=new tt("Scheduler"),MM=function(t,e,n,i){this.target=void 0,this.priority=void 0,this.paused=void 0,this.markedForDeletion=void 0,this.target=t,this.priority=e,this.paused=n,this.markedForDeletion=i};MM.get=function(t,e,n,i){var r=MM._listEntries.pop();return r?(r.target=t,r.priority=e,r.paused=n,r.markedForDeletion=i):r=new MM(t,e,n,i),r},MM.put=function(t){MM._listEntries.length<20&&(t.target=null,MM._listEntries.push(t))},MM._listEntries=[];var NM=function(t,e,n,i){this.list=void 0,this.entry=void 0,this.target=void 0,this.callback=void 0,this.list=t,this.entry=e,this.target=n,this.callback=i};NM.get=function(t,e,n,i){var r=NM._hashUpdateEntries.pop();return r?(r.list=t,r.entry=e,r.target=n,r.callback=i):r=new NM(t,e,n,i),r},NM.put=function(t){NM._hashUpdateEntries.length<20&&(t.list=t.entry=t.target=t.callback=null,NM._hashUpdateEntries.push(t))},NM._hashUpdateEntries=[];var LM=function(t,e,n,i,r,a){this.timers=void 0,this.target=void 0,this.timerIndex=void 0,this.currentTimer=void 0,this.currentTimerSalvaged=void 0,this.paused=void 0,this.timers=t,this.target=e,this.timerIndex=n,this.currentTimer=i,this.currentTimerSalvaged=r,this.paused=a};LM.get=function(t,e,n,i,r,a){var o=LM._hashTimerEntries.pop();return o?(o.timers=t,o.target=e,o.timerIndex=n,o.currentTimer=i,o.currentTimerSalvaged=r,o.paused=a):o=new LM(t,e,n,i,r,a),o},LM.put=function(t){LM._hashTimerEntries.length<20&&(t.timers=t.target=t.currentTimer=null,LM._hashTimerEntries.push(t))},LM._hashTimerEntries=[];var BM=function(){function t(){this._lock=void 0,this._scheduler=void 0,this._elapsed=void 0,this._runForever=void 0,this._useDelay=void 0,this._timesExecuted=void 0,this._repeat=void 0,this._delay=void 0,this._interval=void 0,this._target=void 0,this._callback=void 0,this._lock=!1,this._scheduler=null,this._elapsed=-1,this._runForever=!1,this._useDelay=!1,this._timesExecuted=0,this._repeat=0,this._delay=0,this._interval=0,this._target=null,this._callback=null}var e=t.prototype;return e.initWithCallback=function(t,e,n,r,a,o){return this._lock=!1,this._scheduler=t,this._target=n,this._callback=e,this._elapsed=-1,this._interval=r,this._delay=o,this._useDelay=this._delay>0,this._repeat=a,this._runForever=this._repeat===i.macro.REPEAT_FOREVER,!0},e.getInterval=function(){return this._interval},e.setInterval=function(t){this._interval=t},e.update=function(t){-1===this._elapsed?(this._elapsed=0,this._timesExecuted=0):(this._elapsed+=t,this._runForever&&!this._useDelay?this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0):(this._useDelay?this._elapsed>=this._delay&&(this.trigger(),this._elapsed-=this._delay,this._timesExecuted+=1,this._useDelay=!1):this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0,this._timesExecuted+=1),this._callback&&!this._runForever&&this._timesExecuted>this._repeat&&this.cancel()))},e.getCallback=function(){return this._callback},e.trigger=function(){this._target&&this._callback&&(this._lock=!0,this._callback.call(this._target,this._elapsed),this._lock=!1)},e.cancel=function(){this._scheduler.unschedule(this._callback,this._target)},t}();BM._timers=[],BM.get=function(){return BM._timers.pop()||new BM},BM.put=function(t){BM._timers.length<20&&!t._lock&&(t._scheduler=t._target=t._callback=null,BM._timers.push(t))};var FM,zM=t("Scheduler",function(t){function e(){var e;return(e=t.call(this)||this)._timeScale=void 0,e._updatesNegList=void 0,e._updates0List=void 0,e._updatesPosList=void 0,e._hashForUpdates=void 0,e._hashForTimers=void 0,e._currentTarget=void 0,e._currentTargetSalvaged=void 0,e._updateHashLocked=void 0,e._arrayForTimers=void 0,e._timeScale=1,e._updatesNegList=[],e._updates0List=[],e._updatesPosList=[],e._hashForUpdates=ft(!0),e._hashForTimers=ft(!0),e._currentTarget=null,e._currentTargetSalvaged=!1,e._updateHashLocked=!1,e._arrayForTimers=[],e}F(e,t),e.enableForTarget=function(t){var e=!1;(t.uuid||t.id)&&(e=!0),e||(t.__instanceId?E(1513):t.id=OM.getNewId())};var n=e.prototype;return n.setTimeScale=function(t){this._timeScale=t},n.getTimeScale=function(){return this._timeScale},n.update=function(t){var e,n,i,r,a;for(this._updateHashLocked=!0,1!==this._timeScale&&(t*=this._timeScale),e=0,i=(n=this._updatesNegList).length;e<i;e++)(r=n[e]).paused||r.markedForDeletion||r.target.update(t);for(e=0,i=(n=this._updates0List).length;e<i;e++)(r=n[e]).paused||r.markedForDeletion||r.target.update(t);for(e=0,i=(n=this._updatesPosList).length;e<i;e++)(r=n[e]).paused||r.markedForDeletion||r.target.update(t);var o=this._arrayForTimers;for(e=0;e<o.length;e++){if(a=o[e],this._currentTarget=a,this._currentTargetSalvaged=!1,!a.paused)for(a.timerIndex=0;a.timerIndex<a.timers.length;++a.timerIndex)a.currentTimer=a.timers[a.timerIndex],a.currentTimerSalvaged=!1,a.currentTimer.update(t),a.currentTimer=null;this._currentTargetSalvaged&&0===this._currentTarget.timers.length&&(this._removeHashElement(this._currentTarget),--e)}for(e=0,n=this._updatesNegList;e<n.length;)(r=n[e]).markedForDeletion?this._removeUpdateFromHash(r):e++;for(e=0,n=this._updates0List;e<n.length;)(r=n[e]).markedForDeletion?this._removeUpdateFromHash(r):e++;for(e=0,n=this._updatesPosList;e<n.length;)(r=n[e]).markedForDeletion?this._removeUpdateFromHash(r):e++;this._updateHashLocked=!1,this._currentTarget=null},n.schedule=function(t,e,n,r,a,o){if("function"!=typeof t){var s=t;t=e,e=s}3!==arguments.length&&4!==arguments.length&&5!==arguments.length||(o=!!r,r=i.macro.REPEAT_FOREVER,a=0),I(e,1502);var c=e.uuid||e.id;if(c){var l,u,h=this._hashForTimers[c];if(h?h.paused!==o&&E(1511):(h=LM.get(null,e,0,null,null,o),this._arrayForTimers.push(h),this._hashForTimers[c]=h),null==h.timers)h.timers=[];else for(u=0;u<h.timers.length;++u)if((l=h.timers[u])&&t===l._callback)return T(1507,l.getInterval(),n),void(l._interval=n);(l=BM.get()).initWithCallback(this,t,e,n,r,a),h.timers.push(l),this._currentTarget===h&&this._currentTargetSalvaged&&(this._currentTargetSalvaged=!1)}else b(1510)},n.scheduleUpdate=function(t,e,n){var i=t.uuid||t.id;if(i){var r=this._hashForUpdates[i];if(r&&r.entry){if(r.entry.priority===e)return r.entry.markedForDeletion=!1,void(r.entry.paused=n);if(this._updateHashLocked)return T(1506),r.entry.markedForDeletion=!1,void(r.entry.paused=n);this.unscheduleUpdate(t)}var a,o=MM.get(t,e,n,!1);0===e?(a=this._updates0List,this._appendIn(a,o)):(a=e<0?this._updatesNegList:this._updatesPosList,this._priorityIn(a,o,e)),this._hashForUpdates[i]=NM.get(a,o,t,null)}else b(1510)},n.unschedule=function(t,e){if(e&&t){var n=e.uuid||e.id;if(n){var i=this._hashForTimers[n];if(i)for(var r=i.timers,a=0,o=r.length;a<o;a++){var s=r[a];if(t===s._callback)return s!==i.currentTimer||i.currentTimerSalvaged||(i.currentTimerSalvaged=!0),r.splice(a,1),BM.put(s),i.timerIndex>=a&&i.timerIndex--,void(0===r.length&&(this._currentTarget===i?this._currentTargetSalvaged=!0:this._removeHashElement(i)))}}else b(1510)}},n.unscheduleUpdate=function(t){if(t){var e=t.uuid||t.id;if(e){var n=this._hashForUpdates[e];n&&(this._updateHashLocked?n.entry.markedForDeletion=!0:this._removeUpdateFromHash(n.entry))}else b(1510)}},n.unscheduleAllForTarget=function(t){if(t){var e=t.uuid||t.id;if(e){var n=this._hashForTimers[e];if(n){var i=n.timers;i.indexOf(n.currentTimer)>-1&&!n.currentTimerSalvaged&&(n.currentTimerSalvaged=!0);for(var r=0,a=i.length;r<a;r++)BM.put(i[r]);i.length=0,this._currentTarget===n?this._currentTargetSalvaged=!0:this._removeHashElement(n)}this.unscheduleUpdate(t)}else b(1510)}},n.unscheduleAll=function(){this.unscheduleAllWithMinPriority(DM.Priority.SCHEDULER)},n.unscheduleAllWithMinPriority=function(t){var e,n,i,r=this._arrayForTimers;for(e=r.length-1;e>=0;e--)n=r[e],this.unscheduleAllForTarget(n.target);var a=0;if(t<0)for(e=0;e<this._updatesNegList.length;)a=this._updatesNegList.length,(i=this._updatesNegList[e])&&i.priority>=t&&this.unscheduleUpdate(i.target),a===this._updatesNegList.length&&e++;if(t<=0)for(e=0;e<this._updates0List.length;)a=this._updates0List.length,(i=this._updates0List[e])&&this.unscheduleUpdate(i.target),a===this._updates0List.length&&e++;for(e=0;e<this._updatesPosList.length;)a=this._updatesPosList.length,(i=this._updatesPosList[e])&&i.priority>=t&&this.unscheduleUpdate(i.target),a===this._updatesPosList.length&&e++},n.isScheduled=function(t,e){I(t,1508),I(e,1509);var n=e.uuid||e.id;if(!n)return b(1510),!1;var i=this._hashForTimers[n];if(!i)return!1;if(null==i.timers)return!1;for(var r=i.timers,a=0;a<r.length;++a)if(t===r[a]._callback)return!0;return!1},n.pauseAllTargets=function(){return this.pauseAllTargetsWithMinPriority(DM.Priority.SCHEDULER)},n.pauseAllTargetsWithMinPriority=function(t){var e,n,i,r,a=[],o=this._arrayForTimers;for(n=0,i=o.length;n<i;n++)(e=o[n])&&(e.paused=!0,a.push(e.target));if(t<0)for(n=0;n<this._updatesNegList.length;n++)(r=this._updatesNegList[n])&&r.priority>=t&&(r.paused=!0,a.push(r.target));if(t<=0)for(n=0;n<this._updates0List.length;n++)(r=this._updates0List[n])&&(r.paused=!0,a.push(r.target));for(n=0;n<this._updatesPosList.length;n++)(r=this._updatesPosList[n])&&r.priority>=t&&(r.paused=!0,a.push(r.target));return a},n.resumeTargets=function(t){if(t)for(var e=0;e<t.length;e++)this.resumeTarget(t[e])},n.pauseTarget=function(t){I(t,1503);var e=t.uuid||t.id;if(e){var n=this._hashForTimers[e];n&&(n.paused=!0);var i=this._hashForUpdates[e];i&&(i.entry.paused=!0)}else b(1510)},n.resumeTarget=function(t){I(t,1504);var e=t.uuid||t.id;if(e){var n=this._hashForTimers[e];n&&(n.paused=!1);var i=this._hashForUpdates[e];i&&(i.entry.paused=!1)}else b(1510)},n.isTargetPaused=function(t){I(t,1505);var e=t.uuid||t.id;if(!e)return b(1510),!1;var n=this._hashForTimers[e];if(n)return n.paused;var i=this._hashForUpdates[e];return!!i&&i.entry.paused},n._removeHashElement=function(t){var e=t.target.uuid||t.target.id;delete this._hashForTimers[e];for(var n=this._arrayForTimers,i=0,r=n.length;i<r;i++)if(n[i]===t){n.splice(i,1);break}LM.put(t)},n._removeUpdateFromHash=function(t){var e=t.target.uuid||t.target.id,n=this._hashForUpdates[e];if(n){for(var i=n.list,r=n.entry,a=0,o=i.length;a<o;a++)if(i[a]===r){i.splice(a,1);break}delete this._hashForUpdates[e],MM.put(r),NM.put(n)}},n._priorityIn=function(t,e,n){for(var i=0;i<t.length;i++)if(n<t[i].priority)return void t.splice(i,0,e);t.push(e)},n._appendIn=function(t,e){t.push(e)},e}(DM));zM.ID="scheduler",i.Scheduler=zM;var UM=((FM={})[eh.PORTRAIT]=yr.IDENTITY,FM[eh.LANDSCAPE_RIGHT]=yr.ROTATE_90,FM[eh.PORTRAIT_UPSIDE_DOWN]=yr.ROTATE_180,FM[eh.LANDSCAPE_LEFT]=yr.ROTATE_270,FM),kM=function(){function t(){this._title="",this._width=1,this._height=1,this._swapchain=null,this._renderPass=null,this._colorTextures=[],this._depthStencilTexture=null,this._cameras=[],this._hasOnScreenAttachments=!1,this._hasOffScreenAttachments=!1,this._framebuffer=null}t.registerCreateFunc=function(e){e._createWindowFun=function(e){return new t(e)}};var e=t.prototype;return e.initialize=function(t,e){if(this._init(),void 0!==e.title&&(this._title=e.title),void 0!==e.swapchain&&(this._swapchain=e.swapchain),this._width=e.width,this._height=e.height,this._renderPass=t.createRenderPass(e.renderPassInfo),e.swapchain)this._setSwapchain(e.swapchain),this._colorTextures.push(e.swapchain.colorTexture),this._depthStencilTexture=e.swapchain.depthStencilTexture;else{for(var n=0;n<e.renderPassInfo.colorAttachments.length;n++)this._colorTextures.push(t.createTexture(new wa(Pr.TEX2D,Ir.COLOR_ATTACHMENT|Ir.SAMPLED|Ir.TRANSFER_SRC,e.renderPassInfo.colorAttachments[n].format,this._width,this._height)));e.renderPassInfo.depthStencilAttachment.format!==Sr.UNKNOWN&&(this._depthStencilTexture=t.createTexture(new wa(Pr.TEX2D,Ir.DEPTH_STENCIL_ATTACHMENT|Ir.SAMPLED,e.renderPassInfo.depthStencilAttachment.format,this._width,this._height)))}return this._setFrameBuffer(t.createFramebuffer(new Ka(this._renderPass,this._colorTextures,this._depthStencilTexture))),!0},e.destroy=function(){this.clearCameras(),this._framebuffer&&(this._framebuffer.destroy(),this._framebuffer=null),this._depthStencilTexture&&(this._depthStencilTexture.destroy(),this._depthStencilTexture=null);for(var t=0;t<this._colorTextures.length;t++){var e=this._colorTextures[t];e&&e.destroy()}this._colorTextures.length=0,this._destroy()},e.resize=function(t,e){if(this._swapchain)this._swapchain.resize(t,e,UM[oh.orientation]),this._width=this._swapchain.width,this._height=this._swapchain.height;else{for(var n=0;n<this._colorTextures.length;n++)this._colorTextures[n].resize(t,e);this._depthStencilTexture&&this._depthStencilTexture.resize(t,e),this._width=t,this._height=e}this.framebuffer&&(this.framebuffer.destroy(),this.framebuffer.initialize(new Ka(this._renderPass,this._colorTextures,this._depthStencilTexture)));for(var i,r=W(this._cameras);!(i=r()).done;)i.value.resize(t,e)},e.extractRenderCameras=function(t){for(var e=0;e<this._cameras.length;e++){var n=this._cameras[e];n.enabled&&(n.update(),t.push(n))}},e.attachCamera=function(t){for(var e=0;e<this._cameras.length;e++)if(this._cameras[e]===t)return;this._cameras.push(t),this.sortCameras()},e.detachCamera=function(t){for(var e=0;e<this._cameras.length;++e)if(this._cameras[e]===t)return void this._cameras.splice(e,1)},e.clearCameras=function(){this._cameras.length=0},e.sortCameras=function(){this._cameras.sort((function(t,e){return t.priority-e.priority}))},e._init=function(){},e._destroy=function(){},e._setSwapchain=function(t){this._swapchain=t},e._setFrameBuffer=function(t){this._framebuffer=t},L(t,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"swapchain",get:function(){return this._swapchain}},{key:"framebuffer",get:function(){return this._framebuffer}},{key:"cameras",get:function(){return this._cameras}},{key:"native",get:function(){return this._nativeObj}}]),t}(),GM=function(){var t=e.prototype;function e(t){var e=this;this._createSceneFun=null,this._createWindowFun=null,this._device=void 0,this._windows=[],this._mainWindow=null,this._curWindow=null,this._tempWindow=null,this._pipeline=null,this._batcher=null,this._dataPoolMgr=void 0,this._scenes=[],this._modelPools=new Map,this._cameraPool=null,this._lightPools=new Map,this._fpsTime=0,this._frameCount=0,this._fps=0,this._fixedFPS=0,this._useDeferredPipeline=!1,this._fixedFPSFrameTime=0,this._cumulativeTime=0,this._frameTime=0,this._device=t,this._dataPoolMgr=i.internal.DataPoolManager&&new i.internal.DataPoolManager(t),sv.registerCreateFunc(this),kM.registerCreateFunc(this),this._cameraPool=new jt((function(){return new mm(e._device)}),4,(function(t){return t.destroy()}))}return t._init=function(){},t._destroy=function(){},t._setCumulativeTime=function(t){this._cumulativeTime+=t},t._setFrameTime=function(t){this._frameTime=t},t.initialize=function(){this._init();var t=i.game._swapchain,e=new Ha;e.format=t.colorTexture.format;var n=new Va;n.format=t.depthStencilTexture.format,n.depthStoreOp=Hr.DISCARD,n.stencilStoreOp=Hr.DISCARD;var r=new Xa([e],n);return this._mainWindow=this.createWindow({title:"rootMainWindow",width:t.width,height:t.height,renderPassInfo:r,swapchain:t}),this._curWindow=this._mainWindow,Promise.resolve(Lg.initBuiltinRes(this._device))},t.destroy=function(){this.destroyScenes(),this._pipeline&&(this._pipeline.destroy(),this._pipeline=null),this._batcher&&(this._batcher.destroy(),this._batcher=null),this._curWindow=null,this._mainWindow=null,this.dataPoolManager.clear(),this._destroy()},t.resize=function(t,e){for(var n,i=W(this._windows);!(n=i()).done;){var r=n.value;r.swapchain&&r.resize(t,e)}},t.setRenderPipeline=function(t){t instanceof wM&&(this._useDeferredPipeline=!0);var e=!1;if(t||(t=PM(),e=!0),this._pipeline=t,this._useDeferredPipeline&&this.device.hasFeature(xr.COMPUTE_SHADER)||(this._pipeline.clusterEnabled=!1),this._pipeline.bloomEnabled=!1,!this._pipeline.activate(this._mainWindow.swapchain))return e&&this._pipeline.destroy(),this._pipeline=null,!1;var n=i.director.getScene();return n&&n.globals.activate(),this.onGlobalPipelineStateChanged(),!(!this._batcher&&i.internal.Batcher2D&&(this._batcher=new i.internal.Batcher2D(this),!this._batcher.initialize())&&(this.destroy(),1))},t.onGlobalPipelineStateChanged=function(){for(var t=0;t<this._scenes.length;t++)this._scenes[t].onGlobalPipelineStateChanged();this._pipeline.pipelineSceneData.onGlobalPipelineStateChanged()},t.activeWindow=function(t){this._curWindow=t},t.resetCumulativeTime=function(){this._setCumulativeTime(0)},t.frameMove=function(t){this._setFrameTime(t),++this._frameCount,this._setCumulativeTime(t),this._fpsTime+=t,this._fpsTime>1&&(this._fps=this._frameCount,this._frameCount=0,this._fpsTime=0);for(var e=0;e<this._scenes.length;++e)this._scenes[e].removeBatches();for(var n=this._windows,r=[],a=0;a<n.length;a++)n[a].extractRenderCameras(r);if(this._pipeline&&r.length>0){this._device.acquire([i.game._swapchain]);var o=this._scenes,s=i.director.getTotalFrames();this._batcher&&(this._batcher.update(),this._batcher.uploadBuffers());for(var c=0;c<o.length;c++)o[c].update(s);i.director.emit(i.Director.EVENT_BEFORE_COMMIT),r.sort((function(t,e){return t.priority-e.priority})),this._pipeline.render(r),this._device.present()}this._batcher&&this._batcher.reset()},t.createWindow=function(t){var e=this._createWindowFun(this);return e.initialize(this.device,t),this._windows.push(e),e},t.destroyWindow=function(t){for(var e=0;e<this._windows.length;++e)if(this._windows[e]===t)return t.destroy(),void this._windows.splice(e,1)},t.destroyWindows=function(){for(var t,e=W(this._windows);!(t=e()).done;)t.value.destroy();this._windows.length=0},t.createScene=function(t){var e=this._createSceneFun(this);return e.initialize(t),this._scenes.push(e),e},t.destroyScene=function(t){for(var e=0;e<this._scenes.length;++e)if(this._scenes[e]===t)return t.destroy(),void this._scenes.splice(e,1)},t.destroyScenes=function(){for(var t,e=W(this._scenes);!(t=e()).done;)t.value.destroy();this._scenes.length=0},t.createModel=function(t){var e=this._modelPools.get(t);e||(this._modelPools.set(t,new jt((function(){return new t}),10,(function(t){return t.destroy()}))),e=this._modelPools.get(t));var n=e.alloc();return n.initialize(),n},t.destroyModel=function(t){var e=this._modelPools.get(t.constructor);e?(e.free(t),t.scene&&t.scene.removeModel(t)):E(1300,t.constructor.name),t.destroy()},t.createCamera=function(){return this._cameraPool.alloc()},t.createLight=function(t){var e=this._lightPools.get(t);e||(this._lightPools.set(t,new jt((function(){return new t}),4,(function(t){return t.destroy()}))),e=this._lightPools.get(t));var n=e.alloc();return n.initialize(),n},t.destroyLight=function(t){var e=this._lightPools.get(t.constructor);if(e&&(e.free(t),t.scene))switch(t.type){case Mv.SPHERE:t.scene.removeSphereLight(t);break;case Mv.SPOT:t.scene.removeSpotLight(t)}t.destroy()},L(e,[{key:"device",get:function(){return this._device}},{key:"mainWindow",get:function(){return this._mainWindow}},{key:"curWindow",get:function(){return this._curWindow},set:function(t){this._curWindow=t}},{key:"tempWindow",get:function(){return this._tempWindow},set:function(t){this._tempWindow=t}},{key:"windows",get:function(){return this._windows}},{key:"pipeline",get:function(){return this._pipeline}},{key:"batcher2D",get:function(){return this._batcher}},{key:"scenes",get:function(){return this._scenes}},{key:"cumulativeTime",get:function(){return this._cumulativeTime}},{key:"frameTime",get:function(){return this._frameTime}},{key:"frameCount",get:function(){return this._frameCount}},{key:"fps",get:function(){return this._fps}},{key:"fixedFPS",get:function(){return this._fixedFPS},set:function(t){t>0?(this._fixedFPS=t,this._fixedFPSFrameTime=1e3/t):this._fixedFPSFrameTime=0}},{key:"dataPoolManager",get:function(){return this._dataPoolMgr}},{key:"useDeferredPipeline",get:function(){return this._useDeferredPipeline}}]),e}();i.Root=GM;var HM=t("Game",function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).frame=null,e.container=null,e.canvas=null,e.renderType=-1,e.eventTargetOn=t.prototype.on,e.eventTargetOnce=t.prototype.once,e.config={},e.onStart=null,e.frameTime=1e3/60,e.collisionMatrix=[],e.groupList=[],e._persistRootNodes={},e._gfxDevice=null,e._swapchain=null,e._configLoaded=!1,e._isCloning=!1,e._inited=!1,e._engineInited=!1,e._rendererInitialized=!1,e._paused=!0,e._frameRate=60,e._intervalId=0,e._initTime=0,e._startTime=0,e._deltaTime=0,e._onEngineInitedCallback=[],e}F(e,t);var n=e.prototype;return n.setFrameRate=function(t){this.frameRate=t},n.getFrameRate=function(){return this.frameRate},n.step=function(){i.director.tick(this.frameTime/1e3)},n.pause=function(){this._paused||(this._paused=!0,this._intervalId&&(window.cAF(this._intervalId),this._intervalId=0))},n.resume=function(){this._paused&&(fD._clearEvents(),this._intervalId&&(window.cAF(this._intervalId),this._intervalId=0),this._paused=!1,this._updateCallback(),this._intervalId=window.rAF(this._frameCB))},n.isPaused=function(){return this._paused},n.restart=function(){var t=this;return new Promise((function(t){return i.director.once(i.Director.EVENT_END_FRAME,(function(){return t()}))})).then((function(){for(var n in t._persistRootNodes)t.removePersistRootNode(t._persistRootNodes[n]);return i.director.getScene().destroy(),i.Object._deferredDestroy(),i.director.reset(),i.profiler.reset(),t.pause(),t._setRenderPipelineNShowSplash().then((function(){t.resume(),t._safeEmit(e.EVENT_RESTART)}))}))},n.end=function(){_n.close()},n.on=function(t,n,i,r){return(this._engineInited&&t===e.EVENT_ENGINE_INITED||this._inited&&t===e.EVENT_GAME_INITED||this._rendererInitialized&&t===e.EVENT_RENDERER_INITED)&&n.call(i),this.eventTargetOn(t,n,i,r)},n.once=function(t,n,i){return this._engineInited&&t===e.EVENT_ENGINE_INITED?n.call(i):this.eventTargetOnce(t,n,i)},n.init=function(t){var e=this;if(this._initConfig(t),ch._init({configOrientation:t.orientation||"auto",exactFitScreen:t.exactFitScreen}),this.config.assetOptions&&i.assetManager.init(this.config.assetOptions),this.config.layers)for(var n=this.config.layers,r=0;r<n.length;r++){var a=n[r],o=In(a.value);Np.addLayer(a.name,o)}return this._initEngine().then((function(){return e._initEvents(),i.director.root&&i.director.root.dataPoolManager&&i.director.root.dataPoolManager.jointTexturePool.registerCustomTextureLayouts(t.customJointTextureLayouts),e._engineInited}))},n.run=function(t,e){var n,i=this;return"function"!=typeof t&&t?(n=this.init(t),this.onStart=null!=e?e:null):this.onStart=null!=t?t:null,Ru.init(),Promise.resolve(n).then((function(){return i._setRenderPipelineNShowSplash()})).then((function(){}))},n.addPersistRootNode=function(t){if(i.Node.isNode(t)&&t.uuid){var e=t.uuid;if(!this._persistRootNodes[e]){var n=i.director._scene;if(i.isValid(n))if(t.parent){if(!(t.parent instanceof i.Scene))return void E(3801);if(t.parent!==n)return void E(3802);t._originalSceneId=n.uuid}else t.parent=n;this._persistRootNodes[e]=t,t._persistNode=!0,i.assetManager._releaseManager._addPersistNodeRef(t)}}else E(3800)},n.removePersistRootNode=function(t){var e=t.uuid||"";t===this._persistRootNodes[e]&&(delete this._persistRootNodes[e],t._persistNode=!1,t._originalSceneId="",i.assetManager._releaseManager._removePersistNodeRef(t))},n.isPersistRootNode=function(t){return!!t._persistNode},n.onEngineInitedAsync=function(t){this._onEngineInitedCallback.push(t)},n._initEngine=function(){var t=this;this._initDevice();var n=i.director;return Promise.resolve(n._init()).then((function(){i.view.init(),_("Cocos Creator v"+r),t.emit(e.EVENT_ENGINE_INITED),t._engineInited=!0,i.internal.dynamicAtlasManager&&(i.internal.dynamicAtlasManager.enabled=!$t.CLEANUP_IMAGE_CACHE)})).then((function(){var e=t._onEngineInitedCallback.map((function(t){return t()})).filter(Boolean);return t._onEngineInitedCallback.length=0,Promise.all(e)}))},n._setAnimFrame=function(){var t=this._frameRate,e=window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;60!==t&&30!==t?(window.rAF=this._stTime.bind(this),window.cAF=this._ctTime):(window.rAF=e||this._stTime.bind(this),window.cAF=window.cancelAnimationFrame||window.cancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.ocancelAnimationFrame||this._ctTime,this._updateCallback())},n._stTime=function(t){var e=performance.now(),n=Math.max(0,e-this._startTime),i=Math.max(0,this.frameTime-n);return window.setTimeout(t,i)},n._ctTime=function(t){window.clearTimeout(t)},n._calculateDT=function(t){return t||(t=performance.now()),this._deltaTime=t>this._startTime?(t-this._startTime)/1e3:0,this._deltaTime>e.DEBUG_DT_THRESHOLD&&(this._deltaTime=this.frameTime/1e3),this._startTime=t,this._deltaTime},n._updateCallback=function(){var t,e=this,n=i.director;if(30===this._frameRate){var r=!0;t=function(t){e._intervalId=window.rAF(e._frameCB),(r=!r)||n.tick(e._calculateDT(t))}}else t=function(t){n.tick(e._calculateDT(t)),e._intervalId=window.rAF(e._frameCB)};this._frameCB=t},n._runMainLoop=function(){if(this._inited){var t=this.config,e=i.director;O(!!t.showFPS),e.startAnimation(),this.resume()}},n._initConfig=function(t){"number"!=typeof t.debugMode&&(t.debugMode=w.NONE),t.exposeClassName=!!t.exposeClassName,"number"!=typeof t.frameRate&&(t.frameRate=60);var e=t.renderMode;("number"!=typeof e||e>3||e<0)&&(t.renderMode=0),t.showFPS=!!t.showFPS,v(t.debugMode),this.config=t,this._configLoaded=!0,this.frameRate=t.frameRate},n._determineRenderType=function(){var t=this.config,n=parseInt(t.renderMode,10);this.renderType=e.RENDER_TYPE_CANVAS;var i=!1;if(1===n?(this.renderType=e.RENDER_TYPE_CANVAS,i=!0):0===n||2===n?(this.renderType=e.RENDER_TYPE_WEBGL,i=!0):3===n&&(this.renderType=e.RENDER_TYPE_HEADLESS,i=!0),!i)throw new Error(R(3820,n))},n._initDevice=function(){if(!this._rendererInitialized){var t=this.config.adapter;if(t&&(this.canvas=t.canvas,this.frame=t.frame,this.container=t.container),this._determineRenderType(),this.renderType===e.RENDER_TYPE_WEBGL){var n=new Sa(Kp),r=!!window.WebGL2RenderingContext,a=window.navigator.userAgent.toLowerCase();(-1!==a.indexOf("safari")&&-1===a.indexOf("chrome")||lh.browserType===on.UC)&&(r=!1);var o=[];r&&i.WebGL2Device&&o.push(i.WebGL2Device),i.WebGLDevice&&o.push(i.WebGLDevice),i.EmptyDevice&&o.push(i.EmptyDevice),Ao.canvas=this.canvas;for(var s=0;s<o.length&&(this._gfxDevice=new o[s],!this._gfxDevice.initialize(n));s++);}else this.renderType===e.RENDER_TYPE_HEADLESS&&i.EmptyDevice&&(this._gfxDevice=new i.EmptyDevice,this._gfxDevice.initialize(new Sa(Kp)));if(!this._gfxDevice)return d("can not support canvas rendering in 3D"),void(this.renderType=e.RENDER_TYPE_CANVAS);var c=new xa(this.canvas),l=ch.windowSize;c.width=l.width,c.height=l.height,this._swapchain=this._gfxDevice.createSwapchain(c),this.canvas.oncontextmenu=function(){return!1}}},n._initEvents=function(){_n.on("show",this._onShow,this),_n.on("hide",this._onHide,this)},n._onHide=function(){this.emit(e.EVENT_HIDE),this.pause()},n._onShow=function(){this.emit(e.EVENT_SHOW),this.resume()},n._setRenderPipelineNShowSplash=function(){var t=this;return Promise.resolve(this._setupRenderPipeline()).then((function(){return Promise.resolve(t._showSplashScreen()).then((function(){t._inited=!0,t._initTime=performance.now(),t._runMainLoop(),t._safeEmit(e.EVENT_GAME_INITED),t.onStart&&t.onStart()}))}))},n._setupRenderPipeline=function(){var t=this,e=this.config.renderPipeline;return e?new Promise((function(t,n){i.assetManager.loadAny(e,(function(e,i){return!e&&i instanceof Hx?t(i):n(e)}))})).then((function(e){t._setRenderPipeline(e)})).catch((function(n){p(n),p("Failed load render pipeline: "+e+", engine failed to initialize, will fallback to default pipeline"),t._setRenderPipeline()})):this._setRenderPipeline()},n._showSplashScreen=function(){if(i.internal.SplashScreen){var t=i.internal.SplashScreen.instance;return t.main(i.director.root),new Promise((function(e){t.setOnFinish((function(){return e()})),t.loadFinish=!0}))}return null},n._setRenderPipeline=function(t){i.director.root.setRenderPipeline(t)||this._setRenderPipeline(),this._rendererInitialized=!0,this._safeEmit(e.EVENT_RENDERER_INITED)},n._safeEmit=function(t){this.emit(t)},L(e,[{key:"inited",get:function(){return this._inited}},{key:"frameRate",get:function(){return this._frameRate},set:function(t){"number"!=typeof t&&(t=parseInt(t,10),Number.isNaN(t)&&(t=60)),this._frameRate=t,this.frameTime=1e3/t,this._setAnimFrame()}},{key:"deltaTime",get:function(){return this._deltaTime}},{key:"totalTime",get:function(){return performance.now()-this._initTime}},{key:"frameStartTime",get:function(){return this._startTime}}]),e}(fn));HM.EVENT_HIDE="game_on_hide",HM.EVENT_SHOW="game_on_show",HM.EVENT_LOW_MEMORY="game_on_low_memory",HM.EVENT_GAME_INITED="game_inited",HM.EVENT_ENGINE_INITED="engine_inited",HM.EVENT_RENDERER_INITED="renderer_inited",HM.EVENT_RESTART="game_on_restart",HM.RENDER_TYPE_CANVAS=0,HM.RENDER_TYPE_WEBGL=1,HM.RENDER_TYPE_OPENGL=2,HM.RENDER_TYPE_HEADLESS=3,HM.DEBUG_DT_THRESHOLD=1,i.Game=HM;var VM=t("game",i.game=new HM),jM=t("Director",function(t){function e(){var e;return(e=t.call(this)||this)._compScheduler=void 0,e._nodeActivator=void 0,e._invalid=void 0,e._paused=void 0,e._root=void 0,e._loadingScene=void 0,e._scene=void 0,e._totalFrames=void 0,e._scheduler=void 0,e._systems=void 0,e._invalid=!1,e._paused=!1,e._root=null,e._loadingScene="",e._scene=null,e._totalFrames=0,e._scheduler=new zM,e._compScheduler=new UD,e._nodeActivator=new iO,e._systems=[],VM.once(HM.EVENT_RENDERER_INITED,e._initOnRendererInitialized,V(e)),e}F(e,t);var n=e.prototype;return n.calculateDeltaTime=function(){},n.end=function(){var t=this;this.once(e.EVENT_END_FRAME,(function(){t.purgeDirector()}))},n.pause=function(){this._paused||(this._paused=!0)},n.purgeDirector=function(){this._scheduler.unscheduleAll(),this._compScheduler.unscheduleAll(),this._nodeActivator.reset(),i.isValid(this._scene)&&this._scene.destroy(),this._scene=null,this.stopAnimation(),i.assetManager.releaseAll()},n.reset=function(){this.purgeDirector(),this.emit(e.EVENT_RESET),this.startAnimation()},n.runSceneImmediate=function(t,e,n){t instanceof rO&&(t=t.scene),I(t instanceof AD,1216),t._load();for(var r=Object.keys(VM._persistRootNodes).map((function(t){return VM._persistRootNodes[t]})),a=0;a<r.length;a++){var o=r[a];o.emit(i.Node.SCENE_CHANGED_FOR_PERSISTS,t.renderScene);var s=t.uuid===o._originalSceneId&&t.getChildByUuid(o.uuid);if(s){var c=s.getSiblingIndex();s._destroyImmediate(),t.insertChild(o,c)}else o.parent=t}var l=this._scene;i.isValid(l)&&l.destroy(),i.assetManager._releaseManager._autoRelease(l,t,VM._persistRootNodes),this._scene=null,Ye._deferredDestroy(),e&&e(),this.emit(i.Director.EVENT_BEFORE_SCENE_LAUNCH,t),this._scene=t,t._activate(),this._root&&this._root.resetCumulativeTime(),this.startAnimation(),n&&n(null,t),this.emit(i.Director.EVENT_AFTER_SCENE_LAUNCH,t)},n.runScene=function(t,e,n){var r=this;t instanceof rO&&(t=t.scene),I(t,1205),I(t instanceof AD,1216),t._load(),this.once(i.Director.EVENT_END_FRAME,(function(){r.runSceneImmediate(t,e,n)}))},n.loadScene=function(t,e,n){var r=this;if(this._loadingScene)return E(1208,t,this._loadingScene),!1;var a=i.assetManager.bundles.find((function(e){return!!e.getSceneInfo(t)}));return a?(this.emit(i.Director.EVENT_BEFORE_SCENE_LOADING,t),this._loadingScene=t,console.time("LoadScene "+t),a.loadScene(t,(function(i,a){console.timeEnd("LoadScene "+t),r._loadingScene="",i?(d(i),e&&e(i)):r.runSceneImmediate(a,n,e)})),!0):(b(1209,t),!1)},n.preloadScene=function(t,e,n){var r=i.assetManager.bundles.find((function(e){return!!e.getSceneInfo(t)}));if(r)r.preloadScene(t,null,e,n);else{var a='Can not preload the scene "'+t+'" because it is not in the build settings.';n&&n(new Error(a)),d("preloadScene: "+a)}},n.resume=function(){this._paused&&(this._paused=!1)},n.getScene=function(){return this._scene},n.getDeltaTime=function(){return VM.deltaTime},n.getTotalTime=function(){return VM.totalTime},n.getCurrentTime=function(){return VM.frameStartTime},n.getTotalFrames=function(){return this._totalFrames},n.isPaused=function(){return this._paused},n.getScheduler=function(){return this._scheduler},n.setScheduler=function(t){this._scheduler!==t&&(this.unregisterSystem(this._scheduler),this._scheduler=t,this.registerSystem(zM.ID,t,200))},n.registerSystem=function(t,e,n){e.id=t,e.priority=n,e.init(),this._systems.push(e),this._systems.sort(DM.sortByPriority)},n.unregisterSystem=function(t){kt.fastRemove(this._systems,t),this._systems.sort(DM.sortByPriority)},n.getSystem=function(t){return this._systems.find((function(e){return e.id===t}))},n.getAnimationManager=function(){return this.getSystem(i.AnimationManager.ID)},n.startAnimation=function(){this._invalid=!1},n.stopAnimation=function(){this._invalid=!0},n.mainLoop=function(t){var e;e=VM._calculateDT(t),this.tick(e)},n.tick=function(t){if(!this._invalid){if(this.emit(e.EVENT_BEGIN_FRAME),fD._frameDispatchEvents(),!this._paused){this.emit(e.EVENT_BEFORE_UPDATE),this._compScheduler.startPhase(),this._compScheduler.updatePhase(t);for(var n=0;n<this._systems.length;++n)this._systems[n].update(t);this._compScheduler.lateUpdatePhase(t),this.emit(e.EVENT_AFTER_UPDATE),Ye._deferredDestroy();for(var i=0;i<this._systems.length;++i)this._systems[i].postUpdate(t)}this.emit(e.EVENT_BEFORE_DRAW),this._root.frameMove(t),this.emit(e.EVENT_AFTER_DRAW),qC.resetHasChangedFlags(),qC.clearNodeArray(),Ht.update(t),this.emit(e.EVENT_END_FRAME),this._totalFrames++}},n._initOnRendererInitialized=function(){this._totalFrames=0,this._paused=!1,this.registerSystem(zM.ID,this._scheduler,200),this.emit(e.EVENT_INIT)},n._init=function(){return this._root=new GM(VM._gfxDevice),this._root.initialize({}).catch((function(t){return b(1217),Promise.reject(t)}))},L(e,[{key:"root",get:function(){return this._root}}]),e}(fn));jM.EVENT_INIT="director_init",jM.EVENT_RESET="director_reset",jM.EVENT_BEFORE_SCENE_LOADING="director_before_scene_loading",jM.EVENT_BEFORE_SCENE_LAUNCH="director_before_scene_launch",jM.EVENT_AFTER_SCENE_LAUNCH="director_after_scene_launch",jM.EVENT_BEFORE_UPDATE="director_before_update",jM.EVENT_AFTER_UPDATE="director_after_update",jM.EVENT_BEFORE_DRAW="director_before_draw",jM.EVENT_AFTER_DRAW="director_after_draw",jM.EVENT_BEFORE_COMMIT="director_before_commit",jM.EVENT_BEFORE_PHYSICS="director_before_physics",jM.EVENT_AFTER_PHYSICS="director_after_physics",jM.EVENT_BEGIN_FRAME="director_begin_frame",jM.EVENT_END_FRAME="director_end_frame",jM.instance=void 0,i.Director=jM;var WM=t("director",jM.instance=i.director=new jM),XM={};Nn(XM,"vmath",[{name:"vec2",newName:"Vec2",target:qi,targetName:"math"},{name:"vec3",newName:"Vec3",target:qi,targetName:"math"},{name:"vec4",newName:"Vec4",target:qi,targetName:"math"},{name:"quat",newName:"Quat",target:qi,targetName:"math"},{name:"mat3",newName:"Mat3",target:qi,targetName:"math"},{name:"mat4",newName:"Mat4",target:qi,targetName:"math"},{name:"color4",newName:"Color",target:qi,targetName:"math"},{name:"rect",newName:"Rect",target:qi,targetName:"math"},{name:"approx",newName:"approx",target:qi,targetName:"math"},{name:"EPSILON",newName:"EPSILON",target:qi,targetName:"math"},{name:"equals",newName:"equals",target:qi,targetName:"math"},{name:"clamp",newName:"clamp",target:qi,targetName:"math"},{name:"clamp01",newName:"clamp01",target:qi,targetName:"math"},{name:"lerp",newName:"lerp",target:qi,targetName:"math"},{name:"toRadian",newName:"toRadian",target:qi,targetName:"math"},{name:"toDegree",newName:"toDegree",target:qi,targetName:"math"},{name:"random",newName:"random",target:qi,targetName:"math"},{name:"randomRange",newName:"randomRange",target:qi,targetName:"math"},{name:"randomRangeInt",newName:"randomRangeInt",target:qi,targetName:"math"},{name:"pseudoRandom",newName:"pseudoRandom",target:qi,targetName:"math"},{name:"pseudoRandomRangeInt",newName:"pseudoRandomRangeInt",target:qi,targetName:"math"},{name:"nextPow2",newName:"nextPow2",target:qi,targetName:"math"},{name:"repeat",newName:"repeat",target:qi,targetName:"math"},{name:"pingPong",newName:"pingPong",target:qi,targetName:"math"},{name:"inverseLerp",newName:"inverseLerp",target:qi,targetName:"math"}]),i.vmath=XM,Nn(zM.prototype,"Scheduler.prototype",[{name:"enableForTarget",newName:"enableForTarget",target:zM,targetName:"Scheduler"}]),Nn(zM,"Scheduler",[{name:"PRIORITY_SYSTEM",newName:"System.Priority.SCHEDULER",customGetter:function(){return DM.Priority.SCHEDULER}}]),Ln(zM,"Scheduler",[{name:"PRIORITY_NON_SYSTEM",suggest:"Use enum` System.Priority` instead"}]),Nn(Wg.prototype,"SubModel.prototype",[{name:"subMeshData",newName:"subMesh"}]),Ln(Wg.prototype,"SubModel.prototype",[{name:"getSubModel",suggest:"Use `subModels[i]` instead"},{name:"subModelNum",suggest:"Use `subModels.length` instead"}]),Nn(GM.prototype,"Root.prototype",[{name:"ui",newName:"batcher2D"}]),Bn(VM,"game",[{name:"collisionMatrix"},{name:"groupList"}]),Bn(jM.prototype,"director",[{name:"calculateDeltaTime"},{name:"getDeltaTime",suggest:"Use game.deltaTime instead"},{name:"getTotalTime",suggest:"Use game.totalTime instead"},{name:"getCurrentTime",suggest:"Use game.frameStartTime instead"}]),Ln(jM.prototype,"director",[{name:"setAnimationInterval",suggest:"please use game.frameRate instead"},{name:"getAnimationInterval",suggest:"please use game.frameRate instead"},{name:"getRunningScene",suggest:"please use getScene instead"},{name:"setDepthTest",suggest:"please use camera API instead"},{name:"setClearColor",suggest:"please use camera API instead"},{name:"getWinSize",suggest:"please use view.getVisibleSize instead"},{name:"getWinSizeInPixels"},{name:"purgeCachedData",suggest:"please use assetManager.releaseAll instead"},{name:"convertToGL"},{name:"convertToUI"}]);var qM,YM={topLeft:i.v2(0,0),topRight:i.v2(0,0),top:i.v2(0,0),bottomLeft:i.v2(0,0),bottomRight:i.v2(0,0),bottom:i.v2(0,0),center:i.v2(0,0),left:i.v2(0,0),right:i.v2(0,0),width:0,height:0,init:function(t){var e=this.width=t.width,n=this.height=t.height,i=t.x,r=t.y,a=r+n,o=i+e;this.topLeft.x=i,this.topLeft.y=a,this.topRight.x=o,this.topRight.y=a,this.top.x=i+e/2,this.top.y=a,this.bottomLeft.x=i,this.bottomLeft.y=r,this.bottomRight.x=o,this.bottomRight.y=r,this.bottom.x=i+e/2,this.bottom.y=r,this.center.x=i+e/2,this.center.y=r+n/2,this.left.x=i,this.left.y=r+n/2,this.right.x=o,this.right.y=r+n/2}};i.visibleRect=YM;var KM=new Gi,QM=((qM={})[$t.ORIENTATION_AUTO]=eh.AUTO,qM[$t.ORIENTATION_LANDSCAPE]=eh.LANDSCAPE,qM[$t.ORIENTATION_PORTRAIT]=eh.PORTRAIT,qM),ZM=t("View",function(t){function e(){var e;(e=t.call(this)||this)._designResolutionSize=void 0,e._scaleX=void 0,e._scaleY=void 0,e._viewportRect=void 0,e._visibleRect=void 0,e._autoFullScreen=void 0,e._retinaEnabled=void 0,e._resizeCallback=void 0,e._resolutionPolicy=void 0,e._rpExactFit=void 0,e._rpShowAll=void 0,e._rpNoBorder=void 0,e._rpFixedHeight=void 0,e._rpFixedWidth=void 0;var n=JM,i=$M;return e._designResolutionSize=new Gi(0,0),e._scaleX=1,e._scaleY=1,e._viewportRect=new Vi(0,0,0,0),e._visibleRect=new Vi(0,0,0,0),e._autoFullScreen=!1,e._retinaEnabled=!1,e._resizeCallback=null,e._rpExactFit=new tN(n.EQUAL_TO_FRAME,i.EXACT_FIT),e._rpShowAll=new tN(n.EQUAL_TO_FRAME,i.SHOW_ALL),e._rpNoBorder=new tN(n.EQUAL_TO_FRAME,i.NO_BORDER),e._rpFixedHeight=new tN(n.EQUAL_TO_FRAME,i.FIXED_HEIGHT),e._rpFixedWidth=new tN(n.EQUAL_TO_FRAME,i.FIXED_WIDTH),e._resolutionPolicy=e._rpShowAll,e}F(e,t);var n=e.prototype;return n.init=function(){var t=ch.windowSize,e=t.width,n=t.height;this._designResolutionSize.width=e,this._designResolutionSize.height=n,this._viewportRect.width=e,this._viewportRect.height=n,this._visibleRect.width=e,this._visibleRect.height=n,KM.width=this._visibleRect.width,KM.height=this._visibleRect.height,YM&&YM.init(this._visibleRect),oh.on("window-resize",this._updateAdaptResult,this),oh.on("orientation-change",this._updateAdaptResult,this),oh.on("fullscreen-change",this._updateAdaptResult,this)},n.resizeWithBrowserSize=function(t){oh.handleResizeEvent=t},n.setResizeCallback=function(t){"function"!=typeof t&&null!=t||(this._resizeCallback=t)},n.setOrientation=function(t){oh.orientation=QM[t]},n.adjustViewportMeta=function(){},n.enableRetina=function(t){this._retinaEnabled=!!t},n.isRetinaEnabled=function(){return this._retinaEnabled},n.enableAutoFullScreen=function(t){t!==this._autoFullScreen&&(this._autoFullScreen=t,t&&ch.requestFullScreen().catch((function(){})))},n.isAutoFullScreenEnabled=function(){return this._autoFullScreen},n.setCanvasSize=function(t,e){oh.resolutionScale=1;var n=oh.devicePixelRatio,i=new Gi(t*n,e*n);ch.windowSize=i},n.getCanvasSize=function(){return ch.windowSize},n.getFrameSize=function(){var t=oh.devicePixelRatio,e=ch.windowSize;return e.width/=t,e.height/=t,e},n.setFrameSize=function(t,e){var n=oh.devicePixelRatio;ch.windowSize=new Gi(t*n,e*n)},n.getVisibleSize=function(){return new Gi(this._visibleRect.width,this._visibleRect.height)},n.getVisibleSizeInPixel=function(){return new Gi(this._visibleRect.width*this._scaleX,this._visibleRect.height*this._scaleY)},n.getVisibleOrigin=function(){return new Ni(this._visibleRect.x,this._visibleRect.y)},n.getVisibleOriginInPixel=function(){return new Ni(this._visibleRect.x*this._scaleX,this._visibleRect.y*this._scaleY)},n.getResolutionPolicy=function(){return this._resolutionPolicy},n._updateResolutionPolicy=function(t){if(t instanceof tN)this._resolutionPolicy=t;else{var e=tN;t===e.EXACT_FIT&&(this._resolutionPolicy=this._rpExactFit),t===e.SHOW_ALL&&(this._resolutionPolicy=this._rpShowAll),t===e.NO_BORDER&&(this._resolutionPolicy=this._rpNoBorder),t===e.FIXED_HEIGHT&&(this._resolutionPolicy=this._rpFixedHeight),t===e.FIXED_WIDTH&&(this._resolutionPolicy=this._rpFixedWidth)}},n.setResolutionPolicy=function(t){this._updateResolutionPolicy(t);var e=eN.getDesignResolutionSize();eN.setDesignResolutionSize(e.width,e.height,t)},n.setDesignResolutionSize=function(t,e,n){if(t>0&&e>0){this._updateResolutionPolicy(n);var i=this._resolutionPolicy;i&&i.preApply(this),this._designResolutionSize.width=t,this._designResolutionSize.height=e;var r=i.apply(this,this._designResolutionSize);if(r.scale&&2===r.scale.length&&(this._scaleX=r.scale[0],this._scaleY=r.scale[1]),r.viewport){var a=this._viewportRect,o=this._visibleRect,s=r.viewport;a.x=s.x,a.y=s.y,a.width=s.width,a.height=s.height,o.x=0,o.y=0,o.width=s.width/this._scaleX,o.height=s.height/this._scaleY}i.postApply(this),KM.width=this._visibleRect.width,KM.height=this._visibleRect.height,YM&&YM.init(this._visibleRect),this.emit("design-resolution-changed")}else b(2200)},n.getDesignResolutionSize=function(){return new Gi(this._designResolutionSize.width,this._designResolutionSize.height)},n.setRealPixelResolution=function(t,e,n){document.documentElement.style.width=t+"px",document.body.style.width=t+"px",document.body.style.left="0px",document.body.style.top="0px",this.setDesignResolutionSize(t,e,n)},n.getViewportRect=function(){return this._viewportRect},n.getScaleX=function(){return this._scaleX},n.getScaleY=function(){return this._scaleY},n.getDevicePixelRatio=function(){return oh.devicePixelRatio},n.convertToLocationInView=function(t,e,n,i){void 0===i&&(i=new Ni);var r=oh.devicePixelRatio*(t-n.left),a=oh.devicePixelRatio*(n.top+n.height-e);return oh.isFrameRotated?(i.x=ch.windowSize.width-a,i.y=r):(i.x=r,i.y=a),i},n._convertToUISpace=function(t){var e=this._viewportRect;t.x=(t.x-e.x)/this._scaleX,t.y=(t.y-e.y)/this._scaleY},n._updateAdaptResult=function(){var t;i.director.root.resize(ch.windowSize.width,ch.windowSize.height);var e=this._designResolutionSize.width,n=this._designResolutionSize.height;e>0&&this.setDesignResolutionSize(e,n,this._resolutionPolicy),this.emit("canvas-resize"),null===(t=this._resizeCallback)||void 0===t||t.call(this)},e}(fn));ZM.instance=void 0;var JM=function(){function t(){this.name="ContainerStrategy"}var e=t.prototype;return e.preApply=function(){},e.apply=function(){},e.postApply=function(){},e._setupCanvas=function(){var t=VM.canvas;if(t){var e=ch.windowSize;t.width=e.width,t.height=e.height}},t}();JM.EQUAL_TO_FRAME=void 0,JM.PROPORTION_TO_FRAME=void 0;var $M=function(){function t(){this.name="ContentStrategy",this._result=void 0,this._result={scale:[1,1],viewport:null}}var e=t.prototype;return e.preApply=function(){},e.apply=function(){return{scale:[1,1]}},e.postApply=function(){},e._buildResult=function(t,e,n,i,r,a){Math.abs(t-n)<2&&(n=t),Math.abs(e-i)<2&&(i=e);var o=new Vi(Math.round((t-n)/2),Math.round((e-i)/2),n,i);return this._result.scale=[r,a],this._result.viewport=o,this._result},t}();$M.EXACT_FIT=void 0,$M.SHOW_ALL=void 0,$M.NO_BORDER=void 0,$M.FIXED_HEIGHT=void 0,$M.FIXED_WIDTH=void 0,function(){var t=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).name="EqualToFrame",e}return F(e,t),e.prototype.apply=function(){oh.isProportionalToFrame=!1,this._setupCanvas()},e}(JM),e=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).name="ProportionalToFrame",e}return F(e,t),e.prototype.apply=function(){oh.isProportionalToFrame=!0,this._setupCanvas()},e}(JM);JM.EQUAL_TO_FRAME=new t,JM.PROPORTION_TO_FRAME=new e;var n=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).name="ExactFit",e}return F(e,t),e.prototype.apply=function(t,e){var n=ch.windowSize,i=n.width,r=n.height,a=i/e.width,o=r/e.height;return this._buildResult(i,r,i,r,a,o)},e}($M),i=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).name="ShowAll",e}return F(e,t),e.prototype.apply=function(t,e){var n,i,r=ch.windowSize,a=r.width,o=r.height,s=e.width,c=e.height,l=a/s,u=o/c,h=0;return l<u?(n=a,i=c*(h=l)):(n=s*(h=u),i=o),this._buildResult(a,o,n,i,h,h)},e}($M),r=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).name="NoBorder",e}return F(e,t),e.prototype.apply=function(t,e){var n,i,r,a=ch.windowSize,o=a.width,s=a.height,c=e.width,l=e.height,u=o/c,h=s/l;return u<h?(i=c*(n=h),r=s):(i=o,r=l*(n=u)),this._buildResult(o,s,i,r,n,n)},e}($M),a=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).name="FixedHeight",e}return F(e,t),e.prototype.apply=function(t,e){var n=ch.windowSize,i=n.width,r=n.height,a=r/e.height,o=i,s=r;return this._buildResult(i,r,o,s,a,a)},e}($M),o=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).name="FixedWidth",e}return F(e,t),e.prototype.apply=function(t,e){var n=ch.windowSize,i=n.width,r=n.height,a=i/e.width,o=i,s=r;return this._buildResult(i,r,o,s,a,a)},e}($M);$M.EXACT_FIT=new n,$M.SHOW_ALL=new i,$M.NO_BORDER=new r,$M.FIXED_HEIGHT=new a,$M.FIXED_WIDTH=new o}();var tN=t("ResolutionPolicy",function(){function t(t,e){this.name="ResolutionPolicy",this._containerStrategy=void 0,this._contentStrategy=void 0,this._containerStrategy=null,this._contentStrategy=null,this.setContainerStrategy(t),this.setContentStrategy(e)}var e=t.prototype;return e.preApply=function(t){this._contentStrategy.preApply(t)},e.apply=function(t,e){return this._containerStrategy.apply(t,e),this._contentStrategy.apply(t,e)},e.postApply=function(t){this._contentStrategy.postApply(t)},e.setContainerStrategy=function(t){t instanceof JM&&(this._containerStrategy=t)},e.setContentStrategy=function(t){t instanceof $M&&(this._contentStrategy=t)},L(t,[{key:"canvasSize",get:function(){return ch.windowSize}}]),t}());tN.EXACT_FIT=0,tN.NO_BORDER=1,tN.SHOW_ALL=2,tN.FIXED_HEIGHT=3,tN.FIXED_WIDTH=4,tN.UNKNOWN=5,tN.ContainerStrategy=JM,tN.ContentStrategy=$M,i.ResolutionPolicy=tN;var eN=t("view",ZM.instance=i.view=new ZM);i.winSize=KM,Ln(ZM.prototype,"View.prototype",[{name:"isAntiAliasEnabled",suggest:"The API of Texture2d have been largely modified, no alternative"},{name:"enableAntiAlias",suggest:"The API of Texture2d have been largely modified, no alternative"}]),Bn(ZM.prototype,"View.prototype",[{name:"adjustViewportMeta"},{name:"enableAutoFullScreen",suggest:"use screen.requestFullScreen() instead."},{name:"isAutoFullScreenEnabled"},{name:"setCanvasSize",suggest:"setting size in CSS pixels is not recommended, please use screen.windowSize instead."},{name:"getCanvasSize",suggest:"please use screen.windowSize instead."},{name:"getFrameSize",suggest:"getting size in CSS pixels is not recommended, please use screen.windowSize instead."},{name:"setFrameSize",suggest:"setting size in CSS pixels is not recommended, please use screen.windowSize instead."},{name:"getDevicePixelRatio",suggest:"use screen.devicePixelRatio instead."},{name:"convertToLocationInView"},{name:"enableRetina"},{name:"isRetinaEnabled"}]),Bn(i,"cc",[{name:"winSize",suggest:"please use view.getVisibleSize() instead."}]),Bn(lh,"sys",[{name:"capabilities",suggest:"please use sys.hasFeature() method instead."}]),Nn(lh,"sys",["UNKNOWN","ENGLISH","CHINESE","FRENCH","ITALIAN","GERMAN","SPANISH","DUTCH","RUSSIAN","KOREAN","JAPANESE","HUNGARIAN","PORTUGUESE","ARABIC","NORWEGIAN","POLISH","TURKISH","UKRAINIAN","ROMANIAN","BULGARIAN"].map((function(t){return{name:"LANGUAGE_"+t,newName:t,target:lh.Language,targetName:"sys.Language"}}))),Nn(lh,"sys",["UNKNOWN","IOS","ANDROID","WINDOWS","LINUX","OSX"].map((function(t){return{name:"OS_"+t,newName:t,target:lh.OS,targetName:"sys.OS"}}))),Nn(lh,"sys",["UNKNOWN","WECHAT","ANDROID","IE","EDGE","QQ","MOBILE_QQ","UC","UCBS","BAIDU_APP","BAIDU","MAXTHON","OPERA","OUPENG","MIUI","FIREFOX","SAFARI","CHROME","LIEBAO","QZONE","SOUGOU","HUAWEI"].map((function(t){return{name:"BROWSER_TYPE_"+t,newName:t,target:lh.BrowserType,targetName:"sys.BrowserType"}}))),Nn(lh,"sys",[{name:"BROWSER_TYPE_360",newName:"BROWSER_360",target:lh.BrowserType,targetName:"sys.BrowserType"}]),Nn(lh,"sys",["UNKNOWN","EDITOR_PAGE","EDITOR_CORE","MOBILE_BROWSER","DESKTOP_BROWSER","WIN32","MACOS","IOS","ANDROID","OHOS","WECHAT_GAME","BAIDU_MINI_GAME","XIAOMI_QUICK_GAME","ALIPAY_MINI_GAME","BYTEDANCE_MINI_GAME","OPPO_MINI_GAME","VIVO_MINI_GAME","HUAWEI_QUICK_GAME","COCOSPLAY","LINKSURE_MINI_GAME","QTT_MINI_GAME"].map((function(t){return{name:t,target:lh.Platform,targetName:"sys.Platform"}}))),Nn(lh,"sys",[{name:"IPHONE",newName:"IOS",target:lh.Platform,targetName:"sys.Platform"},{name:"IPAD",newName:"IOS",target:lh.Platform,targetName:"sys.Platform"}]),Ln(lh,"sys",["LINUX","BLACKBERRY","NACL","EMSCRIPTEN","TIZEN","WINRT","WP8","QQ_PLAY","FB_PLAYABLE_ADS"].map((function(t){return{name:t}}))),Nn(lh,"sys",[{name:"windowPixelResolution",target:ch,targetName:"screen",newName:"windowSize"}]),Bn(ch,"screen",[{name:"autoFullScreen",suggest:"please use screen.requestFullScreen() instead."},{name:"disableAutoFullScreen"}]);var nN=function(){function t(){this.name="",this.base="",this.importBase="",this.nativeBase="",this.deps=null,this.assetInfos=new Zl,this.scenes=new Zl,this.paths=new Zl}var e=t.prototype;return e.init=function(t){var e=this;!function(t){var e=t.uuids,n=t.paths,i=t.types,r=t.deps,a=t.paths=Object.create(null);if(!1===t.debug){for(var o=0,s=e.length;o<s;o++)e[o]=pu(e[o]);for(var c in n){var l=n[c],u=l[1];l[1]=i[u]}}else{for(var h=Object.create(null),f=0,_=e.length;f<_;f++){var p=e[f];e[f]=h[p]=pu(p)}e=h}for(var d in n){var m=n[d];a[e[d]]=m}var g=t.scenes;for(var v in g){var y=g[v];g[v]=e[y]}var x=t.packs;for(var S in x)for(var T=x[S],A=0;A<T.length;++A)T[A]=e[T[A]];var E=t.versions;if(E)for(var C in E)for(var b=E[C],w=0;w<b.length;w+=2){var P=b[w];b[w]=e[P]||P}var I=t.redirect;if(I)for(var R=0;R<I.length;R+=2)I[R]=e[I[R]],I[R+1]=r[I[R+1]];if(t.extensionMap){var D=function(n){if(!Object.prototype.hasOwnProperty.call(t.extensionMap,n))return"continue";t.extensionMap[n].forEach((function(i,r){t.extensionMap[n][r]=e[i]||i}))};for(var O in t.extensionMap)D(O)}}(t),this.importBase=t.importBase||"",this.nativeBase=t.nativeBase||"",this.base=t.base||"",this.name=t.name||"",this.deps=t.deps||[],this._initUuid(t.uuids),this._initPath(t.paths),this._initScene(t.scenes),this._initPackage(t.packs),this._initVersion(t.versions),this._initRedirect(t.redirect);var n=function(n){if(!Object.prototype.hasOwnProperty.call(t.extensionMap,n))return"continue";t.extensionMap[n].forEach((function(t){var i=e.assetInfos.get(t);i&&(i.extension=n)}))};for(var i in t.extensionMap)n(i)},e.getInfoWithPath=function(t,e){if(!t)return null;t=yu(t);var n=this.paths.get(t);if(n){if(!e)return n[0];for(var i=0,r=n.length;i<r;i++){var a=n[i];if(Gt.isChildClassOf(a.ctor,e))return a}}return null},e.getDirWithPath=function(t,e,n){"/"===(t=yu(t))[t.length-1]&&(t=t.slice(0,-1));var i=n||[];return this.paths.forEach((function(n,r){if(r.startsWith(t)&&function(t,e){return!(t.length>e.length)||47===t.charCodeAt(e.length)}(r,t)||!t)for(var a=0,o=n.length;a<o;a++){var s=n[a];e&&!Gt.isChildClassOf(s.ctor,e)||i.push(s)}})),i},e.getAssetInfo=function(t){return this.assetInfos.get(t)||null},e.getSceneInfo=function(t){return t.endsWith(".scene")||(t+=".scene"),"/"===t[0]||t.startsWith("db://")||(t="/"+t),this.scenes.find((function(e,n){return n.endsWith(t)}))},e.destroy=function(){this.paths.destroy(),this.scenes.destroy(),this.assetInfos.destroy()},e._initUuid=function(t){if(t){this.assetInfos.clear();for(var e=0,n=t.length;e<n;e++){var i=t[e];this.assetInfos.add(i,{uuid:i})}}},e._initPath=function(t){if(t){var e=this.paths;for(var n in e.clear(),t){var i=t[n],r=i[0],a=i[1],o=3===i.length,s=this.assetInfos.get(n);s.path=r,s.ctor=Gt._getClassById(a),e.has(r)?o?e.get(r).push(s):e.get(r).unshift(s):e.add(r,[s])}}},e._initScene=function(t){if(t){var e=this.scenes;e.clear();var n=this.assetInfos;for(var i in t){var r=t[i],a=n.get(r);a.url=i,e.add(i,a)}}},e._initPackage=function(t){if(t){var e=this.assetInfos;for(var n in t){var i=t[n],r={uuid:n,packedUuids:i,ext:".json"};e.add(n,r);for(var a=0,o=i.length;a<o;a++){var s=i[a],c=e.get(s),l=c.packs;l?1===o?l.unshift(r):l.push(r):c.packs=[r]}}}},e._initVersion=function(t){if(t){var e=this.assetInfos,n=t.import;if(n)for(var i=0,r=n.length;i<r;i+=2){var a=n[i];e.get(a).ver=n[i+1]}if(n=t.native)for(var o=0,s=n.length;o<s;o+=2){var c=n[o];e.get(c).nativeVer=n[o+1]}}},e._initRedirect=function(t){if(t)for(var e=this.assetInfos,n=0,i=t.length;n<i;n+=2){var r=t[n];e.get(r).redirect=t[n+1]}},t}();function iN(t,e){t._uuid&&e.push(t._uuid)}function rN(t,e){for(var n=Object.getOwnPropertyNames(t),i=0;i<n.length;i++){var r=n[i];if("node"!==r&&"__eventTargets"!==r){var a=t[r];if("object"==typeof a&&a)if(Array.isArray(a))for(var o=0;o<a.length;o++){var s=a[o];s instanceof Ou&&iN(s,e)}else if(a.constructor&&a.constructor!==Object)a instanceof Ou&&iN(a,e);else for(var c=Object.getOwnPropertyNames(a),l=0;l<c.length;l++){var u=a[c[l]];u instanceof Ou&&iN(u,e)}}}}function aN(t,e){for(var n=0;n<t._components.length;n++)rN(t._components[n],e);for(var i=0;i<t._children.length;i++)aN(t._children[i],e)}function oN(t,e,n,i){n.push(t._uuid);for(var r=Um.getDeps(t._uuid),a=0,o=r.length;a<o;a++){var s=tu.get(r[a]);if(s){var c=s._uuid;c in e?e[c]+=i:e[c]=s.refCount+i,n.includes(c)||oN(s,e,n,i)}}}var sN=[],cN=new(function(){function t(){this._persistNodeDeps=new Zl,this._toDelete=new Zl,this._eventListener=!1}var e=t.prototype;return e.init=function(){this._persistNodeDeps.clear(),this._toDelete.clear()},e._addPersistNodeRef=function(t){var e=[];aN(t,e);for(var n=0,i=e.length;n<i;n++){var r=tu.get(e[n]);r&&r.addRef()}this._persistNodeDeps.add(t.uuid,e)},e._removePersistNodeRef=function(t){if(this._persistNodeDeps.has(t.uuid)){for(var e=this._persistNodeDeps.get(t.uuid),n=0,i=e.length;n<i;n++){var r=tu.get(e[n]);r&&r.decRef()}this._persistNodeDeps.remove(t.uuid)}},e._autoRelease=function(t,e,n){if(t){for(var i=Um.getDeps(t.uuid),r=0,a=i.length;r<a;r++){var o=tu.get(i[r]);o&&o.decRef(t.autoReleaseAssets)}var s=Um._depends.get(t.uuid);if(s&&s.persistDeps)for(var c=s.persistDeps,l=0,u=c.length;l<u;l++){var h=tu.get(c[l]);h&&h.decRef(t.autoReleaseAssets)}t.uuid!==e.uuid&&Um.remove(t.uuid)}var f=Um._depends.get(e.uuid);for(var _ in f&&(f.persistDeps=[]),n){for(var p,d,m=n[_],g=this._persistNodeDeps.get(m.uuid),v=W(g);!(d=v()).done;){var y=d.value,x=tu.get(y);x&&x.addRef()}f&&(p=f.persistDeps).push.apply(p,g)}},e.tryRelease=function(t,e){void 0===e&&(e=!1),t instanceof Ou&&(e?this._free(t,e):(this._toDelete.add(t._uuid,t),this._eventListener||(this._eventListener=!0,le(this._freeAssets.bind(this)))))},e._freeAssets=function(){var t=this;this._eventListener=!1,this._toDelete.forEach((function(e){t._free(e)})),this._toDelete.clear()},e._free=function(t,e){void 0===e&&(e=!1);var n=t._uuid;if(this._toDelete.remove(n),Qe(t,!0)&&!(!e&&t.refCount>0&&function(t){var e=Object.create(null);if(e[t._uuid]=t.refCount,oN(t,e,sN,-1),sN.length=0,0!==e[t._uuid])return e[t._uuid];for(var n in e)0!==e[n]&&oN(tu.get(n),e,sN,1);return sN.length=0,e[t._uuid]}(t)>0)){tu.remove(n);for(var i=Um.getDeps(n),r=0,a=i.length;r<a;r++){var o=tu.get(i[r]);o&&(o.decRef(!1),this._free(o,!1))}t.destroy(),Um.remove(n)}},t}()),lN=null;function uN(t,e){for(var n=0,i=t.input.length;n<i;n++){var r=t.input[n];e&&!r.isNative&&r.content instanceof Ou&&r.content.decRef(!1),r.recycle()}t.input=null}function hN(t,e){return e?/\?/.test(t)?t+"&_t="+Date.now():t+"?_t="+Date.now():t}function fN(t,e,n,i,r){void 0===r&&(r=0),t(r,(function(a,o){r++,!a||r>e?i&&i(a,o):setTimeout((function(){fN(t,e,n,i,r)}),n)}))}function _N(t,e,n,i,r){try{for(var a=Um.parse(t,e),o=0,s=a.deps.length;o<s;o++){var c=a.deps[o];c in n||(n[c]=!0,i.push({uuid:c,bundle:r&&r.name}))}a.nativeDep&&(r&&(a.nativeDep.bundle=r.name),i.push(B({},a.nativeDep)))}catch(t){d(t.message,t.stack)}}function pN(t,e,n){e&&(n=void 0!==n?n:i.assetManager.cacheAsset,vu(e)||!n||e.isDefault||tu.add(t,e))}function dN(t,e,n){var i=0,r=[],a=t.length;0===a&&n&&n(r);for(var o=function(t){t&&r.push(t),++i===a&&n&&n(r)},s=0;s<a;s++)e(t[s],o)}function mN(t,e,n){var i=t,r=e,a=n;if(void 0===n){var o="function"==typeof t;e?(a=e,o||(r=null)):void 0===e&&o&&(a=t,i=null,r=null),void 0!==e&&o&&(r=t,i=null)}return{options:i||Object.create(null),onProgress:r,onComplete:a}}function gN(t,e,n){var i=t,r=e,a=n;if(void 0===n){var o=Gt.isChildClassOf(t,Ou);e?(a=e,o&&(r=null)):void 0!==e||o||(a=t,r=null,i=null),void 0===e||o||(r=t,i=null)}return{type:i,onProgress:r||lN,onComplete:a}}function vN(t,e,n,i){if(void 0===i&&(i={}),!n[e]||i[e])return!1;i[e]=!0;var r=!1,a=Um.getDeps(e);if(a)for(var o=0,s=a.length;o<s;o++){var c=a[o];if(c===t||vN(t,c,n,i)){r=!0;break}}return r}function yN(t){return function(e,n){if(t){var i=[];Array.isArray(n)?n.forEach((function(t){return t instanceof Ou&&i.push(t.addRef())})):n instanceof Ou&&i.push(n.addRef()),le((function(){i.forEach((function(t){return t.decRef(!1)})),t(e,n)}))}}}var xN=function(){function t(){this._config=new nN}var e=t.prototype;return e.getInfoWithPath=function(t,e){return this._config.getInfoWithPath(t,e)},e.getDirWithPath=function(t,e,n){return this._config.getDirWithPath(t,e,n)},e.getAssetInfo=function(t){return this._config.getAssetInfo(t)},e.getSceneInfo=function(t){return this._config.getSceneInfo(t)},e.init=function(t){this._config.init(t),iu.add(t.name,this)},e.load=function(t,e,n,r){var a=gN(e,n,r),o=a.type,s=a.onProgress,c=a.onComplete,l={__requestType__:$l.PATH,type:o,bundle:this.name,__outputAsArray__:Array.isArray(t)};i.assetManager.loadAny(t,l,s,c)},e.preload=function(t,e,n,r){var a=gN(e,n,r),o=a.type,s=a.onProgress,c=a.onComplete;i.assetManager.preloadAny(t,{__requestType__:$l.PATH,type:o,bundle:this.name},s,c)},e.loadDir=function(t,e,n,r){var a=gN(e,n,r),o=a.type,s=a.onProgress,c=a.onComplete;i.assetManager.loadAny(t,{__requestType__:$l.DIR,type:o,bundle:this.name,__outputAsArray__:!0},s,c)},e.preloadDir=function(t,e,n,r){var a=gN(e,n,r),o=a.type,s=a.onProgress,c=a.onComplete;i.assetManager.preloadAny(t,{__requestType__:$l.DIR,type:o,bundle:this.name},s,c)},e.loadScene=function(t,e,n,r){var a=mN(e,n,r),o=a.options,s=a.onProgress,c=a.onComplete;o.preset=o.preset||"scene",o.bundle=this.name,i.assetManager.loadAny({scene:t},o,s,(function(t,e){if(t)d(t.message,t.stack);else if(e instanceof rO&&e.scene){var n=e.scene;n._id=e._uuid,n.name=e.name}else t=new Error("The asset "+e._uuid+" is not a scene");c&&c(t,e)}))},e.preloadScene=function(t,e,n,r){var a=mN(e,n,r),o=a.options,s=a.onProgress,c=a.onComplete;o.bundle=this.name,i.assetManager.preloadAny({scene:t},o,s,(function(e){e&&b(1210,t,e.message),c&&c(e)}))},e.get=function(t,e){var n=this.getInfoWithPath(t,e);return n&&tu.get(n.uuid)||null},e.release=function(t,e){var n=this.get(t,e);n&&cN.tryRelease(n,!0)},e.releaseUnusedAssets=function(){var t=this;tu.forEach((function(e){var n=t.getAssetInfo(e._uuid);n&&!n.redirect&&cN.tryRelease(e)}))},e.releaseAll=function(){var t=this;tu.forEach((function(e){var n=t.getAssetInfo(e._uuid);n&&!n.redirect&&cN.tryRelease(e,!0)}))},e._destroy=function(){this._config.destroy()},L(t,[{key:"config",get:function(){return this._config}},{key:"name",get:function(){return this._config.name}},{key:"deps",get:function(){return this._config.deps}},{key:"base",get:function(){return this._config.base}}]),t}(),SN=t("resources",new xN);function TN(t,e,n){var i=new Image;function r(){i.removeEventListener("load",r),i.removeEventListener("error",a),n&&n(null,i)}function a(){i.removeEventListener("load",r),i.removeEventListener("error",a),n&&n(new Error(R(4930,t)))}return"file:"!==window.location.protocol&&(i.crossOrigin="anonymous"),i.addEventListener("load",r),i.addEventListener("error",a),i.src=t,i}function AN(t,e,n,i){var r=new XMLHttpRequest,a="download failed: "+t+", status: ";if(r.open("GET",t,!0),void 0!==e.xhrResponseType&&(r.responseType=e.xhrResponseType),void 0!==e.xhrWithCredentials&&(r.withCredentials=e.xhrWithCredentials),void 0!==e.xhrMimeType&&r.overrideMimeType&&r.overrideMimeType(e.xhrMimeType),void 0!==e.xhrTimeout&&(r.timeout=e.xhrTimeout),e.xhrHeader)for(var o in e.xhrHeader)r.setRequestHeader(o,e.xhrHeader[o]);return r.onload=function(){200===r.status||0===r.status?i&&i(null,r.response):i&&i(new Error(""+a+r.status+"(no response)"))},n&&(r.onprogress=function(t){t.lengthComputable&&n(t.loaded,t.total)}),r.onerror=function(){i&&i(new Error(""+a+r.status+"(error)"))},r.ontimeout=function(){i&&i(new Error(""+a+r.status+"(time out)"))},r.onabort=function(){i&&i(new Error(""+a+r.status+"(abort)"))},r.send(null),r}i.resources=SN;var EN={};function CN(t,e,n){if(EN[t])return n&&n(null),null;var i=document.createElement("script");function r(){i.parentNode.removeChild(i),i.removeEventListener("load",r,!1),i.removeEventListener("error",a,!1),EN[t]=!0,n&&n(null)}function a(){i.parentNode.removeChild(i),i.removeEventListener("load",r,!1),i.removeEventListener("error",a,!1),n&&n(new Error(R(4928,t)))}return"file:"!==window.location.protocol&&(i.crossOrigin="anonymous"),i.async=e.scriptAsyncLoading||!1,i.src=t,i.addEventListener("load",r,!1),i.addEventListener("error",a,!1),document.body.appendChild(i),i}var bN=/^(?:\w+:\/\/|\.+\/).+/,wN=function(t,e,n){(lh.hasFeature(lh.Feature.IMAGE_BITMAP)&&i.assetManager.allowImageBitmap?PN:TN)(t,e,n)},PN=function(t,e,n){e.xhrResponseType="blob",AN(t,e,e.onFileProgress,n)},IN=function(t,e,n){e.xhrResponseType="json",AN(t,e,e.onFileProgress,n)},RN=function(t,e,n){e.xhrResponseType="arraybuffer",AN(t,e,e.onFileProgress,n)},DN=function(t,e,n){IN(t,e,(function(e,i){if(e)n(e);else{var r=_h(i);Promise.all(r.chunks.map((function(n){return new Promise((function(i,r){RN(""+yn(t)+n,{},(function(t,n){e?r(e):i(new Uint8Array(n))}))}))}))).then((function(t){var e=new fh(r.document,t);n(null,e)})).catch((function(t){n(t)}))}}))},ON=function(t,e,n){RN(t,e,(function(t,e){if(t)n(t);else try{var i=ph(new Uint8Array(e));n(null,i)}catch(t){n(t)}}))},MN=function(t,e,n){e.xhrResponseType="text",AN(t,e,e.onFileProgress,n)},NN=function(t,e,n){var i=xn(t),r=t;bN.test(r)||(r=-1!==LN.remoteBundles.indexOf(i)?LN.remoteServerAddress+"remote/"+i:"assets/"+i);var a=e.version||LN.bundleVers[i],o=0,s=null,c=null;IN(r+"/config."+(a?a+".":"")+"json",e,(function(t,e){c=t,(s=e)&&(s.base=r+"/"),2==++o&&n(c,s)})),CN(r+"/index."+(a?a+".":"")+"js",e,(function(t){c=t,2==++o&&n(t,s)}))},LN=new(function(){function t(){this.maxConcurrency=6,this.maxRequestsPerFrame=6,this.maxRetryCount=3,this.appendTimeStamp=!1,this.limited=!0,this.retryInterval=2e3,this.bundleVers=null,this.remoteBundles=[],this.downloadDomImage=TN,this.downloadDomAudio=null,this.downloadFile=AN,this.downloadScript=CN,this._downloaders={".png":wN,".jpg":wN,".bmp":wN,".jpeg":wN,".gif":wN,".ico":wN,".tiff":wN,".webp":wN,".image":wN,".pvr":RN,".pkm":RN,".astc":RN,".txt":MN,".xml":MN,".vsh":MN,".fsh":MN,".atlas":MN,".tmx":MN,".tsx":MN,".json":IN,".ExportJson":IN,".plist":MN,".ccon":DN,".cconb":ON,".fnt":MN,".binary":RN,".bin":RN,".dbbin":RN,".skel":RN,".js":CN,bundle:NN,default:MN},this._downloading=new Zl,this._queue=[],this._queueDirty=!1,this._totalNum=0,this._totalNumThisPeriod=0,this._lastDate=-1,this._checkNextPeriod=!1,this._remoteServerAddress="",this._maxInterval=1/30}var e=t.prototype;return e.init=function(t,e,n){void 0===t&&(t=""),void 0===e&&(e={}),void 0===n&&(n=[]),this._downloading.clear(),this._queue.length=0,this._remoteServerAddress=t,this.bundleVers=e,this.remoteBundles=n},e.register=function(t,e){"object"==typeof t?At(this._downloaders,t):this._downloaders[t]=e},e.download=function(t,e,n,i,r){var a=this,o=eu.get(t);if(o)r(null,o);else{var s=this._downloading.get(t);if(s){s.push(r);var c=this._queue.find((function(e){return e.id===t}));if(!c)return;var l=i.priority||0;c.priority<l&&(c.priority=l,this._queueDirty=!0)}else{var u=void 0!==i.maxRetryCount?i.maxRetryCount:this.maxRetryCount,h=void 0!==i.maxConcurrency?i.maxConcurrency:this.maxConcurrency,f=void 0!==i.maxRequestsPerFrame?i.maxRequestsPerFrame:this.maxRequestsPerFrame,_=this._downloaders[n]||this._downloaders.default;fN((function(n,o){if(0===n&&a._downloading.add(t,[r]),a.limited){a._updateTime();var s=function(t,e){a._totalNum--,a._handleQueueInNextFrame(h,f),o(t,e)};a._totalNum<h&&a._totalNumThisPeriod<f?(_(hN(e,a.appendTimeStamp),i,s),a._totalNum++,a._totalNumThisPeriod++):(a._queue.push({id:t,priority:i.priority||0,url:e,options:i,done:s,handler:_}),a._queueDirty=!0,a._totalNum<h&&a._handleQueueInNextFrame(h,f))}else _(hN(e,a.appendTimeStamp),i,o)}),u,this.retryInterval,(function(e,n){e||eu.add(t,n);for(var i=a._downloading.remove(t),r=0,o=i.length;r<o;r++)i[r](e,n)}))}}},e.loadSubpackage=function(t,e){i.assetManager.loadBundle(t,null,e)},e._updateTime=function(){var t=performance.now(),e=i.game.deltaTime,n=e>this._maxInterval?this._maxInterval:e;t-this._lastDate>1e3*n&&(this._totalNumThisPeriod=0,this._lastDate=t)},e._handleQueue=function(t,e){for(this._checkNextPeriod=!1,this._updateTime();this._queue.length>0&&this._totalNum<t&&this._totalNumThisPeriod<e;){this._queueDirty&&(this._queue.sort((function(t,e){return t.priority-e.priority})),this._queueDirty=!1);var n=this._queue.pop();if(!n)break;this._totalNum++,this._totalNumThisPeriod++,n.handler(hN(n.url,this.appendTimeStamp),n.options,n.done)}this._handleQueueInNextFrame(t,e)},e._handleQueueInNextFrame=function(t,e){!this._checkNextPeriod&&this._queue.length>0&&(le(this._handleQueue.bind(this),t,e),this._checkNextPeriod=!0)},L(t,[{key:"remoteServerAddress",get:function(){return this._remoteServerAddress}}]),t}());function BN(t,e,n,i){var r=null,a=null;try{(r=new Dm)._nativeUrl=t,r._nativeAsset=e}catch(t){a=t}i(a,r)}function FN(t,e,n,i){var r=new uO;r.json=e,i(null,r)}function zN(t,e,n,i){var r=new lO;r.text=e,i(null,r)}function UN(t,e,n,i){var r=new Bb;r._nativeUrl=t,r._nativeAsset=e,i(null,r)}function kN(t,e,n,i){var r=new Ou;r._nativeUrl=t,r._nativeAsset=e,i(null,r)}function GN(t,n,i,r){var a=iu.get(n.name);a||(a=n.name===su.RESOURCES?SN:new xN,n.base=n.base||t+"/",a.init(n)),e.import("virtual:///prerequisite-imports/"+a.name).then((function(){r(null,a)})).catch(r)}var HN=new(function(){function t(){this._creating=new Zl,this._producers={".png":BN,".jpg":BN,".bmp":BN,".jpeg":BN,".gif":BN,".ico":BN,".tiff":BN,".webp":BN,".image":BN,".pvr":BN,".pkm":BN,".txt":zN,".xml":zN,".vsh":zN,".fsh":zN,".atlas":zN,".tmx":zN,".tsx":zN,".fnt":zN,".json":FN,".ExportJson":FN,".binary":UN,".bin":UN,".dbbin":UN,".skel":UN,bundle:GN,default:kN}}var e=t.prototype;return e.register=function(t,e){"object"==typeof t?Gt.mixin(this._producers,t):this._producers[t]=e},e.create=function(t,e,n,i,r){var a=this,o=this._producers[n]||this._producers.default,s=tu.get(t);if(i.reloadAsset||!s){var c=this._creating.get(t);c?c.push(r):(this._creating.add(t,[r]),o(t,e,i,(function(e,n){!e&&n instanceof Ou&&(n._uuid=t,pN(t,n,i.cacheAsset));for(var r=a._creating.remove(t),o=0,s=r.length;o<s;o++)r[o](e,n)})))}else r(null,s)},t}()),VN=new(function(){function t(){this._loading=new Zl,this._unpackers={".json":this.unpackJson}}var e=t.prototype;return e.unpackJson=function(t,e,n,i){var r=Gt.createMap(!0),a=null;if(Array.isArray(e)){(e=function(t){if(t[0]<1)throw new Error(R(5304,t[0]));Nh(t,!0,void 0,Bh.reportMissingClass),Lh(t);for(var e=new Fh(t[0]),n=t[1],i=t[2],r=t[3],a=t[4],o=t[5],s=0;s<o.length;++s)o[s].unshift(e,n,i,r,a);return o}(e)).length!==t.length&&b(4915);for(var o=0;o<t.length;o++)r[t[o]+"@import"]=e[o]}else{var s=Gt._getClassId(ng),c=Gt._getClassId(Dm);if(e.type===s&&e.data){var l=e.data;l.length!==t.length&&b(4915);for(var u=0;u<t.length;u++)r[t[u]+"@import"]=zh(s,{base:l[u][0],mipmaps:l[u][1]})}else if(e.type===c&&e.data){var h=e.data;h.length!==t.length&&b(4915);for(var f=0;f<t.length;f++)r[t[f]+"@import"]=h[f]}else a=new Error("unmatched type pack!"),r=null}i(a,r)},e.init=function(){this._loading.clear()},e.register=function(t,e){"object"==typeof t?Gt.mixin(this._unpackers,t):this._unpackers[t]=e},e.unpack=function(t,e,n,i,r){e?(0,this._unpackers[n])(t,e,i,r):r(new Error("package data is wrong!"))},e.load=function(t,e,n){var i=this;if(!t.isNative&&t.info&&t.info.packs)if(eu.has(t.id))n(null,eu.get(t.id));else{var r=t.info.packs,a=r.find((function(t){return i._loading.has(t.uuid)}));if(a)this._loading.get(a.uuid).push({onComplete:n,id:t.id});else{a=r[0],this._loading.add(a.uuid,[{onComplete:n,id:t.id}]);var o=xu(a.uuid,{ext:a.ext,bundle:t.config.name});LN.download(a.uuid,o,a.ext,t.options,(function(e,n){eu.remove(a.uuid),e&&d(e.message,e.stack),i.unpack(a.packedUuids,n,a.ext,t.options,(function(t,n){if(!t)for(var r in n)eu.add(r,n[r]);for(var o=i._loading.remove(a.uuid),s=0,c=o.length;s<c;s++){var l=o[s];if(e||t)l.onComplete(e||t);else{var u=n[l.id];u?l.onComplete(null,u):l.onComplete(new Error("can not retrieve data from package"))}}}))}))}}else LN.download(t.id,t.url,t.ext,t.options,n)},t}());function jN(t,e){var n=!1;t.progress||(t.progress={finish:0,total:t.input.length,canInvoke:!0},n=!0);var r=t.options,a=t.progress,o=[],s=a.total,c=r.__exclude__=r.__exclude__||Object.create(null);t.output=[],dN(t.input,(function(r,l){if(!r.isNative&&tu.has(r.uuid)){var u=tu.get(r.uuid);return r.content=u.addRef(),t.output.push(r),a.canInvoke&&t.dispatch("progress",++a.finish,a.total,r),void l()}VN.load(r,t.options,(function(u,h){u?t.isFinish||(!i.assetManager.force||n?(d(u.message,u.stack),a.canInvoke=!1,e(u)):(t.output.push(r),a.canInvoke&&t.dispatch("progress",++a.finish,a.total,r))):t.isFinish||(r.file=h,t.output.push(r),r.isNative||(c[r.uuid]=!0,_N(r.uuid,h,c,o,r.config),a.total=s+o.length),a.canInvoke&&t.dispatch("progress",++a.finish,a.total,r)),l()}))}),(function(){if(t.isFinish)return uN(t,!0),void t.dispatch("error");if(o.length>0){var i=lu.create({input:o,progress:a,options:r,onProgress:t.onProgress,onError:lu.prototype.recycle,onComplete:function(r){var a;r||((a=t.output).push.apply(a,i.output),i.recycle()),n&&WN(t),e(r)}});au.async(i)}else n&&WN(t),e()}))}function WN(t){for(var e=t.output,n=0,i=e.length;n<i;n++)e[n].content&&e[n].content.decRef(!1)}var XN=function(){function t(){this._parser=null,window.DOMParser&&(this._parser=new DOMParser)}var e=t.prototype;return e.parse=function(t){return this._parseXML(t)},e._parseXML=function(t){if(this._parser)return this._parser.parseFromString(t,"text/xml");throw new Error("Dom parser is not supported in this platform!")},t}(),qN=new(function(t){function e(){return t.apply(this,arguments)||this}F(e,t);var n=e.prototype;return n.parse=function(t){var e=this._parseXML(t).documentElement;if("plist"!==e.tagName)return E(5100),{};for(var n=null,i=0,r=e.childNodes.length;i<r&&1!==(n=e.childNodes[i]).nodeType;i++);return this._parseNode(n)},n._parseNode=function(t){var e=null,n=t.tagName;if("dict"===n)e=this._parseDict(t);else if("array"===n)e=this._parseArray(t);else if("string"===n)if(1===t.childNodes.length)e=t.firstChild.nodeValue;else{e="";for(var i=0;i<t.childNodes.length;i++)e+=t.childNodes[i].nodeValue}else"false"===n?e=!1:"true"===n?e=!0:"real"===n?e=parseFloat(t.firstChild.nodeValue):"integer"===n&&(e=parseInt(t.firstChild.nodeValue,10));return e},n._parseArray=function(t){for(var e=[],n=0,i=t.childNodes.length;n<i;n++){var r=t.childNodes[n];1===r.nodeType&&e.push(this._parseNode(r))}return e},n._parseDict=function(t){for(var e={},n="",i=0,r=t.childNodes.length;i<r;i++){var a=t.childNodes[i];1===a.nodeType&&("key"===a.tagName?n=a.firstChild.nodeValue:e[n]=this._parseNode(a))}return e},e}(XN));function YN(t,e){return t[e]<<8|t[e+1]}var KN=new(function(){function t(){this._parsing=new Zl,this._parsers={".png":this.parseImage,".jpg":this.parseImage,".bmp":this.parseImage,".jpeg":this.parseImage,".gif":this.parseImage,".ico":this.parseImage,".tiff":this.parseImage,".webp":this.parseImage,".image":this.parseImage,".pvr":this.parsePVRTex,".pkm":this.parsePKMTex,".astc":this.parseASTCTex,".plist":this.parsePlist,import:this.parseImport,".ccon":this.parseImport,".cconb":this.parseImport}}var e=t.prototype;return e.parseImage=function(t,e,n){t instanceof HTMLImageElement?n(null,t):createImageBitmap(t,{premultiplyAlpha:"none"}).then((function(t){n(null,t)}),(function(t){n(t,null)}))},e.parsePVRTex=function(t,e,n){var i=null,r=null;try{var a=t instanceof ArrayBuffer?t:t.buffer,o=new Int32Array(a,0,13);if(55727696===o[0]){var s=o[7],c=o[6],l=o[12]+52;r={_data:new Uint8Array(a,l),_compressed:!0,width:s,height:c,format:0}}else{if(559044176!==o[11])throw new Error("Invalid magic number in PVR header");var u=o[0],h=o[1],f=o[2];r={_data:new Uint8Array(a,u),_compressed:!0,width:f,height:h,format:0}}}catch(t){i=t}n(i,r)},e.parsePKMTex=function(t,e,n){var i=null,r=null;try{var a=t instanceof ArrayBuffer?t:t.buffer,o=new Uint8Array(a),s=YN(o,6);if(0!==s&&1!==s&&3!==s)throw new Error("Invalid magic number in ETC header");var c=YN(o,12),l=YN(o,14);YN(o,8),YN(o,10),r={_data:new Uint8Array(a,16),_compressed:!0,width:c,height:l,format:0}}catch(t){i=t}n(i,r)},e.parseASTCTex=function(t,e,n){var i=null,r=null;try{var a=t instanceof ArrayBuffer?t:t.buffer,o=new Uint8Array(a);if(1554098963!==o[0]+(o[1]<<8)+(o[2]<<16)+(o[3]<<24))throw new Error("Invalid magic number in ASTC header");var s=o[4],c=o[5],l=o[6];if((s<3||s>6||c<3||c>6||l<3||l>6)&&(s<4||7===s||9===s||11===s||s>12||c<4||7===c||9===c||11===c||c>12||1!==l))throw new Error("Invalid block number in ASTC header");var u=function(t,e){return 4===t?em.RGBA_ASTC_4x4:5===t?4===e?em.RGBA_ASTC_5x4:em.RGBA_ASTC_5x5:6===t?5===e?em.RGBA_ASTC_6x5:em.RGBA_ASTC_6x6:8===t?5===e?em.RGBA_ASTC_8x5:6===e?em.RGBA_ASTC_8x6:em.RGBA_ASTC_8x8:10===t?5===e?em.RGBA_ASTC_10x5:6===e?em.RGBA_ASTC_10x6:8===e?em.RGBA_ASTC_10x8:em.RGBA_ASTC_10x10:10===e?em.RGBA_ASTC_12x10:em.RGBA_ASTC_12x12}(s,c),h=o[7]+(o[8]<<8)+(o[9]<<16),f=o[10]+(o[11]<<8)+(o[12]<<16);o[13],o[14],o[15],r={_data:new Uint8Array(a,16),_compressed:!0,width:h,height:f,format:u}}catch(t){i=t}n(i,r)},e.parsePlist=function(t,e,n){var i=null,r=qN.parse(t);r||(i=new Error("parse failed")),n(i,r)},e.parseImport=function(t,e,n){if(t){var i=null,r=null;try{i=Fm(t,e)}catch(t){r=t}n(r,i)}else n(new Error("The json file of asset "+e.__uuid__+" is empty or missing"))},e.init=function(){this._parsing.clear()},e.register=function(t,e){"object"==typeof t?At(this._parsers,t):this._parsers[t]=e},e.parse=function(t,e,n,i,r){var a=this,o=nu.get(t);if(o)r(null,o);else{var s=this._parsing.get(t);if(s)s.push(r);else{var c=this._parsers[n];c?(this._parsing.add(t,[r]),c(e,i,(function(e,n){e?eu.remove(t):vu(n)||nu.add(t,n);for(var i=a._parsing.remove(t),r=0,o=i.length;r<o;r++)i[r](e,n)}))):r(null,e)}}},t}());function QN(t,e){var n=!1;t.progress||(t.progress={finish:0,total:t.input.length,canInvoke:!0},n=!0);var r=t.options,a=t.progress;r.__exclude__=r.__exclude__||Object.create(null),t.output=[],dN(t.input,(function(o,s){var c=lu.create({input:o,onProgress:t.onProgress,options:r,progress:a,onComplete:function(r,l){r&&!t.isFinish&&(!i.assetManager.force||n?(d(r.message,r.stack),a.canInvoke=!1,e(r)):a.canInvoke&&t.dispatch("progress",++a.finish,a.total,o)),t.output.push(l),c.recycle(),s(null)}});ZN.async(c)}),(function(){if(r.__exclude__=null,t.isFinish)return uN(t,!0),void t.dispatch("error");!function(t){var e=t.source;if(t.options.__outputAsArray__||1!==e.length)for(var n=t.output=[],i=0,r=e.length;i<r;i++)n.push(e[i].content);else t.output=e[0].content}(t),uN(t,!0),e()}))}var ZN=new Jl("loadOneAsset",[function(t,e){var n=t.output=t.input,i=n.options,r=n.isNative,a=n.uuid,o=n.file,s=i.reloadAsset;o||!s&&!r&&tu.has(a)?e():VN.load(n,t.options,(function(t,i){n.file=i,e(t)}))},function(t,e){var n=t.output=t.input,i=t.progress,r=t.options.__exclude__,a=n.id,o=n.file,s=n.options;if(n.isNative)KN.parse(a,o,n.ext,s,(function(r,o){r?e(r):(n.content=o,i.canInvoke&&t.dispatch("progress",++i.finish,i.total,n),eu.remove(a),nu.remove(a),e())}));else{var c=n.uuid;if(c in r){var l=r[c],u=l.finish,h=l.content,f=l.err,_=l.callbacks;i.canInvoke&&t.dispatch("progress",++i.finish,i.total,n),u||vN(c,c,r)?(h&&h.addRef(),n.content=h,e(f)):_.push({done:e,item:n})}else if(!s.reloadAsset&&tu.has(c)){var p=tu.get(c);n.content=p.addRef(),i.canInvoke&&t.dispatch("progress",++i.finish,i.total,n),e()}else s.__uuid__=c,KN.parse(a,o,"import",s,(function(n,i){n?e(n):function(t,e,n){var i=t.input,r=t.progress,a=i,o=a.uuid,s=a.id,c=a.options,l=a.config,u=c.cacheAsset,h=[];e.addRef&&e.addRef(),_N(o,e,Object.create(null),h,l),r.canInvoke&&t.dispatch("progress",++r.finish,r.total+=h.length,i);var f=t.options.__exclude__[o]={content:e,finish:!1,callbacks:[{done:n,item:i}]},_=lu.create({input:h,options:t.options,onProgress:t.onProgress,onError:lu.prototype.recycle,progress:r,onComplete:function(t){if(e.decRef&&e.decRef(!1),f.finish=!0,f.err=t,!t){for(var n,i=Array.isArray(_.output)?_.output:[_.output],r=Object.create(null),a=W(i);!(n=a()).done;){var c=n.value;c&&(r[c instanceof Ou?c._uuid+"@import":o+"@native"]=c)}!function(t,e,n){var i=Nm.get(e);if(i){for(var r=0,a=i.length;r<a;r++){var o=i[r],s=n[o.uuid+"@import"];if(s)o.owner[o.prop]=s.addRef();else{if(d("The asset "+o.uuid+" is missing!"),o.type&&o.type!==Ou){var c=new o.type;c.initDefault(o.uuid),o.owner[o.prop]=c}!0}}Nm.delete(e)}Lm.has(e)&&(n[t+"@native"]?e._nativeAsset=n[t+"@native"]:(!0,console.error("the native asset of "+t+" is missing!")),Lm.delete(e))}(o,e,r);try{"function"!=typeof e.onLoaded||Bm.has(e)||Lm.has(e)||(e.onLoaded(),Bm.add(e))}catch(t){d("The asset "+o+" is invalid for some reason, detail message: "+t.message+", stack: "+t.stack)}eu.remove(s),nu.remove(s),pN(o,e,u),_.recycle()}for(var l=f.callbacks,h=0,p=l.length;h<p;h++){var m=l[h];e.addRef&&e.addRef(),m.item.content=e,m.done(t)}l.length=0}});ru.async(_)}(t,i,e)}))}}]);function JN(t,e){var n=t.options,i=Object.create(null),r=Object.create(null);for(var a in n)switch(a){case $l.PATH:case $l.UUID:case $l.DIR:case $l.SCENE:case $l.URL:break;case"__requestType__":case"__isNative__":case"ext":case"type":case"__nativeName__":case"audioLoadMode":case"bundle":i[a]=n[a];break;case"__exclude__":case"__outputAsArray__":r[a]=n[a];break;default:i[a]=n[a],r[a]=n[a]}t.options=r;var o=lu.create({input:t.input,options:i}),s=null;try{t.output=t.source=ou.sync(o)}catch(t){s=t;for(var c=0,l=o.output.length;c<l;c++)o.output[c].recycle()}o.recycle(),e(s)}var $N=function(){function t(){this.uuid="",this.url="",this.ext=".json",this.content=null,this.file=null,this.info=null,this.config=null,this.isNative=!1,this.options=Object.create(null),this._id=""}return t.create=function(){return 0!==t._deadPool.length?t._deadPool.pop():new t},t.prototype.recycle=function(){t._deadPool.length!==t.MAX_DEAD_NUM&&(this._id="",this.uuid="",this.url="",this.ext=".json",this.content=null,this.file=null,this.info=null,this.config=null,this.isNative=!1,this.options=Object.create(null),t._deadPool.push(this))},L(t,[{key:"id",get:function(){return this._id||(this._id=this.uuid+"@"+(this.isNative?"native":"import")),this._id}}]),t}();$N.MAX_DEAD_NUM=500,$N._deadPool=[];var tL=[];function eL(t){var e=t.options,n=Array.isArray(t.input)?t.input:[t.input];t.output=[];for(var i=function(i){var r,a=n[i],o=$N.create(),s=null,c=null;if("string"==typeof a&&((a=Object.create(null))[e.__requestType__||$l.UUID]=n[i]),"object"==typeof a)for(var l in Tt(a,e),a.preset&&Tt(a,cu[a.preset]),a){switch(l){case $l.UUID:if("break"===function(){var t,e=o.uuid=pu(a.uuid);if(!a.bundle){var n=iu.find((function(t){return!!t.getAssetInfo(e)}));a.bundle=n&&n.name}if(iu.has(a.bundle)){if(s=iu.get(a.bundle).config,(c=s.getAssetInfo(e))&&c.redirect){if(!iu.has(c.redirect))throw new Error("Please load bundle "+c.redirect+" first");s=iu.get(c.redirect).config,c=s.getAssetInfo(e)}o.config=s,o.info=c}return o.ext=a.ext||(null===(t=c)||void 0===t?void 0:t.extension)||".json","break"}())break;case"__requestType__":case"ext":case"bundle":case"preset":case"type":break;case $l.DIR:if(iu.has(a.bundle)){iu.get(a.bundle).config.getDirWithPath(a.dir,a.type,tL);for(var u,h=W(tL);!(u=h()).done;){var f=u.value;n.push({uuid:f.uuid,__isNative__:!1,ext:f.extension||".json",bundle:a.bundle})}tL.length=0}o.recycle(),o=null;break;case $l.PATH:if(iu.has(a.bundle)){if(s=iu.get(a.bundle).config,(c=s.getInfoWithPath(a.path,a.type))&&c.redirect){if(!iu.has(c.redirect))throw new Error("you need to load bundle "+c.redirect+" first");s=iu.get(c.redirect).config,c=s.getAssetInfo(c.uuid)}if(!c)throw o.recycle(),new Error("Bundle "+a.bundle+" doesn't contain "+a.path);o.config=s,o.uuid=c.uuid,o.info=c}o.ext=a.ext||(null===(r=c)||void 0===r?void 0:r.extension)||".json";break;case $l.SCENE:if(!a.bundle){var _=iu.find((function(t){return!!t.getSceneInfo(a.scene)}));a.bundle=_&&_.name}if(iu.has(a.bundle)){if(s=iu.get(a.bundle).config,(c=s.getSceneInfo(a.scene))&&c.redirect){if(!iu.has(c.redirect))throw new Error("you need to load bundle "+c.redirect+" first");s=iu.get(c.redirect).config,c=s.getAssetInfo(c.uuid)}if(!c)throw o.recycle(),new Error("Bundle "+s.name+" doesn't contain scene "+a.scene);o.config=s,o.uuid=c.uuid,o.info=c}break;case"__isNative__":o.isNative=a.__isNative__;break;case $l.URL:o.url=a.url,o.uuid=a.uuid||a.url,o.ext=a.ext||vn(a.url),o.isNative=void 0===a.__isNative__||a.__isNative__;break;default:o.options[l]=a[l]}if(!o)break}if(!o)return"continue";if(t.output.push(o),!o.uuid&&!o.url)throw new Error("Can not parse this input:"+JSON.stringify(a))},r=0;r<n.length;r++)i(r);return null}function nL(t){for(var e=t.output=t.input,n=0;n<e.length;n++){var r=e[n];if(!r.url){var a,o,s=r.config;o=r.isNative?s&&s.nativeBase?s.base+s.nativeBase:i.assetManager.generalNativeBase:s&&s.importBase?s.base+s.importBase:i.assetManager.generalImportBase;var c=r.uuid,l="";r.info&&(l=r.isNative?r.info.nativeVer?"."+r.info.nativeVer:"":r.info.ver?"."+r.info.ver:""),a=".ttf"===r.ext?o+"/"+c.slice(0,2)+"/"+c+l+"/"+r.options.__nativeName__:o+"/"+c.slice(0,2)+"/"+c+l+r.ext,r.url=a}}return null}var iL=t("AssetManager",function(){function t(){this.pipeline=ru.append(JN).append(QN),this.fetchPipeline=au.append(JN).append(jN),this.transformPipeline=ou.append(eL).append(nL),this.bundles=iu,this.assets=tu,this.generalImportBase="",this.generalNativeBase="",this.dependUtil=Um,this.force=!1,this.allowImageBitmap=!lh.isMobile,this.utils=Iu,this.downloader=LN,this.parser=KN,this.packManager=VN,this.cacheAsset=!0,this.cacheManager=null,this.presets=cu,this.factory=HN,this.preprocessPipe=JN,this.fetchPipe=jN,this.loadPipe=QN,this.references=null,this._releaseManager=cN,this._files=eu,this._parsed=nu,this._parsePipeline=null}var e=t.prototype;return e.init=function(t){void 0===t&&(t={}),this._files.clear(),this._parsed.clear(),this._releaseManager.init(),this.assets.clear(),this.bundles.clear(),this.packManager.init(),this.downloader.init(t.server,t.bundleVers,t.remoteBundles),this.parser.init(),this.dependUtil.init();var e=t.importBase||"";e&&e.endsWith("/")&&(e=e.substr(0,e.length-1));var n=t.nativeBase||"";n&&n.endsWith("/")&&(n=n.substr(0,n.length-1)),this.generalImportBase=e,this.generalNativeBase=n},e.getBundle=function(t){return iu.get(t)||null},e.removeBundle=function(t){t._destroy(),iu.remove(t.name)},e.loadAny=function(t,e,n,i){var r=mN(e,n,i),a=r.options,o=r.onProgress,s=r.onComplete;a.preset=a.preset||"default",t=Array.isArray(t)?t.slice():t;var c=lu.create({input:t,onProgress:o,onComplete:yN(s),options:a});ru.async(c)},e.preloadAny=function(t,e,n,i){var r=mN(e,n,i),a=r.options,o=r.onProgress,s=r.onComplete;a.preset=a.preset||"preload",t=Array.isArray(t)?t.slice():t;var c=lu.create({input:t,onProgress:o,onComplete:yN(s),options:a});au.async(c)},e.loadRemote=function(t,e,n){var i=mN(e,void 0,n),r=i.options,a=i.onComplete;r.reloadAsset||!this.assets.has(t)?(r.__isNative__=!0,r.preset=r.preset||"remote",this.loadAny({url:t},r,null,(function(e,n){e?(d(e.message,e.stack),a&&a(e,n)):HN.create(t,n,r.ext||vn(t),r,(function(t,e){a&&a(t,e)}))}))):yN(a)(null,this.assets.get(t))},e.loadBundle=function(t,e,n){var i=mN(e,void 0,n),r=i.options,a=i.onComplete,o=xn(t);this.bundles.has(o)?yN(a)(null,this.getBundle(o)):(r.preset=r.preset||"bundle",r.ext="bundle",r.__isNative__=!0,this.loadAny({url:t},r,null,(function(e,n){e?(d(e.message,e.stack),a&&a(e,n)):HN.create(t,n,"bundle",r,(function(t,e){a&&a(t,e)}))})))},e.releaseAsset=function(t){cN.tryRelease(t,!0)},e.releaseUnusedAssets=function(){tu.forEach((function(t){cN.tryRelease(t)}))},e.releaseAll=function(){tu.forEach((function(t){cN.tryRelease(t,!0)}))},e.loadWithJson=function(){throw new Error("Only valid in Editor")},L(t,[{key:"main",get:function(){return iu.get(su.MAIN)||null}},{key:"resources",get:function(){return iu.get(su.RESOURCES)||null}}]),t}());iL.Pipeline=Jl,iL.Task=lu,iL.Cache=Zl,iL.RequestItem=$N,iL.Bundle=xN,iL.BuiltinBundleName=su;var rL=t("assetManager",i.assetManager=new iL);i.AssetManager=iL;var aL=[".png",".jpg",".bmp",".jpeg",".gif",".ico",".tiff",".webp",".image",".pvr",".pkm",".astc"],oL=[".mp3",".ogg",".wav",".m4a"];function sL(){return!0}var cL={transformURL:function(t){var e=mu(t);if(!e)return t;var n=iu.find((function(t){return!!t.getAssetInfo(e)}));if(!n)return t;var i,r=n.getAssetInfo(e);if(!(i=t.startsWith(n.base+n.config.nativeBase)?r.nativeVer||"":r.ver||"")||-1!==t.indexOf(i))return t;var a=!1;if(".ttf"===vn(t)&&(a=!0),a){var o=Sn(t),s=xn(t);t=o+"."+i+"/"+s}else t=t.replace(/.*[/\\][0-9a-fA-F]{2}[/\\]([0-9a-fA-F-@]{8,})/,(function(t){return t+"."+i}));return t}},lL=t("CCLoader",function(){function t(){this._autoReleaseSetting=Object.create(null),this._parseLoadResArgs=gN}var e=t.prototype;return e.load=function(t,e,n){void 0===n&&void 0!==e&&(n=e,e=null);for(var i=Array.isArray(t)?t:[t],r=0;r<i.length;r++){var a=i[r];"string"==typeof a?i[r]={url:a,__isNative__:!0}:(a.type&&(a.ext="."+a.type,a.type=void 0),a.url&&(a.__isNative__=!0))}var o=[],s=[];rL.loadAny(i,null,(function(t,n,i){i.content&&(aL.includes(i.ext)?o.push(i.content):oL.includes(i.ext)&&s.push(i.content)),e&&e(t,n,i)}),(function(t,e){var r=null;if(!t){e=Array.isArray(e)?e:[e];for(var a=function(t){var n=e[t];if(!(n instanceof Ou)){var r=n,a=i[t].url;o.includes(r)?HN.create(a,n,".png",{},(function(n,i){r=e[t]=i})):s.includes(r)&&HN.create(a,n,".mp3",{},(function(n,i){r=e[t]=i})),tu.add(a,r)}},c=0;c<e.length;c++)a(c);if(e.length>1){var l=Object.create(null);e.forEach((function(t){l[t._uuid]=t})),r={isCompleted:sL,_map:l}}else r=e[0]}n&&n(t,r)}))},e.getXMLHttpRequest=function(){return new XMLHttpRequest},e.getItem=function(t){return rL.assets.has(t)?{content:rL.assets.get(t)}:null},e.loadRes=function(t,e,n,i){var r=this._parseLoadResArgs(e,n,i),a=r.type,o=r.onProgress,s=r.onComplete,c=vn(t);c&&!SN.getInfoWithPath(t,a)&&(t=t.slice(0,-c.length)),SN.load(t,a,o,s)},e.loadResArray=function(t,e,n,i){var r=this._parseLoadResArgs(e,n,i),a=r.type,o=r.onProgress,s=r.onComplete;t.forEach((function(e,n){var i=vn(e);i&&!SN.getInfoWithPath(e,a)&&(t[n]=e.slice(0,-i.length))})),SN.load(t,a,o,s)},e.loadResDir=function(t,e,n,i){var r=this._parseLoadResArgs(e,n,i),a=r.type,o=r.onProgress,s=r.onComplete;SN.loadDir(t,a,o,(function(e,n){var i=[];e||(i=SN.getDirWithPath(t,a).map((function(t){return t.path}))),s&&s(e,n,i)}))},e.getRes=function(t,e){return tu.has(t)?tu.get(t):SN.get(t,e)},e.getResCount=function(){return tu.count},e.getDependsRecursively=function(t){if(!t)return[];var e="string"==typeof t?t:t._uuid;return Um.getDepsRecursively(e).concat([e])},e.addDownloadHandlers=function(t){var e=Object.create(null),n=function(n){var i=t[n];e["."+n]=function(t,e,n){i({url:t},n)}};for(var i in t)n(i);LN.register(e)},e.addLoadHandlers=function(t){var e=Object.create(null),n=function(n){var i=t[n];e["."+n]=function(t,e,n){i({content:t},n)}};for(var i in t)n(i);KN.register(e)},e.release=function(t){if(Array.isArray(t))for(var e=0;e<t.length;e++){var n=t[e];"string"==typeof n&&(n=tu.get(n)),rL.releaseAsset(n)}else t&&("string"==typeof t&&(t=tu.get(t)),rL.releaseAsset(t))},e.releaseAsset=function(t){rL.releaseAsset(t)},e.releaseRes=function(t,e){SN.release(t,e)},e.releaseAll=function(){rL.releaseAll(),tu.clear()},e.removeItem=function(t){return!!tu.remove(t)},e.setAutoRelease=function(t,e){"object"==typeof t&&(t=t._uuid),this._autoReleaseSetting[t]=!!e},e.setAutoReleaseRecursively=function(t,e){"object"==typeof t&&(t=t._uuid),e=!!e,this._autoReleaseSetting[t]=e;for(var n=Um.getDepsRecursively(t),i=0;i<n.length;i++)this._autoReleaseSetting[n[i]]=e},e.isAutoRelease=function(t){return"object"==typeof t&&(t=t._uuid),!!this._autoReleaseSetting[t]},L(t,[{key:"onProgress",set:function(t){lN=t}},{key:"_cache",get:function(){if(tu instanceof Zl)return tu._map;var t={};return tu.forEach((function(e,n){t[n]=e})),t}},{key:"md5Pipe",get:function(){return cL}},{key:"downloader",get:function(){return LN}},{key:"loader",get:function(){return rL.parser}}]),t}()),uL=t("loader",new lL),hL=t("AssetLibrary",{init:function(t){t.importBase=t.libraryPath,t.nativeBase=t.rawAssetsBase,rL.init(t),t.rawAssets&&SN.init({base:"",deps:[],scenes:{},redirect:[],debug:!0,packs:{},types:[],versions:{import:[],native:[]},name:su.RESOURCES,importBase:t.importBase,nativeBase:t.nativeBase,paths:t.rawAssets.assets,uuids:Object.keys(t.rawAssets.assets),extensionMap:{}})},loadAsset:function(t,e){rL.loadAny(t,e)}}),fL=t("url",{});Nn(fL,"url",[{name:"normalize",target:rL.utils,targetName:"assetManager.utils",newName:"normalize"},{name:"raw",targetName:"Asset.prototype",newName:"nativeUrl",customFunction:function(t){return t.startsWith("resources/")?xu({path:Tn(t.substr(10)),bundle:su.RESOURCES,__isNative__:!0,ext:vn(t)}):""}}]),Ln(hL,"AssetLibrary",[{name:"getLibUrlNoExt",suggest:"AssetLibrary.getLibUrlNoExt was removed, if you want to transform url, please use cc.assetManager.utils.getUrlWithUuid instead"},{name:"queryAssetInfo",suggest:"AssetLibrary.queryAssetInfo was removed"}]),Ln(uL,"loader",[{name:"releaseResDir",suggest:"loader.releaseResDir was removed, please use assetManager.releaseAsset instead"},{name:"flowInDeps",suggest:"loader.flowInDeps was removed"},{name:"assetLoader",suggest:"cc.loader.assetLoader was removed, assetLoader and md5Pipe were merged into cc.assetManager.transformPipeline"}]),Nn(i,"cc",[{name:"loader",newName:"assetManager",logTimes:1,customGetter:function(){return uL}},{name:"AssetLibrary",newName:"assetManager",logTimes:1,customGetter:function(){return hL}},{name:"Pipeline",target:iL,targetName:"AssetManager",newName:"Pipeline",logTimes:1},{name:"url",targetName:"assetManager",newName:"utils",logTimes:1,customGetter:function(){return fL}}]),Ln(i,"cc",[{name:"LoadingItems",suggest:R(1400,"cc.LoadingItems","cc.AssetManager.Task")}]),Nn($t,"macro",[{name:"DOWNLOAD_MAX_CONCURRENT",target:LN,targetName:"assetManager.downloader",newName:"maxConcurrency"}]),Nn(WM,"director",[{name:"_getSceneUuid",targetName:"assetManager.main",newName:"getSceneInfo",customFunction:function(t){var e;return rL.main?null===(e=rL.main.getSceneInfo(t))||void 0===e?void 0:e.uuid:""}}]),Nn(VM,"game",[{name:"_sceneInfos",targetName:"assetManager.main",newName:"getSceneInfo",customGetter:function(){var t=[];return rL.main&&rL.main.config.scenes.forEach((function(e){t.push(e)})),t}}]);var _L,pL,dL,mL,gL,vL,yL,xL,SL,TL,AL,EL,CL,bL,wL=cN._autoRelease;cN._autoRelease=function(t,e,n){wL.call(cN,t,e,n);for(var i=uL._autoReleaseSetting,r=Object.keys(i),a=0;a<r.length;a++){var o=r[a];if(!0===i[o]){var s=tu.get(o);s&&cN.tryRelease(s)}}};var PL,IL,RL,DL,OL,ML,NL,LL,BL,FL,zL,UL,kL,GL,HL,VL,jL,WL,XL,qL,YL,KL,QL,ZL,JL,$L,tB,eB,nB,iB,rB,aB,oB,sB,cB,lB,uB,hB,fB,_B,pB,dB,mB,gB,vB,yB,xB,SB,TB,AB,EB,CB,bB,wB,PB,IB,RB,DB,OB,MB,NB,LB,BB,FB,zB,UB,kB,GB=t("EventHandler",(_L=nl("cc.ClickEvent"),pL=Bl(i.Node),dL=Al(),mL=Al(),gL=Al(),vL=Al(),_L((bL=function(){function t(){X(this,"target",SL,this),X(this,"component",TL,this),X(this,"_componentId",AL,this),X(this,"handler",EL,this),X(this,"customEventData",CL,this)}t.emitEvents=function(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];for(var a=0,o=e.length;a<o;a++){var s=e[a];s instanceof t&&s.emit(i)}};var e=t.prototype;return e.emit=function(t){var e=this.target;if(i.isValid(e)){this._genCompIdIfNeeded();var n=i.js._getClassById(this._componentId),r=e.getComponent(n);if(i.isValid(r)){var a=r[this.handler];"function"==typeof a&&(null!=this.customEventData&&""!==this.customEventData&&(t=t.slice()).push(this.customEventData),a.apply(r,t))}}},e._compName2Id=function(t){var e=i.js.getClassByName(t);return i.js._getClassId(e)},e._compId2Name=function(t){var e=i.js._getClassById(t);return i.js.getClassName(e)},e._genCompIdIfNeeded=function(){this._componentId||(this._componentName=this.component,this.component="")},L(t,[{key:"_componentName",get:function(){return this._genCompIdIfNeeded(),this._compId2Name(this._componentId)},set:function(t){this._componentId=this._compName2Id(t)}}]),t}(),SL=q((xL=bL).prototype,"target",[cl,pL,cl,dL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),TL=q(xL.prototype,"component",[cl,yl,mL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),AL=q(xL.prototype,"_componentId",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),EL=q(xL.prototype,"handler",[cl,yl,gL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),CL=q(xL.prototype,"customEventData",[cl,yl,vL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),yL=xL))||yL));i.Component.EventHandler=GB;var HB,VB,jB,WB,XB,qB,YB,KB,QB,ZB,JB,$B=new di,tF=Yt(qd),eF=Yt(Xd),nF=Yt(Yd),iF=Yt(Qd),rF=Yt(Kd),aF=Yt({SKYBOX:pm|na.DEPTH_STENCIL,SOLID_COLOR:na.ALL,DEPTH_ONLY:na.DEPTH_STENCIL,DONT_CLEAR:na.NONE}),oF=(PL=nl("cc.Camera"),IL=vl(),RL=pl(),DL=Il(),OL=Al(),ML=Bl(Np.BitMask),NL=Il(),LL=Al(),BL=Bl(aF),FL=Il(),zL=Al(),UL=Il(),kL=Al(),GL=Il(),HL=Al(),VL=Il(),jL=Al(),WL=Bl(tF),XL=Il(),qL=Al(),YL=Bl(eF),KL=Il(),QL=Al(),ZL=Il(),JL=Al(),$L=Il(),tB=Al(),eB=Il(),nB=Al(),iB=Il(),rB=Al(),aB=Bl(nF),oB=Il(),sB=Al(),cB=Bl(iF),lB=Il(),uB=Al(),hB=Bl(rF),fB=Il(),_B=Al(),pB=Il(),dB=Al(),mB=Bl(vT),gB=Il(),vB=Al(),HB=PL(yB=IL(yB=RL(yB=_l((kB=UB=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return X(e=t.call.apply(t,[this].concat(i))||this,"_projection",SB,V(e)),X(e,"_priority",TB,V(e)),X(e,"_fov",AB,V(e)),X(e,"_fovAxis",EB,V(e)),X(e,"_orthoHeight",CB,V(e)),X(e,"_near",bB,V(e)),X(e,"_far",wB,V(e)),X(e,"_color",PB,V(e)),X(e,"_depth",IB,V(e)),X(e,"_stencil",RB,V(e)),X(e,"_clearFlags",DB,V(e)),X(e,"_rect",OB,V(e)),X(e,"_aperture",MB,V(e)),X(e,"_shutter",NB,V(e)),X(e,"_iso",LB,V(e)),X(e,"_screenScale",BB,V(e)),X(e,"_visibility",FB,V(e)),X(e,"_targetTexture",zB,V(e)),e._camera=null,e._inEditorMode=!1,e._flows=void 0,e}F(e,t);var n=e.prototype;return n.onLoad=function(){this._createCamera()},n.onEnable=function(){this.node.hasChangedFlags|=Kg.POSITION,this._camera&&this._attachToScene()},n.onDisable=function(){this._camera&&this._detachFromScene()},n.onDestroy=function(){this._camera&&(this._camera.destroy(),this._camera=null),this._targetTexture&&this._targetTexture.off("resize")},n.screenPointToRay=function(t,e,n){return n||(n=ur.create()),this._camera&&this._camera.screenPointToRay(n,t,e),n},n.worldToScreen=function(t,e){return e||(e=new di),this._camera&&this._camera.worldToScreen(e,t),e},n.screenToWorld=function(t,e){return e||(e=this.node.getWorldPosition()),this._camera&&this._camera.screenToWorld(e,t),e},n.convertToUINode=function(t,e,n){if(n||(n=new di),!this._camera)return n;this.worldToScreen(t,$B);var r=e.getComponent("cc.UITransform"),a=eN.getVisibleSize(),o=$B.x-.5*this._camera.width,s=$B.y-.5*this._camera.height;return $B.x=o/i.view.getScaleX()+.5*a.width,$B.y=s/i.view.getScaleY()+.5*a.height,r&&r.convertToNodeSpaceAR($B,n),n},n._createCamera=function(){this._camera||(this._camera=i.director.root.createCamera(),this._camera.initialize({name:this.node.name,node:this.node,projection:this._projection,window:this._inEditorMode?i.director.root&&i.director.root.mainWindow:i.director.root&&i.director.root.tempWindow,priority:this._priority}),this._camera.setViewportInOrientedSpace(this._rect),this._camera.fovAxis=this._fovAxis,this._camera.fov=Zn(this._fov),this._camera.orthoHeight=this._orthoHeight,this._camera.nearClip=this._near,this._camera.farClip=this._far,this._camera.clearColor=this._color,this._camera.clearDepth=this._depth,this._camera.clearStencil=this._stencil,this._camera.clearFlag=this._clearFlags,this._camera.visibility=this._visibility,this._camera.aperture=this._aperture,this._camera.shutter=this._shutter,this._camera.iso=this._iso),this._updateTargetTexture()},n._attachToScene=function(){this.node.scene&&this._camera&&(this._camera&&this._camera.scene&&this._camera.scene.removeCamera(this._camera),this._getRenderScene().addCamera(this._camera))},n._detachFromScene=function(){this._camera&&this._camera.scene&&this._camera.scene.removeCamera(this._camera)},n._checkTargetTextureEvent=function(t){var e=this;t&&t.off("resize"),this._targetTexture&&this._targetTexture.on("resize",(function(t){e._camera&&e._camera.setFixedSize(t.width,t.height)}),this)},n._updateTargetTexture=function(){if(this._camera&&this._targetTexture){var t=this._targetTexture.window;this._camera.changeTargetWindow(t),this._camera.setFixedSize(t.width,t.height)}},L(e,[{key:"camera",get:function(){return this._camera}},{key:"priority",get:function(){return this._priority},set:function(t){this._priority=t,this._camera&&(this._camera.priority=t)}},{key:"visibility",get:function(){return this._visibility},set:function(t){this._visibility=t,this._camera&&(this._camera.visibility=t)}},{key:"clearFlags",get:function(){return this._clearFlags},set:function(t){this._clearFlags=t,this._camera&&(this._camera.clearFlag=t)}},{key:"clearColor",get:function(){return this._color},set:function(t){this._color.set(t),this._camera&&(this._camera.clearColor=this._color)}},{key:"clearDepth",get:function(){return this._depth},set:function(t){this._depth=t,this._camera&&(this._camera.clearDepth=t)}},{key:"clearStencil",get:function(){return this._stencil},set:function(t){this._stencil=t,this._camera&&(this._camera.clearStencil=t)}},{key:"projection",get:function(){return this._projection},set:function(t){this._projection=t,this._camera&&(this._camera.projectionType=t)}},{key:"fovAxis",get:function(){return this._fovAxis},set:function(t){t!==this._fovAxis&&(this._fovAxis=t,this._camera&&(this._camera.fovAxis=t,t===Xd.VERTICAL?this.fov=this._fov*this._camera.aspect:this.fov=this._fov/this._camera.aspect))}},{key:"fov",get:function(){return this._fov},set:function(t){this._fov=t,this._camera&&(this._camera.fov=Zn(t))}},{key:"orthoHeight",get:function(){return this._orthoHeight},set:function(t){this._orthoHeight=t,this._camera&&(this._camera.orthoHeight=t)}},{key:"near",get:function(){return this._near},set:function(t){this._near=t,this._camera&&(this._camera.nearClip=t)}},{key:"far",get:function(){return this._far},set:function(t){this._far=t,this._camera&&(this._camera.farClip=t)}},{key:"aperture",get:function(){return this._aperture},set:function(t){this._aperture=t,this._camera&&(this._camera.aperture=t)}},{key:"shutter",get:function(){return this._shutter},set:function(t){this._shutter=t,this._camera&&(this._camera.shutter=t)}},{key:"iso",get:function(){return this._iso},set:function(t){this._iso=t,this._camera&&(this._camera.iso=t)}},{key:"rect",get:function(){return this._rect},set:function(t){this._rect=t,this._camera&&this._camera.setViewportInOrientedSpace(t)}},{key:"targetTexture",get:function(){return this._targetTexture},set:function(t){if(this._targetTexture!==t){var n=this._targetTexture;this._targetTexture=t,this._checkTargetTextureEvent(n),this._updateTargetTexture(),!t&&this._camera&&(this._camera.changeTargetWindow(null),this._camera.isWindowSize=!0),this.node.emit(e.TARGET_TEXTURE_CHANGE,this)}}},{key:"screenScale",get:function(){return this._screenScale},set:function(t){this._screenScale=t,this._camera&&(this._camera.screenScale=t)}},{key:"inEditorMode",get:function(){return this._inEditorMode},set:function(t){this._inEditorMode=t,this._camera&&this._camera.changeTargetWindow(t?i.director.root&&i.director.root.mainWindow:i.director.root&&i.director.root.tempWindow)}}]),e}($u),UB.ProjectionType=tF,UB.FOVAxis=eF,UB.ClearFlag=aF,UB.Aperture=nF,UB.Shutter=iF,UB.ISO=rF,UB.TARGET_TEXTURE_CHANGE="tex-change",SB=q((xB=kB).prototype,"_projection",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return tF.PERSPECTIVE}}),TB=q(xB.prototype,"_priority",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),AB=q(xB.prototype,"_fov",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 45}}),EB=q(xB.prototype,"_fovAxis",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return eF.VERTICAL}}),CB=q(xB.prototype,"_orthoHeight",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),bB=q(xB.prototype,"_near",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),wB=q(xB.prototype,"_far",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e3}}),PB=q(xB.prototype,"_color",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new _i("#333333")}}),IB=q(xB.prototype,"_depth",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),RB=q(xB.prototype,"_stencil",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),DB=q(xB.prototype,"_clearFlags",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return aF.SOLID_COLOR}}),OB=q(xB.prototype,"_rect",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Vi(0,0,1,1)}}),MB=q(xB.prototype,"_aperture",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return nF.F16_0}}),NB=q(xB.prototype,"_shutter",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return iF.D125}}),LB=q(xB.prototype,"_iso",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return rF.ISO100}}),BB=q(xB.prototype,"_screenScale",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),FB=q(xB.prototype,"_visibility",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Zd}}),zB=q(xB.prototype,"_targetTexture",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q(xB.prototype,"priority",[DL,OL],Object.getOwnPropertyDescriptor(xB.prototype,"priority"),xB.prototype),q(xB.prototype,"visibility",[ML,NL,LL],Object.getOwnPropertyDescriptor(xB.prototype,"visibility"),xB.prototype),q(xB.prototype,"clearFlags",[BL,FL,zL],Object.getOwnPropertyDescriptor(xB.prototype,"clearFlags"),xB.prototype),q(xB.prototype,"clearColor",[UL,kL],Object.getOwnPropertyDescriptor(xB.prototype,"clearColor"),xB.prototype),q(xB.prototype,"clearDepth",[GL,HL],Object.getOwnPropertyDescriptor(xB.prototype,"clearDepth"),xB.prototype),q(xB.prototype,"clearStencil",[VL,jL],Object.getOwnPropertyDescriptor(xB.prototype,"clearStencil"),xB.prototype),q(xB.prototype,"projection",[WL,XL,qL],Object.getOwnPropertyDescriptor(xB.prototype,"projection"),xB.prototype),q(xB.prototype,"fovAxis",[YL,KL,QL],Object.getOwnPropertyDescriptor(xB.prototype,"fovAxis"),xB.prototype),q(xB.prototype,"fov",[ZL,JL],Object.getOwnPropertyDescriptor(xB.prototype,"fov"),xB.prototype),q(xB.prototype,"orthoHeight",[$L,tB],Object.getOwnPropertyDescriptor(xB.prototype,"orthoHeight"),xB.prototype),q(xB.prototype,"near",[eB,nB],Object.getOwnPropertyDescriptor(xB.prototype,"near"),xB.prototype),q(xB.prototype,"far",[iB,rB],Object.getOwnPropertyDescriptor(xB.prototype,"far"),xB.prototype),q(xB.prototype,"aperture",[aB,oB,sB],Object.getOwnPropertyDescriptor(xB.prototype,"aperture"),xB.prototype),q(xB.prototype,"shutter",[cB,lB,uB],Object.getOwnPropertyDescriptor(xB.prototype,"shutter"),xB.prototype),q(xB.prototype,"iso",[hB,fB,_B],Object.getOwnPropertyDescriptor(xB.prototype,"iso"),xB.prototype),q(xB.prototype,"rect",[pB,dB],Object.getOwnPropertyDescriptor(xB.prototype,"rect"),xB.prototype),q(xB.prototype,"targetTexture",[mB,gB,vB],Object.getOwnPropertyDescriptor(xB.prototype,"targetTexture"),xB.prototype),yB=xB))||yB)||yB)||yB)||yB,t({Camera:HB,CameraComponent:HB}),HB);i.Camera=oF;var sF,cF,lF,uF,hF,fF,_F,pF,dF={parent:null,owner:null,subModelIdx:0},mF=t("RenderableComponent",(VB=nl("cc.RenderableComponent"),jB=Bl([bv]),WB=Bl(bv),XB=Il(),qB=Tl(),VB((JB=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return X(e=t.call.apply(t,[this].concat(i))||this,"_materials",QB,V(e)),X(e,"_visFlags",ZB,V(e)),e._materialInstances=[],e._models=[],e}F(e,t);var n=e.prototype;return n.getMaterial=function(t){return t<0||t>=this._materials.length?null:this._materials[t]},n.setMaterial=function(t,e){t&&t instanceof Hv&&console.error("Can't set a material instance to a sharedMaterial slot"),this._materials[e]=t;var n=this._materialInstances[e];n&&(n.destroy(),this._materialInstances[e]=null),this._onMaterialModified(e,this._materials[e])},n.getMaterialInstance=function(t){if(!this._materials[t])return null;if(!this._materialInstances[t]){dF.parent=this._materials[t],dF.owner=this,dF.subModelIdx=t;var e=new Hv(dF);dF.parent=null,dF.owner=null,dF.subModelIdx=0,this.setMaterialInstance(e,t)}return this._materialInstances[t]},n.setMaterialInstance=function(t,e){if("number"==typeof t){E(12007);var n=t;t=e,e=n}var i=this._materialInstances[e];t&&t.parent?t!==i&&(this._materialInstances[e]=t,this._onMaterialModified(e,t)):(t!==this._materials[e]||i)&&this.setMaterial(t,e)},n.getRenderMaterial=function(t){return this._materialInstances[t]||this._materials[t]},n._collectModels=function(){return this._models},n._attachToScene=function(){},n._detachFromScene=function(){},n._onMaterialModified=function(){},n._onRebuildPSO=function(){},n._clearMaterials=function(){},n._onVisibilityChange=function(){},L(e,[{key:"visibility",get:function(){return this._visFlags},set:function(t){this._visFlags=t,this._onVisibilityChange(t)}},{key:"sharedMaterials",get:function(){return this._materials},set:function(t){for(var e=0;e<t.length;e++)t[e]!==this._materials[e]&&this.setMaterial(t[e],e);if(t.length<this._materials.length){for(var n=t.length;n<this._materials.length;n++)this.setMaterial(null,n);this._materials.splice(t.length)}}},{key:"materials",get:function(){for(var t=0;t<this._materials.length;t++)this._materialInstances[t]=this.getMaterialInstance(t);return this._materialInstances},set:function(t){var e=t.length-this._materials.length;if(e>0)this._materials.length=t.length,this._materialInstances.length=t.length;else if(e<0)for(var n=this._materials.length-e;n<this._materials.length;++n)this.setMaterialInstance(null,n);for(var i=0;i<this._materialInstances.length;i++)this._materialInstances[i]!=t[i]&&this.setMaterialInstance(t[i],i)}},{key:"sharedMaterial",get:function(){return this.getMaterial(0)}},{key:"material",get:function(){return this.getMaterialInstance(0)},set:function(t){(1!==this._materials.length||this._materialInstances[0]||this._materials[0]!==t)&&this.setMaterialInstance(t,0)}}]),e}($u),QB=q((KB=JB).prototype,"_materials",[jB],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ZB=q(KB.prototype,"_visFlags",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Np.Enum.NONE}}),q(KB.prototype,"sharedMaterials",[WB,XB,qB],Object.getOwnPropertyDescriptor(KB.prototype,"sharedMaterials"),KB.prototype),YB=KB))||YB));function gF(t){return"string"==typeof t||"number"==typeof t}i.RenderableComponent=mF,Nn(oF,"Camera",[{name:"CameraClearFlag",newName:"ClearFlag"}]),Nn(oF.prototype,"Camera.prototype",[{name:"color",newName:"clearColor"},{name:"depth",newName:"clearDepth"},{name:"stencil",newName:"clearStencil"}]),i.CameraComponent=oF,Gt.setClassAlias(oF,"cc.CameraComponent");var vF,yF,xF,SF,TF,AF,EF,CF,bF,wF,PF,IF,RF,DF,OF,MF,NF,LF,BF,FF,zF,UF,kF=nl("cc.animation.HierarchyPath")((uF=function(){function t(t){X(this,"path",lF,this),this.path=t||""}return t.prototype.get=function(t){return t instanceof qC?t.getChildByPath(this.path)||(E(3926,t.name,this.path),null):(E(3925),null)},t}(),lF=q((cF=uF).prototype,"path",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),sF=cF))||sF,GF=nl("cc.animation.ComponentPath")((pF=function(){function t(t){X(this,"component",_F,this),this.component=t||""}return t.prototype.get=function(t){return t instanceof qC?t.getComponent(this.component)||(E(3928,t.name,this.component),null):(E(3927),null)},t}(),_F=q((fF=pF).prototype,"component",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),hF=fF))||hF,HF=nl("cc.animation.UniformProxyFactory")((AF=function(){function t(t,e){X(this,"passIndex",xF,this),X(this,"uniformName",SF,this),X(this,"channelIndex",TF,this),this.passIndex=e||0,this.uniformName=t||""}return t.prototype.forTarget=function(t){var e=t.passes[this.passIndex],n=e.getHandle(this.uniformName);if(!n)throw new Error('Material "'+t.name+'" has no uniform "'+this.uniformName+'"');if(Hg.getTypeFromHandle(n)<Ar.SAMPLER1D){var r=void 0===this.channelIndex?n:e.getHandle(this.uniformName,this.channelIndex,Ar.FLOAT);if(!r)throw new Error('Uniform "'+this.uniformName+" (in material "+t.name+") has no channel "+this.channelIndex+'"');return function(t,e){for(var n,i=W(t.shaderInfo.blocks);!(n=i()).done;)for(var r,a=W(n.value.members);!(r=a()).done;){var o=r.value;if(o.name===e)return o.count>1}return!1}(e,this.uniformName)?{set:function(t){e.setUniformArray(r,t)}}:{set:function(t){e.setUniform(r,t)}}}var a=Hg.getBindingFromHandle(n),o=e.properties[this.uniformName],s=o&&o.value?o.value+"-texture":xg(o.type),c=Lg.get(s);return c||(p("Illegal texture default value: "+s+"."),c=Lg.get("default-texture")),{set:function(t){t||(t=c);var n=t.getGFXTexture();n&&n.width&&n.height&&(e.bindTexture(a,n),t instanceof Mm&&e.bindSampler(a,i.game._gfxDevice.getSampler(t.getSamplerInfo())))}}},t}(),xF=q((yF=AF).prototype,"passIndex",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),SF=q(yF.prototype,"uniformName",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),TF=q(yF.prototype,"channelIndex",[Ml],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),vF=yF))||vF,VF=nl("cc.animation.MorphWeightValueProxy")((PF=function(){function t(){X(this,"subMeshIndex",bF,this),X(this,"shapeIndex",wF,this)}return t.prototype.forTarget=function(t){var e=this;return{set:function(n){t.setWeight(n,e.subMeshIndex,e.shapeIndex)}}},t}(),bF=q((CF=PF).prototype,"subMeshIndex",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),wF=q(CF.prototype,"shapeIndex",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),EF=CF))||EF,jF=nl("cc.animation.MorphWeightsValueProxy")((OF=function(){function t(){X(this,"subMeshIndex",DF,this)}return t.prototype.forTarget=function(t){var e=this;return{set:function(n){t.setWeights(n,e.subMeshIndex)}}},t}(),DF=q((RF=OF).prototype,"subMeshIndex",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),IF=RF))||IF,WF=nl("cc.animation.MorphWeightsAllValueProxy")(MF=function(){function t(){}return t.prototype.forTarget=function(t){return{set:function(e){for(var n,i,r=null!==(n=null===(i=t.mesh)||void 0===i?void 0:i.struct.primitives.length)&&void 0!==n?n:0,a=0;a<r;++a)t.setWeights(e,a)}}},t}())||MF;function XF(t,e,n,i){var r,a,o,s,c,l,u=new e,h=new e,f=new e,_=nl(t)((l=function(){function t(t,n,i){X(this,"dataPoint",o,this),X(this,"inTangent",s,this),X(this,"outTangent",c,this),this.dataPoint=t||new e,this.inTangent=n||new e,this.outTangent=i||new e}var r=t.prototype;return r.lerp=function(t,e,r){var a=this.dataPoint,o=t.dataPoint;h=n(h,this.inTangent,r),f=n(f,t.outTangent,r);var s=e*e*e,c=e*e,l=s-2*c+e,_=-2*s+3*c,p=s-c;return u=n(u,a,2*s-3*c+1),u=i(u,u,h,l),u=i(u,u,o,_),u=i(u,u,f,p)},r.getNoLerp=function(){return this.dataPoint},t}(),o=q((a=l).prototype,"dataPoint",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new e}}),s=q(a.prototype,"inTangent",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new e}}),c=q(a.prototype,"outTangent",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new e}}),r=a))||r;if(e===Ti){var p=_.prototype.lerp;_.prototype.lerp=function(t,e,n){var i=p.call(this,t,e,n);return Ti.normalize(i,i),i}}return _}var qF=t("CubicSplineVec2Value",XF("cc.CubicSplineVec2Value",Ni,Ni.multiplyScalar,Ni.scaleAndAdd));i.CubicSplineVec2Value=qF;var YF=t("CubicSplineVec3Value",XF("cc.CubicSplineVec3Value",di,di.multiplyScalar,di.scaleAndAdd));i.CubicSplineVec3Value=YF;var KF=t("CubicSplineVec4Value",XF("cc.CubicSplineVec4Value",zi,zi.multiplyScalar,zi.scaleAndAdd));i.CubicSplineVec4Value=KF;var QF=t("CubicSplineQuatValue",XF("cc.CubicSplineQuatValue",Ti,Ti.multiplyScalar,Ti.scaleAndAdd));i.CubicSplineQuatValue=QF;var ZF=t("CubicSplineNumberValue",nl("cc.CubicSplineNumberValue")((UF=function(){function t(t,e,n){X(this,"dataPoint",BF,this),X(this,"inTangent",FF,this),X(this,"outTangent",zF,this),this.dataPoint=t,this.inTangent=e,this.outTangent=n}var e=t.prototype;return e.lerp=function(t,e,n){var i=this.dataPoint,r=t.dataPoint,a=e*e*e,o=e*e;return i*(2*a-3*o+1)+this.outTangent*n*(a-2*o+e)+r*(-2*a+3*o)+t.inTangent*n*(a-o)},e.getNoLerp=function(){return this.dataPoint},t}(),BF=q((LF=UF).prototype,"dataPoint",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),FF=q(LF.prototype,"inTangent",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),zF=q(LF.prototype,"outTangent",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),NF=LF))||NF);i.CubicSplineNumberValue=ZF;var JF,$F,tz,ez,nz,iz,rz,az,oz,sz,cz,lz,uz,hz,fz,_z,pz,dz,mz,gz,vz,yz,xz,Sz,Tz,Az,Ez,Cz=Symbol("CreateEval"),bz=Symbol("NormalizedFollow"),wz=Symbol("ConvertAsTrsPath"),Pz=Symbol("TrackBinding"),Iz=nl("cc.animation.TrackPath")((ez=function(){function t(){X(this,"_paths",tz,this)}var e=t.prototype;return e.toProperty=function(t){return this._paths.push(t),this},e.toElement=function(t){return this._paths.push(t),this},e.toHierarchy=function(t){return this._paths.push(new kF(t)),this},e.toComponent=function(t){var e=new GF("string"==typeof t?t:Gt.getClassName(t));return this._paths.push(e),this},e.toCustomized=function(t){return this._paths.push(t),this},e.append=function(){for(var t,e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var r=(t=this._paths).concat.apply(t,n.map((function(t){return t._paths})));return this._paths=r,this},e.isPropertyAt=function(t){return"string"==typeof this._paths[t]},e.parsePropertyAt=function(t){return this._paths[t]},e.isElementAt=function(t){return"number"==typeof this._paths[t]},e.parseElementAt=function(t){return this._paths[t]},e.isHierarchyAt=function(t){return this._paths[t]instanceof kF},e.parseHierarchyAt=function(t){return this.isHierarchyAt(t),this._paths[t].path},e.isComponentAt=function(t){return this._paths[t]instanceof GF},e.parseComponentAt=function(t){return this.isComponentAt(t),this._paths[t].component},e.slice=function(e,n){var i=new t;return i._paths=this._paths.slice(e,n),i},e.trace=function(t,e,n){var i,r;return null!==(i=e)&&void 0!==i||(e=0),null!==(r=n)&&void 0!==r||(n=this._paths.length),this[bz](t,e,n)},e[wz]=function(){for(var t,e=this._paths,n=e.length,i=0,r="";i<n;++i){var a=e[i];if(!(a instanceof kF))break;a.path&&(r?r+="/"+a.path:r=a.path)}if(i===n)return null;if(i!==n-1)return null;switch(e[i]){case"position":case"scale":case"rotation":case"eulerAngles":t=e[i];break;default:return null}return{node:r,property:t}},e[bz]=function(t,e,n){for(var i=this._paths,r=t,a=e;a<n;++a){var o=i[a];if(gF(o)){if(!(o in r))return E(3929,o),null;r=r[o]}else r=o.get(r);if(null===r)break}return r},L(t,[{key:"length",get:function(){return this._paths.length}}]),t}(),tz=q(($F=ez).prototype,"_paths",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),JF=$F))||JF,Rz=nl("cc.animation.TrackBinding")(nz=fl((oz=function(){function t(){X(this,"path",rz,this),X(this,"proxy",az,this)}var e=t.prototype;return e.parseTrsPath=function(){return this.proxy?null:this.path[wz]()},e.createRuntimeBinding=function(t,e,n){var i=this.path,r=this.proxy,a=i.length,o=a-1;if(0===a||!i.isPropertyAt(o)&&!i.isElementAt(o)||r){if(r){var s=i[bz](t,0,a);if(null===s)return null;var c=r.forTarget(s),l={setValue:function(t){c.set(t)}},u=c.get;return u&&(l.getValue=function(){return u.call(c)}),l}return b(3921),null}var h=i.isPropertyAt(o)?i.parsePropertyAt(o):i.parseElementAt(o),f=i[bz](t,0,a-1);return null===f?null:e&&f instanceof qC&&function(t){return"position"===t||"rotation"===t||"scale"===t||"eulerAngles"===t}(h)?e.createPoseWriter(f,h,n):{setValue:function(t){f[h]=t},getValue:function(){return f[h]}}},t}(),rz=q((iz=oz).prototype,"path",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Iz}}),az=q(iz.prototype,"proxy",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nz=iz))||nz)||nz,Dz=nl("cc.animation.Track")((uz=function(){function t(){X(this,"_binding",lz,this)}var e=t.prototype;return e.channels=function(){return[]},e.range=function(){for(var t,e={min:1/0,max:-1/0},n=W(this.channels());!(t=n()).done;){var i=t.value;e.min=Math.min(e.min,i.curve.rangeMin),e.max=Math.max(e.max,i.curve.rangeMax)}return e},L(t,[{key:"path",get:function(){return this._binding.path},set:function(t){this._binding.path=t}},{key:"proxy",get:function(){return this._binding.proxy},set:function(t){this._binding.proxy=t}},{key:Pz,get:function(){return this._binding}}]),t}(),lz=q((cz=uz).prototype,"_binding",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Rz}}),sz=cz))||sz,Oz=nl("cc.animation.Channel")((pz=function(){function t(t){this.name="",X(this,"_curve",_z,this),this._curve=t}return L(t,[{key:"curve",get:function(){return this._curve}}]),t}(),_z=q((fz=pz).prototype,"_curve",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hz=fz))||hz,Mz=nl("cc.animation.SingleChannelTrack")((vz=function(t){function e(){var e;return X(e=t.call(this)||this,"_channel",gz,V(e)),e._channel=new Oz(e.createCurve()),e}F(e,t);var n=e.prototype;return n.channels=function(){return[this._channel]},n.createCurve=function(){throw new Error("Not impl")},n[Cz]=function(){var t=this._channel.curve;return new Nz(t)},L(e,[{key:"channel",get:function(){return this._channel}}]),e}(Dz),gz=q((mz=vz).prototype,"_channel",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dz=mz))||dz,Nz=function(){function t(t){this._curve=t}return t.prototype.evaluate=function(t){return this._curve.evaluate(t)},t}(),Lz=nl("cc.animation.RealTrack")(yz=function(t){function e(){return t.apply(this,arguments)||this}return F(e,t),e.prototype.createCurve=function(){return new d_},e}(Mz))||yz;function Bz(t){return 0===t.keyFramesCount?void 0:t}var Fz,zz,Uz,kz,Gz,Hz,Vz,jz,Wz,Xz,qz=["X","Y","Z","W"],Yz=nl("cc.animation.VectorTrack")((Ez=function(t){function e(){var e;X(e=t.call(this)||this,"_channels",Tz,V(e)),X(e,"_nComponents",Az,V(e)),e._channels=new Array(4);for(var n=0;n<e._channels.length;++n){var i=new Oz(new d_);i.name=qz[n],e._channels[n]=i}return e}F(e,t);var n=e.prototype;return n.channels=function(){return this._channels},n[Cz]=function(){switch(this._nComponents){default:case 2:return new Kz(Bz(this._channels[0].curve),Bz(this._channels[1].curve));case 3:return new Qz(Bz(this._channels[0].curve),Bz(this._channels[1].curve),Bz(this._channels[2].curve));case 4:return new Zz(Bz(this._channels[0].curve),Bz(this._channels[1].curve),Bz(this._channels[2].curve),Bz(this._channels[3].curve))}},L(e,[{key:"componentsCount",get:function(){return this._nComponents},set:function(t){this._nComponents=t}}]),e}(Dz),Tz=q((Sz=Ez).prototype,"_channels",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Az=q(Sz.prototype,"_nComponents",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 4}}),xz=Sz))||xz,Kz=function(){function t(t,e){this._result=new Ni,this._x=t,this._y=e}return t.prototype.evaluate=function(t,e){return this._x&&this._y||!e.getValue||Ni.copy(this._result,e.getValue()),this._x&&(this._result.x=this._x.evaluate(t)),this._y&&(this._result.y=this._y.evaluate(t)),this._result},t}(),Qz=function(){function t(t,e,n){this._result=new di,this._x=t,this._y=e,this._z=n}return t.prototype.evaluate=function(t,e){return this._x&&this._y&&this._z||!e.getValue||di.copy(this._result,e.getValue()),this._x&&(this._result.x=this._x.evaluate(t)),this._y&&(this._result.y=this._y.evaluate(t)),this._z&&(this._result.z=this._z.evaluate(t)),this._result},t}(),Zz=function(){function t(t,e,n,i){this._result=new zi,this._x=t,this._y=e,this._z=n,this._w=i}return t.prototype.evaluate=function(t,e){return this._x&&this._y&&this._z&&this._w||!e.getValue||zi.copy(this._result,e.getValue()),this._x&&(this._result.x=this._x.evaluate(t)),this._y&&(this._result.y=this._y.evaluate(t)),this._z&&(this._result.z=this._z.evaluate(t)),this._w&&(this._result.w=this._w.evaluate(t)),this._result},t}(),Jz=nl("cc.animation.QuatTrack")(Fz=function(t){function e(){return t.apply(this,arguments)||this}F(e,t);var n=e.prototype;return n.createCurve=function(){return new ep},n[Cz]=function(){return new $z(this.channels()[0].curve)},e}(Mz))||Fz,$z=function(){function t(t){this._result=new Ti,this._curve=t}return t.prototype.evaluate=function(t){return this._curve.evaluate(t,this._result),this._result},t}(),tU=["Red","Green","Blue","Alpha"],eU=nl("cc.animation.ColorTrack")((Gz=function(t){function e(){var e;X(e=t.call(this)||this,"_channels",kz,V(e)),e._channels=new Array(4);for(var n=0;n<e._channels.length;++n){var i=new Oz(new d_);i.name=tU[n],e._channels[n]=i}return e}F(e,t);var n=e.prototype;return n.channels=function(){return this._channels},n[Cz]=function(){return new nU(Bz(this._channels[0].curve),Bz(this._channels[1].curve),Bz(this._channels[2].curve),Bz(this._channels[3].curve))},e}(Dz),kz=q((Uz=Gz).prototype,"_channels",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zz=Uz))||zz,nU=function(){function t(t,e,n,i){this._result=new _i,this._x=t,this._y=e,this._z=n,this._w=i}return t.prototype.evaluate=function(t,e){return this._x&&this._y&&this._z&&this._w||!e.getValue||_i.copy(this._result,e.getValue()),this._x&&(this._result.r=this._x.evaluate(t)),this._y&&(this._result.g=this._y.evaluate(t)),this._z&&(this._result.b=this._z.evaluate(t)),this._w&&(this._result.a=this._w.evaluate(t)),this._result},t}(),iU=["Width","Height"],rU=nl("cc.animation.SizeTrack")((Wz=function(t){function e(){var e;X(e=t.call(this)||this,"_channels",jz,V(e)),e._channels=new Array(2);for(var n=0;n<e._channels.length;++n){var i=new Oz(new d_);i.name=iU[n],e._channels[n]=i}return e}F(e,t);var n=e.prototype;return n.channels=function(){return this._channels},n[Cz]=function(){return new aU(Bz(this._channels[0].curve),Bz(this._channels[1].curve))},e}(Dz),jz=q((Vz=Wz).prototype,"_channels",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hz=Vz))||Hz,aU=function(){function t(t,e){this._result=new Gi,this._width=t,this._height=e}return t.prototype.evaluate=function(t,e){if((!this._width||!this._height)&&e.getValue){var n=e.getValue();this._result.x=n.x,this._result.y=n.y}return this._width&&(this._result.width=this._width.evaluate(t)),this._height&&(this._result.height=this._height.evaluate(t)),this._result},t}(),oU=nl("cc.animation.ObjectTrack")(Xz=function(t){function e(){return t.apply(this,arguments)||this}return F(e,t),e.prototype.createCurve=function(){return new mp},e}(Mz))||Xz;t("animation",Object.freeze({__proto__:null,UniformProxyFactory:HF,MorphWeightValueProxy:VF,MorphWeightsValueProxy:jF,MorphWeightsAllValueProxy:WF,Track:Dz,TrackPath:Iz,RealTrack:Lz,VectorTrack:Yz,QuatTrack:Jz,ColorTrack:eU,SizeTrack:rU,ObjectTrack:oU,isPropertyPath:gF,isCustomPath:function(t,e){return t instanceof e},HierarchyPath:kF,ComponentPath:GF,CubicSplineVec2Value:qF,CubicSplineVec3Value:YF,CubicSplineVec4Value:KF,CubicSplineQuatValue:QF,CubicSplineNumberValue:ZF}));var sU=Symbol("BakeNodeCurves"),cU=function(){function t(){}return t.getOrExtract=function(e){var n=t.pool.get(e);if(!n||n.samples!==e.sample){n&&i.director.root.dataPoolManager.releaseAnimationClip(e);var r=Math.ceil(e.sample*e.duration)+1,a=e.sample;n=e[sU](0,a,r),t.pool.set(e,n)}return n},t.destroy=function(e){t.pool.delete(e)},t}();cU.pool=new Map;var lU=t("RatioSampler",function(){function t(t){var e,n;this.ratios=void 0,this._findRatio=void 0,this.ratios=t;for(var i=!0,r=1,a=t.length;r<a;r++)if(e=t[r]-t[r-1],1===r)n=e;else if(Math.abs(e-n)>1e-6){i=!1;break}this._findRatio=i?_U:qc}return t.prototype.sample=function(t){return this._findRatio(this.ratios,t)},t}());i.RatioSampler=lU;var uU=t("AnimCurve",function(){function t(e,n){this.types=void 0,this.type=null,this._values=[],this._lerp=void 0,this._duration=void 0,this._array=void 0,this._duration=n,this._values=e.values;var i=function(e){return"string"==typeof e?e:Array.isArray(e)?e[0]===e[1]&&e[2]===e[3]?t.Linear:t.Bezier(e):t.Linear};if(void 0!==e.easingMethod)this.type=i(e.easingMethod);else if(Array.isArray(e.easingMethods))this.types=e.easingMethods.map(i);else if(void 0!==e.easingMethods){this.types=new Array(this._values.length).fill(null);for(var r=0,a=Object.keys(e.easingMethods);r<a.length;r++){var o=a[r];this.types[o]=i(e.easingMethods[o])}}else this.type=null;var s=e.values[0];(void 0===e.interpolate||e.interpolate)&&(this._lerp=TU(s)),void 0!==e._arrayLength&&(this._array=new Array(e._arrayLength))}t.Bezier=function(t){return t};var e=t.prototype;return e.hasLerp=function(){return!!this._lerp},e.valueAt=function(t){if(void 0===this._array){var e=this._values[t];return e&&e.getNoLerp?e.getNoLerp():e}for(var n=0;n<this._array.length;++n)this._array[n]=this._values[this._array.length*t+n];return this._array},e.valueBetween=function(t,e,n,i,r){if(this._lerp){var a=this.types?this.types[e]:this.type,o=r-n,s=(t-n)/o;if(a&&(s=fU(s,a)),void 0===this._array){var c=this._values[e],l=this._values[i];return this._lerp(c,l,s,o*this._duration)}for(var u=0;u<this._array.length;++u){var h=this._values[this._array.length*e+u],f=this._values[this._array.length*i+u];this._array[u]=this._lerp(h,f,s,o*this._duration)}return this._array}if(void 0===this._array)return this.valueAt(e);for(var _=0;_<this._array.length;++_)this._array[_]=this._values[this._array.length*e+_];return this._array},e.empty=function(){return 0===this._values.length},e.constant=function(){return 1===this._values.length},t}());function hU(t,e,n){var i=e.sample(n);if(i<0)if((i=~i)<=0)i=0;else{if(!(i>=e.ratios.length))return t.valueBetween(n,i-1,e.ratios[i-1],i,e.ratios[i]);i=e.ratios.length-1}return t.valueAt(i)}function fU(t,e){if("string"==typeof e){var n=e_[e];n?t=n(t):b(3906,e)}else Array.isArray(e)&&(t=Z_(e,t));return t}function _U(t,e){var n=t.length-1;if(0===n)return 0;var i=t[0];if(e<i)return 0;var r=t[n];if(e>r)return n;var a=(e=(e-i)/(r-i))/(1/n),o=0|a,s=1e-6;return a-o<s?o:o+1-a<s?o+1:~(o+1)}uU.Linear=null,i.AnimCurve=uU,t("EventInfo",function(){function t(){this.events=[]}return t.prototype.add=function(t,e){this.events.push({func:t||"",params:e||[]})},t}()),i.sampleAnimationCurve=hU;var pU,dU,mU,gU,vU,yU,xU,SU,TU=function(){function t(t,e,n,i){return t.lerp(e,n,i)}return function(e){if(null!==e){if("number"==typeof e)return Qn;if("object"==typeof e&&e.constructor){if(e instanceof Ti)return n=new Ti,function(t,e,i){return Ti.slerp(n,t,e,i)};if(e instanceof Jt)return function(t){var e=new t;return function(n,i,r){return t.lerp(e,n,i,r),e}}(e.constructor);if(e.constructor===Number)return Qn;if("function"==typeof e.lerp)return t}var n}}}(),AU=nl("cc.animation.UntypedTrackChannel")((gU=function(t){function e(){var e;return X(e=t.call(this,new d_)||this,"property",mU,V(e)),e}return F(e,t),e}(Oz),mU=q((dU=gU).prototype,"property",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),pU=dU))||pU,EU=nl("cc.animation.UntypedTrack")((SU=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return X(e=t.call.apply(t,[this].concat(i))||this,"_channels",xU,V(e)),e}F(e,t);var n=e.prototype;return n.channels=function(){return this._channels},n[Cz]=function(t){var e=this;if(!t.getValue)throw new Error(R(3930));var n=function(t){var n;return null===(n=e._channels.find((function(e){return e.property===t})))||void 0===n?void 0:n.curve},i=t.getValue();switch(!0){default:throw new Error(R(3931));case i instanceof Ni:return new Kz(n("x"),n("y"));case i instanceof di:return new Qz(n("x"),n("y"),n("z"));case i instanceof zi:return new Zz(n("x"),n("y"),n("z"),n("w"));case i instanceof _i:return new nU(n("r"),n("g"),n("b"),n("a"));case i instanceof Gi:return new aU(n("width"),n("height"))}},n.addChannel=function(t){var e=new AU;return e.property=t,this._channels.push(e),e},n.upgrade=function(t){var e=this,n=function(t,n){var i=e.channels().find((function(e){return e.property===t}));i&&(n.name=i.name,n.curve.assignSorted(Array.from(i.curve.times()),Array.from(i.curve.values())))},i=t(this.path,this.proxy);switch(i){default:break;case"vec2":case"vec3":case"vec4":var r=new Yz;r.path=this.path,r.proxy=this.proxy,r.componentsCount="vec2"===i?2:"vec3"===i?3:4;var a=r.channels(),o=a[0],s=a[1],c=a[2],l=a[3];switch(i){case"vec4":n("w",l);case"vec3":n("z",c);default:case"vec2":n("x",o),n("y",s)}return r;case"color":var u=new eU,h=u.channels(),f=h[0],_=h[1],p=h[2],d=h[3];return n("r",f),n("g",_),n("b",p),n("a",d),n("x",f),n("y",_),n("z",p),n("w",d),u;case"size":}return null},e}(Dz),xU=q((yU=SU).prototype,"_channels",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),vU=yU))||vU,CU=function(){function t(t){this._keys=[],this._curves=[],this._commonTargets=[],this._ratioSamplers=[],this._runtimeCurves=void 0,this._data=null,this._duration=void 0,this._duration=t}var e=t.prototype;return e.getPropertyCurves=function(){return this._runtimeCurves||this._createPropertyCurves(),this._runtimeCurves},e.toTracks=function(){for(var t,e=[],n=this.keys,i=this.curves,r=this.commonTargets,a=function(t,e,n){for(var i,r=new Iz,a=W(e);!(i=a()).done;){var o=i.value;"string"==typeof o?r.toProperty(o):"number"==typeof o?r.toElement(o):o instanceof kF?r.toHierarchy(o.path):o instanceof GF?r.toComponent(o.component):r.toCustomized(o)}t.path=r,t.proxy=n},o=r.map((function(t){var n=new EU;return a(n,t.modifiers,t.valueAdapter),e.push(n),n})),s=function(){var i,r=t.value,s=r.data,c=s.values;if(0===c.length)return"continue";var l=s.keys<0?[0]:n[s.keys],u=c[0],h=null===(i=s.interpolate)||void 0===i||i;s._arrayLength;var f=new wU(s,l.length),_=function(t){a(t,r.modifiers,r.valueAdapter)},p=void 0;if("number"==typeof r.commonTarget){if(!c.every((function(t){return"number"==typeof t})))return E(3932),"continue";if(r.valueAdapter||1!==r.modifiers.length||"string"!=typeof r.modifiers[0])return E(3933),"continue";var d=r.modifiers[0],m=o[r.commonTarget].addChannel(d).curve;p=m}!function(){if("number"==typeof u){if(!c.every((function(t){return"number"==typeof t})))return void E(3934);var t;if(p)t=p;else{var n=new Lz;_(n),e.push(n),t=n.channel.curve}var i=h?Vl.LINEAR:Vl.CONSTANT;return t.assignSorted(l,c.map((function(t){return{value:t,interpolationMode:i}}))),void f.convert(t)}if("object"==typeof u)switch(!0){default:break;case bU(c,Ni):case bU(c,di):case bU(c,zi):var r=u instanceof Ni?2:u instanceof di?3:4,a=new Yz;_(a),a.componentsCount=r;var o=a.channels(),s=o[0].curve,d=o[1].curve,m=o[2].curve,g=o[3].curve,v=h?Vl.LINEAR:Vl.CONSTANT,y=function(t){return{value:t,interpolationMode:v}};switch(r){case 4:g.assignSorted(l,c.map((function(t){return y(t.w)}))),f.convert(g);case 3:m.assignSorted(l,c.map((function(t){return y(t.z)}))),f.convert(m);default:s.assignSorted(l,c.map((function(t){return y(t.x)}))),f.convert(s),d.assignSorted(l,c.map((function(t){return y(t.y)}))),f.convert(d)}return void e.push(a);case bU(c,Ti):var x=new Jz;_(x);var S=h?j_.SLERP:j_.CONSTANT;return x.channel.curve.assignSorted(l,c.map((function(t){return{value:Ti.clone(t),interpolationMode:S}}))),f.convertQuatCurve(x.channel.curve),void e.push(x);case bU(c,_i):var T=new eU;_(T);var A=T.channels(),C=A[0].curve,b=A[1].curve,w=A[2].curve,P=A[3].curve,I=h?Vl.LINEAR:Vl.CONSTANT,R=function(t){return{value:t,interpolationMode:I}};return C.assignSorted(l,c.map((function(t){return R(t.r)}))),f.convert(C),b.assignSorted(l,c.map((function(t){return R(t.g)}))),f.convert(b),w.assignSorted(l,c.map((function(t){return R(t.b)}))),f.convert(w),P.assignSorted(l,c.map((function(t){return R(t.a)}))),f.convert(P),void e.push(T);case bU(c,Gi):var D=new rU;_(D);var O=D.channels(),M=O[0].curve,N=O[1].curve,L=h?Vl.LINEAR:Vl.CONSTANT,B=function(t){return{value:t,interpolationMode:L}};return M.assignSorted(l,c.map((function(t){return B(t.width)}))),f.convert(M),N.assignSorted(l,c.map((function(t){return B(t.height)}))),f.convert(N),void e.push(D);case bU(c,ZF):var F=new Lz;_(F);var z=h?Vl.CUBIC:Vl.CONSTANT;return F.channel.curve.assignSorted(l,c.map((function(t){return{value:t.dataPoint,leftTangent:t.inTangent,rightTangent:t.outTangent,interpolationMode:z}}))),void e.push(F);case bU(c,qF):case bU(c,YF):case bU(c,KF):var U=u instanceof qF?2:u instanceof YF?3:4,k=new Yz;_(k),k.componentsCount=U;var G=k.channels(),H=G[0],V=G[1],j=G[2],W=G[3],X=h?Vl.LINEAR:Vl.CONSTANT,q=function(t,e,n){return{value:t,leftTangent:e,rightTangent:n,interpolationMode:X}};switch(U){case 4:W.curve.assignSorted(l,c.map((function(t){return q(t.dataPoint.w,t.inTangent.w,t.outTangent.w)})));case 3:j.curve.assignSorted(l,c.map((function(t){return q(t.dataPoint.z,t.inTangent.z,t.outTangent.z)})));default:H.curve.assignSorted(l,c.map((function(t){return q(t.dataPoint.y,t.inTangent.y,t.outTangent.y)}))),V.curve.assignSorted(l,c.map((function(t){return q(t.dataPoint.x,t.inTangent.x,t.outTangent.x)})))}return void e.push(k);case c.every((function(t){return t instanceof QF})):E(3935)}var Y=new oU;_(Y),Y.channel.curve.assignSorted(l,c),e.push(Y)}()},c=W(i);!(t=c()).done;)s();return e},e._createPropertyCurves=function(){var t=this;this._ratioSamplers=this._keys.map((function(e){return new lU(e.map((function(e){return e/t._duration})))})),this._runtimeCurves=this._curves.map((function(e){return{curve:new uU(e.data,t._duration),modifiers:e.modifiers,valueAdapter:e.valueAdapter,sampler:t._ratioSamplers[e.data.keys],commonTarget:e.commonTarget}}))},L(t,[{key:"keys",get:function(){return this._keys},set:function(t){this._keys=t}},{key:"curves",get:function(){return this._curves},set:function(t){this._curves=t,delete this._runtimeCurves}},{key:"commonTargets",get:function(){return this._commonTargets},set:function(t){this._commonTargets=t}},{key:"data",get:function(){return this._data}}]),t}();function bU(t,e){return t.every((function(t){return t instanceof e}))}var wU=function(){function t(t,e){this._easingMethods=void 0;var n=t.easingMethods;Array.isArray(n)?0===n.length&&0!==e?this._easingMethods=new Array(e).fill(null):this._easingMethods=n:this._easingMethods=void 0===n?new Array(e).fill(t.easingMethod):Array.from({length:e},(function(t,e){var i;return null!==(i=n[e])&&void 0!==i?i:null}))}var e=t.prototype;return e.convert=function(t){var e,n,i,r,a,o,s,c,l,u,h,f,_,p,d,m,g,v,y,x,S,T,A=this._easingMethods;if(A){var E=t.keyFramesCount;if(!(t.keyFramesCount<2)){Array.isArray(A)&&A.length;for(var C=E-1,b=0;b<C;++b){var w=A[b];w&&(Array.isArray(w)?(e=w,n=t.getKeyframeTime(b),i=t.getKeyframeValue(b),r=t.getKeyframeTime(b+1),a=t.getKeyframeValue(b+1),o=void 0,s=void 0,c=void 0,l=void 0,u=void 0,h=void 0,f=void 0,_=void 0,p=void 0,d=void 0,m=void 0,g=void 0,v=void 0,y=void 0,x=void 0,S=void 0,T=void 0,s=e[0],c=e[1],l=e[2],u=e[3],h=i.value,f=3*(r-n),_=3*(a.value-h),m=(1-l)*f,g=(1-u)*_,v=1/3,y=(d=c*_)/(p=s*f),x=Math.sqrt(p*p+d*d)*v,S=g/m,T=Math.sqrt(m*m+g*g)*v,i.interpolationMode=Vl.CUBIC,i.tangentWeightMode=(o=i.tangentWeightMode)===Wl.NONE?Wl.RIGHT:o===Wl.LEFT?Wl.BOTH:o,i.rightTangent=y,i.rightTangentWeight=x,a.tangentWeightMode=function(t){return t===Wl.NONE?Wl.LEFT:t===Wl.RIGHT?Wl.BOTH:t}(a.tangentWeightMode),a.leftTangent=S,a.leftTangentWeight=T):PU(w,t,b))}}}},e.convertQuatCurve=function(t){var e=this._easingMethods;if(e){var n=t.keyFramesCount;if(!(t.keyFramesCount<2)){Array.isArray(e)&&e.length;for(var i=n-1,r=0;r<i;++r){var a=e[r];a&&(Array.isArray(a)?t.getKeyframeValue(r).easingMethod=a.slice():IU(a,t,r))}}}},L(t,[{key:"nil",get:function(){return!this._easingMethods||this._easingMethods.every((function(t){return null==t}))}}]),t}();function PU(t,e,n){e.keyFramesCount;var i=e.getKeyframeValue(n),r=ak[t];r===t_.CONSTANT?i.interpolationMode=Vl.CONSTANT:(i.interpolationMode=Vl.LINEAR,i.easingMethod=r)}function IU(t,e,n){e.keyFramesCount;var i=e.getKeyframeValue(n),r=ak[t];i.easingMethod=r}var RU,DU,OU,MU,NU,LU,BU,FU,zU,UU,kU,GU,HU,VU,jU,WU,XU,qU,YU,KU,QU,ZU,JU,$U,tk,ek,nk,ik,rk,ak={constant:t_.CONSTANT,linear:t_.LINEAR,quadIn:t_.QUAD_IN,quadOut:t_.QUAD_OUT,quadInOut:t_.QUAD_IN_OUT,quadOutIn:t_.QUAD_OUT_IN,cubicIn:t_.CUBIC_IN,cubicOut:t_.CUBIC_OUT,cubicInOut:t_.CUBIC_IN_OUT,cubicOutIn:t_.CUBIC_OUT_IN,quartIn:t_.QUART_IN,quartOut:t_.QUART_OUT,quartInOut:t_.QUART_IN_OUT,quartOutIn:t_.QUART_OUT_IN,quintIn:t_.QUINT_IN,quintOut:t_.QUINT_OUT,quintInOut:t_.QUINT_IN_OUT,quintOutIn:t_.QUINT_OUT_IN,sineIn:t_.SINE_IN,sineOut:t_.SINE_OUT,sineInOut:t_.SINE_IN_OUT,sineOutIn:t_.SINE_OUT_IN,expoIn:t_.EXPO_IN,expoOut:t_.EXPO_OUT,expoInOut:t_.EXPO_IN_OUT,expoOutIn:t_.EXPO_OUT_IN,circIn:t_.CIRC_IN,circOut:t_.CIRC_OUT,circInOut:t_.CIRC_IN_OUT,circOutIn:t_.CIRC_OUT_IN,elasticIn:t_.ELASTIC_IN,elasticOut:t_.ELASTIC_OUT,elasticInOut:t_.ELASTIC_IN_OUT,elasticOutIn:t_.ELASTIC_OUT_IN,backIn:t_.BACK_IN,backOut:t_.BACK_OUT,backInOut:t_.BACK_IN_OUT,backOutIn:t_.BACK_OUT_IN,bounceIn:t_.BOUNCE_IN,bounceOut:t_.BOUNCE_OUT,bounceInOut:t_.BOUNCE_IN_OUT,bounceOutIn:t_.BOUNCE_OUT_IN,smooth:t_.SMOOTH,fade:t_.FADE};function ok(){throw new Error("split() only valid in Editor.")}nl("cc.animation.ExoticAnimation")((OU=function(){function t(){X(this,"_nodeAnimations",DU,this)}var e=t.prototype;return e.createEvaluator=function(t){return new mk(this._nodeAnimations,t)},e.addNodeAnimation=function(t){var e=new sk(t);return this._nodeAnimations.push(e),e},e.collectAnimatedJoints=function(){return Array.from(new Set(this._nodeAnimations.map((function(t){return t.path}))))},e.split=function(){return ok()},e.toHashString=function(){return this._nodeAnimations.map((function(t){return t.toHashString()})).join("\n")},t}(),DU=q((RU=OU).prototype,"_nodeAnimations",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),RU));var sk=nl("cc.animation.ExoticNodeAnimation")((UU=function(){function t(t){X(this,"_path",LU,this),X(this,"_position",BU,this),X(this,"_rotation",FU,this),X(this,"_scale",zU,this),this._path=t}var e=t.prototype;return e.createPosition=function(t,e){this._position=new _k(t,new hk(e))},e.createRotation=function(t,e){this._rotation=new _k(t,new fk(e))},e.createScale=function(t,e){this._scale=new _k(t,new hk(e))},e.createEvaluator=function(t){return new gk(this._path,this._position,this._rotation,this._scale,t)},e.split=function(){return ok()},e.toHashString=function(){var t,e,n,i,r,a;return this._path+"\n"+(null!==(t=null===(e=this._position)||void 0===e?void 0:e.toHashString())&&void 0!==t?t:"")+(null!==(n=null===(i=this._scale)||void 0===i?void 0:i.toHashString())&&void 0!==n?n:"")+(null!==(r=null===(a=this._rotation)||void 0===a?void 0:a.toHashString())&&void 0!==r?r:"")},L(t,[{key:"path",get:function(){return this._path}}]),t}(),LU=q((NU=UU).prototype,"_path",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),BU=q(NU.prototype,"_position",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),FU=q(NU.prototype,"_rotation",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),zU=q(NU.prototype,"_scale",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),MU=NU))||MU;function ck(t){return t.toPrecision(2)}function lk(t){return t.map(ck).join(" ")}var uk=nl("cc.animation.ExoticVectorLikeTrackValues")((jU=function(){function t(t){X(this,"_values",HU,this),X(this,"_isQuantized",VU,this),this._values=t,this._isQuantized=!1}var e=t.prototype;return e.quantize=function(t){this._isQuantized,this._values=function(t,e){var n=yk[e],i=1<<n.BYTES_PER_ELEMENT,r=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY;t.forEach((function(t){r=Math.min(t,r),a=Math.max(t,a)}));var o=a-r,s=n.from(t,(function(t){return(t-r)/o*i}));return new Nk(xk(t),s,o,r)}(this._values,t),this._isQuantized=!0},e.toHashString=function(){var t=this._isQuantized,e=this._values;return t+" "+(t?e.toHashString():lk(e))},L(t,[{key:"precision",get:function(){return this._isQuantized?this._values.originalPrecision:xk(this._values)}}]),t}(),HU=q((GU=jU).prototype,"_values",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VU=q(GU.prototype,"_isQuantized",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kU=GU))||kU,hk=nl("cc.animation.ExoticVec3TrackValues")(WU=function(t){function e(){return t.apply(this,arguments)||this}F(e,t),e.imitate=function(t,n){var i=new e(t);return n._isQuantized&&i.quantize(n._values.quantizationType),i};var n=e.prototype;return n.get=function(t,e){var n=this._values;this._isQuantized?Fk(n,t,e):di.fromArray(e,n,3*t)},n.lerp=function(t,e,n,i,r,a){var o=this._values;this._isQuantized?(Fk(o,t,i),Fk(o,e,r)):(di.fromArray(i,o,3*t),di.fromArray(r,o,3*e)),di.lerp(a,i,r,n)},e}(uk))||WU,fk=nl("cc.animation.ExoticQuatTrackValues")(XU=function(t){function e(){return t.apply(this,arguments)||this}F(e,t),e.imitate=function(t,n){var i=new e(t);return n._isQuantized&&i.quantize(n._values.quantizationType),i};var n=e.prototype;return n.get=function(t,e){var n=this._values;this._isQuantized?zk(n,t,e):Ti.fromArray(e,n,4*t)},n.lerp=function(t,e,n,i,r,a){var o=this._values;this._isQuantized?(zk(o,t,i),zk(o,e,r)):(Ti.fromArray(i,o,4*t),Ti.fromArray(r,o,4*e)),Ti.slerp(a,i,r,n)},e}(uk))||XU,_k=nl("cc.animation.ExoticTrack")((ZU=function(){function t(t,e){X(this,"times",KU,this),X(this,"values",QU,this),this.times=t,this.values=e}return t.prototype.toHashString=function(){var t=this.times,e=this.values;return"times: "+lk(t)+"; values: "+e.toHashString()},t}(),KU=q((YU=ZU).prototype,"times",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),QU=q(YU.prototype,"values",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qU=YU))||qU;function pk(t,e){t.length,t.length;var n=0,i=0,r=qc(t,e);if(r>=0)n=r;else{var a=~r,o=a-1;n=o;var s=t[a],c=t[o];i=(e-c)/(s-c)}return{index:n,ratio:i}}!function(){function t(){this._reset()}var e=t.prototype;e.transformTime=function(t){return t-this._timeOffset},e.calculate=function(t,e,n){this._reset();var i=t.length;if(i){var r=t[0],a=t[i-1],o=Yn(e,r,a),s=Yn(n,r,a);this._timeOffset=o;var c=function(t,e,n){var i=t.length;n>=e&&e>=t[0]&&t[i-1];var r=pk(t,e),a=r.index,o=r.ratio,s=pk(t,n);return{fromIndex:a,fromRatio:o,toIndex:s.index,toRatio:s.ratio}}(t,o,s),l=c.fromIndex,u=c.fromRatio,h=c.toIndex,f=c.toRatio,_=!u,p=!f;l!==h||u!==f?(_||(this.preLerpIndex=l,this.preLerpRatio=u),this.directKeyframesBegin=_?l:l+1,this.directKeyframesEnd=h+1,p||(this.postLerpIndex=h,this.postLerpRatio=f)):_?(this.directKeyframesBegin=l,this.directKeyframesEnd=l+1):(this.preLerpIndex=l,this.preLerpRatio=u)}},e._reset=function(){this.preLerpIndex=-1,this.preLerpRatio=0,this.directKeyframesBegin=0,this.directKeyframesEnd=0,this.postLerpIndex=-1,this.postLerpRatio=0,this._timeOffset=0},L(t,[{key:"keyframesCount",get:function(){var t=this.preLerpIndex,e=this.directKeyframesBegin;return 0+(t<0?0:1)+(this.directKeyframesEnd-e)+(this.postLerpIndex<0?0:1)}}])}();var dk,mk=function(){function t(t,e){this._nodeEvaluations=void 0,this._nodeEvaluations=t.map((function(t){return t.createEvaluator(e)}))}return t.prototype.evaluate=function(t){this._nodeEvaluations.forEach((function(e){e.evaluate(t)}))},t}(),gk=function(){function t(t,e,n,i,r){this._position=null,this._rotation=null,this._scale=null,e&&(this._position=Bk(e.times,e.values,di,t,"position",r)),n&&(this._rotation=Bk(n.times,n.values,Ti,t,"rotation",r)),i&&(this._scale=Bk(i.times,i.values,di,t,"scale",r))}return t.prototype.evaluate=function(t){if(this._position){var e=this._position.evaluator.evaluate(t);this._position.runtimeBinding.setValue(e)}if(this._rotation){var n=this._rotation.evaluator.evaluate(t);this._rotation.runtimeBinding.setValue(n)}if(this._scale){var i=this._scale.evaluator.evaluate(t);this._scale.runtimeBinding.setValue(i)}},t}(),vk=function(){function t(t,e,n){this._times=void 0,this._inputSampleResultCache={just:!1,index:-1,nextIndex:-1,ratio:0},this._values=void 0,this._prevValue=void 0,this._nextValue=void 0,this._resultValue=void 0,this._times=t,this._values=e,this._prevValue=new n,this._nextValue=new n,this._resultValue=new n}return t.prototype.evaluate=function(t){var e=this._times,n=this._values,i=this._resultValue;if(0===e.length)return i;var r=function(t,e,n){var i=t.length,r=t[0],a=t[i-1];if(e<r)n.just=!0,n.index=0;else if(e>a)n.just=!0,n.index=i-1;else{var o=qc(t,e);if(o>=0)n.just=!0,n.index=o;else{var s=~o,c=s-1,l=t[c],u=t[s],h=(e-t[c])/(u-l);n.just=!1,n.index=c,n.nextIndex=s,n.ratio=h}}return n}(e,t,this._inputSampleResultCache);return r.just?n.get(r.index,i):n.lerp(r.index,r.nextIndex,r.ratio,this._prevValue,this._nextValue,i),i},t}(),yk={uint8:Uint8Array,uint16:Uint16Array};function xk(t){switch(t.BYTES_PER_ELEMENT){default:case 4:return dk.FLOAT_32;case 8:return dk.FLOAT_64}}!function(t){t[t.FLOAT_32=0]="FLOAT_32",t[t.FLOAT_64=1]="FLOAT_64"}(dk||(dk={}));var Sk,Tk,Ak,Ek,Ck,bk,wk,Pk,Ik,Rk,Dk,Ok,Mk,Nk=nl("cc.animation.QuantizedFloatArray")((rk=function(){function t(t,e,n,i){void 0===i&&(i=0),X(this,"originalPrecision",tk,this),X(this,"min",ek,this),X(this,"extent",nk,this),X(this,"values",ik,this),this.originalPrecision=t,this.values=e,this.extent=n,this.min=i}return t.prototype.toHashString=function(){var t=this.originalPrecision,e=this.min,n=this.extent,i=this.values;return t+" "+ck(e)+" "+ck(n)+" "+i.join(" ")},L(t,[{key:"quantizationType",get:function(){switch(this.values.BYTES_PER_ELEMENT){default:case 1:return"uint8";case 2:return"uint16"}}}]),t}(),tk=q(($U=rk).prototype,"originalPrecision",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ek=q($U.prototype,"min",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nk=q($U.prototype,"extent",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ik=q($U.prototype,"values",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),JU=$U))||JU;function Lk(t,e){return t.values[e]/(1<<t.values.BYTES_PER_ELEMENT)*t.extent+t.min}function Bk(t,e,n,i,r,a){var o=new Rz;o.path=(new Iz).toHierarchy(i).toProperty(r);var s=a(o);return s?{runtimeBinding:s,evaluator:new vk(t,e,n)}:null}function Fk(t,e,n){di.set(n,Lk(t,3*e+0),Lk(t,3*e+1),Lk(t,3*e+2))}function zk(t,e,n){Ti.set(n,Lk(t,4*e+0),Lk(t,4*e+1),Lk(t,4*e+2),Lk(t,4*e+3))}var Uk=Symbol("SearchForRootBonePath"),kk=Symbol("ExoticAnimation"),Gk=t("AnimationClip",nl("cc.AnimationClip")((Mk=Ok=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return X(e=t.call.apply(t,[this].concat(i))||this,"sample",Ak,V(e)),X(e,"speed",Ek,V(e)),X(e,"wrapMode",Ck,V(e)),X(e,"enableTrsBlending",bk,V(e)),X(e,"_duration",wk,V(e)),X(e,"_hash",Pk,V(e)),e.frameRate=0,X(e,"_tracks",Ik,V(e)),X(e,"_exoticAnimation",Rk,V(e)),e._legacyData=void 0,e._legacyDataDirty=!1,X(e,"_events",Dk,V(e)),e._runtimeEvents={ratios:[],eventGroups:[]},e}F(e,t),e.createWithSpriteFrames=function(t,n){var i=new e;i.sample=n||i.sample,i.duration=t.length/i.sample;var r=1/i.sample,a=new oU;return a.path=(new Iz).toComponent("cc.Sprite").toProperty("spriteFrame"),a.channels()[0].curve.assignSorted(t.map((function(t,e){return[r*e,t]}))),i.addTrack(a),i};var n=e.prototype;return n.onLoaded=function(){this.frameRate=this.sample,this.events=this._events},n.range=function(){for(var t={min:1/0,max:-1/0},e=this._tracks,n=e.length,i=0;i<n;++i){var r=e[i].range();t.min=Math.min(t.min,r.min),t.max=Math.max(t.max,r.max)}return t},n.getTrack=function(t){return this._tracks[t]},n.addTrack=function(t){var e=this._tracks.length;return this._tracks.push(t),e},n.removeTrack=function(t){this._tracks.splice(t,1)},n.clearTracks=function(){this._tracks.length=0},n.createEventEvaluator=function(t){return new Kk(t,this._runtimeEvents.ratios,this._runtimeEvents.eventGroups,this.wrapMode)},n.createEvaluator=function(t){var e=this,n=t.target;return this._createEvalWithBinder(n,(function(i){var r=i.createRuntimeBinding(n,e.enableTrsBlending?t.pose:void 0,!1);return null!=r?r:void 0}),t.rootMotion)},n.destroy=function(){var e;return(null===(e=i.director.root)||void 0===e?void 0:e.dataPoolManager)&&i.director.root.dataPoolManager.releaseAnimationClip(this),cU.destroy(this),t.prototype.destroy.call(this)},n[sU]=function(t,e,n){for(var i=1/e,r=this._collectAnimatedJoints(),a=r.length,o={},s=0;s<a;++s)o[r[s]]={transforms:Array.from({length:n},(function(){return new Ri}))};var c=r.reduce((function(t,e){return t[e]=new jk,t}),{});for(var l in c){var u=c[l],h=l.lastIndexOf("/");if(h>=0){var f=l.substring(0,h),_=c[f];_&&(u.parent=_)}}for(var p=this._createEvalWithBinder(void 0,(function(t){var e=t.parseTrsPath();if(e){var n=c[e.node];if(n)return Yk(n,e.property)}}),void 0),d=0;d<n;++d){var m=t+i*d;p.evaluate(m);for(var g=0;g<a;++g){var v=r[g];Ri.copy(o[v].transforms[d],c[v].globalTransform)}for(var y=0;y<a;++y){var x=r[y];c[x].invalidate()}}return{samples:e,frames:n,joints:o}},n.upgradeUntypedTracks=function(t){for(var e=[],n=[],i=this._tracks,r=i.length,a=0;a<r;++a){var o=i[a];if(o instanceof EU){var s=o.upgrade(t);s&&(e.push(s),n.push(o))}}for(var c=n.length,l=0;l<c;++l)kt.remove(i,n[l]);i.push.apply(i,e)},n[Uk]=function(){return this._searchForRootBonePath()},n.getPropertyCurves=function(){return this._getLegacyData().getPropertyCurves()},n.updateEventDatas=function(){this.events=this._events},n.hasEvents=function(){return 0!==this.events.length},n.syncLegacyData=function(){this._legacyData&&(this._fromLegacy(this._legacyData),this._legacyData=void 0)},n._createEvalWithBinder=function(t,e,n){this._legacyDataDirty&&(this._legacyDataDirty=!1,this.syncLegacyData());var i,r=[];n&&(i=this._createRootMotionEvaluation(t,n,r));for(var a,o=[],s=this._tracks,c=s.length,l=0;l<c;++l){var u=s[l];if(!r.includes(u)&&!Array.from(u.channels()).every((function(t){return 0===t.curve.keyFramesCount}))){var h=e(u[Pz]);if(h){var f=u[Cz](h);o.push({binding:h,trackEval:f})}}}return this._exoticAnimation&&(a=this._exoticAnimation.createEvaluator(e)),new Hk(o,a,i)},n._createRootMotionEvaluation=function(t,e,n){if(t instanceof qC){var i=this._searchForRootBonePath();if(i){var r=t.getChildByPath(i);if(r){for(var a=new Vk,o=[],s=this._tracks,c=s.length,l=0;l<c;++l){var u=s[l],h=u[Pz].parseTrsPath();if(h&&h.node===i){n.push(u);var f=Yk(a,h.property);if(f){var _=u[Cz](f);o.push({binding:f,trackEval:_})}}}return new Xk(r,this._duration,a,o)}E(3924)}else E(3923)}else b(3920)},n._searchForRootBonePath=function(){var t=this._tracks.map((function(t){var e=t[Pz].parseTrsPath();if(e){var n=e.node;return{path:n,rank:n.split("/").length}}return{path:"",rank:0}}));t.sort((function(t,e){return t.rank-e.rank}));var e=t.findIndex((function(t){return 0!==t.rank}));if(e<0)return"";for(var n=t.length,i=t[e],r=!0,a=e+1;a<n;++a){var o=t[a];if(o.rank!==i.rank)break;if(o.path!==i.path){r=!1;break}}return r?i.path:""},n._getLegacyData=function(){return this._legacyData||(this._legacyData=this._toLegacy()),this._legacyData},n._toLegacy=function(){var t=new CU(this._duration);return t.keys=[],t.curves=[],t.commonTargets=[],t},n._fromLegacy=function(t){for(var e=t.toTracks(),n=e.length,i=0;i<n;++i)this.addTrack(e[i])},n._collectAnimatedJoints=function(){for(var t=new Set,e=this._tracks,n=e.length,i=0;i<n;++i){var r=e[i][Pz].parseTrsPath();r&&t.add(r.node)}if(this._exoticAnimation)for(var a=this._exoticAnimation.collectAnimatedJoints(),o=a.length,s=0;s<o;++s)t.add(a[s]);return Array.from(t)},L(e,[{key:"duration",get:function(){return this._duration},set:function(t){this._duration=t}},{key:"tracksCount",get:function(){return this._tracks.length}},{key:"tracks",get:function(){return this._tracks}},{key:"hash",get:function(){var t,e;if(this._hash)return this._hash;var n="Exotic:"+(null!==(t=null===(e=this._exoticAnimation)||void 0===e?void 0:e.toHashString())&&void 0!==t?t:"");return this._hash=Po(n,666)}},{key:"events",get:function(){return this._events},set:function(t){var e=this;this._events=t;for(var n=[],i=[],r=this.events.sort((function(t,e){return t.frame-e.frame})),a=r.length,o=function(t){var a=r[t],o=a.frame/e._duration,s=n.findIndex((function(t){return t===o}));s<0&&(s=n.length,n.push(o),i.push({events:[]})),i[s].events.push({functionName:a.func,parameters:a.params})},s=0;s<a;++s)o(s);this._runtimeEvents={ratios:n,eventGroups:i}}},{key:kk,get:function(){return this._exoticAnimation}},{key:kk,set:function(t){this._exoticAnimation=t}},{key:"keys",get:function(){return this._getLegacyData().keys}},{key:"keys",set:function(t){this._legacyDataDirty=!0,this._getLegacyData().keys=t}},{key:"curves",get:function(){return this._legacyDataDirty=!0,this._getLegacyData().curves}},{key:"curves",set:function(t){this._getLegacyData().curves=t}},{key:"commonTargets",get:function(){return this._getLegacyData().commonTargets}},{key:"commonTargets",set:function(t){this._legacyDataDirty=!0,this._getLegacyData().commonTargets=t}},{key:"data",get:function(){return this._getLegacyData().data}},{key:"eventGroups",get:function(){return this._runtimeEvents.eventGroups}}]),e}(Ou),Ok.WrapMode=Gc,Ak=q((Tk=Mk).prototype,"sample",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 60}}),Ek=q(Tk.prototype,"speed",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Ck=q(Tk.prototype,"wrapMode",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Gc.Normal}}),bk=q(Tk.prototype,"enableTrsBlending",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),wk=q(Tk.prototype,"_duration",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Pk=q(Tk.prototype,"_hash",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Ik=q(Tk.prototype,"_tracks",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Rk=q(Tk.prototype,"_exoticAnimation",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Dk=q(Tk.prototype,"_events",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Sk=Tk))||Sk);i.AnimationClip=Gk;var Hk=function(){function t(t,e,n){this._exoticAnimationEvaluator=void 0,this._trackEvalStatues=[],this._rootMotionEvaluation=void 0,this._trackEvalStatues=t,this._exoticAnimationEvaluator=e,this._rootMotionEvaluation=n}var e=t.prototype;return e.evaluate=function(t){for(var e=this._trackEvalStatues,n=this._exoticAnimationEvaluator,i=e.length,r=0;r<i;++r){var a=e[r],o=a.trackEval,s=a.binding,c=o.evaluate(t,s);s.setValue(c)}n&&n.evaluate(t)},e.evaluateRootMotion=function(t,e){var n=this._rootMotionEvaluation;n&&n.evaluate(t,e)},t}(),Vk=function(){function t(){this.position=new di,this.scale=new di(1,1,1),this.rotation=new Ti,this.eulerAngles=new di}return t.prototype.getTransform=function(t){Ri.fromRTS(t,this.rotation,this.position,this.scale)},t}(),jk=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).parent=null,e._dirty=!0,e._transform=new Ri,e}return F(e,t),e.prototype.invalidate=function(){this._dirty=!0},L(e,[{key:"globalTransform",get:function(){var t=this._transform;return this._dirty&&(this._dirty=!1,Ri.fromRTS(t,this.rotation,this.position,this.scale),this.parent&&Ri.multiply(t,this.parent.globalTransform,t)),this._transform}}]),e}(Vk),Wk=new Ri,Xk=function(){function t(t,e,n,i){this._initialTransformCache=new Ri,this._clipEndTransformCache=new Ri,this._startTransformCache=new Ri,this._endTransformCache=new Ri,this._motionTransformCache=new Ri,this._translationMotionCache=new di,this._rotationMotionCache=new Ti,this._scaleMotionCache=new di,this._rootBone=t,this._duration=e,this._boneTransform=n,this._trackEvalStatuses=i}var e=t.prototype;return e.evaluate=function(t,e){var n=this._calcMotionTransform(t,e,this._motionTransformCache),i=this._translationMotionCache,r=this._rotationMotionCache,a=this._scaleMotionCache,o=this._rootBone;Ri.toRTS(n,r,i,a),di.add(i,i,o.position),o.setPosition(i),Ti.multiply(r,r,o.rotation),o.setRotation(r),di.multiply(a,a,o.scale),o.setScale(a)},e._calcMotionTransform=function(t,e,n){var i=this._duration,r=i-t,a=this._evaluateAt(t,this._startTransformCache);if(e<r){var o=this._evaluateAt(t+e,this._endTransformCache);qk(n,a,o)}else{Ri.identity(n);var s=function(t,e){qk(Wk,t,e),Ri.multiply(n,n,Wk)},c=e-r,l=Math.floor(c/i),u=c-l*i,h=this._evaluateAt(0,this._initialTransformCache),f=this._evaluateAt(i,this._clipEndTransformCache),_=this._evaluateAt(u,this._endTransformCache);s(a,f),qk(Wk,h,f);for(var p=0;p<l;++p)Ri.multiply(n,n,Wk);s(h,_)}return n},e._evaluateAt=function(t,e){for(var n=this._trackEvalStatuses,i=n.length,r=0;r<i;++r){var a=n[r],o=a.trackEval,s=a.binding,c=o.evaluate(t,s);s.setValue(c)}return this._boneTransform.getTransform(e),e},t}();function qk(t,e,n){Ri.invert(t,e),Ri.multiply(t,n,t)}function Yk(t,e){switch(e){default:return;case"position":return{setValue:function(e){di.copy(t.position,e)}};case"rotation":return{setValue:function(e){Ti.copy(t.rotation,e)}};case"scale":return{setValue:function(e){di.copy(t.scale,e)}};case"eulerAngles":return{setValue:function(e){di.copy(t.eulerAngles,e)}}}}var Kk=function(){function t(t,e,n,i){this._lastFrameIndex=-1,this._lastIterations=0,this._lastDirection=0,this._ignoreIndex=-1,this._sampled=!1,this._targetNode=t,this._ratios=e,this._eventGroups=n,this._wrapMode=i}var e=t.prototype;return e.setWrapMode=function(t){this._wrapMode=t},e.ignore=function(t,e){this._ignoreIndex=-1,this._sampled=!1;var n=Zk(t,this._ratios);n<0&&(n=~n-1,e<0&&(n+=1),this._ignoreIndex=n)},e.sample=function(t,e,n){var i=this._eventGroups.length,r=Zk(t,this._ratios);if(r<0&&(r=~r-1,e<0&&(r+=1)),this._ignoreIndex!==r&&(this._ignoreIndex=-1),!this._sampled)return this._sampled=!0,this._doFire(r,!1),this._lastFrameIndex=r,this._lastIterations=n,void(this._lastDirection=e);var a=this._wrapMode,o=Qk(n),s=Qk(this._lastIterations),c=this._lastFrameIndex,l=this._lastDirection,u=-1!==s&&o!==s;if(c===r&&u&&1===i)this._doFire(0,!1);else if(c!==r||u){e=l;do{if(c!==r){if(-1===e&&0===c&&r>0?((a&kc.PingPong)===kc.PingPong?e*=-1:c=i,s++):1===e&&c===i-1&&r<i-1&&((a&kc.PingPong)===kc.PingPong?e*=-1:c=-1,s++),c===r)break;if(s>o)break}c+=e,this._doFire(c,!0)}while(c!==r&&c>-1&&c<i)}this._lastFrameIndex=r,this._lastIterations=n,this._lastDirection=e},e._doFire=function(t,e){e?i.director.getAnimationManager().pushDelayEvent(this._checkAndFire,this,[t]):this._checkAndFire(t)},e._checkAndFire=function(t){if(this._targetNode&&this._targetNode.isValid){var e=this._eventGroups;if(!(t<0||t>=e.length||this._ignoreIndex===t))for(var n=e[t],i=this._targetNode.components,r=n.events.length,a=0;a<r;++a)for(var o=n.events[a],s=o.functionName,c=i.length,l=0;l<c;++l){var u=i[l],h=u[s];"function"==typeof h&&h.apply(u,o.parameters)}}},t}();function Qk(t){return t-(0|t)==0&&(t-=1),0|t}function Zk(t,e){return qc(e,t)}var Jk,$k=function(){function t(){this._isPlaying=!1,this._isPaused=!1,this._stepOnce=!1}var e=t.prototype;return e.play=function(){this._isPlaying?this._isPaused?(this._isPaused=!1,this.onResume()):this.onError(R(3912)):(this._isPlaying=!0,this.onPlay())},e.stop=function(){this._isPlaying&&(this._isPlaying=!1,this.onStop(),this._isPaused=!1)},e.pause=function(){this._isPlaying&&!this._isPaused&&(this._isPaused=!0,this.onPause())},e.resume=function(){this._isPlaying&&this._isPaused&&(this._isPaused=!1,this.onResume())},e.step=function(){this.pause(),this._stepOnce=!0,this._isPlaying||this.play()},e.update=function(){},e.onPlay=function(){},e.onPause=function(){},e.onResume=function(){},e.onStop=function(){},e.onError=function(){},L(t,[{key:"isPlaying",get:function(){return this._isPlaying}},{key:"isPaused",get:function(){return this._isPaused}},{key:"isMotionless",get:function(){return!this.isPlaying||this.isPaused}}]),t}(),tG=function(){function t(t){this.weight=0,this._pose=void 0,this._blendStateWriters=[],this._pose=t}var e=t.prototype;return e.destroy=function(){for(var t=0;t<this._blendStateWriters.length;++t)this._pose.destroyWriter(this._blendStateWriters[t]);this._blendStateWriters.length=0},e.createPoseWriter=function(t,e,n){var i=this._pose.createWriter(t,e,this,n);return this._blendStateWriters.push(i),i},t}();!function(t){t.PLAY="play",t.STOP="stop",t.PAUSE="pause",t.RESUME="resume",t.LASTFRAME="lastframe",t.FINISHED="finished"}(Jk||(Jk={})),Zt(Jk);var eG=t("AnimationState",function(t){function e(e,n){var i;return void 0===n&&(n=""),(i=t.call(this)||this).duration=1,i.speed=1,i.time=0,i.frameRate=0,i._targetNode=null,i._curveLoaded=!1,i._clip=void 0,i._useSimpleProcess=!1,i._target=null,i._wrapMode=Gc.Normal,i._repeatCount=1,i._delay=0,i._delayTime=0,i._currentFramePlayed=!1,i._name=void 0,i._lastIterations=NaN,i._lastWrapInfo=null,i._wrappedInfo=new Xc,i._allowLastFrame=!1,i._blendStateWriterHost={weight:0},i._playbackDuration=0,i._invDuration=1,i._poseOutput=null,i._weight=1,i._clipEval=void 0,i._clipEventEval=void 0,i._doNotCreateEval=!1,i._clip=e,i._name=n||e&&e.name,i._playbackRange={min:0,max:e.duration},i._playbackDuration=e.duration,e.duration||g("Clip "+e.name+" has zero duration."),i}F(e,t);var n=e.prototype;return n.initialize=function(t,e){if(!this._curveLoaded){this._curveLoaded=!0,this._poseOutput&&(this._poseOutput.destroy(),this._poseOutput=null),this._clipEval&&(this._clipEval=void 0),this._targetNode=t;var n=this._clip;if(this.duration=n.duration,this._invDuration=1/this.duration,this.speed=n.speed,this.wrapMode=n.wrapMode,this.frameRate=n.sample,this._playbackRange.min=0,this._playbackRange.max=n.duration,this._playbackDuration=n.duration,(this.wrapMode&kc.Loop)===kc.Loop?this.repeatCount=1/0:this.repeatCount=1,!this._doNotCreateEval){var r,a,o,s=null!==(r=null!=e?e:null===(a=i.director.getAnimationManager())||void 0===a?void 0:a.blendState)&&void 0!==r?r:null;s&&(this._poseOutput=new tG(s)),this._clipEval=n.createEvaluator({target:t,pose:null!==(o=this._poseOutput)&&void 0!==o?o:void 0})}this._clipEventEval=n.createEventEvaluator(this._targetNode)}},n.destroy=function(){this.isMotionless||i.director.getAnimationManager().removeAnimation(this),this._poseOutput&&(this._poseOutput.destroy(),this._poseOutput=null),this._clipEval=void 0},n.emit=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];i.director.getAnimationManager().pushDelayEvent(this._emit,this,e)},n.on=function(t,e,n){return this._target&&this._target.isValid?this._target.on(t,e,n):null},n.once=function(t,e,n){return this._target&&this._target.isValid?this._target.once(t,e,n):null},n.off=function(t,e,n){this._target&&this._target.isValid&&this._target.off(t,e,n)},n.allowLastFrameEvent=function(t){this._allowLastFrame=t},n._setEventTarget=function(t){this._target=t},n.setTime=function(t){this._currentFramePlayed=!1,this.time=t||0;var e,n=this.getWrappedInfo(t,this._wrappedInfo);null===(e=this._clipEventEval)||void 0===e||e.ignore(n.ratio,n.direction)},n.update=function(t){this._delayTime>0&&(this._delayTime-=t,this._delayTime>0)||(this._currentFramePlayed?this.time+=t*this.speed:this._currentFramePlayed=!0,this._process())},n.sample=function(){var t=this.getWrappedInfo(this.time,this._wrappedInfo);return this._sampleCurves(t.time),this._sampleEvents(t),t},n.onPlay=function(){this.setTime(this._getPlaybackStart()),this._delayTime=this._delay,this._onReplayOrResume(),this.emit(Jk.PLAY,this)},n.onStop=function(){this.isPaused||this._onPauseOrStop(),this.emit(Jk.STOP,this)},n.onResume=function(){this._onReplayOrResume(),this.emit(Jk.RESUME,this)},n.onPause=function(){this._onPauseOrStop(),this.emit(Jk.PAUSE,this)},n._sampleCurves=function(t){var e=this._poseOutput,n=this._clipEval;e&&(e.weight=this.weight),n&&n.evaluate(t)},n._process=function(){this._useSimpleProcess?this.simpleProcess():this.process()},n.process=function(){var t,e=this.sample();this._allowLastFrame&&(t=this._lastWrapInfo?this._lastWrapInfo:this._lastWrapInfo=new Xc(e),this.repeatCount>1&&(0|e.iterations)>(0|t.iterations)&&this.emit(Jk.LASTFRAME,this),t.set(e)),e.stopped&&(this.stop(),this.emit(Jk.FINISHED,this))},n.simpleProcess=function(){var t=this._playbackRange.min,e=this._playbackDuration,n=this.time%e;n<0&&(n+=e);var i=(t+n)*this._invDuration;this._sampleCurves(t+n),this._sampleEvents(this.getWrappedInfo(this.time,this._wrappedInfo)),this._allowLastFrame&&(Number.isNaN(this._lastIterations)&&(this._lastIterations=i),(this.time>0&&this._lastIterations>i||this.time<0&&this._lastIterations<i)&&this.emit(Jk.LASTFRAME,this),this._lastIterations=i)},n._needReverse=function(t){var e=this.wrapMode,n=!1;return(e&kc.PingPong)===kc.PingPong&&(t-(0|t)==0&&t>0&&(t-=1),1&t&&(n=!n)),(e&kc.Reverse)===kc.Reverse&&(n=!n),n},n.getWrappedInfo=function(t,e){e=e||new Xc;var n=this._getPlaybackStart(),i=this._getPlaybackEnd()-n,r=!1,a=this.repeatCount,o=(t-=n)>0?t/i:-t/i;if(o>=a){o=a,r=!0;var s=a-(0|a);0===s&&(s=1),t=s*i*(t>0?1:-1)}if(t>i){var c=t%i;t=0===c?i:c}else t<0&&0!=(t%=i)&&(t+=i);var l=!1,u=this._wrapMode&kc.ShouldWrap;u&&(l=this._needReverse(o));var h=l?-1:1;return this.speed<0&&(h*=-1),u&&l&&(t=i-t),e.time=n+t,e.ratio=e.time/this.duration,e.direction=h,e.stopped=r,e.iterations=o,e},n._getPlaybackStart=function(){return this._playbackRange.min},n._getPlaybackEnd=function(){return this._playbackRange.max},n._sampleEvents=function(t){var e;null===(e=this._clipEventEval)||void 0===e||e.sample(t.ratio,t.direction,t.iterations)},n._emit=function(t,e){this._target&&this._target.isValid&&this._target.emit(t,t,e)},n._onReplayOrResume=function(){i.director.getAnimationManager().addAnimation(this)},n._onPauseOrStop=function(){i.director.getAnimationManager().removeAnimation(this)},L(e,[{key:"clip",get:function(){return this._clip}},{key:"name",get:function(){return this._name}},{key:"length",get:function(){return this.duration}},{key:"wrapMode",get:function(){return this._wrapMode},set:function(t){var e;this._wrapMode=t,this.time=0,t&kc.Loop?this.repeatCount=1/0:this.repeatCount=1,null===(e=this._clipEventEval)||void 0===e||e.setWrapMode(t)}},{key:"repeatCount",get:function(){return this._repeatCount},set:function(t){this._repeatCount=t;var e=this._wrapMode&kc.ShouldWrap,n=(this.wrapMode&kc.Reverse)===kc.Reverse;this._useSimpleProcess=t===1/0&&!e&&!n}},{key:"delay",get:function(){return this._delay},set:function(t){this._delayTime=this._delay=t}},{key:"playbackRange",get:function(){return this._playbackRange},set:function(t){t.max,t.min,this._playbackRange.min=Math.max(t.min,0),this._playbackRange.max=Math.min(t.max,this.duration),this._playbackDuration=this._playbackRange.max-this._playbackRange.min,this.setTime(0)}},{key:"current",get:function(){return this.getWrappedInfo(this.time).time}},{key:"ratio",get:function(){return this.current/this.duration}},{key:"weight",get:function(){return this._weight},set:function(t){this._weight=t,this._poseOutput&&(this._poseOutput.weight=t)}},{key:"curveLoaded",get:function(){return this._curveLoaded}}]),e}($k));i.AnimationState=eG;var nG,iG,rG,aG,oG,sG,cG,lG,uG,hG,fG,_G,pG,dG,mG,gG,vG,yG=function(t){function e(e){var n;return(n=t.call(this)||this)._managedStates=[],n._fadings=[],n._scheduled=!1,n._scheduler=null!=e?e:i.director.getAnimationManager(),n}F(e,t);var n=e.prototype;return n.update=function(t){if(!this.isMotionless){var e=this._managedStates,n=this._fadings;if(1===e.length&&1===n.length){var i=e[0].state;i&&(i.weight=1)}else this._calculateWeights(t);1===e.length&&1===n.length&&this._unscheduleThis()}},n.crossFade=function(t,e){var n;0===this._managedStates.length&&(e=0),0===e&&this.clear();var i=this._managedStates.find((function(e){return e.state===t}));i?(null===(n=i.state)||void 0===n?void 0:n.isMotionless)&&i.state.play():(i={state:t,reference:0},t&&t.play(),this._managedStates.push(i)),++i.reference,this._fadings.unshift({easeDuration:e,easeTime:0,target:i}),this.isMotionless||this._scheduleThis()},n.clear=function(){for(var t=0;t<this._managedStates.length;++t){var e=this._managedStates[t].state;e&&e.stop()}this._managedStates.length=0,this._fadings.length=0},n.onPlay=function(){t.prototype.onPlay.call(this),this._scheduleThis()},n.onPause=function(){t.prototype.onPause.call(this);for(var e=0;e<this._managedStates.length;++e){var n=this._managedStates[e].state;n&&n.pause()}this._unscheduleThis()},n.onResume=function(){t.prototype.onResume.call(this);for(var e=0;e<this._managedStates.length;++e){var n=this._managedStates[e].state;n&&n.resume()}this._scheduleThis()},n.onStop=function(){t.prototype.onStop.call(this),this.clear()},n._calculateWeights=function(t){for(var e=this._managedStates,n=this._fadings,i=0;i<e.length;++i){var r=e[i].state;r&&(r.weight=0)}for(var a=1,o=n.length,s=0;s<n.length;++s){var c=n[s];c.easeTime+=t;var l=0===c.easeDuration?1:Kn(c.easeTime/c.easeDuration),u=l*a;if(a*=1-l,c.target.state&&(c.target.state.weight+=u),c.easeTime>=c.easeDuration){o=s+1,c.easeTime=c.easeDuration;break}}if(o!==n.length){for(var h=o;h<n.length;++h){var f=n[h];--f.target.reference,f.target.reference<=0&&(f.target.state&&f.target.state.stop(),Z(this._managedStates,f.target))}n.splice(o)}},n._scheduleThis=function(){this._scheduled||(this._scheduler.addCrossFade(this),this._scheduled=!0)},n._unscheduleThis=function(){this._scheduled&&(this._scheduler.removeCrossFade(this),this._scheduled=!1)},e}($k),xG=function(e){return t({AnimationComponent:e,Animation:e}),e}((nG=nl("cc.Animation"),iG=vl(),rG=rl(99),aG=pl(),oG=Bl([Gk]),sG=Al(),cG=Bl(Gk),lG=Al(),uG=Al(),hG=Bl([Gk]),nG(fG=iG(fG=rG(fG=_l(fG=aG((vG=gG=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return X(e=t.call.apply(t,[this].concat(i))||this,"playOnLoad",pG,V(e)),e._crossFade=new yG,e._nameToState=ft(!0),X(e,"_clips",dG,V(e)),X(e,"_defaultClip",mG,V(e)),e._hasBeenPlayed=!1,e}F(e,t);var n=e.prototype;return n.onLoad=function(){for(var t in this.clips=this._clips,this._nameToState)this._nameToState[t].initialize(this.node)},n.start=function(){this.playOnLoad&&!this._hasBeenPlayed&&this._defaultClip&&this.crossFade(this._defaultClip.name,0)},n.onEnable=function(){this._crossFade.resume()},n.onDisable=function(){this._crossFade.pause()},n.onDestroy=function(){for(var t in this._crossFade.stop(),this._nameToState)this._nameToState[t].destroy();this._nameToState=ft(!0)},n.play=function(t){if(this._hasBeenPlayed=!0,!t){if(!this._defaultClip)return;t=this._defaultClip.name}this.crossFade(t,0)},n.crossFade=function(t,e){void 0===e&&(e=.3),this._hasBeenPlayed=!0;var n=this._nameToState[t];n&&this.doPlayOrCrossFade(n,e)},n.pause=function(){this._crossFade.pause()},n.resume=function(){this._crossFade.resume()},n.stop=function(){this._crossFade.stop()},n.getAnimationState=function(t){return this.getState(t)},n.getState=function(t){var e=this._nameToState[t];return e&&!e.curveLoaded&&e.initialize(this.node),e||null},n.createState=function(t,e){return e=e||t.name,this.removeState(e),this._doCreateState(t,e)},n.removeState=function(t){var e=this._nameToState[t];e&&(e.allowLastFrameEvent(!1),e.stop(),delete this._nameToState[t])},n.addClip=function(t,e){return J(this._clips,t)||this._clips.push(t),this.createState(t,e)},n.removeClip=function(t,e){var n;for(var i in this._nameToState){var r=this._nameToState[i];if(r.clip===t){n=r;break}}if(t===this._defaultClip){if(!e)return void E(3902);this._defaultClip=null}if(n&&n.isPlaying){if(!e)return void E(3903);n.stop()}this._clips=this._clips.filter((function(e){return e!==t})),n&&delete this._nameToState[n.name]},n.on=function(e,n,i,r){var a=t.prototype.on.call(this,e,n,i,r);return e===Jk.LASTFRAME&&this._syncAllowLastFrameEvent(),a},n.once=function(e,n,i){var r=t.prototype.once.call(this,e,n,i);return e===Jk.LASTFRAME&&this._syncAllowLastFrameEvent(),r},n.off=function(e,n,i){t.prototype.off.call(this,e,n,i),e===Jk.LASTFRAME&&this._syncDisallowLastFrameEvent()},n._createState=function(t,e){return new eG(t,e)},n._doCreateState=function(t,e){var n=this._createState(t,e);return n._setEventTarget(this),n.allowLastFrameEvent(this.hasEventListener(Jk.LASTFRAME)),this.node&&n.initialize(this.node),this._nameToState[n.name]=n,n},n.doPlayOrCrossFade=function(t,e){this._crossFade.play(),this._crossFade.crossFade(t,e)},n._removeStateOfAutomaticClip=function(t){for(var e in this._nameToState){var n=this._nameToState[e];SG(t,n.clip)&&(n.stop(),delete this._nameToState[e])}},n._syncAllowLastFrameEvent=function(){if(this.hasEventListener(Jk.LASTFRAME))for(var t in this._nameToState)this._nameToState[t].allowLastFrameEvent(!0)},n._syncDisallowLastFrameEvent=function(){if(!this.hasEventListener(Jk.LASTFRAME))for(var t in this._nameToState)this._nameToState[t].allowLastFrameEvent(!1)},L(e,[{key:"clips",get:function(){return this._clips},set:function(t){var e=this;this._crossFade&&this._crossFade.clear();for(var n,i=W(this._clips);!(n=i()).done;){var r=n.value;r&&this._removeStateOfAutomaticClip(r)}for(var a,o=W(t);!(a=o()).done;){var s=a.value;s&&this.createState(s)}var c=t.find((function(t){return SG(t,e._defaultClip)}));this._defaultClip=c||null,this._clips=t}},{key:"defaultClip",get:function(){return this._defaultClip},set:function(t){this._defaultClip=t,t&&(this._clips.findIndex((function(e){return SG(e,t)}))>=0||(this._clips.push(t),this.createState(t)))}}]),e}(an($u)),gG.EventType=Jk,q((_G=vG).prototype,"clips",[oG,sG],Object.getOwnPropertyDescriptor(_G.prototype,"clips"),_G.prototype),q(_G.prototype,"defaultClip",[cG,lG],Object.getOwnPropertyDescriptor(_G.prototype,"defaultClip"),_G.prototype),pG=q(_G.prototype,"playOnLoad",[cl,uG],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),dG=q(_G.prototype,"_clips",[hG],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),mG=q(_G.prototype,"_defaultClip",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),fG=_G))||fG)||fG)||fG)||fG)||fG));function SG(t,e){return t===e||!!t&&!!e&&t._uuid===e._uuid&&t._uuid}i.Animation=xG,Nn(xG.prototype,"Animation",[{name:"getAnimationState",newName:"getState"},{name:"addClip",newName:"createState"},{name:"removeClip",newName:"removeState",customFunction:function(){var t=arguments.length<=0?void 0:arguments[0];return xG.prototype.removeState.call(this,t.name)}}]),i.AnimationComponent=xG,Gt.setClassAlias(xG,"cc.AnimationComponent");var TG,AG,EG,CG=function(){function t(){this._nodeBlendStates=new Map}var e=t.prototype;return e.createWriter=function(t,e,n,i){var r=this.ref(t,e);return new bG(t,e,r,n,i)},e.destroyWriter=function(t){var e=t;this.deRef(e.node,e.property)},e.ref=function(t,e){var n=this._nodeBlendStates.get(t);return n||(n=new RG,this._nodeBlendStates.set(t,n)),n.refProperty(e)},e.deRef=function(t,e){var n=this._nodeBlendStates.get(t);n&&(n.deRefProperty(e),n.empty&&this._nodeBlendStates.delete(t))},e.apply=function(){this._nodeBlendStates.forEach((function(t,e){t.apply(e)}))},t}(),bG=function(){function t(t,e,n,i,r){this._node=t,this._property=e,this._propertyBlendState=n,this._host=i,this._constants=r}var e=t.prototype;return e.getValue=function(){return this._node[this._property]},e.setValue=function(t){var e=this._propertyBlendState,n=this._host.weight;e.blend(t,n)},L(t,[{key:"node",get:function(){return this._node}},{key:"property",get:function(){return this._property}}]),t}(),wG=function(t){this.blendedWeight=0,this.blendedValue=void 0,this.refCount=0,this.blendedValue=t},PG=function(t){function e(){return t.call(this,new di)||this}F(e,t);var n=e.prototype;return n.blend=function(t,e){var n=this.blendedValue;1===e?di.copy(n,t):di.scaleAndAdd(n,n,t,e),this.blendedWeight+=e},n.reset=function(){this.blendedWeight=0,di.zero(this.blendedValue)},e}(wG),IG=function(t){function e(){return t.call(this,new Ti)||this}F(e,t);var n=e.prototype;return n.blend=function(t,e){if(0!==e){var n=this.blendedValue,i=this.blendedWeight;if(1===e)Ti.copy(n,t);else{var r=e/(i+e);Ti.slerp(n,n,t,r)}this.blendedWeight+=e}},n.reset=function(){this.blendedWeight=0,Ti.identity(this.blendedValue)},e}(wG),RG=function(){function t(){this._properties={}}var e=t.prototype;return e.refProperty=function(t){var e,n,i,r=this._properties;switch(t){default:case"position":case"scale":case"eulerAngles":i=null!==(e=r[t])&&void 0!==e?e:r[t]=new PG;break;case"rotation":i=null!==(n=r[t])&&void 0!==n?n:r[t]=new IG}return++i.refCount,i},e.deRefProperty=function(t){var e=this._properties,n=e[t];n&&(--n.refCount,n.refCount>0||delete e[t])},e.apply=function(t){var e,n,i,r=this._properties,a=r.position,o=r.scale,s=r.rotation,c=r.eulerAngles,l=!1,u=!1,h=!1,f=!1;a&&a.blendedWeight&&(l=!0,a.blendedWeight<1&&a.blend(t.position,1-a.blendedWeight),e=a.blendedValue),o&&o.blendedWeight&&(u=!0,o.blendedWeight<1&&o.blend(t.scale,1-o.blendedWeight),n=o.blendedValue),c&&c.blendedWeight&&(f=!0,c.blendedWeight<1&&c.blend(t.eulerAngles,1-c.blendedWeight),i=c.blendedValue),s&&s.blendedWeight&&(h=!0,s.blendedWeight<1&&s.blend(t.rotation,1-s.blendedWeight),i=s.blendedValue),(i||e||n)&&t.setRTS(i,e,n),l&&a.reset(),u&&o.reset(),h&&s.reset(),f&&c.reset()},L(t,[{key:"empty",get:function(){var t=this._properties;return!(t.position||t.rotation||t.eulerAngles||t.scale)}}]),t}(),DG=[],OG=new Map;function MG(t,e){for(var n=0,i=Ri.IDENTITY;t;){if(t.stamp===e||t.stamp+1===e&&!t.node.hasChangedFlags){i=t.world,t.stamp=e;break}t.stamp=e,DG[n++]=t,t=t.parent}for(;n>0;){t=DG[--n],DG[n]=null;var r=t.node;Ri.fromRTS(t.local,r.rotation,r.position,r.scale),i=Ri.multiply(t.world,i,t.local)}return i}function NG(t){for(var e=OG.get(t.uuid)||null;e;)OG.delete(e.node.uuid),e=e.parent}var LG=t("AnimationManager",nl((EG=AG=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._anims=new Y([]),e._crossFades=new Y([]),e._delayEvents=[],e._blendStateBuffer=new CG,e._sockets=[],e}F(e,t);var n=e.prototype;return n.addCrossFade=function(t){-1===this._crossFades.array.indexOf(t)&&this._crossFades.push(t)},n.removeCrossFade=function(t){var e=this._crossFades.array.indexOf(t);e>=0?this._crossFades.fastRemoveAt(e):b(3907)},n.update=function(t){var e=this._delayEvents,n=this._crossFades,r=this._sockets,a=n.array;for(n.i=0;n.i<a.length;++n.i)a[n.i].update(t);var o=this._anims,s=o.array;for(o.i=0;o.i<s.length;++o.i){var c=s[o.i];c.isMotionless||c.update(t)}this._blendStateBuffer.apply();for(var l=i.director.getTotalFrames(),u=0,h=r.length;u<h;u++){var f=r[u],_=f.target,p=f.transform;_.matrix=MG(p,l)}for(var d=0,m=e.length;d<m;d++){var g=e[d];g.fn.apply(g.thisArg,g.args)}e.length=0},n.destruct=function(){},n.addAnimation=function(t){-1===this._anims.array.indexOf(t)&&this._anims.push(t)},n.removeAnimation=function(t){var e=this._anims.array.indexOf(t);e>=0?this._anims.fastRemoveAt(e):b(3907)},n.pushDelayEvent=function(t,e,n){this._delayEvents.push({fn:t,thisArg:e,args:n})},n.addSockets=function(t,e){for(var n=this,i=function(i){var r=e[i];if(n._sockets.find((function(t){return t.target===r.target})))return"continue";var a=t.getChildByPath(r.path),o=r.target&&a&&function(t,e){for(var n,i=null,r=0;t!==e;){var a=t.uuid;if(OG.has(a)){i=OG.get(a);break}i={node:t,local:new Ri,world:new Ri,stamp:-1,parent:null},OG.set(a,i),DG[r++]=i,t=t.parent,i=null}for(;r>0;)n=DG[--r],DG[r]=null,n.parent=i,i=n;return i}(a,t);o&&n._sockets.push({target:r.target,transform:o})},r=0;r<e.length;++r)i(r)},n.removeSockets=function(t,e){for(var n=0;n<e.length;++n)for(var i=e[n],r=0;r<this._sockets.length;++r){var a=this._sockets[r];if(a.target===i.target){NG(a.transform.node),this._sockets[r]=this._sockets[this._sockets.length-1],this._sockets.length--;break}}},L(e,[{key:"blendState",get:function(){return this._blendStateBuffer}}]),e}(DM),AG.ID="animation",TG=EG))||TG);WM.on(jM.EVENT_INIT,(function(){var t=new LG;WM.registerSystem(LG.ID,t,DM.Priority.HIGH)})),i.AnimationManager=LG;var BG,FG,zG,UG,kG=new Ri;i.easing=e_;var GG=t("HierachyModifier",nl("cc.HierachyModifier")(BG=function(t){function e(){return t.apply(this,arguments)||this}return F(e,t),e}(kF))||BG);i.HierachyModifier=GG;var HG=t("ComponentModifier",nl("cc.ComponentModifier")(FG=function(t){function e(){return t.apply(this,arguments)||this}return F(e,t),e}(GF))||FG);i.ComponentModifier=HG;var VG=t("CurveValueAdapter",nl("cc.CurveValueAdapter")(zG=function(){function t(){}return t.prototype.forTarget=function(){return{set:function(){}}},t}())||zG);i.CurveValueAdapter=VG;var jG=t("UniformCurveValueAdapter",nl("cc.UniformCurveValueAdapter")(UG=function(t){function e(){return t.apply(this,arguments)||this}return F(e,t),e}(HF))||UG);function WG(t){return"string"==typeof t}function XG(t){return"number"==typeof t}function qG(t,e){return t instanceof e}i.UniformCurveValueAdapter=jG,i.isPropertyModifier=WG,i.isElementModifier=XG,i.isCustomTargetModifier=qG,i.math=qi,i.geometry=Op;var YG=t("NodePool",function(){function t(t){this.poolHandlerComp=void 0,this._pool=void 0,this.poolHandlerComp=t,this._pool=[]}var e=t.prototype;return e.size=function(){return this._pool.length},e.clear=function(){for(var t=this._pool.length,e=0;e<t;++e)this._pool[e].destroy();this._pool.length=0},e.put=function(t){if(t&&-1===this._pool.indexOf(t)){t.removeFromParent();var e=this.poolHandlerComp?t.getComponent(this.poolHandlerComp):null;e&&e.unuse&&e.unuse(),this._pool.push(t)}},e.get=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var i=this._pool.length-1;if(i<0)return null;var r=this._pool[i];this._pool.length=i;var a=this.poolHandlerComp?r.getComponent(this.poolHandlerComp):null;return a&&a.reuse&&a.reuse(arguments),r},t}());i.NodePool=YG,i.renderer=sy;var KG,QG=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._gpuDescriptorSet=null,e}F(e,t);var n=e.prototype;return n.initialize=function(t){this._layout=t.layout;var e=t.layout.gpuDescriptorSetLayout,n=e.bindings,i=e.descriptorIndices,r=e.descriptorCount;this._buffers=Array(r).fill(null),this._textures=Array(r).fill(null),this._samplers=Array(r).fill(null);var a=[];this._gpuDescriptorSet={gpuDescriptors:a,descriptorIndices:i};for(var o=0;o<n.length;++o)for(var s=n[o],c=0;c<s.count;c++)a.push({type:s.descriptorType,gpuBuffer:null,gpuTexture:null,gpuSampler:null})},n.destroy=function(){this._layout=null,this._gpuDescriptorSet=null},n.update=function(){if(this._isDirty&&this._gpuDescriptorSet){for(var t=this._gpuDescriptorSet.gpuDescriptors,e=0;e<t.length;++e)if(t[e].type&uo){var n=this._buffers[e];n&&(t[e].gpuBuffer=n.gpuBuffer||n.gpuBufferView)}else t[e].type&ho&&(this._textures[e]&&(t[e].gpuTexture=this._textures[e].gpuTexture),this._samplers[e]&&(t[e].gpuSampler=this._samplers[e].gpuSampler));this._isDirty=!1}},L(e,[{key:"gpuDescriptorSet",get:function(){return this._gpuDescriptorSet}}]),e}(Ro);!function(t){t[t.RGBA16F_EXT=34842]="RGBA16F_EXT",t[t.RGB16F_EXT=34843]="RGB16F_EXT",t[t.RGBA32F_EXT=34836]="RGBA32F_EXT",t[t.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT",t[t.UNSIGNED_NORMALIZED_EXT=35863]="UNSIGNED_NORMALIZED_EXT",t[t.UNSIGNED_INT_24_8_WEBGL=34042]="UNSIGNED_INT_24_8_WEBGL",t[t.HALF_FLOAT_OES=36193]="HALF_FLOAT_OES",t[t.SRGB_EXT=35904]="SRGB_EXT",t[t.SRGB_ALPHA_EXT=35906]="SRGB_ALPHA_EXT",t[t.SRGB8_ALPHA8_EXT=35907]="SRGB8_ALPHA8_EXT",t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",t[t.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",t[t.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",t[t.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR"}(KG||(KG={}));var ZG=function(){function t(){}return t.setInstance=function(e){t._instance=e},L(t,null,[{key:"instance",get:function(){return t._instance}}]),t}();function JG(t,e){switch(t){case Sr.R8:return e.UNSIGNED_BYTE;case Sr.R8SN:return e.BYTE;case Sr.R8UI:return e.UNSIGNED_BYTE;case Sr.R8I:return e.BYTE;case Sr.R16F:return KG.HALF_FLOAT_OES;case Sr.R16UI:return e.UNSIGNED_SHORT;case Sr.R16I:return e.SHORT;case Sr.R32F:return e.FLOAT;case Sr.R32UI:return e.UNSIGNED_INT;case Sr.R32I:return e.INT;case Sr.RG8:return e.UNSIGNED_BYTE;case Sr.RG8SN:return e.BYTE;case Sr.RG8UI:return e.UNSIGNED_BYTE;case Sr.RG8I:return e.BYTE;case Sr.RG16F:return KG.HALF_FLOAT_OES;case Sr.RG16UI:return e.UNSIGNED_SHORT;case Sr.RG16I:return e.SHORT;case Sr.RG32F:return e.FLOAT;case Sr.RG32UI:return e.UNSIGNED_INT;case Sr.RG32I:return e.INT;case Sr.RGB8:case Sr.SRGB8:return e.UNSIGNED_BYTE;case Sr.RGB8SN:return e.BYTE;case Sr.RGB8UI:return e.UNSIGNED_BYTE;case Sr.RGB8I:return e.BYTE;case Sr.RGB16F:return KG.HALF_FLOAT_OES;case Sr.RGB16UI:return e.UNSIGNED_SHORT;case Sr.RGB16I:return e.SHORT;case Sr.RGB32F:return e.FLOAT;case Sr.RGB32UI:return e.UNSIGNED_INT;case Sr.RGB32I:return e.INT;case Sr.BGRA8:case Sr.RGBA8:case Sr.SRGB8_A8:return e.UNSIGNED_BYTE;case Sr.RGBA8SN:return e.BYTE;case Sr.RGBA8UI:return e.UNSIGNED_BYTE;case Sr.RGBA8I:return e.BYTE;case Sr.RGBA16F:return KG.HALF_FLOAT_OES;case Sr.RGBA16UI:return e.UNSIGNED_SHORT;case Sr.RGBA16I:return e.SHORT;case Sr.RGBA32F:return e.FLOAT;case Sr.RGBA32UI:return e.UNSIGNED_INT;case Sr.RGBA32I:return e.INT;case Sr.R5G6B5:return e.UNSIGNED_SHORT_5_6_5;case Sr.R11G11B10F:return e.FLOAT;case Sr.RGB5A1:return e.UNSIGNED_SHORT_5_5_5_1;case Sr.RGBA4:return e.UNSIGNED_SHORT_4_4_4_4;case Sr.RGB10A2:return e.UNSIGNED_BYTE;case Sr.RGB10A2UI:return e.UNSIGNED_INT;case Sr.RGB9E5:return e.UNSIGNED_BYTE;case Sr.DEPTH:return e.UNSIGNED_INT;case Sr.DEPTH_STENCIL:return KG.UNSIGNED_INT_24_8_WEBGL;case Sr.BC1:case Sr.BC1_SRGB:case Sr.BC2:case Sr.BC2_SRGB:case Sr.BC3:case Sr.BC3_SRGB:case Sr.BC4:return e.UNSIGNED_BYTE;case Sr.BC4_SNORM:return e.BYTE;case Sr.BC5:return e.UNSIGNED_BYTE;case Sr.BC5_SNORM:return e.BYTE;case Sr.BC6H_SF16:case Sr.BC6H_UF16:return e.FLOAT;case Sr.BC7:case Sr.BC7_SRGB:case Sr.ETC_RGB8:case Sr.ETC2_RGB8:case Sr.ETC2_SRGB8:case Sr.ETC2_RGB8_A1:case Sr.ETC2_SRGB8_A1:case Sr.EAC_R11:return e.UNSIGNED_BYTE;case Sr.EAC_R11SN:return e.BYTE;case Sr.EAC_RG11:return e.UNSIGNED_BYTE;case Sr.EAC_RG11SN:return e.BYTE;case Sr.PVRTC_RGB2:case Sr.PVRTC_RGBA2:case Sr.PVRTC_RGB4:case Sr.PVRTC_RGBA4:case Sr.PVRTC2_2BPP:case Sr.PVRTC2_4BPP:return e.UNSIGNED_BYTE;case Sr.ASTC_RGBA_4X4:case Sr.ASTC_RGBA_5X4:case Sr.ASTC_RGBA_5X5:case Sr.ASTC_RGBA_6X5:case Sr.ASTC_RGBA_6X6:case Sr.ASTC_RGBA_8X5:case Sr.ASTC_RGBA_8X6:case Sr.ASTC_RGBA_8X8:case Sr.ASTC_RGBA_10X5:case Sr.ASTC_RGBA_10X6:case Sr.ASTC_RGBA_10X8:case Sr.ASTC_RGBA_10X10:case Sr.ASTC_RGBA_12X10:case Sr.ASTC_RGBA_12X12:case Sr.ASTC_SRGBA_4X4:case Sr.ASTC_SRGBA_5X4:case Sr.ASTC_SRGBA_5X5:case Sr.ASTC_SRGBA_6X5:case Sr.ASTC_SRGBA_6X6:case Sr.ASTC_SRGBA_8X5:case Sr.ASTC_SRGBA_8X6:case Sr.ASTC_SRGBA_8X8:case Sr.ASTC_SRGBA_10X5:case Sr.ASTC_SRGBA_10X6:case Sr.ASTC_SRGBA_10X8:case Sr.ASTC_SRGBA_10X10:case Sr.ASTC_SRGBA_12X10:case Sr.ASTC_SRGBA_12X12:default:return e.UNSIGNED_BYTE}}function $G(t,e){switch(t){case Ar.BOOL:return e.BOOL;case Ar.BOOL2:return e.BOOL_VEC2;case Ar.BOOL3:return e.BOOL_VEC3;case Ar.BOOL4:return e.BOOL_VEC4;case Ar.INT:return e.INT;case Ar.INT2:return e.INT_VEC2;case Ar.INT3:return e.INT_VEC3;case Ar.INT4:return e.INT_VEC4;case Ar.UINT:return e.UNSIGNED_INT;case Ar.FLOAT:return e.FLOAT;case Ar.FLOAT2:return e.FLOAT_VEC2;case Ar.FLOAT3:return e.FLOAT_VEC3;case Ar.FLOAT4:return e.FLOAT_VEC4;case Ar.MAT2:return e.FLOAT_MAT2;case Ar.MAT3:return e.FLOAT_MAT3;case Ar.MAT4:return e.FLOAT_MAT4;case Ar.SAMPLER2D:return e.SAMPLER_2D;case Ar.SAMPLER_CUBE:return e.SAMPLER_CUBE;default:return console.error("Unsupported GLType, convert to GL type failed."),Ar.UNKNOWN}}function tH(t){switch(t){case Ar.BOOL:case Ar.BOOL2:case Ar.BOOL3:case Ar.BOOL4:case Ar.INT:case Ar.INT2:case Ar.INT3:case Ar.INT4:case Ar.UINT:return Int32Array;case Ar.FLOAT:case Ar.FLOAT2:case Ar.FLOAT3:case Ar.FLOAT4:case Ar.MAT2:case Ar.MAT3:case Ar.MAT4:return Float32Array;default:return console.error("Unsupported GLType, convert to TypedArrayConstructor failed."),Float32Array}}function eH(t,e){switch(t){case e.BOOL:return Ar.BOOL;case e.BOOL_VEC2:return Ar.BOOL2;case e.BOOL_VEC3:return Ar.BOOL3;case e.BOOL_VEC4:return Ar.BOOL4;case e.INT:return Ar.INT;case e.INT_VEC2:return Ar.INT2;case e.INT_VEC3:return Ar.INT3;case e.INT_VEC4:return Ar.INT4;case e.UNSIGNED_INT:return Ar.UINT;case e.FLOAT:return Ar.FLOAT;case e.FLOAT_VEC2:return Ar.FLOAT2;case e.FLOAT_VEC3:return Ar.FLOAT3;case e.FLOAT_VEC4:return Ar.FLOAT4;case e.FLOAT_MAT2:return Ar.MAT2;case e.FLOAT_MAT3:return Ar.MAT3;case e.FLOAT_MAT4:return Ar.MAT4;case e.SAMPLER_2D:return Ar.SAMPLER2D;case e.SAMPLER_CUBE:return Ar.SAMPLER_CUBE;default:return console.error("Unsupported GLType, convert to Type failed."),Ar.UNKNOWN}}function nH(t,e){switch(t){case e.BOOL:return 4;case e.BOOL_VEC2:return 8;case e.BOOL_VEC3:return 12;case e.BOOL_VEC4:return 16;case e.INT:return 4;case e.INT_VEC2:return 8;case e.INT_VEC3:return 12;case e.INT_VEC4:return 16;case e.UNSIGNED_INT:case e.FLOAT:return 4;case e.FLOAT_VEC2:return 8;case e.FLOAT_VEC3:return 12;case e.FLOAT_VEC4:case e.FLOAT_MAT2:return 16;case e.FLOAT_MAT3:return 36;case e.FLOAT_MAT4:return 64;case e.SAMPLER_2D:case e.SAMPLER_CUBE:return 4;default:return console.error("Unsupported GLType, get type failed."),0}}function iH(t,e){switch(t){case e.FLOAT_MAT2:return 2;case e.FLOAT_MAT3:return 3;case e.FLOAT_MAT4:return 4;default:return 1}}ZG._instance=null;var rH,aH=[512,513,514,515,516,517,518,519],oH=[0,7680,7681,7682,7683,5386,34055,34056],sH=[32774,32778,32779,32775,32776],cH=[0,1,770,772,771,773,768,774,769,775,776,32769,32770,32771,32772];!function(t){t[t.BEGIN_RENDER_PASS=0]="BEGIN_RENDER_PASS",t[t.END_RENDER_PASS=1]="END_RENDER_PASS",t[t.BIND_STATES=2]="BIND_STATES",t[t.DRAW=3]="DRAW",t[t.UPDATE_BUFFER=4]="UPDATE_BUFFER",t[t.COPY_BUFFER_TO_TEXTURE=5]="COPY_BUFFER_TO_TEXTURE",t[t.COUNT=6]="COUNT"}(rH||(rH={}));var lH=function(t){this.cmdType=void 0,this.refCount=0,this.cmdType=t},uH=function(t){function e(){var e;return(e=t.call(this,rH.BEGIN_RENDER_PASS)||this).gpuRenderPass=null,e.gpuFramebuffer=null,e.renderArea=new ua,e.clearFlag=na.NONE,e.clearColors=[],e.clearDepth=1,e.clearStencil=0,e}return F(e,t),e.prototype.clear=function(){this.gpuFramebuffer=null,this.clearColors.length=0},e}(lH),hH=function(t){function e(){var e;return(e=t.call(this,rH.BIND_STATES)||this).gpuPipelineState=null,e.gpuInputAssembler=null,e.gpuDescriptorSets=[],e.dynamicOffsets=[],e.dynamicStates=new so,e}return F(e,t),e.prototype.clear=function(){this.gpuPipelineState=null,this.gpuDescriptorSets.length=0,this.gpuInputAssembler=null,this.dynamicOffsets.length=0},e}(lH),fH=function(t){function e(){var e;return(e=t.call(this,rH.DRAW)||this).drawInfo=new Ea,e}return F(e,t),e.prototype.clear=function(){},e}(lH),_H=function(t){function e(){var e;return(e=t.call(this,rH.UPDATE_BUFFER)||this).gpuBuffer=null,e.buffer=null,e.offset=0,e.size=0,e}return F(e,t),e.prototype.clear=function(){this.gpuBuffer=null,this.buffer=null},e}(lH),pH=function(t){function e(){var e;return(e=t.call(this,rH.COPY_BUFFER_TO_TEXTURE)||this).gpuTexture=null,e.buffers=[],e.regions=[],e}return F(e,t),e.prototype.clear=function(){this.gpuTexture=null,this.buffers.length=0,this.regions.length=0},e}(lH),dH=function(){function t(){this.cmds=new Xt(1),this.beginRenderPassCmds=new Xt(1),this.bindStatesCmds=new Xt(1),this.drawCmds=new Xt(1),this.updateBufferCmds=new Xt(1),this.copyBufferToTextureCmds=new Xt(1)}return t.prototype.clearCmds=function(t){this.beginRenderPassCmds.length&&(t.beginRenderPassCmdPool.freeCmds(this.beginRenderPassCmds),this.beginRenderPassCmds.clear()),this.bindStatesCmds.length&&(t.bindStatesCmdPool.freeCmds(this.bindStatesCmds),this.bindStatesCmds.clear()),this.drawCmds.length&&(t.drawCmdPool.freeCmds(this.drawCmds),this.drawCmds.clear()),this.updateBufferCmds.length&&(t.updateBufferCmdPool.freeCmds(this.updateBufferCmds),this.updateBufferCmds.clear()),this.copyBufferToTextureCmds.length&&(t.copyBufferToTextureCmdPool.freeCmds(this.copyBufferToTextureCmds),this.copyBufferToTextureCmds.clear()),this.cmds.clear()},t}();function mH(t,e,n,i,r){if(e.usage&Er.UNIFORM)ArrayBuffer.isView(n)?e.vf32.set(n,i/Float32Array.BYTES_PER_ELEMENT):e.vf32.set(new Float32Array(n),i/Float32Array.BYTES_PER_ELEMENT);else if(e.usage&Er.INDIRECT){e.indirects.clearDraws();for(var a=n.drawInfos,o=0;o<a.length;++o)e.indirects.setDrawInfo(i+o,a[o])}else{var s=n,c=t.gl,l=t.stateCache;switch(e.glTarget){case c.ARRAY_BUFFER:t.extensions.useVAO&&l.glVAO&&(t.extensions.OES_vertex_array_object.bindVertexArrayOES(null),l.glVAO=null),gH.gpuInputAssembler=null,t.stateCache.glArrayBuffer!==e.glBuffer&&(c.bindBuffer(c.ARRAY_BUFFER,e.glBuffer),t.stateCache.glArrayBuffer=e.glBuffer);break;case c.ELEMENT_ARRAY_BUFFER:t.extensions.useVAO&&l.glVAO&&(t.extensions.OES_vertex_array_object.bindVertexArrayOES(null),l.glVAO=null),gH.gpuInputAssembler=null,t.stateCache.glElementArrayBuffer!==e.glBuffer&&(c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,e.glBuffer),t.stateCache.glElementArrayBuffer=e.glBuffer);break;default:return void console.error("Unsupported BufferType, update buffer failed.")}r===s.byteLength?c.bufferSubData(e.glTarget,i,s):c.bufferSubData(e.glTarget,i,s.slice(0,r))}}var gH={gpuPipelineState:null,gpuInputAssembler:null,glPrimitive:0};function vH(t,e,n,i,r,a,o){var s=t.gl,c=t.stateCache,l=0;if(n&&e){c.glFramebuffer!==n.glFramebuffer&&(s.bindFramebuffer(s.FRAMEBUFFER,n.glFramebuffer),c.glFramebuffer=n.glFramebuffer),c.viewport.left===i.x&&c.viewport.top===i.y&&c.viewport.width===i.width&&c.viewport.height===i.height||(s.viewport(i.x,i.y,i.width,i.height),c.viewport.left=i.x,c.viewport.top=i.y,c.viewport.width=i.width,c.viewport.height=i.height),c.scissorRect.x===i.x&&c.scissorRect.y===i.y&&c.scissorRect.width===i.width&&c.scissorRect.height===i.height||(s.scissor(i.x,i.y,i.width,i.height),c.scissorRect.x=i.x,c.scissorRect.y=i.y,c.scissorRect.width=i.width,c.scissorRect.height=i.height);var u=r.length;t.extensions.WEBGL_draw_buffers||(u=1);for(var h=0;h<u;++h){var f=e.colorAttachments[h];if(f.format!==Sr.UNKNOWN)switch(f.loadOp){case Gr.LOAD:break;case Gr.CLEAR:c.bs.targets[0].blendColorMask!==Ur.ALL&&s.colorMask(!0,!0,!0,!0);var _=r[0];s.clearColor(_.x,_.y,_.z,_.w),l|=s.COLOR_BUFFER_BIT;break;case Gr.DISCARD:}}if(e.depthStencilAttachment&&e.depthStencilAttachment.format!==Sr.UNKNOWN){switch(e.depthStencilAttachment.depthLoadOp){case Gr.LOAD:break;case Gr.CLEAR:c.dss.depthWrite||s.depthMask(!0),s.clearDepth(a),l|=s.DEPTH_BUFFER_BIT;break;case Gr.DISCARD:}if(lo[e.depthStencilAttachment.format].hasStencil)switch(e.depthStencilAttachment.stencilLoadOp){case Gr.LOAD:break;case Gr.CLEAR:c.dss.stencilWriteMaskFront||s.stencilMaskSeparate(s.FRONT,65535),c.dss.stencilWriteMaskBack||s.stencilMaskSeparate(s.BACK,65535),s.clearStencil(o),l|=s.STENCIL_BUFFER_BIT;break;case Gr.DISCARD:}}if(l&&s.clear(l),l&s.COLOR_BUFFER_BIT){var p=c.bs.targets[0].blendColorMask;if(p!==Ur.ALL){var d=(p&Ur.R)!==Ur.NONE,m=(p&Ur.G)!==Ur.NONE,g=(p&Ur.B)!==Ur.NONE,v=(p&Ur.A)!==Ur.NONE;s.colorMask(d,m,g,v)}}l&s.DEPTH_BUFFER_BIT&&!c.dss.depthWrite&&s.depthMask(!1),l&s.STENCIL_BUFFER_BIT&&(c.dss.stencilWriteMaskFront||s.stencilMaskSeparate(s.FRONT,0),c.dss.stencilWriteMaskBack||s.stencilMaskSeparate(s.BACK,0))}}function yH(t,e,n,i,r,a){var o,s,c,l=t.gl,u=t.stateCache,h=e&&e.gpuShader,f=!1;if(e&&gH.gpuPipelineState!==e){if(gH.gpuPipelineState=e,gH.glPrimitive=e.glPrimitive,e.gpuShader){var _=e.gpuShader.glProgram;u.glProgram!==_&&(l.useProgram(_),u.glProgram=_,f=!0)}var p=e.rs;if(p){if(u.rs.cullMode!==p.cullMode){switch(p.cullMode){case Kr.NONE:l.disable(l.CULL_FACE);break;case Kr.FRONT:l.enable(l.CULL_FACE),l.cullFace(l.FRONT);break;case Kr.BACK:l.enable(l.CULL_FACE),l.cullFace(l.BACK)}u.rs.cullMode=p.cullMode}var m=p.isFrontFaceCCW;u.rs.isFrontFaceCCW!==m&&(l.frontFace(m?l.CCW:l.CW),u.rs.isFrontFaceCCW=m),u.rs.depthBias===p.depthBias&&u.rs.depthBiasSlop===p.depthBiasSlop||(l.polygonOffset(p.depthBias,p.depthBiasSlop),u.rs.depthBias=p.depthBias,u.rs.depthBiasSlop=p.depthBiasSlop),u.rs.lineWidth!==p.lineWidth&&(l.lineWidth(p.lineWidth),u.rs.lineWidth=p.lineWidth)}var g=e.dss;g&&(u.dss.depthTest!==g.depthTest&&(g.depthTest?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),u.dss.depthTest=g.depthTest),u.dss.depthWrite!==g.depthWrite&&(l.depthMask(g.depthWrite),u.dss.depthWrite=g.depthWrite),u.dss.depthFunc!==g.depthFunc&&(l.depthFunc(aH[g.depthFunc]),u.dss.depthFunc=g.depthFunc),u.dss.stencilTestFront===g.stencilTestFront&&u.dss.stencilTestBack===g.stencilTestBack||(g.stencilTestFront||g.stencilTestBack?l.enable(l.STENCIL_TEST):l.disable(l.STENCIL_TEST),u.dss.stencilTestFront=g.stencilTestFront,u.dss.stencilTestBack=g.stencilTestBack),u.dss.stencilFuncFront===g.stencilFuncFront&&u.dss.stencilRefFront===g.stencilRefFront&&u.dss.stencilReadMaskFront===g.stencilReadMaskFront||(l.stencilFuncSeparate(l.FRONT,aH[g.stencilFuncFront],g.stencilRefFront,g.stencilReadMaskFront),u.dss.stencilFuncFront=g.stencilFuncFront,u.dss.stencilRefFront=g.stencilRefFront,u.dss.stencilReadMaskFront=g.stencilReadMaskFront),u.dss.stencilFailOpFront===g.stencilFailOpFront&&u.dss.stencilZFailOpFront===g.stencilZFailOpFront&&u.dss.stencilPassOpFront===g.stencilPassOpFront||(l.stencilOpSeparate(l.FRONT,oH[g.stencilFailOpFront],oH[g.stencilZFailOpFront],oH[g.stencilPassOpFront]),u.dss.stencilFailOpFront=g.stencilFailOpFront,u.dss.stencilZFailOpFront=g.stencilZFailOpFront,u.dss.stencilPassOpFront=g.stencilPassOpFront),u.dss.stencilWriteMaskFront!==g.stencilWriteMaskFront&&(l.stencilMaskSeparate(l.FRONT,g.stencilWriteMaskFront),u.dss.stencilWriteMaskFront=g.stencilWriteMaskFront),u.dss.stencilFuncBack===g.stencilFuncBack&&u.dss.stencilRefBack===g.stencilRefBack&&u.dss.stencilReadMaskBack===g.stencilReadMaskBack||(l.stencilFuncSeparate(l.BACK,aH[g.stencilFuncBack],g.stencilRefBack,g.stencilReadMaskBack),u.dss.stencilFuncBack=g.stencilFuncBack,u.dss.stencilRefBack=g.stencilRefBack,u.dss.stencilReadMaskBack=g.stencilReadMaskBack),u.dss.stencilFailOpBack===g.stencilFailOpBack&&u.dss.stencilZFailOpBack===g.stencilZFailOpBack&&u.dss.stencilPassOpBack===g.stencilPassOpBack||(l.stencilOpSeparate(l.BACK,oH[g.stencilFailOpBack],oH[g.stencilZFailOpBack],oH[g.stencilPassOpBack]),u.dss.stencilFailOpBack=g.stencilFailOpBack,u.dss.stencilZFailOpBack=g.stencilZFailOpBack,u.dss.stencilPassOpBack=g.stencilPassOpBack),u.dss.stencilWriteMaskBack!==g.stencilWriteMaskBack&&(l.stencilMaskSeparate(l.BACK,g.stencilWriteMaskBack),u.dss.stencilWriteMaskBack=g.stencilWriteMaskBack));var v=e.bs;if(v){u.bs.isA2C!==v.isA2C&&(v.isA2C?l.enable(l.SAMPLE_ALPHA_TO_COVERAGE):l.disable(l.SAMPLE_ALPHA_TO_COVERAGE),u.bs.isA2C=v.isA2C),u.bs.blendColor.x===v.blendColor.x&&u.bs.blendColor.y===v.blendColor.y&&u.bs.blendColor.z===v.blendColor.z&&u.bs.blendColor.w===v.blendColor.w||(l.blendColor(v.blendColor.x,v.blendColor.y,v.blendColor.z,v.blendColor.w),u.bs.blendColor.x=v.blendColor.x,u.bs.blendColor.y=v.blendColor.y,u.bs.blendColor.z=v.blendColor.z,u.bs.blendColor.w=v.blendColor.w);var y=v.targets[0],x=u.bs.targets[0];x.blend!==y.blend&&(y.blend?l.enable(l.BLEND):l.disable(l.BLEND),x.blend=y.blend),x.blendEq===y.blendEq&&x.blendAlphaEq===y.blendAlphaEq||(l.blendEquationSeparate(sH[y.blendEq],sH[y.blendAlphaEq]),x.blendEq=y.blendEq,x.blendAlphaEq=y.blendAlphaEq),x.blendSrc===y.blendSrc&&x.blendDst===y.blendDst&&x.blendSrcAlpha===y.blendSrcAlpha&&x.blendDstAlpha===y.blendDstAlpha||(l.blendFuncSeparate(cH[y.blendSrc],cH[y.blendDst],cH[y.blendSrcAlpha],cH[y.blendDstAlpha]),x.blendSrc=y.blendSrc,x.blendDst=y.blendDst,x.blendSrcAlpha=y.blendSrcAlpha,x.blendDstAlpha=y.blendDstAlpha),x.blendColorMask!==y.blendColorMask&&(l.colorMask((y.blendColorMask&Ur.R)!==Ur.NONE,(y.blendColorMask&Ur.G)!==Ur.NONE,(y.blendColorMask&Ur.B)!==Ur.NONE,(y.blendColorMask&Ur.A)!==Ur.NONE),x.blendColorMask=y.blendColorMask)}}if(e&&e.gpuPipelineLayout&&h){for(var S=h.glBlocks.length,T=e.gpuPipelineLayout.dynamicOffsetIndices,A=0;A<S;A++){var E=h.glBlocks[A],C=i[E.set],b=C&&C.descriptorIndices[E.binding],w=b>=0&&C.gpuDescriptors[b],P=null,I=0;if(w&&w.gpuBuffer){var R=w.gpuBuffer,D=T[E.set],O=D&&D[E.binding];O>=0&&(I=r[O]),"vf32"in R?P=R.vf32:(I+=R.offset,P=R.gpuBuffer.vf32),I>>=2}if(P)for(var M=E.glActiveUniforms.length,N=0;N<M;N++){var L=E.glActiveUniforms[N];switch(L.glType){case l.BOOL:case l.INT:for(var B=0;B<L.array.length;++B){var F=L.offset+I+B;if(P[F]!==L.array[B]){for(var z=B,U=F;z<L.array.length;++z,++U)L.array[z]=P[U];l.uniform1iv(L.glLoc,L.array);break}}break;case l.BOOL_VEC2:case l.INT_VEC2:for(var k=0;k<L.array.length;++k){var G=L.offset+I+k;if(P[G]!==L.array[k]){for(var H=k,V=G;H<L.array.length;++H,++V)L.array[H]=P[V];l.uniform2iv(L.glLoc,L.array);break}}break;case l.BOOL_VEC3:case l.INT_VEC3:for(var j=0;j<L.array.length;++j){var W=L.offset+I+j;if(P[W]!==L.array[j]){for(var X=j,q=W;X<L.array.length;++X,++q)L.array[X]=P[q];l.uniform3iv(L.glLoc,L.array);break}}break;case l.BOOL_VEC4:case l.INT_VEC4:for(var Y=0;Y<L.array.length;++Y){var K=L.offset+I+Y;if(P[K]!==L.array[Y]){for(var Q=Y,Z=K;Q<L.array.length;++Q,++Z)L.array[Q]=P[Z];l.uniform4iv(L.glLoc,L.array);break}}break;case l.FLOAT:for(var J=0;J<L.array.length;++J){var $=L.offset+I+J;if(P[$]!==L.array[J]){for(var tt=J,et=$;tt<L.array.length;++tt,++et)L.array[tt]=P[et];l.uniform1fv(L.glLoc,L.array);break}}break;case l.FLOAT_VEC2:for(var nt=0;nt<L.array.length;++nt){var it=L.offset+I+nt;if(P[it]!==L.array[nt]){for(var rt=nt,at=it;rt<L.array.length;++rt,++at)L.array[rt]=P[at];l.uniform2fv(L.glLoc,L.array);break}}break;case l.FLOAT_VEC3:for(var ot=0;ot<L.array.length;++ot){var st=L.offset+I+ot;if(P[st]!==L.array[ot]){for(var ct=ot,lt=st;ct<L.array.length;++ct,++lt)L.array[ct]=P[lt];l.uniform3fv(L.glLoc,L.array);break}}break;case l.FLOAT_VEC4:for(var ut=0;ut<L.array.length;++ut){var ht=L.offset+I+ut;if(P[ht]!==L.array[ut]){for(var ft=ut,_t=ht;ft<L.array.length;++ft,++_t)L.array[ft]=P[_t];l.uniform4fv(L.glLoc,L.array);break}}break;case l.FLOAT_MAT2:for(var pt=0;pt<L.array.length;++pt){var dt=L.offset+I+pt;if(P[dt]!==L.array[pt]){for(var mt=pt,gt=dt;mt<L.array.length;++mt,++gt)L.array[mt]=P[gt];l.uniformMatrix2fv(L.glLoc,!1,L.array);break}}break;case l.FLOAT_MAT3:for(var vt=0;vt<L.array.length;++vt){var yt=L.offset+I+vt;if(P[yt]!==L.array[vt]){for(var xt=vt,St=yt;xt<L.array.length;++xt,++St)L.array[xt]=P[St];l.uniformMatrix3fv(L.glLoc,!1,L.array);break}}break;case l.FLOAT_MAT4:for(var Tt=0;Tt<L.array.length;++Tt){var At=L.offset+I+Tt;if(P[At]!==L.array[Tt]){for(var Et=Tt,Ct=At;Et<L.array.length;++Et,++Ct)L.array[Et]=P[Ct];l.uniformMatrix4fv(L.glLoc,!1,L.array);break}}}}else d("Buffer binding '"+E.name+"' at set "+E.set+" binding "+E.binding+" is not bounded")}for(var bt=h.glSamplerTextures.length,wt=0;wt<bt;wt++)for(var Pt=h.glSamplerTextures[wt],It=i[Pt.set],Rt=It&&It.descriptorIndices[Pt.binding],Dt=Rt>=0&&It.gpuDescriptors[Rt],Ot=Pt.units.length,Mt=0;Mt<Ot;Mt++){var Nt=Pt.units[Mt];if(Dt&&Dt.gpuSampler){if(Dt.gpuTexture&&Dt.gpuTexture.size>0){var Lt=Dt.gpuTexture,Bt=u.glTexUnits[Nt];Bt.glTexture!==Lt.glTexture&&(u.texUnit!==Nt&&(l.activeTexture(l.TEXTURE0+Nt),u.texUnit=Nt),Lt.glTexture?l.bindTexture(Lt.glTarget,Lt.glTexture):l.bindTexture(Lt.glTarget,t.nullTex2D.gpuTexture.glTexture),Bt.glTexture=Lt.glTexture);var Ft=Dt.gpuSampler;Lt.isPowerOf2?(o=Ft.glWrapS,s=Ft.glWrapT):(o=l.CLAMP_TO_EDGE,s=l.CLAMP_TO_EDGE),c=Lt.isPowerOf2?Lt.mipLevel<=1&&(Ft.glMinFilter===l.LINEAR_MIPMAP_NEAREST||Ft.glMinFilter===l.LINEAR_MIPMAP_LINEAR)?l.LINEAR:Ft.glMinFilter:Ft.glMinFilter===l.LINEAR||Ft.glMinFilter===l.LINEAR_MIPMAP_NEAREST||Ft.glMinFilter===l.LINEAR_MIPMAP_LINEAR?l.LINEAR:l.NEAREST,Lt.glWrapS!==o&&(u.texUnit!==Nt&&(l.activeTexture(l.TEXTURE0+Nt),u.texUnit=Nt),l.texParameteri(Lt.glTarget,l.TEXTURE_WRAP_S,o),Lt.glWrapS=o),Lt.glWrapT!==s&&(u.texUnit!==Nt&&(l.activeTexture(l.TEXTURE0+Nt),u.texUnit=Nt),l.texParameteri(Lt.glTarget,l.TEXTURE_WRAP_T,s),Lt.glWrapT=s),Lt.glMinFilter!==c&&(u.texUnit!==Nt&&(l.activeTexture(l.TEXTURE0+Nt),u.texUnit=Nt),l.texParameteri(Lt.glTarget,l.TEXTURE_MIN_FILTER,c),Lt.glMinFilter=c),Lt.glMagFilter!==Ft.glMagFilter&&(u.texUnit!==Nt&&(l.activeTexture(l.TEXTURE0+Nt),u.texUnit=Nt),l.texParameteri(Lt.glTarget,l.TEXTURE_MAG_FILTER,Ft.glMagFilter),Lt.glMagFilter=Ft.glMagFilter)}Dt=It.gpuDescriptors[++Rt]}else d("Sampler binding '"+Pt.name+"' at set "+Pt.set+" binding "+Pt.binding+" index "+Mt+" is not bounded")}}if(n&&h&&(f||gH.gpuInputAssembler!==n)){gH.gpuInputAssembler=n;var zt=t.extensions.ANGLE_instanced_arrays;if(t.extensions.useVAO){var Ut=t.extensions.OES_vertex_array_object,kt=n.glVAOs.get(h.glProgram);if(!kt){var Gt;kt=Ut.createVertexArrayOES(),n.glVAOs.set(h.glProgram,kt),Ut.bindVertexArrayOES(kt),l.bindBuffer(l.ARRAY_BUFFER,null),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,null),u.glArrayBuffer=null,u.glElementArrayBuffer=null;for(var Ht=h.glInputs.length,Vt=0;Vt<Ht;Vt++){var jt=h.glInputs[Vt];Gt=null;for(var Wt=n.glAttribs.length,Xt=0;Xt<Wt;Xt++){var qt=n.glAttribs[Xt];if(qt.name===jt.name){Gt=qt;break}}if(Gt){u.glArrayBuffer!==Gt.glBuffer&&(l.bindBuffer(l.ARRAY_BUFFER,Gt.glBuffer),u.glArrayBuffer=Gt.glBuffer);for(var Yt=0;Yt<Gt.componentCount;++Yt){var Kt=jt.glLoc+Yt,Qt=Gt.offset+Gt.size*Yt;l.enableVertexAttribArray(Kt),u.glCurrentAttribLocs[Kt]=!0,l.vertexAttribPointer(Kt,Gt.count,Gt.glType,Gt.isNormalized,Gt.stride,Qt),zt&&zt.vertexAttribDivisorANGLE(Kt,Gt.isInstanced?1:0)}}}var Zt=n.gpuIndexBuffer;Zt&&l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,Zt.glBuffer),Ut.bindVertexArrayOES(null),l.bindBuffer(l.ARRAY_BUFFER,null),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,null),u.glArrayBuffer=null,u.glElementArrayBuffer=null}u.glVAO!==kt&&(Ut.bindVertexArrayOES(kt),u.glVAO=kt)}else{for(var Jt=0;Jt<t.capabilities.maxVertexAttributes;++Jt)u.glCurrentAttribLocs[Jt]=!1;for(var $t=h.glInputs.length,te=0;te<$t;te++){for(var ee=h.glInputs[te],ne=null,ie=n.glAttribs.length,re=0;re<ie;re++){var ae=n.glAttribs[re];if(ae.name===ee.name){ne=ae;break}}if(ne){u.glArrayBuffer!==ne.glBuffer&&(l.bindBuffer(l.ARRAY_BUFFER,ne.glBuffer),u.glArrayBuffer=ne.glBuffer);for(var oe=0;oe<ne.componentCount;++oe){var se=ee.glLoc+oe,ce=ne.offset+ne.size*oe;!u.glEnabledAttribLocs[se]&&se>=0&&(l.enableVertexAttribArray(se),u.glEnabledAttribLocs[se]=!0),u.glCurrentAttribLocs[se]=!0,l.vertexAttribPointer(se,ne.count,ne.glType,ne.isNormalized,ne.stride,ce),zt&&zt.vertexAttribDivisorANGLE(se,ne.isInstanced?1:0)}}}var le=n.gpuIndexBuffer;le&&u.glElementArrayBuffer!==le.glBuffer&&(l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,le.glBuffer),u.glElementArrayBuffer=le.glBuffer);for(var ue=0;ue<t.capabilities.maxVertexAttributes;++ue)u.glEnabledAttribLocs[ue]!==u.glCurrentAttribLocs[ue]&&(l.disableVertexAttribArray(ue),u.glEnabledAttribLocs[ue]=!1)}}if(e&&e.dynamicStates.length)for(var he=e.dynamicStates.length,fe=0;fe<he;fe++)switch(e.dynamicStates[fe]){case Qr.LINE_WIDTH:u.rs.lineWidth!==a.lineWidth&&(l.lineWidth(a.lineWidth),u.rs.lineWidth=a.lineWidth);break;case Qr.DEPTH_BIAS:u.rs.depthBias===a.depthBiasConstant&&u.rs.depthBiasSlop===a.depthBiasSlope||(l.polygonOffset(a.depthBiasConstant,a.depthBiasSlope),u.rs.depthBias=a.depthBiasConstant,u.rs.depthBiasSlop=a.depthBiasSlope);break;case Qr.BLEND_CONSTANTS:var _e=a.blendConstant;u.bs.blendColor.x===_e.x&&u.bs.blendColor.y===_e.y&&u.bs.blendColor.z===_e.z&&u.bs.blendColor.w===_e.w||(l.blendColor(_e.x,_e.y,_e.z,_e.w),u.bs.blendColor.copy(_e));break;case Qr.STENCIL_WRITE_MASK:var pe=a.stencilStatesFront,de=a.stencilStatesBack;u.dss.stencilWriteMaskFront!==pe.writeMask&&(l.stencilMaskSeparate(l.FRONT,pe.writeMask),u.dss.stencilWriteMaskFront=pe.writeMask),u.dss.stencilWriteMaskBack!==de.writeMask&&(l.stencilMaskSeparate(l.BACK,de.writeMask),u.dss.stencilWriteMaskBack=de.writeMask);break;case Qr.STENCIL_COMPARE_MASK:var me=a.stencilStatesFront,ge=a.stencilStatesBack;u.dss.stencilRefFront===me.reference&&u.dss.stencilReadMaskFront===me.compareMask||(l.stencilFuncSeparate(l.FRONT,aH[u.dss.stencilFuncFront],me.reference,me.compareMask),u.dss.stencilRefFront=me.reference,u.dss.stencilReadMaskFront=me.compareMask),u.dss.stencilRefBack===ge.reference&&u.dss.stencilReadMaskBack===ge.compareMask||(l.stencilFuncSeparate(l.BACK,aH[u.dss.stencilFuncBack],ge.reference,ge.compareMask),u.dss.stencilRefBack=ge.reference,u.dss.stencilReadMaskBack=ge.compareMask)}}function xH(t,e){var n=t.gl,i=t.extensions,r=i.ANGLE_instanced_arrays,a=i.WEBGL_multi_draw,o=gH.gpuInputAssembler,s=gH.glPrimitive;if(o){var c=o.gpuIndexBuffer;if(o.gpuIndirectBuffer){var l=o.gpuIndirectBuffer.indirects;if(l.drawByIndex){for(var u=0;u<l.drawCount;u++)l.byteOffsets[u]=l.offsets[u]*c.stride;if(a)l.instancedDraw?a.multiDrawElementsInstancedWEBGL(s,l.counts,0,o.glIndexType,l.byteOffsets,0,l.instances,0,l.drawCount):a.multiDrawElementsWEBGL(s,l.counts,0,o.glIndexType,l.byteOffsets,0,l.drawCount);else for(var h=0;h<l.drawCount;h++)l.instances[h]&&r?r.drawElementsInstancedANGLE(s,l.counts[h],o.glIndexType,l.byteOffsets[h],l.instances[h]):n.drawElements(s,l.counts[h],o.glIndexType,l.byteOffsets[h])}else if(a)l.instancedDraw?a.multiDrawArraysInstancedWEBGL(s,l.offsets,0,l.counts,0,l.instances,0,l.drawCount):a.multiDrawArraysWEBGL(s,l.offsets,0,l.counts,0,l.drawCount);else for(var f=0;f<l.drawCount;f++)l.instances[f]&&r?r.drawArraysInstancedANGLE(s,l.offsets[f],l.counts[f],l.instances[f]):n.drawArrays(s,l.offsets[f],l.counts[f])}else if(e.instanceCount&&r)if(c){if(e.indexCount>0){var _=e.firstIndex*c.stride;r.drawElementsInstancedANGLE(s,e.indexCount,o.glIndexType,_,e.instanceCount)}}else e.vertexCount>0&&r.drawArraysInstancedANGLE(s,e.firstVertex,e.vertexCount,e.instanceCount);else if(c){if(e.indexCount>0){var p=e.firstIndex*c.stride;n.drawElements(s,e.indexCount,o.glIndexType,p)}}else e.vertexCount>0&&n.drawArrays(s,e.firstVertex,e.vertexCount)}}var SH=new Array(rH.COUNT);function TH(t,e){SH.fill(0);for(var n=0;n<e.cmds.length;++n){var i=e.cmds.array[n],r=SH[i]++;switch(i){case rH.BEGIN_RENDER_PASS:var a=e.beginRenderPassCmds.array[r];vH(t,a.gpuRenderPass,a.gpuFramebuffer,a.renderArea,a.clearColors,a.clearDepth,a.clearStencil);break;case rH.BIND_STATES:var o=e.bindStatesCmds.array[r];yH(t,o.gpuPipelineState,o.gpuInputAssembler,o.gpuDescriptorSets,o.dynamicOffsets,o.dynamicStates);break;case rH.DRAW:xH(t,e.drawCmds.array[r].drawInfo);break;case rH.UPDATE_BUFFER:var s=e.updateBufferCmds.array[r];mH(t,s.gpuBuffer,s.buffer,s.offset,s.size);break;case rH.COPY_BUFFER_TO_TEXTURE:var c=e.copyBufferToTextureCmds.array[r];AH(t,c.buffers,c.gpuTexture,c.regions)}}}function AH(t,e,n,i){var r=t.gl,a=t.stateCache.glTexUnits[t.stateCache.texUnit];a.glTexture!==n.glTexture&&(r.bindTexture(n.glTarget,n.glTexture),a.glTexture=n.glTexture);var o=0,s=1,c=1,l=0,u=lo[n.format].isCompressed;switch(n.glTarget){case r.TEXTURE_2D:for(var h=0;h<i.length;h++){var f=i[h];s=f.texExtent.width,c=f.texExtent.height;var _=e[o++];u?n.glInternalFmt===KG.COMPRESSED_RGB_ETC1_WEBGL||t.extensions.noCompressedTexSubImage2D?r.compressedTexImage2D(r.TEXTURE_2D,f.texSubres.mipLevel,n.glInternalFmt,s,c,0,_):r.compressedTexSubImage2D(r.TEXTURE_2D,f.texSubres.mipLevel,f.texOffset.x,f.texOffset.y,s,c,n.glFormat,_):r.texSubImage2D(r.TEXTURE_2D,f.texSubres.mipLevel,f.texOffset.x,f.texOffset.y,s,c,n.glFormat,n.glType,_)}break;case r.TEXTURE_CUBE_MAP:for(var p=0;p<i.length;p++){var d=i[p],m=d.texSubres.baseArrayLayer+d.texSubres.layerCount;for(l=d.texSubres.baseArrayLayer;l<m;++l){s=d.texExtent.width,c=d.texExtent.height;var g=e[o++];u?n.glInternalFmt===KG.COMPRESSED_RGB_ETC1_WEBGL||t.extensions.noCompressedTexSubImage2D?r.compressedTexImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+l,d.texSubres.mipLevel,n.glInternalFmt,s,c,0,g):r.compressedTexSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+l,d.texSubres.mipLevel,d.texOffset.x,d.texOffset.y,s,c,n.glFormat,g):r.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+l,d.texSubres.mipLevel,d.texOffset.x,d.texOffset.y,s,c,n.glFormat,n.glType,g)}}break;default:console.error("Unsupported GL texture type, copy buffer to texture failed.")}n.flags&Rr.GEN_MIPMAP&&r.generateMipmap(n.glTarget)}var EH=function(){function t(){this.counts=void 0,this.offsets=void 0,this.instances=void 0,this.drawCount=0,this.drawByIndex=!1,this.instancedDraw=!1,this.byteOffsets=void 0,this._capacity=4,this.counts=new Int32Array(this._capacity),this.offsets=new Int32Array(this._capacity),this.instances=new Int32Array(this._capacity),this.byteOffsets=new Int32Array(this._capacity)}var e=t.prototype;return e.clearDraws=function(){this.drawCount=0,this.drawByIndex=!1,this.instancedDraw=!1},e.setDrawInfo=function(t,e){this._ensureCapacity(t),this.drawByIndex=e.indexCount>0,this.instancedDraw=!!e.instanceCount,this.drawCount=Math.max(t+1,this.drawCount),this.drawByIndex?(this.counts[t]=e.indexCount,this.offsets[t]=e.firstIndex):(this.counts[t]=e.vertexCount,this.offsets[t]=e.firstVertex),this.instances[t]=Math.max(1,e.instanceCount)},e._ensureCapacity=function(t){if(!(this._capacity>t)){this._capacity=Dn(t);var e=new Int32Array(this._capacity),n=new Int32Array(this._capacity),i=new Int32Array(this._capacity);this.byteOffsets=new Int32Array(this._capacity),e.set(this.counts),n.set(this.offsets),i.set(this.instances),this.counts=e,this.offsets=n,this.instances=i}},t}(),CH=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._gpuBuffer=null,e._gpuBufferView=null,e._uniformBuffer=null,e}F(e,t);var n=e.prototype;return n.initialize=function(t){if("buffer"in t){this._isBufferView=!0;var e=t.buffer;this._usage=e.usage,this._memUsage=e.memUsage,this._size=this._stride=t.range,this._count=1,this._flags=e.flags,this._gpuBufferView={gpuBuffer:e.gpuBuffer,offset:t.offset,range:t.range}}else this._usage=t.usage,this._memUsage=t.memUsage,this._size=t.size,this._stride=Math.max(t.stride||this._size,1),this._count=this._size/this._stride,this._flags=t.flags,this._usage&Er.UNIFORM&&this._size>0&&(this._uniformBuffer=new Uint8Array(this._size)),this._gpuBuffer={usage:this._usage,memUsage:this._memUsage,size:this._size,stride:this._stride,buffer:null,vf32:null,indirects:new EH,glTarget:0,glBuffer:null},this._usage&Er.UNIFORM&&(this._gpuBuffer.buffer=this._uniformBuffer),function(t,e){var n=t.gl,i=t.stateCache,r=e.memUsage&wr.HOST?n.DYNAMIC_DRAW:n.STATIC_DRAW;if(e.usage&Er.VERTEX){e.glTarget=n.ARRAY_BUFFER;var a=n.createBuffer();a&&(e.glBuffer=a,e.size>0&&(t.extensions.useVAO&&i.glVAO&&(t.extensions.OES_vertex_array_object.bindVertexArrayOES(null),i.glVAO=null),gH.gpuInputAssembler=null,t.stateCache.glArrayBuffer!==e.glBuffer&&(n.bindBuffer(n.ARRAY_BUFFER,e.glBuffer),t.stateCache.glArrayBuffer=e.glBuffer),n.bufferData(n.ARRAY_BUFFER,e.size,r),n.bindBuffer(n.ARRAY_BUFFER,null),t.stateCache.glArrayBuffer=null))}else if(e.usage&Er.INDEX){e.glTarget=n.ELEMENT_ARRAY_BUFFER;var o=n.createBuffer();o&&(e.glBuffer=o,e.size>0&&(t.extensions.useVAO&&i.glVAO&&(t.extensions.OES_vertex_array_object.bindVertexArrayOES(null),i.glVAO=null),gH.gpuInputAssembler=null,t.stateCache.glElementArrayBuffer!==e.glBuffer&&(n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e.glBuffer),t.stateCache.glElementArrayBuffer=e.glBuffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,e.size,r),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null),t.stateCache.glElementArrayBuffer=null))}else e.usage&Er.UNIFORM?(e.glTarget=n.NONE,e.buffer&&(e.vf32=new Float32Array(e.buffer.buffer))):(e.usage&Er.INDIRECT||e.usage&Er.TRANSFER_DST||e.usage&Er.TRANSFER_SRC||console.error("Unsupported BufferType, create buffer failed."),e.glTarget=n.NONE)}(ZG.instance,this._gpuBuffer),ZG.instance.memoryStatus.bufferSize+=this._size},n.destroy=function(){this._gpuBuffer&&(function(t,e){var n=t.gl,i=t.stateCache;if(e.glBuffer){switch(e.glTarget){case n.ARRAY_BUFFER:t.extensions.useVAO&&i.glVAO&&(t.extensions.OES_vertex_array_object.bindVertexArrayOES(null),t.stateCache.glVAO=null),gH.gpuInputAssembler=null,n.bindBuffer(n.ARRAY_BUFFER,null),t.stateCache.glArrayBuffer=null;break;case n.ELEMENT_ARRAY_BUFFER:t.extensions.useVAO&&i.glVAO&&(t.extensions.OES_vertex_array_object.bindVertexArrayOES(null),t.stateCache.glVAO=null),gH.gpuInputAssembler=null,n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null),t.stateCache.glElementArrayBuffer=null}n.deleteBuffer(e.glBuffer),e.glBuffer=null}}(ZG.instance,this._gpuBuffer),ZG.instance.memoryStatus.bufferSize-=this._size,this._gpuBuffer=null),this._gpuBufferView&&(this._gpuBufferView=null)},n.resize=function(t){if(this._isBufferView)console.warn("cannot resize buffer views!");else{var e=this._size;e!==t&&(this._size=t,this._count=this._size/this._stride,this._uniformBuffer&&(this._uniformBuffer=new Uint8Array(t)),this._gpuBuffer&&(this._uniformBuffer&&(this._gpuBuffer.buffer=this._uniformBuffer),this._gpuBuffer.size=t,t>0&&(function(t,e){var n=t.gl,i=t.stateCache,r=e.memUsage&wr.HOST?n.DYNAMIC_DRAW:n.STATIC_DRAW;e.usage&Er.VERTEX?(t.extensions.useVAO&&i.glVAO&&(t.extensions.OES_vertex_array_object.bindVertexArrayOES(null),i.glVAO=null),gH.gpuInputAssembler=null,t.stateCache.glArrayBuffer!==e.glBuffer&&n.bindBuffer(n.ARRAY_BUFFER,e.glBuffer),e.buffer?n.bufferData(n.ARRAY_BUFFER,e.buffer,r):n.bufferData(n.ARRAY_BUFFER,e.size,r),n.bindBuffer(n.ARRAY_BUFFER,null),t.stateCache.glArrayBuffer=null):e.usage&Er.INDEX?(t.extensions.useVAO&&i.glVAO&&(t.extensions.OES_vertex_array_object.bindVertexArrayOES(null),i.glVAO=null),gH.gpuInputAssembler=null,t.stateCache.glElementArrayBuffer!==e.glBuffer&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e.glBuffer),e.buffer?n.bufferData(n.ELEMENT_ARRAY_BUFFER,e.buffer,r):n.bufferData(n.ELEMENT_ARRAY_BUFFER,e.size,r),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null),t.stateCache.glElementArrayBuffer=null):e.usage&Er.UNIFORM?e.buffer&&(e.vf32=new Float32Array(e.buffer.buffer)):(e.usage&Er.INDIRECT||e.usage&Er.TRANSFER_DST||e.usage&Er.TRANSFER_SRC||console.error("Unsupported BufferType, create buffer failed."),e.glTarget=n.NONE)}(ZG.instance,this._gpuBuffer),ZG.instance.memoryStatus.bufferSize-=e,ZG.instance.memoryStatus.bufferSize+=t)))}},n.update=function(t,e){var n;this._isBufferView?console.warn("cannot update through buffer views!"):(n=void 0!==e?e:this._usage&Er.INDIRECT?0:t.byteLength,mH(ZG.instance,this._gpuBuffer,t,0,n))},L(e,[{key:"gpuBuffer",get:function(){return this._gpuBuffer}},{key:"gpuBufferView",get:function(){return this._gpuBufferView}}]),e}(So),bH=function(){function t(t,e){this._frees=void 0,this._freeIdx=0,this._freeCmds=void 0,this._frees=new Array(e),this._freeCmds=new Xt(e);for(var n=0;n<e;++n)this._frees[n]=new t;this._freeIdx=e-1}var e=t.prototype;return e.alloc=function(t){if(this._freeIdx<0){var e=2*this._frees.length,n=this._frees;this._frees=new Array(e);for(var i=e-n.length,r=0;r<i;++r)this._frees[r]=new t;for(var a=i,o=0;a<e;++a,++o)this._frees[a]=n[o];this._freeIdx+=i}var s=this._frees[this._freeIdx];return this._frees[this._freeIdx--]=null,++s.refCount,s},e.free=function(t){0==--t.refCount&&this._freeCmds.push(t)},e.freeCmds=function(t){for(var e=0;e<t.length;++e)0==--t.array[e].refCount&&this._freeCmds.push(t.array[e])},e.release=function(){for(var t=0;t<this._freeCmds.length;++t){var e=this._freeCmds.array[t];e.clear(),this._frees[++this._freeIdx]=e}this._freeCmds.clear()},t}(),wH=function(){function t(){this.beginRenderPassCmdPool=void 0,this.bindStatesCmdPool=void 0,this.drawCmdPool=void 0,this.updateBufferCmdPool=void 0,this.copyBufferToTextureCmdPool=void 0,this.beginRenderPassCmdPool=new bH(uH,1),this.bindStatesCmdPool=new bH(hH,1),this.drawCmdPool=new bH(fH,1),this.updateBufferCmdPool=new bH(_H,1),this.copyBufferToTextureCmdPool=new bH(pH,1)}var e=t.prototype;return e.clearCmds=function(t){t.beginRenderPassCmds.length&&(this.beginRenderPassCmdPool.freeCmds(t.beginRenderPassCmds),t.beginRenderPassCmds.clear()),t.bindStatesCmds.length&&(this.bindStatesCmdPool.freeCmds(t.bindStatesCmds),t.bindStatesCmds.clear()),t.drawCmds.length&&(this.drawCmdPool.freeCmds(t.drawCmds),t.drawCmds.clear()),t.updateBufferCmds.length&&(this.updateBufferCmdPool.freeCmds(t.updateBufferCmds),t.updateBufferCmds.clear()),t.copyBufferToTextureCmds.length&&(this.copyBufferToTextureCmdPool.freeCmds(t.copyBufferToTextureCmds),t.copyBufferToTextureCmds.clear()),t.cmds.clear()},e.releaseCmds=function(){this.beginRenderPassCmdPool.release(),this.bindStatesCmdPool.release(),this.drawCmdPool.release(),this.updateBufferCmdPool.release(),this.copyBufferToTextureCmdPool.release()},t}(),PH=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).cmdPackage=new dH,e._cmdAllocator=new wH,e._isInRenderPass=!1,e._curGPUPipelineState=null,e._curGPUInputAssembler=null,e._curGPUDescriptorSets=[],e._curDynamicOffsets=Array(8).fill(0),e._curDynamicStates=new so,e._isStateInvalied=!1,e}F(e,t);var n=e.prototype;return n.initialize=function(t){this._type=t.type,this._queue=t.queue;for(var e=ZG.instance.bindingMappingInfo.bufferOffsets.length,n=0;n<e;n++)this._curGPUDescriptorSets.push(null)},n.destroy=function(){this._cmdAllocator.clearCmds(this.cmdPackage)},n.begin=function(){this._cmdAllocator.clearCmds(this.cmdPackage),this._curGPUPipelineState=null,this._curGPUInputAssembler=null,this._curGPUDescriptorSets.length=0,this._numDrawCalls=0,this._numInstances=0,this._numTris=0},n.end=function(){this._isStateInvalied&&this.bindStates(),this._isInRenderPass=!1},n.beginRenderPass=function(t,e,n,i,r,a){var o=this._cmdAllocator.beginRenderPassCmdPool.alloc(uH);o.gpuRenderPass=t.gpuRenderPass,o.gpuFramebuffer=e.gpuFramebuffer,o.renderArea=n,o.clearColors.length=i.length;for(var s=0;s<i.length;++s)o.clearColors[s]=i[s];o.clearDepth=r,o.clearStencil=a,this.cmdPackage.beginRenderPassCmds.push(o),this.cmdPackage.cmds.push(rH.BEGIN_RENDER_PASS),this._isInRenderPass=!0},n.endRenderPass=function(){this._isInRenderPass=!1},n.bindPipelineState=function(t){var e=t.gpuPipelineState;e!==this._curGPUPipelineState&&(this._curGPUPipelineState=e,this._isStateInvalied=!0)},n.bindDescriptorSet=function(t,e,n){var i=e.gpuDescriptorSet;if(i!==this._curGPUDescriptorSets[t]&&(this._curGPUDescriptorSets[t]=i,this._isStateInvalied=!0),n){var r,a=null===(r=this._curGPUPipelineState)||void 0===r?void 0:r.gpuPipelineLayout;if(a){for(var o=this._curDynamicOffsets,s=a.dynamicOffsetOffsets[t],c=0;c<n.length;c++)o[s+c]=n[c];this._isStateInvalied=!0}}},n.bindInputAssembler=function(t){var e=t.gpuInputAssembler;this._curGPUInputAssembler=e,this._isStateInvalied=!0},n.setViewport=function(t){var e=this._curDynamicStates.viewport;e.left===t.left&&e.top===t.top&&e.width===t.width&&e.height===t.height&&e.minDepth===t.minDepth&&e.maxDepth===t.maxDepth||(e.left=t.left,e.top=t.top,e.width=t.width,e.height=t.height,e.minDepth=t.minDepth,e.maxDepth=t.maxDepth,this._isStateInvalied=!0)},n.setScissor=function(t){var e=this._curDynamicStates.scissor;e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height||(e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,this._isStateInvalied=!0)},n.setLineWidth=function(t){this._curDynamicStates.lineWidth!==t&&(this._curDynamicStates.lineWidth=t,this._isStateInvalied=!0)},n.setDepthBias=function(t,e,n){var i=this._curDynamicStates;i.depthBiasConstant===t&&i.depthBiasClamp===e&&i.depthBiasSlope===n||(i.depthBiasConstant=t,i.depthBiasClamp=e,i.depthBiasSlope=n,this._isStateInvalied=!0)},n.setBlendConstants=function(t){var e=this._curDynamicStates.blendConstant;e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w||(e.copy(t),this._isStateInvalied=!0)},n.setDepthBound=function(t,e){var n=this._curDynamicStates;n.depthMinBounds===t&&n.depthMaxBounds===e||(n.depthMinBounds=t,n.depthMaxBounds=e,this._isStateInvalied=!0)},n.setStencilWriteMask=function(t,e){var n=this._curDynamicStates.stencilStatesFront,i=this._curDynamicStates.stencilStatesBack;t&Zr.FRONT&&n.writeMask!==e&&(n.writeMask=e,this._isStateInvalied=!0),t&Zr.BACK&&i.writeMask!==e&&(i.writeMask=e,this._isStateInvalied=!0)},n.setStencilCompareMask=function(t,e,n){var i=this._curDynamicStates.stencilStatesFront,r=this._curDynamicStates.stencilStatesBack;t&Zr.FRONT&&(i.compareMask===n&&i.reference===e||(i.reference=e,i.compareMask=n,this._isStateInvalied=!0)),t&Zr.BACK&&(r.compareMask===n&&r.reference===e||(r.reference=e,r.compareMask=n,this._isStateInvalied=!0))},n.draw=function(t){if(this._type===ea.PRIMARY&&this._isInRenderPass||this._type===ea.SECONDARY){this._isStateInvalied&&this.bindStates();var e="drawInfo"in t?t.drawInfo:t,n=this._cmdAllocator.drawCmdPool.alloc(fH);n.drawInfo.copy(e),this.cmdPackage.drawCmds.push(n),this.cmdPackage.cmds.push(rH.DRAW),++this._numDrawCalls,this._numInstances+=e.instanceCount;var i=e.indexCount||e.vertexCount;if(this._curGPUPipelineState)switch(this._curGPUPipelineState.glPrimitive){case 4:this._numTris+=i/3*Math.max(e.instanceCount,1);break;case 5:case 6:this._numTris+=(i-2)*Math.max(e.instanceCount,1)}}else console.error("Command 'draw' must be recorded inside a render pass.")},n.updateBuffer=function(t,e,n){if(this._type===ea.PRIMARY&&!this._isInRenderPass||this._type===ea.SECONDARY){var i=t.gpuBuffer;if(i){var r,a=this._cmdAllocator.updateBufferCmdPool.alloc(_H),o=0;t.usage&Er.INDIRECT||(o=void 0!==n?n:e.byteLength),r=e,a.gpuBuffer=i,a.buffer=r,a.offset=0,a.size=o,this.cmdPackage.updateBufferCmds.push(a),this.cmdPackage.cmds.push(rH.UPDATE_BUFFER)}}else console.error("Command 'updateBuffer' must be recorded outside a render pass.")},n.copyBuffersToTexture=function(t,e,n){if(this._type===ea.PRIMARY&&!this._isInRenderPass||this._type===ea.SECONDARY){var i=e.gpuTexture;if(i){var r=this._cmdAllocator.copyBufferToTextureCmdPool.alloc(pH);r&&(r.gpuTexture=i,r.regions=n,r.buffers=t,this.cmdPackage.copyBufferToTextureCmds.push(r),this.cmdPackage.cmds.push(rH.COPY_BUFFER_TO_TEXTURE))}}else console.error("Command 'copyBufferToTexture' must be recorded outside a render pass.")},n.execute=function(t,e){for(var n=0;n<e;++n){for(var i=t[n],r=0;r<i.cmdPackage.beginRenderPassCmds.length;++r){var a=i.cmdPackage.beginRenderPassCmds.array[r];++a.refCount,this.cmdPackage.beginRenderPassCmds.push(a)}for(var o=0;o<i.cmdPackage.bindStatesCmds.length;++o){var s=i.cmdPackage.bindStatesCmds.array[o];++s.refCount,this.cmdPackage.bindStatesCmds.push(s)}for(var c=0;c<i.cmdPackage.drawCmds.length;++c){var l=i.cmdPackage.drawCmds.array[c];++l.refCount,this.cmdPackage.drawCmds.push(l)}for(var u=0;u<i.cmdPackage.updateBufferCmds.length;++u){var h=i.cmdPackage.updateBufferCmds.array[u];++h.refCount,this.cmdPackage.updateBufferCmds.push(h)}for(var f=0;f<i.cmdPackage.copyBufferToTextureCmds.length;++f){var _=i.cmdPackage.copyBufferToTextureCmds.array[f];++_.refCount,this.cmdPackage.copyBufferToTextureCmds.push(_)}this.cmdPackage.cmds.concat(i.cmdPackage.cmds.array),this._numDrawCalls+=i._numDrawCalls,this._numInstances+=i._numInstances,this._numTris+=i._numTris}},n.pipelineBarrier=function(){},n.bindStates=function(){var t=this._cmdAllocator.bindStatesCmdPool.alloc(hH);t&&(t.gpuPipelineState=this._curGPUPipelineState,Array.prototype.push.apply(t.gpuDescriptorSets,this._curGPUDescriptorSets),Array.prototype.push.apply(t.dynamicOffsets,this._curDynamicOffsets),t.gpuInputAssembler=this._curGPUInputAssembler,t.dynamicStates.copy(this._curDynamicStates),this.cmdPackage.bindStatesCmds.push(t),this.cmdPackage.cmds.push(rH.BIND_STATES),this._isStateInvalied=!1)},e}(To),IH=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._gpuFramebuffer=null,e}F(e,t);var n=e.prototype;return n.initialize=function(t){this._renderPass=t.renderPass,this._colorTextures=t.colorTextures||[],this._depthStencilTexture=t.depthStencilTexture||null;for(var e=[],n=0;n<t.colorTextures.length;++n){var i=t.colorTextures[n];i&&e.push(i.gpuTexture)}var r=null;t.depthStencilTexture&&(r=t.depthStencilTexture.gpuTexture);var a=Number.MAX_SAFE_INTEGER,o=Number.MAX_SAFE_INTEGER;this._gpuFramebuffer={gpuRenderPass:t.renderPass.gpuRenderPass,gpuColorTextures:e,gpuDepthStencilTexture:r,glFramebuffer:null,isOffscreen:!0,get width(){return this.isOffscreen?a:this.gpuColorTextures[0].width},set width(t){a=t},get height(){return this.isOffscreen?o:this.gpuColorTextures[0].height},set height(t){o=t}},function(t,e){for(var n=0;n<e.gpuColorTextures.length;++n)if(e.gpuColorTextures[n].isSwapchainTexture)return void(e.isOffscreen=!1);var i=t.gl,r=[],a=i.createFramebuffer();if(a){e.glFramebuffer=a,t.stateCache.glFramebuffer!==e.glFramebuffer&&i.bindFramebuffer(i.FRAMEBUFFER,e.glFramebuffer);for(var o=0;o<e.gpuColorTextures.length;++o){var s=e.gpuColorTextures[o];s&&(s.glTexture?i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+o,s.glTarget,s.glTexture,0):i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+o,i.RENDERBUFFER,s.glRenderbuffer),r.push(i.COLOR_ATTACHMENT0+o),e.width=Math.min(e.width,s.width),e.height=Math.min(e.height,s.height))}var c=e.gpuDepthStencilTexture;if(c){var l=lo[c.format].hasStencil?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT;c.glTexture?i.framebufferTexture2D(i.FRAMEBUFFER,l,c.glTarget,c.glTexture,0):i.framebufferRenderbuffer(i.FRAMEBUFFER,l,i.RENDERBUFFER,c.glRenderbuffer),e.width=Math.min(e.width,c.width),e.height=Math.min(e.height,c.height)}t.extensions.WEBGL_draw_buffers&&t.extensions.WEBGL_draw_buffers.drawBuffersWEBGL(r);var u=i.checkFramebufferStatus(i.FRAMEBUFFER);if(u!==i.FRAMEBUFFER_COMPLETE)switch(u){case i.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:console.error("glCheckFramebufferStatus() - FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case i.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:console.error("glCheckFramebufferStatus() - FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case i.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:console.error("glCheckFramebufferStatus() - FRAMEBUFFER_INCOMPLETE_DIMENSIONS");break;case i.FRAMEBUFFER_UNSUPPORTED:console.error("glCheckFramebufferStatus() - FRAMEBUFFER_UNSUPPORTED")}t.stateCache.glFramebuffer!==e.glFramebuffer&&i.bindFramebuffer(i.FRAMEBUFFER,t.stateCache.glFramebuffer)}}(ZG.instance,this._gpuFramebuffer)},n.destroy=function(){var t,e;this._gpuFramebuffer&&(t=ZG.instance,(e=this._gpuFramebuffer).glFramebuffer&&(t.gl.deleteFramebuffer(e.glFramebuffer),t.stateCache.glFramebuffer===e.glFramebuffer&&(t.gl.bindFramebuffer(t.gl.FRAMEBUFFER,null),t.stateCache.glFramebuffer=null),e.glFramebuffer=null),this._gpuFramebuffer=null)},L(e,[{key:"gpuFramebuffer",get:function(){return this._gpuFramebuffer}}]),e}(Co),RH=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._gpuInputAssembler=null,e}F(e,t);var n=e.prototype;return n.initialize=function(t){if(0!==t.vertexBuffers.length){if(this._attributes=t.attributes,this._attributesHash=this.computeAttributesHash(),this._vertexBuffers=t.vertexBuffers,t.indexBuffer)this._indexBuffer=t.indexBuffer,this._drawInfo.indexCount=this._indexBuffer.size/this._indexBuffer.stride,this._drawInfo.firstIndex=0;else{var e=this._vertexBuffers[0];this._drawInfo.vertexCount=e.size/e.stride,this._drawInfo.firstVertex=0,this._drawInfo.vertexOffset=0}this._drawInfo.instanceCount=0,this._drawInfo.firstInstance=0,this._indirectBuffer=t.indirectBuffer||null;for(var n=new Array(t.vertexBuffers.length),i=0;i<t.vertexBuffers.length;++i){var r=t.vertexBuffers[i];r.gpuBuffer&&(n[i]=r.gpuBuffer)}var a=null,o=0;if(t.indexBuffer&&(a=t.indexBuffer.gpuBuffer))switch(a.stride){case 1:o=5121;break;case 2:o=5123;break;case 4:o=5125;break;default:console.error("Error index buffer stride.")}var s=null;t.indirectBuffer&&(s=t.indirectBuffer.gpuBuffer),this._gpuInputAssembler={attributes:t.attributes,gpuVertexBuffers:n,gpuIndexBuffer:a,gpuIndirectBuffer:s,glAttribs:[],glIndexType:o,glVAOs:new Map},function(t,e){var n=t.gl;e.glAttribs=new Array(e.attributes.length);for(var i=[0,0,0,0,0,0,0,0],r=0;r<e.attributes.length;++r){var a=e.attributes[r],o=void 0!==a.stream?a.stream:0,s=e.gpuVertexBuffers[o],c=JG(a.format,n),l=lo[a.format].size;e.glAttribs[r]={name:a.name,glBuffer:s.glBuffer,glType:c,size:l,count:lo[a.format].count,stride:s.stride,componentCount:iH(c,n),isNormalized:void 0!==a.isNormalized&&a.isNormalized,isInstanced:void 0!==a.isInstanced&&a.isInstanced,offset:i[o]},i[o]+=l}}(ZG.instance,this._gpuInputAssembler)}else console.error("InputAssemblerInfo.vertexBuffers is null.")},n.destroy=function(){var t=ZG.instance;this._gpuInputAssembler&&t.extensions.useVAO&&function(t,e){for(var n=e.glVAOs.values(),i=n.next(),r=t.extensions.OES_vertex_array_object,a=t.stateCache.glVAO;!i.done;)r.deleteVertexArrayOES(i.value),a===i.value&&(r.bindVertexArrayOES(null),a=null),i=n.next();t.stateCache.glVAO=a,e.glVAOs.clear()}(t,this._gpuInputAssembler),this._gpuInputAssembler=null},L(e,[{key:"gpuInputAssembler",get:function(){return this._gpuInputAssembler}}]),e}(Io),DH=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._gpuDescriptorSetLayout=null,e}F(e,t);var n=e.prototype;return n.initialize=function(t){Array.prototype.push.apply(this._bindings,t.bindings);for(var e=0,n=-1,i=[],r=0;r<this._bindings.length;r++){var a=this._bindings[r];i.push(e),e+=a.count,a.binding>n&&(n=a.binding)}this._bindingIndices=Array(n+1).fill(-1);for(var o=this._descriptorIndices=Array(n+1).fill(-1),s=0;s<this._bindings.length;s++){var c=this._bindings[s];this._bindingIndices[c.binding]=s,o[c.binding]=i[s]}for(var l=[],u=0;u<this._bindings.length;u++){var h=this._bindings[u];if(h.descriptorType&fo)for(var f=0;f<h.count;f++)l.push(h.binding)}this._gpuDescriptorSetLayout={bindings:this._bindings,dynamicBindings:l,descriptorIndices:o,descriptorCount:e}},n.destroy=function(){this._bindings.length=0},L(e,[{key:"gpuDescriptorSetLayout",get:function(){return this._gpuDescriptorSetLayout}}]),e}(Do),OH=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._gpuPipelineLayout=null,e}F(e,t);var n=e.prototype;return n.initialize=function(t){Array.prototype.push.apply(this._setLayouts,t.setLayouts);for(var e=[],n=[],i=0,r=[],a=0;a<this._setLayouts.length;a++){for(var o=this._setLayouts[a],s=o.gpuDescriptorSetLayout.dynamicBindings,c=Array(o.bindingIndices.length).fill(-1),l=0;l<s.length;l++){var u=s[l];c[u]<0&&(c[u]=i+l)}n.push(o.gpuDescriptorSetLayout),e.push(c),r.push(i),i+=s.length}this._gpuPipelineLayout={gpuSetLayouts:n,dynamicOffsetIndices:e,dynamicOffsetCount:i,dynamicOffsetOffsets:r}},n.destroy=function(){this._setLayouts.length=0},L(e,[{key:"gpuPipelineLayout",get:function(){return this._gpuPipelineLayout}}]),e}(Oo),MH=[0,1,3,2,0,0,0,4,5,6,0,0,0,0],NH=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._gpuPipelineState=null,e}F(e,t);var n=e.prototype;return n.initialize=function(t){this._primitive=t.primitive,this._shader=t.shader,this._pipelineLayout=t.pipelineLayout;var e=this._bs;if(t.blendState){var n=t.blendState,i=n.targets;i&&i.forEach((function(t,n){e.setTarget(n,t)})),void 0!==n.isA2C&&(e.isA2C=n.isA2C),void 0!==n.isIndepend&&(e.isIndepend=n.isIndepend),void 0!==n.blendColor&&(e.blendColor=n.blendColor)}Object.assign(this._rs,t.rasterizerState),Object.assign(this._dss,t.depthStencilState),this._is=t.inputState,this._renderPass=t.renderPass,this._dynamicStates=t.dynamicStates;for(var r=[],a=0;a<31;a++)this._dynamicStates&1<<a&&r.push(1<<a);this._gpuPipelineState={glPrimitive:MH[t.primitive],gpuShader:t.shader.gpuShader,gpuPipelineLayout:t.pipelineLayout.gpuPipelineLayout,rs:t.rasterizerState,dss:t.depthStencilState,bs:t.blendState,gpuRenderPass:t.renderPass.gpuRenderPass,dynamicStates:r}},n.destroy=function(){this._gpuPipelineState=null},L(e,[{key:"gpuPipelineState",get:function(){return this._gpuPipelineState}}]),e}(zo),LH=function(t){function e(){return t.apply(this,arguments)||this}F(e,t);var n=e.prototype;return n.beginRenderPass=function(t,e,n,i,r,a){vH(ZG.instance,t.gpuRenderPass,e.gpuFramebuffer,n,i,r,a),this._isInRenderPass=!0},n.draw=function(t){if(this._isInRenderPass){this._isStateInvalied&&this.bindStates();var e="drawInfo"in t?t.drawInfo:t;xH(ZG.instance,e),++this._numDrawCalls,this._numInstances+=e.instanceCount;var n=e.indexCount||e.vertexCount;if(this._curGPUPipelineState)switch(this._curGPUPipelineState.glPrimitive){case 4:this._numTris+=n/3*Math.max(e.instanceCount,1);break;case 5:case 6:this._numTris+=(n-2)*Math.max(e.instanceCount,1)}}else console.error("Command 'draw' must be recorded inside a render pass.")},n.setViewport=function(t){var e=ZG.instance,n=e.stateCache,i=e.gl;n.viewport.left===t.left&&n.viewport.top===t.top&&n.viewport.width===t.width&&n.viewport.height===t.height||(i.viewport(t.left,t.top,t.width,t.height),n.viewport.left=t.left,n.viewport.top=t.top,n.viewport.width=t.width,n.viewport.height=t.height)},n.setScissor=function(t){var e=ZG.instance,n=e.stateCache,i=e.gl;n.scissorRect.x===t.x&&n.scissorRect.y===t.y&&n.scissorRect.width===t.width&&n.scissorRect.height===t.height||(i.scissor(t.x,t.y,t.width,t.height),n.scissorRect.x=t.x,n.scissorRect.y=t.y,n.scissorRect.width=t.width,n.scissorRect.height=t.height)},n.updateBuffer=function(t,e,n){if(this._isInRenderPass)console.error("Command 'updateBuffer' must be recorded outside a render pass.");else{var i,r=t.gpuBuffer;r&&(i=void 0!==n?n:t.usage&Er.INDIRECT?0:e.byteLength,mH(ZG.instance,r,e,0,i))}},n.copyBuffersToTexture=function(t,e,n){if(this._isInRenderPass)console.error("Command 'copyBufferToTexture' must be recorded outside a render pass.");else{var i=e.gpuTexture;i&&AH(ZG.instance,t,i,n)}},n.execute=function(t,e){for(var n=0;n<e;++n){var i=t[n];TH(ZG.instance,i.cmdPackage),this._numDrawCalls+=i._numDrawCalls,this._numInstances+=i._numInstances,this._numTris+=i._numTris}},n.bindStates=function(){yH(ZG.instance,this._curGPUPipelineState,this._curGPUInputAssembler,this._curGPUDescriptorSets,this._curDynamicOffsets,this._curDynamicStates),this._isStateInvalied=!1},e}(PH),BH=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).numDrawCalls=0,e.numInstances=0,e.numTris=0,e}F(e,t);var n=e.prototype;return n.initialize=function(t){this._type=t.type},n.destroy=function(){},n.submit=function(t){for(var e=t.length,n=0;n<e;n++){var i=t[n];this.numDrawCalls+=i.numDrawCalls,this.numInstances+=i.numInstances,this.numTris+=i.numTris}},n.clear=function(){this.numDrawCalls=0,this.numInstances=0,this.numTris=0},e}(Uo),FH=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._gpuRenderPass=null,e}F(e,t);var n=e.prototype;return n.initialize=function(t){this._colorInfos=t.colorAttachments,this._depthStencilInfo=t.depthStencilAttachment,this._subpasses=t.subpasses,this._gpuRenderPass={colorAttachments:this._colorInfos,depthStencilAttachment:this._depthStencilInfo},this._hash=this.computeHash()},n.destroy=function(){this._gpuRenderPass=null},L(e,[{key:"gpuRenderPass",get:function(){return this._gpuRenderPass}}]),e}(ko),zH=[10497,33648,33071,33071],UH=function(t){function e(e,n){var i;(i=t.call(this,e,n)||this)._gpuSampler=null;var r,a,o=i._info.minFilter,s=i._info.magFilter,c=i._info.mipFilter;r=o===Mr.LINEAR||o===Mr.ANISOTROPIC?c===Mr.LINEAR||c===Mr.ANISOTROPIC?9987:c===Mr.POINT?9985:9729:c===Mr.LINEAR||c===Mr.ANISOTROPIC?9986:c===Mr.POINT?9984:9728,a=s===Mr.LINEAR||s===Mr.ANISOTROPIC?9729:9728;var l=zH[i._info.addressU],u=zH[i._info.addressV],h=zH[i._info.addressW];return i._gpuSampler={glMinFilter:r,glMagFilter:a,glWrapS:l,glWrapT:u,glWrapR:h},i}return F(e,t),L(e,[{key:"gpuSampler",get:function(){return this._gpuSampler}}]),e}(Go),kH=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._gpuShader=null,e}F(e,t);var n=e.prototype;return n.initialize=function(t){this._name=t.name,this._stages=t.stages,this._attributes=t.attributes,this._blocks=t.blocks,this._samplers=t.samplers,this._gpuShader={name:t.name,blocks:t.blocks.slice(),samplerTextures:t.samplerTextures.slice(),subpassInputs:t.subpassInputs.slice(),gpuStages:new Array(t.stages.length),glProgram:null,glInputs:[],glUniforms:[],glBlocks:[],glSamplerTextures:[]};for(var e=0;e<t.stages.length;++e){var n=t.stages[e];this._gpuShader.gpuStages[e]={type:n.stage,source:n.source,glShader:null}}!function(t,e){for(var n=t.gl,i=function(t){var i=e.gpuStages[t],r=0,a="",o=1;switch(i.type){case kr.VERTEX:a="VertexShader",r=n.VERTEX_SHADER;break;case kr.FRAGMENT:a="FragmentShader",r=n.FRAGMENT_SHADER;break;default:return console.error("Unsupported ShaderType."),{v:void 0}}var s=n.createShader(r);if(s&&(i.glShader=s,n.shaderSource(i.glShader,i.source),n.compileShader(i.glShader),!n.getShaderParameter(i.glShader,n.COMPILE_STATUS))){console.error(a+" in '"+e.name+"' compilation failed."),console.error("Shader source dump:",i.source.replace(/^|\n/g,(function(){return"\n"+o+++" "}))),console.error(n.getShaderInfoLog(i.glShader));for(var c=0;c<e.gpuStages.length;c++){var l=e.gpuStages[t];l.glShader&&(n.deleteShader(l.glShader),l.glShader=null)}return{v:void 0}}},r=0;r<e.gpuStages.length;r++){var a=i(r);if("object"==typeof a)return a.v}var o=n.createProgram();if(o){e.glProgram=o;for(var s=0;s<e.gpuStages.length;s++){var c=e.gpuStages[s];n.attachShader(e.glProgram,c.glShader)}if(n.linkProgram(e.glProgram),t.extensions.destroyShadersImmediately)for(var l=0;l<e.gpuStages.length;l++){var u=e.gpuStages[l];u.glShader&&(n.detachShader(e.glProgram,u.glShader),n.deleteShader(u.glShader),u.glShader=null)}if(!n.getProgramParameter(e.glProgram,n.LINK_STATUS))return console.error("Failed to link shader '"+e.name+"'."),void console.error(n.getProgramInfoLog(e.glProgram));g("Shader '"+e.name+"' compilation succeeded.");var h=n.getProgramParameter(e.glProgram,n.ACTIVE_ATTRIBUTES);e.glInputs=new Array(h);for(var f=0;f<h;++f){var _=n.getActiveAttrib(e.glProgram,f);if(_){var p,d=_.name.indexOf("[");p=-1!==d?_.name.substr(0,d):_.name;var m=n.getAttribLocation(e.glProgram,p),v=eH(_.type,n),y=nH(_.type,n);e.glInputs[f]={binding:m,name:p,type:v,stride:y,count:_.size,size:y*_.size,glType:_.type,glLoc:m}}}if(e.blocks.length>0){e.glBlocks=new Array(e.blocks.length);for(var x=0;x<e.blocks.length;++x){var S=e.blocks[x],T={set:S.set,binding:S.binding,name:S.name,size:0,glUniforms:new Array(S.members.length),glActiveUniforms:[]};e.glBlocks[x]=T;for(var A=0;A<S.members.length;++A){var E=S.members[A],C=$G(E.type,n),b=nH(C,n),w=b*E.count;T.glUniforms[A]={binding:-1,name:E.name,type:E.type,stride:b,count:E.count,size:w,offset:0,glType:C,glLoc:null,array:null}}}}for(var P=0;P<e.subpassInputs.length;++P){var I=e.subpassInputs[P];e.samplerTextures.push(new Oa(I.set,I.binding,I.name,Ar.SAMPLER2D,I.count))}if(e.samplerTextures.length>0){e.glSamplerTextures=new Array(e.samplerTextures.length);for(var R=0;R<e.samplerTextures.length;++R){var D=e.samplerTextures[R];e.glSamplerTextures[R]={set:D.set,binding:D.binding,name:D.name,type:D.type,count:D.count,units:[],glUnits:null,glType:$G(D.type,n),glLoc:null}}}for(var O=n.getProgramParameter(e.glProgram,n.ACTIVE_UNIFORMS),M=0;M<O;++M){var N=n.getActiveUniform(e.glProgram,M);if(N&&N.type!==n.SAMPLER_2D&&N.type!==n.SAMPLER_CUBE){var L=n.getUniformLocation(e.glProgram,N.name);if(t.extensions.isLocationActive(L)){var B,F=N.name.indexOf("[");B=-1!==F?N.name.substr(0,F):N.name;for(var z=0;z<e.glBlocks.length;z++)for(var U=e.glBlocks[z],k=0;k<U.glUniforms.length;k++){var G=U.glUniforms[k];if(G.name===B){G.glLoc=L,G.count=N.size,G.size=G.stride*G.count,G.array=new(tH(G.type))(G.size/4),U.glActiveUniforms.push(G);break}}}}}for(var H=0;H<e.glBlocks.length;H++)for(var V=e.glBlocks[H],j=0;j<V.glUniforms.length;j++){var W=V.glUniforms[j];W.offset=V.size/4,V.size+=W.size}for(var X=[],q=[],Y=t.bindingMappingInfo,K=t.stateCache.texUnitCacheMap,Q=0,Z=0;Z<e.blocks.length;++Z)e.blocks[Z].set===Y.flexibleSet&&Q++;for(var J=0,$=0;$<e.samplerTextures.length;++$){var tt=e.samplerTextures[$],et=n.getUniformLocation(e.glProgram,tt.name);if(t.extensions.isLocationActive(et)&&(X.push(e.glSamplerTextures[$]),q.push(et)),void 0===K[tt.name]){var nt=tt.binding+Y.samplerOffsets[tt.set]+J;tt.set===Y.flexibleSet&&(nt-=Q),K[tt.name]=nt%t.capabilities.maxTextureUnits,J+=tt.count-1}}if(X.length){for(var it=[],rt=0;rt<X.length;++rt){var at=X[rt],ot=K[at.name];if(void 0!==ot){at.glLoc=q[rt];for(var st=0;st<at.count;++st){for(;it[ot];)ot=(ot+1)%t.capabilities.maxTextureUnits;at.units.push(ot),it[ot]=!0}}}for(var ct=0,lt=0;lt<X.length;++lt){var ut=X[lt];if(!t.extensions.isLocationActive(ut.glLoc)){ut.glLoc=q[lt];for(var ht=0;ht<ut.count;++ht){for(;it[ct];)ct=(ct+1)%t.capabilities.maxTextureUnits;void 0===K[ut.name]&&(K[ut.name]=ct),ut.units.push(ct),it[ct]=!0}}}t.stateCache.glProgram!==e.glProgram&&n.useProgram(e.glProgram);for(var ft=0;ft<X.length;ft++){var _t=X[ft];_t.glUnits=new Int32Array(_t.units),n.uniform1iv(_t.glLoc,_t.glUnits)}t.stateCache.glProgram!==e.glProgram&&n.useProgram(t.stateCache.glProgram)}for(var pt=0;pt<e.glBlocks.length;)e.glBlocks[pt].glActiveUniforms.length?pt++:(e.glBlocks[pt]=e.glBlocks[e.glBlocks.length-1],e.glBlocks.length--);e.glSamplerTextures=X}}(ZG.instance,this._gpuShader)},n.destroy=function(){this._gpuShader&&(function(t,e){if(e.glProgram){var n=t.gl;if(!t.extensions.destroyShadersImmediately)for(var i=0;i<e.gpuStages.length;i++){var r=e.gpuStages[i];r.glShader&&(n.detachShader(e.glProgram,r.glShader),n.deleteShader(r.glShader),r.glShader=null)}n.deleteProgram(e.glProgram),t.stateCache.glProgram===e.glProgram&&(t.gl.useProgram(null),t.stateCache.glProgram=null),e.glProgram=null}}(ZG.instance,this._gpuShader),this._gpuShader=null)},L(e,[{key:"gpuShader",get:function(){return this._gpuShader}}]),e}(Ho),GH=function(){function t(){this.glArrayBuffer=null,this.glElementArrayBuffer=null,this.glVAO=null,this.texUnit=0,this.glTexUnits=[],this.glRenderbuffer=null,this.glFramebuffer=null,this.viewport=new ga,this.scissorRect=new ua(0,0,0,0),this.rs=new Mo,this.dss=new No,this.bs=new Bo,this.glProgram=null,this.glEnabledAttribLocs=[],this.glCurrentAttribLocs=[],this.texUnitCacheMap={}}return t.prototype.initialize=function(t,e){for(var n=0;n<t;++n)this.glTexUnits.push({glTexture:null});this.glEnabledAttribLocs.length=e,this.glEnabledAttribLocs.fill(!1),this.glCurrentAttribLocs.length=e,this.glCurrentAttribLocs.fill(!1)},t}(),HH=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._gpuTexture=null,e}F(e,t);var n=e.prototype;return n.initialize=function(t,e){"texture"in t?console.log("WebGL does not support texture view."):(this._type=t.type,this._usage=t.usage,this._format=t.format,this._width=t.width,this._height=t.height,this._depth=t.depth,this._layerCount=t.layerCount,this._levelCount=t.levelCount,this._samples=t.samples,this._flags=t.flags,this._isPowerOf2=_o(this._width)&&_o(this._height),this._size=mo(this._format,this.width,this.height,this.depth,this._levelCount)*this._layerCount,this._gpuTexture={type:this._type,format:this._format,usage:this._usage,width:this._width,height:this._height,depth:this._depth,size:this._size,arrayLayer:this._layerCount,mipLevel:this._levelCount,samples:this._samples,flags:this._flags,isPowerOf2:this._isPowerOf2,glTarget:0,glInternalFmt:0,glFormat:0,glType:0,glUsage:0,glTexture:null,glRenderbuffer:null,glWrapS:0,glWrapT:0,glMinFilter:0,glMagFilter:0,isSwapchainTexture:e||!1},function(t,e){var n=t.gl;e.glFormat=e.glInternalFmt=function(t,e){switch(t){case Sr.A8:return e.ALPHA;case Sr.L8:return e.LUMINANCE;case Sr.LA8:return e.LUMINANCE_ALPHA;case Sr.RGB8:case Sr.RGB16F:case Sr.RGB32F:return e.RGB;case Sr.BGRA8:case Sr.RGBA8:case Sr.SRGB8_A8:case Sr.RGBA16F:case Sr.RGBA32F:return e.RGBA;case Sr.R5G6B5:return e.RGB;case Sr.RGB5A1:case Sr.RGBA4:return e.RGBA;case Sr.DEPTH:return e.DEPTH_COMPONENT;case Sr.DEPTH_STENCIL:return e.DEPTH_STENCIL;case Sr.BC1:return KG.COMPRESSED_RGB_S3TC_DXT1_EXT;case Sr.BC1_ALPHA:return KG.COMPRESSED_RGBA_S3TC_DXT1_EXT;case Sr.BC1_SRGB:return KG.COMPRESSED_SRGB_S3TC_DXT1_EXT;case Sr.BC1_SRGB_ALPHA:return KG.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;case Sr.BC2:return KG.COMPRESSED_RGBA_S3TC_DXT3_EXT;case Sr.BC2_SRGB:return KG.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;case Sr.BC3:return KG.COMPRESSED_RGBA_S3TC_DXT5_EXT;case Sr.BC3_SRGB:return KG.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;case Sr.ETC_RGB8:return KG.COMPRESSED_RGB_ETC1_WEBGL;case Sr.ETC2_RGB8:return KG.COMPRESSED_RGB8_ETC2;case Sr.ETC2_SRGB8:return KG.COMPRESSED_SRGB8_ETC2;case Sr.ETC2_RGB8_A1:return KG.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2;case Sr.ETC2_SRGB8_A1:return KG.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2;case Sr.ETC2_RGBA8:return KG.COMPRESSED_RGBA8_ETC2_EAC;case Sr.ETC2_SRGB8_A8:return KG.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC;case Sr.EAC_R11:return KG.COMPRESSED_R11_EAC;case Sr.EAC_R11SN:return KG.COMPRESSED_SIGNED_R11_EAC;case Sr.EAC_RG11:return KG.COMPRESSED_RG11_EAC;case Sr.EAC_RG11SN:return KG.COMPRESSED_SIGNED_RG11_EAC;case Sr.PVRTC_RGB2:return KG.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;case Sr.PVRTC_RGBA2:return KG.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;case Sr.PVRTC_RGB4:return KG.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;case Sr.PVRTC_RGBA4:return KG.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;case Sr.ASTC_RGBA_4X4:return KG.COMPRESSED_RGBA_ASTC_4x4_KHR;case Sr.ASTC_RGBA_5X4:return KG.COMPRESSED_RGBA_ASTC_5x4_KHR;case Sr.ASTC_RGBA_5X5:return KG.COMPRESSED_RGBA_ASTC_5x5_KHR;case Sr.ASTC_RGBA_6X5:return KG.COMPRESSED_RGBA_ASTC_6x5_KHR;case Sr.ASTC_RGBA_6X6:return KG.COMPRESSED_RGBA_ASTC_6x6_KHR;case Sr.ASTC_RGBA_8X5:return KG.COMPRESSED_RGBA_ASTC_8x5_KHR;case Sr.ASTC_RGBA_8X6:return KG.COMPRESSED_RGBA_ASTC_8x6_KHR;case Sr.ASTC_RGBA_8X8:return KG.COMPRESSED_RGBA_ASTC_8x8_KHR;case Sr.ASTC_RGBA_10X5:return KG.COMPRESSED_RGBA_ASTC_10x5_KHR;case Sr.ASTC_RGBA_10X6:return KG.COMPRESSED_RGBA_ASTC_10x6_KHR;case Sr.ASTC_RGBA_10X8:return KG.COMPRESSED_RGBA_ASTC_10x8_KHR;case Sr.ASTC_RGBA_10X10:return KG.COMPRESSED_RGBA_ASTC_10x10_KHR;case Sr.ASTC_RGBA_12X10:return KG.COMPRESSED_RGBA_ASTC_12x10_KHR;case Sr.ASTC_RGBA_12X12:return KG.COMPRESSED_RGBA_ASTC_12x12_KHR;case Sr.ASTC_SRGBA_4X4:return KG.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;case Sr.ASTC_SRGBA_5X4:return KG.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR;case Sr.ASTC_SRGBA_5X5:return KG.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR;case Sr.ASTC_SRGBA_6X5:return KG.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR;case Sr.ASTC_SRGBA_6X6:return KG.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR;case Sr.ASTC_SRGBA_8X5:return KG.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR;case Sr.ASTC_SRGBA_8X6:return KG.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR;case Sr.ASTC_SRGBA_8X8:return KG.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR;case Sr.ASTC_SRGBA_10X5:return KG.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR;case Sr.ASTC_SRGBA_10X6:return KG.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR;case Sr.ASTC_SRGBA_10X8:return KG.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR;case Sr.ASTC_SRGBA_10X10:return KG.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR;case Sr.ASTC_SRGBA_12X10:return KG.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR;case Sr.ASTC_SRGBA_12X12:return KG.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR;default:return console.error("Unsupported Format, convert to WebGL format failed."),e.RGBA}}(e.format,n),e.glType=JG(e.format,n);var i=e.width,r=e.height;switch(e.type){case Pr.TEX2D:if(e.glTarget=n.TEXTURE_2D,e.isSwapchainTexture)break;var a=Math.max(i,r);if(a>t.capabilities.maxTextureSize&&b(9100,a,t.capabilities.maxTextureSize),!t.extensions.WEBGL_depth_texture&&lo[e.format].hasDepth)e.glInternalFmt=function(t,e){switch(t){case Sr.R5G6B5:return e.RGB565;case Sr.RGB5A1:return e.RGB5_A1;case Sr.RGBA4:return e.RGBA4;case Sr.RGBA16F:return KG.RGBA16F_EXT;case Sr.RGBA32F:return KG.RGBA32F_EXT;case Sr.SRGB8_A8:return KG.SRGB8_ALPHA8_EXT;case Sr.DEPTH:return e.DEPTH_COMPONENT16;case Sr.DEPTH_STENCIL:return e.DEPTH_STENCIL;default:return console.error("Unsupported Format, convert to WebGL internal format failed."),e.RGBA}}(e.format,n),e.glRenderbuffer=n.createRenderbuffer(),e.size>0&&(t.stateCache.glRenderbuffer!==e.glRenderbuffer&&(n.bindRenderbuffer(n.RENDERBUFFER,e.glRenderbuffer),t.stateCache.glRenderbuffer=e.glRenderbuffer),n.renderbufferStorage(n.RENDERBUFFER,e.glInternalFmt,i,r));else if(e.glTexture=n.createTexture(),e.size>0){var o=t.stateCache.glTexUnits[t.stateCache.texUnit];if(o.glTexture!==e.glTexture&&(n.bindTexture(n.TEXTURE_2D,e.glTexture),o.glTexture=e.glTexture),lo[e.format].isCompressed)for(var s=0;s<e.mipLevel;++s){var c=po(e.format,i,r,1),l=new Uint8Array(c);n.compressedTexImage2D(n.TEXTURE_2D,s,e.glInternalFmt,i,r,0,l),i=Math.max(1,i>>1),r=Math.max(1,r>>1)}else for(var u=0;u<e.mipLevel;++u)n.texImage2D(n.TEXTURE_2D,u,e.glInternalFmt,i,r,0,e.glFormat,e.glType,null),i=Math.max(1,i>>1),r=Math.max(1,r>>1);e.isPowerOf2?(e.glWrapS=n.REPEAT,e.glWrapT=n.REPEAT):(e.glWrapS=n.CLAMP_TO_EDGE,e.glWrapT=n.CLAMP_TO_EDGE),e.glMinFilter=n.LINEAR,e.glMagFilter=n.LINEAR,n.texParameteri(e.glTarget,n.TEXTURE_WRAP_S,e.glWrapS),n.texParameteri(e.glTarget,n.TEXTURE_WRAP_T,e.glWrapT),n.texParameteri(e.glTarget,n.TEXTURE_MIN_FILTER,e.glMinFilter),n.texParameteri(e.glTarget,n.TEXTURE_MAG_FILTER,e.glMagFilter)}break;case Pr.CUBE:e.glTarget=n.TEXTURE_CUBE_MAP;var h=Math.max(i,r);if(h>t.capabilities.maxCubeMapTextureSize&&b(9100,h,t.capabilities.maxTextureSize),e.glTexture=n.createTexture(),e.size>0){var f=t.stateCache.glTexUnits[t.stateCache.texUnit];if(f.glTexture!==e.glTexture&&(n.bindTexture(n.TEXTURE_CUBE_MAP,e.glTexture),f.glTexture=e.glTexture),lo[e.format].isCompressed)for(var _=0;_<6;++_){i=e.width,r=e.height;for(var p=0;p<e.mipLevel;++p){var d=po(e.format,i,r,1),m=new Uint8Array(d);n.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+_,p,e.glInternalFmt,i,r,0,m),i=Math.max(1,i>>1),r=Math.max(1,r>>1)}}else for(var g=0;g<6;++g){i=e.width,r=e.height;for(var v=0;v<e.mipLevel;++v)n.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+g,v,e.glInternalFmt,i,r,0,e.glFormat,e.glType,null),i=Math.max(1,i>>1),r=Math.max(1,r>>1)}e.isPowerOf2?(e.glWrapS=n.REPEAT,e.glWrapT=n.REPEAT):(e.glWrapS=n.CLAMP_TO_EDGE,e.glWrapT=n.CLAMP_TO_EDGE),e.glMinFilter=n.LINEAR,e.glMagFilter=n.LINEAR,n.texParameteri(e.glTarget,n.TEXTURE_WRAP_S,e.glWrapS),n.texParameteri(e.glTarget,n.TEXTURE_WRAP_T,e.glWrapT),n.texParameteri(e.glTarget,n.TEXTURE_MIN_FILTER,e.glMinFilter),n.texParameteri(e.glTarget,n.TEXTURE_MAG_FILTER,e.glMagFilter)}break;default:console.error("Unsupported TextureType, create texture failed."),e.type=Pr.TEX2D,e.glTarget=n.TEXTURE_2D}}(ZG.instance,this._gpuTexture),ZG.instance.memoryStatus.textureSize+=this._size)},n.destroy=function(){this._gpuTexture&&(function(t,e){var n=t.gl;if(e.glTexture){var i=t.stateCache.glTexUnits,r=t.stateCache.texUnit;n.deleteTexture(e.glTexture);for(var a=0;a<i.length;a++)i[a].glTexture===e.glTexture&&(n.activeTexture(n.TEXTURE0+a),r=a,n.bindTexture(e.glTarget,null),i[a].glTexture=null);t.stateCache.texUnit=r,e.glTexture=null}if(e.glRenderbuffer){var o=t.stateCache.glRenderbuffer;n.deleteRenderbuffer(e.glRenderbuffer),o===e.glRenderbuffer&&(n.bindRenderbuffer(n.RENDERBUFFER,null),o=null),e.glRenderbuffer=null}}(ZG.instance,this._gpuTexture),ZG.instance.memoryStatus.textureSize-=this._size,this._gpuTexture=null)},n.resize=function(t,e){var n=this._size;this._width=t,this._height=e,this._size=mo(this._format,this.width,this.height,this.depth,this._levelCount)*this._layerCount,this._gpuTexture&&(this._gpuTexture.width=t,this._gpuTexture.height=e,this._gpuTexture.size=this._size,function(t,e){if(e.size){var n=t.gl,i=e.width,r=e.height;switch(e.type){case Pr.TEX2D:e.glTarget=n.TEXTURE_2D;var a=Math.max(i,r);if(a>t.capabilities.maxTextureSize&&b(9100,a,t.capabilities.maxTextureSize),e.glRenderbuffer)t.stateCache.glRenderbuffer!==e.glRenderbuffer&&(n.bindRenderbuffer(n.RENDERBUFFER,e.glRenderbuffer),t.stateCache.glRenderbuffer=e.glRenderbuffer),n.renderbufferStorage(n.RENDERBUFFER,e.glInternalFmt,i,r);else if(e.glTexture){var o=t.stateCache.glTexUnits[t.stateCache.texUnit];if(o.glTexture!==e.glTexture&&(n.bindTexture(n.TEXTURE_2D,e.glTexture),o.glTexture=e.glTexture),lo[e.format].isCompressed)for(var s=0;s<e.mipLevel;++s){var c=po(e.format,i,r,1),l=new Uint8Array(c);n.compressedTexImage2D(n.TEXTURE_2D,s,e.glInternalFmt,i,r,0,l),i=Math.max(1,i>>1),r=Math.max(1,r>>1)}else for(var u=0;u<e.mipLevel;++u)n.texImage2D(n.TEXTURE_2D,u,e.glInternalFmt,i,r,0,e.glFormat,e.glType,null),i=Math.max(1,i>>1),r=Math.max(1,r>>1)}break;case Pr.CUBE:e.glTarget=n.TEXTURE_CUBE_MAP;var h=Math.max(i,r);h>t.capabilities.maxCubeMapTextureSize&&b(9100,h,t.capabilities.maxTextureSize);var f=t.stateCache.glTexUnits[t.stateCache.texUnit];if(f.glTexture!==e.glTexture&&(n.bindTexture(n.TEXTURE_CUBE_MAP,e.glTexture),f.glTexture=e.glTexture),lo[e.format].isCompressed)for(var _=0;_<6;++_){i=e.width,r=e.height;for(var p=0;p<e.mipLevel;++p){var d=po(e.format,i,r,1),m=new Uint8Array(d);n.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+_,p,e.glInternalFmt,i,r,0,m),i=Math.max(1,i>>1),r=Math.max(1,r>>1)}}else for(var g=0;g<6;++g){i=e.width,r=e.height;for(var v=0;v<e.mipLevel;++v)n.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+g,v,e.glInternalFmt,i,r,0,e.glFormat,e.glType,null),i=Math.max(1,i>>1),r=Math.max(1,r>>1)}break;default:console.error("Unsupported TextureType, create texture failed."),e.type=Pr.TEX2D,e.glTarget=n.TEXTURE_2D}}}(ZG.instance,this._gpuTexture),ZG.instance.memoryStatus.textureSize-=n,ZG.instance.memoryStatus.textureSize+=this._size)},n.initAsSwapchainTexture=function(t){var e=new wa;e.format=t.format,e.usage=lo[t.format].hasDepth?Ir.DEPTH_STENCIL_ATTACHMENT:Ir.COLOR_ATTACHMENT,e.width=t.width,e.height=t.height,this.initialize(e,!0)},L(e,[{key:"gpuTexture",get:function(){return this._gpuTexture}}]),e}(Vo),VH="webglcontextlost";function jH(t,e){for(var n=["","WEBKIT_","MOZ_"],i=0;i<n.length;++i){var r=t.getExtension(n[i]+e);if(r)return r}return null}function WH(t){var e={EXT_texture_filter_anisotropic:jH(t,"EXT_texture_filter_anisotropic"),EXT_blend_minmax:jH(t,"EXT_blend_minmax"),EXT_frag_depth:jH(t,"EXT_frag_depth"),EXT_shader_texture_lod:jH(t,"EXT_shader_texture_lod"),EXT_sRGB:jH(t,"EXT_sRGB"),OES_vertex_array_object:jH(t,"OES_vertex_array_object"),EXT_color_buffer_half_float:jH(t,"EXT_color_buffer_half_float"),WEBGL_color_buffer_float:jH(t,"WEBGL_color_buffer_float"),WEBGL_compressed_texture_etc1:jH(t,"WEBGL_compressed_texture_etc1"),WEBGL_compressed_texture_etc:jH(t,"WEBGL_compressed_texture_etc"),WEBGL_compressed_texture_pvrtc:jH(t,"WEBGL_compressed_texture_pvrtc"),WEBGL_compressed_texture_s3tc:jH(t,"WEBGL_compressed_texture_s3tc"),WEBGL_compressed_texture_s3tc_srgb:jH(t,"WEBGL_compressed_texture_s3tc_srgb"),WEBGL_debug_shaders:jH(t,"WEBGL_debug_shaders"),WEBGL_draw_buffers:jH(t,"WEBGL_draw_buffers"),WEBGL_lose_context:jH(t,"WEBGL_lose_context"),WEBGL_depth_texture:jH(t,"WEBGL_depth_texture"),OES_texture_half_float:jH(t,"OES_texture_half_float"),OES_texture_half_float_linear:jH(t,"OES_texture_half_float_linear"),OES_texture_float:jH(t,"OES_texture_float"),OES_texture_float_linear:jH(t,"OES_texture_float_linear"),OES_standard_derivatives:jH(t,"OES_standard_derivatives"),OES_element_index_uint:jH(t,"OES_element_index_uint"),ANGLE_instanced_arrays:jH(t,"ANGLE_instanced_arrays"),WEBGL_debug_renderer_info:jH(t,"WEBGL_debug_renderer_info"),WEBGL_multi_draw:null,WEBGL_compressed_texture_astc:null,destroyShadersImmediately:!0,noCompressedTexSubImage2D:!1,isLocationActive:function(t){return!!t},useVAO:!1};return _n.os===ln.IOS&&14===_n.osMainVersion&&_n.isBrowser||(e.WEBGL_compressed_texture_astc=jH(t,"WEBGL_compressed_texture_astc")),_n.os!==ln.ANDROID&&_n.os!==ln.IOS&&(e.WEBGL_multi_draw=jH(t,"WEBGL_multi_draw")),_n.browserType===on.UC&&(e.ANGLE_instanced_arrays=null),_n.os===ln.IOS&&_n.osMainVersion<=10&&(e.destroyShadersImmediately=!1),e.OES_vertex_array_object&&(e.useVAO=!0),e}var XH=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).stateCache=new GH,e.cmdAllocator=new wH,e.nullTex2D=null,e.nullTexCube=null,e._canvas=null,e._webGLContextLostHandler=null,e._extensions=null,e}F(e,t);var n=e.prototype;return n.initialize=function(t){this._canvas=t.windowHandle,this._webGLContextLostHandler=this._onWebGLContextLost.bind(this),this._canvas.addEventListener(VH,this._onWebGLContextLost);var e=ZG.instance.gl;this.stateCache.initialize(ZG.instance.capabilities.maxTextureUnits,ZG.instance.capabilities.maxVertexAttributes),this._extensions=WH(e),function(t){t.activeTexture(t.TEXTURE0),t.pixelStorei(t.PACK_ALIGNMENT,1),t.pixelStorei(t.UNPACK_ALIGNMENT,1),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),t.bindFramebuffer(t.FRAMEBUFFER,null),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),t.frontFace(t.CCW),t.disable(t.POLYGON_OFFSET_FILL),t.polygonOffset(0,0),t.enable(t.DEPTH_TEST),t.depthMask(!0),t.depthFunc(t.LESS),t.depthRange(0,1),t.stencilFuncSeparate(t.FRONT,t.ALWAYS,1,65535),t.stencilOpSeparate(t.FRONT,t.KEEP,t.KEEP,t.KEEP),t.stencilMaskSeparate(t.FRONT,65535),t.stencilFuncSeparate(t.BACK,t.ALWAYS,1,65535),t.stencilOpSeparate(t.BACK,t.KEEP,t.KEEP,t.KEEP),t.stencilMaskSeparate(t.BACK,65535),t.disable(t.STENCIL_TEST),t.disable(t.SAMPLE_ALPHA_TO_COVERAGE),t.disable(t.BLEND),t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ONE,t.ZERO,t.ONE,t.ZERO),t.colorMask(!0,!0,!0,!0),t.blendColor(0,0,0,0)}(e);var n=Sr.RGBA8,i=Sr.DEPTH_STENCIL,r=e.getParameter(e.DEPTH_BITS),a=e.getParameter(e.STENCIL_BITS);r&&a?i=Sr.DEPTH_STENCIL:r&&(i=Sr.DEPTH),this._colorTexture=new HH,this._colorTexture.initAsSwapchainTexture({swapchain:this,format:n,width:t.width,height:t.height}),this._depthStencilTexture=new HH,this._depthStencilTexture.initAsSwapchainTexture({swapchain:this,format:i,width:t.width,height:t.height}),this.nullTex2D=ZG.instance.createTexture(new wa(Pr.TEX2D,Ir.SAMPLED,Sr.RGBA8,2,2,Rr.GEN_MIPMAP)),this.nullTexCube=ZG.instance.createTexture(new wa(Pr.CUBE,Ir.SAMPLED,Sr.RGBA8,2,2,Rr.GEN_MIPMAP,6));var o=new ma;o.texExtent.width=2,o.texExtent.height=2;var s=new Uint8Array(this.nullTex2D.size);s.fill(0),ZG.instance.copyBuffersToTexture([s],this.nullTex2D,[o]),o.texSubres.layerCount=6,ZG.instance.copyBuffersToTexture([s,s,s,s,s,s],this.nullTexCube,[o])},n.destroy=function(){this._canvas&&this._webGLContextLostHandler&&(this._canvas.removeEventListener(VH,this._webGLContextLostHandler),this._webGLContextLostHandler=null),this.nullTex2D&&(this.nullTex2D.destroy(),this.nullTex2D=null),this.nullTexCube&&(this.nullTexCube.destroy(),this.nullTexCube=null),this._extensions=null,this._canvas=null},n.resize=function(t,e){this._colorTexture.width===t&&this._colorTexture.height===e||(g("Resizing swapchain: "+t+"x"+e),this._canvas.width=t,this._canvas.height=e,this._colorTexture.resize(t,e),this._depthStencilTexture.resize(t,e))},n._onWebGLContextLost=function(t){E(11e3),p(t)},L(e,[{key:"extensions",get:function(){return this._extensions}}]),e}(Eo),qH=t("WebGLDevice",function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._swapchain=null,e._context=null,e}F(e,t);var n=e.prototype;return n.initialize=function(t){ZG.setInstance(this),this._gfxAPI=vr.WEBGL,this._bindingMappingInfo=t.bindingMappingInfo,this._bindingMappingInfo.bufferOffsets.length||this._bindingMappingInfo.bufferOffsets.push(0),this._bindingMappingInfo.samplerOffsets.length||this._bindingMappingInfo.samplerOffsets.push(0);var e=this._context=function(t){var e=null;try{var n={alpha:$t.ENABLE_TRANSPARENT_CANVAS,antialias:$t.ENABLE_WEBGL_ANTIALIAS,depth:!0,stencil:!0,premultipliedAlpha:!1,preserveDrawingBuffer:!1,powerPreference:"default",failIfMajorPerformanceCaveat:!1};e=t.getContext("webgl",n)}catch(t){return null}return e}(Ao.canvas);if(!e)return console.error("This device does not support WebGL."),!1;this._queue=this.createQueue(new no($r.GRAPHICS)),this._cmdBuff=this.createCommandBuffer(new eo(this._queue)),this._caps.maxVertexAttributes=e.getParameter(e.MAX_VERTEX_ATTRIBS),this._caps.maxVertexUniformVectors=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),this._caps.maxFragmentUniformVectors=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),this._caps.maxTextureUnits=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),this._caps.maxVertexTextureUnits=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this._caps.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this._caps.maxCubeMapTextureSize=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),this._caps.maxUniformBufferBindings=16;var n=e.getSupportedExtensions(),i="";if(n)for(var r,a=W(n);!(r=a()).done;)i+=r.value+" ";var o=WH(e);o.WEBGL_debug_renderer_info?(this._renderer=e.getParameter(o.WEBGL_debug_renderer_info.UNMASKED_RENDERER_WEBGL),this._vendor=e.getParameter(o.WEBGL_debug_renderer_info.UNMASKED_VENDOR_WEBGL)):(this._renderer=e.getParameter(e.RENDERER),this._vendor=e.getParameter(e.VENDOR));var s=e.getParameter(e.VERSION);this._features.fill(!1),o.EXT_sRGB&&(this._features[xr.FORMAT_SRGB]=!0),o.EXT_blend_minmax&&(this._features[xr.BLEND_MINMAX]=!0),o.WEBGL_color_buffer_float&&(this._features[xr.COLOR_FLOAT]=!0),o.EXT_color_buffer_half_float&&(this._features[xr.COLOR_HALF_FLOAT]=!0),o.OES_texture_float&&(this._features[xr.TEXTURE_FLOAT]=!0),o.OES_texture_half_float&&(this._features[xr.TEXTURE_HALF_FLOAT]=!0),o.OES_texture_float_linear&&(this._features[xr.TEXTURE_FLOAT_LINEAR]=!0),o.OES_texture_half_float_linear&&(this._features[xr.TEXTURE_HALF_FLOAT_LINEAR]=!0),this._features[xr.FORMAT_RGB8]=!0,o.OES_element_index_uint&&(this._features[xr.ELEMENT_INDEX_UINT]=!0),o.ANGLE_instanced_arrays&&(this._features[xr.INSTANCED_ARRAYS]=!0),o.WEBGL_draw_buffers&&(this._features[xr.MULTIPLE_RENDER_TARGETS]=!0);var c="";return o.WEBGL_compressed_texture_etc1&&(this._features[xr.FORMAT_ETC1]=!0,c+="etc1 "),o.WEBGL_compressed_texture_etc&&(this._features[xr.FORMAT_ETC2]=!0,c+="etc2 "),o.WEBGL_compressed_texture_s3tc&&(this._features[xr.FORMAT_DXT]=!0,c+="dxt "),o.WEBGL_compressed_texture_pvrtc&&(this._features[xr.FORMAT_PVRTC]=!0,c+="pvrtc "),o.WEBGL_compressed_texture_astc&&(this._features[xr.FORMAT_ASTC]=!0,c+="astc "),g("WebGL device initialized."),g("RENDERER: "+this._renderer),g("VENDOR: "+this._vendor),g("VERSION: "+s),g("COMPRESSED_FORMAT: "+c),g("EXTENSIONS: "+i),!0},n.destroy=function(){this._queue&&(this._queue.destroy(),this._queue=null),this._cmdBuff&&(this._cmdBuff.destroy(),this._cmdBuff=null)},n.flushCommands=function(){},n.acquire=function(){},n.present=function(){var t=this._queue;this._numDrawCalls=t.numDrawCalls,this._numInstances=t.numInstances,this._numTris=t.numTris,t.clear()},n.createCommandBuffer=function(t){var e=new(t.type===ea.PRIMARY?LH:PH);return e.initialize(t),e},n.createSwapchain=function(t){var e=new XH;return this._swapchain=e,e.initialize(t),e},n.createBuffer=function(t){var e=new CH;return e.initialize(t),e},n.createTexture=function(t){var e=new HH;return e.initialize(t),e},n.createDescriptorSet=function(t){var e=new QG;return e.initialize(t),e},n.createShader=function(t){var e=new kH;return e.initialize(t),e},n.createInputAssembler=function(t){var e=new RH;return e.initialize(t),e},n.createRenderPass=function(t){var e=new FH;return e.initialize(t),e},n.createFramebuffer=function(t){var e=new IH;return e.initialize(t),e},n.createDescriptorSetLayout=function(t){var e=new DH;return e.initialize(t),e},n.createPipelineLayout=function(t){var e=new OH;return e.initialize(t),e},n.createPipelineState=function(t){var e=new NH;return e.initialize(t),e},n.createQueue=function(t){var e=new BH;return e.initialize(t),e},n.getSampler=function(t){var e=Go.computeHash(t);return this._samplers.has(e)||this._samplers.set(e,new UH(t,e)),this._samplers.get(e)},n.getGlobalBarrier=function(t){var e=jo.computeHash(t);return this._globalBarriers.has(e)||this._globalBarriers.set(e,new jo(t,e)),this._globalBarriers.get(e)},n.getTextureBarrier=function(t){var e=Wo.computeHash(t);return this._textureBarriers.has(e)||this._textureBarriers.set(e,new Wo(t,e)),this._textureBarriers.get(e)},n.copyBuffersToTexture=function(t,e,n){AH(this,t,e.gpuTexture,n)},n.copyTextureToBuffers=function(t,e,n){!function(t,e,n,i){var r=t.gl,a=t.stateCache,o=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,o);var s=0,c=0,l=1,u=1;switch(e.glTarget){case r.TEXTURE_2D:for(var h=0;h<i.length;h++){var f=i[h];r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,e.glTarget,e.glTexture,f.texSubres.mipLevel),s=f.texOffset.x,c=f.texOffset.y,l=f.texExtent.width,u=f.texExtent.height,r.readPixels(s,c,l,u,e.glFormat,e.glType,n[h])}break;default:console.error("Unsupported GL texture type, copy texture to buffers failed.")}r.bindFramebuffer(r.FRAMEBUFFER,null),a.glFramebuffer=null,r.deleteFramebuffer(o)}(this,t.gpuTexture,e,n)},n.copyTexImagesToTexture=function(t,e,n){!function(t,e,n,i){var r=t.gl,a=t.stateCache.glTexUnits[t.stateCache.texUnit];a.glTexture!==n.glTexture&&(r.bindTexture(n.glTarget,n.glTexture),a.glTexture=n.glTexture);var o=0,s=0;switch(n.glTarget){case r.TEXTURE_2D:for(var c=0;c<i.length;c++){var l=i[c];r.texSubImage2D(r.TEXTURE_2D,l.texSubres.mipLevel,l.texOffset.x,l.texOffset.y,n.glFormat,n.glType,e[o++])}break;case r.TEXTURE_CUBE_MAP:for(var u=0;u<i.length;u++){var h=i[u],f=h.texSubres.baseArrayLayer+h.texSubres.layerCount;for(s=h.texSubres.baseArrayLayer;s<f;++s)r.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+s,h.texSubres.mipLevel,h.texOffset.x,h.texOffset.y,n.glFormat,n.glType,e[o++])}break;default:console.error("Unsupported GL texture type, copy buffer to texture failed.")}n.flags&Rr.GEN_MIPMAP&&n.isPowerOf2&&r.generateMipmap(n.glTarget)}(this,t,e.gpuTexture,n)},L(e,[{key:"gl",get:function(){return this._context}},{key:"extensions",get:function(){return this._swapchain.extensions}},{key:"stateCache",get:function(){return this._swapchain.stateCache}},{key:"nullTex2D",get:function(){return this._swapchain.nullTex2D}},{key:"nullTexCube",get:function(){return this._swapchain.nullTexCube}}]),e}(Ao));i.WebGLDevice=qH;var YH,KH=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._gpuDescriptorSet=null,e}F(e,t);var n=e.prototype;return n.initialize=function(t){this._layout=t.layout;var e=t.layout.gpuDescriptorSetLayout,n=e.bindings,i=e.descriptorIndices,r=e.descriptorCount;this._buffers=Array(r).fill(null),this._textures=Array(r).fill(null),this._samplers=Array(r).fill(null);var a=[];this._gpuDescriptorSet={gpuDescriptors:a,descriptorIndices:i};for(var o=0;o<n.length;++o)for(var s=n[o],c=0;c<s.count;c++)a.push({type:s.descriptorType,gpuBuffer:null,gpuTexture:null,gpuSampler:null})},n.destroy=function(){this._layout=null,this._gpuDescriptorSet=null},n.update=function(){if(this._isDirty&&this._gpuDescriptorSet){for(var t=this._gpuDescriptorSet.gpuDescriptors,e=0;e<t.length;++e)t[e].type&uo?this._buffers[e]&&(t[e].gpuBuffer=this._buffers[e].gpuBuffer):t[e].type&ho&&(this._textures[e]&&(t[e].gpuTexture=this._textures[e].gpuTexture),this._samplers[e]&&(t[e].gpuSampler=this._samplers[e].gpuSampler));this._isDirty=!1}},L(e,[{key:"gpuDescriptorSet",get:function(){return this._gpuDescriptorSet}}]),e}(Ro);!function(t){t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",t[t.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",t[t.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",t[t.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR"}(YH||(YH={}));var QH=function(){function t(){}return t.setInstance=function(e){t._instance=e},L(t,null,[{key:"instance",get:function(){return t._instance}}]),t}();QH._instance=null;var ZH=[10497,33648,33071,33071],JH=new Float32Array(4);function $H(t,e){switch(t){case Sr.R8:return e.UNSIGNED_BYTE;case Sr.R8SN:return e.BYTE;case Sr.R8UI:return e.UNSIGNED_BYTE;case Sr.R8I:return e.BYTE;case Sr.R16F:return e.HALF_FLOAT;case Sr.R16UI:return e.UNSIGNED_SHORT;case Sr.R16I:return e.SHORT;case Sr.R32F:return e.FLOAT;case Sr.R32UI:return e.UNSIGNED_INT;case Sr.R32I:return e.INT;case Sr.RG8:return e.UNSIGNED_BYTE;case Sr.RG8SN:return e.BYTE;case Sr.RG8UI:return e.UNSIGNED_BYTE;case Sr.RG8I:return e.BYTE;case Sr.RG16F:return e.HALF_FLOAT;case Sr.RG16UI:return e.UNSIGNED_SHORT;case Sr.RG16I:return e.SHORT;case Sr.RG32F:return e.FLOAT;case Sr.RG32UI:return e.UNSIGNED_INT;case Sr.RG32I:return e.INT;case Sr.RGB8:case Sr.SRGB8:return e.UNSIGNED_BYTE;case Sr.RGB8SN:return e.BYTE;case Sr.RGB8UI:return e.UNSIGNED_BYTE;case Sr.RGB8I:return e.BYTE;case Sr.RGB16F:return e.HALF_FLOAT;case Sr.RGB16UI:return e.UNSIGNED_SHORT;case Sr.RGB16I:return e.SHORT;case Sr.RGB32F:return e.FLOAT;case Sr.RGB32UI:return e.UNSIGNED_INT;case Sr.RGB32I:return e.INT;case Sr.BGRA8:case Sr.RGBA8:case Sr.SRGB8_A8:return e.UNSIGNED_BYTE;case Sr.RGBA8SN:return e.BYTE;case Sr.RGBA8UI:return e.UNSIGNED_BYTE;case Sr.RGBA8I:return e.BYTE;case Sr.RGBA16F:return e.HALF_FLOAT;case Sr.RGBA16UI:return e.UNSIGNED_SHORT;case Sr.RGBA16I:return e.SHORT;case Sr.RGBA32F:return e.FLOAT;case Sr.RGBA32UI:return e.UNSIGNED_INT;case Sr.RGBA32I:return e.INT;case Sr.R5G6B5:return e.UNSIGNED_SHORT_5_6_5;case Sr.R11G11B10F:return e.UNSIGNED_INT_10F_11F_11F_REV;case Sr.RGB5A1:return e.UNSIGNED_SHORT_5_5_5_1;case Sr.RGBA4:return e.UNSIGNED_SHORT_4_4_4_4;case Sr.RGB10A2:case Sr.RGB10A2UI:return e.UNSIGNED_INT_2_10_10_10_REV;case Sr.RGB9E5:case Sr.DEPTH:return e.FLOAT;case Sr.DEPTH_STENCIL:return e.UNSIGNED_INT_24_8;case Sr.BC1:case Sr.BC1_SRGB:case Sr.BC2:case Sr.BC2_SRGB:case Sr.BC3:case Sr.BC3_SRGB:case Sr.BC4:return e.UNSIGNED_BYTE;case Sr.BC4_SNORM:return e.BYTE;case Sr.BC5:return e.UNSIGNED_BYTE;case Sr.BC5_SNORM:return e.BYTE;case Sr.BC6H_SF16:case Sr.BC6H_UF16:return e.FLOAT;case Sr.BC7:case Sr.BC7_SRGB:case Sr.ETC_RGB8:case Sr.ETC2_RGB8:case Sr.ETC2_SRGB8:case Sr.ETC2_RGB8_A1:case Sr.ETC2_SRGB8_A1:case Sr.EAC_R11:return e.UNSIGNED_BYTE;case Sr.EAC_R11SN:return e.BYTE;case Sr.EAC_RG11:return e.UNSIGNED_BYTE;case Sr.EAC_RG11SN:return e.BYTE;case Sr.PVRTC_RGB2:case Sr.PVRTC_RGBA2:case Sr.PVRTC_RGB4:case Sr.PVRTC_RGBA4:case Sr.PVRTC2_2BPP:case Sr.PVRTC2_4BPP:return e.UNSIGNED_BYTE;case Sr.ASTC_RGBA_4X4:case Sr.ASTC_RGBA_5X4:case Sr.ASTC_RGBA_5X5:case Sr.ASTC_RGBA_6X5:case Sr.ASTC_RGBA_6X6:case Sr.ASTC_RGBA_8X5:case Sr.ASTC_RGBA_8X6:case Sr.ASTC_RGBA_8X8:case Sr.ASTC_RGBA_10X5:case Sr.ASTC_RGBA_10X6:case Sr.ASTC_RGBA_10X8:case Sr.ASTC_RGBA_10X10:case Sr.ASTC_RGBA_12X10:case Sr.ASTC_RGBA_12X12:case Sr.ASTC_SRGBA_4X4:case Sr.ASTC_SRGBA_5X4:case Sr.ASTC_SRGBA_5X5:case Sr.ASTC_SRGBA_6X5:case Sr.ASTC_SRGBA_6X6:case Sr.ASTC_SRGBA_8X5:case Sr.ASTC_SRGBA_8X6:case Sr.ASTC_SRGBA_8X8:case Sr.ASTC_SRGBA_10X5:case Sr.ASTC_SRGBA_10X6:case Sr.ASTC_SRGBA_10X8:case Sr.ASTC_SRGBA_10X10:case Sr.ASTC_SRGBA_12X10:case Sr.ASTC_SRGBA_12X12:default:return e.UNSIGNED_BYTE}}function tV(t,e){switch(t){case Ar.BOOL:return e.BOOL;case Ar.BOOL2:return e.BOOL_VEC2;case Ar.BOOL3:return e.BOOL_VEC3;case Ar.BOOL4:return e.BOOL_VEC4;case Ar.INT:return e.INT;case Ar.INT2:return e.INT_VEC2;case Ar.INT3:return e.INT_VEC3;case Ar.INT4:return e.INT_VEC4;case Ar.UINT:return e.UNSIGNED_INT;case Ar.FLOAT:return e.FLOAT;case Ar.FLOAT2:return e.FLOAT_VEC2;case Ar.FLOAT3:return e.FLOAT_VEC3;case Ar.FLOAT4:return e.FLOAT_VEC4;case Ar.MAT2:return e.FLOAT_MAT2;case Ar.MAT2X3:return e.FLOAT_MAT2x3;case Ar.MAT2X4:return e.FLOAT_MAT2x4;case Ar.MAT3X2:return e.FLOAT_MAT3x2;case Ar.MAT3:return e.FLOAT_MAT3;case Ar.MAT3X4:return e.FLOAT_MAT3x4;case Ar.MAT4X2:return e.FLOAT_MAT4x2;case Ar.MAT4X3:return e.FLOAT_MAT4x3;case Ar.MAT4:return e.FLOAT_MAT4;case Ar.SAMPLER2D:return e.SAMPLER_2D;case Ar.SAMPLER2D_ARRAY:return e.SAMPLER_2D_ARRAY;case Ar.SAMPLER3D:return e.SAMPLER_3D;case Ar.SAMPLER_CUBE:return e.SAMPLER_CUBE;default:return console.error("Unsupported GLType, convert to GL type failed."),Ar.UNKNOWN}}function eV(t,e){switch(t){case e.BOOL:return Ar.BOOL;case e.BOOL_VEC2:return Ar.BOOL2;case e.BOOL_VEC3:return Ar.BOOL3;case e.BOOL_VEC4:return Ar.BOOL4;case e.INT:return Ar.INT;case e.INT_VEC2:return Ar.INT2;case e.INT_VEC3:return Ar.INT3;case e.INT_VEC4:return Ar.INT4;case e.UNSIGNED_INT:return Ar.UINT;case e.UNSIGNED_INT_VEC2:return Ar.UINT2;case e.UNSIGNED_INT_VEC3:return Ar.UINT3;case e.UNSIGNED_INT_VEC4:return Ar.UINT4;case e.FLOAT:return Ar.FLOAT;case e.FLOAT_VEC2:return Ar.FLOAT2;case e.FLOAT_VEC3:return Ar.FLOAT3;case e.FLOAT_VEC4:return Ar.FLOAT4;case e.FLOAT_MAT2:return Ar.MAT2;case e.FLOAT_MAT2x3:return Ar.MAT2X3;case e.FLOAT_MAT2x4:return Ar.MAT2X4;case e.FLOAT_MAT3x2:return Ar.MAT3X2;case e.FLOAT_MAT3:return Ar.MAT3;case e.FLOAT_MAT3x4:return Ar.MAT3X4;case e.FLOAT_MAT4x2:return Ar.MAT4X2;case e.FLOAT_MAT4x3:return Ar.MAT4X3;case e.FLOAT_MAT4:return Ar.MAT4;case e.SAMPLER_2D:return Ar.SAMPLER2D;case e.SAMPLER_2D_ARRAY:return Ar.SAMPLER2D_ARRAY;case e.SAMPLER_3D:return Ar.SAMPLER3D;case e.SAMPLER_CUBE:return Ar.SAMPLER_CUBE;default:return console.error("Unsupported GLType, convert to Type failed."),Ar.UNKNOWN}}function nV(t,e){switch(t){case e.BOOL:return 4;case e.BOOL_VEC2:return 8;case e.BOOL_VEC3:return 12;case e.BOOL_VEC4:return 16;case e.INT:return 4;case e.INT_VEC2:return 8;case e.INT_VEC3:return 12;case e.INT_VEC4:return 16;case e.UNSIGNED_INT:return 4;case e.UNSIGNED_INT_VEC2:return 8;case e.UNSIGNED_INT_VEC3:return 12;case e.UNSIGNED_INT_VEC4:return 16;case e.FLOAT:return 4;case e.FLOAT_VEC2:return 8;case e.FLOAT_VEC3:return 12;case e.FLOAT_VEC4:case e.FLOAT_MAT2:return 16;case e.FLOAT_MAT2x3:return 24;case e.FLOAT_MAT2x4:return 32;case e.FLOAT_MAT3x2:return 24;case e.FLOAT_MAT3:return 36;case e.FLOAT_MAT3x4:return 48;case e.FLOAT_MAT4x2:return 32;case e.FLOAT_MAT4x3:return 48;case e.FLOAT_MAT4:return 64;case e.SAMPLER_2D:case e.SAMPLER_2D_ARRAY:case e.SAMPLER_2D_ARRAY_SHADOW:case e.SAMPLER_3D:case e.SAMPLER_CUBE:case e.INT_SAMPLER_2D:case e.INT_SAMPLER_2D_ARRAY:case e.INT_SAMPLER_3D:case e.INT_SAMPLER_CUBE:case e.UNSIGNED_INT_SAMPLER_2D:case e.UNSIGNED_INT_SAMPLER_2D_ARRAY:case e.UNSIGNED_INT_SAMPLER_3D:case e.UNSIGNED_INT_SAMPLER_CUBE:return 4;default:return console.error("Unsupported GLType, get type failed."),0}}function iV(t,e){switch(t){case e.FLOAT_MAT2:case e.FLOAT_MAT2x3:case e.FLOAT_MAT2x4:return 2;case e.FLOAT_MAT3x2:case e.FLOAT_MAT3:case e.FLOAT_MAT3x4:return 3;case e.FLOAT_MAT4x2:case e.FLOAT_MAT4x3:case e.FLOAT_MAT4:return 4;default:return 1}}var rV,aV=[512,513,514,515,516,517,518,519],oV=[0,7680,7681,7682,7683,5386,34055,34056],sV=[32774,32778,32779,32775,32776],cV=[0,1,770,772,771,773,768,774,769,775,776,32769,32770,32771,32772];!function(t){t[t.BEGIN_RENDER_PASS=0]="BEGIN_RENDER_PASS",t[t.END_RENDER_PASS=1]="END_RENDER_PASS",t[t.BIND_STATES=2]="BIND_STATES",t[t.DRAW=3]="DRAW",t[t.UPDATE_BUFFER=4]="UPDATE_BUFFER",t[t.COPY_BUFFER_TO_TEXTURE=5]="COPY_BUFFER_TO_TEXTURE",t[t.COUNT=6]="COUNT"}(rV||(rV={}));var lV=function(t){this.cmdType=void 0,this.refCount=0,this.cmdType=t},uV=function(t){function e(){var e;return(e=t.call(this,rV.BEGIN_RENDER_PASS)||this).gpuRenderPass=null,e.gpuFramebuffer=null,e.renderArea=new ua,e.clearColors=[],e.clearDepth=1,e.clearStencil=0,e}return F(e,t),e.prototype.clear=function(){this.gpuFramebuffer=null,this.clearColors.length=0},e}(lV),hV=function(t){function e(){var e;return(e=t.call(this,rV.BIND_STATES)||this).gpuPipelineState=null,e.gpuInputAssembler=null,e.gpuDescriptorSets=[],e.dynamicOffsets=[],e.dynamicStates=new so,e}return F(e,t),e.prototype.clear=function(){this.gpuPipelineState=null,this.gpuInputAssembler=null,this.gpuDescriptorSets.length=0,this.dynamicOffsets.length=0},e}(lV),fV=function(t){function e(){var e;return(e=t.call(this,rV.DRAW)||this).drawInfo=new Ea,e}return F(e,t),e.prototype.clear=function(){},e}(lV),_V=function(t){function e(){var e;return(e=t.call(this,rV.UPDATE_BUFFER)||this).gpuBuffer=null,e.buffer=null,e.offset=0,e.size=0,e}return F(e,t),e.prototype.clear=function(){this.gpuBuffer=null,this.buffer=null},e}(lV),pV=function(t){function e(){var e;return(e=t.call(this,rV.COPY_BUFFER_TO_TEXTURE)||this).gpuTexture=null,e.buffers=[],e.regions=[],e}return F(e,t),e.prototype.clear=function(){this.gpuTexture=null,this.buffers.length=0,this.regions.length=0},e}(lV),dV=function(){function t(){this.cmds=new Xt(1),this.beginRenderPassCmds=new Xt(1),this.bindStatesCmds=new Xt(1),this.drawCmds=new Xt(1),this.updateBufferCmds=new Xt(1),this.copyBufferToTextureCmds=new Xt(1)}return t.prototype.clearCmds=function(t){this.beginRenderPassCmds.length&&(t.beginRenderPassCmdPool.freeCmds(this.beginRenderPassCmds),this.beginRenderPassCmds.clear()),this.bindStatesCmds.length&&(t.bindStatesCmdPool.freeCmds(this.bindStatesCmds),this.bindStatesCmds.clear()),this.drawCmds.length&&(t.drawCmdPool.freeCmds(this.drawCmds),this.drawCmds.clear()),this.updateBufferCmds.length&&(t.updateBufferCmdPool.freeCmds(this.updateBufferCmds),this.updateBufferCmds.clear()),this.copyBufferToTextureCmds.length&&(t.copyBufferToTextureCmdPool.freeCmds(this.copyBufferToTextureCmds),this.copyBufferToTextureCmds.clear()),this.cmds.clear()},t}();function mV(t,e,n,i,r){if(e.usage&Er.INDIRECT){e.indirects.clearDraws();for(var a=n.drawInfos,o=0;o<a.length;++o)e.indirects.setDrawInfo(i+o,a[o])}else{var s=n,c=t.gl,l=t.stateCache;switch(e.glTarget){case c.ARRAY_BUFFER:t.extensions.useVAO&&l.glVAO&&(c.bindVertexArray(null),l.glVAO=null),yV.gpuInputAssembler=null,l.glArrayBuffer!==e.glBuffer&&(c.bindBuffer(c.ARRAY_BUFFER,e.glBuffer),l.glArrayBuffer=e.glBuffer),r===s.byteLength?c.bufferSubData(e.glTarget,i,s):c.bufferSubData(e.glTarget,i,s.slice(0,r));break;case c.ELEMENT_ARRAY_BUFFER:t.extensions.useVAO&&l.glVAO&&(c.bindVertexArray(null),l.glVAO=null),yV.gpuInputAssembler=null,l.glElementArrayBuffer!==e.glBuffer&&(c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,e.glBuffer),l.glElementArrayBuffer=e.glBuffer),r===s.byteLength?c.bufferSubData(e.glTarget,i,s):c.bufferSubData(e.glTarget,i,s.slice(0,r));break;case c.UNIFORM_BUFFER:l.glUniformBuffer!==e.glBuffer&&(c.bindBuffer(c.UNIFORM_BUFFER,e.glBuffer),l.glUniformBuffer=e.glBuffer),r===s.byteLength?c.bufferSubData(e.glTarget,i,s):c.bufferSubData(e.glTarget,i,new Float32Array(s,0,r/4));break;default:console.error("Unsupported BufferType, update buffer failed.")}}}function gV(t,e){var n=t.gl;e.glInternalFmt=function(t,e){switch(t){case Sr.A8:return e.ALPHA;case Sr.L8:return e.LUMINANCE;case Sr.LA8:return e.LUMINANCE_ALPHA;case Sr.R8:return e.R8;case Sr.R8SN:return e.R8_SNORM;case Sr.R8UI:return e.R8UI;case Sr.R8I:return e.R8I;case Sr.RG8:return e.RG8;case Sr.RG8SN:return e.RG8_SNORM;case Sr.RG8UI:return e.RG8UI;case Sr.RG8I:return e.RG8I;case Sr.RGB8:return e.RGB8;case Sr.RGB8SN:return e.RGB8_SNORM;case Sr.RGB8UI:return e.RGB8UI;case Sr.RGB8I:return e.RGB8I;case Sr.BGRA8:case Sr.RGBA8:return e.RGBA8;case Sr.RGBA8SN:return e.RGBA8_SNORM;case Sr.RGBA8UI:return e.RGBA8UI;case Sr.RGBA8I:return e.RGBA8I;case Sr.R16I:return e.R16I;case Sr.R16UI:return e.R16UI;case Sr.R16F:return e.R16F;case Sr.RG16I:return e.RG16I;case Sr.RG16UI:return e.RG16UI;case Sr.RG16F:return e.RG16F;case Sr.RGB16I:return e.RGB16I;case Sr.RGB16UI:return e.RGB16UI;case Sr.RGB16F:return e.RGB16F;case Sr.RGBA16I:return e.RGBA16I;case Sr.RGBA16UI:return e.RGBA16UI;case Sr.RGBA16F:return e.RGBA16F;case Sr.R32I:return e.R32I;case Sr.R32UI:return e.R32UI;case Sr.R32F:return e.R32F;case Sr.RG32I:return e.RG32I;case Sr.RG32UI:return e.RG32UI;case Sr.RG32F:return e.RG32F;case Sr.RGB32I:return e.RGB32I;case Sr.RGB32UI:return e.RGB32UI;case Sr.RGB32F:return e.RGB32F;case Sr.RGBA32I:return e.RGBA32I;case Sr.RGBA32UI:return e.RGBA32UI;case Sr.RGBA32F:return e.RGBA32F;case Sr.R5G6B5:return e.RGB565;case Sr.RGB5A1:return e.RGB5_A1;case Sr.RGBA4:return e.RGBA4;case Sr.SRGB8:return e.SRGB8;case Sr.SRGB8_A8:return e.SRGB8_ALPHA8;case Sr.RGB10A2:return e.RGB10_A2;case Sr.RGB10A2UI:return e.RGB10_A2UI;case Sr.R11G11B10F:return e.R11F_G11F_B10F;case Sr.DEPTH:return e.DEPTH_COMPONENT32F;case Sr.DEPTH_STENCIL:return e.DEPTH24_STENCIL8;case Sr.BC1:return YH.COMPRESSED_RGB_S3TC_DXT1_EXT;case Sr.BC1_ALPHA:return YH.COMPRESSED_RGBA_S3TC_DXT1_EXT;case Sr.BC1_SRGB:return YH.COMPRESSED_SRGB_S3TC_DXT1_EXT;case Sr.BC1_SRGB_ALPHA:return YH.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;case Sr.BC2:return YH.COMPRESSED_RGBA_S3TC_DXT3_EXT;case Sr.BC2_SRGB:return YH.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;case Sr.BC3:return YH.COMPRESSED_RGBA_S3TC_DXT5_EXT;case Sr.BC3_SRGB:return YH.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;case Sr.ETC_RGB8:return YH.COMPRESSED_RGB_ETC1_WEBGL;case Sr.ETC2_RGB8:return YH.COMPRESSED_RGB8_ETC2;case Sr.ETC2_SRGB8:return YH.COMPRESSED_SRGB8_ETC2;case Sr.ETC2_RGB8_A1:return YH.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2;case Sr.ETC2_SRGB8_A1:return YH.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2;case Sr.ETC2_RGBA8:return YH.COMPRESSED_RGBA8_ETC2_EAC;case Sr.ETC2_SRGB8_A8:return YH.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC;case Sr.EAC_R11:return YH.COMPRESSED_R11_EAC;case Sr.EAC_R11SN:return YH.COMPRESSED_SIGNED_R11_EAC;case Sr.EAC_RG11:return YH.COMPRESSED_RG11_EAC;case Sr.EAC_RG11SN:return YH.COMPRESSED_SIGNED_RG11_EAC;case Sr.PVRTC_RGB2:return YH.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;case Sr.PVRTC_RGBA2:return YH.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;case Sr.PVRTC_RGB4:return YH.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;case Sr.PVRTC_RGBA4:return YH.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;case Sr.ASTC_RGBA_4X4:return YH.COMPRESSED_RGBA_ASTC_4x4_KHR;case Sr.ASTC_RGBA_5X4:return YH.COMPRESSED_RGBA_ASTC_5x4_KHR;case Sr.ASTC_RGBA_5X5:return YH.COMPRESSED_RGBA_ASTC_5x5_KHR;case Sr.ASTC_RGBA_6X5:return YH.COMPRESSED_RGBA_ASTC_6x5_KHR;case Sr.ASTC_RGBA_6X6:return YH.COMPRESSED_RGBA_ASTC_6x6_KHR;case Sr.ASTC_RGBA_8X5:return YH.COMPRESSED_RGBA_ASTC_8x5_KHR;case Sr.ASTC_RGBA_8X6:return YH.COMPRESSED_RGBA_ASTC_8x6_KHR;case Sr.ASTC_RGBA_8X8:return YH.COMPRESSED_RGBA_ASTC_8x8_KHR;case Sr.ASTC_RGBA_10X5:return YH.COMPRESSED_RGBA_ASTC_10x5_KHR;case Sr.ASTC_RGBA_10X6:return YH.COMPRESSED_RGBA_ASTC_10x6_KHR;case Sr.ASTC_RGBA_10X8:return YH.COMPRESSED_RGBA_ASTC_10x8_KHR;case Sr.ASTC_RGBA_10X10:return YH.COMPRESSED_RGBA_ASTC_10x10_KHR;case Sr.ASTC_RGBA_12X10:return YH.COMPRESSED_RGBA_ASTC_12x10_KHR;case Sr.ASTC_RGBA_12X12:return YH.COMPRESSED_RGBA_ASTC_12x12_KHR;case Sr.ASTC_SRGBA_4X4:return YH.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;case Sr.ASTC_SRGBA_5X4:return YH.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR;case Sr.ASTC_SRGBA_5X5:return YH.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR;case Sr.ASTC_SRGBA_6X5:return YH.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR;case Sr.ASTC_SRGBA_6X6:return YH.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR;case Sr.ASTC_SRGBA_8X5:return YH.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR;case Sr.ASTC_SRGBA_8X6:return YH.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR;case Sr.ASTC_SRGBA_8X8:return YH.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR;case Sr.ASTC_SRGBA_10X5:return YH.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR;case Sr.ASTC_SRGBA_10X6:return YH.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR;case Sr.ASTC_SRGBA_10X8:return YH.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR;case Sr.ASTC_SRGBA_10X10:return YH.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR;case Sr.ASTC_SRGBA_12X10:return YH.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR;case Sr.ASTC_SRGBA_12X12:return YH.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR;default:return console.error("Unsupported Format, convert to WebGL internal format failed."),e.RGBA}}(e.format,n),e.glFormat=function(t,e){switch(t){case Sr.A8:return e.ALPHA;case Sr.L8:return e.LUMINANCE;case Sr.LA8:return e.LUMINANCE_ALPHA;case Sr.R8:case Sr.R8SN:return e.RED;case Sr.R8UI:case Sr.R8I:return e.RED;case Sr.RG8:case Sr.RG8SN:case Sr.RG8UI:case Sr.RG8I:return e.RG;case Sr.RGB8:case Sr.RGB8SN:case Sr.RGB8UI:case Sr.RGB8I:return e.RGB;case Sr.BGRA8:case Sr.RGBA8:case Sr.RGBA8SN:case Sr.RGBA8UI:case Sr.RGBA8I:return e.RGBA;case Sr.R16UI:case Sr.R16I:case Sr.R16F:return e.RED;case Sr.RG16UI:case Sr.RG16I:case Sr.RG16F:return e.RG;case Sr.RGB16UI:case Sr.RGB16I:case Sr.RGB16F:return e.RGB;case Sr.RGBA16UI:case Sr.RGBA16I:case Sr.RGBA16F:return e.RGBA;case Sr.R32UI:case Sr.R32I:case Sr.R32F:return e.RED;case Sr.RG32UI:case Sr.RG32I:case Sr.RG32F:return e.RG;case Sr.RGB32UI:case Sr.RGB32I:case Sr.RGB32F:return e.RGB;case Sr.RGBA32UI:case Sr.RGBA32I:case Sr.RGBA32F:case Sr.RGB10A2:return e.RGBA;case Sr.R11G11B10F:case Sr.R5G6B5:return e.RGB;case Sr.RGB5A1:case Sr.RGBA4:return e.RGBA;case Sr.SRGB8:return e.RGB;case Sr.SRGB8_A8:return e.RGBA;case Sr.DEPTH:return e.DEPTH_COMPONENT;case Sr.DEPTH_STENCIL:return e.DEPTH_STENCIL;case Sr.BC1:return YH.COMPRESSED_RGB_S3TC_DXT1_EXT;case Sr.BC1_ALPHA:return YH.COMPRESSED_RGBA_S3TC_DXT1_EXT;case Sr.BC1_SRGB:return YH.COMPRESSED_SRGB_S3TC_DXT1_EXT;case Sr.BC1_SRGB_ALPHA:return YH.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;case Sr.BC2:return YH.COMPRESSED_RGBA_S3TC_DXT3_EXT;case Sr.BC2_SRGB:return YH.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;case Sr.BC3:return YH.COMPRESSED_RGBA_S3TC_DXT5_EXT;case Sr.BC3_SRGB:return YH.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;case Sr.ETC_RGB8:return YH.COMPRESSED_RGB_ETC1_WEBGL;case Sr.ETC2_RGB8:return YH.COMPRESSED_RGB8_ETC2;case Sr.ETC2_SRGB8:return YH.COMPRESSED_SRGB8_ETC2;case Sr.ETC2_RGB8_A1:return YH.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2;case Sr.ETC2_SRGB8_A1:return YH.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2;case Sr.ETC2_RGBA8:return YH.COMPRESSED_RGBA8_ETC2_EAC;case Sr.ETC2_SRGB8_A8:return YH.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC;case Sr.EAC_R11:return YH.COMPRESSED_R11_EAC;case Sr.EAC_R11SN:return YH.COMPRESSED_SIGNED_R11_EAC;case Sr.EAC_RG11:return YH.COMPRESSED_RG11_EAC;case Sr.EAC_RG11SN:return YH.COMPRESSED_SIGNED_RG11_EAC;case Sr.PVRTC_RGB2:return YH.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;case Sr.PVRTC_RGBA2:return YH.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;case Sr.PVRTC_RGB4:return YH.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;case Sr.PVRTC_RGBA4:return YH.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;case Sr.ASTC_RGBA_4X4:return YH.COMPRESSED_RGBA_ASTC_4x4_KHR;case Sr.ASTC_RGBA_5X4:return YH.COMPRESSED_RGBA_ASTC_5x4_KHR;case Sr.ASTC_RGBA_5X5:return YH.COMPRESSED_RGBA_ASTC_5x5_KHR;case Sr.ASTC_RGBA_6X5:return YH.COMPRESSED_RGBA_ASTC_6x5_KHR;case Sr.ASTC_RGBA_6X6:return YH.COMPRESSED_RGBA_ASTC_6x6_KHR;case Sr.ASTC_RGBA_8X5:return YH.COMPRESSED_RGBA_ASTC_8x5_KHR;case Sr.ASTC_RGBA_8X6:return YH.COMPRESSED_RGBA_ASTC_8x6_KHR;case Sr.ASTC_RGBA_8X8:return YH.COMPRESSED_RGBA_ASTC_8x8_KHR;case Sr.ASTC_RGBA_10X5:return YH.COMPRESSED_RGBA_ASTC_10x5_KHR;case Sr.ASTC_RGBA_10X6:return YH.COMPRESSED_RGBA_ASTC_10x6_KHR;case Sr.ASTC_RGBA_10X8:return YH.COMPRESSED_RGBA_ASTC_10x8_KHR;case Sr.ASTC_RGBA_10X10:return YH.COMPRESSED_RGBA_ASTC_10x10_KHR;case Sr.ASTC_RGBA_12X10:return YH.COMPRESSED_RGBA_ASTC_12x10_KHR;case Sr.ASTC_RGBA_12X12:return YH.COMPRESSED_RGBA_ASTC_12x12_KHR;case Sr.ASTC_SRGBA_4X4:return YH.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;case Sr.ASTC_SRGBA_5X4:return YH.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR;case Sr.ASTC_SRGBA_5X5:return YH.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR;case Sr.ASTC_SRGBA_6X5:return YH.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR;case Sr.ASTC_SRGBA_6X6:return YH.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR;case Sr.ASTC_SRGBA_8X5:return YH.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR;case Sr.ASTC_SRGBA_8X6:return YH.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR;case Sr.ASTC_SRGBA_8X8:return YH.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR;case Sr.ASTC_SRGBA_10X5:return YH.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR;case Sr.ASTC_SRGBA_10X6:return YH.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR;case Sr.ASTC_SRGBA_10X8:return YH.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR;case Sr.ASTC_SRGBA_10X10:return YH.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR;case Sr.ASTC_SRGBA_12X10:return YH.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR;case Sr.ASTC_SRGBA_12X12:return YH.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR;default:return console.error("Unsupported Format, convert to WebGL format failed."),e.RGBA}}(e.format,n),e.glType=$H(e.format,n);var i=e.width,r=e.height;switch(e.type){case Pr.TEX2D:if(e.glTarget=n.TEXTURE_2D,e.isSwapchainTexture)break;var a=Math.max(i,r);if(a>t.capabilities.maxTextureSize&&b(9100,a,t.capabilities.maxTextureSize),e.samples===Dr.ONE){if(e.glTexture=n.createTexture(),e.size>0){var o=t.stateCache.glTexUnits[t.stateCache.texUnit];if(o.glTexture!==e.glTexture&&(n.bindTexture(n.TEXTURE_2D,e.glTexture),o.glTexture=e.glTexture),lo[e.format].isCompressed)for(var s=0;s<e.mipLevel;++s){var c=po(e.format,i,r,1),l=new Uint8Array(c);n.compressedTexImage2D(n.TEXTURE_2D,s,e.glInternalFmt,i,r,0,l),i=Math.max(1,i>>1),r=Math.max(1,r>>1)}else n.texStorage2D(n.TEXTURE_2D,e.mipLevel,e.glInternalFmt,i,r)}}else e.glRenderbuffer=n.createRenderbuffer(),e.size>0&&(t.stateCache.glRenderbuffer!==e.glRenderbuffer&&(n.bindRenderbuffer(n.RENDERBUFFER,e.glRenderbuffer),t.stateCache.glRenderbuffer=e.glRenderbuffer),n.renderbufferStorageMultisample(n.RENDERBUFFER,e.samples,e.glInternalFmt,e.width,e.height));break;case Pr.CUBE:e.glTarget=n.TEXTURE_CUBE_MAP;var u=Math.max(i,r);if(u>t.capabilities.maxCubeMapTextureSize&&b(9100,u,t.capabilities.maxTextureSize),e.glTexture=n.createTexture(),e.size>0){var h=t.stateCache.glTexUnits[t.stateCache.texUnit];if(h.glTexture!==e.glTexture&&(n.bindTexture(n.TEXTURE_CUBE_MAP,e.glTexture),h.glTexture=e.glTexture),lo[e.format].isCompressed)for(var f=0;f<e.mipLevel;++f){for(var _=po(e.format,i,r,1),p=new Uint8Array(_),d=0;d<6;++d)n.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+d,f,e.glInternalFmt,i,r,0,p);i=Math.max(1,i>>1),r=Math.max(1,r>>1)}else n.texStorage2D(n.TEXTURE_CUBE_MAP,e.mipLevel,e.glInternalFmt,i,r)}break;default:console.error("Unsupported TextureType, create texture failed."),e.type=Pr.TEX2D,e.glTarget=n.TEXTURE_2D}}function vV(t,e){var n=t.gl;if(e.glTexture){var i=t.stateCache.glTexUnits,r=t.stateCache.texUnit;n.deleteTexture(e.glTexture);for(var a=0;a<i.length;++a)i[a].glTexture===e.glTexture&&(n.activeTexture(n.TEXTURE0+a),r=a,n.bindTexture(e.glTarget,null),i[a].glTexture=null);t.stateCache.texUnit=r,e.glTexture=null}if(e.glRenderbuffer){var o=t.stateCache.glRenderbuffer;n.deleteRenderbuffer(e.glRenderbuffer),o===e.glRenderbuffer&&(n.bindRenderbuffer(n.RENDERBUFFER,null),o=null),e.glRenderbuffer=null}}var yV={gpuPipelineState:null,gpuInputAssembler:null,glPrimitive:0,invalidateAttachments:[]};function xV(t,e,n,i,r,a,o){var s=t.gl,c=t.stateCache,l=0;if(n&&e){c.glFramebuffer!==n.glFramebuffer&&(s.bindFramebuffer(s.FRAMEBUFFER,n.glFramebuffer),c.glFramebuffer=n.glFramebuffer),c.viewport.left===i.x&&c.viewport.top===i.y&&c.viewport.width===i.width&&c.viewport.height===i.height||(s.viewport(i.x,i.y,i.width,i.height),c.viewport.left=i.x,c.viewport.top=i.y,c.viewport.width=i.width,c.viewport.height=i.height),c.scissorRect.x===i.x&&c.scissorRect.y===i.y&&c.scissorRect.width===i.width&&c.scissorRect.height===i.height||(s.scissor(i.x,i.y,i.width,i.height),c.scissorRect.x=i.x,c.scissorRect.y=i.y,c.scissorRect.width=i.width,c.scissorRect.height=i.height),yV.invalidateAttachments.length=0;for(var u=0;u<r.length;++u){var h=e.colorAttachments[u];if(h.format!==Sr.UNKNOWN)switch(h.loadOp){case Gr.LOAD:break;case Gr.CLEAR:if(c.bs.targets[0].blendColorMask!==Ur.ALL&&s.colorMask(!0,!0,!0,!0),n.isOffscreen)JH[0]=r[u].x,JH[1]=r[u].y,JH[2]=r[u].z,JH[3]=r[u].w,s.clearBufferfv(s.COLOR,u,JH);else{var f=r[0];s.clearColor(f.x,f.y,f.z,f.w),l|=s.COLOR_BUFFER_BIT}break;case Gr.DISCARD:yV.invalidateAttachments.push(s.COLOR_ATTACHMENT0+u)}}if(e.depthStencilAttachment&&e.depthStencilAttachment.format!==Sr.UNKNOWN){switch(e.depthStencilAttachment.depthLoadOp){case Gr.LOAD:break;case Gr.CLEAR:c.dss.depthWrite||s.depthMask(!0),s.clearDepth(a),l|=s.DEPTH_BUFFER_BIT;break;case Gr.DISCARD:yV.invalidateAttachments.push(s.DEPTH_ATTACHMENT)}if(lo[e.depthStencilAttachment.format].hasStencil)switch(e.depthStencilAttachment.stencilLoadOp){case Gr.LOAD:break;case Gr.CLEAR:c.dss.stencilWriteMaskFront||s.stencilMaskSeparate(s.FRONT,65535),c.dss.stencilWriteMaskBack||s.stencilMaskSeparate(s.BACK,65535),s.clearStencil(o),l|=s.STENCIL_BUFFER_BIT;break;case Gr.DISCARD:yV.invalidateAttachments.push(s.STENCIL_ATTACHMENT)}}if(n.glFramebuffer&&yV.invalidateAttachments.length&&s.invalidateFramebuffer(s.FRAMEBUFFER,yV.invalidateAttachments),l&&s.clear(l),l&s.COLOR_BUFFER_BIT){var _=c.bs.targets[0].blendColorMask;if(_!==Ur.ALL){var p=(_&Ur.R)!==Ur.NONE,d=(_&Ur.G)!==Ur.NONE,m=(_&Ur.B)!==Ur.NONE,g=(_&Ur.A)!==Ur.NONE;s.colorMask(p,d,m,g)}}l&s.DEPTH_BUFFER_BIT&&!c.dss.depthWrite&&s.depthMask(!1),l&s.STENCIL_BUFFER_BIT&&(c.dss.stencilWriteMaskFront||s.stencilMaskSeparate(s.FRONT,0),c.dss.stencilWriteMaskBack||s.stencilMaskSeparate(s.BACK,0))}}function SV(t,e,n,i,r,a){var o=t.gl,s=t.stateCache,c=e&&e.gpuShader,l=!1;if(e&&yV.gpuPipelineState!==e){if(yV.gpuPipelineState=e,yV.glPrimitive=e.glPrimitive,c){var u=c.glProgram;s.glProgram!==u&&(o.useProgram(u),s.glProgram=u,l=!0)}var h=e.rs;if(h){if(s.rs.cullMode!==h.cullMode){switch(h.cullMode){case Kr.NONE:o.disable(o.CULL_FACE);break;case Kr.FRONT:o.enable(o.CULL_FACE),o.cullFace(o.FRONT);break;case Kr.BACK:o.enable(o.CULL_FACE),o.cullFace(o.BACK)}t.stateCache.rs.cullMode=h.cullMode}var f=h.isFrontFaceCCW;t.stateCache.rs.isFrontFaceCCW!==f&&(o.frontFace(f?o.CCW:o.CW),t.stateCache.rs.isFrontFaceCCW=f),t.stateCache.rs.depthBias===h.depthBias&&t.stateCache.rs.depthBiasSlop===h.depthBiasSlop||(o.polygonOffset(h.depthBias,h.depthBiasSlop),t.stateCache.rs.depthBias=h.depthBias,t.stateCache.rs.depthBiasSlop=h.depthBiasSlop),t.stateCache.rs.lineWidth!==h.lineWidth&&(o.lineWidth(h.lineWidth),t.stateCache.rs.lineWidth=h.lineWidth)}var _=e.dss;_&&(s.dss.depthTest!==_.depthTest&&(_.depthTest?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST),s.dss.depthTest=_.depthTest),s.dss.depthWrite!==_.depthWrite&&(o.depthMask(_.depthWrite),s.dss.depthWrite=_.depthWrite),s.dss.depthFunc!==_.depthFunc&&(o.depthFunc(aV[_.depthFunc]),s.dss.depthFunc=_.depthFunc),s.dss.stencilTestFront===_.stencilTestFront&&s.dss.stencilTestBack===_.stencilTestBack||(_.stencilTestFront||_.stencilTestBack?o.enable(o.STENCIL_TEST):o.disable(o.STENCIL_TEST),s.dss.stencilTestFront=_.stencilTestFront,s.dss.stencilTestBack=_.stencilTestBack),s.dss.stencilFuncFront===_.stencilFuncFront&&s.dss.stencilRefFront===_.stencilRefFront&&s.dss.stencilReadMaskFront===_.stencilReadMaskFront||(o.stencilFuncSeparate(o.FRONT,aV[_.stencilFuncFront],_.stencilRefFront,_.stencilReadMaskFront),s.dss.stencilFuncFront=_.stencilFuncFront,s.dss.stencilRefFront=_.stencilRefFront,s.dss.stencilReadMaskFront=_.stencilReadMaskFront),s.dss.stencilFailOpFront===_.stencilFailOpFront&&s.dss.stencilZFailOpFront===_.stencilZFailOpFront&&s.dss.stencilPassOpFront===_.stencilPassOpFront||(o.stencilOpSeparate(o.FRONT,oV[_.stencilFailOpFront],oV[_.stencilZFailOpFront],oV[_.stencilPassOpFront]),s.dss.stencilFailOpFront=_.stencilFailOpFront,s.dss.stencilZFailOpFront=_.stencilZFailOpFront,s.dss.stencilPassOpFront=_.stencilPassOpFront),s.dss.stencilWriteMaskFront!==_.stencilWriteMaskFront&&(o.stencilMaskSeparate(o.FRONT,_.stencilWriteMaskFront),s.dss.stencilWriteMaskFront=_.stencilWriteMaskFront),s.dss.stencilFuncBack===_.stencilFuncBack&&s.dss.stencilRefBack===_.stencilRefBack&&s.dss.stencilReadMaskBack===_.stencilReadMaskBack||(o.stencilFuncSeparate(o.BACK,aV[_.stencilFuncBack],_.stencilRefBack,_.stencilReadMaskBack),s.dss.stencilFuncBack=_.stencilFuncBack,s.dss.stencilRefBack=_.stencilRefBack,s.dss.stencilReadMaskBack=_.stencilReadMaskBack),s.dss.stencilFailOpBack===_.stencilFailOpBack&&s.dss.stencilZFailOpBack===_.stencilZFailOpBack&&s.dss.stencilPassOpBack===_.stencilPassOpBack||(o.stencilOpSeparate(o.BACK,oV[_.stencilFailOpBack],oV[_.stencilZFailOpBack],oV[_.stencilPassOpBack]),s.dss.stencilFailOpBack=_.stencilFailOpBack,s.dss.stencilZFailOpBack=_.stencilZFailOpBack,s.dss.stencilPassOpBack=_.stencilPassOpBack),s.dss.stencilWriteMaskBack!==_.stencilWriteMaskBack&&(o.stencilMaskSeparate(o.BACK,_.stencilWriteMaskBack),s.dss.stencilWriteMaskBack=_.stencilWriteMaskBack));var p=e.bs;if(p){s.bs.isA2C!==p.isA2C&&(p.isA2C?o.enable(o.SAMPLE_ALPHA_TO_COVERAGE):o.disable(o.SAMPLE_ALPHA_TO_COVERAGE),s.bs.isA2C=p.isA2C),s.bs.blendColor.x===p.blendColor.x&&s.bs.blendColor.y===p.blendColor.y&&s.bs.blendColor.z===p.blendColor.z&&s.bs.blendColor.w===p.blendColor.w||(o.blendColor(p.blendColor.x,p.blendColor.y,p.blendColor.z,p.blendColor.w),s.bs.blendColor.x=p.blendColor.x,s.bs.blendColor.y=p.blendColor.y,s.bs.blendColor.z=p.blendColor.z,s.bs.blendColor.w=p.blendColor.w);var m=p.targets[0],g=s.bs.targets[0];g.blend!==m.blend&&(m.blend?o.enable(o.BLEND):o.disable(o.BLEND),g.blend=m.blend),g.blendEq===m.blendEq&&g.blendAlphaEq===m.blendAlphaEq||(o.blendEquationSeparate(sV[m.blendEq],sV[m.blendAlphaEq]),g.blendEq=m.blendEq,g.blendAlphaEq=m.blendAlphaEq),g.blendSrc===m.blendSrc&&g.blendDst===m.blendDst&&g.blendSrcAlpha===m.blendSrcAlpha&&g.blendDstAlpha===m.blendDstAlpha||(o.blendFuncSeparate(cV[m.blendSrc],cV[m.blendDst],cV[m.blendSrcAlpha],cV[m.blendDstAlpha]),g.blendSrc=m.blendSrc,g.blendDst=m.blendDst,g.blendSrcAlpha=m.blendSrcAlpha,g.blendDstAlpha=m.blendDstAlpha),g.blendColorMask!==m.blendColorMask&&(o.colorMask((m.blendColorMask&Ur.R)!==Ur.NONE,(m.blendColorMask&Ur.G)!==Ur.NONE,(m.blendColorMask&Ur.B)!==Ur.NONE,(m.blendColorMask&Ur.A)!==Ur.NONE),g.blendColorMask=m.blendColorMask)}}if(e&&e.gpuPipelineLayout&&c){for(var v=c.glBlocks.length,y=e.gpuPipelineLayout.dynamicOffsetIndices,x=0;x<v;x++){var S=c.glBlocks[x],T=i[S.set],A=T&&T.descriptorIndices[S.binding],E=A>=0&&T.gpuDescriptors[A];if(E&&E.gpuBuffer){var C=y[S.set],b=C&&C[S.binding],w=E.gpuBuffer.glOffset;b>=0&&(w+=r[b]),s.glBindUBOs[S.glBinding]===E.gpuBuffer.glBuffer&&s.glBindUBOOffsets[S.glBinding]===w||(w?o.bindBufferRange(o.UNIFORM_BUFFER,S.glBinding,E.gpuBuffer.glBuffer,w,E.gpuBuffer.size):o.bindBufferBase(o.UNIFORM_BUFFER,S.glBinding,E.gpuBuffer.glBuffer),s.glUniformBuffer=s.glBindUBOs[S.glBinding]=E.gpuBuffer.glBuffer,s.glBindUBOOffsets[S.glBinding]=w)}else d("Buffer binding '"+S.name+"' at set "+S.set+" binding "+S.binding+" is not bounded")}for(var P=c.glSamplerTextures.length,I=0;I<P;I++)for(var R=c.glSamplerTextures[I],D=i[R.set],O=D&&D.descriptorIndices[R.binding],M=O>=0&&D.gpuDescriptors[O],N=0;N<R.units.length;N++){var L=R.units[N],B=s.glTexUnits[L];if(M&&M.gpuTexture&&M.gpuSampler){if(M.gpuTexture&&M.gpuTexture.size>0){var F=M.gpuTexture;B.glTexture!==F.glTexture&&(s.texUnit!==L&&(o.activeTexture(o.TEXTURE0+L),s.texUnit=L),F.glTexture?o.bindTexture(F.glTarget,F.glTexture):o.bindTexture(F.glTarget,t.nullTex2D.gpuTexture.glTexture),B.glTexture=F.glTexture);var z=M.gpuSampler;s.glSamplerUnits[L]!==z.glSampler&&(o.bindSampler(L,z.glSampler),s.glSamplerUnits[L]=z.glSampler)}M=D.gpuDescriptors[++O]}else d("Sampler binding '"+R.name+"' at set "+R.set+" binding "+R.binding+" index "+N+" is not bounded")}}if(n&&c&&(l||yV.gpuInputAssembler!==n))if(yV.gpuInputAssembler=n,t.extensions.useVAO){var U=n.glVAOs.get(c.glProgram);if(!U){var k;U=o.createVertexArray(),n.glVAOs.set(c.glProgram,U),o.bindVertexArray(U),o.bindBuffer(o.ARRAY_BUFFER,null),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,null),s.glArrayBuffer=null,s.glElementArrayBuffer=null;for(var G=0;G<c.glInputs.length;G++){var H=c.glInputs[G];k=null;for(var V=0;V<n.glAttribs.length;V++){var j=n.glAttribs[V];if(j.name===H.name){k=j;break}}if(k){s.glArrayBuffer!==k.glBuffer&&(o.bindBuffer(o.ARRAY_BUFFER,k.glBuffer),s.glArrayBuffer=k.glBuffer);for(var W=0;W<k.componentCount;++W){var X=H.glLoc+W,q=k.offset+k.size*W;o.enableVertexAttribArray(X),s.glCurrentAttribLocs[X]=!0,o.vertexAttribPointer(X,k.count,k.glType,k.isNormalized,k.stride,q),o.vertexAttribDivisor(X,k.isInstanced?1:0)}}}var Y=n.gpuIndexBuffer;Y&&o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,Y.glBuffer),o.bindVertexArray(null),o.bindBuffer(o.ARRAY_BUFFER,null),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,null),s.glArrayBuffer=null,s.glElementArrayBuffer=null}s.glVAO!==U&&(o.bindVertexArray(U),s.glVAO=U)}else{for(var K=0;K<t.capabilities.maxVertexAttributes;++K)s.glCurrentAttribLocs[K]=!1;for(var Q=0;Q<c.glInputs.length;Q++){for(var Z=c.glInputs[Q],J=null,$=0;$<n.glAttribs.length;$++){var tt=n.glAttribs[$];if(tt.name===Z.name){J=tt;break}}if(J){s.glArrayBuffer!==J.glBuffer&&(o.bindBuffer(o.ARRAY_BUFFER,J.glBuffer),s.glArrayBuffer=J.glBuffer);for(var et=0;et<J.componentCount;++et){var nt=Z.glLoc+et,it=J.offset+J.size*et;!s.glEnabledAttribLocs[nt]&&nt>=0&&(o.enableVertexAttribArray(nt),s.glEnabledAttribLocs[nt]=!0),s.glCurrentAttribLocs[nt]=!0,o.vertexAttribPointer(nt,J.count,J.glType,J.isNormalized,J.stride,it),o.vertexAttribDivisor(nt,J.isInstanced?1:0)}}}var rt=n.gpuIndexBuffer;rt&&s.glElementArrayBuffer!==rt.glBuffer&&(o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,rt.glBuffer),s.glElementArrayBuffer=rt.glBuffer);for(var at=0;at<t.capabilities.maxVertexAttributes;++at)s.glEnabledAttribLocs[at]!==s.glCurrentAttribLocs[at]&&(o.disableVertexAttribArray(at),s.glEnabledAttribLocs[at]=!1)}if(e&&e.dynamicStates.length)for(var ot=e.dynamicStates.length,st=0;st<ot;st++)switch(e.dynamicStates[st]){case Qr.LINE_WIDTH:s.rs.lineWidth!==a.lineWidth&&(o.lineWidth(a.lineWidth),s.rs.lineWidth=a.lineWidth);break;case Qr.DEPTH_BIAS:s.rs.depthBias===a.depthBiasConstant&&s.rs.depthBiasSlop===a.depthBiasSlope||(o.polygonOffset(a.depthBiasConstant,a.depthBiasSlope),s.rs.depthBias=a.depthBiasConstant,s.rs.depthBiasSlop=a.depthBiasSlope);break;case Qr.BLEND_CONSTANTS:var ct=a.blendConstant;s.bs.blendColor.x===ct.x&&s.bs.blendColor.y===ct.y&&s.bs.blendColor.z===ct.z&&s.bs.blendColor.w===ct.w||(o.blendColor(ct.x,ct.y,ct.z,ct.w),s.bs.blendColor.copy(ct));break;case Qr.STENCIL_WRITE_MASK:var lt=a.stencilStatesFront,ut=a.stencilStatesBack;s.dss.stencilWriteMaskFront!==lt.writeMask&&(o.stencilMaskSeparate(o.FRONT,lt.writeMask),s.dss.stencilWriteMaskFront=lt.writeMask),s.dss.stencilWriteMaskBack!==ut.writeMask&&(o.stencilMaskSeparate(o.BACK,ut.writeMask),s.dss.stencilWriteMaskBack=ut.writeMask);break;case Qr.STENCIL_COMPARE_MASK:var ht=a.stencilStatesFront,ft=a.stencilStatesBack;s.dss.stencilRefFront===ht.reference&&s.dss.stencilReadMaskFront===ht.compareMask||(o.stencilFuncSeparate(o.FRONT,aV[s.dss.stencilFuncFront],ht.reference,ht.compareMask),s.dss.stencilRefFront=ht.reference,s.dss.stencilReadMaskFront=ht.compareMask),s.dss.stencilRefBack===ft.reference&&s.dss.stencilReadMaskBack===ft.compareMask||(o.stencilFuncSeparate(o.BACK,aV[s.dss.stencilFuncBack],ft.reference,ft.compareMask),s.dss.stencilRefBack=ft.reference,s.dss.stencilReadMaskBack=ft.compareMask)}}function TV(t,e){var n=t.gl,i=yV.gpuInputAssembler,r=yV.glPrimitive,a=t.extensions.WEBGL_multi_draw;if(i){var o=i.gpuIndexBuffer;if(i.gpuIndirectBuffer){var s=i.gpuIndirectBuffer.indirects;if(s.drawByIndex){for(var c=0;c<s.drawCount;c++)s.byteOffsets[c]=s.offsets[c]*o.stride;if(a)s.instancedDraw?a.multiDrawElementsInstancedWEBGL(r,s.counts,0,i.glIndexType,s.byteOffsets,0,s.instances,0,s.drawCount):a.multiDrawElementsWEBGL(r,s.counts,0,i.glIndexType,s.byteOffsets,0,s.drawCount);else for(var l=0;l<s.drawCount;l++)s.instances[l]?n.drawElementsInstanced(r,s.counts[l],i.glIndexType,s.byteOffsets[l],s.instances[l]):n.drawElements(r,s.counts[l],i.glIndexType,s.byteOffsets[l])}else if(a)s.instancedDraw?a.multiDrawArraysInstancedWEBGL(r,s.offsets,0,s.counts,0,s.instances,0,s.drawCount):a.multiDrawArraysWEBGL(r,s.offsets,0,s.counts,0,s.drawCount);else for(var u=0;u<s.drawCount;u++)s.instances[u]?n.drawArraysInstanced(r,s.offsets[u],s.counts[u],s.instances[u]):n.drawArrays(r,s.offsets[u],s.counts[u])}else if(e.instanceCount)if(o){if(e.indexCount>0){var h=e.firstIndex*o.stride;n.drawElementsInstanced(r,e.indexCount,i.glIndexType,h,e.instanceCount)}}else e.vertexCount>0&&n.drawArraysInstanced(r,e.firstVertex,e.vertexCount,e.instanceCount);else if(o){if(e.indexCount>0){var f=e.firstIndex*o.stride;n.drawElements(r,e.indexCount,i.glIndexType,f)}}else e.vertexCount>0&&n.drawArrays(r,e.firstVertex,e.vertexCount)}}var AV=new Array(rV.COUNT);function EV(t,e){AV.fill(0);for(var n=0;n<e.cmds.length;++n){var i=e.cmds.array[n],r=AV[i]++;switch(i){case rV.BEGIN_RENDER_PASS:var a=e.beginRenderPassCmds.array[r];xV(t,a.gpuRenderPass,a.gpuFramebuffer,a.renderArea,a.clearColors,a.clearDepth,a.clearStencil);break;case rV.BIND_STATES:var o=e.bindStatesCmds.array[r];SV(t,o.gpuPipelineState,o.gpuInputAssembler,o.gpuDescriptorSets,o.dynamicOffsets,o.dynamicStates);break;case rV.DRAW:TV(t,e.drawCmds.array[r].drawInfo);break;case rV.UPDATE_BUFFER:var s=e.updateBufferCmds.array[r];mV(t,s.gpuBuffer,s.buffer,s.offset,s.size);break;case rV.COPY_BUFFER_TO_TEXTURE:var c=e.copyBufferToTextureCmds.array[r];CV(t,c.buffers,c.gpuTexture,c.regions)}}}function CV(t,e,n,i){var r=t.gl,a=t.stateCache.glTexUnits[t.stateCache.texUnit];a.glTexture!==n.glTexture&&(r.bindTexture(n.glTarget,n.glTexture),a.glTexture=n.glTexture);var o=0,s=1,c=1,l=0,u=lo[n.format].isCompressed;switch(n.glTarget){case r.TEXTURE_2D:for(var h=0;h<i.length;h++){var f=i[h];s=f.texExtent.width,c=f.texExtent.height;var _=e[o++];u?n.glInternalFmt!==YH.COMPRESSED_RGB_ETC1_WEBGL?r.compressedTexSubImage2D(r.TEXTURE_2D,f.texSubres.mipLevel,f.texOffset.x,f.texOffset.y,s,c,n.glFormat,_):r.compressedTexImage2D(r.TEXTURE_2D,f.texSubres.mipLevel,n.glInternalFmt,s,c,0,_):r.texSubImage2D(r.TEXTURE_2D,f.texSubres.mipLevel,f.texOffset.x,f.texOffset.y,s,c,n.glFormat,n.glType,_)}break;case r.TEXTURE_CUBE_MAP:for(var p=0;p<i.length;p++){var d=i[p],m=d.texSubres.baseArrayLayer+d.texSubres.layerCount;for(l=d.texSubres.baseArrayLayer;l<m;++l){s=d.texExtent.width,c=d.texExtent.height;var g=e[o++];u?n.glInternalFmt!==YH.COMPRESSED_RGB_ETC1_WEBGL?r.compressedTexSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+l,d.texSubres.mipLevel,d.texOffset.x,d.texOffset.y,s,c,n.glFormat,g):r.compressedTexImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+l,d.texSubres.mipLevel,n.glInternalFmt,s,c,0,g):r.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+l,d.texSubres.mipLevel,d.texOffset.x,d.texOffset.y,s,c,n.glFormat,n.glType,g)}}break;default:console.error("Unsupported GL texture type, copy buffer to texture failed.")}n.flags&Rr.GEN_MIPMAP&&r.generateMipmap(n.glTarget)}var bV=function(){function t(){this.counts=void 0,this.offsets=void 0,this.instances=void 0,this.drawCount=0,this.drawByIndex=!1,this.instancedDraw=!1,this.byteOffsets=void 0,this._capacity=4,this.counts=new Int32Array(this._capacity),this.offsets=new Int32Array(this._capacity),this.instances=new Int32Array(this._capacity),this.byteOffsets=new Int32Array(this._capacity)}var e=t.prototype;return e.clearDraws=function(){this.drawCount=0,this.drawByIndex=!1,this.instancedDraw=!1},e.setDrawInfo=function(t,e){this._ensureCapacity(t),this.drawByIndex=e.indexCount>0,this.instancedDraw=!!e.instanceCount,this.drawCount=Math.max(t+1,this.drawCount),this.drawByIndex?(this.counts[t]=e.indexCount,this.offsets[t]=e.firstIndex):(this.counts[t]=e.vertexCount,this.offsets[t]=e.firstVertex),this.instances[t]=Math.max(1,e.instanceCount)},e._ensureCapacity=function(t){if(!(this._capacity>t)){this._capacity=Dn(t);var e=new Int32Array(this._capacity),n=new Int32Array(this._capacity),i=new Int32Array(this._capacity);this.byteOffsets=new Int32Array(this._capacity),e.set(this.counts),n.set(this.offsets),i.set(this.instances),this.counts=e,this.offsets=n,this.instances=i}},t}(),wV=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._gpuBuffer=null,e}F(e,t);var n=e.prototype;return n.initialize=function(t){if("buffer"in t){this._isBufferView=!0;var e=t.buffer;this._usage=e.usage,this._memUsage=e.memUsage,this._size=this._stride=t.range,this._count=1,this._flags=e.flags,this._gpuBuffer={usage:this._usage,memUsage:this._memUsage,size:this._size,stride:this._stride,buffer:null,indirects:e.gpuBuffer.indirects,glTarget:e.gpuBuffer.glTarget,glBuffer:e.gpuBuffer.glBuffer,glOffset:t.offset}}else this._usage=t.usage,this._memUsage=t.memUsage,this._size=t.size,this._stride=Math.max(t.stride||this._size,1),this._count=this._size/this._stride,this._flags=t.flags,this._gpuBuffer={usage:this._usage,memUsage:this._memUsage,size:this._size,stride:this._stride,buffer:null,indirects:new bV,glTarget:0,glBuffer:null,glOffset:0},function(t,e){var n=t.gl,i=t.stateCache,r=e.memUsage&wr.HOST?n.DYNAMIC_DRAW:n.STATIC_DRAW;if(e.usage&Er.VERTEX){e.glTarget=n.ARRAY_BUFFER;var a=n.createBuffer();a&&(e.glBuffer=a,e.size>0&&(t.extensions.useVAO&&i.glVAO&&(n.bindVertexArray(null),i.glVAO=null),yV.gpuInputAssembler=null,t.stateCache.glArrayBuffer!==e.glBuffer&&(n.bindBuffer(n.ARRAY_BUFFER,e.glBuffer),t.stateCache.glArrayBuffer=e.glBuffer),n.bufferData(n.ARRAY_BUFFER,e.size,r),n.bindBuffer(n.ARRAY_BUFFER,null),t.stateCache.glArrayBuffer=null))}else if(e.usage&Er.INDEX){e.glTarget=n.ELEMENT_ARRAY_BUFFER;var o=n.createBuffer();o&&(e.glBuffer=o,e.size>0&&(t.extensions.useVAO&&i.glVAO&&(n.bindVertexArray(null),i.glVAO=null),yV.gpuInputAssembler=null,t.stateCache.glElementArrayBuffer!==e.glBuffer&&(n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e.glBuffer),t.stateCache.glElementArrayBuffer=e.glBuffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,e.size,r),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null),t.stateCache.glElementArrayBuffer=null))}else if(e.usage&Er.UNIFORM){e.glTarget=n.UNIFORM_BUFFER;var s=n.createBuffer();s&&e.size>0&&(e.glBuffer=s,t.stateCache.glUniformBuffer!==e.glBuffer&&(n.bindBuffer(n.UNIFORM_BUFFER,e.glBuffer),t.stateCache.glUniformBuffer=e.glBuffer),n.bufferData(n.UNIFORM_BUFFER,e.size,r),n.bindBuffer(n.UNIFORM_BUFFER,null),t.stateCache.glUniformBuffer=null)}else e.usage&Er.INDIRECT||e.usage&Er.TRANSFER_DST||e.usage&Er.TRANSFER_SRC||console.error("Unsupported BufferType, create buffer failed."),e.glTarget=n.NONE}(QH.instance,this._gpuBuffer),QH.instance.memoryStatus.bufferSize+=this._size},n.destroy=function(){this._gpuBuffer&&(this._isBufferView||(function(t,e){var n=t.gl,i=t.stateCache;if(e.glBuffer){switch(e.glTarget){case n.ARRAY_BUFFER:t.extensions.useVAO&&i.glVAO&&(n.bindVertexArray(null),t.stateCache.glVAO=null),yV.gpuInputAssembler=null,n.bindBuffer(n.ARRAY_BUFFER,null),t.stateCache.glArrayBuffer=null;break;case n.ELEMENT_ARRAY_BUFFER:t.extensions.useVAO&&i.glVAO&&(n.bindVertexArray(null),t.stateCache.glVAO=null),yV.gpuInputAssembler=null,n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null),t.stateCache.glElementArrayBuffer=null;break;case n.UNIFORM_BUFFER:n.bindBuffer(n.UNIFORM_BUFFER,null),t.stateCache.glUniformBuffer=null}n.deleteBuffer(e.glBuffer),e.glBuffer=null}}(QH.instance,this._gpuBuffer),QH.instance.memoryStatus.bufferSize-=this._size),this._gpuBuffer=null)},n.resize=function(t){if(this._isBufferView)console.warn("cannot resize buffer views!");else{var e=this._size;e!==t&&(this._size=t,this._count=this._size/this._stride,this._gpuBuffer&&(this._gpuBuffer.size=t,t>0&&(function(t,e){var n=t.gl,i=t.stateCache,r=e.memUsage&wr.HOST?n.DYNAMIC_DRAW:n.STATIC_DRAW;e.usage&Er.VERTEX?(t.extensions.useVAO&&i.glVAO&&(n.bindVertexArray(null),i.glVAO=null),yV.gpuInputAssembler=null,i.glArrayBuffer!==e.glBuffer&&n.bindBuffer(n.ARRAY_BUFFER,e.glBuffer),e.buffer?n.bufferData(n.ARRAY_BUFFER,e.buffer,r):n.bufferData(n.ARRAY_BUFFER,e.size,r),n.bindBuffer(n.ARRAY_BUFFER,null),i.glArrayBuffer=null):e.usage&Er.INDEX?(t.extensions.useVAO&&i.glVAO&&(n.bindVertexArray(null),i.glVAO=null),yV.gpuInputAssembler=null,t.stateCache.glElementArrayBuffer!==e.glBuffer&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e.glBuffer),e.buffer?n.bufferData(n.ELEMENT_ARRAY_BUFFER,e.buffer,r):n.bufferData(n.ELEMENT_ARRAY_BUFFER,e.size,r),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null),t.stateCache.glElementArrayBuffer=null):e.usage&Er.UNIFORM?(t.stateCache.glUniformBuffer!==e.glBuffer&&n.bindBuffer(n.UNIFORM_BUFFER,e.glBuffer),n.bufferData(n.UNIFORM_BUFFER,e.size,r),n.bindBuffer(n.UNIFORM_BUFFER,null),t.stateCache.glUniformBuffer=null):(e.usage&Er.INDIRECT||e.usage&Er.TRANSFER_DST||e.usage&Er.TRANSFER_SRC||console.error("Unsupported BufferType, create buffer failed."),e.glTarget=n.NONE)}(QH.instance,this._gpuBuffer),QH.instance.memoryStatus.bufferSize-=e,QH.instance.memoryStatus.bufferSize+=t)))}},n.update=function(t,e){var n;this._isBufferView?console.warn("cannot update through buffer views!"):(n=void 0!==e?e:this._usage&Er.INDIRECT?0:t.byteLength,mV(QH.instance,this._gpuBuffer,t,0,n))},L(e,[{key:"gpuBuffer",get:function(){return this._gpuBuffer}}]),e}(So),PV=function(){function t(t,e){this._frees=void 0,this._freeIdx=0,this._freeCmds=void 0,this._frees=new Array(e),this._freeCmds=new Xt(e);for(var n=0;n<e;++n)this._frees[n]=new t;this._freeIdx=e-1}var e=t.prototype;return e.alloc=function(t){if(this._freeIdx<0){var e=2*this._frees.length,n=this._frees;this._frees=new Array(e);for(var i=e-n.length,r=0;r<i;++r)this._frees[r]=new t;for(var a=i,o=0;a<e;++a,++o)this._frees[a]=n[o];this._freeIdx+=i}var s=this._frees[this._freeIdx];return this._frees[this._freeIdx--]=null,++s.refCount,s},e.free=function(t){0==--t.refCount&&this._freeCmds.push(t)},e.freeCmds=function(t){for(var e=0;e<t.length;++e)0==--t.array[e].refCount&&this._freeCmds.push(t.array[e])},e.release=function(){for(var t=0;t<this._freeCmds.length;++t){var e=this._freeCmds.array[t];e.clear(),this._frees[++this._freeIdx]=e}this._freeCmds.clear()},t}(),IV=function(){function t(){this.beginRenderPassCmdPool=void 0,this.bindStatesCmdPool=void 0,this.drawCmdPool=void 0,this.updateBufferCmdPool=void 0,this.copyBufferToTextureCmdPool=void 0,this.beginRenderPassCmdPool=new PV(uV,1),this.bindStatesCmdPool=new PV(hV,1),this.drawCmdPool=new PV(fV,1),this.updateBufferCmdPool=new PV(_V,1),this.copyBufferToTextureCmdPool=new PV(pV,1)}var e=t.prototype;return e.clearCmds=function(t){t.beginRenderPassCmds.length&&(this.beginRenderPassCmdPool.freeCmds(t.beginRenderPassCmds),t.beginRenderPassCmds.clear()),t.bindStatesCmds.length&&(this.bindStatesCmdPool.freeCmds(t.bindStatesCmds),t.bindStatesCmds.clear()),t.drawCmds.length&&(this.drawCmdPool.freeCmds(t.drawCmds),t.drawCmds.clear()),t.updateBufferCmds.length&&(this.updateBufferCmdPool.freeCmds(t.updateBufferCmds),t.updateBufferCmds.clear()),t.copyBufferToTextureCmds.length&&(this.copyBufferToTextureCmdPool.freeCmds(t.copyBufferToTextureCmds),t.copyBufferToTextureCmds.clear()),t.cmds.clear()},e.releaseCmds=function(){this.beginRenderPassCmdPool.release(),this.bindStatesCmdPool.release(),this.drawCmdPool.release(),this.updateBufferCmdPool.release(),this.copyBufferToTextureCmdPool.release()},t}(),RV=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).cmdPackage=new dV,e._cmdAllocator=new IV,e._isInRenderPass=!1,e._curGPUPipelineState=null,e._curGPUDescriptorSets=[],e._curGPUInputAssembler=null,e._curDynamicOffsets=Array(8).fill(0),e._curDynamicStates=new so,e._isStateInvalied=!1,e}F(e,t);var n=e.prototype;return n.initialize=function(t){this._type=t.type,this._queue=t.queue;for(var e=QH.instance.bindingMappingInfo.bufferOffsets.length,n=0;n<e;n++)this._curGPUDescriptorSets.push(null)},n.destroy=function(){this._cmdAllocator.clearCmds(this.cmdPackage)},n.begin=function(){this._cmdAllocator.clearCmds(this.cmdPackage),this._curGPUPipelineState=null,this._curGPUInputAssembler=null,this._curGPUDescriptorSets.length=0,this._numDrawCalls=0,this._numInstances=0,this._numTris=0},n.end=function(){this._isStateInvalied&&this.bindStates(),this._isInRenderPass=!1},n.beginRenderPass=function(t,e,n,i,r,a){var o=this._cmdAllocator.beginRenderPassCmdPool.alloc(uV);o.gpuRenderPass=t.gpuRenderPass,o.gpuFramebuffer=e.gpuFramebuffer,o.renderArea=n;for(var s=0;s<i.length;++s)o.clearColors[s]=i[s];o.clearDepth=r,o.clearStencil=a,this.cmdPackage.beginRenderPassCmds.push(o),this.cmdPackage.cmds.push(rV.BEGIN_RENDER_PASS),this._isInRenderPass=!0},n.endRenderPass=function(){this._isInRenderPass=!1},n.bindPipelineState=function(t){var e=t.gpuPipelineState;e!==this._curGPUPipelineState&&(this._curGPUPipelineState=e,this._isStateInvalied=!0)},n.bindDescriptorSet=function(t,e,n){var i=e.gpuDescriptorSet;if(i!==this._curGPUDescriptorSets[t]&&(this._curGPUDescriptorSets[t]=i,this._isStateInvalied=!0),n){var r,a=null===(r=this._curGPUPipelineState)||void 0===r?void 0:r.gpuPipelineLayout;if(a){for(var o=this._curDynamicOffsets,s=a.dynamicOffsetOffsets[t],c=0;c<n.length;c++)o[s+c]=n[c];this._isStateInvalied=!0}}},n.bindInputAssembler=function(t){var e=t.gpuInputAssembler;this._curGPUInputAssembler=e,this._isStateInvalied=!0},n.setViewport=function(t){var e=this._curDynamicStates.viewport;e.left===t.left&&e.top===t.top&&e.width===t.width&&e.height===t.height&&e.minDepth===t.minDepth&&e.maxDepth===t.maxDepth||(e.left=t.left,e.top=t.top,e.width=t.width,e.height=t.height,e.minDepth=t.minDepth,e.maxDepth=t.maxDepth,this._isStateInvalied=!0)},n.setScissor=function(t){var e=this._curDynamicStates.scissor;e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height||(e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,this._isStateInvalied=!0)},n.setLineWidth=function(t){this._curDynamicStates.lineWidth!==t&&(this._curDynamicStates.lineWidth=t,this._isStateInvalied=!0)},n.setDepthBias=function(t,e,n){var i=this._curDynamicStates;i.depthBiasConstant===t&&i.depthBiasClamp===e&&i.depthBiasSlope===n||(i.depthBiasConstant=t,i.depthBiasClamp=e,i.depthBiasSlope=n,this._isStateInvalied=!0)},n.setBlendConstants=function(t){var e=this._curDynamicStates.blendConstant;e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w||(e.copy(t),this._isStateInvalied=!0)},n.setDepthBound=function(t,e){var n=this._curDynamicStates;n.depthMinBounds===t&&n.depthMaxBounds===e||(n.depthMinBounds=t,n.depthMaxBounds=e,this._isStateInvalied=!0)},n.setStencilWriteMask=function(t,e){var n=this._curDynamicStates.stencilStatesFront,i=this._curDynamicStates.stencilStatesBack;t&Zr.FRONT&&n.writeMask!==e&&(n.writeMask=e,this._isStateInvalied=!0),t&Zr.BACK&&i.writeMask!==e&&(i.writeMask=e,this._isStateInvalied=!0)},n.setStencilCompareMask=function(t,e,n){var i=this._curDynamicStates.stencilStatesFront,r=this._curDynamicStates.stencilStatesBack;t&Zr.FRONT&&(i.compareMask===n&&i.reference===e||(i.reference=e,i.compareMask=n,this._isStateInvalied=!0)),t&Zr.BACK&&(r.compareMask===n&&r.reference===e||(r.reference=e,r.compareMask=n,this._isStateInvalied=!0))},n.draw=function(t){if(this._type===ea.PRIMARY&&this._isInRenderPass||this._type===ea.SECONDARY){this._isStateInvalied&&this.bindStates();var e="drawInfo"in t?t.drawInfo:t,n=this._cmdAllocator.drawCmdPool.alloc(fV);n.drawInfo.copy(e),this.cmdPackage.drawCmds.push(n),this.cmdPackage.cmds.push(rV.DRAW),++this._numDrawCalls,this._numInstances+=e.instanceCount;var i=e.indexCount||e.vertexCount;if(this._curGPUPipelineState)switch(this._curGPUPipelineState.glPrimitive){case 4:this._numTris+=i/3*Math.max(e.instanceCount,1);break;case 5:case 6:this._numTris+=(i-2)*Math.max(e.instanceCount,1)}}else console.error("Command 'draw' must be recorded inside a render pass.")},n.updateBuffer=function(t,e,n){if(this._type===ea.PRIMARY&&!this._isInRenderPass||this._type===ea.SECONDARY){var i=t.gpuBuffer;if(i){var r,a=this._cmdAllocator.updateBufferCmdPool.alloc(_V),o=0;t.usage&Er.INDIRECT||(o=void 0!==n?n:e.byteLength),r=e,a.gpuBuffer=i,a.buffer=r,a.offset=0,a.size=o,this.cmdPackage.updateBufferCmds.push(a),this.cmdPackage.cmds.push(rV.UPDATE_BUFFER)}}else console.error("Command 'updateBuffer' must be recorded outside a render pass.")},n.copyBuffersToTexture=function(t,e,n){if(this._type===ea.PRIMARY&&!this._isInRenderPass||this._type===ea.SECONDARY){var i=e.gpuTexture;if(i){var r=this._cmdAllocator.copyBufferToTextureCmdPool.alloc(pV);r.gpuTexture=i,r.regions=n,r.buffers=t,this.cmdPackage.copyBufferToTextureCmds.push(r),this.cmdPackage.cmds.push(rV.COPY_BUFFER_TO_TEXTURE)}}else console.error("Command 'copyBufferToTexture' must be recorded outside a render pass.")},n.execute=function(t,e){for(var n=0;n<e;++n){for(var i=t[n],r=0;r<i.cmdPackage.beginRenderPassCmds.length;++r){var a=i.cmdPackage.beginRenderPassCmds.array[r];++a.refCount,this.cmdPackage.beginRenderPassCmds.push(a)}for(var o=0;o<i.cmdPackage.bindStatesCmds.length;++o){var s=i.cmdPackage.bindStatesCmds.array[o];++s.refCount,this.cmdPackage.bindStatesCmds.push(s)}for(var c=0;c<i.cmdPackage.drawCmds.length;++c){var l=i.cmdPackage.drawCmds.array[c];++l.refCount,this.cmdPackage.drawCmds.push(l)}for(var u=0;u<i.cmdPackage.updateBufferCmds.length;++u){var h=i.cmdPackage.updateBufferCmds.array[u];++h.refCount,this.cmdPackage.updateBufferCmds.push(h)}for(var f=0;f<i.cmdPackage.copyBufferToTextureCmds.length;++f){var _=i.cmdPackage.copyBufferToTextureCmds.array[f];++_.refCount,this.cmdPackage.copyBufferToTextureCmds.push(_)}this.cmdPackage.cmds.concat(i.cmdPackage.cmds.array),this._numDrawCalls+=i._numDrawCalls,this._numInstances+=i._numInstances,this._numTris+=i._numTris}},n.pipelineBarrier=function(){},n.bindStates=function(){var t=this._cmdAllocator.bindStatesCmdPool.alloc(hV);t.gpuPipelineState=this._curGPUPipelineState,Array.prototype.push.apply(t.gpuDescriptorSets,this._curGPUDescriptorSets),Array.prototype.push.apply(t.dynamicOffsets,this._curDynamicOffsets),t.gpuInputAssembler=this._curGPUInputAssembler,t.dynamicStates=this._curDynamicStates,this.cmdPackage.bindStatesCmds.push(t),this.cmdPackage.cmds.push(rV.BIND_STATES),this._isStateInvalied=!1},e}(To),DV=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._gpuFramebuffer=null,e}F(e,t);var n=e.prototype;return n.initialize=function(t){this._renderPass=t.renderPass,this._colorTextures=t.colorTextures||[],this._depthStencilTexture=t.depthStencilTexture||null;for(var e=[],n=0;n<t.colorTextures.length;n++){var i=t.colorTextures[n];i&&e.push(i.gpuTexture)}var r=null;t.depthStencilTexture&&(r=t.depthStencilTexture.gpuTexture);var a=Number.MAX_SAFE_INTEGER,o=Number.MAX_SAFE_INTEGER;this._gpuFramebuffer={gpuRenderPass:t.renderPass.gpuRenderPass,gpuColorTextures:e,gpuDepthStencilTexture:r,glFramebuffer:null,isOffscreen:!0,get width(){return this.isOffscreen?a:this.gpuColorTextures[0].width},set width(t){a=t},get height(){return this.isOffscreen?o:this.gpuColorTextures[0].height},set height(t){o=t}},function(t,e){for(var n=0;n<e.gpuColorTextures.length;++n)if(e.gpuColorTextures[n].isSwapchainTexture)return void(e.isOffscreen=!1);var i=t.gl,r=[],a=i.createFramebuffer();if(a){e.glFramebuffer=a,t.stateCache.glFramebuffer!==e.glFramebuffer&&i.bindFramebuffer(i.FRAMEBUFFER,e.glFramebuffer);for(var o=0;o<e.gpuColorTextures.length;++o){var s=e.gpuColorTextures[o];s&&(s.glTexture?i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+o,s.glTarget,s.glTexture,0):i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+o,i.RENDERBUFFER,s.glRenderbuffer),r.push(i.COLOR_ATTACHMENT0+o),e.width=Math.min(e.width,s.width),e.height=Math.min(e.height,s.height))}var c=e.gpuDepthStencilTexture;if(c){var l=lo[c.format].hasStencil?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT;c.glTexture?i.framebufferTexture2D(i.FRAMEBUFFER,l,c.glTarget,c.glTexture,0):i.framebufferRenderbuffer(i.FRAMEBUFFER,l,i.RENDERBUFFER,c.glRenderbuffer),e.width=Math.min(e.width,c.width),e.height=Math.min(e.height,c.height)}i.drawBuffers(r);var u=i.checkFramebufferStatus(i.FRAMEBUFFER);if(u!==i.FRAMEBUFFER_COMPLETE)switch(u){case i.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:console.error("glCheckFramebufferStatus() - FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case i.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:console.error("glCheckFramebufferStatus() - FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case i.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:console.error("glCheckFramebufferStatus() - FRAMEBUFFER_INCOMPLETE_DIMENSIONS");break;case i.FRAMEBUFFER_UNSUPPORTED:console.error("glCheckFramebufferStatus() - FRAMEBUFFER_UNSUPPORTED")}t.stateCache.glFramebuffer!==e.glFramebuffer&&i.bindFramebuffer(i.FRAMEBUFFER,t.stateCache.glFramebuffer)}}(QH.instance,this._gpuFramebuffer)},n.destroy=function(){var t,e;this._gpuFramebuffer&&(t=QH.instance,(e=this._gpuFramebuffer).glFramebuffer&&(t.gl.deleteFramebuffer(e.glFramebuffer),t.stateCache.glFramebuffer===e.glFramebuffer&&(t.gl.bindFramebuffer(t.gl.FRAMEBUFFER,null),t.stateCache.glFramebuffer=null),e.glFramebuffer=null),this._gpuFramebuffer=null)},L(e,[{key:"gpuFramebuffer",get:function(){return this._gpuFramebuffer}}]),e}(Co),OV=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._gpuInputAssembler=null,e}F(e,t);var n=e.prototype;return n.initialize=function(t){if(0!==t.vertexBuffers.length){if(this._attributes=t.attributes,this._attributesHash=this.computeAttributesHash(),this._vertexBuffers=t.vertexBuffers,t.indexBuffer)this._indexBuffer=t.indexBuffer,this._drawInfo.indexCount=this._indexBuffer.size/this._indexBuffer.stride,this._drawInfo.firstIndex=0;else{var e=this._vertexBuffers[0];this._drawInfo.vertexCount=e.size/e.stride,this._drawInfo.firstVertex=0,this._drawInfo.vertexOffset=0}this._drawInfo.instanceCount=0,this._drawInfo.firstInstance=0,this._indirectBuffer=t.indirectBuffer||null;for(var n=new Array(t.vertexBuffers.length),i=0;i<t.vertexBuffers.length;++i){var r=t.vertexBuffers[i];r.gpuBuffer&&(n[i]=r.gpuBuffer)}var a=null,o=0;if(t.indexBuffer&&(a=t.indexBuffer.gpuBuffer))switch(a.stride){case 1:o=5121;break;case 2:o=5123;break;case 4:o=5125;break;default:console.error("Illegal index buffer stride.")}var s=null;t.indirectBuffer&&(s=t.indirectBuffer.gpuBuffer),this._gpuInputAssembler={attributes:t.attributes,gpuVertexBuffers:n,gpuIndexBuffer:a,gpuIndirectBuffer:s,glAttribs:[],glIndexType:o,glVAOs:new Map},function(t,e){var n=t.gl;e.glAttribs=new Array(e.attributes.length);for(var i=[0,0,0,0,0,0,0,0],r=0;r<e.attributes.length;++r){var a=e.attributes[r],o=void 0!==a.stream?a.stream:0,s=e.gpuVertexBuffers[o],c=$H(a.format,n),l=lo[a.format].size;e.glAttribs[r]={name:a.name,glBuffer:s.glBuffer,glType:c,size:l,count:lo[a.format].count,stride:s.stride,componentCount:iV(c,n),isNormalized:void 0!==a.isNormalized&&a.isNormalized,isInstanced:void 0!==a.isInstanced&&a.isInstanced,offset:i[o]},i[o]+=l}}(QH.instance,this._gpuInputAssembler)}else console.error("InputAssemblerInfo.vertexBuffers is null.")},n.destroy=function(){var t=QH.instance;this._gpuInputAssembler&&t.extensions.useVAO&&function(t,e){for(var n=e.glVAOs.values(),i=n.next(),r=t.gl,a=t.stateCache.glVAO;!i.done;)r.deleteVertexArray(i.value),a===i.value&&(r.bindVertexArray(null),a=null),i=n.next();t.stateCache.glVAO=a,e.glVAOs.clear()}(t,this._gpuInputAssembler),this._gpuInputAssembler=null},L(e,[{key:"gpuInputAssembler",get:function(){return this._gpuInputAssembler}}]),e}(Io),MV=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._gpuDescriptorSetLayout=null,e}F(e,t);var n=e.prototype;return n.initialize=function(t){Array.prototype.push.apply(this._bindings,t.bindings);for(var e=0,n=-1,i=[],r=0;r<this._bindings.length;r++){var a=this._bindings[r];i.push(e),e+=a.count,a.binding>n&&(n=a.binding)}this._bindingIndices=Array(n+1).fill(-1);for(var o=this._descriptorIndices=Array(n+1).fill(-1),s=0;s<this._bindings.length;s++){var c=this._bindings[s];this._bindingIndices[c.binding]=s,o[c.binding]=i[s]}for(var l=[],u=0;u<this._bindings.length;u++){var h=this._bindings[u];if(h.descriptorType&fo)for(var f=0;f<h.count;f++)l.push(h.binding)}this._gpuDescriptorSetLayout={bindings:this._bindings,dynamicBindings:l,descriptorIndices:o,descriptorCount:e}},n.destroy=function(){this._bindings.length=0},L(e,[{key:"gpuDescriptorSetLayout",get:function(){return this._gpuDescriptorSetLayout}}]),e}(Do),NV=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._gpuPipelineLayout=null,e}F(e,t);var n=e.prototype;return n.initialize=function(t){Array.prototype.push.apply(this._setLayouts,t.setLayouts);for(var e=[],n=[],i=0,r=[],a=0;a<this._setLayouts.length;a++){for(var o=this._setLayouts[a],s=o.gpuDescriptorSetLayout.dynamicBindings,c=Array(o.bindingIndices.length).fill(-1),l=0;l<s.length;l++){var u=s[l];c[u]<0&&(c[u]=i+l)}n.push(o.gpuDescriptorSetLayout),e.push(c),r.push(i),i+=s.length}this._gpuPipelineLayout={gpuSetLayouts:n,dynamicOffsetIndices:e,dynamicOffsetCount:i,dynamicOffsetOffsets:r}},n.destroy=function(){this._setLayouts.length=0},L(e,[{key:"gpuPipelineLayout",get:function(){return this._gpuPipelineLayout}}]),e}(Oo),LV=[0,1,3,2,0,0,0,4,5,6,0,0,0,0],BV=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._gpuPipelineState=null,e}F(e,t);var n=e.prototype;return n.initialize=function(t){this._primitive=t.primitive,this._shader=t.shader,this._pipelineLayout=t.pipelineLayout;var e=this._bs;if(t.blendState){var n=t.blendState,i=n.targets;i&&i.forEach((function(t,n){e.setTarget(n,t)})),void 0!==n.isA2C&&(e.isA2C=n.isA2C),void 0!==n.isIndepend&&(e.isIndepend=n.isIndepend),void 0!==n.blendColor&&(e.blendColor=n.blendColor)}Object.assign(this._rs,t.rasterizerState),Object.assign(this._dss,t.depthStencilState),this._is=t.inputState,this._renderPass=t.renderPass,this._dynamicStates=t.dynamicStates;for(var r=[],a=0;a<31;a++)this._dynamicStates&1<<a&&r.push(1<<a);this._gpuPipelineState={glPrimitive:LV[t.primitive],gpuShader:t.shader.gpuShader,gpuPipelineLayout:t.pipelineLayout.gpuPipelineLayout,rs:t.rasterizerState,dss:t.depthStencilState,bs:t.blendState,gpuRenderPass:t.renderPass.gpuRenderPass,dynamicStates:r}},n.destroy=function(){this._gpuPipelineState=null},L(e,[{key:"gpuPipelineState",get:function(){return this._gpuPipelineState}}]),e}(zo),FV=function(t){function e(){return t.apply(this,arguments)||this}F(e,t);var n=e.prototype;return n.beginRenderPass=function(t,e,n,i,r,a){xV(QH.instance,t.gpuRenderPass,e.gpuFramebuffer,n,i,r,a),this._isInRenderPass=!0},n.draw=function(t){if(this._isInRenderPass){this._isStateInvalied&&this.bindStates();var e="drawInfo"in t?t.drawInfo:t;TV(QH.instance,e),++this._numDrawCalls,this._numInstances+=e.instanceCount;var n=e.indexCount||e.vertexCount;if(this._curGPUPipelineState)switch(this._curGPUPipelineState.glPrimitive){case 4:this._numTris+=n/3*Math.max(e.instanceCount,1);break;case 5:case 6:this._numTris+=(n-2)*Math.max(e.instanceCount,1)}}else console.error("Command 'draw' must be recorded inside a render pass.")},n.setViewport=function(t){var e=QH.instance,n=e.stateCache,i=e.gl;n.viewport.left===t.left&&n.viewport.top===t.top&&n.viewport.width===t.width&&n.viewport.height===t.height||(i.viewport(t.left,t.top,t.width,t.height),n.viewport.left=t.left,n.viewport.top=t.top,n.viewport.width=t.width,n.viewport.height=t.height)},n.setScissor=function(t){var e=QH.instance,n=e.stateCache,i=e.gl;n.scissorRect.x===t.x&&n.scissorRect.y===t.y&&n.scissorRect.width===t.width&&n.scissorRect.height===t.height||(i.scissor(t.x,t.y,t.width,t.height),n.scissorRect.x=t.x,n.scissorRect.y=t.y,n.scissorRect.width=t.width,n.scissorRect.height=t.height)},n.updateBuffer=function(t,e,n){if(this._isInRenderPass)console.error("Command 'updateBuffer' must be recorded outside a render pass.");else{var i,r=t.gpuBuffer;r&&(i=void 0!==n?n:t.usage&Er.INDIRECT?0:e.byteLength,mV(QH.instance,r,e,0,i))}},n.copyBuffersToTexture=function(t,e,n){if(this._isInRenderPass)console.error("Command 'copyBufferToTexture' must be recorded outside a render pass.");else{var i=e.gpuTexture;i&&CV(QH.instance,t,i,n)}},n.execute=function(t,e){for(var n=0;n<e;++n){var i=t[n];EV(QH.instance,i.cmdPackage),this._numDrawCalls+=i._numDrawCalls,this._numInstances+=i._numInstances,this._numTris+=i._numTris}},n.bindStates=function(){SV(QH.instance,this._curGPUPipelineState,this._curGPUInputAssembler,this._curGPUDescriptorSets,this._curDynamicOffsets,this._curDynamicStates),this._isStateInvalied=!1},e}(RV),zV=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).numDrawCalls=0,e.numInstances=0,e.numTris=0,e}F(e,t);var n=e.prototype;return n.initialize=function(t){this._type=t.type},n.destroy=function(){},n.submit=function(t){for(var e=0;e<t.length;e++){var n=t[e];this.numDrawCalls+=n.numDrawCalls,this.numInstances+=n.numInstances,this.numTris+=n.numTris}},n.clear=function(){this.numDrawCalls=0,this.numInstances=0,this.numTris=0},e}(Uo),UV=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._gpuRenderPass=null,e}F(e,t);var n=e.prototype;return n.initialize=function(t){this._colorInfos=t.colorAttachments,this._depthStencilInfo=t.depthStencilAttachment,this._subpasses=t.subpasses,this._gpuRenderPass={colorAttachments:this._colorInfos,depthStencilAttachment:this._depthStencilInfo},this._hash=this.computeHash()},n.destroy=function(){this._gpuRenderPass=null},L(e,[{key:"gpuRenderPass",get:function(){return this._gpuRenderPass}}]),e}(ko),kV=function(t){function e(e,n){var i,r,a,o,s;return(i=t.call(this,e,n)||this)._gpuSampler=null,i._gpuSampler={glSampler:null,minFilter:i._info.minFilter,magFilter:i._info.magFilter,mipFilter:i._info.mipFilter,addressU:i._info.addressU,addressV:i._info.addressV,addressW:i._info.addressW,glMinFilter:0,glMagFilter:0,glWrapS:0,glWrapT:0,glWrapR:0},r=QH.instance,a=i._gpuSampler,(s=(o=r.gl).createSampler())&&(a.minFilter===Mr.LINEAR||a.minFilter===Mr.ANISOTROPIC?a.mipFilter===Mr.LINEAR||a.mipFilter===Mr.ANISOTROPIC?a.glMinFilter=o.LINEAR_MIPMAP_LINEAR:a.mipFilter===Mr.POINT?a.glMinFilter=o.LINEAR_MIPMAP_NEAREST:a.glMinFilter=o.LINEAR:a.mipFilter===Mr.LINEAR||a.mipFilter===Mr.ANISOTROPIC?a.glMinFilter=o.NEAREST_MIPMAP_LINEAR:a.mipFilter===Mr.POINT?a.glMinFilter=o.NEAREST_MIPMAP_NEAREST:a.glMinFilter=o.NEAREST,a.magFilter===Mr.LINEAR||a.magFilter===Mr.ANISOTROPIC?a.glMagFilter=o.LINEAR:a.glMagFilter=o.NEAREST,a.glWrapS=ZH[a.addressU],a.glWrapT=ZH[a.addressV],a.glWrapR=ZH[a.addressW],a.glSampler=s,o.samplerParameteri(s,o.TEXTURE_MIN_FILTER,a.glMinFilter),o.samplerParameteri(s,o.TEXTURE_MAG_FILTER,a.glMagFilter),o.samplerParameteri(s,o.TEXTURE_WRAP_S,a.glWrapS),o.samplerParameteri(s,o.TEXTURE_WRAP_T,a.glWrapT),o.samplerParameteri(s,o.TEXTURE_WRAP_R,a.glWrapR),o.samplerParameterf(s,o.TEXTURE_MIN_LOD,0),o.samplerParameterf(s,o.TEXTURE_MAX_LOD,1e3)),i}return F(e,t),e.prototype.destroy=function(){this._gpuSampler&&(function(t,e){var n=t.gl;if(e.glSampler){n.deleteSampler(e.glSampler);for(var i=t.stateCache.glSamplerUnits,r=0;r<i.length;++r)i[r]===e.glSampler&&(n.bindSampler(r,null),i[r]=null);e.glSampler=null}}(QH.instance,this._gpuSampler),this._gpuSampler=null)},L(e,[{key:"gpuSampler",get:function(){return this._gpuSampler}}]),e}(Go),GV=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._gpuShader=null,e}F(e,t);var n=e.prototype;return n.initialize=function(t){this._name=t.name,this._stages=t.stages,this._attributes=t.attributes,this._blocks=t.blocks,this._samplers=t.samplers,this._gpuShader={name:t.name,blocks:t.blocks.slice(),samplerTextures:t.samplerTextures.slice(),subpassInputs:t.subpassInputs.slice(),gpuStages:new Array(t.stages.length),glProgram:null,glInputs:[],glUniforms:[],glBlocks:[],glSamplerTextures:[]};for(var e=0;e<t.stages.length;++e){var n=t.stages[e];this._gpuShader.gpuStages[e]={type:n.stage,source:n.source,glShader:null}}!function(t,e){for(var n=t.gl,i=function(t){var i=e.gpuStages[t],r=0,a="",o=1;switch(i.type){case kr.VERTEX:a="VertexShader",r=n.VERTEX_SHADER;break;case kr.FRAGMENT:a="FragmentShader",r=n.FRAGMENT_SHADER;break;default:return console.error("Unsupported ShaderType."),{v:void 0}}var s=n.createShader(r);if(s&&(i.glShader=s,n.shaderSource(i.glShader,"#version 300 es\n"+i.source),n.compileShader(i.glShader),!n.getShaderParameter(i.glShader,n.COMPILE_STATUS))){console.error(a+" in '"+e.name+"' compilation failed."),console.error("Shader source dump:",i.source.replace(/^|\n/g,(function(){return"\n"+o+++" "}))),console.error(n.getShaderInfoLog(i.glShader));for(var c=0;c<e.gpuStages.length;c++){var l=e.gpuStages[t];l.glShader&&(n.deleteShader(l.glShader),l.glShader=null)}return{v:void 0}}},r=0;r<e.gpuStages.length;r++){var a=i(r);if("object"==typeof a)return a.v}var o=n.createProgram();if(o){e.glProgram=o;for(var s=0;s<e.gpuStages.length;s++){var c=e.gpuStages[s];n.attachShader(e.glProgram,c.glShader)}n.linkProgram(e.glProgram);for(var l=0;l<e.gpuStages.length;l++){var u=e.gpuStages[l];u.glShader&&(n.detachShader(e.glProgram,u.glShader),n.deleteShader(u.glShader),u.glShader=null)}if(!n.getProgramParameter(e.glProgram,n.LINK_STATUS))return console.error("Failed to link shader '"+e.name+"'."),void console.error(n.getProgramInfoLog(e.glProgram));g("Shader '"+e.name+"' compilation succeeded.");var h=n.getProgramParameter(e.glProgram,n.ACTIVE_ATTRIBUTES);e.glInputs=new Array(h);for(var f=0;f<h;++f){var _=n.getActiveAttrib(e.glProgram,f);if(_){var p,m=_.name.indexOf("[");p=-1!==m?_.name.substr(0,m):_.name;var v=n.getAttribLocation(e.glProgram,p),y=eV(_.type,n),x=nV(_.type,n);e.glInputs[f]={name:p,type:y,stride:x,count:_.size,size:x*_.size,glType:_.type,glLoc:v}}}var S,T,A,E,C=n.getProgramParameter(e.glProgram,n.ACTIVE_UNIFORM_BLOCKS);if(C){e.glBlocks=new Array(C);for(var b=0;b<C;++b){var w=(S=n.getActiveUniformBlockName(e.glProgram,b)).indexOf("[");-1!==w&&(S=S.substr(0,w)),E=null;for(var P=0;P<e.blocks.length;P++)if(e.blocks[P].name===S){E=e.blocks[P];break}if(E){T=b,A=n.getActiveUniformBlockParameter(e.glProgram,T,n.UNIFORM_BLOCK_DATA_SIZE);var I=E.binding+(t.bindingMappingInfo.bufferOffsets[E.set]||0);n.uniformBlockBinding(e.glProgram,T,I),e.glBlocks[b]={set:E.set,binding:E.binding,idx:T,name:S,size:A,glBinding:I}}else d("Block '"+S+"' does not bound")}}for(var R=0;R<e.subpassInputs.length;++R){var D=e.subpassInputs[R];e.samplerTextures.push(new Oa(D.set,D.binding,D.name,Ar.SAMPLER2D,D.count))}if(e.samplerTextures.length>0){e.glSamplerTextures=new Array(e.samplerTextures.length);for(var O=0;O<e.samplerTextures.length;++O){var M=e.samplerTextures[O];e.glSamplerTextures[O]={set:M.set,binding:M.binding,name:M.name,type:M.type,count:M.count,units:[],glUnits:null,glType:tV(M.type,n),glLoc:null}}}for(var N=[],L=[],B=t.stateCache.texUnitCacheMap,F=0,z=0;z<e.blocks.length;++z)e.blocks[z].set===t.bindingMappingInfo.flexibleSet&&F++;for(var U=0,k=0;k<e.samplerTextures.length;++k){var G=e.samplerTextures[k],H=n.getUniformLocation(e.glProgram,G.name);if(H&&-1!==H.id&&(N.push(e.glSamplerTextures[k]),L.push(H)),void 0===B[G.name]){var V=G.binding+t.bindingMappingInfo.samplerOffsets[G.set]+U;G.set===t.bindingMappingInfo.flexibleSet&&(V-=F),B[G.name]=V%t.capabilities.maxTextureUnits,U+=G.count-1}}if(N.length){for(var j=[],W=0;W<N.length;++W){var X=N[W],q=B[X.name];if(void 0!==q){X.glLoc=L[W];for(var Y=0;Y<X.count;++Y){for(;j[q];)q=(q+1)%t.capabilities.maxTextureUnits;X.units.push(q),j[q]=!0}}}for(var K=0,Q=0;Q<N.length;++Q){var Z=N[Q];if(!Z.glLoc){for(Z.glLoc=L[Q];j[K];)K++;for(var J=0;J<Z.count;++J){for(;j[K];)K=(K+1)%t.capabilities.maxTextureUnits;void 0===B[Z.name]&&(B[Z.name]=K),Z.units.push(K),j[K]=!0}}}t.stateCache.glProgram!==e.glProgram&&n.useProgram(e.glProgram);for(var $=0;$<N.length;$++){var tt=N[$];tt.glUnits=new Int32Array(tt.units),n.uniform1iv(tt.glLoc,tt.glUnits)}t.stateCache.glProgram!==e.glProgram&&n.useProgram(t.stateCache.glProgram)}e.glSamplerTextures=N}}(QH.instance,this._gpuShader)},n.destroy=function(){var t,e;this._gpuShader&&(t=QH.instance,(e=this._gpuShader).glProgram&&(t.gl.deleteProgram(e.glProgram),t.stateCache.glProgram===e.glProgram&&(t.gl.useProgram(null),t.stateCache.glProgram=null),e.glProgram=null),this._gpuShader=null)},L(e,[{key:"gpuShader",get:function(){return this._gpuShader}}]),e}(Ho),HV=function(){function t(){this.glArrayBuffer=null,this.glElementArrayBuffer=null,this.glUniformBuffer=null,this.glBindUBOs=[],this.glBindUBOOffsets=[],this.glVAO=null,this.texUnit=0,this.glTexUnits=[],this.glSamplerUnits=[],this.glRenderbuffer=null,this.glFramebuffer=null,this.glReadFramebuffer=null,this.viewport=new ga,this.scissorRect=new ua(0,0,0,0),this.rs=new Mo,this.dss=new No,this.bs=new Bo,this.glProgram=null,this.glEnabledAttribLocs=[],this.glCurrentAttribLocs=[],this.texUnitCacheMap={}}return t.prototype.initialize=function(t,e,n){for(var i=0;i<t;++i)this.glTexUnits.push({glTexture:null});this.glSamplerUnits.length=t,this.glSamplerUnits.fill(null),this.glBindUBOs.length=e,this.glBindUBOs.fill(null),this.glBindUBOOffsets.length=e,this.glBindUBOOffsets.fill(0),this.glEnabledAttribLocs.length=n,this.glEnabledAttribLocs.fill(!1),this.glCurrentAttribLocs.length=n,this.glCurrentAttribLocs.fill(!1)},t}(),VV=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._gpuTexture=null,e}F(e,t);var n=e.prototype;return n.initialize=function(t,e){"texture"in t?console.log("WebGL2 does not support texture view."):(this._type=t.type,this._usage=t.usage,this._format=t.format,this._width=t.width,this._height=t.height,this._depth=t.depth,this._layerCount=t.layerCount,this._levelCount=t.levelCount,this._samples=t.samples,this._flags=t.flags,this._isPowerOf2=_o(this._width)&&_o(this._height),this._size=mo(this._format,this.width,this.height,this.depth,this._levelCount)*this._layerCount,this._gpuTexture={type:this._type,format:this._format,usage:this._usage,width:this._width,height:this._height,depth:this._depth,size:this._size,arrayLayer:this._layerCount,mipLevel:this._levelCount,samples:this._samples,flags:this._flags,isPowerOf2:this._isPowerOf2,glTarget:0,glInternalFmt:0,glFormat:0,glType:0,glUsage:0,glTexture:null,glRenderbuffer:null,glWrapS:0,glWrapT:0,glMinFilter:0,glMagFilter:0,isSwapchainTexture:e||!1},gV(QH.instance,this._gpuTexture),QH.instance.memoryStatus.textureSize+=this._size)},n.destroy=function(){this._gpuTexture&&(vV(QH.instance,this._gpuTexture),QH.instance.memoryStatus.textureSize-=this._size,this._gpuTexture=null)},n.resize=function(t,e){var n=this._size;this._width=t,this._height=e,this._size=mo(this._format,this.width,this.height,this.depth,this._levelCount)*this._layerCount,this._gpuTexture&&(this._gpuTexture.width=t,this._gpuTexture.height=e,this._gpuTexture.size=this._size,function(t,e){if(e.size){var n=t.gl,i=e.width,r=e.height;switch(e.type){case Pr.TEX2D:e.glTarget=n.TEXTURE_2D;var a=Math.max(i,r);if(a>t.capabilities.maxTextureSize&&b(9100,a,t.capabilities.maxTextureSize),e.samples===Dr.ONE){var o=t.stateCache.glTexUnits[t.stateCache.texUnit];if(o.glTexture!==e.glTexture&&(n.bindTexture(n.TEXTURE_2D,e.glTexture),o.glTexture=e.glTexture),lo[e.format].isCompressed)for(var s=0;s<e.mipLevel;++s){var c=po(e.format,i,r,1),l=new Uint8Array(c);n.compressedTexImage2D(n.TEXTURE_2D,s,e.glInternalFmt,i,r,0,l),i=Math.max(1,i>>1),r=Math.max(1,r>>1)}else vV(t,e),gV(t,e)}else e.glRenderbuffer&&(t.stateCache.glRenderbuffer!==e.glRenderbuffer&&(n.bindRenderbuffer(n.RENDERBUFFER,e.glRenderbuffer),t.stateCache.glRenderbuffer=e.glRenderbuffer),n.renderbufferStorageMultisample(n.RENDERBUFFER,e.samples,e.glInternalFmt,e.width,e.height));break;case Pr.CUBE:e.type=Pr.CUBE,e.glTarget=n.TEXTURE_CUBE_MAP;var u=Math.max(i,r);u>t.capabilities.maxCubeMapTextureSize&&b(9100,u,t.capabilities.maxTextureSize);var h=t.stateCache.glTexUnits[t.stateCache.texUnit];if(h.glTexture!==e.glTexture&&(n.bindTexture(n.TEXTURE_CUBE_MAP,e.glTexture),h.glTexture=e.glTexture),lo[e.format].isCompressed)for(var f=0;f<6;++f){i=e.width,r=e.height;for(var _=0;_<e.mipLevel;++_){var p=po(e.format,i,r,1),d=new Uint8Array(p);n.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+f,_,e.glInternalFmt,i,r,0,d),i=Math.max(1,i>>1),r=Math.max(1,r>>1)}}else vV(t,e),gV(t,e);break;default:console.error("Unsupported TextureType, create texture failed."),e.type=Pr.TEX2D,e.glTarget=n.TEXTURE_2D}}}(QH.instance,this._gpuTexture),QH.instance.memoryStatus.textureSize-=n,QH.instance.memoryStatus.textureSize+=this._size)},n.initAsSwapchainTexture=function(t){var e=new wa;e.format=t.format,e.usage=lo[t.format].hasDepth?Ir.DEPTH_STENCIL_ATTACHMENT:Ir.COLOR_ATTACHMENT,e.width=t.width,e.height=t.height,this.initialize(e,!0)},L(e,[{key:"gpuTexture",get:function(){return this._gpuTexture}}]),e}(Vo),jV="webglcontextlost";function WV(t,e){for(var n=["","WEBKIT_","MOZ_"],i=0;i<n.length;++i){var r=t.getExtension(n[i]+e);if(r)return r}return null}function XV(t){var e={EXT_texture_filter_anisotropic:WV(t,"EXT_texture_filter_anisotropic"),EXT_color_buffer_half_float:WV(t,"EXT_color_buffer_half_float"),EXT_color_buffer_float:WV(t,"EXT_color_buffer_float"),WEBGL_compressed_texture_etc1:WV(t,"WEBGL_compressed_texture_etc1"),WEBGL_compressed_texture_etc:WV(t,"WEBGL_compressed_texture_etc"),WEBGL_compressed_texture_pvrtc:WV(t,"WEBGL_compressed_texture_pvrtc"),WEBGL_compressed_texture_astc:WV(t,"WEBGL_compressed_texture_astc"),WEBGL_compressed_texture_s3tc:WV(t,"WEBGL_compressed_texture_s3tc"),WEBGL_compressed_texture_s3tc_srgb:WV(t,"WEBGL_compressed_texture_s3tc_srgb"),WEBGL_debug_shaders:WV(t,"WEBGL_debug_shaders"),WEBGL_lose_context:WV(t,"WEBGL_lose_context"),WEBGL_debug_renderer_info:WV(t,"WEBGL_debug_renderer_info"),OES_texture_half_float_linear:WV(t,"OES_texture_half_float_linear"),OES_texture_float_linear:WV(t,"OES_texture_float_linear"),WEBGL_multi_draw:null,useVAO:!0};return _n.os!==ln.ANDROID&&_n.os!==ln.IOS&&(e.WEBGL_multi_draw=WV(t,"WEBGL_multi_draw")),e}var qV=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).stateCache=new HV,e.nullTex2D=null,e.nullTexCube=null,e._canvas=null,e._webGL2ContextLostHandler=null,e._extensions=null,e}F(e,t);var n=e.prototype;return n.initialize=function(t){this._canvas=t.windowHandle,this._webGL2ContextLostHandler=this._onWebGLContextLost.bind(this),this._canvas.addEventListener(jV,this._onWebGLContextLost);var e=QH.instance.gl;this.stateCache.initialize(QH.instance.capabilities.maxTextureUnits,QH.instance.capabilities.maxUniformBufferBindings,QH.instance.capabilities.maxVertexAttributes),this._extensions=XV(e),function(t){t.activeTexture(t.TEXTURE0),t.pixelStorei(t.PACK_ALIGNMENT,1),t.pixelStorei(t.UNPACK_ALIGNMENT,1),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),t.bindFramebuffer(t.FRAMEBUFFER,null),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),t.frontFace(t.CCW),t.polygonOffset(0,0),t.enable(t.DEPTH_TEST),t.depthMask(!0),t.depthFunc(t.LESS),t.stencilFuncSeparate(t.FRONT,t.ALWAYS,1,65535),t.stencilOpSeparate(t.FRONT,t.KEEP,t.KEEP,t.KEEP),t.stencilMaskSeparate(t.FRONT,65535),t.stencilFuncSeparate(t.BACK,t.ALWAYS,1,65535),t.stencilOpSeparate(t.BACK,t.KEEP,t.KEEP,t.KEEP),t.stencilMaskSeparate(t.BACK,65535),t.disable(t.STENCIL_TEST),t.disable(t.SAMPLE_ALPHA_TO_COVERAGE),t.disable(t.BLEND),t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ONE,t.ZERO,t.ONE,t.ZERO),t.colorMask(!0,!0,!0,!0),t.blendColor(0,0,0,0)}(e);var n=Sr.RGBA8,i=Sr.DEPTH_STENCIL,r=e.getParameter(e.DEPTH_BITS),a=e.getParameter(e.STENCIL_BITS);r&&a?i=Sr.DEPTH_STENCIL:r&&(i=Sr.DEPTH),this._colorTexture=new VV,this._colorTexture.initAsSwapchainTexture({swapchain:this,format:n,width:t.width,height:t.height}),this._depthStencilTexture=new VV,this._depthStencilTexture.initAsSwapchainTexture({swapchain:this,format:i,width:t.width,height:t.height}),this.nullTex2D=QH.instance.createTexture(new wa(Pr.TEX2D,Ir.SAMPLED,Sr.RGBA8,2,2,Rr.NONE)),this.nullTexCube=QH.instance.createTexture(new wa(Pr.CUBE,Ir.SAMPLED,Sr.RGBA8,2,2,Rr.NONE,6));var o=new ma;o.texExtent.width=2,o.texExtent.height=2;var s=new Uint8Array(this.nullTex2D.size);s.fill(0),QH.instance.copyBuffersToTexture([s],this.nullTex2D,[o]),o.texSubres.layerCount=6,QH.instance.copyBuffersToTexture([s,s,s,s,s,s],this.nullTexCube,[o])},n.destroy=function(){this._canvas&&this._webGL2ContextLostHandler&&(this._canvas.removeEventListener(jV,this._webGL2ContextLostHandler),this._webGL2ContextLostHandler=null),this.nullTex2D&&(this.nullTex2D.destroy(),this.nullTex2D=null),this.nullTexCube&&(this.nullTexCube.destroy(),this.nullTexCube=null),this._extensions=null,this._canvas=null},n.resize=function(t,e){this._colorTexture.width===t&&this._colorTexture.height===e||(g("Resizing swapchain: "+t+"x"+e),this._canvas.width=t,this._canvas.height=e,this._colorTexture.resize(t,e),this._depthStencilTexture.resize(t,e))},n._onWebGLContextLost=function(t){E(11e3),p(t)},L(e,[{key:"extensions",get:function(){return this._extensions}}]),e}(Eo),YV=t("WebGL2Device",function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._swapchain=null,e._context=null,e}F(e,t);var n=e.prototype;return n.initialize=function(t){QH.setInstance(this),this._gfxAPI=vr.WEBGL2,this._bindingMappingInfo=t.bindingMappingInfo,this._bindingMappingInfo.bufferOffsets.length||this._bindingMappingInfo.bufferOffsets.push(0),this._bindingMappingInfo.samplerOffsets.length||this._bindingMappingInfo.samplerOffsets.push(0);var e=this._context=function(t){var e=null;try{var n={alpha:$t.ENABLE_TRANSPARENT_CANVAS,antialias:$t.ENABLE_WEBGL_ANTIALIAS,depth:!0,stencil:!0,premultipliedAlpha:!1,preserveDrawingBuffer:!1,powerPreference:"default",failIfMajorPerformanceCaveat:!1};e=t.getContext("webgl2",n)}catch(t){return null}return e}(Ao.canvas);if(!e)return console.error("This device does not support WebGL."),!1;this._queue=this.createQueue(new no($r.GRAPHICS)),this._cmdBuff=this.createCommandBuffer(new eo(this._queue)),this._caps.maxVertexAttributes=e.getParameter(e.MAX_VERTEX_ATTRIBS),this._caps.maxVertexUniformVectors=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),this._caps.maxFragmentUniformVectors=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),this._caps.maxTextureUnits=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),this._caps.maxVertexTextureUnits=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this._caps.maxUniformBufferBindings=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS),this._caps.maxUniformBlockSize=e.getParameter(e.MAX_UNIFORM_BLOCK_SIZE),this._caps.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this._caps.maxCubeMapTextureSize=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),this._caps.uboOffsetAlignment=e.getParameter(e.UNIFORM_BUFFER_OFFSET_ALIGNMENT);var n=e.getSupportedExtensions(),i="";if(n)for(var r,a=W(n);!(r=a()).done;)i+=r.value+" ";var o=XV(e);o.WEBGL_debug_renderer_info?(this._renderer=e.getParameter(o.WEBGL_debug_renderer_info.UNMASKED_RENDERER_WEBGL),this._vendor=e.getParameter(o.WEBGL_debug_renderer_info.UNMASKED_VENDOR_WEBGL)):(this._renderer=e.getParameter(e.RENDERER),this._vendor=e.getParameter(e.VENDOR));var s=e.getParameter(e.VERSION);this._features.fill(!1),this._features[xr.TEXTURE_FLOAT]=!0,this._features[xr.TEXTURE_HALF_FLOAT]=!0,this._features[xr.FORMAT_R11G11B10F]=!0,this._features[xr.FORMAT_SRGB]=!0,this._features[xr.FORMAT_RGB8]=!0,this._features[xr.ELEMENT_INDEX_UINT]=!0,this._features[xr.INSTANCED_ARRAYS]=!0,this._features[xr.MULTIPLE_RENDER_TARGETS]=!0,this._features[xr.BLEND_MINMAX]=!0,o.EXT_color_buffer_float&&(this._features[xr.COLOR_FLOAT]=!0,this._features[xr.COLOR_HALF_FLOAT]=!0),o.OES_texture_float_linear&&(this._features[xr.TEXTURE_FLOAT_LINEAR]=!0),o.OES_texture_half_float_linear&&(this._features[xr.TEXTURE_HALF_FLOAT_LINEAR]=!0);var c="";return o.WEBGL_compressed_texture_etc1&&(this._features[xr.FORMAT_ETC1]=!0,c+="etc1 "),o.WEBGL_compressed_texture_etc&&(this._features[xr.FORMAT_ETC2]=!0,c+="etc2 "),o.WEBGL_compressed_texture_s3tc&&(this._features[xr.FORMAT_DXT]=!0,c+="dxt "),o.WEBGL_compressed_texture_pvrtc&&(this._features[xr.FORMAT_PVRTC]=!0,c+="pvrtc "),o.WEBGL_compressed_texture_astc&&(this._features[xr.FORMAT_ASTC]=!0,c+="astc "),g("WebGL2 device initialized."),g("RENDERER: "+this._renderer),g("VENDOR: "+this._vendor),g("VERSION: "+s),g("COMPRESSED_FORMAT: "+c),g("EXTENSIONS: "+i),!0},n.destroy=function(){this._queue&&(this._queue.destroy(),this._queue=null),this._cmdBuff&&(this._cmdBuff.destroy(),this._cmdBuff=null);for(var t=this._samplers.values(),e=t.next();!e.done;)e.value.destroy(),e=t.next();this._swapchain=null},n.flushCommands=function(){},n.acquire=function(){},n.present=function(){var t=this._queue;this._numDrawCalls=t.numDrawCalls,this._numInstances=t.numInstances,this._numTris=t.numTris,t.clear()},n.createCommandBuffer=function(t){var e=new(t.type===ea.PRIMARY?FV:RV);return e.initialize(t),e},n.createSwapchain=function(t){var e=new qV;return this._swapchain=e,e.initialize(t),e},n.createBuffer=function(t){var e=new wV;return e.initialize(t),e},n.createTexture=function(t){var e=new VV;return e.initialize(t),e},n.createDescriptorSet=function(t){var e=new KH;return e.initialize(t),e},n.createShader=function(t){var e=new GV;return e.initialize(t),e},n.createInputAssembler=function(t){var e=new OV;return e.initialize(t),e},n.createRenderPass=function(t){var e=new UV;return e.initialize(t),e},n.createFramebuffer=function(t){var e=new DV;return e.initialize(t),e},n.createDescriptorSetLayout=function(t){var e=new MV;return e.initialize(t),e},n.createPipelineLayout=function(t){var e=new NV;return e.initialize(t),e},n.createPipelineState=function(t){var e=new BV;return e.initialize(t),e},n.createQueue=function(t){var e=new zV;return e.initialize(t),e},n.getSampler=function(t){var e=Go.computeHash(t);return this._samplers.has(e)||this._samplers.set(e,new kV(t,e)),this._samplers.get(e)},n.getGlobalBarrier=function(t){var e=jo.computeHash(t);return this._globalBarriers.has(e)||this._globalBarriers.set(e,new jo(t,e)),this._globalBarriers.get(e)},n.getTextureBarrier=function(t){var e=Wo.computeHash(t);return this._textureBarriers.has(e)||this._textureBarriers.set(e,new Wo(t,e)),this._textureBarriers.get(e)},n.copyBuffersToTexture=function(t,e,n){CV(this,t,e.gpuTexture,n)},n.copyTextureToBuffers=function(t,e,n){!function(t,e,n,i){var r=t.gl,a=t.stateCache,o=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,o);var s=0,c=0,l=1,u=1;switch(e.glTarget){case r.TEXTURE_2D:for(var h=0;h<i.length;h++){var f=i[h];r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,e.glTarget,e.glTexture,f.texSubres.mipLevel),s=f.texOffset.x,c=f.texOffset.y,l=f.texExtent.width,u=f.texExtent.height,r.readPixels(s,c,l,u,e.glFormat,e.glType,n[h])}break;default:console.error("Unsupported GL texture type, copy texture to buffers failed.")}r.bindFramebuffer(r.FRAMEBUFFER,null),a.glFramebuffer=null,r.deleteFramebuffer(o)}(this,t.gpuTexture,e,n)},n.copyTexImagesToTexture=function(t,e,n){!function(t,e,n,i){var r=t.gl,a=t.stateCache.glTexUnits[t.stateCache.texUnit];a.glTexture!==n.glTexture&&(r.bindTexture(n.glTarget,n.glTexture),a.glTexture=n.glTexture);var o=0,s=0;switch(n.glTarget){case r.TEXTURE_2D:for(var c=0;c<i.length;c++){var l=i[c];r.texSubImage2D(r.TEXTURE_2D,l.texSubres.mipLevel,l.texOffset.x,l.texOffset.y,n.glFormat,n.glType,e[o++])}break;case r.TEXTURE_CUBE_MAP:for(var u=0;u<i.length;u++){var h=i[u],f=h.texSubres.baseArrayLayer+h.texSubres.layerCount;for(s=h.texSubres.baseArrayLayer;s<f;++s)r.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+s,h.texSubres.mipLevel,h.texOffset.x,h.texOffset.y,n.glFormat,n.glType,e[o++])}break;default:console.error("Unsupported GL texture type, copy buffer to texture failed.")}n.flags&Rr.GEN_MIPMAP&&r.generateMipmap(n.glTarget)}(this,t,e.gpuTexture,n)},L(e,[{key:"gl",get:function(){return this._context}},{key:"extensions",get:function(){return this._swapchain.extensions}},{key:"stateCache",get:function(){return this._swapchain.stateCache}},{key:"nullTex2D",get:function(){return this._swapchain.nullTex2D}},{key:"nullTexCube",get:function(){return this._swapchain.nullTexCube}}]),e}(Ao));i.WebGL2Device=YV;var KV=new di,QV=new Ri;function ZV(t,e,n,i){var r=n.chunk,a=n.data,o=r.vb,s=n.vertexCount;t.getWorldMatrix(QV);for(var c=0,l=0;l<s;l++){var u=a[l];di.set(KV,u.x,u.y,0),di.transformMat4(KV,KV,QV),o[c++]=KV.x,o[c++]=KV.y,o[c++]=KV.z,_i.toArray(o,i,c+2),c+=6}for(var h=r.bufferId,f=r.vertexOffset,_=r.vertexAccessor.getMeshBuffer(r.bufferId),p=r.vertexAccessor.getIndexBuffer(h),d=_.indexOffset,m=0,g=s/4;m<g;m++){var v=f+4*m;p[d++]=v,p[d++]=v+1,p[d++]=v+2,p[d++]=v+1,p[d++]=v+3,p[d++]=v+2}_.indexOffset+=n.indexCount,_.setDirty()}var JV=function(){function t(t,e){this._texture=void 0,this._width=void 0,this._height=void 0,this._x=void 0,this._y=void 0,this._nexty=void 0,this._innerTextureInfos={},this._innerSpriteFrames=void 0,this._count=void 0;var n=new $V;n.initWithSize(t,e),this._texture=n,this._width=t,this._height=e,this._x=2,this._y=2,this._nexty=2,this._innerTextureInfos={},this._innerSpriteFrames=[],this._count=0}var e=t.prototype;return e.insertSpriteFrame=function(t){var e=t.rect,n=t.texture,r=this._innerTextureInfos[n.getId()],a=e.x,o=e.y;if(r)a+=r.x,o+=r.y;else{var s=n.width,c=n.height;if(this._x+s+2>this._width&&(this._x=2,this._y=this._nexty),this._y+c+2>this._nexty&&(this._nexty=this._y+c+2),this._nexty>this._height)return null;i.internal.dynamicAtlasManager.textureBleeding&&((s<=8||c<=8)&&(this._texture.drawTextureAt(n.image,this._x-1,this._y-1),this._texture.drawTextureAt(n.image,this._x-1,this._y+1),this._texture.drawTextureAt(n.image,this._x+1,this._y-1),this._texture.drawTextureAt(n.image,this._x+1,this._y+1)),this._texture.drawTextureAt(n.image,this._x-1,this._y),this._texture.drawTextureAt(n.image,this._x+1,this._y),this._texture.drawTextureAt(n.image,this._x,this._y-1),this._texture.drawTextureAt(n.image,this._x,this._y+1)),this._texture.drawTextureAt(n.image,this._x,this._y),this._innerTextureInfos[n.getId()]={x:this._x,y:this._y,texture:n},this._count++,a+=this._x,o+=this._y,this._x+=s+2}var l={x:a,y:o,texture:this._texture};return this._innerSpriteFrames.push(t),l},e.deleteInnerTexture=function(t){t&&this._innerTextureInfos[t.getId()]&&(delete this._innerTextureInfos[t.getId()],this._count--)},e.isEmpty=function(){return this._count<=0},e.reset=function(){this._x=2,this._y=2,this._nexty=2;for(var t=this._innerSpriteFrames,e=0,n=t.length;e<n;e++){var i=t[e];i.isValid&&i._resetDynamicAtlasFrame()}this._innerSpriteFrames.length=0,this._innerTextureInfos={}},e.destroy=function(){this.reset(),this._texture.destroy()},t}(),$V=function(t){function e(){return t.apply(this,arguments)||this}F(e,t);var n=e.prototype;return n.initWithSize=function(t,e,n){void 0===n&&(n=em.RGBA8888),this.reset({width:t,height:e,format:n})},n.drawTextureAt=function(t,e,n){var i=this.getGFXTexture();if(t&&i){var r=this._getGFXDevice();if(r){var a=new ma;a.texOffset.x=e,a.texOffset.y=n,a.texExtent.width=t.width,a.texExtent.height=t.height,r.copyTexImagesToTexture([t.data],i,[a])}else console.warn("Unable to get device")}},e}(ng),tj=function(){function t(){this._atlases=[],this._atlasIndex=-1,this._maxAtlasCount=5,this._textureSize=2048,this._maxFrameSize=512,this._textureBleeding=!0,this._enabled=!1}var e=t.prototype;return e.newAtlas=function(){var t=this._atlases[++this._atlasIndex];return t||(t=new JV(this._textureSize,this._textureSize),this._atlases.push(t)),t},e.beforeSceneLoad=function(){this.reset()},e.insertSpriteFrame=function(t){if(!this._enabled||this._atlasIndex===this._maxAtlasCount||!t||t._original)return null;if(!t.packable)return null;var e=t.texture.getSamplerInfo();if(e.minFilter!==im.LINEAR||e.magFilter!==im.LINEAR||e.mipFilter!==im.NONE)return null;var n=this._atlases[this._atlasIndex];n||(n=this.newAtlas());var i=n.insertSpriteFrame(t);return i||this._atlasIndex===this._maxAtlasCount?i:(n=this.newAtlas()).insertSpriteFrame(t)},e.reset=function(){for(var t=0,e=this._atlases.length;t<e;t++)this._atlases[t].destroy();this._atlases.length=0,this._atlasIndex=-1},e.deleteAtlasSpriteFrame=function(t){if(t._original){for(var e,n=this._atlases.length-1;n>=0;n--)e=this._atlases[n],Gt.array.fastRemove(e._innerSpriteFrames,t);var i=t._original._texture;this.deleteAtlasTexture(i)}},e.deleteAtlasTexture=function(t){if(t)for(var e=this._atlases.length-1;e>=0;e--)this._atlases[e].deleteInnerTexture(t),this._atlases[e].isEmpty()&&(this._atlases[e].destroy(),this._atlases.splice(e,1),this._atlasIndex--)},e.packToDynamicAtlas=function(t,e){if(e&&!e._original&&e.packable&&e.texture&&e.texture.width>0&&e.texture.height>0){var n=this.insertSpriteFrame(e);n&&e._setDynamicAtlasFrame(n)}},L(t,[{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled!==t&&(t?(this.reset(),i.director.on(i.Director.EVENT_BEFORE_SCENE_LAUNCH,this.beforeSceneLoad,this)):(this.reset(),i.director.off(i.Director.EVENT_BEFORE_SCENE_LAUNCH,this.beforeSceneLoad,this)),this._enabled=t)}},{key:"maxAtlasCount",get:function(){return this._maxAtlasCount},set:function(t){this._maxAtlasCount=t}},{key:"atlasCount",get:function(){return this._atlases.length}},{key:"textureBleeding",get:function(){return this._textureBleeding},set:function(t){this._textureBleeding=t}},{key:"textureSize",get:function(){return this._textureSize},set:function(t){this._textureSize=t}},{key:"maxFrameSize",get:function(){return this._maxFrameSize},set:function(t){this._maxFrameSize=t}}]),t}();tj.instance=void 0;var ej,nj,ij,rj=t("dynamicAtlasManager",tj.instance=new tj);i.internal.dynamicAtlasManager=rj;var aj,oj,sj,cj,lj=[{u:0,v:0},{u:0,v:0},{u:0,v:0},{u:0,v:0}],uj=t("SpriteFrame",nl("cc.SpriteFrame")((ij=nj=function(t){function e(){var e;return(e=t.call(this)||this).vertices=null,e.uv=[],e.unbiasUV=[],e.uvSliced=[],e._rect=new Vi,e._offset=new Ni,e._originalSize=new Gi,e._rotated=!1,e._capInsets=[0,0,0,0],e._atlasUuid="",e._texture=void 0,e._isFlipUVY=!1,e._isFlipUVX=!1,e._original=null,e._packable=!0,e}F(e,t),e.createWithImage=function(t){var n=t instanceof Dm?t:new Dm(t),i=new ng;i.image=n;var r=new e;return r.texture=i,r};var n=e.prototype;return n.textureLoaded=function(){return!!this.texture},n.isRotated=function(){return this._rotated},n.setRotated=function(t){this.rotated=t},n.getRect=function(t){return t?(t.set(this._rect),t):this._rect.clone()},n.setRect=function(t){this.rect=t},n.getOriginalSize=function(t){return t?(t.set(this._originalSize),t):this._originalSize.clone()},n.setOriginalSize=function(t){this.originalSize=t},n.getOffset=function(t){return t?(t.set(this._offset),t):this._offset.clone()},n.setOffset=function(t){this.offset=t},n.getGFXTexture=function(){return this._texture.getGFXTexture()},n.getGFXSampler=function(){return this._texture.getGFXSampler()},n.getHash=function(){return this._texture.getHash()},n.getSamplerInfo=function(){return this._texture.getSamplerInfo()},n.reset=function(t,e){void 0===e&&(e=!1);var n=!1;e&&(this._originalSize.set(0,0),this._rect.set(0,0,0,0),this._offset.set(0,0),this._capInsets=[0,0,0,0],this._rotated=!1,n=!0),t&&(t.texture&&(this._rect.x=this._rect.y=0,this._rect.width=t.texture.width,this._rect.height=t.texture.height,this._refreshTexture(t.texture),this.checkRect(this._texture)),t.originalSize&&this._originalSize.set(t.originalSize),t.rect&&this._rect.set(t.rect),t.offset&&this._offset.set(t.offset),void 0!==t.borderTop&&(this._capInsets[1]=t.borderTop),void 0!==t.borderBottom&&(this._capInsets[3]=t.borderBottom),void 0!==t.borderLeft&&(this._capInsets[0]=t.borderLeft),void 0!==t.borderRight&&(this._capInsets[2]=t.borderRight),void 0!==t.isRotate&&(this._rotated=!!t.isRotate),void 0!==t.isFlipUv&&(this._isFlipUVY=!!t.isFlipUv),n=!0),n&&this.texture&&this._calculateUV()},n.checkRect=function(t){var e=this._rect,n=e.x,i=e.y;return this._rotated?(n+=e.height,i+=e.width):(n+=e.width,i+=e.height),n>t.width?(b(3300,this.name+"/"+t.name,n,t.width),!1):!(i>t.height&&(b(3301,this.name+"/"+t.name,i,t.height),1))},n.destroy=function(){return this._packable&&rj&&rj.deleteAtlasSpriteFrame(this),t.prototype.destroy.call(this)},n._calculateSlicedUV=function(){var t=this._rect,n=this.texture,i=n.width,r=n.height,a=this._capInsets[0],o=this._capInsets[2],s=t.width-a-o,c=this._capInsets[1],l=this._capInsets[3],u=t.height-c-l,h=this.uvSliced;if(h.length=0,this._rotated){lj[0].u=t.x/i,lj[1].u=(t.x+l)/i,lj[2].u=(t.x+l+u)/i,lj[3].u=(t.x+t.height)/i,lj[3].v=t.y/r,lj[2].v=(t.y+a)/r,lj[1].v=(t.y+a+s)/r,lj[0].v=(t.y+t.width)/r;for(var f=0;f<4;++f)for(var _=lj[f],p=0;p<4;++p){var d=lj[3-p];h.push({u:_.u,v:d.v})}}else{lj[0].u=t.x/i,lj[1].u=(t.x+a)/i,lj[2].u=(t.x+a+s)/i,lj[3].u=(t.x+t.width)/i,lj[3].v=t.y/r,lj[2].v=(t.y+c)/r,lj[1].v=(t.y+c+u)/r,lj[0].v=(t.y+t.height)/r;for(var m=0;m<4;++m)for(var g=lj[m],v=0;v<4;++v){var y=lj[v];h.push({u:y.u,v:g.v})}}this.emit(e.EVENT_UV_UPDATED,this)},n._calculateUV=function(){var t=this._rect,e=this.uv,n=this.unbiasUV,i=this.texture,r=i.width,a=i.height;if(this._rotated){var o=0===r?0:t.x/r,s=0===r?1:(t.x+t.height)/r,c=0===a?0:t.y/a,l=0===a?1:(t.y+t.width)/a;this._isFlipUVX&&this._isFlipUVY?(e[0]=s,e[1]=l,e[2]=s,e[3]=c,e[4]=o,e[5]=l,e[6]=o,e[7]=c):this._isFlipUVX?(e[0]=s,e[1]=c,e[2]=s,e[3]=l,e[4]=o,e[5]=c,e[6]=o,e[7]=l):this._isFlipUVY?(e[0]=o,e[1]=l,e[2]=o,e[3]=c,e[4]=s,e[5]=l,e[6]=s,e[7]=c):(e[0]=o,e[1]=c,e[2]=o,e[3]=l,e[4]=s,e[5]=c,e[6]=s,e[7]=l);var u=0===r?0:t.x/r,h=0===r?1:(t.x+t.height)/r,f=0===a?0:t.y/a,_=0===a?1:(t.y+t.width)/a;this._isFlipUVX&&this._isFlipUVY?(n[0]=h,n[1]=_,n[2]=h,n[3]=f,n[4]=u,n[5]=_,n[6]=u,n[7]=f):this._isFlipUVX?(n[0]=h,n[1]=f,n[2]=h,n[3]=_,n[4]=u,n[5]=f,n[6]=u,n[7]=_):this._isFlipUVY?(n[0]=u,n[1]=_,n[2]=u,n[3]=f,n[4]=h,n[5]=_,n[6]=h,n[7]=f):(n[0]=u,n[1]=f,n[2]=u,n[3]=_,n[4]=h,n[5]=f,n[6]=h,n[7]=_)}else{var p=0===r?0:t.x/r,d=0===r?1:(t.x+t.width)/r,m=0===a?1:(t.y+t.height)/a,g=0===a?0:t.y/a;this._isFlipUVX&&this._isFlipUVY?(e[0]=d,e[1]=g,e[2]=p,e[3]=g,e[4]=d,e[5]=m,e[6]=p,e[7]=m):this._isFlipUVX?(e[0]=d,e[1]=m,e[2]=p,e[3]=m,e[4]=d,e[5]=g,e[6]=p,e[7]=g):this._isFlipUVY?(e[0]=p,e[1]=g,e[2]=d,e[3]=g,e[4]=p,e[5]=m,e[6]=d,e[7]=m):(e[0]=p,e[1]=m,e[2]=d,e[3]=m,e[4]=p,e[5]=g,e[6]=d,e[7]=g);var v=0===r?0:t.x/r,y=0===r?1:(t.x+t.width)/r,x=0===a?1:(t.y+t.height)/a,S=0===a?0:t.y/a;this._isFlipUVX&&this._isFlipUVY?(n[0]=y,n[1]=S,n[2]=v,n[3]=S,n[4]=y,n[5]=x,n[6]=v,n[7]=x):this._isFlipUVX?(n[0]=y,n[1]=x,n[2]=v,n[3]=x,n[4]=y,n[5]=S,n[6]=v,n[7]=S):this._isFlipUVY?(n[0]=v,n[1]=S,n[2]=y,n[3]=S,n[4]=v,n[5]=x,n[6]=y,n[7]=x):(n[0]=v,n[1]=x,n[2]=y,n[3]=x,n[4]=v,n[5]=S,n[6]=y,n[7]=S)}var T=this.vertices;if(T){T.nu.length=0,T.nv.length=0;for(var A=0;A<T.u.length;A++)T.nu[A]=T.u[A]/r,T.nv[A]=T.v[A]/a}this._calculateSlicedUV()},n._setDynamicAtlasFrame=function(t){t&&(this._original={_texture:this._texture,_x:this._rect.x,_y:this._rect.y},this._texture=t.texture,this._rect.x=t.x,this._rect.y=t.y,this._calculateUV())},n._resetDynamicAtlasFrame=function(){this._original&&(this._rect.x=this._original._x,this._rect.y=this._original._y,this._texture=this._original._texture,this._original=null,this._calculateUV())},n._checkPackable=function(){var t=rj;if(t){var e=this._texture;if(e instanceof ng&&!e.isCompressed){var n=this.width,i=this.height;!e.image||n>t.maxFrameSize||i>t.maxFrameSize?this._packable=!1:e.image&&e.image instanceof HTMLCanvasElement&&(this._packable=!0)}else this._packable=!1}},n._serialize=function(){return null},n._deserialize=function(t){var e=t,n=e.rect;n&&(this._rect=new Vi(n.x,n.y,n.width,n.height));var i=e.offset;e.offset&&(this._offset=new Ni(i.x,i.y));var r=e.originalSize;e.originalSize&&(this._originalSize=new Gi(r.width,r.height)),this._rotated=!!e.rotated,this._name=e.name,this._packable=!!e.packable;var a=e.capInsets;a&&(this._capInsets[0]=a[0],this._capInsets[1]=a[1],this._capInsets[2]=a[2],this._capInsets[3]=a[3]),this.vertices=e.vertices,this.vertices&&(this.vertices.nu=[],this.vertices.nv=[])},n.clone=function(){var t,n,i,r,a,o,s,c,l=new e,u=this.vertices;return l.vertices=u?{x:u.x,y:u.y,triangles:u.triangles,nu:null===(t=u.nu)||void 0===t?void 0:t.slice(0),u:null===(n=u.u)||void 0===n?void 0:n.slice(0),nv:null===(i=u.nv)||void 0===i?void 0:i.slice(0),v:null===(r=u.v)||void 0===r?void 0:r.slice(0)}:null,(a=l.uv).splice.apply(a,[0,l.uv.length].concat(this.uv)),(o=l.unbiasUV).splice.apply(o,[0,l.unbiasUV.length].concat(this.unbiasUV)),(s=l.uvSliced).splice.apply(s,[0,l.uvSliced.length].concat(this.uvSliced)),l._rect.set(this._rect),l._offset.set(this._offset),l._originalSize.set(this._originalSize),l._rotated=this._rotated,(c=l._capInsets).splice.apply(c,[0,l._capInsets.length].concat(this._capInsets)),l._atlasUuid=this._atlasUuid,l._texture=this._texture,l._isFlipUVX=this._isFlipUVX,l._isFlipUVY=this._isFlipUVY,l},n._refreshTexture=function(t){this._texture=t;var e=this._texture,n={},i=!1;0!==this._rect.width&&0!==this._rect.height&&this.checkRect(e)||(n.rect=new Vi(0,0,e.width,e.height),i=!0),(0===this._originalSize.width||0===this._originalSize.height||i)&&(n.originalSize=new Gi(e.width,e.height),i=!0),i&&(this.reset(n),this.onLoaded()),this._checkPackable()},n.initDefault=function(e){t.prototype.initDefault.call(this,e);var n=new ng;n.initDefault(),this._refreshTexture(n),this._calculateUV()},n.validate=function(){return this._texture&&this._rect&&0!==this._rect.width&&0!==this._rect.height},L(e,[{key:"insetTop",get:function(){return this._capInsets[1]},set:function(t){this._capInsets[1]!==t&&(this._capInsets[1]=t,this._texture&&this._calculateSlicedUV())}},{key:"insetBottom",get:function(){return this._capInsets[3]},set:function(t){this._capInsets[3]!==t&&(this._capInsets[3]=t,this._texture&&this._calculateSlicedUV())}},{key:"insetLeft",get:function(){return this._capInsets[0]},set:function(t){this._capInsets[0]!==t&&(this._capInsets[0]=t,this._texture&&this._calculateSlicedUV())}},{key:"insetRight",get:function(){return this._capInsets[2]},set:function(t){this._capInsets[2]!==t&&(this._capInsets[2]=t,this._texture&&this._calculateSlicedUV())}},{key:"rect",get:function(){return this._rect},set:function(t){this._rect.equals(t)||(this._rect.set(t),this._texture&&this._calculateUV())}},{key:"originalSize",get:function(){return this._originalSize},set:function(t){this._originalSize.equals(t)||(this._originalSize.set(t),this._texture&&this._calculateUV())}},{key:"offset",get:function(){return this._offset},set:function(t){this._offset.set(t)}},{key:"rotated",get:function(){return this._rotated},set:function(t){this._rotated!==t&&(this._rotated=t,this._texture&&this._calculateUV())}},{key:"texture",get:function(){return this._texture},set:function(t){t?this.reset({texture:t},!0):console.warn("Error Texture in "+this.name)}},{key:"atlasUuid",get:function(){return this._atlasUuid},set:function(t){this._atlasUuid=t}},{key:"width",get:function(){return this._texture.width}},{key:"height",get:function(){return this._texture.height}},{key:"_textureSource",set:function(t){window.Build?this._texture=t:t&&(this._refreshTexture(t),this._calculateUV())}},{key:"flipUVX",get:function(){return this._isFlipUVX},set:function(t){this._isFlipUVX=t,this._calculateUV()}},{key:"flipUVY",get:function(){return this._isFlipUVY},set:function(t){this._isFlipUVY=t,this._calculateUV()}},{key:"packable",get:function(){return this._packable},set:function(t){this._packable=t}},{key:"original",get:function(){return this._original}}]),e}(Ou),nj.EVENT_UV_UPDATED="uv_updated",ej=ij))||ej);i.SpriteFrame=uj;var hj,fj=t("SpriteAtlas",nl("cc.SpriteAtlas")((cj=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return X(e=t.call.apply(t,[this].concat(i))||this,"spriteFrames",sj,V(e)),e}F(e,t);var n=e.prototype;return n.getTexture=function(){var t=Object.keys(this.spriteFrames);if(t.length>0){var e=this.spriteFrames[t[0]];return e&&e.texture}return null},n.getSpriteFrame=function(t){var e=this.spriteFrames[t];return e?(e.name||(e.name=t),e):null},n.getSpriteFrames=function(){for(var t=[],e=this.spriteFrames,n=0,i=Object.keys(e);n<i.length;n++){var r=i[n];t.push(e[r])}return t},n._serialize=function(){},n._deserialize=function(t,e){var n=t;this._name=n.name;var i=n.spriteFrames;this.spriteFrames=ft();for(var r=0;r<i.length;r+=2)e.result.push(this.spriteFrames,i[r],i[r+1],zt(uj))},e}(Ou),sj=q((oj=cj).prototype,"spriteFrames",[cl,yl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ft()}}),aj=oj))||aj);i.SpriteAtlas=fj;var _j,pj,dj,mj,gj=t("Font",nl("cc.Font")(hj=function(t){function e(){return t.apply(this,arguments)||this}return F(e,t),e}(Ou))||hj);i.Font=gj;var vj,yj,xj,Sj,Tj,Aj,Ej,Cj,bj,wj=t("TTFFont",nl("cc.TTFFont")((mj=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return X(e=t.call.apply(t,[this].concat(i))||this,"_fontFamily",dj,V(e)),e}return F(e,t),e.prototype.initDefault=function(e){this._fontFamily="Arial",t.prototype.initDefault.call(this,e)},L(e,[{key:"_nativeAsset",get:function(){return this._fontFamily},set:function(t){this._fontFamily=t||"Arial"}},{key:"_nativeDep",get:function(){return{uuid:this._uuid,__nativeName__:this._native,ext:vn(this._native),__isNative__:!0}}}]),e}(gj),dj=q((pj=mj).prototype,"_fontFamily",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q(pj.prototype,"_nativeAsset",[Xl,Ll],Object.getOwnPropertyDescriptor(pj.prototype,"_nativeAsset"),pj.prototype),q(pj.prototype,"_nativeDep",[Xl],Object.getOwnPropertyDescriptor(pj.prototype,"_nativeDep"),pj.prototype),_j=pj))||_j);i.TTFFont=wj;var Pj,Ij=function(){this.u=0,this.v=0,this.w=0,this.h=0,this.offsetX=0,this.offsetY=0,this.textureID=0,this.valid=!1,this.xAdvance=0},Rj=function(){function t(t){this.letterDefinitions={},this.texture=t}var e=t.prototype;return e.addLetterDefinitions=function(t,e){this.letterDefinitions[t]=e},e.cloneLetterDefinition=function(){for(var t={},e=0,n=Object.keys(this.letterDefinitions);e<n.length;e++){var i=n[e],r=new Ij;At(r,this.letterDefinitions[i]),t[i]=r}return t},e.getTexture=function(){return this.texture},e.getLetter=function(t){return this.letterDefinitions[t]},e.getLetterDefinitionForChar=function(t){var e=t.charCodeAt(0);return this.letterDefinitions.hasOwnProperty(e)?this.letterDefinitions[e]:null},e.clear=function(){this.letterDefinitions={}},t}(),Dj=t("BitmapFont",(vj=nl("cc.BitmapFont"),yj=Bl(uj),vj((bj=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return X(e=t.call.apply(t,[this].concat(i))||this,"fntDataStr",Tj,V(e)),X(e,"spriteFrame",Aj,V(e)),X(e,"fontSize",Ej,V(e)),X(e,"fntConfig",Cj,V(e)),e}return F(e,t),e.prototype.onLoaded=function(){var t=this.spriteFrame;!this.fontDefDictionary&&t&&(this.fontDefDictionary=new Rj(t.texture));var e=this.fntConfig;if(e){var n=e.fontDefDictionary;for(var i in n){var r=new Ij,a=n[i].rect;r.offsetX=n[i].xOffset,r.offsetY=n[i].yOffset,r.w=a.width,r.h=a.height,r.u=a.x,r.v=a.y,r.textureID=0,r.valid=!0,r.xAdvance=n[i].xAdvance,this.fontDefDictionary.addLetterDefinitions(i,r)}}else p("The fnt config is not exists!")},e}(gj),Tj=q((Sj=bj).prototype,"fntDataStr",[cl,yl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Aj=q(Sj.prototype,"spriteFrame",[yj],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ej=q(Sj.prototype,"fontSize",[cl,yl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),Cj=q(Sj.prototype,"fntConfig",[cl,yl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),xj=Sj))||xj));i.BitmapFont=Dj;var Oj=t("LabelAtlas",nl("cc.LabelAtlas")(Pj=function(t){function e(){return t.apply(this,arguments)||this}return F(e,t),e}(Dj))||Pj);i.LabelAtlas=Oj;var Mj=t("BASELINE_RATIO",.26),Nj=t("MIDDLE_RATIO",(Mj+1)/2-Mj);var Lj=new Ut(2);Lj.get=function(){return this._get()||{key:"",value:0,prev:null,next:null}};var Bj,Fj=new(function(){function t(t){this.count=0,this.limit=0,this.datas={},this.limit=t}var e=t.prototype;return e.moveToHead=function(t){t.next=this.head,t.prev=null,this.head&&(this.head.prev=t),this.head=t,this.tail||(this.tail=t),this.count++,this.datas[t.key]=t},e.put=function(t,e){var n=Lj.get();if(n.key=t,n.value=e,this.count>=this.limit){var i=this.tail;delete this.datas[i.key],this.count--,this.tail=i.prev,this.tail.next=null,i.prev=null,i.next=null,Lj.put(i)}this.moveToHead(n)},e.remove=function(t){t.prev?t.prev.next=t.next:this.head=t.next,t.next?t.next.prev=t.prev:this.tail=t.prev,delete this.datas[t.key],this.count--},e.get=function(t){var e=this.datas[t];return e?(this.remove(e),this.moveToHead(e),e.value):null},e.clear=function(){this.count=0,this.datas={},this.head=null,this.tail=null},e.has=function(t){return!!this.datas[t]},e.delete=function(t){var e=this.datas[t];this.remove(e)},t}())(100),zj=/([a-zA-Z0-9ÄÖÜäöüßéèçàùêâîôûа-яА-ЯЁё]+|\S)/,Uj=/^[!,.:;'}\]%\?>、‘“》？。，！]/,kj=/([a-zA-Z0-9ÄÖÜäöüßéèçàùêâîôûаíìÍÌïÁÀáàÉÈÒÓòóŐőÙÚŰúűñÑæÆœŒÃÂãÔõěščřžýáíéóúůťďňĚŠČŘŽÁÍÉÓÚŤżźśóńłęćąŻŹŚÓŃŁĘĆĄ-яА-ЯЁё]+|\S)$/,Gj=/[a-zA-Z0-9ÄÖÜäöüßéèçàùêâîôûаíìÍÌïÁÀáàÉÈÒÓòóŐőÙÚŰúűñÑæÆœŒÃÂãÔõěščřžýáíéóúůťďňĚŠČŘŽÁÍÉÓÚŤżźśóńłęćąŻŹŚÓŃŁĘĆĄ-яА-ЯЁё]+$/,Hj=/^[a-zA-Z0-9ÄÖÜäöüßéèçàùêâîôûаíìÍÌïÁÀáàÉÈÒÓòóŐőÙÚŰúűñÑæÆœŒÃÂãÔõěščřžýáíéóúůťďňĚŠČŘŽÁÍÉÓÚŤżźśóńłęćąŻŹŚÓŃŁĘĆĄ-яА-ЯЁё]/;function Vj(t){return/^[\u4E00-\u9FFF\u3400-\u4DFF]+$/.test(t)||/[\u3000-\u303F]|[\u3040-\u309F]|[\u30A0-\u30FF]|[\uFF00-\uFFEF]|[\u4E00-\u9FAF]|[\u2605-\u2606]|[\u2190-\u2195]|\u203B/g.test(t)||/^[\u1100-\u11FF]|[\u3130-\u318F]|[\uA960-\uA97F]|[\uAC00-\uD7AF]|[\uD7B0-\uD7FF]+$/.test(t)}function jj(t){var e=t.charCodeAt(0);return e>=9&&e<=13||32===e||133===e||160===e||5760===e||e>=8192&&e<=8202||8232===e||8233===e||8239===e||8287===e||12288===e}function Wj(t,e,n){var i=(n||t.font)+"🎮"+e,r=Fj.get(i);if(null!==r)return r;var a=t.measureText(e),o=a&&a.width||0;return Fj.put(i,o),o}function Xj(t,e,n){var i=e,r=n,a=t[e];if(a>="\udc00"&&a<="\udfff"&&i--,void 0!==n)if(n-1!==e){var o=t[n-1];o>="\ud800"&&o<="\udbff"&&r--}else a>="\ud800"&&a<="\udbff"&&r++;return t.substring(i,r)}function qj(t,e,n,i){var r=[];if(0===t.length||n<0)return r.push(""),r;for(var a=t;e>n&&a.length>1;){for(var o=a.length*(n/e)|0,s=Xj(a,o),c=e-i(s),l=s,u=0,h=0;c>n&&h++<10;)o*=n/c,c=e-i(s=Xj(a,o|=0));for(h=0;c<=n&&h++<10;){if(s){var f=zj.exec(s);u=f?f[0].length:1,l=s}c=e-i(s=Xj(a,o+=u))}0==(o-=u)?(o=1,l=Xj(a,1)):1===o&&a[0]>="\ud800"&&a[0]<="\udbff"&&(o=2,l=Xj(a,2));var _=Xj(a,0,o),p=void 0;Uj.test(l||s)&&(0==(o-=(p=kj.exec(_))?p[0].length:0)&&(o=1),l=Xj(a,o),_=Xj(a,0,o)),Hj.test(l)&&(p=Gj.exec(_))&&_!==p[0]&&(l=Xj(a,o-=p[0].length),_=Xj(a,0,o)),(0===r.length||(_=_.trim()).length>0)&&r.push(_),e=i(a=l||s)}return(0===r.length||(a=a.trim()).length>0)&&r.push(a),r}var Yj=t("CanvasPool",function(){function t(){this.pool=[]}t.getInstance=function(){return Bj||(Bj=new t),Bj};var e=t.prototype;return e.get=function(){var t=this.pool.pop();if(!t){var e=document.createElement("canvas"),n=e.getContext("2d");t={canvas:e,context:n}}return t},e.put=function(t){this.pool.length>=$t.MAX_LABEL_CANVAS_POOL_SIZE||this.pool.push(t)},t}()),Kj=_i.WHITE.clone(),Qj=function(){this.u=0,this.v=0,this.w=0,this.h=0,this.texture=null,this.offsetX=0,this.offsetY=0,this.valid=!1,this.xAdvance=0},Zj="rgba(255, 255, 255, "+(1/255).toFixed(3)+")",Jj=function(){function t(t,e){this.image=null,this.labelInfo=void 0,this.char=void 0,this.data=null,this.canvas=null,this.context=null,this.width=0,this.height=0,this.offsetY=0,this.hash=void 0,this.char=t,this.labelInfo=e,this.hash=t.charCodeAt(0)+e.hash}var e=t.prototype;return e.updateRenderData=function(){this._updateProperties(),this._updateTexture()},e.destroy=function(){this.image=null},e._updateProperties=function(){if(this.data=Yj.getInstance().get(),this.canvas=this.data.canvas,this.context=this.data.context,this.context){this.context.font=this.labelInfo.fontDesc;var t=Wj(this.context,this.char,this.labelInfo.fontDesc),e=2*this.labelInfo.margin+2;this.width=parseFloat(t.toFixed(2))+e,this.height=(1+Mj)*this.labelInfo.fontSize+e,this.offsetY=-this.labelInfo.fontSize*Mj/2}this.canvas.width!==this.width&&(this.canvas.width=this.width),this.canvas.height!==this.height&&(this.canvas.height=this.height),this.image||(this.image=new Dm),this.image.reset(this.canvas)},e._updateTexture=function(){if(this.context&&this.canvas){var t=this.context,e=this.labelInfo,n=this.canvas.width,i=this.canvas.height;t.textAlign="center",t.textBaseline="alphabetic",t.clearRect(0,0,n,i),t.fillStyle=Zj,t.fillRect(0,0,n,i),t.font=e.fontDesc;var r=e.fontSize,a=n/2,o=i/2+r*Nj+0*r,s=e.color;if(t.lineJoin="round",t.fillStyle="rgba("+s.r+", "+s.g+", "+s.b+", 1)",e.isOutlined){var c=e.out||Kj;t.strokeStyle="rgba("+c.r+", "+c.g+", "+c.b+", "+c.a/255+")",t.lineWidth=2*e.margin,t.strokeText(this.char,a,o)}t.fillText(this.char,a,o)}},t}(),$j=function(t){function e(){return t.apply(this,arguments)||this}F(e,t);var n=e.prototype;return n.initWithSize=function(t,e,n){void 0===n&&(n=em.RGBA8888),this.reset({width:t,height:e,format:n})},n.drawTextureAt=function(t,e,n){var i=this.getGFXTexture();if(t&&i){var r=this._getGFXDevice();if(r){var a=new ma;a.texOffset.x=e,a.texOffset.y=n,a.texExtent.width=t.width,a.texExtent.height=t.height,r.copyTexImagesToTexture([t.data],i,[a])}else console.warn("Unable to get device")}},e}(ng),tW=function(){function t(t,e){this._x=0,this._y=0,this._nextY=0,this._width=0,this._height=0,this._halfBleed=0,this._dirty=!1;var n=new $j;n.initWithSize(t,e),this.fontDefDictionary=new Rj(n),this._halfBleed=1,this._width=t,this._height=e,WM.on(jM.EVENT_BEFORE_SCENE_LAUNCH,this.beforeSceneLoad,this)}var e=t.prototype;return e.insertLetterTexture=function(t){var e=t.image,n=WM.root.device;if(!e||!this.fontDefDictionary||!n)return null;var i=e.width,r=e.height;if(this._x+i+0>this._width&&(this._x=0,this._y=this._nextY),this._y+r>this._nextY&&(this._nextY=this._y+r+0),this._nextY>this._height)return E(12100),null;this.fontDefDictionary.texture.drawTextureAt(e,this._x,this._y),this._dirty=!0;var a=new Qj;return a.u=this._x+this._halfBleed,a.v=this._y+this._halfBleed,a.texture=this.fontDefDictionary.texture,a.valid=!0,a.w=t.width-2,a.h=t.height-2,a.xAdvance=a.w,a.offsetY=t.offsetY,this._x+=i+0,this.fontDefDictionary.addLetterDefinitions(t.hash,a),a},e.update=function(){this._dirty&&(this._dirty=!1)},e.reset=function(){this._x=0,this._y=0,this._nextY=0,this.fontDefDictionary.clear()},e.destroy=function(){this.reset(),this.fontDefDictionary&&(this.fontDefDictionary.texture.destroy(),this.fontDefDictionary.texture=null)},e.getTexture=function(){return this.fontDefDictionary.getTexture()},e.beforeSceneLoad=function(){this.clearAllCache()},e.clearAllCache=function(){this.destroy();var t=new $j;t.initWithSize(this._width,this._height),this.fontDefDictionary.texture=t},e.getLetter=function(t){return this.fontDefDictionary.letterDefinitions[t]},e.getLetterDefinitionForChar=function(t,e){var n=t.charCodeAt(0)+e.hash,i=this.fontDefDictionary.letterDefinitions[n];if(!i){var r=new Jj(t,e);r.updateRenderData(),i=this.insertLetterTexture(r),r.destroy()}return i},L(t,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}}]),t}(),eW={fontAtlas:null,fontSize:0,lineHeight:0,hAlign:0,vAlign:0,hash:"",fontFamily:"",fontDesc:"Arial",color:_i.WHITE.clone(),isOutlined:!1,out:_i.WHITE.clone(),margin:0},nW=[new Ua(oa.ATTR_POSITION,Sr.RGB32F)],iW=[new Ua(oa.ATTR_POSITION,Sr.RGB32F),new Ua(oa.ATTR_COLOR,Sr.RGBA32F)],rW=[new Ua(oa.ATTR_POSITION,Sr.RGB32F),new Ua(oa.ATTR_TEX_COORD,Sr.RG32F),new Ua(oa.ATTR_COLOR,Sr.RGBA32F)],aW=[new Ua(oa.ATTR_POSITION,Sr.RGB32F),new Ua(oa.ATTR_TEX_COORD,Sr.RG32F),new Ua(oa.ATTR_COLOR,Sr.RGBA32F),new Ua(oa.ATTR_COLOR2,Sr.RGBA32F)];function oW(t){for(var e=0,n=0;n<t.length;n++){var i=t[n];e+=lo[i.format].count}return e}function sW(t){for(var e=0,n=0;n<t.length;n++){var i=t[n];e+=lo[i.format].size}return e}i.internal.vfmtPosUvColor=rW,i.internal.vfmtPosUvTwoColor=aW,t("UIVertexFormat",Object.freeze({__proto__:null,vfmt:nW,vfmtPosColor:iW,vfmtPosUvColor:rW,vfmtPosUvTwoColor:aW,getComponentPerVertex:oW,getAttributeStride:sW}));var cW,lW,uW,hW,fW,_W,pW,dW,mW,gW,vW,yW,xW,SW,TW,AW=sW(rW)>>2,EW=new jt((function(){return{x:0,y:0,z:0,u:0,v:0,color:_i.WHITE.clone()}}),128),CW=null,bW=t("BaseRenderData",function(){function t(t){void 0===t&&(t=rW),this.material=null,this.chunk=null,this.dataHash=0,this.isMeshBuffer=!1,this._vc=0,this._ic=0,this._floatStride=0,this._vertexFormat=rW,this._floatStride=t===rW?AW:sW(t)>>2,this._vertexFormat=t}return t.prototype.isValid=function(){return this._ic>0&&this.chunk.vertexAccessor},L(t,[{key:"vertexCount",get:function(){return this._vc}},{key:"indexCount",get:function(){return this._ic}},{key:"stride",get:function(){return this._floatStride<<2}},{key:"floatStride",get:function(){return this._floatStride}},{key:"vertexFormat",get:function(){return this._vertexFormat}}]),t}()),wW=t("RenderData",function(t){function e(e,n){var i;return void 0===e&&(e=rW),(i=t.call(this,e)||this).indices=null,i.vertDirty=!0,i.frame=void 0,i.layer=0,i.blendHash=-1,i.textureHash=0,i.nodeDirty=!0,i.passDirty=!0,i.textureDirty=!0,i.hashDirty=!0,i._data=[],i._pivotX=0,i._pivotY=0,i._width=0,i._height=0,i._accessor=null,n||(n=WM.root.batcher2D.switchBufferAccessor(i._vertexFormat)),i._accessor=n,i}F(e,t),e.add=function(t,n){void 0===t&&(t=rW),CW||(CW=new Wt((function(){return new e}),32));var i=CW.add();return i._floatStride=t===rW?AW:sW(t)>>2,i._vertexFormat=t,n||(n=WM.root.batcher2D.switchBufferAccessor(i._vertexFormat)),i._accessor=n,i},e.remove=function(t){var e=CW.data.indexOf(t);-1!==e&&(t.clear(),t._accessor=null,CW.removeAt(e))};var n=e.prototype;return n.resize=function(t,e){t===this._vc&&e===this._ic&&this.chunk||(this._vc=t,this._ic=e,this.chunk&&(this._accessor.recycleChunk(this.chunk),this.chunk=null),this.chunk=this._accessor.allocateChunk(t,e),this.updateHash())},n.resizeAndCopy=function(t,e){if(t!==this._vc||e!==this._ic||!this.chunk){this._vc=t,this._ic=e;var n=this.chunk;this.chunk=this._accessor.allocateChunk(t,e),n&&(this.chunk.vb.set(n.vb),this._accessor.recycleChunk(n)),this.updateHash()}},n.getMeshBuffer=function(){return this.chunk&&this._accessor?this._accessor.getMeshBuffer(this.chunk.bufferId):null},n.updateNode=function(t){this.layer=t.node.layer,this.nodeDirty=!1,this.hashDirty=!0},n.updatePass=function(t){this.material=t.getRenderMaterial(0),this.blendHash=t.blendHash,this.passDirty=!1,this.hashDirty=!0},n.updateTexture=function(t){this.frame=t,this.textureHash=t.getHash(),this.textureDirty=!1,this.hashDirty=!0},n.updateHash=function(){var t=""+(this.chunk?this.chunk.bufferId:-1)+this.layer+" "+this.blendHash+" "+this.textureHash;this.dataHash=Po(t,666),this.hashDirty=!1},n.updateRenderData=function(t,e){if(this.passDirty&&(this.material=t.getRenderMaterial(0),this.blendHash=t.blendHash,this.passDirty=!1,this.hashDirty=!0),this.nodeDirty){var n=t.node.scene?t._getRenderScene():null;this.layer=t.node.layer,null!==n&&(this.nodeDirty=!1),this.hashDirty=!0}this.textureDirty&&(this.frame=e,this.textureHash=e.getHash(),this.textureDirty=!1,this.hashDirty=!0),this.hashDirty&&this.updateHash()},n.updateSizeNPivot=function(t,e,n,i){t===this._width&&e===this._height&&n===this._pivotX&&i===this._pivotY||(this._width=t,this._height=e,this._pivotX=n,this._pivotY=i,this.vertDirty=!0)},n.clear=function(){this.resize(0,0),this._data.length=0,this._pivotX=0,this._pivotY=0,this._width=0,this._height=0,this.indices=null,this.vertDirty=!0,this.material=null,this.nodeDirty=!0,this.passDirty=!0,this.textureDirty=!0,this.hashDirty=!0,this.layer=0,this.blendHash=-1,this.frame=null,this.textureHash=0,this.dataHash=0},L(e,[{key:"dataLength",get:function(){return this._data.length},set:function(t){var e=this._data;if(e.length!==t){var n=e.length,i=0;for(i=t;i<n;i++)EW.free(e[i]);for(i=n;i<t;i++)e[i]=EW.alloc();e.length=t}}},{key:"data",get:function(){return this._data}}]),e}(bW)),PW=t("MeshRenderData",function(t){function e(e){var n;return void 0===e&&(e=rW),(n=t.call(this,e)||this).isMeshBuffer=!0,n.vData=void 0,n.iData=void 0,n.vertexStart=0,n.vertexRange=0,n.indexStart=0,n.indexRange=0,n.lastFilledIndex=0,n.lastFilledVertex=0,n._byteLength=0,n._vertexBuffers=[],n._indexBuffer=null,n._iaPool=null,n._iaInfo=null,n.vData=new Float32Array(256*n.stride),n.iData=new Uint16Array(1536),n}F(e,t),e.add=function(t){void 0===t&&(t=rW);var e=IW.add();return e._floatStride=t===rW?AW:sW(t)>>2,e._vertexFormat=t,e},e.remove=function(t){var e=IW.data.indexOf(t);-1!==e&&(IW.data[e].clear(),IW.removeAt(e))};var n=e.prototype;return n.request=function(t,e){var n=this._byteLength+t*this.stride;return!!this.reserve(t,e)&&(this._vc+=t,this._ic+=e,this._byteLength=n,this.vertexRange=this._vc,this.indexRange=this._ic,!0)},n.reserve=function(t,e){var n=this._byteLength+t*this.stride,i=this.indexCount+e;if(t+this.vertexCount>65535)return!1;var r=this.vData.byteLength,a=this.iData.length,o=this.vData.length,s=this.iData.length;if(n>r||i>a){for(;r<n||a<i;)r=4*(o*=2),a=s*=2;this._reallocBuffer(o,s)}return!0},n.resize=function(t,e){var n=t*this.stride;t>=0&&e>=0&&n<=this.vData.byteLength&&this.iData.length,this._vc=t,this._ic=e,this._byteLength=n,this.updateRange(0,t,0,e)},n.updateRange=function(t,e,n,i){e>=0&&i>=0&&e<=this._vc&&this._ic,this.vertexStart=t,this.indexStart=n,this.vertexRange=e,this.indexRange=i},n.requestIA=function(t){this._initIAInfo(t);var e=this._iaPool.add();return e.firstIndex=this.indexStart,e.indexCount=this.indexRange,e},n.uploadBuffers=function(){if(0!==this._byteLength&&this._vertexBuffers[0]&&this._indexBuffer){var t=this._ic,e=new Float32Array(this.vData.buffer,0,this._byteLength>>2),n=new Uint16Array(this.iData.buffer,0,t),i=this._vertexBuffers[0];this._byteLength>i.size&&i.resize(this._byteLength),i.update(e);var r=t<<1;r>this._indexBuffer.size&&this._indexBuffer.resize(r),this._indexBuffer.update(n)}},n.freeIAPool=function(){this._iaPool&&this._iaPool.reset()},n.reset=function(){this._vc=0,this._ic=0,this._byteLength=0,this.vertexStart=0,this.vertexRange=0,this.indexStart=0,this.indexRange=0,this.lastFilledIndex=0,this.lastFilledVertex=0,this.material=null,this.freeIAPool()},n.clear=function(){this.reset(),this._iaPool&&this._iaPool.destroy(),this._vertexBuffers[0]&&(this._vertexBuffers[0].destroy(),this._vertexBuffers=[]),this._iaInfo=null,this.vData=new Float32Array(256*this.stride),this.iData=new Uint16Array(1536)},n._initIAInfo=function(t){var e=this;if(!this._iaInfo){var n=this.stride,i=this._vertexBuffers;i.length||i.push(t.createBuffer(new Ta(Er.VERTEX|Er.TRANSFER_DST,wr.DEVICE,n,n)));var r=Uint16Array.BYTES_PER_ELEMENT;this._indexBuffer||(this._indexBuffer=t.createBuffer(new Ta(Er.INDEX|Er.TRANSFER_DST,wr.DEVICE,r,r))),this._iaInfo=new Ga(this._vertexFormat,i,this._indexBuffer),this._iaPool=new Wt((function(){return t.createInputAssembler(e._iaInfo)}),1,(function(t){t.destroy()}))}},n._reallocBuffer=function(t,e){var n=this.vData;this.vData=new Float32Array(t),n&&this.vData.set(n,0);var i=this.iData;this.iData=new Uint16Array(e),i&&this.iData.set(i,0)},L(e,[{key:"formatByte",get:function(){return this.stride},set:function(){}},{key:"floatStride",get:function(){return this._floatStride}},{key:"vDataOffset",get:function(){return this._byteLength>>>2}}]),e}(bW)),IW=new Wt((function(){return new PW}),32),RW=new Ni,DW=new Ni,OW=(new di,new Ri),MW=new Ri,NW=new Ri,LW=new Ri(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),BW=new Vi,FW=function(e){return t({UITransform:e,UITransformComponent:e}),e}((cW=nl("cc.UITransform"),lW=vl(),uW=rl(110),hW=pl(),fW=Il(),_W=Al(),pW=Il(),dW=Al(),cW(mW=lW(mW=uW(mW=hW(mW=al(mW=_l((SW=xW=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._priority=0,X(e,"_contentSize",vW,V(e)),X(e,"_anchorPoint",yW,V(e)),e}F(e,t);var n=e.prototype;return n.__preload=function(){this.node._uiProps.uiTransformComp=this},n.onLoad=function(){this.node.parent&&e.insertChangeMap(this.node.parent)},n.onEnable=function(){this.node.on(WA.PARENT_CHANGED,this._parentChanged,this),this._markRenderDataDirty()},n.onDisable=function(){this.node.off(WA.PARENT_CHANGED,this._parentChanged,this)},n.onDestroy=function(){this.node._uiProps.uiTransformComp=null},n.setContentSize=function(t,e){var n=this._contentSize;if(void 0===e){if((t=t).width===n.width&&t.height===n.height)return;n.width=t.width,n.height=t.height}else{if(t===n.width&&e===n.height)return;n.width=t,n.height=e}this.node.emit(WA.SIZE_CHANGED),this._markRenderDataDirty()},n.setAnchorPoint=function(t,e){var n=this._anchorPoint;if(void 0===e){if((t=t).x===n.x&&t.y===n.y)return;n.x=t.x,n.y=t.y}else{if(t===n.x&&e===n.y)return;n.x=t,n.y=e}this.node.emit(WA.ANCHOR_CHANGED,this._anchorPoint),this._markRenderDataDirty()},n.isHit=function(t){for(var e,n=this._contentSize.width,i=this._contentSize.height,r=RW,a=DW,o=null===(e=this.node)||void 0===e?void 0:e.eventProcessor,s=this._getRenderScene().cameras,c=0;c<s.length;c++){var l=s[c];if(l.visibility&this.node.layer){l.node.getWorldRT(OW);var u=OW.m12,h=OW.m13,f=YM.center;if(OW.m12=f.x-(OW.m00*u+OW.m04*h),OW.m13=f.y-(OW.m01*u+OW.m05*h),Ri.invert(OW,OW),Ni.transformMat4(r,t,OW),this.node.getWorldMatrix(NW),Ri.invert(OW,NW),!Ri.strictEquals(OW,LW)){Ni.transformMat4(a,r,OW),a.x+=this._anchorPoint.x*n,a.y+=this._anchorPoint.y*i;var _=!1;if(a.x>=0&&a.y>=0&&a.x<=n&&a.y<=i&&(_=!0,o&&o.maskList))for(var p=o.maskList,d=this.node,m=p?p.length:0,g=0,v=0;d&&v<m;++g,d=d.parent){var y=p[v];if(g===y.index){if(d!==y.comp.node){p.length=v;break}var x=y.comp;if(x&&x._enabled&&!x.isHit(r)){_=!1;break}v++}else if(g>y.index){p.length=v;break}}if(_)return!0}}}return!1},n.convertToNodeSpaceAR=function(t,e){return this.node.getWorldMatrix(NW),Ri.invert(OW,NW),e||(e=new di),di.transformMat4(e,t,OW)},n.convertToWorldSpaceAR=function(t,e){return this.node.getWorldMatrix(NW),e||(e=new di),di.transformMat4(e,t,NW)},n.getBoundingBox=function(){Ri.fromRTS(MW,this.node.getRotation(),this.node.getPosition(),this.node.getScale());var t=this._contentSize.width,e=this._contentSize.height,n=new Vi(-this._anchorPoint.x*t,-this._anchorPoint.y*e,t,e);return n.transformMat4(MW),n},n.getBoundingBoxToWorld=function(){return this.node.parent?(this.node.parent.getWorldMatrix(NW),this.getBoundingBoxTo(NW)):this.getBoundingBox()},n.getBoundingBoxTo=function(t){Ri.fromRTS(MW,this.node.getRotation(),this.node.getPosition(),this.node.getScale());var n=this._contentSize.width,i=this._contentSize.height,r=new Vi(-this._anchorPoint.x*n,-this._anchorPoint.y*i,n,i);if(Ri.multiply(NW,t,MW),r.transformMat4(NW),!this.node.children)return r;for(var a,o=W(this.node.children);!(a=o()).done;){var s=a.value;if(s&&s.active){var c=s.getComponent(e);if(c){var l=c.getBoundingBoxTo(t);l&&Vi.union(r,r,l)}}}return r},n.getComputeAABB=function(t){var e=this._contentSize.width,n=this._contentSize.height;BW.set(-this._anchorPoint.x*e,-this._anchorPoint.y*n,e,n),BW.transformMat4(this.node.worldMatrix);var i=BW.x+.5*BW.width,r=BW.y+.5*BW.height,a=this.node.worldPosition.z,o=BW.width/2,s=BW.height/2;return null!=t?(Mc.set(t,i,r,a,o,s,.001),t):new Mc(i,r,a,o,s,.001)},n._parentChanged=function(){this.node.getComponent("cc.RenderRoot2D")||this.node.parent&&e.insertChangeMap(this.node.parent)},n._markRenderDataDirty=function(){var t=this.node._uiProps.uiComp;t&&(t.markForUpdateRenderData(),t.renderData&&(t.renderData.vertDirty=!0))},e.insertChangeMap=function(t){var n=t.uuid;e.priorityChangeNodeMap.has(n)||e.priorityChangeNodeMap.set(n,t)},e._sortChildrenSibling=function(t){var e=t.children;e&&e.sort((function(t,e){var n=t._uiProps.uiTransformComp,i=e._uiProps.uiTransformComp,r=(n?n._priority:0)-(i?i._priority:0);return 0===r?t.getSiblingIndex()-e.getSiblingIndex():r}))},e._sortSiblings=function(){e.priorityChangeNodeMap.forEach((function(t){e._sortChildrenSibling(t),t._updateSiblingIndex(),t.emit("childrenSiblingOrderChanged")})),e.priorityChangeNodeMap.clear()},e._cleanChangeMap=function(){e.priorityChangeNodeMap.clear()},L(e,[{key:"contentSize",get:function(){return this._contentSize},set:function(t){this._contentSize.equals(t)||(this._contentSize.set(t),this.node.emit(WA.SIZE_CHANGED),this._markRenderDataDirty())}},{key:"width",get:function(){return this._contentSize.width},set:function(t){this._contentSize.width!==t&&(this._contentSize.width=t,this.node.emit(WA.SIZE_CHANGED),this._markRenderDataDirty())}},{key:"height",get:function(){return this._contentSize.height},set:function(t){this.contentSize.height!==t&&(this._contentSize.height=t,this.node.emit(WA.SIZE_CHANGED),this._markRenderDataDirty())}},{key:"anchorPoint",get:function(){return this._anchorPoint},set:function(t){this._anchorPoint.equals(t)||(this._anchorPoint.set(t),this.node.emit(WA.ANCHOR_CHANGED,this._anchorPoint),this._markRenderDataDirty())}},{key:"anchorX",get:function(){return this._anchorPoint.x},set:function(t){this._anchorPoint.x!==t&&(this._anchorPoint.x=t,this.node.emit(WA.ANCHOR_CHANGED,this._anchorPoint),this._markRenderDataDirty())}},{key:"anchorY",get:function(){return this._anchorPoint.y},set:function(t){this._anchorPoint.y!==t&&(this._anchorPoint.y=t,this.node.emit(WA.ANCHOR_CHANGED,this._anchorPoint),this._markRenderDataDirty())}},{key:"priority",get:function(){return this._priority},set:function(t){this._priority!==t&&(this.node.getComponent("cc.RenderRoot2D")?E(6706):(this._priority=t,this.node.parent&&e.insertChangeMap(this.node.parent)))}},{key:"visibility",get:function(){var t=WM.root.batcher2D.getFirstRenderCamera(this.node);return t?t.visibility:0}},{key:"cameraPriority",get:function(){var t=WM.root.batcher2D.getFirstRenderCamera(this.node);return t?t.priority:0}}]),e}($u),xW.EventType=WA,xW.priorityChangeNodeMap=new Map,q((gW=SW).prototype,"contentSize",[fW,_W],Object.getOwnPropertyDescriptor(gW.prototype,"contentSize"),gW.prototype),q(gW.prototype,"anchorPoint",[pW,dW],Object.getOwnPropertyDescriptor(gW.prototype,"anchorPoint"),gW.prototype),vW=q(gW.prototype,"_contentSize",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Gi(100,100)}}),yW=q(gW.prototype,"_anchorPoint",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ni(.5,.5)}}),mW=gW))||mW)||mW)||mW)||mW)||mW)||mW));WM.on(jM.EVENT_AFTER_UPDATE,FW._sortSiblings),WM.on(jM.EVENT_BEFORE_SCENE_LAUNCH,FW._cleanChangeMap),function(t){t[t.DISABLED=0]="DISABLED",t[t.CLEAR=1]="CLEAR",t[t.ENTER_LEVEL=2]="ENTER_LEVEL",t[t.ENABLED=3]="ENABLED",t[t.EXIT_LEVEL=4]="EXIT_LEVEL",t[t.CLEAR_INVERTED=5]="CLEAR_INVERTED",t[t.ENTER_LEVEL_INVERTED=6]="ENTER_LEVEL_INVERTED"}(TW||(TW={}));var zW,UW,kW,GW,HW,VW,jW,WW,XW,qW,YW,KW,QW,ZW,JW,$W,tX,eX,nX,iX,rX=t("StencilManager",function(){function t(){this.stage=TW.DISABLED,this._maskStack=[],this._stencilPattern={stencilTest:!0,func:Lr.ALWAYS,stencilMask:65535,writeMask:65535,failOp:Br.KEEP,zFailOp:Br.KEEP,passOp:Br.KEEP,ref:1},this.stencilStateMap=new Map,this.stencilStateMapWithDepth=new Map}var e=t.prototype;return e.pushMask=function(t){this._maskStack.push(t)},e.clear=function(t){t.stencilStage=t.inverted?TW.CLEAR_INVERTED:TW.CLEAR},e.enterLevel=function(t){t.graphics.stencilStage=t.inverted?TW.ENTER_LEVEL_INVERTED:TW.ENTER_LEVEL},e.enableMask=function(){this.stage=TW.ENABLED},e.exitMask=function(){0!==this._maskStack.length&&(this._maskStack.pop(),0===this._maskStack.length?this.stage=TW.DISABLED:this.stage=TW.ENABLED)},e.getWriteMask=function(){return 1<<this._maskStack.length-1},e.getExitWriteMask=function(){return 1<<this._maskStack.length},e.getStencilRef=function(){for(var t=0,e=0;e<this._maskStack.length;++e)t+=1<<e;return t},e.reset=function(){this._maskStack.length=0,this.stage=TW.DISABLED},e.destroy=function(){this.stencilStateMap.forEach((function(t){t.destroy()})),this.stencilStateMap.clear()},e.getStencilStage=function(t,e){var n=0,i=!1,r=!1,a=Lr.LESS,o=this.stencilStateMap;if(e&&e.passes[0]){var s=e.passes[0].depthStencilState,c=0,l=0;s.depthTest&&(c=1),s.depthWrite&&(l=1),n=c|l<<1|s.depthFunc<<2|t<<6|this._maskStack.length<<9,i=s.depthTest,r=s.depthWrite,a=s.depthFunc,o=this.stencilStateMapWithDepth}else n=t<<16|this._maskStack.length;if(o&&o.has(n))return o.get(n);this.setStateFromStage(t);var u=new No(i,r,a,this._stencilPattern.stencilTest,this._stencilPattern.func,this._stencilPattern.stencilMask,this._stencilPattern.writeMask,this._stencilPattern.failOp,this._stencilPattern.zFailOp,this._stencilPattern.passOp,this._stencilPattern.ref,this._stencilPattern.stencilTest,this._stencilPattern.func,this._stencilPattern.stencilMask,this._stencilPattern.writeMask,this._stencilPattern.failOp,this._stencilPattern.zFailOp,this._stencilPattern.passOp,this._stencilPattern.ref);return o.set(n,u),u},e.getStencilHash=function(t){return t<<8|this._maskStack.length},e.setStateFromStage=function(t){var e=this._stencilPattern;t===TW.DISABLED?(e.stencilTest=!1,e.func=Lr.ALWAYS,e.failOp=Br.KEEP,e.stencilMask=e.writeMask=65535,e.ref=1):(e.stencilTest=!0,t===TW.ENABLED?(e.func=Lr.EQUAL,e.failOp=Br.KEEP,e.stencilMask=e.ref=this.getStencilRef(),e.writeMask=this.getWriteMask()):t===TW.CLEAR?(e.func=Lr.NEVER,e.failOp=Br.ZERO,e.writeMask=e.stencilMask=e.ref=this.getWriteMask()):t===TW.CLEAR_INVERTED||t===TW.ENTER_LEVEL?(e.func=Lr.NEVER,e.failOp=Br.REPLACE,e.writeMask=e.stencilMask=e.ref=this.getWriteMask()):t===TW.ENTER_LEVEL_INVERTED&&(e.func=Lr.NEVER,e.failOp=Br.ZERO,e.writeMask=e.stencilMask=e.ref=this.getWriteMask()))},L(t,[{key:"pattern",get:function(){return this._stencilPattern}}]),t}());rX.sharedManager=null,rX.sharedManager=new rX,Zt(Fr),function(t){t[t.ADD_COLOR=0]="ADD_COLOR",t[t.ADD_COLOR_AND_TEXTURE=1]="ADD_COLOR_AND_TEXTURE",t[t.GRAYSCALE=2]="GRAYSCALE",t[t.USE_ALPHA_SEPARATED=3]="USE_ALPHA_SEPARATED",t[t.USE_ALPHA_SEPARATED_AND_GRAY=4]="USE_ALPHA_SEPARATED_AND_GRAY"}(iX||(iX=t("InstanceMaterialType",{})));var aX,oX,sX,cX,lX,uX,hX,fX,_X,pX,dX,mX,gX,vX,yX,xX,SX,TX,AX,EX,CX,bX,wX,PX,IX,RX,DX,OX,MX,NX,LX,BX,FX,zX,UX,kX,GX,HX,VX,jX,WX,XX,qX,YX,KX,QX,ZX,JX,$X,tq,eq,nq,iq,rq,aq,oq,sq,cq,lq,uq,hq,fq,_q,pq,dq,mq,gq,vq,yq,xq,Sq=function(e){return t({Renderable2D:e,RenderComponent:e,UIRenderable:e}),e}((zW=nl("cc.Renderable2D"),UW=il(FW),kW=xl(),GW=Bl(bv),HW=Bl(bv),VW=Il(),jW=Al(),WW=Tl(),XW=Il(),qW=Al(),zW(YW=UW(YW=al(YW=_l((nX=eX=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return X(e=t.call.apply(t,[this].concat(i))||this,"_materials",QW,V(e)),X(e,"_customMaterial",ZW,V(e)),e.stencilStage=TW.DISABLED,X(e,"_srcBlendFactor",JW,V(e)),X(e,"_dstBlendFactor",$W,V(e)),X(e,"_color",tX,V(e)),e._assembler=null,e._postAssembler=null,e._renderData=null,e._renderDataFlag=!0,e._renderFlag=!0,e._delegateSrc=null,e._instanceMaterialType=-1,e._blendState=new Bo,e._blendHash=0,e._lastParent=null,e}F(e,t);var n=e.prototype;return n.updateBlendHash=function(){var t=this._blendState.targets[0].blendDst<<4;this._blendHash=t|this._blendState.targets[0].blendSrc},n.__preload=function(){this.node._uiProps.uiComp=this,this._flushAssembler&&this._flushAssembler()},n.onEnable=function(){this.node.on(WA.ANCHOR_CHANGED,this._nodeStateChange,this),this.node.on(WA.SIZE_CHANGED,this._nodeStateChange,this),this.updateMaterial(),this._renderFlag=this._canRender()},n.onRestore=function(){this.updateMaterial(),this.markForUpdateRenderData()},n.onDisable=function(){this.node.off(WA.ANCHOR_CHANGED,this._nodeStateChange,this),this.node.off(WA.SIZE_CHANGED,this._nodeStateChange,this),this._renderFlag=!1},n.onDestroy=function(){if(this.node._uiProps.uiComp===this&&(this.node._uiProps.uiComp=null),this.destroyRenderData(),this._materialInstances)for(var t=0;t<this._materialInstances.length;t++){var e=this._materialInstances[t];e&&e.destroy()}this._blendState&&this._blendState.destroy()},n.markForUpdateRenderData=function(t){if(void 0===t&&(t=!0),this._renderFlag=this._canRender(),t){var e=this._renderData;e&&(e.vertDirty=!0),this._renderDataFlag=t}else this._renderDataFlag=t},n.requestRenderData=function(){var t=wW.add();return this._renderData=t,t},n.destroyRenderData=function(){this._renderData&&(wW.remove(this._renderData),this._renderData=null)},n.updateAssembler=function(t){this._renderDataFlag&&(this._assembler.updateRenderData(this,t),this._renderDataFlag=!1),this._renderFlag&&this._render(t)},n.postUpdateAssembler=function(t){this._postAssembler&&this._renderFlag&&this._postRender(t)},n._render=function(){},n._postRender=function(){},n._canRender=function(){return this.isValid&&null!==this.getMaterial(0)&&this.enabled&&(this._delegateSrc?this._delegateSrc.activeInHierarchy:this.enabledInHierarchy)&&this._color.a>0},n._postCanRender=function(){},n.updateMaterial=function(){if(this._customMaterial)return this.setMaterial(this._customMaterial,0),this._renderData&&(this._renderData.material=this._customMaterial,this.markForUpdateRenderData(),this._renderData.passDirty=!0),void(this._blendHash=-1);var t=this._updateBuiltinMaterial();this.setMaterial(t,0),this._renderData&&(this._renderData.material=t,this.markForUpdateRenderData()),this._updateBlendFunc()},n._updateColor=function(){this.node._uiProps.colorDirty=!0,this._assembler&&(this._assembler.updateColor(this),this._renderFlag=this._canRender())},n._updateBlendFunc=function(){var t=this._blendState.targets[0];t||(t=new Lo,this._blendState.setTarget(0,t)),t.blendDst===this._dstBlendFactor&&t.blendSrc===this._srcBlendFactor||(t.blend=!0,t.blendDstAlpha=Fr.ONE_MINUS_SRC_ALPHA,t.blendDst=this._dstBlendFactor,t.blendSrc=this._srcBlendFactor,this.renderData&&(this.renderData.passDirty=!0)),this.updateBlendHash()},n.getBlendState=function(){return this._blendState},n._nodeStateChange=function(){this._renderData&&this.markForUpdateRenderData();for(var t=0;t<this.node.children.length;++t){var n=this.node.children[t].getComponent(e);n&&n.markForUpdateRenderData()}},n._onMaterialModified=function(e,n){this._renderData&&(this.markForUpdateRenderData(),this._renderData.passDirty=!0),t.prototype._onMaterialModified.call(this,e,n)},n._updateBuiltinMaterial=function(){var t;switch(this._instanceMaterialType){case iX.ADD_COLOR:t=Lg.get("ui-base-material");break;case iX.GRAYSCALE:t=Lg.get("ui-sprite-gray-material");break;case iX.USE_ALPHA_SEPARATED:t=Lg.get("ui-sprite-alpha-sep-material");break;case iX.USE_ALPHA_SEPARATED_AND_GRAY:t=Lg.get("ui-sprite-gray-alpha-sep-material");break;default:t=Lg.get("ui-sprite-material")}return t},n.setNodeDirty=function(){this.renderData&&(this.renderData.nodeDirty=!0)},n.setTextureDirty=function(){this.renderData&&(this.renderData.textureDirty=!0)},L(e,[{key:"sharedMaterials",get:function(){return this._materials},set:function(t){for(var e=0;e<t.length;e++)t[e]!==this._materials[e]&&this.setMaterial(t[e],e);if(t.length<this._materials.length){for(var n=t.length;n<this._materials.length;n++)this.setMaterial(null,n);this._materials.splice(t.length)}}},{key:"customMaterial",get:function(){return this._customMaterial},set:function(t){this._customMaterial=t,this.updateMaterial()}},{key:"srcBlendFactor",get:function(){return this._customMaterial&&E(12001),this._srcBlendFactor},set:function(t){this._customMaterial?E(12001):this._srcBlendFactor!==t&&(this._srcBlendFactor=t,this._updateBlendFunc())}},{key:"dstBlendFactor",get:function(){return this._customMaterial&&E(12001),this._dstBlendFactor},set:function(t){this._customMaterial?E(12001):this._dstBlendFactor!==t&&(this._dstBlendFactor=t,this._updateBlendFunc())}},{key:"color",get:function(){return this._color},set:function(t){this._color.equals(t)||(this._color.set(t),this._updateColor())}},{key:"renderData",get:function(){return this._renderData}},{key:"delegateSrc",set:function(t){this._delegateSrc=t}},{key:"blendHash",get:function(){return this._blendHash}}]),e}(mF),eX.BlendState=Fr,eX.Assembler=null,eX.PostAssembler=null,QW=q((KW=nX).prototype,"_materials",[Xl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),q(KW.prototype,"sharedMaterials",[Xl,kW],Object.getOwnPropertyDescriptor(KW.prototype,"sharedMaterials"),KW.prototype),ZW=q(KW.prototype,"_customMaterial",[GW],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q(KW.prototype,"customMaterial",[HW,VW,jW,WW],Object.getOwnPropertyDescriptor(KW.prototype,"customMaterial"),KW.prototype),q(KW.prototype,"color",[XW,qW],Object.getOwnPropertyDescriptor(KW.prototype,"color"),KW.prototype),JW=q(KW.prototype,"_srcBlendFactor",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Fr.SRC_ALPHA}}),$W=q(KW.prototype,"_dstBlendFactor",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Fr.ONE_MINUS_SRC_ALPHA}}),tX=q(KW.prototype,"_color",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return _i.WHITE.clone()}}),YW=KW))||YW)||YW)||YW)||YW));i.internal.Renderable2D=Sq,function(t){t[t.LEFT=0]="LEFT",t[t.CENTER=1]="CENTER",t[t.RIGHT=2]="RIGHT"}(gq||(gq=t("HorizontalTextAlignment",{}))),Zt(gq),function(t){t[t.TOP=0]="TOP",t[t.CENTER=1]="CENTER",t[t.BOTTOM=2]="BOTTOM"}(vq||(vq=t("VerticalTextAlignment",{}))),Zt(vq),function(t){t[t.NONE=0]="NONE",t[t.CLAMP=1]="CLAMP",t[t.SHRINK=2]="SHRINK",t[t.RESIZE_HEIGHT=3]="RESIZE_HEIGHT"}(yq||(yq=t("Overflow",{}))),Zt(yq),function(t){t[t.NONE=0]="NONE",t[t.BITMAP=1]="BITMAP",t[t.CHAR=2]="CHAR"}(xq||(xq=t("CacheMode",{}))),Zt(xq);var Tq,Aq,Eq,Cq=function(e){return t({Label:e,LabelComponent:e}),e}((aX=nl("cc.Label"),oX=vl(),sX=rl(110),cX=pl(),lX=Il(),uX=Al(),hX=Bl(gq),fX=Il(),_X=Al(),pX=Bl(vq),dX=Il(),mX=Al(),gX=Il(),vX=Al(),yX=Il(),xX=xl(),SX=Al(),TX=Il(),AX=Al(),EX=xl(),CX=Il(),bX=Al(),wX=Bl(yq),PX=Il(),IX=Al(),RX=Il(),DX=Al(),OX=Bl(gj),MX=Il(),NX=xl(),LX=Al(),BX=Il(),FX=Al(),zX=Bl(xq),UX=Il(),kX=Al(),GX=Il(),HX=Al(),VX=Il(),jX=Al(),WX=Il(),XX=Al(),qX=xl(),YX=Il(),KX=Al(),aX(QX=oX(QX=sX(QX=cX((mq=dq=function(t){function e(){var e;return X(e=t.call(this)||this,"_string",JX,V(e)),X(e,"_horizontalAlign",$X,V(e)),X(e,"_verticalAlign",tq,V(e)),X(e,"_actualFontSize",eq,V(e)),X(e,"_fontSize",nq,V(e)),X(e,"_fontFamily",iq,V(e)),X(e,"_lineHeight",rq,V(e)),X(e,"_overflow",aq,V(e)),X(e,"_enableWrapText",oq,V(e)),X(e,"_font",sq,V(e)),X(e,"_isSystemFontUsed",cq,V(e)),X(e,"_spacingX",lq,V(e)),X(e,"_isItalic",uq,V(e)),X(e,"_isBold",hq,V(e)),X(e,"_isUnderline",fq,V(e)),X(e,"_underlineHeight",_q,V(e)),X(e,"_cacheMode",pq,V(e)),e._N$file=null,e._texture=null,e._ttfSpriteFrame=null,e._userDefinedFont=null,e._assemblerData=null,e._fontAtlas=null,e._letterTexture=null,e._ttfSpriteFrame=null,e}F(e,t);var n=e.prototype;return n.onEnable=function(){t.prototype.onEnable.call(this),this._font||this._isSystemFontUsed||(this.useSystemFont=!0),this._isSystemFontUsed&&!this._fontFamily&&(this.fontFamily="Arial"),this._applyFontTexture()},n.onDestroy=function(){if(this._assembler&&this._assembler.resetAssemblerData&&this._assembler.resetAssemblerData(this._assemblerData),this._assemblerData=null,this._ttfSpriteFrame){this._ttfSpriteFrame._resetDynamicAtlasFrame();var e=this._ttfSpriteFrame.texture;if(this._ttfSpriteFrame.destroy(),e){var n=e;n.image&&n.image.destroy(),e.destroy()}this._ttfSpriteFrame=null}this._letterTexture=null,t.prototype.onDestroy.call(this)},n.updateRenderData=function(t){void 0===t&&(t=!1),this.markForUpdateRenderData(),t&&(this._flushAssembler(),this.renderData&&(this.renderData.vertDirty=!0),this._applyFontTexture(),this._assembler&&this._assembler.updateRenderData(this))},n._render=function(t){t.commitComp(this,this.renderData,this._texture,this._assembler,null)},n._updateColor=function(){t.prototype._updateColor.call(this),this.updateRenderData(!1)},n._canRender=function(){if(!t.prototype._canRender.call(this)||!this._string)return!1;var e=this._font;if(e&&e instanceof Dj){var n=e.spriteFrame;if(!n||!n.texture)return!1}return!0},n._flushAssembler=function(){var t=e.Assembler.getAssembler(this);this._assembler!==t&&(this.destroyRenderData(),this._assembler=t),this._renderData||this._assembler&&this._assembler.createData&&(this._renderData=this._assembler.createData(this),this._renderData.material=this.material)},n._applyFontTexture=function(){this.markForUpdateRenderData();var t=this._font;if(t instanceof Dj){var e=t.spriteFrame;e&&e.texture&&(this._texture=e,this.renderData&&(this.renderData.textureDirty=!0),this.changeMaterialForDefine(),this._assembler&&this._assembler.updateRenderData(this))}else{if(this.cacheMode===xq.CHAR)this._letterTexture=this._assembler.getAssemblerData(),this._texture=this._letterTexture;else if(!this._ttfSpriteFrame){this._ttfSpriteFrame=new uj,this._assemblerData=this._assembler.getAssemblerData();var n=new Dm(this._assemblerData.canvas),i=new ng;i.image=n,this._ttfSpriteFrame.texture=i}this.cacheMode!==xq.CHAR&&(this._texture=this._ttfSpriteFrame),this.changeMaterialForDefine()}},n.changeMaterialForDefine=function(){if(this._texture){var t=!1;if(this.cacheMode!==xq.CHAR){var e=this._texture.texture;if(e instanceof Mm){var n=e.getPixelFormat();t=n===em.RGBA_ETC1||n===em.RGB_A_PVRTC_4BPPV1||n===em.RGB_A_PVRTC_2BPPV1}}this._instanceMaterialType=t?iX.USE_ALPHA_SEPARATED:iX.ADD_COLOR_AND_TEXTURE,this.updateMaterial()}},L(e,[{key:"string",get:function(){return this._string},set:function(t){t=null==t?"":t.toString(),this._string!==t&&(this._string=t,this.updateRenderData())}},{key:"horizontalAlign",get:function(){return this._horizontalAlign},set:function(t){this._horizontalAlign!==t&&(this._horizontalAlign=t,this.updateRenderData())}},{key:"verticalAlign",get:function(){return this._verticalAlign},set:function(t){this._verticalAlign!==t&&(this._verticalAlign=t,this.updateRenderData())}},{key:"actualFontSize",get:function(){return this._actualFontSize},set:function(t){this._actualFontSize=t}},{key:"fontSize",get:function(){return this._fontSize},set:function(t){this._fontSize!==t&&(this._fontSize=t,this.updateRenderData())}},{key:"fontFamily",get:function(){return this._fontFamily},set:function(t){this._fontFamily!==t&&(this._fontFamily=t,this.updateRenderData())}},{key:"lineHeight",get:function(){return this._lineHeight},set:function(t){this._lineHeight!==t&&(this._lineHeight=t,this.updateRenderData())}},{key:"spacingX",get:function(){return this._spacingX},set:function(t){this._spacingX!==t&&(this._spacingX=t,this.updateRenderData())}},{key:"overflow",get:function(){return this._overflow},set:function(t){this._overflow!==t&&(this._overflow=t,this.updateRenderData())}},{key:"enableWrapText",get:function(){return this._enableWrapText},set:function(t){this._enableWrapText!==t&&(this._enableWrapText=t,this.updateRenderData())}},{key:"font",get:function(){return this._font},set:function(t){this._font!==t&&(this._isSystemFontUsed=!t,this._font=t,this._renderData&&(this.destroyRenderData(),this._renderData=null),this._fontAtlas=null,this.updateRenderData(!0))}},{key:"useSystemFont",get:function(){return this._isSystemFontUsed},set:function(t){this._isSystemFontUsed!==t&&(this.destroyRenderData(),this._renderData=null,this._isSystemFontUsed=!!t,t&&(this.font=null),this._flushAssembler(),this.updateRenderData())}},{key:"cacheMode",get:function(){return this._cacheMode},set:function(t){this._cacheMode!==t&&(this._cacheMode!==xq.BITMAP||this._font instanceof Dj||!this._ttfSpriteFrame||this._ttfSpriteFrame._resetDynamicAtlasFrame(),this._cacheMode===xq.CHAR&&(this._ttfSpriteFrame=null),this._cacheMode=t,this.updateRenderData(!0))}},{key:"isBold",get:function(){return this._isBold},set:function(t){this._isBold!==t&&(this._isBold=t,this.updateRenderData())}},{key:"isItalic",get:function(){return this._isItalic},set:function(t){this._isItalic!==t&&(this._isItalic=t,this.updateRenderData())}},{key:"isUnderline",get:function(){return this._isUnderline},set:function(t){this._isUnderline!==t&&(this._isUnderline=t,this.updateRenderData())}},{key:"underlineHeight",get:function(){return this._underlineHeight},set:function(t){this._underlineHeight!==t&&(this._underlineHeight=t,this.updateRenderData())}},{key:"spriteFrame",get:function(){return this._texture}},{key:"ttfSpriteFrame",get:function(){return this._ttfSpriteFrame}},{key:"assemblerData",get:function(){return this._assemblerData}},{key:"fontAtlas",get:function(){return this._fontAtlas},set:function(t){this._fontAtlas=t}},{key:"_bmFontOriginalSize",get:function(){return this._font instanceof Dj?this._font.fontSize:-1}}]),e}(Sq),dq.HorizontalAlign=gq,dq.VerticalAlign=vq,dq.Overflow=yq,dq.CacheMode=xq,dq._canvasPool=Yj.getInstance(),q((ZX=mq).prototype,"string",[lX,uX,Rl],Object.getOwnPropertyDescriptor(ZX.prototype,"string"),ZX.prototype),q(ZX.prototype,"horizontalAlign",[hX,fX,_X],Object.getOwnPropertyDescriptor(ZX.prototype,"horizontalAlign"),ZX.prototype),q(ZX.prototype,"verticalAlign",[pX,dX,mX],Object.getOwnPropertyDescriptor(ZX.prototype,"verticalAlign"),ZX.prototype),q(ZX.prototype,"fontSize",[gX,vX],Object.getOwnPropertyDescriptor(ZX.prototype,"fontSize"),ZX.prototype),q(ZX.prototype,"fontFamily",[yX,xX,SX],Object.getOwnPropertyDescriptor(ZX.prototype,"fontFamily"),ZX.prototype),q(ZX.prototype,"lineHeight",[TX,AX],Object.getOwnPropertyDescriptor(ZX.prototype,"lineHeight"),ZX.prototype),q(ZX.prototype,"spacingX",[EX,CX,bX],Object.getOwnPropertyDescriptor(ZX.prototype,"spacingX"),ZX.prototype),q(ZX.prototype,"overflow",[wX,PX,IX],Object.getOwnPropertyDescriptor(ZX.prototype,"overflow"),ZX.prototype),q(ZX.prototype,"enableWrapText",[RX,DX],Object.getOwnPropertyDescriptor(ZX.prototype,"enableWrapText"),ZX.prototype),q(ZX.prototype,"font",[OX,MX,NX,LX],Object.getOwnPropertyDescriptor(ZX.prototype,"font"),ZX.prototype),q(ZX.prototype,"useSystemFont",[BX,FX],Object.getOwnPropertyDescriptor(ZX.prototype,"useSystemFont"),ZX.prototype),q(ZX.prototype,"cacheMode",[zX,UX,kX],Object.getOwnPropertyDescriptor(ZX.prototype,"cacheMode"),ZX.prototype),q(ZX.prototype,"isBold",[GX,HX],Object.getOwnPropertyDescriptor(ZX.prototype,"isBold"),ZX.prototype),q(ZX.prototype,"isItalic",[VX,jX],Object.getOwnPropertyDescriptor(ZX.prototype,"isItalic"),ZX.prototype),q(ZX.prototype,"isUnderline",[WX,XX],Object.getOwnPropertyDescriptor(ZX.prototype,"isUnderline"),ZX.prototype),q(ZX.prototype,"underlineHeight",[qX,yl,YX,KX],Object.getOwnPropertyDescriptor(ZX.prototype,"underlineHeight"),ZX.prototype),JX=q(ZX.prototype,"_string",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"label"}}),$X=q(ZX.prototype,"_horizontalAlign",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return gq.CENTER}}),tq=q(ZX.prototype,"_verticalAlign",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return vq.CENTER}}),eq=q(ZX.prototype,"_actualFontSize",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),nq=q(ZX.prototype,"_fontSize",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 40}}),iq=q(ZX.prototype,"_fontFamily",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"Arial"}}),rq=q(ZX.prototype,"_lineHeight",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 40}}),aq=q(ZX.prototype,"_overflow",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return yq.NONE}}),oq=q(ZX.prototype,"_enableWrapText",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),sq=q(ZX.prototype,"_font",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),cq=q(ZX.prototype,"_isSystemFontUsed",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),lq=q(ZX.prototype,"_spacingX",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),uq=q(ZX.prototype,"_isItalic",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),hq=q(ZX.prototype,"_isBold",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),fq=q(ZX.prototype,"_isUnderline",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),_q=q(ZX.prototype,"_underlineHeight",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),pq=q(ZX.prototype,"_cacheMode",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return xq.NONE}}),QX=ZX))||QX)||QX)||QX)||QX));i.Label=Cq,function(t){t[t.BUTT=0]="BUTT",t[t.ROUND=1]="ROUND",t[t.SQUARE=2]="SQUARE"}(Tq||(Tq={})),Zt(Tq),function(t){t[t.BEVEL=0]="BEVEL",t[t.ROUND=1]="ROUND",t[t.MITER=2]="MITER"}(Aq||(Aq={})),Zt(Aq),function(t){t[t.PT_CORNER=1]="PT_CORNER",t[t.PT_LEFT=2]="PT_LEFT",t[t.PT_BEVEL=4]="PT_BEVEL",t[t.PT_INNERBEVEL=8]="PT_INNERBEVEL"}(Eq||(Eq={})),Zt(Eq);var bq=Math.PI,wq=Math.min,Pq=Math.max,Iq=Math.cos,Rq=Math.sin,Dq=Math.abs,Oq=Math.sign,Mq=.5522847493;function Nq(t,e,n,i,r){t.moveTo(e-i,n),t.bezierCurveTo(e-i,n+r*Mq,e-i*Mq,n+r,e,n+r),t.bezierCurveTo(e+i*Mq,n+r,e+i,n+r*Mq,e+i,n),t.bezierCurveTo(e+i,n-r*Mq,e+i*Mq,n-r,e,n-r),t.bezierCurveTo(e-i*Mq,n-r,e-i,n-r*Mq,e-i,n),t.close()}function Lq(t,e,n,i,r,a,o,s,c,l,u){var h,f,_,p,d,m,g,v,y,x,S,T,A,E,C,b;l>10||(d=.5*(a+s),m=.5*(o+c),g=.5*((h=.5*(e+i))+(_=.5*(i+a))),v=.5*((f=.5*(n+r))+(p=.5*(r+o))),((C=Dq((i-s)*(E=c-n)-(r-c)*(A=s-e)))+(b=Dq((a-s)*E-(o-c)*A)))*(C+b)<t.tessTol*(A*A+E*E)?t.addPoint(s,c,0===u?u|Eq.PT_BEVEL:u):(Lq(t,e,n,h,f,g,v,S=.5*(g+(y=.5*(_+d))),T=.5*(v+(x=.5*(p+m))),l+1,0),Lq(t,S,T,y,x,d,m,s,c,l+1,u)))}var Bq,Fq,zq,Uq,kq,Gq,Hq,Vq,jq,Wq,Xq,qq,Yq,Kq,Qq,Zq,Jq,$q,tY,eY,nY,iY,rY,aY,oY,sY,cY,lY,uY,hY,fY,_Y,pY,dY,mY,gY,vY,yY,xY,SY,TY,AY,EY,CY,bY,wY,PY,IY=function(t){function e(e,n){var i;return(i=t.call(this,e,n)||this).dx=0,i.dy=0,i.dmx=0,i.dmy=0,i.flags=0,i.len=0,i.reset(),i}return F(e,t),e.prototype.reset=function(){this.dx=0,this.dy=0,this.dmx=0,this.dmy=0,this.flags=0,this.len=0},e}(Ni),RY=function(){function t(){this.closed=!1,this.bevel=0,this.complex=!0,this.points=[],this.reset()}return t.prototype.reset=function(){this.closed=!1,this.bevel=0,this.complex=!0,this.points?this.points.length=0:this.points=[]},t}(),DY=function(){function t(){this.dataOffset=0,this.updatePathOffset=!1,this.pathLength=0,this.pathOffset=0,this.paths=[],this.tessTol=.25,this.distTol=.01,this.fillColor=_i.WHITE.clone(),this.lineCap=Tq.BUTT,this.strokeColor=_i.BLACK.clone(),this.lineJoin=Aq.MITER,this.lineWidth=0,this.pointsOffset=0,this._commandX=0,this._commandY=0,this._points=[],this._renderDataList=[],this._curPath=null}var e=t.prototype;return e.moveTo=function(t,e){this.updatePathOffset&&(this.pathOffset=this.pathLength,this.updatePathOffset=!1),this._addPath(),this.addPoint(t,e,Eq.PT_CORNER),this._commandX=t,this._commandY=e},e.lineTo=function(t,e){this.addPoint(t,e,Eq.PT_CORNER),this._commandX=t,this._commandY=e},e.bezierCurveTo=function(t,e,n,i,r,a){var o=this._curPath,s=o.points[o.points.length-1];s&&(s.x!==t||s.y!==e||n!==r||i!==a?(Lq(this,s.x,s.y,t,e,n,i,r,a,0,Eq.PT_CORNER),this._commandX=r,this._commandY=a):this.lineTo(r,a))},e.quadraticCurveTo=function(t,e,n,i){var r=this._commandX,a=this._commandY;this.bezierCurveTo(r+2/3*(t-r),a+2/3*(e-a),n+2/3*(t-n),i+2/3*(e-i),n,i)},e.arc=function(t,e,n,i,r,a){!function(t,e,n,i,r,a,o){var s,c,l=0,u=0,h=0,f=0,_=0,p=0,d=0,m=0,g=0,v=0,y=0,x=0,S=0,T=0;if(u=a-r,o=o||!1)if(Dq(u)>=2*bq)u=2*bq;else for(;u<0;)u+=2*bq;else if(Dq(u)>=2*bq)u=2*-bq;else for(;u>0;)u-=2*bq;for(c=0|Pq(1,wq(Dq(u)/(.5*bq)+.5,5)),h=Dq(4/3*(1-Iq(s=u/c/2))/Rq(s)),o||(h=-h),T=0;T<=c;T++)p=e+(f=Iq(l=r+u*(T/c)))*i,d=n+(_=Rq(l))*i,m=-_*i*h,g=f*i*h,0===T?t.moveTo(p,d):t.bezierCurveTo(v+x,y+S,p-m,d-g,p,d),v=p,y=d,x=m,S=g}(this,t,e,n,i,r,a)},e.ellipse=function(t,e,n,i){Nq(this,t,e,n,i),this._curPath.complex=!1},e.circle=function(t,e,n){Nq(this,t,e,n,n),this._curPath.complex=!1},e.rect=function(t,e,n,i){this.moveTo(t,e),this.lineTo(t+n,e),this.lineTo(t+n,e+i),this.lineTo(t,e+i),this.close(),this._curPath.complex=!1},e.roundRect=function(t,e,n,i,r){!function(t,e,n,i,r,a){if(a<.1)t.rect(e,n,i,r);else{var o=wq(a,.5*Dq(i))*Oq(i),s=wq(a,.5*Dq(r))*Oq(r);t.moveTo(e,n+s),t.lineTo(e,n+r-s),t.bezierCurveTo(e,n+r-s*(1-Mq),e+o*(1-Mq),n+r,e+o,n+r),t.lineTo(e+i-o,n+r),t.bezierCurveTo(e+i-o*(1-Mq),n+r,e+i,n+r-s*(1-Mq),e+i,n+r-s),t.lineTo(e+i,n+s),t.bezierCurveTo(e+i,n+s*(1-Mq),e+i-o*(1-Mq),n,e+i-o,n),t.lineTo(e+o,n),t.bezierCurveTo(e+o*(1-Mq),n,e,n+s*(1-Mq),e,n+s),t.close()}}(this,t,e,n,i,r),this._curPath.complex=!1},e.clear=function(){this.pathLength=0,this.pathOffset=0,this.pointsOffset=0,this.dataOffset=0,this._curPath=null,this.paths.length=0,this._points.length=0;for(var t=this._renderDataList,e=0,n=t.length;e<n;e++){var i=t[e];i&&PW.remove(i)}this._renderDataList.length=0},e.close=function(){this._curPath.closed=!0},e.requestRenderData=function(){var t=PW.add();return this._renderDataList.push(t),t},e.getRenderDataList=function(){return 0===this._renderDataList.length&&this.requestRenderData(),this._renderDataList},e.addPoint=function(t,e,n){var i=this._curPath;if(i){var r=this._points,a=i.points,o=r[this.pointsOffset++];o?(o.x=t,o.y=e):(o=new IY(t,e),r.push(o)),o.flags=n,a.push(o)}},e._addPath=function(){var t=this.pathLength,e=this.paths[t];return e?e.reset():(e=new RY,this.paths.push(e)),this.pathLength++,this._curPath=e,e},t}(),OY=iW.concat([new Ua("a_dist",Sr.R32F)]),MY=oW(OY),NY=sW(OY),LY=function(e){return t({Graphics:e,GraphicsComponent:e}),e}((Bq=nl("cc.Graphics"),Fq=vl(),zq=rl(110),Uq=pl(),kq=Al(),Gq=Bl(Aq),Hq=Al(),Vq=Bl(Tq),jq=Al(),Wq=Al(),Xq=Al(),qq=Al(),Yq=xl(),Bq(Kq=Fq(Kq=zq(Kq=Uq((rY=iY=function(t){function e(){var e;return(e=t.call(this)||this).impl=null,e.model=null,X(e,"_lineWidth",Zq,V(e)),X(e,"_strokeColor",Jq,V(e)),X(e,"_lineJoin",$q,V(e)),X(e,"_lineCap",tY,V(e)),X(e,"_fillColor",eY,V(e)),X(e,"_miterLimit",nY,V(e)),e._isDrawing=!1,e._isNeedUploadData=!0,e._graphicsUseSubMeshes=[],e._instanceMaterialType=iX.ADD_COLOR,e.impl=new DY,e}F(e,t);var n=e.prototype;return n.onRestore=function(){this.impl||this._flushAssembler()},n.onLoad=function(){this.model=WM.root.createModel(Jg),this.model.node=this.model.transform=this.node,this._flushAssembler()},n.onEnable=function(){t.prototype.onEnable.call(this),this._updateMtlForGraphics()},n.onDisable=function(){t.prototype.onDisable.call(this)},n.onDestroy=function(){this._sceneGetter=null,this.model&&(WM.root.destroyModel(this.model),this.model=null);var e=this._graphicsUseSubMeshes.length;if(e>0){for(var n=0;n<e;++n)this._graphicsUseSubMeshes[n].destroy();this._graphicsUseSubMeshes.length=0}this.impl&&(this._isDrawing=!1,this.impl.clear(),this.impl=null),t.prototype.onDestroy.call(this)},n.moveTo=function(t,e){this.impl&&this.impl.moveTo(t,e)},n.lineTo=function(t,e){this.impl&&this.impl.lineTo(t,e)},n.bezierCurveTo=function(t,e,n,i,r,a){this.impl&&this.impl.bezierCurveTo(t,e,n,i,r,a)},n.quadraticCurveTo=function(t,e,n,i){this.impl&&this.impl.quadraticCurveTo(t,e,n,i)},n.arc=function(t,e,n,i,r,a){this.impl&&this.impl.arc(t,e,n,i,r,a)},n.ellipse=function(t,e,n,i){this.impl&&this.impl.ellipse(t,e,n,i)},n.circle=function(t,e,n){this.impl&&this.impl.circle(t,e,n)},n.rect=function(t,e,n,i){this.impl&&this.impl.rect(t,e,n,i)},n.roundRect=function(t,e,n,i,r){this.impl&&this.impl.roundRect(t,e,n,i,r)},n.fillRect=function(t,e,n,i){this.rect(t,e,n,i),this.fill()},n.clear=function(){if(this.impl){if(this.impl.clear(),this._isDrawing=!1,this.model)for(var t=0;t<this.model.subModels.length;t++)this.model.subModels[t].inputAssembler.indexCount=0;this.markForUpdateRenderData()}},n.close=function(){this.impl&&this.impl.close()},n.stroke=function(){this._assembler||this._flushAssembler(),this._isDrawing=!0,this._isNeedUploadData=!0,this._assembler.stroke(this)},n.fill=function(){this._assembler||this._flushAssembler(),this._isDrawing=!0,this._isNeedUploadData=!0,this._assembler.fill(this)},n._updateMtlForGraphics=function(){var t;this._customMaterial?t=this.getMaterialInstance(0):(t=Lg.get("ui-graphics-material"),this.setMaterial(t,0),(t=this.getMaterialInstance(0)).recompileShaders({USE_LOCAL:!0}))},n.activeSubModel=function(t){if(this.model){if(this.model.subModels.length<=t){var e=i.director.root.device,n=e.createBuffer(new Ta(Er.VERTEX|Er.TRANSFER_DST,wr.DEVICE,65535*NY,NY)),r=e.createBuffer(new Ta(Er.INDEX|Er.TRANSFER_DST,wr.DEVICE,131070*Uint16Array.BYTES_PER_ELEMENT,Uint16Array.BYTES_PER_ELEMENT)),a=new Vb([n],OY,Xr.TRIANGLE_LIST,r);a.subMeshIdx=0,this.model.initSubModel(t,a,this.getMaterialInstance(0)),this._graphicsUseSubMeshes.push(a)}}else E(4500,this.node.name)},n._uploadData=function(){var t=this.impl;if(t){var e=t&&t.getRenderDataList();if(!(e.length<=0)&&this.model){for(var n=this.model.subModels,i=0;i<e.length;i++){var r=e[i],a=n[i].inputAssembler;if(r.lastFilledVertex!==r.vertexStart){var o=new Float32Array(r.vData.buffer,0,r.vertexStart*MY);a.vertexBuffers[0].update(o),a.vertexCount=r.vertexStart;var s=new Uint16Array(r.iData.buffer,0,r.indexStart);a.indexBuffer.update(s),a.indexCount=r.indexStart,r.lastFilledVertex=r.vertexStart,r.lastFilledIndex=r.indexStart}}this._isNeedUploadData=!1}}},n._render=function(t){if(this._isNeedUploadData){if(this.impl){var e=this.impl.getRenderDataList(),n=this.model.subModels.length;if(e.length>n)for(var i=n;i<e.length;i++)this.activeSubModel(i)}this._uploadData()}t.commitModel(this,this.model,this.getMaterialInstance(0))},n._flushAssembler=function(){var t=e.Assembler.getAssembler(this);this._assembler!==t&&(this._assembler=t)},n._canRender=function(){return!!t.prototype._canRender.call(this)&&!!this.model&&this._isDrawing},L(e,[{key:"lineWidth",get:function(){return this._lineWidth},set:function(t){this._lineWidth=t,this.impl&&(this.impl.lineWidth=t)}},{key:"lineJoin",get:function(){return this._lineJoin},set:function(t){this._lineJoin=t,this.impl&&(this.impl.lineJoin=t)}},{key:"lineCap",get:function(){return this._lineCap},set:function(t){this._lineCap=t,this.impl&&(this.impl.lineCap=t)}},{key:"strokeColor",get:function(){return this._strokeColor},set:function(t){this.impl&&(this._strokeColor.set(t),this.impl.strokeColor=this._strokeColor)}},{key:"fillColor",get:function(){return this._fillColor},set:function(t){this.impl&&(this._fillColor.set(t),this.impl.fillColor=this._fillColor)}},{key:"miterLimit",get:function(){return this._miterLimit},set:function(t){this._miterLimit=t}},{key:"color",get:function(){return this._color},set:function(t){this._color!==t&&this._color.set(t)}},{key:"srcBlendFactor",get:function(){return this._srcBlendFactor},set:function(){}},{key:"dstBlendFactor",get:function(){return this._dstBlendFactor},set:function(){}}]),e}(Sq),iY.LineJoin=Aq,iY.LineCap=Tq,q((Qq=rY).prototype,"lineWidth",[yl,kq],Object.getOwnPropertyDescriptor(Qq.prototype,"lineWidth"),Qq.prototype),q(Qq.prototype,"lineJoin",[Gq,Hq],Object.getOwnPropertyDescriptor(Qq.prototype,"lineJoin"),Qq.prototype),q(Qq.prototype,"lineCap",[Vq,jq],Object.getOwnPropertyDescriptor(Qq.prototype,"lineCap"),Qq.prototype),q(Qq.prototype,"strokeColor",[Wq],Object.getOwnPropertyDescriptor(Qq.prototype,"strokeColor"),Qq.prototype),q(Qq.prototype,"fillColor",[Xq],Object.getOwnPropertyDescriptor(Qq.prototype,"fillColor"),Qq.prototype),q(Qq.prototype,"miterLimit",[qq],Object.getOwnPropertyDescriptor(Qq.prototype,"miterLimit"),Qq.prototype),q(Qq.prototype,"color",[Xl,Yq],Object.getOwnPropertyDescriptor(Qq.prototype,"color"),Qq.prototype),Zq=q(Qq.prototype,"_lineWidth",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Jq=q(Qq.prototype,"_strokeColor",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return _i.BLACK.clone()}}),$q=q(Qq.prototype,"_lineJoin",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Aq.MITER}}),tY=q(Qq.prototype,"_lineCap",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Tq.BUTT}}),eY=q(Qq.prototype,"_fillColor",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return _i.WHITE.clone()}}),nY=q(Qq.prototype,"_miterLimit",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),Kq=Qq))||Kq)||Kq)||Kq)||Kq));i.Graphics=LY;var BY,FY=new Ri,zY=new Ni,UY=new Ri,kY=[];!function(t){t[t.RECT=0]="RECT",t[t.ELLIPSE=1]="ELLIPSE",t[t.GRAPHICS_STENCIL=2]="GRAPHICS_STENCIL",t[t.IMAGE_STENCIL=3]="IMAGE_STENCIL"}(BY||(BY={})),Zt(BY);var GY=function(e){return t({Mask:e,MaskComponent:e}),e}((aY=nl("cc.Mask"),oY=vl(),sY=rl(110),cY=pl(),lY=Bl(BY),uY=Al(),hY=Il(),fY=Al(),_Y=xl(),pY=Bl(uj),dY=xl(),mY=xl(),gY=El(),vY=xl(),yY=xl(),aY(xY=oY(xY=sY(xY=cY((PY=wY=function(t){function e(){var e;return(e=t.call(this)||this)._clearStencilMtl=null,e._clearModel=null,X(e,"_type",TY,V(e)),X(e,"_inverted",AY,V(e)),X(e,"_segments",EY,V(e)),X(e,"_spriteFrame",CY,V(e)),X(e,"_alphaThreshold",bY,V(e)),e._graphics=null,e._clearModelMesh=null,e._instanceMaterialType=iX.ADD_COLOR,e}F(e,t);var n=e.prototype;return n.onLoad=function(){this._createClearModel(),this._createGraphics(),this._graphics&&this._graphics.onLoad()},n.onEnable=function(){t.prototype.onEnable.call(this),this._updateGraphics(),this._enableGraphics()},n.onRestore=function(){this._createGraphics(),t.prototype.updateMaterial.call(this),this._updateGraphics(),this._renderFlag=this._canRender()},n.onDisable=function(){t.prototype.onDisable.call(this),this._disableGraphics()},n.onDestroy=function(){this._clearModel&&this._clearModelMesh&&(WM.root.destroyModel(this._clearModel),this._clearModelMesh.destroy()),this._clearStencilMtl&&this._clearStencilMtl.destroy(),this._removeGraphics(),t.prototype.onDestroy.call(this)},n.isHit=function(t){var e=this.node._uiProps.uiTransformComp,n=e.contentSize,i=n.width,r=n.height,a=zY;this.node.getWorldMatrix(FY),Ri.invert(UY,FY),Ni.transformMat4(a,t,UY);var o=e.anchorPoint;a.x+=o.x*i,a.y+=o.y*r;var s=!1;if(this.type===BY.RECT||this.type===BY.GRAPHICS_STENCIL||this.type===BY.IMAGE_STENCIL)s=a.x>=0&&a.y>=0&&a.x<=i&&a.y<=r;else if(this.type===BY.ELLIPSE){var c=i/2,l=r/2,u=a.x-.5*i,h=a.y-.5*r;s=u*u/(c*c)+h*h/(l*l)<1}return this._inverted&&(s=!s),s},n._render=function(t){t.commitComp(this,this.renderData,null,this._assembler,null)},n._postRender=function(t){this._postAssembler&&t.commitComp(this,null,null,this._postAssembler,null)},n._nodeStateChange=function(e){t.prototype._nodeStateChange.call(this,e),this._updateGraphics()},n._canRender=function(){return!!t.prototype._canRender.call(this)&&null!==this._graphics&&(this._type!==BY.IMAGE_STENCIL||null!==this._spriteFrame)},n._flushAssembler=function(){var t=e.Assembler.getAssembler(this),n=e.PostAssembler.getAssembler(this);this._assembler!==t&&(this.destroyRenderData(),this._assembler=t),this._postAssembler!==n&&(this._postAssembler=n),this._useRenderData()},n._createGraphics=function(){if(!this._graphics){var t=this._graphics=new LY;t._objFlags|=Ye.Flags.IsOnLoadCalled,t.node=this.node,t.node.getWorldMatrix(),t.lineWidth=0;var e=_i.WHITE.clone();e.a=0,t.fillColor=e}this._updateMaterial()},n._updateGraphics=function(){if(this._graphics&&(this._type===BY.RECT||this._type===BY.ELLIPSE)){var t=this.node._uiProps.uiTransformComp,e=this._graphics;e.clear();var n=t.contentSize,i=n.width,r=n.height,a=t.anchorPoint,o=-i*a.x,s=-r*a.y;if(this._type===BY.RECT)e.rect(o,s,i,r);else if(this._type===BY.ELLIPSE){for(var c=function(t,e,n){kY.length=0;for(var i=2*Math.PI/n,r=0;r<n;++r)kY.push(new di(e.x*Math.cos(i*r)+t.x,e.y*Math.sin(i*r)+t.y,0));return kY}(new di(o+i/2,s+r/2,0),new di(i/2,r/2,0),this._segments),l=0;l<c.length;++l){var u=c[l];0===l?e.moveTo(u.x,u.y):e.lineTo(u.x,u.y)}e.close()}e.fill()}},n._createClearModel=function(){if(!this._clearModel){var t=Lg.get("default-clear-stencil");this._clearStencilMtl=new Hv({parent:t,owner:this,subModelIdx:0}),this._clearModel=WM.root.createModel(Jg),this._clearModel.node=this._clearModel.transform=this.node;var e=sW(nW),n=i.director.root.device,r=n.createBuffer(new Ta(Er.VERTEX|Er.TRANSFER_DST,wr.DEVICE,4*e,e)),a=new Float32Array([-1,-1,0,1,-1,0,-1,1,0,1,1,0]);r.update(a);var o=n.createBuffer(new Ta(Er.INDEX|Er.TRANSFER_DST,wr.DEVICE,6*Uint16Array.BYTES_PER_ELEMENT,Uint16Array.BYTES_PER_ELEMENT)),s=new Uint16Array([0,1,2,2,1,3]);o.update(s),this._clearModelMesh=new Vb([r],nW,Xr.TRIANGLE_LIST,o),this._clearModelMesh.subMeshIdx=0,this._clearModel.initSubModel(0,this._clearModelMesh,this._clearStencilMtl)}},n._updateMaterial=function(){if(this._graphics){var t,e=this._graphics;e.stencilStage=TW.DISABLED,this._type===BY.IMAGE_STENCIL?(t=Lg.get("ui-alpha-test-material"),e.setMaterial(t,0),(t=e.getMaterialInstance(0)).setProperty("alphaThreshold",this._alphaThreshold)):(t=Lg.get("ui-graphics-material"),e.setMaterial(t,0),e.getMaterialInstance(0))}},n._enableGraphics=function(){this._graphics&&(this._graphics._renderFlag=this._graphics._canRender())},n._disableGraphics=function(){this._graphics&&this._graphics.onDisable()},n._removeGraphics=function(){this._graphics&&(this._graphics.destroy(),this._graphics._destroyImmediate(),this._graphics=null)},n._useRenderData=function(){this._type!==BY.IMAGE_STENCIL||this._renderData||this._assembler&&this._assembler.createData&&(this._renderData=this._assembler.createData(this),this.markForUpdateRenderData())},L(e,[{key:"type",get:function(){return this._type},set:function(t){this._type!==t&&(this._type=t,this.markForUpdateRenderData(!1),this._updateMaterial(),this._type!==BY.IMAGE_STENCIL?(this._spriteFrame=null,this._updateGraphics(),this._renderData&&(this.destroyRenderData(),this._renderData=null)):(this._useRenderData(),this._graphics&&this._graphics.clear()))}},{key:"inverted",get:function(){return this._inverted},set:function(t){this._inverted=t,this.stencilStage=TW.DISABLED,this._graphics&&(this._graphics.stencilStage=TW.DISABLED)}},{key:"segments",get:function(){return this._segments},set:function(t){this._segments!==t&&(this._segments=Yn(t,3,1e4),this._updateGraphics())}},{key:"spriteFrame",get:function(){return this._spriteFrame},set:function(t){if(this._spriteFrame!==t){var e=this._spriteFrame;this._spriteFrame=t,this._type===BY.IMAGE_STENCIL&&!e&&t&&this.markForUpdateRenderData()}}},{key:"alphaThreshold",get:function(){return this._alphaThreshold},set:function(t){this._alphaThreshold!==t&&(this._alphaThreshold=t,this.type===BY.IMAGE_STENCIL&&this._graphics&&this._graphics.getMaterialInstance(0).setProperty("alphaThreshold",this._alphaThreshold))}},{key:"graphics",get:function(){return this._graphics}},{key:"dstBlendFactor",get:function(){return this._dstBlendFactor},set:function(t){this._dstBlendFactor!==t&&(this._dstBlendFactor=t,this._updateBlendFunc())}},{key:"srcBlendFactor",get:function(){return this._srcBlendFactor},set:function(t){this._srcBlendFactor!==t&&(this._srcBlendFactor=t,this._updateBlendFunc())}},{key:"color",get:function(){return this._color},set:function(t){this._color!==t&&(this._color.set(t),this.markForUpdateRenderData())}},{key:"customMaterial",get:function(){return this._customMaterial},set:function(){}}]),e}(Sq),wY.Type=BY,q((SY=PY).prototype,"type",[lY,uY],Object.getOwnPropertyDescriptor(SY.prototype,"type"),SY.prototype),q(SY.prototype,"inverted",[hY,fY],Object.getOwnPropertyDescriptor(SY.prototype,"inverted"),SY.prototype),q(SY.prototype,"segments",[_Y],Object.getOwnPropertyDescriptor(SY.prototype,"segments"),SY.prototype),q(SY.prototype,"spriteFrame",[pY,dY],Object.getOwnPropertyDescriptor(SY.prototype,"spriteFrame"),SY.prototype),q(SY.prototype,"alphaThreshold",[mY,gY,Pl],Object.getOwnPropertyDescriptor(SY.prototype,"alphaThreshold"),SY.prototype),q(SY.prototype,"color",[Xl,vY],Object.getOwnPropertyDescriptor(SY.prototype,"color"),SY.prototype),q(SY.prototype,"customMaterial",[Xl,yY],Object.getOwnPropertyDescriptor(SY.prototype,"customMaterial"),SY.prototype),TY=q(SY.prototype,"_type",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return BY.RECT}}),AY=q(SY.prototype,"_inverted",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),EY=q(SY.prototype,"_segments",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 64}}),CY=q(SY.prototype,"_spriteFrame",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),bY=q(SY.prototype,"_alphaThreshold",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),xY=SY))||xY)||xY)||xY)||xY));IR._maskComp=GY,i.Mask=GY;var HY,VY,jY,WY,XY,qY,YY,KY,QY,ZY,JY,$Y,tK,eK,nK,iK,rK,aK,oK,sK,cK,lK,uK,hK,fK,_K,pK,dK,mK,gK,vK,yK,xK,SK,TK,AK,EK,CK,bK,wK,PK,IK,RK,DK,OK,MK,NK,LK,BK,FK,zK,UK,kK,GK,HK,VK,jK,WK,XK,qK,YK,KK,QK=/^(click)(\s)*=|(param)(\s)*=/,ZK=/(\s)*src(\s)*=|(\s)*height(\s)*=|(\s)*width(\s)*=|(\s)*align(\s)*=|(\s)*offset(\s)*=|(\s)*click(\s)*=|(\s)*param(\s)*=/,JK=t("HtmlTextParser",function(){function t(){this._specialSymbolArray=[],this._stack=[],this._resultObjectArray=[],this._specialSymbolArray.push([/&lt;/g,"<"]),this._specialSymbolArray.push([/&gt;/g,">"]),this._specialSymbolArray.push([/&amp;/g,"&"]),this._specialSymbolArray.push([/&quot;/g,'"']),this._specialSymbolArray.push([/&apos;/g,"'"])}var e=t.prototype;return e.parse=function(t){this._resultObjectArray.length=0,this._stack.length=0;for(var e=0,n=t.length;e<n;){var i=t.indexOf(">",e),r=-1;if(i>=0&&(r=t.lastIndexOf("<",i))<e-1&&(r=t.indexOf("<",i+1),i=t.indexOf(">",r+1)),r<0)this._stack.pop(),this._processResult(t.substring(e)),e=n;else{var a=t.substring(e,r),o=t.substring(r+1,i);""===o&&(a=t.substring(e,i+1)),this._processResult(a),-1===i?i=r:"/"===t.charAt(r+1)?this._stack.pop():this._addToStack(o),e=i+1}}return this._resultObjectArray},e._attributeToObject=function(t){t=t.trim();var e={},n=/^(color|size)(\s)*=/.exec(t),i="",r=0,a="";if(n){if(i=n[0],""===(t=t.substring(i.length).trim()))return e;switch(r=t.indexOf(" "),i[0]){case"c":e.color=r>-1?t.substring(0,r).trim():t;break;case"s":e.size=parseInt(t)}return r>-1&&(a=t.substring(r+1).trim(),e.event=this._processEventHandler(a)),e}if((n=/^(br(\s)*\/)/.exec(t))&&n[0].length>0&&(i=n[0].trim()).startsWith("br")&&"/"===i[i.length-1])return e.isNewLine=!0,this._resultObjectArray.push({text:"",style:{isNewLine:!0}}),e;var o="";if((n=/^(img(\s)*src(\s)*=[^>]+\/)/.exec(t))&&n[0].length>0&&(i=n[0].trim()).startsWith("img")&&"/"===i[i.length-1]){var s;n=ZK.exec(t);for(var c=!1;n;){if(i=(t=t.substring(t.indexOf(n[0]))).substr(0,n[0].length),s=(r=(o=t.substring(i.length).trim()).indexOf(" "))>-1?o.substr(0,r):o,i=(i=i.replace(/[^a-zA-Z]/g,"").trim()).toLowerCase(),t=o.substring(r).trim(),s.endsWith("/")&&(s=s.slice(0,-1)),"src"===i){switch(s.charCodeAt(0)){case 34:case 39:c=!0,s=s.slice(1,-1)}e.isImage=!0,e.src=s}else if("height"===i)e.imageHeight=parseInt(s);else if("width"===i)e.imageWidth=parseInt(s);else if("align"===i){switch(s.charCodeAt(0)){case 34:case 39:s=s.slice(1,-1)}e.imageAlign=s.toLowerCase()}else"offset"===i?e.imageOffset=s:"click"===i&&(e.event=this._processEventHandler(i+"="+s));e.event&&"param"===i&&(e.event[i]=s.replace(/^"|"$/g,"")),n=ZK.exec(t)}return c&&e.isImage&&this._resultObjectArray.push({text:"",style:e}),{}}if(n=/^(outline(\s)*[^>]*)/.exec(t)){var l={color:"#ffffff",width:1};if(t=n[0].substring("outline".length).trim()){var u,h=/(\s)*color(\s)*=|(\s)*width(\s)*=|(\s)*click(\s)*=|(\s)*param(\s)*=/;for(n=h.exec(t);n;)i=(t=t.substring(t.indexOf(n[0]))).substr(0,n[0].length),u=(r=(o=t.substring(i.length).trim()).indexOf(" "))>-1?o.substr(0,r):o,i=(i=i.replace(/[^a-zA-Z]/g,"").trim()).toLowerCase(),t=o.substring(r).trim(),"click"===i?e.event=this._processEventHandler(i+"="+u):"color"===i?l.color=u:"width"===i&&(l.width=parseInt(u)),e.event&&"param"===i&&(e.event[i]=u.replace(/^"|"$/g,"")),n=h.exec(t)}e.outline=l}if((n=/^(on|u|b|i)(\s)*/.exec(t))&&n[0].length>0){switch(i=n[0],t=t.substring(i.length).trim(),i[0]){case"u":e.underline=!0;break;case"i":e.italic=!0;break;case"b":e.bold=!0}if(""===t)return e;e.event=this._processEventHandler(t)}return e},e._processEventHandler=function(t){for(var e={},n=0,i=!1,r=QK.exec(t);r;){var a=r[0],o="";if(i=!1,'"'===(t=t.substring(a.length).trim()).charAt(0))(n=t.indexOf('"',1))>-1&&(o=t.substring(1,n).trim(),i=!0),n++;else if("'"===t.charAt(0))(n=t.indexOf("'",1))>-1&&(o=t.substring(1,n).trim(),i=!0),n++;else{var s=/(\S)+/.exec(t);n=(o=s?s[0]:"").length}i&&(e[a=a.substring(0,a.length-1).trim()]=o),t=t.substring(n).trim(),r=QK.exec(t)}return e},e._addToStack=function(t){var e=this._attributeToObject(t);if(0===this._stack.length)this._stack.push(e);else{if(e.isNewLine||e.isImage)return;var n=this._stack[this._stack.length-1];for(var i in n)e[i]||(e[i]=n[i]);this._stack.push(e)}},e._processResult=function(t){0!==t.length&&(t=this._escapeSpecialSymbol(t),this._stack.length>0?this._resultObjectArray.push({text:t,style:this._stack[this._stack.length-1]}):this._resultObjectArray.push({text:t}))},e._escapeSpecialSymbol=function(t){for(var e,n=W(this._specialSymbolArray);!(e=n()).done;){var i=e.value,r=i[0],a=i[1];t=t.replace(r,a)}return t},t}()),$K=function(e){return t({LabelOutline:e,LabelOutlineComponent:e}),e}((HY=nl("cc.LabelOutline"),VY=vl(),jY=rl(110),WY=pl(),XY=il(Cq),qY=Al(),YY=Al(),HY(KY=VY(KY=jY(KY=WY(KY=XY(KY=_l(($Y=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return X(e=t.call.apply(t,[this].concat(i))||this,"_color",ZY,V(e)),X(e,"_width",JY,V(e)),e}F(e,t);var n=e.prototype;return n.onEnable=function(){this._updateRenderData()},n.onDisable=function(){this._updateRenderData()},n._updateRenderData=function(){var t=this.node.getComponent(Cq);t&&t.updateRenderData(!0)},L(e,[{key:"color",get:function(){return this._color},set:function(t){this._color!==t&&(this._color.set(t),this._updateRenderData())}},{key:"width",get:function(){return this._width},set:function(t){this._width!==t&&(this._width=t,this._updateRenderData())}}]),e}($u),ZY=q((QY=$Y).prototype,"_color",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new _i(0,0,0,255)}}),JY=q(QY.prototype,"_width",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),q(QY.prototype,"color",[qY],Object.getOwnPropertyDescriptor(QY.prototype,"color"),QY.prototype),q(QY.prototype,"width",[YY],Object.getOwnPropertyDescriptor(QY.prototype,"width"),QY.prototype),KY=QY))||KY)||KY)||KY)||KY)||KY)||KY));i.LabelOutline=$K,function(t){t[t.SIMPLE=0]="SIMPLE",t[t.SLICED=1]="SLICED",t[t.TILED=2]="TILED",t[t.FILLED=3]="FILLED"}(XK||(XK={})),Zt(XK),function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL",t[t.RADIAL=2]="RADIAL"}(qK||(qK={})),Zt(qK),function(t){t[t.CUSTOM=0]="CUSTOM",t[t.TRIMMED=1]="TRIMMED",t[t.RAW=2]="RAW"}(YK||(YK={})),Zt(YK),function(t){t.SPRITE_FRAME_CHANGED="spriteframe-changed"}(KK||(KK={}));var tQ,eQ=function(e){return t({Sprite:e,SpriteComponent:e}),e}((tK=nl("cc.Sprite"),eK=vl(),nK=rl(110),iK=pl(),rK=Bl(fj),aK=Il(),oK=Al(),sK=Bl(uj),cK=Il(),lK=Al(),uK=Bl(XK),hK=Il(),fK=Al(),_K=Bl(qK),pK=Il(),dK=Al(),mK=Il(),gK=Al(),vK=El(),yK=Il(),xK=Al(),SK=El(),TK=Il(),AK=Al(),EK=xl(),CK=Il(),bK=Al(),wK=Il(),PK=Al(),IK=Bl(YK),RK=Il(),DK=Al(),tK(OK=eK(OK=nK(OK=iK((WK=jK=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return X(e=t.call.apply(t,[this].concat(i))||this,"_spriteFrame",NK,V(e)),X(e,"_type",LK,V(e)),X(e,"_fillType",BK,V(e)),X(e,"_sizeMode",FK,V(e)),X(e,"_fillCenter",zK,V(e)),X(e,"_fillStart",UK,V(e)),X(e,"_fillRange",kK,V(e)),X(e,"_isTrimmedMode",GK,V(e)),X(e,"_useGrayscale",HK,V(e)),X(e,"_atlas",VK,V(e)),e}F(e,t);var n=e.prototype;return n.__preload=function(){this.changeMaterialForDefine(),t.prototype.__preload.call(this)},n.onEnable=function(){t.prototype.onEnable.call(this),this._activateMaterial();var e=this._spriteFrame;e&&(this._updateUVs(),this._type===XK.SLICED&&e.on(uj.EVENT_UV_UPDATED,this._updateUVs,this))},n.onDisable=function(){this._spriteFrame&&this._type===XK.SLICED&&this._spriteFrame.off(uj.EVENT_UV_UPDATED,this._updateUVs,this)},n.onDestroy=function(){t.prototype.onDestroy.call(this)},n.changeSpriteFrameFromAtlas=function(t){if(this._atlas){var e=this._atlas.getSpriteFrame(t);this.spriteFrame=e}else console.warn("SpriteAtlas is null.")},n.changeMaterialForDefine=function(){var t,e=this._instanceMaterialType;this._spriteFrame&&(t=this._spriteFrame.texture);var n=!1;if(t instanceof Mm){var i=t.getPixelFormat();n=i===em.RGBA_ETC1||i===em.RGB_A_PVRTC_4BPPV1||i===em.RGB_A_PVRTC_2BPPV1}n&&this.grayscale?this._instanceMaterialType=iX.USE_ALPHA_SEPARATED_AND_GRAY:n?this._instanceMaterialType=iX.USE_ALPHA_SEPARATED:this.grayscale?this._instanceMaterialType=iX.GRAYSCALE:this._instanceMaterialType=iX.ADD_COLOR_AND_TEXTURE,e!==this._instanceMaterialType&&this.updateMaterial()},n._updateBuiltinMaterial=function(){var e=t.prototype._updateBuiltinMaterial.call(this);if(this.spriteFrame&&this.spriteFrame.texture instanceof vT){var n=B({SAMPLE_FROM_RT:!0},e.passes[0].defines),i=new bv;i.initialize({effectAsset:e.effectAsset,defines:n}),e=i}return e},n._render=function(t){t.commitComp(this,this.renderData,this._spriteFrame,this._assembler,null)},n._canRender=function(){if(!t.prototype._canRender.call(this))return!1;var e=this._spriteFrame;return!(!e||!e.texture)},n._flushAssembler=function(){var t=e.Assembler.getAssembler(this);this._assembler!==t&&(this.destroyRenderData(),this._assembler=t),this._renderData||this._assembler&&this._assembler.createData&&(this._renderData=this._assembler.createData(this),this._renderData.material=this.getRenderMaterial(0),this.markForUpdateRenderData(),this.spriteFrame&&this._assembler.updateUVs(this),this._updateColor()),this._spriteFrame&&(this._type===XK.SLICED?this._spriteFrame.on(uj.EVENT_UV_UPDATED,this._updateUVs,this):this._spriteFrame.off(uj.EVENT_UV_UPDATED,this._updateUVs,this))},n._applySpriteSize=function(){if(this._spriteFrame){if(!this._spriteFrame.isDefault)if(YK.RAW===this._sizeMode){var t=this._spriteFrame.originalSize;this.node._uiProps.uiTransformComp.setContentSize(t)}else if(YK.TRIMMED===this._sizeMode){var e=this._spriteFrame.rect;this.node._uiProps.uiTransformComp.setContentSize(e.width,e.height)}this._activateMaterial()}},n._resized=function(){},n._activateMaterial=function(){var t=this._spriteFrame,e=this.getRenderMaterial(0);t&&e&&this.markForUpdateRenderData(),this._renderData&&(this._renderData.material=e)},n._updateUVs=function(){this._assembler&&this._assembler.updateUVs(this)},n._applySpriteFrame=function(t){var e=this._spriteFrame;t&&this._type===XK.SLICED&&t.off(uj.EVENT_UV_UPDATED,this._updateUVs,this),this._updateUVs();var n=!1;e&&(t&&t.texture===e.texture||(n=!0),n&&(this._renderData&&(this._renderData.textureDirty=!0),this.changeMaterialForDefine()),this._applySpriteSize(),this._type===XK.SLICED&&e.on(uj.EVENT_UV_UPDATED,this._updateUVs,this))},L(e,[{key:"spriteAtlas",get:function(){return this._atlas},set:function(t){this._atlas!==t&&(this._atlas=t)}},{key:"spriteFrame",get:function(){return this._spriteFrame},set:function(t){if(this._spriteFrame!==t){var e=this._spriteFrame;this._spriteFrame=t,this.markForUpdateRenderData(!1),this._applySpriteFrame(e)}}},{key:"type",get:function(){return this._type},set:function(t){this._type!==t&&(this._type=t,this._flushAssembler())}},{key:"fillType",get:function(){return this._fillType},set:function(t){this._fillType!==t&&(t===qK.RADIAL||this._fillType===qK.RADIAL?(this.destroyRenderData(),this._renderData=null):this._renderData&&this.markForUpdateRenderData(!0)),this._fillType=t,this._flushAssembler()}},{key:"fillCenter",get:function(){return this._fillCenter},set:function(t){this._fillCenter.x=t.x,this._fillCenter.y=t.y,this._type===XK.FILLED&&this._renderData&&this.markForUpdateRenderData()}},{key:"fillStart",get:function(){return this._fillStart},set:function(t){this._fillStart=Yn(t,0,1),this._type===XK.FILLED&&this._renderData&&(this.markForUpdateRenderData(),this._updateUVs())}},{key:"fillRange",get:function(){return this._fillRange},set:function(t){this._fillRange=Yn(t,-1,1),this._type===XK.FILLED&&this._renderData&&(this.markForUpdateRenderData(),this._updateUVs())}},{key:"trim",get:function(){return this._isTrimmedMode},set:function(t){this._isTrimmedMode!==t&&(this._isTrimmedMode=t,this._type===XK.SIMPLE&&this._renderData&&this.markForUpdateRenderData(!0))}},{key:"grayscale",get:function(){return this._useGrayscale},set:function(t){this._useGrayscale!==t&&(this._useGrayscale=t,this.changeMaterialForDefine(),this.updateMaterial())}},{key:"sizeMode",get:function(){return this._sizeMode},set:function(t){this._sizeMode!==t&&(this._sizeMode=t,t!==YK.CUSTOM&&this._applySpriteSize())}}]),e}(Sq),jK.FillType=qK,jK.Type=XK,jK.SizeMode=YK,jK.EventType=KK,q((MK=WK).prototype,"spriteAtlas",[rK,aK,oK],Object.getOwnPropertyDescriptor(MK.prototype,"spriteAtlas"),MK.prototype),q(MK.prototype,"spriteFrame",[sK,cK,lK],Object.getOwnPropertyDescriptor(MK.prototype,"spriteFrame"),MK.prototype),q(MK.prototype,"type",[uK,hK,fK],Object.getOwnPropertyDescriptor(MK.prototype,"type"),MK.prototype),q(MK.prototype,"fillType",[_K,pK,dK],Object.getOwnPropertyDescriptor(MK.prototype,"fillType"),MK.prototype),q(MK.prototype,"fillCenter",[mK,gK],Object.getOwnPropertyDescriptor(MK.prototype,"fillCenter"),MK.prototype),q(MK.prototype,"fillStart",[vK,yK,xK],Object.getOwnPropertyDescriptor(MK.prototype,"fillStart"),MK.prototype),q(MK.prototype,"fillRange",[SK,TK,AK],Object.getOwnPropertyDescriptor(MK.prototype,"fillRange"),MK.prototype),q(MK.prototype,"trim",[EK,CK,bK],Object.getOwnPropertyDescriptor(MK.prototype,"trim"),MK.prototype),q(MK.prototype,"grayscale",[yl,wK,PK],Object.getOwnPropertyDescriptor(MK.prototype,"grayscale"),MK.prototype),q(MK.prototype,"sizeMode",[IK,RK,DK],Object.getOwnPropertyDescriptor(MK.prototype,"sizeMode"),MK.prototype),NK=q(MK.prototype,"_spriteFrame",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),LK=q(MK.prototype,"_type",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return XK.SIMPLE}}),BK=q(MK.prototype,"_fillType",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return qK.HORIZONTAL}}),FK=q(MK.prototype,"_sizeMode",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return YK.TRIMMED}}),zK=q(MK.prototype,"_fillCenter",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ni(0,0)}}),UK=q(MK.prototype,"_fillStart",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),kK=q(MK.prototype,"_fillRange",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),GK=q(MK.prototype,"_isTrimmedMode",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),HK=q(MK.prototype,"_useGrayscale",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),VK=q(MK.prototype,"_atlas",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),OK=MK))||OK)||OK)||OK)||OK));i.Sprite=eQ;var nQ,iQ,rQ,aQ,oQ,sQ,cQ,lQ,uQ,hQ,fQ,_Q,pQ,dQ,mQ,gQ,vQ,yQ,xQ,SQ,TQ,AQ,EQ,CQ,bQ,wQ,PQ,IQ,RQ,DQ,OQ,MQ,NQ,LQ,BQ,FQ,zQ,UQ,kQ,GQ,HQ,VQ,jQ,WQ,XQ,qQ,YQ,KQ,QQ,ZQ=t("RenderRoot2D",nl("cc.RenderRoot2D")(tQ=rl(100)(tQ=pl()(tQ=il(FW)(tQ=al(tQ=_l(tQ=function(t){function e(){return t.apply(this,arguments)||this}F(e,t);var n=e.prototype;return n.onEnable=function(){i.director.root.batcher2D.addScreen(this)},n.onDisable=function(){i.director.root.batcher2D.removeScreen(this)},n.onDestroy=function(){i.director.root.batcher2D.removeScreen(this)},e}($u))||tQ)||tQ)||tQ)||tQ)||tQ)||tQ),JQ=new di,$Q=Yt({OVERLAY:0,INTERSPERSE:1}),tZ=function(e){return t({Canvas:e,CanvasComponent:e}),e}((nQ=nl("cc.Canvas"),iQ=vl(),rQ=rl(100),aQ=pl(),oQ=Bl(oF),sQ=Al(),cQ=Al(),lQ=Bl(oF),nQ(uQ=iQ(uQ=rQ(uQ=aQ(uQ=_l(uQ=al((q((hQ=function(t){function e(){var e;return X(e=t.call(this)||this,"_cameraComponent",fQ,V(e)),X(e,"_alignCanvasWithScreen",_Q,V(e)),e._thisOnCameraResized=void 0,e._fitDesignResolution=void 0,e._pos=new di,e._renderMode=$Q.OVERLAY,e._thisOnCameraResized=e._onResizeCamera.bind(V(e)),e}F(e,t);var n=e.prototype;return n.__preload=function(){var t=this.getComponent("cc.Widget");t&&t.updateAlignment(),this._cameraComponent&&(this._cameraComponent._createCamera(),this._cameraComponent.node.on(oF.TARGET_TEXTURE_CHANGE,this._thisOnCameraResized)),this._onResizeCamera(),this.node.on(WA.TRANSFORM_CHANGED,this._thisOnCameraResized)},n.onEnable=function(){t.prototype.onEnable.call(this),this._cameraComponent&&this._cameraComponent.node.on(oF.TARGET_TEXTURE_CHANGE,this._thisOnCameraResized)},n.onDisable=function(){t.prototype.onDisable.call(this),this._cameraComponent&&this._cameraComponent.node.off(oF.TARGET_TEXTURE_CHANGE,this._thisOnCameraResized)},n.onDestroy=function(){t.prototype.onDestroy.call(this),this.node.off(WA.TRANSFORM_CHANGED,this._thisOnCameraResized)},n._onResizeCamera=function(){if(this._cameraComponent&&this._alignCanvasWithScreen){if(this._cameraComponent.targetTexture)this._cameraComponent.orthoHeight=YM.height/2;else{var t=ch.windowSize;this._cameraComponent.orthoHeight=t.height/eN.getScaleY()/2}this.node.getWorldPosition(JQ),this._cameraComponent.node.setWorldPosition(JQ.x,JQ.y,1e3)}},n._getViewPriority=function(){if(this._cameraComponent){var t,e=null===(t=this.cameraComponent)||void 0===t?void 0:t.priority;return this._renderMode===$Q.OVERLAY?e|1<<30:e&~(1<<30)}return 0},L(e,[{key:"renderMode",get:function(){return this._renderMode},set:function(t){this._renderMode=t,this._cameraComponent&&(this._cameraComponent.priority=this._getViewPriority())}},{key:"cameraComponent",get:function(){return this._cameraComponent},set:function(t){this._cameraComponent!==t&&(this._cameraComponent=t,this._onResizeCamera())}},{key:"alignCanvasWithScreen",get:function(){return this._alignCanvasWithScreen},set:function(t){this._alignCanvasWithScreen=t,this._onResizeCamera()}}]),e}(ZQ)).prototype,"cameraComponent",[oQ,sQ],Object.getOwnPropertyDescriptor(hQ.prototype,"cameraComponent"),hQ.prototype),q(hQ.prototype,"alignCanvasWithScreen",[cQ],Object.getOwnPropertyDescriptor(hQ.prototype,"alignCanvasWithScreen"),hQ.prototype),fQ=q(hQ.prototype,"_cameraComponent",[lQ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_Q=q(hQ.prototype,"_alignCanvasWithScreen",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),uQ=hQ))||uQ)||uQ)||uQ)||uQ)||uQ)||uQ));i.Canvas=tZ,Ln(t("UIComponent",nl("cc.UIComponent")(pQ=il(FW)(pQ=rl(110)(pQ=al(pQ=_l(pQ=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._lastParent=null,e.stencilStage=TW.DISABLED,e}F(e,t);var n=e.prototype;return n.__preload=function(){this.node._uiProps.uiComp=this},n.onEnable=function(){},n.onDisable=function(){},n.onDestroy=function(){this.node._uiProps.uiComp===this&&(this.node._uiProps.uiComp=null)},n.updateAssembler=function(){},n.postUpdateAssembler=function(){},n.markForUpdateRenderData=function(){},n.setNodeDirty=function(){},n.setTextureDirty=function(){},e}($u))||pQ)||pQ)||pQ)||pQ)||pQ).prototype,"UIComponent",[{name:"_visibility"},{name:"setVisibility"}]),Nn(tZ.prototype,"Canvas.prototype",[{name:"camera",newName:"cameraComponent.camera",customGetter:function(){return this._cameraComponent.camera}},{name:"clearFlag",newName:"cameraComponent.clearFlags",customGetter:function(){return this._cameraComponent?this._cameraComponent.clearFlags:0},customSetter:function(t){this._cameraComponent&&(this._cameraComponent.clearFlags=t)}},{name:"color",newName:"cameraComponent.clearColor",customGetter:function(){return this._cameraComponent?this._cameraComponent.clearColor:_i.BLACK},customSetter:function(t){this._cameraComponent&&(this._cameraComponent.clearColor=t)}},{name:"priority",newName:"cameraComponent.priority",customGetter:function(){return this._cameraComponent?this._cameraComponent.priority:0},customSetter:function(t){this._cameraComponent&&(this._cameraComponent.priority=t)}},{name:"targetTexture",newName:"cameraComponent.targetTexture",customGetter:function(){return this._cameraComponent?this._cameraComponent.targetTexture:null},customSetter:function(t){this._cameraComponent&&(this._cameraComponent.targetTexture=t)}},{name:"visibility",newName:"cameraComponent.visibility",customGetter:function(){return this._cameraComponent?this._cameraComponent.visibility:0}}]),Bn(Sq.prototype,"Renderable2D.prototype",[{name:"srcBlendFactor",suggest:"Please use a custom material to specify blending options instead."},{name:"dstBlendFactor",suggest:"Please use a custom material to specify blending options instead."}]),Bn(FW.prototype,"UITransform.prototype",[{name:"priority",suggest:"Please use setSiblingIndex to change index of the current node in its parent's children array."}]),i.UITransformComponent=FW,Gt.setClassAlias(FW,"cc.UITransformComponent"),Gt.setClassAlias(Sq,"cc.RenderComponent"),i.CanvasComponent=tZ,Gt.setClassAlias(tZ,"cc.CanvasComponent");var eZ=new JK,nZ="RICHTEXT_CHILD",iZ="RICHTEXT_Image_CHILD",rZ=new Ut((function(t){if(!i.isValid(t.node))return!1;var e=t.node.getComponent($K);return e&&(e.width=0),!0}),20),aZ=new Ut((function(t){return i.isValid(t.node)}),10);function oZ(t){return{node:new qC(t),comp:null,lineCount:0,styleIndex:0,imageOffset:"",clickParam:"",clickHandler:"",type:t}}function sZ(t,e){var n;t===nZ?n=rZ._get():t===iZ&&(n=aZ._get());var i=(n=n||oZ(t)).node;return i||(i=new qC(t)),i.hideFlags|=Ye.Flags.DontSave|Ye.Flags.HideInHierarchy,t===iZ?(n.comp=i.getComponent(eQ)||i.addComponent(eQ),n.comp.spriteFrame=e,n.comp.type=eQ.Type.SLICED,n.comp.sizeMode=eQ.SizeMode.CUSTOM):(n.comp=i.getComponent(Cq)||i.addComponent(Cq),n.comp.string=e,n.comp.horizontalAlign=gq.LEFT,n.comp.verticalAlign=vq.TOP),i.setPosition(0,0,0),i._uiProps.uiTransformComp.setAnchorPoint(.5,.5),n.node=i,n.lineCount=0,n.styleIndex=0,n.imageOffset="",n.clickParam="",n.clickHandler="",n}var cZ,lZ=function(e){return t({RichText:e,RichTextComponent:e}),e}((dQ=nl("cc.RichText"),mQ=vl(),gQ=rl(110),vQ=pl(),yQ=Al(),xQ=Bl(gq),SQ=Al(),TQ=Al(),AQ=Al(),EQ=Bl(gj),CQ=Al(),bQ=Al(),wQ=Il(),PQ=Bl(xq),IQ=Al(),RQ=Al(),DQ=Al(),OQ=Bl(fj),MQ=Al(),NQ=Al(),dQ(LQ=mQ(LQ=gQ(LQ=vQ(LQ=_l((QQ=KQ=function(t){function e(){var e;return X(e=t.call(this)||this,"_lineHeight",FQ,V(e)),X(e,"_string",zQ,V(e)),X(e,"_horizontalAlign",UQ,V(e)),X(e,"_fontSize",kQ,V(e)),X(e,"_maxWidth",GQ,V(e)),X(e,"_fontFamily",HQ,V(e)),X(e,"_font",VQ,V(e)),X(e,"_isSystemFontUsed",jQ,V(e)),X(e,"_userDefinedFont",WQ,V(e)),X(e,"_cacheMode",XQ,V(e)),X(e,"_imageAtlas",qQ,V(e)),X(e,"_handleTouchEvent",YQ,V(e)),e._textArray=[],e._segments=[],e._labelSegmentsCache=[],e._linesWidth=[],e._lineCount=1,e._labelWidth=0,e._labelHeight=0,e._layoutDirty=!0,e._lineOffsetX=0,e._updateRichTextStatus=void 0,e._updateRichTextStatus=e._updateRichText,e}F(e,t);var n=e.prototype;return n.onLoad=function(){this.node.on(WA.LAYER_CHANGED,this._applyLayer,this)},n.onEnable=function(){this.handleTouchEvent&&this._addEventListeners(),this._updateRichText(),this._activateChildren(!0)},n.onDisable=function(){this.handleTouchEvent&&this._removeEventListeners(),this._activateChildren(!1)},n.start=function(){this._onTTFLoaded(),this.node.on(WA.ANCHOR_CHANGED,this._updateRichTextPosition,this)},n.onRestore=function(){},n.onDestroy=function(){for(var t,e=W(this._segments);!(t=e()).done;){var n=t.value;n.node.removeFromParent(),n.type===nZ?rZ.put(n):n.type===iZ&&aZ.put(n)}this.node.off(WA.ANCHOR_CHANGED,this._updateRichTextPosition,this),this.node.off(WA.LAYER_CHANGED,this._applyLayer,this)},n._addEventListeners=function(){this.node.on(WA.TOUCH_END,this._onTouchEnded,this)},n._removeEventListeners=function(){this.node.off(WA.TOUCH_END,this._onTouchEnded,this)},n._updateLabelSegmentTextAttributes=function(){var t=this;this._segments.forEach((function(e){t._applyTextAttribute(e)}))},n._createFontLabel=function(t){return sZ(nZ,t)},n._createImage=function(t){return sZ(iZ,t)},n._onTTFLoaded=function(){this._font,this._layoutDirty=!0,this._updateRichText()},n._measureText=function(t,e){var n=this,i=function(e){var i;return 0===n._labelSegmentsCache.length?(i=n._createFontLabel(e),n._labelSegmentsCache.push(i)):(i=n._labelSegmentsCache[0]).node.getComponent(Cq).string=e,i.styleIndex=t,n._applyTextAttribute(i),i.node._uiProps.uiTransformComp.contentSize.width};return e?i(e):i},n._onTouchEnded=function(t){for(var e,n=this,i=this.node.getComponents($u),r=function(){var r=e.value,a=r.clickHandler,o=r.clickParam;a&&n._containsTouchLocation(r,t.touch.getUILocation())&&(i.forEach((function(e){var n=e[a];e.enabledInHierarchy&&n&&n.call(e,t,o)})),t.propagationStopped=!0)},a=W(this._segments);!(e=a()).done;)r()},n._containsTouchLocation=function(t,e){var n=t.node.getComponent(FW);return!!n&&n.getBoundingBoxToWorld().contains(e)},n._resetState=function(){for(var t=this.node.children,e=t.length-1;e>=0;e--){var n=t[e];if(n.name===nZ||n.name===iZ){n.parent===this.node?n.parent=null:t.splice(e,1);var i=oZ(n.name);i.node=n,n.name===nZ?(i.comp=n.getComponent(Cq),rZ.put(i)):(i.comp=n.getComponent(eQ),aZ.put(i))}}t.length=0,this._segments.length=0,this._labelSegmentsCache.length=0,this._linesWidth.length=0,this._lineOffsetX=0,this._lineCount=1,this._labelWidth=0,this._labelHeight=0,this._layoutDirty=!0},n._activateChildren=function(t){for(var e=this.node.children.length-1;e>=0;e--){var n=this.node.children[e];n.name!==nZ&&n.name!==iZ||(n.active=t)}},n._addLabelSegment=function(t,e){var n;if(0===this._labelSegmentsCache.length)n=this._createFontLabel(t);else{var i=(n=this._labelSegmentsCache.pop()).node.getComponent(Cq);i&&(i.string=t)}return n.styleIndex=e,n.lineCount=this._lineCount,n.node._uiProps.uiTransformComp.setAnchorPoint(0,0),n.node.layer=this.node.layer,this.node.addChild(n.node),this._applyTextAttribute(n),this._segments.push(n),n},n._updateRichTextWithMaxWidth=function(t,e,n){var i=e;if(this._lineOffsetX>0&&i+this._lineOffsetX>this._maxWidth)for(var r=0;this._lineOffsetX<=this._maxWidth;){var a=this._getFirstWordLen(t,r,t.length),o=t.substr(r,a),s=this._measureText(n,o);if(!(this._lineOffsetX+s<=this._maxWidth)){if(r>0){var c=t.substr(0,r);this._addLabelSegment(c,n),t=t.substr(r,t.length),i=this._measureText(n,t)}this._updateLineInfo();break}this._lineOffsetX+=s,r+=a}if(i>this._maxWidth)for(var l=qj(t,i,this._maxWidth,this._measureText(n)),u=0;u<l.length;++u){var h=l[u],f=this._addLabelSegment(h,n).node._uiProps.uiTransformComp.contentSize;this._lineOffsetX+=f.width,l.length>1&&u<l.length-1&&this._updateLineInfo()}else this._lineOffsetX+=i,this._addLabelSegment(t,n)},n._isLastComponentCR=function(t){return t.length-1===t.lastIndexOf("\n")},n._updateLineInfo=function(){this._linesWidth.push(this._lineOffsetX),this._lineOffsetX=0,this._lineCount++},n._needsUpdateTextLayout=function(t){if(this._layoutDirty||!this._textArray||!t)return!0;if(this._textArray.length!==t.length)return!0;for(var e=0;e<this._textArray.length;e++){var n=this._textArray[e],i=t[e];if(n.text!==i.text)return!0;var r=n.style,a=i.style;if(r){if(a){if(!!a.outline!=!!r.outline)return!0;if(r.size!==a.size||r.italic!==a.italic||r.isImage!==a.isImage)return!0;if(r.src!==a.src||r.imageAlign!==a.imageAlign||r.imageHeight!==a.imageHeight||r.imageWidth!==a.imageWidth||r.imageOffset!==a.imageOffset)return!0}else if(r.size||r.italic||r.isImage||r.outline)return!0}else if(a&&(a.size||a.italic||a.isImage||a.outline))return!0}return!1},n._addRichTextImageElement=function(t){if(t.style){var e=t.style,n=e.src,i=this._imageAtlas&&n&&this._imageAtlas.getSpriteFrame(n);if(i){var r=this._createImage(i);switch(r.comp,e.imageAlign){case"top":r.node._uiProps.uiTransformComp.setAnchorPoint(0,1);break;case"center":r.node._uiProps.uiTransformComp.setAnchorPoint(0,.5);break;default:r.node._uiProps.uiTransformComp.setAnchorPoint(0,0)}e.imageOffset&&(r.imageOffset=e.imageOffset),r.node.layer=this.node.layer,this.node.addChild(r.node),this._segments.push(r);var a=i.rect.clone(),o=1,s=a.width,c=a.height,l=e.imageWidth||0,u=e.imageHeight||0;u>0?(s*=o=u/c,c*=o):(s*=o=this._lineHeight/c,c*=o),l>0&&(s=l),this._maxWidth>0?(this._lineOffsetX+s>this._maxWidth&&this._updateLineInfo(),this._lineOffsetX+=s):(this._lineOffsetX+=s,this._lineOffsetX>this._labelWidth&&(this._labelWidth=this._lineOffsetX)),r.node._uiProps.uiTransformComp.setContentSize(s,c),r.lineCount=this._lineCount,r.clickHandler="",r.clickParam="";var h=e.event;h&&(r.clickHandler=h.click,r.clickParam=h.param)}else E(4400)}},n._updateRichText=function(){if(this.enabledInHierarchy){var t=eZ.parse(this._string);if(!this._needsUpdateTextLayout(t))return this._textArray=t.slice(),void this._updateLabelSegmentTextAttributes();this._textArray=t.slice(),this._resetState();for(var e,n=!1,i=0;i<this._textArray.length;++i){var r=this._textArray[i],a=r.text;if(void 0!==a){if(""===a){if(r.style&&r.style.isNewLine){this._updateLineInfo();continue}if(r.style&&r.style.isImage&&this._imageAtlas){this._addRichTextImageElement(r);continue}}for(var o=a.split("\n"),s=0;s<o.length;++s){var c=o[s];if(""!==c)if(n=!1,this._maxWidth>0){var l=this._measureText(i,c);this._updateRichTextWithMaxWidth(c,l,i),o.length>1&&s<o.length-1&&this._updateLineInfo()}else e=this._addLabelSegment(c,i),this._lineOffsetX+=e.node._uiProps.uiTransformComp.width,this._lineOffsetX>this._labelWidth&&(this._labelWidth=this._lineOffsetX),o.length>1&&s<o.length-1&&this._updateLineInfo();else{if(this._isLastComponentCR(a)&&s===o.length-1)continue;this._updateLineInfo(),n=!0}}}}n||this._linesWidth.push(this._lineOffsetX),this._maxWidth>0&&(this._labelWidth=this._maxWidth),this._labelHeight=(this._lineCount+Mj)*this._lineHeight,this.node._uiProps.uiTransformComp.setContentSize(this._labelWidth,this._labelHeight),this._updateRichTextPosition(),this._layoutDirty=!1}},n._getFirstWordLen=function(t,e,n){var i=t.charAt(e);if(Vj(i)||jj(i))return 1;for(var r=1,a=e+1;a<n&&!jj(i=t.charAt(a))&&!Vj(i);++a)r++;return r},n._updateRichTextPosition=function(){for(var t=0,e=1,n=this._lineCount,i=this.node._uiProps.uiTransformComp,r=i.anchorX,a=i.anchorY,o=0;o<this._segments.length;++o){var s=this._segments[o],c=s.lineCount;c>e&&(t=0,e=c);var l=this._labelWidth*(.5*this._horizontalAlign-r);switch(this._horizontalAlign){case gq.LEFT:break;case gq.CENTER:l-=this._linesWidth[c-1]/2;break;case gq.RIGHT:l-=this._linesWidth[c-1]}var u=s.node.position;if(s.node.setPosition(t+l,this._lineHeight*(n-c)-this._labelHeight*a,u.z),c===e&&(t+=s.node._uiProps.uiTransformComp.width),s.node.getComponent(eQ)){var h=s.node.position.clone(),f=this._lineHeight,_=this._lineHeight*(1+Mj);switch(s.node._uiProps.uiTransformComp.anchorY){case 1:h.y+=f+(_-f)/2;break;case.5:h.y+=_/2;break;default:h.y+=(_-f)/2}if(s.imageOffset){var p=s.imageOffset.split(",");if(1===p.length&&p[0]){var d=parseFloat(p[0]);Number.isInteger(d)&&(h.y+=d)}else if(2===p.length){var m=parseFloat(p[0]),g=parseFloat(p[1]);Number.isInteger(m)&&(h.x+=m),Number.isInteger(g)&&(h.y+=g)}}s.node.position=h}var v=s.node.getComponent($K);if(v){var y=s.node.position.clone();y.y-=v.width,s.node.position=y}}},n._convertLiteralColorValue=function(t){var e=t.toUpperCase();return _i[e]?_i[e]:(new _i).fromHEX(t)},n._applyTextAttribute=function(t){var e=t.node.getComponent(Cq);if(e){this._resetLabelState(e);var n,i=t.styleIndex;if(this._textArray[i]&&(n=this._textArray[i].style),n){if(e.color=this._convertLiteralColorValue(n.color||"white"),e.isBold=!!n.bold,e.isItalic=!!n.italic,e.isUnderline=!!n.underline,n.outline){var r=t.node.getComponent($K);r||(r=t.node.addComponent($K)),r.color=this._convertLiteralColorValue(n.outline.color),r.width=n.outline.width}e.fontSize=n.size||this._fontSize,t.clickHandler="",t.clickParam="";var a=n.event;a&&(t.clickHandler=a.click||"",t.clickParam=a.param||"")}e.cacheMode=this._cacheMode,this._font instanceof gj&&!this._isSystemFontUsed?e.font=this._font:e.fontFamily=this._fontFamily,e.useSystemFont=this._isSystemFontUsed,e.lineHeight=this._lineHeight,e.updateRenderData(!0);var o=e._assembler;o&&o.updateRenderData(e)}},n._applyLayer=function(){for(var t,e=W(this._segments);!(t=e()).done;)t.value.node.layer=this.node.layer},n._resetLabelState=function(t){t.fontSize=this._fontSize,t.color=_i.WHITE,t.isBold=!1,t.isItalic=!1,t.isUnderline=!1},L(e,[{key:"string",get:function(){return this._string},set:function(t){this._string!==t&&(this._string=t,this._updateRichTextStatus())}},{key:"horizontalAlign",get:function(){return this._horizontalAlign},set:function(t){this.horizontalAlign!==t&&(this._horizontalAlign=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"fontSize",get:function(){return this._fontSize},set:function(t){this._fontSize!==t&&(this._fontSize=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"fontFamily",get:function(){return this._fontFamily},set:function(t){this._fontFamily!==t&&(this._fontFamily=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"font",get:function(){return this._font},set:function(t){this._font!==t&&(this._font=t,this._layoutDirty=!0,this._font?(this.useSystemFont=!1,this._onTTFLoaded()):this.useSystemFont=!0,this._updateRichTextStatus())}},{key:"useSystemFont",get:function(){return this._isSystemFontUsed},set:function(t){this._isSystemFontUsed!==t&&(this._isSystemFontUsed=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"cacheMode",get:function(){return this._cacheMode},set:function(t){this._cacheMode!==t&&(this._cacheMode=t,this._updateRichTextStatus())}},{key:"maxWidth",get:function(){return this._maxWidth},set:function(t){this._maxWidth!==t&&(this._maxWidth=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"lineHeight",get:function(){return this._lineHeight},set:function(t){this._lineHeight!==t&&(this._lineHeight=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"imageAtlas",get:function(){return this._imageAtlas},set:function(t){this._imageAtlas!==t&&(this._imageAtlas=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"handleTouchEvent",get:function(){return this._handleTouchEvent},set:function(t){this._handleTouchEvent!==t&&(this._handleTouchEvent=t,this.enabledInHierarchy&&(this.handleTouchEvent?this._addEventListeners():this._removeEventListeners()))}}]),e}($u),KQ.HorizontalAlign=gq,KQ.VerticalAlign=vq,q((BQ=QQ).prototype,"string",[Rl,yQ],Object.getOwnPropertyDescriptor(BQ.prototype,"string"),BQ.prototype),q(BQ.prototype,"horizontalAlign",[xQ,SQ],Object.getOwnPropertyDescriptor(BQ.prototype,"horizontalAlign"),BQ.prototype),q(BQ.prototype,"fontSize",[TQ],Object.getOwnPropertyDescriptor(BQ.prototype,"fontSize"),BQ.prototype),q(BQ.prototype,"fontFamily",[AQ],Object.getOwnPropertyDescriptor(BQ.prototype,"fontFamily"),BQ.prototype),q(BQ.prototype,"font",[EQ,CQ],Object.getOwnPropertyDescriptor(BQ.prototype,"font"),BQ.prototype),q(BQ.prototype,"useSystemFont",[bQ,wQ],Object.getOwnPropertyDescriptor(BQ.prototype,"useSystemFont"),BQ.prototype),q(BQ.prototype,"cacheMode",[PQ,IQ],Object.getOwnPropertyDescriptor(BQ.prototype,"cacheMode"),BQ.prototype),q(BQ.prototype,"maxWidth",[RQ],Object.getOwnPropertyDescriptor(BQ.prototype,"maxWidth"),BQ.prototype),q(BQ.prototype,"lineHeight",[DQ],Object.getOwnPropertyDescriptor(BQ.prototype,"lineHeight"),BQ.prototype),q(BQ.prototype,"imageAtlas",[OQ,MQ],Object.getOwnPropertyDescriptor(BQ.prototype,"imageAtlas"),BQ.prototype),q(BQ.prototype,"handleTouchEvent",[NQ],Object.getOwnPropertyDescriptor(BQ.prototype,"handleTouchEvent"),BQ.prototype),FQ=q(BQ.prototype,"_lineHeight",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 40}}),zQ=q(BQ.prototype,"_string",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"<color=#00ff00>Rich</color><color=#0fffff>Text</color>"}}),UQ=q(BQ.prototype,"_horizontalAlign",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return gq.LEFT}}),kQ=q(BQ.prototype,"_fontSize",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 40}}),GQ=q(BQ.prototype,"_maxWidth",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),HQ=q(BQ.prototype,"_fontFamily",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"Arial"}}),VQ=q(BQ.prototype,"_font",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),jQ=q(BQ.prototype,"_isSystemFontUsed",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),WQ=q(BQ.prototype,"_userDefinedFont",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),XQ=q(BQ.prototype,"_cacheMode",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return xq.NONE}}),qQ=q(BQ.prototype,"_imageAtlas",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),YQ=q(BQ.prototype,"_handleTouchEvent",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),LQ=BQ))||LQ)||LQ)||LQ)||LQ)||LQ));i.RichText=lZ;var uZ=function(e){return t({UIMeshRenderer:e,UIModelComponent:e}),e}(nl("cc.UIMeshRenderer")(cZ=vl()(cZ=rl(110)(cZ=pl()(cZ=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._models=null,e._modelComponent=null,e.stencilStage=TW.DISABLED,e}F(e,t);var n=e.prototype;return n.__preload=function(){this.node._uiProps.uiComp=this},n.onLoad=function(){this.node._uiProps.uiTransformComp||this.node.addComponent("cc.UITransform"),this._modelComponent=this.getComponent("cc.RenderableComponent"),this._modelComponent?this._models=this._modelComponent._collectModels():console.warn("node '"+(this.node&&this.node.name)+"' doesn't have any renderable component")},n.onDestroy=function(){this.node._uiProps.uiComp===this&&(this.node._uiProps.uiComp=null),this._modelComponent=this.getComponent("cc.RenderableComponent"),this._modelComponent&&(this._modelComponent._sceneGetter=null,this._models=null)},n.updateAssembler=function(t){if(this._models){this._modelComponent._detachFromScene();for(var e,n=W(this._models);!(e=n()).done;){var i=e.value;t.commitModel.call(t,this,i,this._modelComponent.material)}return!0}return!1},n.postUpdateAssembler=function(){},n.update=function(){this._fitUIRenderQueue()},n._fitUIRenderQueue=function(){if(this._modelComponent)for(var t=this._modelComponent.sharedMaterials.length,e=0;e<t;e++){var n=this._modelComponent.getMaterialInstance(e);if(null!=n)for(var i=n.passes,r=i.length,a=0;a<r;a++)i[a]._priority=Bp.MAX-11,n.recompileShaders({CC_FORCE_FORWARD_SHADING:!0},a)}},n.markForUpdateRenderData=function(){},n.setNodeDirty=function(){},n.setTextureDirty=function(){},L(e,[{key:"modelComponent",get:function(){return this._modelComponent}}]),e}($u))||cZ)||cZ)||cZ)||cZ);i.UIMeshRenderer=uZ;var hZ,fZ,_Z,pZ,dZ,mZ,gZ,vZ,yZ,xZ,SZ,TZ,AZ,EZ,CZ,bZ,wZ,PZ,IZ,RZ,DZ,OZ,MZ,NZ,LZ,BZ,FZ,zZ,UZ,kZ=Np.Enum.NONE|Np.Enum.UI_3D,GZ=t("UIDrawBatch",function(){function t(){this.bufferBatch=null,this.camera=null,this.renderScene=null,this.model=null,this.texture=null,this.sampler=null,this.useLocalData=null,this.isStatic=!1,this.textureHash=0,this.samplerHash=0,this._passes=[],this._shaders=[],this._visFlags=kZ,this._inputAssembler=null,this._descriptorSet=null}var e=t.prototype;return e.destroy=function(){this._passes=[]},e.clear=function(){this.bufferBatch=null,this.inputAssembler=null,this.descriptorSet=null,this.camera=null,this.texture=null,this.sampler=null,this.textureHash=0,this.samplerHash=0,this.model=null,this.isStatic=!1,this.useLocalData=null,this.visFlags=kZ,this.renderScene=null},e.fillPasses=function(t,e,n,r,a,o){if(t){var s=t.passes;if(!s)return;var c=0;this._shaders.length=s.length;for(var l=0;l<s.length;l++){this._passes[l]||(this._passes[l]=new Hg(i.director.root));var u=s[l],h=this._passes[l];u.update(),e||(e=u.depthStencilState,n=0),r||(r=u.blendState,a=0),-1===a&&(a=0),c=n<<16|a,h._initPassFromTarget(u,e,r,c),this._shaders[l]=h.getShaderVariant(o)}}},L(t,[{key:"native",get:function(){return this._nativeObj}},{key:"inputAssembler",get:function(){return this._inputAssembler},set:function(t){this._inputAssembler=t}},{key:"descriptorSet",get:function(){return this._descriptorSet},set:function(t){this._descriptorSet=t}},{key:"visFlags",get:function(){return this._visFlags},set:function(t){this._visFlags=t}},{key:"passes",get:function(){return this._passes}},{key:"shaders",get:function(){return this._shaders}}]),t}()),HZ=function(e){return t({UIStaticBatch:e,UIStaticBatchComponent:e}),e}((hZ=nl("cc.UIStaticBatch"),fZ=vl(),_Z=pl(),pZ=rl(110),dZ=xl(),hZ(mZ=fZ(mZ=_Z(mZ=pZ((q((gZ=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._init=!1,e._bufferAccessor=null,e._dirty=!0,e._uiDrawBatchList=[],e}F(e,t);var n=e.prototype;return n.onLoad=function(){},n.onDestroy=function(){},n.updateAssembler=function(){},n.postUpdateAssembler=function(){},n.markAsDirty=function(){},n._requireDrawBatch=function(){var t=new GZ;return t.isStatic=!0,this._uiDrawBatchList.push(t),t},n._clearData=function(){if(this._bufferAccessor){this._bufferAccessor.reset();for(var t=this._getBatcher(),e=0;e<this._uiDrawBatchList.length;e++)this._uiDrawBatchList[e].destroy(t)}this._uiDrawBatchList.length=0,this._init=!1},n._getBatcher=function(){return WM.root&&WM.root.batcher2D?WM.root.batcher2D:(E(9301),null)},L(e,[{key:"color",get:function(){return this._color},set:function(t){this._color!==t&&this._color.set(t)}},{key:"drawBatchList",get:function(){return this._uiDrawBatchList}}]),e}(Sq)).prototype,"color",[Xl,dZ],Object.getOwnPropertyDescriptor(gZ.prototype,"color"),gZ.prototype),mZ=gZ))||mZ)||mZ)||mZ)||mZ)),VZ=t("LabelShadow",(vZ=nl("cc.LabelShadow"),yZ=vl(),xZ=rl(110),SZ=pl(),TZ=il(Cq),AZ=Al(),EZ=Al(),CZ=Al(),vZ(bZ=yZ(bZ=xZ(bZ=SZ(bZ=TZ(bZ=_l((DZ=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return X(e=t.call.apply(t,[this].concat(i))||this,"_color",PZ,V(e)),X(e,"_offset",IZ,V(e)),X(e,"_blur",RZ,V(e)),e}F(e,t);var n=e.prototype;return n.onEnable=function(){this._updateRenderData()},n.onDisable=function(){this._updateRenderData()},n._updateRenderData=function(){var t=this.node.getComponent(Cq);t&&t.updateRenderData(!0)},L(e,[{key:"color",get:function(){return this._color},set:function(t){this._color!==t&&(this._color.set(t),this._updateRenderData())}},{key:"offset",get:function(){return this._offset},set:function(t){this._offset=t,this._updateRenderData()}},{key:"blur",get:function(){return this._blur},set:function(t){this._blur=t,this._updateRenderData()}}]),e}($u),PZ=q((wZ=DZ).prototype,"_color",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new _i(0,0,0,255)}}),IZ=q(wZ.prototype,"_offset",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ni(2,2)}}),RZ=q(wZ.prototype,"_blur",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),q(wZ.prototype,"color",[AZ],Object.getOwnPropertyDescriptor(wZ.prototype,"color"),wZ.prototype),q(wZ.prototype,"offset",[EZ],Object.getOwnPropertyDescriptor(wZ.prototype,"offset"),wZ.prototype),q(wZ.prototype,"blur",[CZ],Object.getOwnPropertyDescriptor(wZ.prototype,"blur"),wZ.prototype),bZ=wZ))||bZ)||bZ)||bZ)||bZ)||bZ)||bZ)),jZ=function(e){return t({UIOpacity:e,UIOpacityComponent:e}),e}((OZ=nl("cc.UIOpacity"),MZ=vl(),NZ=rl(110),LZ=pl(),BZ=Al(),OZ(FZ=MZ(FZ=NZ(FZ=LZ(FZ=_l((q((zZ=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return X(e=t.call.apply(t,[this].concat(i))||this,"_opacity",UZ,V(e)),e}F(e,t);var n=e.prototype;return n.onEnable=function(){this.node._uiProps.localOpacity=this._opacity/255},n.onDisable=function(){this.node._uiProps.localOpacity=1},L(e,[{key:"opacity",get:function(){return this._opacity},set:function(t){this._opacity!==t&&(t=he(t,0,255),this._opacity=t,this.node._uiProps.localOpacity=t/255)}}]),e}($u)).prototype,"opacity",[yl,BZ],Object.getOwnPropertyDescriptor(zZ.prototype,"opacity"),zZ.prototype),UZ=q(zZ.prototype,"_opacity",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 255}}),FZ=zZ))||FZ)||FZ)||FZ)||FZ)||FZ));i.MaskComponent=GY,Gt.setClassAlias(GY,"cc.MaskComponent"),i.LabelComponent=Cq,Gt.setClassAlias(Cq,"cc.LabelComponent"),i.LabelOutlineComponent=$K,Gt.setClassAlias($K,"cc.LabelOutlineComponent"),i.RichTextComponent=lZ,Gt.setClassAlias(lZ,"cc.RichTextComponent"),i.SpriteComponent=eQ,Gt.setClassAlias(eQ,"cc.SpriteComponent"),i.UIModelComponent=uZ,Gt.setClassAlias(uZ,"cc.UIModelComponent"),i.GraphicsComponent=LY,Gt.setClassAlias(LY,"cc.GraphicsComponent"),Gt.setClassAlias(HZ,"cc.UIStaticBatchComponent"),Gt.setClassAlias(jZ,"cc.UIOpacityComponent");var WZ=function(t,e,n){this.i=void 0,this.x=void 0,this.y=void 0,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1,this.i=t,this.x=e,this.y=n};function XZ(t,e,n,i,r){var a=0,o=null;if(r===function(t,e,n,i){for(var r=0,a=e,o=n-i;a<n;a+=i)r+=(t[o]-t[a])*(t[a+1]+t[o+1]),o=a;return r}(t,e,n,i)>0)for(a=e;a<n;a+=i)o=uJ(a,t[a],t[a+1],o);else for(a=n-i;a>=e;a-=i)o=uJ(a,t[a],t[a+1],o);return o&&oJ(o,o.next)&&(hJ(o),o=o.next),o}function qZ(t,e){if(void 0===e&&(e=null),!t)return t;e||(e=t);var n=t,i=!1;do{if(i=!1,n.steiner||!oJ(n,n.next)&&0!==aJ(n.prev,n,n.next))n=n.next;else{if(hJ(n),(n=e=n.prev)===n.next)return null;i=!0}}while(i||n!==e);return e}function YZ(t,e,n,i,r,a,o){if(void 0===o&&(o=0),t){!o&&a&&function(t,e,n,i){var r=t;do{null===r.z&&(r.z=eJ(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){var e=0,n=null,i=null,r=null,a=null,o=0,s=0,c=0,l=1;do{for(n=t,t=null,a=null,o=0;n;){for(o++,i=n,s=0,e=0;e<l&&(s++,i=i.nextZ);e++);for(c=l;s>0||c>0&&i;)0===s?(r=i,i=i.nextZ,c--):0!==c&&i?n.z<=i.z?(r=n,n=n.nextZ,s--):(r=i,i=i.nextZ,c--):(r=n,n=n.nextZ,s--),a?a.nextZ=r:t=r,r.prevZ=a,a=r;n=i}a.nextZ=null,l*=2}while(o>1)}(r)}(t,i,r,a);for(var s=t,c=null,l=null;t.prev!==t.next;)if(c=t.prev,l=t.next,a?QZ(t,i,r,a):KZ(t))e.push(c.i/n),e.push(t.i/n),e.push(l.i/n),hJ(t),t=l.next,s=l.next;else if((t=l)===s){o?1===o?YZ(t=ZZ(t,e,n),e,n,i,r,a,2):2===o&&JZ(t,e,n,i,r,a):YZ(qZ(t),e,n,i,r,a,1);break}}}function KZ(t){var e=t.prev,n=t,i=t.next;if(aJ(e,n,i)>=0)return!1;for(var r=t.next.next;r!==t.prev;){if(iJ(e.x,e.y,n.x,n.y,i.x,i.y,r.x,r.y)&&aJ(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function QZ(t,e,n,i){var r=t.prev,a=t,o=t.next;if(aJ(r,a,o)>=0)return!1;for(var s=r.x<a.x?r.x<o.x?r.x:o.x:a.x<o.x?a.x:o.x,c=r.y<a.y?r.y<o.y?r.y:o.y:a.y<o.y?a.y:o.y,l=r.x>a.x?r.x>o.x?r.x:o.x:a.x>o.x?a.x:o.x,u=r.y>a.y?r.y>o.y?r.y:o.y:a.y>o.y?a.y:o.y,h=eJ(s,c,e,n,i),f=eJ(l,u,e,n,i),_=t.nextZ;_&&_.z<=f;){if(_!==t.prev&&_!==t.next&&iJ(r.x,r.y,a.x,a.y,o.x,o.y,_.x,_.y)&&aJ(_.prev,_,_.next)>=0)return!1;_=_.nextZ}for(_=t.prevZ;_&&_.z>=h;){if(_!==t.prev&&_!==t.next&&iJ(r.x,r.y,a.x,a.y,o.x,o.y,_.x,_.y)&&aJ(_.prev,_,_.next)>=0)return!1;_=_.prevZ}return!0}function ZZ(t,e,n){var i=t;do{var r=i.prev,a=i.next.next;!oJ(r,a)&&sJ(r,i,i.next,a)&&cJ(r,a)&&cJ(a,r)&&(e.push(r.i/n),e.push(i.i/n),e.push(a.i/n),hJ(i),hJ(i.next),i=t=a),i=i.next}while(i!==t);return i}function JZ(t,e,n,i,r,a){var o=t;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&rJ(o,s)){var c=lJ(o,s);return o=qZ(o,o.next),c=qZ(c,c.next),YZ(o,e,n,i,r,a),void YZ(c,e,n,i,r,a)}s=s.next}o=o.next}while(o!==t)}function $Z(t,e){return t.x-e.x}function tJ(t,e){if(e=function(t,e){var n=e,i=t.x,r=t.y,a=-1/0,o=null;do{if(r<=n.y&&r>=n.next.y){var s=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=i&&s>a){if(a=s,s===i){if(r===n.y)return n;if(r===n.next.y)return n.next}o=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!o)return null;if(i===a)return o.prev;var c,l=o,u=o.x,h=o.y,f=1/0;for(n=o.next;n!==l;)i>=n.x&&n.x>=u&&iJ(r<h?i:a,r,u,h,r<h?a:i,r,n.x,n.y)&&((c=Math.abs(r-n.y)/(i-n.x))<f||c===f&&n.x>o.x)&&cJ(n,t)&&(o=n,f=c),n=n.next;return o}(t,e)){var n=lJ(e,t);qZ(n,n.next)}}function eJ(t,e,n,i,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)/r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)/r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function nJ(t){var e=t,n=t;do{e.x<n.x&&(n=e),e=e.next}while(e!==t);return n}function iJ(t,e,n,i,r,a,o,s){return(r-o)*(e-s)-(t-o)*(a-s)>=0&&(t-o)*(i-s)-(n-o)*(e-s)>=0&&(n-o)*(a-s)-(r-o)*(i-s)>=0}function rJ(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&sJ(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&cJ(t,e)&&cJ(e,t)&&function(t,e){var n=t,i=!1,r=(t.x+e.x)/2,a=(t.y+e.y)/2;do{n.y>a!=n.next.y>a&&r<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==t);return i}(t,e)}function aJ(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function oJ(t,e){return t.x===e.x&&t.y===e.y}function sJ(t,e,n,i){return!!(oJ(t,e)&&oJ(n,i)||oJ(t,i)&&oJ(n,e))||aJ(t,e,n)>0!=aJ(t,e,i)>0&&aJ(n,i,t)>0!=aJ(n,i,e)>0}function cJ(t,e){return aJ(t.prev,t,t.next)<0?aJ(t,e,t.next)>=0&&aJ(t,t.prev,e)>=0:aJ(t,e,t.prev)<0||aJ(t,t.next,e)<0}function lJ(t,e){var n=new WZ(t.i,t.x,t.y),i=new WZ(e.i,e.x,e.y),r=t.next,a=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,i.next=n,n.prev=i,a.next=i,i.prev=a,i}function uJ(t,e,n,i){var r=new WZ(t,e,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function hJ(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function fJ(t,e,n){n=n||3;var i=e?e.length:0,r=i?e[0]*n:t.length,a=XZ(t,0,r,n,!0),o=[];if(!a)return o;var s=0,c=0,l=0,u=0,h=0,f=0,_=0;if(i&&(a=function(t,e,n,i){var r,a=[],o=0,s=null;for(o=0,r=e.length;o<r;o++)(s=XZ(t,e[o]*i,o<r-1?e[o+1]*i:t.length,i,!1))&&(s===s.next&&(s.steiner=!0),a.push(nJ(s)));if(a.sort($Z),!n)return n;for(o=0;o<a.length;o++)tJ(a[o],n),n=qZ(n,n.next);return n}(t,e,a,n)),t.length>80*n){s=l=t[0],c=u=t[1];for(var p=n;p<r;p+=n)(h=t[p])<s&&(s=h),(f=t[p+1])<c&&(c=f),h>l&&(l=h),f>u&&(u=f);_=Math.max(l-s,u-c)}return YZ(a,o,n,s,c,_),o}for(var _J=Math.PI,pJ=Math.min,dJ=Math.max,mJ=Math.ceil,gJ=Math.acos,vJ=Math.cos,yJ=Math.sin,xJ=Math.atan2,SJ=null,TJ=null,AJ=new _i,EJ=[],CJ=0;CJ<4;CJ++)EJ.push(new di);function bJ(t,e,n){return t<e?e:t>n?n:t}var wJ={useModel:!0,updateRenderData:function(){},fillBuffers:function(){},renderIA:function(){},getRenderData:function(t,e){if(!TJ)return null;var n=TJ.getRenderDataList(),i=n[TJ.dataOffset];if(!i)return null;var r=i,a=r?r.vertexStart+e:0;return(a>65535||3*a>131070)&&(++TJ.dataOffset,TJ.dataOffset<n.length?i=n[TJ.dataOffset]:(i=TJ.requestRenderData(),n[TJ.dataOffset]=i),r=i),r&&r.vertexCount<a&&r.request(e,3*e),i},stroke:function(t){_i.copy(AJ,t.strokeColor),t.impl&&(this._flattenPaths(t.impl),this._expandStroke(t),t.impl.updatePathOffset=!0,this.end(t))},fill:function(t){_i.copy(AJ,t.fillColor),this._expandFill(t),t.impl&&(t.impl.updatePathOffset=!0),this.end(t)},end:function(t){t.markForUpdateRenderData()},_expandStroke:function(t){var e,n,i,r,a=.5*t.lineWidth,o=t.lineCap,s=t.lineJoin,c=t.miterLimit;if(TJ=t.impl){var l=(e=a,n=_J,i=TJ.tessTol,r=2*gJ(e/(e+i)),dJ(2,mJ(n/r)));this._calculateJoins(TJ,a,s,c);for(var u=TJ.paths,h=0,f=TJ.pathOffset,_=TJ.pathLength;f<_;f++){var p=u[f],d=p.points.length;s===Aq.ROUND?h+=2*(d+p.bevel*(l+2)+1):h+=2*(d+5*p.bevel+1),p.closed||(o===Tq.ROUND?h+=2*(2*l+2):h+=12)}var m=SJ=this.getRenderData(t,h);if(m){for(var g=m.vData,v=m.iData,y=TJ.pathOffset,x=TJ.pathLength;y<x;y++){var S=u[y],T=S.points,A=T.length,E=m.vertexStart,C=void 0,b=void 0,w=0,P=0,I=S.closed;if(I?(C=T[A-1],b=T[0],w=0,P=A):(C=T[0],b=T[1],w=1,P=A-1),b=b||C,!I){var R=new IY(b.x,b.y);R.subtract(C),R.normalize();var D=R.x,O=R.y;o===Tq.BUTT?this._buttCapStart(C,D,O,a,0):o===Tq.SQUARE?this._buttCapStart(C,D,O,a,a):o===Tq.ROUND&&this._roundCapStart(C,D,O,a,l)}for(var M=w;M<P;++M)s===Aq.ROUND?this._roundJoin(C,b,a,a,l):0!=(b.flags&(Eq.PT_BEVEL|Eq.PT_INNERBEVEL))?this._bevelJoin(C,b,a,a):(this._vSet(b.x+b.dmx*a,b.y+b.dmy*a,1),this._vSet(b.x-b.dmx*a,b.y-b.dmy*a,-1)),C=b,b=T[M+1];if(I){var N=8*E;this._vSet(g[N],g[N+1],1),this._vSet(g[N+8],g[N+8+1],-1)}else{var L=new IY(b.x,b.y);L.subtract(C),L.normalize();var B=L.x,F=L.y;o===Tq.BUTT?this._buttCapEnd(b,B,F,a,0):o===Tq.SQUARE?this._buttCapEnd(b,B,F,a,a):o===Tq.ROUND&&this._roundCapEnd(b,B,F,a,l)}for(var z=m.indexStart,U=E+2,k=m.vertexStart;U<k;U++)v[z++]=U-2,v[z++]=U-1,v[z++]=U;m.indexStart=z}SJ=null,TJ=null}}},_expandFill:function(t){if(TJ=t.impl){for(var e=TJ.paths,n=0,i=TJ.pathOffset,r=TJ.pathLength;i<r;i++)n+=e[i].points.length;var a=SJ=this.getRenderData(t,n);if(a){for(var o=a,s=o.vData,c=o.iData,l=TJ.pathOffset,u=TJ.pathLength;l<u;l++){var h=e[l],f=h.points,_=f.length;if(0!==_){for(var p=a.vertexStart,d=0;d<_;++d)this._vSet(f[d].x,f[d].y);var m=a.indexStart;if(h.complex){for(var g=[],v=p,y=a.vertexStart;v<y;v++){var x=8*v;g.push(s[x++]),g.push(s[x++]),g.push(s[x++])}var S=fJ(g,null,3);if(!S||0===S.length)continue;for(var T=0,A=S.length;T<A;T++)c[m++]=S[T]+p}else for(var E=p,C=p+2,b=o.vertexStart;C<b;C++)c[m++]=E,c[m++]=C-1,c[m++]=C;o.indexStart=m}}SJ=null,TJ=null}}},_calculateJoins:function(t,e,n,i){var r=0;e>0&&(r=1/e);for(var a=t.paths,o=t.pathOffset,s=t.pathLength;o<s;o++){var c=a[o],l=c.points,u=l.length,h=l[u-1],f=l[0];c.bevel=0;for(var _=0;_<u;_++){var p,d,m=h.dy,g=-h.dx,v=f.dy,y=-f.dx;if(f.dmx=.5*(m+v),f.dmy=.5*(g+y),(p=f.dmx*f.dmx+f.dmy*f.dmy)>1e-6){var x=1/p;x>600&&(x=600),f.dmx*=x,f.dmy*=x}f.dx*h.dy-h.dx*f.dy>0&&(f.flags|=Eq.PT_LEFT),p*(d=dJ(11,pJ(h.len,f.len)*r))*d<1&&(f.flags|=Eq.PT_INNERBEVEL),f.flags&Eq.PT_CORNER&&(p*i*i<1||n===Aq.BEVEL||n===Aq.ROUND)&&(f.flags|=Eq.PT_BEVEL),0!=(f.flags&(Eq.PT_BEVEL|Eq.PT_INNERBEVEL))&&c.bevel++,h=f,f=l[_+1]}}},_flattenPaths:function(t){for(var e=t.paths,n=t.pathOffset,i=t.pathLength;n<i;n++){var r=e[n],a=r.points,o=a[a.length-1],s=a[0];a.length>2&&o.equals(s)&&(r.closed=!0,a.pop(),o=a[a.length-1]);for(var c=0,l=a.length;c<l;c++){var u=new IY(s.x,s.y);u.subtract(o),o.len=u.length(),(u.x||u.y)&&u.normalize(),o.dx=u.x,o.dy=u.y,o=s,s=a[c+1]}}},_chooseBevel:function(t,e,n,i){var r=n.x,a=n.y,o=0,s=0,c=0,l=0;return 0!==t?(o=r+e.dy*i,s=a-e.dx*i,c=r+n.dy*i,l=a-n.dx*i):(o=c=r+n.dmx*i,s=l=a+n.dmy*i),[o,s,c,l]},_buttCapStart:function(t,e,n,i,r){var a=t.x-e*r,o=t.y-n*r,s=n,c=-e;this._vSet(a+s*i,o+c*i,1),this._vSet(a-s*i,o-c*i,-1)},_buttCapEnd:function(t,e,n,i,r){var a=t.x+e*r,o=t.y+n*r,s=n,c=-e;this._vSet(a+s*i,o+c*i,1),this._vSet(a-s*i,o-c*i,-1)},_roundCapStart:function(t,e,n,i,r){for(var a=t.x,o=t.y,s=n,c=-e,l=0;l<r;l++){var u=l/(r-1)*_J,h=vJ(u)*i,f=yJ(u)*i;this._vSet(a-s*h-e*f,o-c*h-n*f,1),this._vSet(a,o,0)}this._vSet(a+s*i,o+c*i,1),this._vSet(a-s*i,o-c*i,-1)},_roundCapEnd:function(t,e,n,i,r){var a=t.x,o=t.y,s=n,c=-e;this._vSet(a+s*i,o+c*i,1),this._vSet(a-s*i,o-c*i,-1);for(var l=0;l<r;l++){var u=l/(r-1)*_J,h=vJ(u)*i,f=yJ(u)*i;this._vSet(a,o,0),this._vSet(a-s*h+e*f,o-c*h+n*f,1)}},_roundJoin:function(t,e,n,i,r){var a=t.dy,o=-t.dx,s=e.dy,c=-e.dx,l=e.x,u=e.y;if(0!=(e.flags&Eq.PT_LEFT)){var h=this._chooseBevel(e.flags&Eq.PT_INNERBEVEL,t,e,n),f=h[0],_=h[1],p=h[2],d=h[3],m=xJ(-o,-a),g=xJ(-c,-s);g>m&&(g-=2*_J),this._vSet(f,_,1),this._vSet(l-a*i,e.y-o*i,-1);for(var v=bJ(mJ((m-g)/_J)*r,2,r),y=0;y<v;y++){var x=m+y/(v-1)*(g-m),S=l+vJ(x)*i,T=u+yJ(x)*i;this._vSet(l,u,0),this._vSet(S,T,-1)}this._vSet(p,d,1),this._vSet(l-s*i,u-c*i,-1)}else{var A=this._chooseBevel(e.flags&Eq.PT_INNERBEVEL,t,e,-i),E=A[0],C=A[1],b=A[2],w=A[3],P=xJ(o,a),I=xJ(c,s);I<P&&(I+=2*_J),this._vSet(l+a*i,u+o*i,1),this._vSet(E,C,-1);for(var R=bJ(mJ((I-P)/_J)*r,2,r),D=0;D<R;D++){var O=P+D/(R-1)*(I-P),M=l+vJ(O)*n,N=u+yJ(O)*n;this._vSet(M,N,1),this._vSet(l,u,0)}this._vSet(l+s*i,u+c*i,1),this._vSet(b,w,-1)}},_bevelJoin:function(t,e,n,i){var r=0,a=0,o=0,s=0,c=0,l=0,u=0,h=0,f=t.dy,_=-t.dx,p=e.dy,d=-e.dx;if(e.flags&Eq.PT_LEFT){var m=this._chooseBevel(e.flags&Eq.PT_INNERBEVEL,t,e,n);c=m[0],l=m[1],u=m[2],h=m[3],this._vSet(c,l,1),this._vSet(e.x-f*i,e.y-_*i,-1),this._vSet(u,h,1),this._vSet(e.x-p*i,e.y-d*i,-1)}else{var g=this._chooseBevel(e.flags&Eq.PT_INNERBEVEL,t,e,-i);r=g[0],a=g[1],o=g[2],s=g[3],this._vSet(e.x+f*n,e.y+_*n,1),this._vSet(r,a,-1),this._vSet(e.x+p*n,e.y+d*n,1),this._vSet(o,s,-1)}},_vSet:function(t,e,n){if(void 0===n&&(n=0),SJ){var i=SJ,r=8*i.vertexStart,a=i.vData;a[r++]=t,a[r++]=e,a[r++]=0,_i.toArray(a,AJ,r),r+=4,a[r++]=n,i.vertexStart++}}},PJ=t("graphicsAssembler",{getAssembler:function(){return wJ}});LY.Assembler=PJ;var IJ=function(){this.char="",this.valid=!0,this.x=0,this.y=0,this.line=0,this.hash=""},RJ=new Vi,DJ=null,OJ=null,MJ=[],NJ=[],LJ=[],BJ=[],FJ=new Gi,zJ=new Gi,UJ=new Ni,kJ=null,GJ=0,HJ=0,VJ=0,jJ=0,WJ=0,XJ=1,qJ=null,YJ="",KJ=0,QJ=0,ZJ=0,JJ=0,$J=0,t$=0,e$=0,n$=!1,i$=0,r$=0,a$=0,o$={updateRenderData:function(t){t.renderData&&DJ!==t&&(t.renderData.vertDirty&&(OJ=(DJ=t).node._uiProps.uiTransformComp,this._updateFontFamily(t),this._updateProperties(t),this._updateLabelInfo(t),this._updateContent(),DJ.actualFontSize=KJ,OJ.setContentSize(zJ),this.updateUVs(t),DJ.renderData.vertDirty=!1,DJ.markForUpdateRenderData(!1),DJ=null,this._resetProperties()),t.spriteFrame&&t.renderData.updateRenderData(t,t.spriteFrame))},updateUVs:function(t){for(var e=t.renderData,n=e.chunk.vb,i=e.vertexCount,r=e.data,a=3,o=0;o<i;o++){var s=r[o];n[a]=s.u,n[a+1]=s.v,a+=9}},_updateFontScale:function(){XJ=KJ/QJ},_updateFontFamily:function(t){var e=t.font;qJ=e.spriteFrame,kJ=e.fntConfig,eW.fontAtlas=e.fontDefDictionary,rj.packToDynamicAtlas(t,qJ)},_updateLabelInfo:function(){eW.hash="",eW.margin=0},_updateProperties:function(t){YJ=t.string.toString(),KJ=t.fontSize,QJ=kJ?kJ.fontSize:t.fontSize,ZJ=t.horizontalAlign,JJ=t.verticalAlign,$J=t.spacingX,e$=t.overflow,t$=t._lineHeight;var e=OJ.contentSize;zJ.width=e.width,zJ.height=e.height,e$===yq.NONE?(n$=!1,zJ.width+=2*eW.margin,zJ.height+=2*eW.margin):e$===yq.RESIZE_HEIGHT?(n$=!0,zJ.height+=2*eW.margin):n$=t.enableWrapText,eW.lineHeight=t$,eW.fontSize=KJ,this._setupBMFontOverflowMetrics()},_resetProperties:function(){kJ=null,qJ=null,eW.hash="",eW.margin=0},_updateContent:function(){this._updateFontScale(),this._computeHorizontalKerningForText(),this._alignText()},_computeHorizontalKerningForText:function(){for(var t=YJ,e=t.length,n=kJ.kerningDict,i=MJ,r=-1,a=0;a<e;++a){var o=t.charCodeAt(a),s=n[r<<16|65535&o]||0;i[a]=a<e-1?s:0,r=o}},_multilineTextWrap:function(t){for(var e=YJ.length,n=0,i=0,r=0,a=0,o=0,s=0,c=0,l=null,u=0;u<e;){var h=YJ.charAt(u);if("\n"!==h){for(var f=t(YJ,u,e),_=s,p=c,d=o,m=i,g=!1,v=0;v<f;++v){var y=u+v;if("\r"!==(h=YJ.charAt(y)))if(l=eW.fontAtlas.getLetterDefinitionForChar(h,eW)){var x=m+l.offsetX*XJ-eW.margin;if(n$&&a$>0&&i>0&&x+l.w*XJ>a$&&!jj(h)){LJ.push(o),o=0,n++,i=0,r-=t$*this._getFontScale()+0,g=!0;break}UJ.x=x,UJ.y=r-l.offsetY*XJ,this._recordLetterInfo(UJ,h,y,n),y+1<MJ.length&&y<e-1&&(m+=MJ[y+1]),m+=l.xAdvance*XJ+$J,d=UJ.x+l.w*XJ,_<UJ.y&&(_=UJ.y),p>UJ.y-l.h*XJ&&(p=UJ.y-l.h*XJ)}else this._recordPlaceholderInfo(y,h),console.log("Can't find letter definition in texture atlas "+kJ.atlasName+" for letter:"+h);else this._recordPlaceholderInfo(y,h)}g||(i=m,s<_&&(s=_),c>p&&(c=p),a<(o=d)&&(a=o),u+=f)}else LJ.push(o),o=0,n++,i=0,r-=t$*this._getFontScale()+0,this._recordPlaceholderInfo(u,h),u++}return LJ.push(o),HJ=(GJ=n+1)*t$*this._getFontScale(),GJ>1&&(HJ+=0*(GJ-1)),zJ.width=i$,zJ.height=r$,i$<=0&&(zJ.width=parseFloat(a.toFixed(2))+2*eW.margin),r$<=0&&(zJ.height=parseFloat(HJ.toFixed(2))+2*eW.margin),jJ=zJ.height,WJ=0,s>0&&(jJ=zJ.height+s),c<-HJ&&(WJ=HJ+c),!0},_getFirstCharLen:function(){return 1},_getFontScale:function(){return e$===yq.SHRINK?XJ:1},_getFirstWordLen:function(t,e,n){var i=t.charAt(e);if(Vj(i)||"\n"===i||jj(i))return 1;var r=1,a=eW.fontAtlas.getLetterDefinitionForChar(i,eW);if(!a)return r;for(var o=a.xAdvance*XJ+$J,s=e+1;s<n&&(i=t.charAt(s),a=eW.fontAtlas.getLetterDefinitionForChar(i,eW));++s){if(o+a.offsetX*XJ+a.w*XJ>a$&&!jj(i)&&a$>0)return r;if(o+=a.xAdvance*XJ+$J,"\n"===i||jj(i)||Vj(i))break;r++}return r},_multilineTextWrapByWord:function(){return this._multilineTextWrap(this._getFirstWordLen)},_multilineTextWrapByChar:function(){return this._multilineTextWrap(this._getFirstCharLen)},_recordPlaceholderInfo:function(t,e){if(t>=NJ.length){var n=new IJ;NJ.push(n)}NJ[t].char=e,NJ[t].hash=""+e.charCodeAt(0)+eW.hash,NJ[t].valid=!1},_recordLetterInfo:function(t,e,n,i){if(n>=NJ.length){var r=new IJ;NJ.push(r)}var a=""+e.charCodeAt(0)+eW.hash;NJ[n].line=i,NJ[n].char=e,NJ[n].hash=a,NJ[n].valid=eW.fontAtlas.getLetter(a).valid,NJ[n].x=t.x,NJ[n].y=t.y},_alignText:function(){HJ=0,LJ.length=0,this._multilineTextWrapByWord(),this._computeAlignmentOffset(),e$===yq.SHRINK&&KJ>0&&this._isVerticalClamp()&&this._shrinkLabelToContentSize(this._isVerticalClamp),this._updateQuads()||e$===yq.SHRINK&&this._shrinkLabelToContentSize(this._isHorizontalClamp)},_scaleFontSizeDown:function(t){var e=!0;t||(t=.1,e=!1),KJ=t,e&&this._updateContent()},_shrinkLabelToContentSize:function(t){for(var e=0,n=0|KJ,i=0;e<n;){var r=i=e+n+1>>1;if(r<=0)break;XJ=r/QJ,this._multilineTextWrapByWord(),this._computeAlignmentOffset(),t()?n=i-1:e=i}e>=0&&this._scaleFontSizeDown(e)},_isVerticalClamp:function(){return HJ>zJ.height},_isHorizontalClamp:function(){for(var t=!1,e=0,n=YJ.length;e<n;++e){var i=NJ[e];if(i.valid){var r=eW.fontAtlas.getLetterDefinitionForChar(i.char,eW);if(!r)continue;var a=i.x+r.w*XJ,o=i.line;if(i$>0)if(n$){if(LJ[o]>zJ.width&&(a>zJ.width||a<0)){t=!0;break}}else if(a>zJ.width){t=!0;break}}}return t},_isHorizontalClamped:function(t,e){var n=LJ[e],i=t>zJ.width||t<0;return n$?n>zJ.width&&i:i},_updateQuads:function(){if(!DJ)return!1;var t=qJ?qJ.texture:eW.fontAtlas.getTexture(),e=DJ.renderData;e.dataLength=0,e.resize(0,0);for(var n=OJ.anchorPoint,i=zJ,r=n.x*i.width,a=n.y*i.height,o=!0,s=0,c=YJ.length;s<c;++s){var l=NJ[s];if(l.valid){var u=eW.fontAtlas.getLetter(l.hash);if(u){RJ.height=u.h,RJ.width=u.w,RJ.x=u.u,RJ.y=u.v;var h=l.y+VJ;if(r$>0){if(h>jJ){var f=h-jJ;RJ.y+=f,RJ.height-=f,h-=f}h-u.h*XJ<WJ&&e$===yq.CLAMP&&(RJ.height=h<WJ?0:(h-WJ)/XJ)}var _=l.line,p=l.x+u.w/2*XJ+BJ[_];if(i$>0&&this._isHorizontalClamped(p,_))if(e$===yq.CLAMP)RJ.width=0;else if(e$===yq.SHRINK){if(zJ.width>u.w){o=!1;break}RJ.width=0}if(RJ.height>0&&RJ.width>0){var d=this._determineRect(),m=l.x+BJ[l.line];this.appendQuad(DJ,t,RJ,d,m-r,h-a,XJ)}}else console.warn("Can't find letter in this bitmap-font")}}return o},appendQuad:function(){},_determineRect:function(){var t=qJ.isRotated(),e=qJ.getOriginalSize(),n=qJ.getRect(),i=qJ.getOffset(),r=i.x+(e.width-n.width)/2,a=i.y-(e.height-n.height)/2;if(t){var o=RJ.x;RJ.x=n.x+n.height-RJ.y-RJ.height-a,RJ.y=o+n.y-r,RJ.y<0&&(RJ.height+=a)}else RJ.x+=n.x-r,RJ.y+=n.y+a;return t},_computeAlignmentOffset:function(){switch(BJ.length=0,ZJ){case gq.LEFT:for(var t=0;t<GJ;++t)BJ.push(0);break;case gq.CENTER:for(var e=0,n=LJ.length;e<n;e++)BJ.push((zJ.width-LJ[e])/2);break;case gq.RIGHT:for(var i=0,r=LJ.length;i<r;i++)BJ.push(zJ.width-LJ[i])}if(VJ=zJ.height,JJ!==vq.TOP){var a=zJ.height-HJ+t$*this._getFontScale()-QJ*XJ;JJ===vq.BOTTOM?VJ-=a:VJ-=a/2}},_setupBMFontOverflowMetrics:function(){var t=zJ.width,e=zJ.height;e$===yq.RESIZE_HEIGHT&&(e=0),e$===yq.NONE&&(t=0,e=0),i$=t,r$=e,FJ.width=t,FJ.height=e,a$=t}},s$=new _i(255,255,255,255),c$={createData:function(t){return t.requestRenderData()},fillBuffers:function(t){var e=t.node;s$.set(t.color),s$.a=255*e._uiProps.opacity,ZV(e,0,t.renderData,s$)},appendQuad:function(t,e,n,i,r,a,o){var s=t.renderData;if(s){var c=s.dataLength;s.dataLength+=4,s.resize(s.dataLength,s.dataLength/2*3);var l=s.data,u=e.width,h=e.height,f=n.width,_=n.height,p=0,d=0,m=0,g=0;i?(p=n.x/u,g=(n.x+_)/u,d=(n.y+f)/h,m=n.y/h,l[c].u=p,l[c].v=m,l[c+1].u=p,l[c+1].v=d,l[c+2].u=g,l[c+2].v=m,l[c+3].u=g,l[c+3].v=d):(p=n.x/u,g=(n.x+f)/u,d=(n.y+_)/h,m=n.y/h,l[c].u=p,l[c].v=d,l[c+1].u=g,l[c+1].v=d,l[c+2].u=p,l[c+2].v=m,l[c+3].u=g,l[c+3].v=m),l[c].x=r,l[c].y=a-_*o,l[c+1].x=r+f*o,l[c+1].y=a-_*o,l[c+2].x=r,l[c+2].y=a,l[c+3].x=r+f*o,l[c+3].y=a}},updateColor:function(){}};Tt(c$,o$);var l$=null,u$=At(o$,{getAssemblerData:function(){return l$||(l$=new tW(1024,1024)),l$.getTexture()},_updateFontFamily:function(t){eW.fontAtlas=l$,eW.fontFamily=this._getFontFamily(t);var e=t.getComponent($K);e&&e.enabled?(eW.isOutlined=!0,eW.margin=e.width,eW.out=e.color.clone(),eW.out.a=e.color.a*t.color.a/255):(eW.isOutlined=!1,eW.margin=0)},_getFontFamily:function(t){var e="Arial";return t.useSystemFont?e=t.fontFamily||"Arial":t.font&&(e=t.font._nativeAsset||"Arial"),e},_updateLabelInfo:function(t){eW.fontDesc=this._getFontDesc(),eW.color=t.color,eW.hash=function(t){var e=t.color.toHEX(),n="";return t.isOutlined&&t.margin>0&&(n=n+t.margin+t.out.toHEX()),""+t.fontSize+t.fontFamily+e+n}(eW)},_getFontDesc:function(){return eW.fontSize.toString()+"px "+eW.fontFamily},_computeHorizontalKerningForText:function(){},_determineRect:function(){return!1}}),h$=new _i(255,255,255,255),f$={createData:function(t){return t.requestRenderData()},fillBuffers:function(t){if(t.renderData){var e=t.node;h$.a=255*e._uiProps.opacity,ZV(e,0,t.renderData,h$)}},updateColor:function(){},appendQuad:c$.appendQuad};Tt(f$,u$);var _$=Cq.Overflow,p$=(1/255).toFixed(3),d$=null,m$=null,g$=null,v$="",y$="",x$=0,S$=0,T$=[],A$=new Gi,E$=0,C$=0,b$=0,w$=new _i,P$="",I$=_$.NONE,R$=!1,D$=null,O$=_i.BLACK.clone(),M$=null,N$=_i.BLACK.clone(),L$=new Vi,B$=Gi.ZERO.clone(),F$=Gi.ZERO.clone(),z$=Ni.ZERO.clone(),U$=Ni.ZERO.clone(),k$=0,G$=0,H$=!1,V$=!1,j$=!1,W$=["left","center","right"],X$={getAssemblerData:function(){return Cq._canvasPool.get()},resetAssemblerData:function(t){t&&Cq._canvasPool.put(t)},updateRenderData:function(t){if(t.renderData){if(t.renderData.vertDirty){var e=t.node._uiProps.uiTransformComp;this._updateFontFamily(t),this._updateProperties(t,e),this._calculateLabelFont(),this._updateLabelDimensions(),this._updateTexture(t),this._calDynamicAtlas(t),t.actualFontSize=x$,e.setContentSize(A$),this.updateVertexData(t),this.updateUVs(t),t.markForUpdateRenderData(!1),d$=null,m$=null,g$=null}t.spriteFrame&&t.renderData.updateRenderData(t,t.spriteFrame)}},updateVertexData:function(){},updateUVs:function(){},_updateFontFamily:function(t){P$=t.useSystemFont?t.fontFamily||"Arial":t.font&&t.font._nativeAsset||"Arial"},_updateProperties:function(t,e){var n=t.assemblerData;n&&(d$=n.context,m$=n.canvas,g$=t.spriteFrame,y$=t.string.toString(),x$=t.fontSize,S$=x$,I$=t.overflow,F$.width=A$.width=e.width,F$.height=A$.height=e.height,G$=t.underlineHeight,E$=t.lineHeight,C$=t.horizontalAlign,b$=t.verticalAlign,w$=t.color,t.node._uiProps.opacity,H$=t.isBold,V$=t.isItalic,j$=t.isUnderline,R$=I$!==_$.NONE&&(I$===_$.RESIZE_HEIGHT||t.enableWrapText),(D$=(D$=$K&&t.getComponent($K))&&D$.enabled&&D$.width>0?D$:null)&&O$.set(D$.color),(M$=(M$=VZ&&t.getComponent(VZ))&&M$.enabled?M$:null)&&N$.set(M$.color),this._updatePaddingRect())},_updatePaddingRect:function(){var t=0,e=0,n=0,i=0,r=0;if(B$.width=B$.height=0,D$&&(t=e=n=i=r=D$.width,B$.width=B$.height=2*r),M$){var a=M$.blur+r,o=M$.offset.x,s=M$.offset.y;n=Math.max(n,-o+a),i=Math.max(i,o+a),t=Math.max(t,s+a),e=Math.max(e,-s+a)}if(V$){var c=S$*Math.tan(.20943951);i+=c,B$.width+=c}L$.x=n,L$.y=t,L$.width=n+i,L$.height=t+e},_calculateFillTextStartPosition:function(){var t=0;C$===gq.RIGHT?t=A$.width-L$.width:C$===gq.CENTER&&(t=(A$.width-L$.width)/2);var e=this._getLineHeight()*(T$.length-1),n=x$*(1-Mj/2);if(b$!==vq.TOP){var i=e+L$.height+x$-A$.height;b$===vq.BOTTOM?n-=i+=Mj/2*x$:n-=i/2}n+=0*x$,z$.set(t+L$.x,n+L$.y)},_updateTexture:function(t){if(d$&&m$){d$.clearRect(0,0,m$.width,m$.height),d$.font=v$,this._calculateFillTextStartPosition();var e=this._getLineHeight();d$.lineJoin="round",D$?(d$.fillStyle="rgba("+O$.r+", "+O$.g+", "+O$.b+", "+p$+")",d$.fillRect(0,0,m$.width,m$.height)):t._srcBlendFactor===Fr.SRC_ALPHA&&(d$.fillStyle="rgba("+w$.r+", "+w$.g+", "+w$.b+", "+p$+")",d$.fillRect(0,0,m$.width,m$.height)),d$.fillStyle="rgb("+w$.r+", "+w$.g+", "+w$.b+")";var n=z$.x,i=0;this._drawTextEffect(z$,e);for(var r=0;r<T$.length;++r)i=z$.y+r*e,D$&&d$.strokeText(T$[r],n,i),d$.fillText(T$[r],n,i);M$&&(d$.shadowColor="transparent"),this._uploadTexture(t)}},_uploadTexture:function(t){if(t.cacheMode===Cq.CacheMode.BITMAP){var e=t.ttfSpriteFrame;rj.deleteAtlasSpriteFrame(e),e._resetDynamicAtlasFrame()}var n;g$&&m$&&(n=g$ instanceof uj?g$.texture:g$,0!==m$.width&&0!==m$.height&&(n.reset({width:m$.width,height:m$.height,mipmapLevel:1}),n.uploadData(m$),g$ instanceof uj&&(g$.rect=new Vi(0,0,m$.width,m$.height),g$._calculateUV()),t.renderData&&(t.renderData.textureDirty=!0),i.director.root&&i.director.root.batcher2D&&i.director.root.batcher2D._releaseDescriptorSetCache(n.getHash())))},_calDynamicAtlas:function(t){if(!(t.cacheMode!==Cq.CacheMode.BITMAP||!m$||m$.width<=0||m$.height<=0)){var e=t.ttfSpriteFrame;rj.packToDynamicAtlas(t,e)}},_setupOutline:function(){d$.strokeStyle="rgba("+O$.r+", "+O$.g+", "+O$.b+", "+O$.a/255+")",d$.lineWidth=2*D$.width},_setupShadow:function(){d$.shadowColor="rgba("+N$.r+", "+N$.g+", "+N$.b+", "+N$.a/255+")",d$.shadowBlur=M$.blur,d$.shadowOffsetX=M$.offset.x,d$.shadowOffsetY=-M$.offset.y},_drawTextEffect:function(t,e){if(M$||D$||j$){var n=T$.length>1&&M$,i=this._measureText(d$,v$),r=0,a=0;M$&&this._setupShadow(),D$&&this._setupOutline();for(var o=0;o<T$.length;++o)r=t.x,a=t.y+o*e,n&&(D$&&d$.strokeText(T$[o],r,a),d$.fillText(T$[o],r,a)),j$&&(k$=i(T$[o]),C$===gq.RIGHT?U$.x=t.x-k$:C$===gq.CENTER?U$.x=t.x-k$/2:U$.x=t.x,U$.y=a+S$/8,d$.fillRect(U$.x,U$.y,k$,G$));n&&(d$.shadowColor="transparent")}},_updateLabelDimensions:function(){A$.width=Math.min(A$.width,2048),A$.height=Math.min(A$.height,2048);var t=!1;m$.width!==A$.width&&(m$.width=A$.width,t=!0),m$.height!==A$.height&&(m$.height=A$.height,t=!0),t&&(d$.font=v$),d$.textAlign=W$[C$],d$.textBaseline="alphabetic"},_getFontDesc:function(){var t=x$.toString()+"px ";return t+=P$,H$&&(t="bold "+t),V$&&(t="italic "+t),t},_getLineHeight:function(){return 0|(0===E$?x$:E$*x$/S$)},_calculateParagraphLength:function(t,e){for(var n,i=[],r=W(t);!(n=r()).done;){var a=Wj(e,n.value,v$);i.push(a)}return i},_measureText:function(t,e){return function(n){return Wj(t,n,e)}},_calculateShrinkFont:function(t){if(d$){var e=this._calculateParagraphLength(t,d$),n=0,i=0,r=0;if(R$){var a=F$.width,o=F$.height;if(a<0||o<0)return;i=o+1;for(var s=0,c=0|x$+1,l=0;s<c;){if((l=s+c+1>>1)<=0){T(4003);break}x$=l,v$=this._getFontDesc(),d$.font=v$;var u=this._getLineHeight();for(i=0,n=0;n<t.length;++n){var h=Wj(d$,t[n],v$);i+=qj(t[n],h,a,this._measureText(d$,v$)).length*u}i>o?c=l-1:s=l}0===s?T(4003):(x$=s,v$=this._getFontDesc(),d$.font=v$)}else{for(i=t.length*this._getLineHeight(),n=0;n<t.length;++n)r<e[n]&&(r=e[n]);var f=(A$.width-L$.width)/r,_=A$.height/i;x$=S$*Math.min(1,f,_)|0,v$=this._getFontDesc(),d$.font=v$}}},_calculateWrapText:function(t){if(R$&&d$){T$=[];for(var e=F$.width,n=0;n<t.length;++n){var i=Wj(d$,t[n],v$),r=qj(t[n],i,e,this._measureText(d$,v$));T$=T$.concat(r)}}},_calculateLabelFont:function(){if(d$){var t=y$.split("\n");switch(T$=t,v$=this._getFontDesc(),d$.font=v$,I$){case _$.NONE:for(var e=0,n=0,i=0;i<t.length;++i){var r=Wj(d$,t[i],v$);e=e>r?e:r}n=(T$.length+Mj)*this._getLineHeight();var a=parseFloat(e.toFixed(2)),o=parseFloat(n.toFixed(2));A$.width=a+L$.width,A$.height=o+L$.height,F$.width=a+B$.width,F$.height=o+B$.height;break;case _$.SHRINK:this._calculateShrinkFont(t),this._calculateWrapText(t);break;case _$.CLAMP:this._calculateWrapText(t);break;case _$.RESIZE_HEIGHT:this._calculateWrapText(t);var s=(T$.length+Mj)*this._getLineHeight();A$.height=s+L$.height,F$.height=s+B$.height}}}},q$=_i.WHITE.clone(),Y$={createData:function(t){var e=t.requestRenderData();e.dataLength=2,e.resize(4,6);var n=e.chunk.vb;n[3]=n[21]=n[22]=n[31]=0,n[4]=n[12]=n[13]=n[30]=1;for(var i=5,r=0;r<4;r++)_i.toArray(n,q$,i),i+=9;return e},fillBuffers:function(t){var e=t.renderData.chunk,n=t.renderData.data,i=t.node,r=e.vb,a=n[0],o=n[1];i.updateWorldTransform();var s=i._pos,c=i._rot,l=i._scale,u=a.x*l.x,h=o.x*l.x,f=a.y*l.y,_=o.y*l.y,p=c.x,d=c.y,m=c.z,g=c.w,v=p*d,y=m*g,x=p*p-d*d,S=g*g-m*m,T=S+x,A=2*(v-y),E=S-x,C=2*(v+y),b=s.x,w=s.y;r[0]=T*u+A*f+b,r[1]=E*f+C*u+w,r[9]=T*h+A*f+b,r[10]=E*f+C*h+w,r[18]=T*u+A*_+b,r[19]=E*_+C*u+w,r[27]=T*h+A*_+b,r[28]=E*_+C*h+w;var P=e.bufferId,I=e.vertexOffset,R=e.vertexAccessor.getMeshBuffer(e.bufferId),D=e.vertexAccessor.getIndexBuffer(P),O=R.indexOffset;D[O++]=I,D[O++]=I+1,D[O++]=I+2,D[O++]=I+2,D[O++]=I+1,D[O++]=I+3,R.indexOffset+=6},updateVertexData:function(t){var e=t.renderData;if(e){var n=t.node._uiProps.uiTransformComp,i=n.width,r=n.height,a=n.anchorX*i,o=n.anchorY*r,s=e.data;s[0].x=-a,s[0].y=-o,s[1].x=i-a,s[1].y=r-o}},updateUVs:function(t){var e=t.renderData;if(e&&t.ttfSpriteFrame){var n=e.chunk.vb,i=t.ttfSpriteFrame.uv;n[3]=i[0],n[4]=i[1],n[12]=i[2],n[13]=i[3],n[21]=i[4],n[22]=i[5],n[30]=i[6],n[31]=i[7]}},updateColor:function(){}};Tt(Y$,X$);var K$=t("labelAssembler",{getAssembler:function(t){var e=Y$;return t.font instanceof Dj?e=c$:t.cacheMode===Cq.CacheMode.CHAR&&(e=f$),e}});Cq.Assembler=K$;var Q$=eQ.FillType,Z$=new Ri,J$=new di,$$={updateRenderData:function(t){var e=t.spriteFrame;rj.packToDynamicAtlas(t,e);var n=t.renderData;if(n&&e){if(n.updateRenderData(t,e),!n.vertDirty)return;var i=t.fillStart,r=t.fillRange;r<0&&(i+=r,r=-r),r=(r=(r=i+r)>1?1:r)<0?0:r;var a=(i=(i=i>1?1:i)<0?0:i)+(r=(r-=i)<0?0:r);a=a>1?1:a,this.updateUVs(t,i,a),this.updateVertexData(t,i,a)}},updateUVs:function(t,e,n){var i=t.spriteFrame,r=t.renderData.chunk.vb,a=i.width,o=i.height,s=i.rect,c=0,l=0,u=0,h=0,f=0,_=0,p=0,d=0,m=0,g=0;switch(i.isRotated()?(c=s.x/a,l=(s.y+s.width)/o,u=f=c,p=m=(s.x+s.height)/a,_=g=l,h=d=s.y/o):(c=s.x/a,l=(s.y+s.height)/o,u=p=c,f=m=(s.x+s.width)/a,h=_=l,d=g=s.y/o),t.fillType){case Q$.HORIZONTAL:r[3]=u+(f-u)*e,r[4]=h+(_-h)*e,r[12]=u+(f-u)*n,r[13]=h+(_-h)*n,r[21]=p+(m-p)*e,r[22]=d+(g-d)*e,r[30]=p+(m-p)*n,r[31]=d+(g-d)*n;break;case Q$.VERTICAL:r[3]=u+(p-u)*e,r[4]=h+(d-h)*e,r[12]=f+(m-f)*e,r[13]=_+(g-_)*e,r[21]=u+(p-u)*n,r[22]=h+(d-h)*n,r[30]=f+(m-f)*n,r[31]=_+(g-_)*n;break;default:b(2626)}},updateVertexData:function(t,e,n){var i=t.renderData.data,r=t.node._uiProps.uiTransformComp,a=r.width,o=r.height,s=r.anchorX*a,c=r.anchorY*o,l=-s,u=-c,h=a-s,f=o-c,_=0;switch(t.fillType){case Q$.HORIZONTAL:_=l+(h-l)*n,l+=(h-l)*e,h=_;break;case Q$.VERTICAL:_=u+(f-u)*n,u+=(f-u)*e,f=_;break;default:b(2626)}i[0].x=l,i[0].y=u,i[1].x=h,i[1].y=u,i[2].x=l,i[2].y=f,i[3].x=h,i[3].y=f},createData:function(t){var e=t.requestRenderData();e.dataLength=4,e.resize(4,6);for(var n,i=W(e.data);!(n=i()).done;)n.value.z=0;return e},updateWorldVertexData:function(t,e){t.node.getWorldMatrix(Z$);for(var n=t.renderData.floatStride,i=t.renderData.data,r=e.vb,a=0,o=0;o<4;o++){var s=i[o];di.transformMat4(J$,s,Z$),r[a=o*n]=J$.x,r[a+1]=J$.y,r[a+2]=J$.z}},fillBuffers:function(t){var e=t.renderData,n=e.chunk;(t.node.hasChangedFlags||e.vertDirty)&&(this.updateWorldVertexData(t,n),e.vertDirty=!1);var i=n.bufferId,r=n.vertexOffset,a=n.vertexAccessor.getMeshBuffer(n.bufferId),o=n.vertexAccessor.getIndexBuffer(i),s=a.indexOffset;o[s++]=r,o[s++]=r+1,o[s++]=r+2,o[s++]=r+2,o[s++]=r+1,o[s++]=r+3,a.indexOffset+=6},updateColor:function(t){for(var e=t.renderData,n=e.chunk.vb,i=e.floatStride,r=5,a=t.color,o=a.r/255,s=a.g/255,c=a.b/255,l=t.node._uiProps.opacity,u=0;u<4;u++)n[r]=o,n[r+1]=s,n[r+2]=c,n[r+3]=l,r+=i}},t0=2*Math.PI,e0=1e-6,n0=new Ri,i0=new di,r0=[new Ni,new Ni,new Ni,new Ni],a0=new Array(4),o0=new Array(8),s0=[new Ni,new Ni,new Ni,new Ni],c0=[new Ni,new Ni,new Ni,new Ni],l0=new Ni,u0=[new Ni,new Ni,new Ni,new Ni];function h0(t,e,n,i,r,a,o){var s=Math.sin(a);s=Math.abs(s)>e0?s:0;var c=Math.cos(a),l=0,u=0;if(0!==(c=Math.abs(c)>e0?c:0)){if(l=s/c,(t-r.x)*c>0){var h=r.y+l*(t-r.x);o[0].x=t,o[0].y=h}if((e-r.x)*c>0){var f=r.y+l*(e-r.x);o[2].x=e,o[2].y=f}}if(0!==s){if(u=c/s,(i-r.y)*s>0){var _=r.x+u*(i-r.y);o[3].x=_,o[3].y=i}if((n-r.y)*s>0){var p=r.x+u*(n-r.y);o[1].x=p,o[1].y=n}}}function f0(t,e){var n=e.x-t.x,i=e.y-t.y;if(0===n&&0===i)return 0;if(0===n)return i>0?.5*Math.PI:1.5*Math.PI;var r=Math.atan(i/n);return n<0&&(r+=Math.PI),r}function _0(t,e,n,i,r){var a=a0,o=a[0],s=a[1],c=a[2],l=a[3];t[e].x=n.x,t[e].y=n.y,t[e+1].x=i.x,t[e+1].y=i.y,t[e+2].x=r.x,t[e+2].y=r.y,p0((n.x-o)/(c-o),(n.y-s)/(l-s),t,e),p0((i.x-o)/(c-o),(i.y-s)/(l-s),t,e+1),p0((r.x-o)/(c-o),(r.y-s)/(l-s),t,e+2)}function p0(t,e,n,i){var r=o0,a=r[0]+(r[2]-r[0])*t,o=r[4]+(r[6]-r[4])*t,s=r[1]+(r[3]-r[1])*t,c=r[5]+(r[7]-r[5])*t,l=n[i];l.u=a+(o-a)*e,l.v=s+(c-s)*e}for(var d0={useModel:!1,createData:function(t){return t.requestRenderData()},updateRenderData:function(t){var e=t.spriteFrame;rj.packToDynamicAtlas(t,e),this.updateUVs(t);var n=t.renderData;if(n&&e){if(!n.vertDirty)return;var i=n.data,r=t.fillStart,a=t.fillRange;for(a<0&&(r+=a,a=-a);r>=1;)r-=1;for(;r<0;)r+=1;var o=(r*=t0)+(a*=t0);!function(t){var e=t.node._uiProps.uiTransformComp,n=e.width,i=e.height,r=e.anchorX*n,a=e.anchorY*i,o=-r,s=-a,c=n-r,l=i-a,u=a0;u[0]=o,u[1]=s,u[2]=c,u[3]=l;var h=t.fillCenter,f=l0.x=Math.min(Math.max(0,h.x),1)*(c-o)+o,_=l0.y=Math.min(Math.max(0,h.y),1)*(l-s)+s;r0[0].x=r0[3].x=o,r0[1].x=r0[2].x=c,r0[0].y=r0[1].y=s,r0[2].y=r0[3].y=l;for(var p,d=W(u0);!(p=d()).done;){var m=p.value;Ni.set(m,0,0)}f!==u[0]&&Ni.set(u0[0],3,0),f!==u[2]&&Ni.set(u0[2],1,2),_!==u[1]&&Ni.set(u0[1],0,1),_!==u[3]&&Ni.set(u0[3],2,3)}(t),function(t){var e=t.width,n=t.height,i=t.getRect(),r=0,a=0,o=0,s=0,c=o0;t.isRotated()?(r=i.x/e,a=(i.x+i.height)/e,o=i.y/n,s=(i.y+i.width)/n,c[0]=c[2]=r,c[4]=c[6]=a,c[3]=c[7]=s,c[1]=c[5]=o):(r=i.x/e,a=(i.x+i.width)/e,o=i.y/n,s=(i.y+i.height)/n,c[0]=c[4]=r,c[2]=c[6]=a,c[1]=c[3]=s,c[5]=c[7]=o)}(e),h0(a0[0],a0[2],a0[1],a0[3],l0,r,s0),h0(a0[0],a0[2],a0[1],a0[3],l0,r+a,c0);for(var s=0,c=0;c<4;++c){var l=u0[c];if(l)if(a>=t0)n.dataLength=s+3,_0(i,s,l0,r0[l.x],r0[l.y]),s+=3;else{var u=f0(l0,r0[l.x]),h=f0(l0,r0[l.y]);h<u&&(h+=t0),u-=t0,h-=t0;for(var f=0;f<3;++f)u>=o||(u>=r?(n.dataLength=s+3,_0(i,s,l0,r0[l.x],h>=o?c0[c]:r0[l.y]),s+=3):h>r&&(h<=o?(n.dataLength=s+3,_0(i,s,l0,s0[c],r0[l.y]),s+=3):(n.dataLength=s+3,_0(i,s,l0,s0[c],c0[c]),s+=3))),u+=t0,h+=t0}}n.resize(s,s),n.updateRenderData(t,e)}},fillBuffers:function(t){var e=t.node,n=t.renderData,i=n.chunk;(e.hasChangedFlags||n.vertDirty)&&(this.updateWorldVertexAndUVData(t,i),n.vertDirty=!1),this.updataColorLate(t);for(var r=i.bufferId,a=i.vertexOffset,o=i.vertexAccessor.getMeshBuffer(i.bufferId),s=i.vertexAccessor.getIndexBuffer(r),c=o.indexOffset,l=0;l<n.indexCount;l++)s[c+l]=a+l;o.indexOffset+=n.indexCount,o.setDirty()},updateWorldVertexAndUVData:function(t,e){t.node.getWorldMatrix(n0);for(var n=t.renderData,i=n.floatStride,r=t.renderData.data,a=e.vb,o=n.vertexCount,s=0,c=0;c<o;c++){var l=r[c];di.set(i0,l.x,l.y,0),di.transformMat4(i0,i0,n0),a[s+0]=i0.x,a[s+1]=i0.y,a[s+2]=i0.z,a[s+3]=l.u,a[s+4]=l.v,s+=i}},updateUVs:function(t){t.renderData.vertDirty=!0,t.markForUpdateRenderData()},updataColorLate:function(t){for(var e=t.renderData,n=e.chunk.vb,i=e.floatStride,r=e.vertexCount,a=5,o=t.color,s=o.r/255,c=o.g/255,l=o.b/255,u=t.node._uiProps.opacity,h=0;h<r;h++)n[a]=s,n[a+1]=c,n[a+2]=l,n[a+3]=u,a+=i},updateColor:function(){}},m0=[],g0=0;g0<4;g0++)m0.push(new di);for(var v0={createData:function(t){var e=t.requestRenderData();return e.dataLength=2,e.resize(4,6),e},updateRenderData:function(t){var e=t.spriteFrame;rj.packToDynamicAtlas(t,e),this.updateUVs(t);var n=t.renderData;n&&e&&(n.vertDirty&&this.updateVertexData(t),n.updateRenderData(t,e))},updateWorldVerts:function(t,e){var n=t.renderData,i=e.vb,r=n.data,a=t.node,o=r[0],s=r[1],c=a.worldMatrix,l=c.m00,u=c.m01,h=c.m04,f=c.m05,_=1===l&&0===u&&0===h&&1===f,p=c.m12,d=c.m13,m=o.x,g=s.x,v=o.y,y=s.y;if(_){var x=m+p,S=g+p,T=v+d,A=y+d;i[0]=x,i[1]=T,i[9]=S,i[10]=T,i[18]=x,i[19]=A,i[27]=S,i[28]=A}else{var E=l*m,C=l*g,b=u*m,w=u*g,P=h*v+p,I=h*y+p,R=f*v+d,D=f*y+d;i[0]=E+P,i[1]=b+R,i[9]=C+P,i[10]=w+R,i[18]=E+I,i[19]=b+D,i[27]=C+I,i[28]=w+D}},fillBuffers:function(t){if(null!==t){var e=t.renderData,n=e.chunk;(t.node.hasChangedFlags||e.vertDirty)&&(this.updateWorldVerts(t,n),e.vertDirty=!1);var i=n.bufferId,r=n.vertexOffset,a=n.vertexAccessor.getMeshBuffer(i),o=n.vertexAccessor.getIndexBuffer(i),s=a.indexOffset;o[s++]=r,o[s++]=r+1,o[s++]=r+2,o[s++]=r+2,o[s++]=r+1,o[s++]=r+3,a.indexOffset+=6}},updateVertexData:function(t){var e=t.renderData;if(e){var n=t.node._uiProps.uiTransformComp,i=e.data,r=n.width,a=n.height,o=n.anchorX*r,s=n.anchorY*a,c=0,l=0,u=0,h=0;if(t.trim)c=-o,l=-s,u=r-o,h=a-s;else{var f=t.spriteFrame,_=f.getOriginalSize(),p=f.getRect(),d=_.width,m=_.height,g=p.width,v=p.height,y=f.getOffset(),x=r/d,S=a/m,T=y.x+(d-g)/2,A=y.x-(d-g)/2;c=T*x-o,l=(y.y+(m-v)/2)*S-s,u=r+A*x-o,h=a+(y.y-(m-v)/2)*S-s}i[0].x=c,i[0].y=l,i[1].x=u,i[1].y=h,e.vertDirty=!0}},updateUVs:function(t){if(t.spriteFrame){var e=t.renderData.chunk.vb,n=t.spriteFrame.uv;e[3]=n[0],e[4]=n[1],e[12]=n[2],e[13]=n[3],e[21]=n[4],e[22]=n[5],e[30]=n[6],e[31]=n[7]}},updateColor:function(t){for(var e=t.renderData,n=e.chunk.vb,i=5,r=t.color,a=r.r/255,o=r.g/255,s=r.b/255,c=r.a/255,l=0;l<4;l++,i+=e.floatStride)n[i]=a,n[i+1]=o,n[i+2]=s,n[i+3]=c}},y0=new di,x0=new Ri,S0={createData:function(t){var e=t.requestRenderData();return e.dataLength=4,e.resize(16,54),e},updateRenderData:function(t){var e=t.spriteFrame;rj.packToDynamicAtlas(t,e),this.updateUVs(t);var n=t.renderData;n&&e&&(n.vertDirty&&this.updateVertexData(t),n.updateRenderData(t,e))},updateVertexData:function(t){var e=t.renderData.data,n=t.node._uiProps.uiTransformComp,i=n.width,r=n.height,a=n.anchorX*i,o=n.anchorY*r,s=t.spriteFrame,c=s.insetLeft,l=s.insetRight,u=s.insetTop,h=s.insetBottom,f=i-c-l,_=r-u-h,p=i/(c+l),d=r/(u+h);p=Number.isNaN(p)||p>1?1:p,d=Number.isNaN(d)||d>1?1:d,f=f<0?0:f,_=_<0?0:_,e[0].x=-a,e[0].y=-o,e[1].x=c*p-a,e[1].y=h*d-o,e[2].x=e[1].x+f,e[2].y=e[1].y+_,e[3].x=i-a,e[3].y=r-o},fillBuffers:function(t){var e=t.renderData,n=e.chunk;(t.node.hasChangedFlags||e.vertDirty)&&(this.updateWorldVertexData(t,n),e.vertDirty=!1);for(var i=n.bufferId,r=n.vertexOffset,a=n.vertexAccessor.getMeshBuffer(n.bufferId),o=n.vertexAccessor.getIndexBuffer(i),s=a.indexOffset,c=0;c<3;++c)for(var l=0;l<3;++l){var u=r+4*c+l;o[s++]=u,o[s++]=u+1,o[s++]=u+4,o[s++]=u+1,o[s++]=u+5,o[s++]=u+4}a.indexOffset=s},updateWorldVertexData:function(t,e){t.node.getWorldMatrix(x0);for(var n=t.renderData,i=n.floatStride,r=n.data,a=e.vb,o=0,s=0;s<4;++s)for(var c=r[s],l=0;l<4;++l){var u=r[l];di.set(y0,u.x,c.y,0),di.transformMat4(y0,y0,x0),o=(4*s+l)*i,a[o++]=y0.x,a[o++]=y0.y,a[o++]=y0.z}},updateUVs:function(t){if(t.spriteFrame)for(var e=t.renderData,n=e.chunk.vb,i=e.floatStride,r=t.spriteFrame.uvSliced,a=3,o=0;o<16;o++)n[a]=r[o].u,n[a+1]=r[o].v,a+=i},updateColor:function(t){for(var e=t.renderData,n=e.chunk.vb,i=e.floatStride,r=5,a=t.color,o=a.r/255,s=a.g/255,c=a.b/255,l=t.node._uiProps.opacity,u=0;u<16;u++)n[r]=o,n[r+1]=s,n[r+2]=c,n[r+3]=l,r+=i}},T0=[],A0=0;A0<4;A0++)T0.push(new di);var E0=new Ri,C0={createData:function(t){return t.requestRenderData()},updateRenderData:function(t){var e=t.renderData,n=t.spriteFrame;if(n&&e&&(e.updateRenderData(t,n),e.vertDirty)){var i=t.node._uiProps.uiTransformComp,r=Math.abs(i.width),a=Math.abs(i.height),o=n.getRect(),s=n.insetLeft,c=n.insetRight,l=o.width-s-c,u=n.insetTop,h=n.insetBottom,f=o.height-u-h,_=r-s-c,p=a-u-h;_=_>0?_:0,p=p>0?p:0;var d=0===l?_:_/l,m=0===f?p:p/f,g=Math.ceil(m+2),v=Math.ceil(d+2);e.dataLength=Math.max(8,g+1,v+1),this.updateVerts(t,_,p,g,v),e.resize(g*v*4,g*v*6)}},updateUVs:function(t){t.renderData.vertDirty=!0,t.markForUpdateRenderData()},fillBuffers:function(t){var e=t.node,n=t.renderData,i=n.chunk;(e.hasChangedFlags||n.vertDirty)&&(this.updateWorldVertexAndUVData(t,i),n.vertDirty=!1),this.updataColorLate(t);for(var r=i.bufferId,a=i.vertexOffset,o=i.vertexAccessor.getMeshBuffer(i.bufferId),s=i.vertexAccessor.getIndexBuffer(r),c=o.indexOffset,l=0;l<n.indexCount;l+=6)s[c++]=a,s[c++]=a+1,s[c++]=a+2,s[c++]=a+1,s[c++]=a+3,s[c++]=a+2,a+=4,o.indexOffset+=6;o.setDirty()},updateWorldVertexAndUVData:function(t,e){var n=t.node;n.getWorldMatrix(E0);var i=t.renderData,r=i.floatStride,a=i.data,o=e.vb,s=n._uiProps.uiTransformComp,c=Math.abs(s.width),l=Math.abs(s.height),u=t.spriteFrame,h=u.rotated,f=u.uv,_=u.uvSliced,p=u.rect,d=u.insetLeft,m=u.insetRight,g=p.width-d-m,v=u.insetTop,y=u.insetBottom,x=p.height-v-y,S=c-d-m,T=l-v-y;S=S>0?S:0,T=T>0?T:0;for(var A=0===g?S:S/g,E=0===x?T:T/x,C=Math.ceil(E+2),b=Math.ceil(A+2),w=0,P=0,I=0,R=0,D=0,O=0,M=C;O<M;++O){R=a[O].y,D=a[O+1].y;for(var N=0,L=b;N<L;++N){P=a[N].x,I=a[N+1].x,di.set(T0[0],P,R,0),di.set(T0[1],I,R,0),di.set(T0[2],P,D,0),di.set(T0[3],I,D,0);for(var B=0;B<4;B++){var F=T0[B];di.transformMat4(F,F,E0);var z=B*r;o[w+z]=F.x,o[w+z+1]=F.y,o[w+z+2]=F.z}w+=4*r}}w=0;for(var U=r,k=2*r,G=3*r,H=4*r,V=0,j=0,W=[],X=[],q=0,Y=C;q<Y;++q){j=T>x?T>=q*x?1:E%1:E;for(var K=0,Q=b;K<Q;++K){V=S>g?S>=K*g?1:A%1:A;var Z=w+3,J=Z+1;h?(0===q?(W[0]=_[0].u,W[1]=_[0].u,W[2]=_[4].u+(_[8].u-_[4].u)*j):q<C-1?(W[0]=_[4].u,W[1]=_[4].u,W[2]=_[4].u+(_[8].u-_[4].u)*j):q===C-1&&(W[0]=_[8].u,W[1]=_[8].u,W[2]=_[12].u),0===K?(X[0]=_[0].v,X[1]=_[1].v+(_[2].v-_[1].v)*V,X[2]=_[0].v):K<b-1?(X[0]=_[1].v,X[1]=_[1].v+(_[2].v-_[1].v)*V,X[2]=_[1].v):K===b-1&&(X[0]=_[2].v,X[1]=_[3].v,X[2]=_[2].v),W[3]=W[2],X[3]=X[1]):(0===K?(W[0]=_[0].u,W[1]=_[1].u+(_[2].u-_[1].u)*V,W[2]=f[0]):K<b-1?(W[0]=_[1].u,W[1]=_[1].u+(_[2].u-_[1].u)*V,W[2]=_[1].u):K===b-1&&(W[0]=_[2].u,W[1]=_[3].u,W[2]=_[2].u),0===q?(X[0]=_[0].v,X[1]=_[0].v,X[2]=_[4].v+(_[8].v-_[4].v)*j):q<C-1?(X[0]=_[4].v,X[1]=_[4].v,X[2]=_[4].v+(_[8].v-_[4].v)*j):q===C-1&&(X[0]=_[8].v,X[1]=_[8].v,X[2]=_[12].v),W[3]=W[1],X[3]=X[2]),o[Z]=W[0],o[J]=X[0],o[Z+U]=W[1],o[J+U]=X[1],o[Z+k]=W[2],o[J+k]=X[2],o[Z+G]=W[3],o[J+G]=X[3],w+=H}}},updateVerts:function(t,e,n,i,r){var a,o,s=t.node._uiProps.uiTransformComp,c=t.renderData.data,l=t.spriteFrame,u=l.rect,h=Math.abs(s.width),f=Math.abs(s.height),_=s.anchorX*h,p=s.anchorY*f,d=l.insetLeft,m=l.insetRight,g=u.width-d-m,v=l.insetTop,y=l.insetBottom,x=u.height-v-y,S=s.width/(d+m)>1?1:s.width/(d+m),T=s.height/(v+y)>1?1:s.height/(v+y);a=g>0?Math.floor(1e3*e)/1e3%g==0?g:e%g:e,o=x>0?Math.floor(1e3*n)/1e3%x==0?x:n%x:n;for(var A=0;A<=r;A++)0===A?c[A].x=-_:A>0&&A<r?c[A].x=1===A?d*S+Math.min(g,e)-_:g>0?A===r-1?d+a+g*(A-2)-_:d+Math.min(g,e)+g*(A-2)-_:d+e-_:A===r&&(c[A].x=Math.min(d+e+m,h)-_);for(var E=0;E<=i;E++)0===E?c[E].y=-p:E>0&&E<i?c[E].y=1===E?y*T+Math.min(x,n)-p:x>0?E===i-1?y+o+(E-2)*x-p:y+Math.min(x,n)+(E-2)*x-p:y+n-p:E===i&&(c[E].y=Math.min(y+n+v,f)-p)},updataColorLate:function(t){for(var e=t.renderData,n=e.chunk.vb,i=e.floatStride,r=e.vertexCount,a=5,o=t.color,s=o.r/255,c=o.g/255,l=o.b/255,u=t.node._uiProps.opacity,h=0;h<r;h++)n[a]=s,n[a+1]=c,n[a+2]=l,n[a+3]=u,a+=i},updateColor:function(){}},b0=eQ.Type,w0=eQ.FillType,P0=t("spriteAssembler",{getAssembler:function(t){var e=v0,n=t;switch(n.type){case b0.SLICED:e=S0;break;case b0.TILED:e=C0;break;case b0.FILLED:e=n.fillType===w0.RADIAL?d0:$$}return e}});eQ.Assembler=P0;var I0=rX.sharedManager,R0={createData:function(t){var e=t.requestRenderData();return e.dataLength=2,e.resize(4,6),e},updateRenderData:function(t){t.type===BY.IMAGE_STENCIL&&(v0.updateRenderData(t),v0.updateColor(t))},fillBuffers:function(t,e){(t.type!==BY.IMAGE_STENCIL||t.spriteFrame)&&(I0.pushMask(t),e.finishMergeBatches(),function(t,e){I0.clear(t),e.commitModel(t,t._clearModel,t._clearStencilMtl)}(t,e),function(t,e){if(I0.enterLevel(t),t.type===BY.IMAGE_STENCIL){v0.fillBuffers(t,e);var n=t.graphics.getMaterialInstance(0);e.forceMergeBatches(n,t.spriteFrame,t.graphics)}else t.graphics.updateAssembler(e)}(t,e),I0.enableMask())}},D0={fillBuffers:function(){I0.exitMask()}},O0={getAssembler:function(){return R0}},M0={getAssembler:function(){return D0}};GY.Assembler=O0,GY.PostAssembler=M0;var N0=t("MeshBuffer",function(){function t(){this.byteOffset=0,this.vertexOffset=0,this.indexOffset=0,this.vData=null,this.iData=null,this._dirty=!1,this._vertexFormatBytes=0,this._floatsPerVertex=0,this._initVDataCount=0,this._initIDataCount=0,this._attributes=null,this._iaPool=[],this._iaInfo=null,this._nextFreeIAHandle=0}var e=t.prototype;return e.initialize=function(t,e,n,i){this._initVDataCount=n,this._initIDataCount=i,this._attributes=e,this._floatsPerVertex=oW(e),this._initVDataCount,this._floatsPerVertex,R(9005),this.vData&&this.iData||(this.vData=new Float32Array(this._initVDataCount),this.iData=new Uint16Array(this._initIDataCount)),this._iaPool.push(this.createNewIA(t))},e.reset=function(){this._nextFreeIAHandle=0,this._dirty=!1},e.destroy=function(){this.reset(),this._attributes=null,this._iaInfo=null,this.vData=null,this.iData=null;for(var t=0;t<this._iaPool.length;++t){var e=this._iaPool[t];e.vertexBuffers[0]&&e.vertexBuffers[0].destroy(),e.indexBuffer&&e.indexBuffer.destroy(),e.ia.destroy()}this._iaPool.length=0},e.setDirty=function(){this._dirty=!0},e.request=function(){return E(9002),!1},e.requireFreeIA=function(t){return this._iaPool.length<=this._nextFreeIAHandle&&this._iaPool.push(this.createNewIA(t)),this._iaPool[this._nextFreeIAHandle++].ia},e.recycleIA=function(t){for(var e=this._iaPool,n=0;n<this._nextFreeIAHandle;++n)if(t===e[n].ia){var i=e[n];return e[n]=e[--this._nextFreeIAHandle],void(e[this._nextFreeIAHandle]=i)}},e.checkCapacity=function(t,e){var n=this.vertexOffset+t,i=this.indexOffset+e;return!(n>this._initVDataCount||i>this._initIDataCount)},e.uploadBuffers=function(){if(0!==this.byteOffset&&this._dirty){for(var t=lh.__isWebIOS14OrIPadOS14Env?this._nextFreeIAHandle:1,e=this.byteOffset,n=this.indexOffset,i=0;i<t;++i){var r=this._iaPool[i],a=new Float32Array(this.vData.buffer,0,e>>2),o=new Uint16Array(this.iData.buffer,0,n),s=r.vertexBuffers[0];e>s.size&&s.resize(e),s.update(a),2*n>r.indexBuffer.size&&r.indexBuffer.resize(2*n),r.indexBuffer.update(o)}this._dirty=!1}},e.createNewIA=function(t){var e,n,i;if(lh.__isWebIOS14OrIPadOS14Env||!this._iaPool[0]){var r=this._vertexFormatBytes=this._floatsPerVertex*Float32Array.BYTES_PER_ELEMENT,a=Uint16Array.BYTES_PER_ELEMENT,o=t.createBuffer(new Ta(Er.VERTEX|Er.TRANSFER_DST,wr.HOST|wr.DEVICE,r,r));i=t.createBuffer(new Ta(Er.INDEX|Er.TRANSFER_DST,wr.HOST|wr.DEVICE,a,a)),n=[o],this._iaInfo=new Ga(this._attributes,n,i),e=t.createInputAssembler(this._iaInfo)}else e=t.createInputAssembler(this._iaInfo),n=this._iaInfo.vertexBuffers,i=this._iaInfo.indexBuffer;return{ia:e,vertexBuffers:n,indexBuffer:i}},L(t,[{key:"attributes",get:function(){return this._attributes}},{key:"vertexFormatBytes",get:function(){return this._vertexFormatBytes}}]),t}()),L0=[hD.EventType.MOUSE_DOWN,hD.EventType.MOUSE_MOVE,hD.EventType.MOUSE_UP,hD.EventType.MOUSE_WHEEL],B0=[hD.EventType.TOUCH_START,hD.EventType.TOUCH_MOVE,hD.EventType.TOUCH_END,hD.EventType.TOUCH_CANCEL],F0=(new(function(){function t(){this.priority=eD.UI,this._isListDirty=!1,this._inDispatchCount=0,this._pointerEventProcessorList=[],this._processorListToAdd=[],this._processorListToRemove=[],fD._registerEventDispatcher(this),IR.callbacksInvoker.on(jb.ADD_POINTER_EVENT_PROCESSOR,this.addPointerEventProcessor,this),IR.callbacksInvoker.on(jb.REMOVE_POINTER_EVENT_PROCESSOR,this.removePointerEventProcessor,this),IR.callbacksInvoker.on(jb.MARK_LIST_DIRTY,this._markListDirty,this)}var e=t.prototype;return e.dispatchEvent=function(t){var e=t.type;return B0.includes(e)?this.dispatchEventTouch(t):!L0.includes(e)||this.dispatchEventMouse(t)},e.addPointerEventProcessor=function(t){0===this._inDispatchCount?this._pointerEventProcessorList.includes(t)||(this._pointerEventProcessorList.push(t),this._isListDirty=!0):this._processorListToAdd.includes(t)||this._processorListToAdd.push(t),Gt.array.remove(this._processorListToRemove,t)},e.removePointerEventProcessor=function(t){0===this._inDispatchCount?(Gt.array.remove(this._pointerEventProcessorList,t),this._isListDirty=!0):this._processorListToRemove.includes(t)||this._processorListToRemove.push(t),Gt.array.remove(this._processorListToAdd,t)},e.dispatchEventMouse=function(t){this._inDispatchCount++,this._sortPointerEventProcessorList();for(var e=this._pointerEventProcessorList,n=e.length,i=!0,r=0;r<n;++r){var a=e[r];if(a.isEnabled&&a.shouldHandleEventMouse&&a._handleEventMouse(t)){if(i=!1,!t.preventSwallow)break;t.preventSwallow=!1}}return--this._inDispatchCount<=0&&this._updatePointerEventProcessorList(),i},e.dispatchEventTouch=function(t){this._inDispatchCount++,this._sortPointerEventProcessorList();for(var e=this._pointerEventProcessorList,n=e.length,i=t.touch,r=!0,a=0;a<n;++a){var o=e[a];if(o.isEnabled&&o.shouldHandleEventTouch)if(t.type===Hb.TOUCH_START){if(o._handleEventTouch(t)){if(o.claimedTouchIdList.push(i.getID()),r=!1,!t.preventSwallow)break;t.preventSwallow=!1}}else if(o.claimedTouchIdList.length>0){var s=o.claimedTouchIdList.indexOf(i.getID());if(-1!==s){if(o._handleEventTouch(t),t.type!==Hb.TOUCH_END&&t.type!==Hb.TOUCH_CANCEL||Gt.array.removeAt(o.claimedTouchIdList,s),r=!1,!t.preventSwallow)break;t.preventSwallow=!1}}}return--this._inDispatchCount<=0&&this._updatePointerEventProcessorList(),r},e._updatePointerEventProcessorList=function(){for(var t=this._processorListToAdd,e=t.length,n=0;n<e;++n)this.addPointerEventProcessor(t[n]);t.length=0;for(var i=this._processorListToRemove,r=i.length,a=0;a<r;++a)this.removePointerEventProcessor(i[a]);i.length=0},e._sortPointerEventProcessorList=function(){if(this._isListDirty){for(var t=this._pointerEventProcessorList,e=t.length,n=0;n<e;++n){var i=t[n],r=i.node;if(r._uiProps){var a=r._uiProps.uiTransformComp;i.cachedCameraPriority=a.cameraPriority}}t.sort(this._sortByPriority),this._isListDirty=!1}},e._sortByPriority=function(t,e){var n=t.node,i=e.node;if(!(e&&i&&i.activeInHierarchy&&i._uiProps.uiTransformComp))return-1;if(!(t&&n&&n.activeInHierarchy&&n._uiProps.uiTransformComp))return 1;if(t.cachedCameraPriority!==e.cachedCameraPriority)return e.cachedCameraPriority-t.cachedCameraPriority;for(var r=n,a=i,o=!1;(null===(s=r.parent)||void 0===s?void 0:s._id)!==(null===(c=a.parent)||void 0===c?void 0:c._id);){var s,c,l,u,h,f;r=null===(null===(l=r)||void 0===l||null===(u=l.parent)||void 0===u?void 0:u.parent)?(o=!0)&&i:r&&r.parent,a=null===(null===(h=a)||void 0===h||null===(f=h.parent)||void 0===f?void 0:f.parent)?(o=!0)&&n:a&&a.parent}if(r._id===a._id){if(r._id===i._id)return-1;if(r._id===n._id)return 1}var _=r?r.getSiblingIndex():0,p=a?a.getSiblingIndex():0;return o?_-p:p-_},e._markListDirty=function(){this._isListDirty=!0},t}()),function(){function t(t,e){this._device=null,this._attributes=null,this._vertexFormatBytes=void 0,this._floatsPerVertex=void 0,this._buffers=[],this._device=t,this._attributes=e,this._floatsPerVertex=oW(e),this._vertexFormatBytes=this._floatsPerVertex*Float32Array.BYTES_PER_ELEMENT}var e=t.prototype;return e.initialize=function(){},e.reset=function(){},e.request=function(){},e.appendBuffers=function(){},e.uploadBuffers=function(){},e.destroy=function(){this._attributes.length=0},L(t,[{key:"attributes",get:function(){return this._attributes}},{key:"vertexFormatBytes",get:function(){return this._vertexFormatBytes}},{key:"floatsPerVertex",get:function(){return this._floatsPerVertex}}]),t}()),z0=new jt((function(){return{offset:0,length:0}}),32),U0=function(t,e,n,i){this.vertexAccessor=t,this.bufferId=e,this.vertexOffset=n,this.vb=i},k0=function(t){function e(n,i,r,a){var o;return(o=t.call(this,n,i)||this)._freeLists=[],o._vCount=0,o._iCount=0,o._vCount=r||Math.floor(1024*$t.BATCHER2D_MEM_INCREMENT/o._vertexFormatBytes),o._iCount=a||o._vCount*e.IB_SCALE,o._allocateBuffer(),o}F(e,t);var n=e.prototype;return n.destroy=function(){for(var e=0;e<this._buffers.length;++e){this._buffers[e].destroy();for(var n=this._freeLists[e],i=0;i<n.length;++i)z0.free(n[i])}this._buffers.length=0,this._freeLists.length=0,t.prototype.destroy.call(this)},n.reset=function(){for(var t=0;t<this._buffers.length;++t){var e=this._buffers[t];e.indexOffset=0,e.reset()}},n.getVertexBuffer=function(t){return this._buffers[t].vData},n.getIndexBuffer=function(t){return this._buffers[t].iData},n.getMeshBuffer=function(t){return this._buffers[t]},n.uploadBuffers=function(){for(var t=0;t<this._buffers.length;++t){var e=this._freeLists[t][0],n=this._buffers[t];(!e||e.length<n.vData.byteLength)&&n.uploadBuffers()}},n.appendIndices=function(t,e){var n=this._buffers[t];e.length&&(n.iData.set(e,n.indexOffset),n.indexOffset+=e.length)},n.allocateChunk=function(t,e){for(var n,i=t*this.vertexFormatBytes,r=null,a=0,o=-1,s=null,c=0;c<this._buffers.length;++c){r=this._buffers[c],n=this._freeLists[c];for(var l=0;l<n.length;++l)if(n[l].length>=i){s=n[l],a=c,o=l;break}if(s)break}if(s||(a=this._allocateBuffer(),(r=this._buffers[a])&&r.checkCapacity(t,e)&&(o=0,s=this._freeLists[a][o])),s){var u=s.offset/this.vertexFormatBytes,h=new Float32Array(r.vData.buffer,s.offset,i>>2).fill(0);return this._allocateChunkFromEntry(a,o,s,i),new U0(this,a,u,h,e)}return E(9004,i),null},n.recycleChunk=function(t){var e=this._freeLists[t.bufferId],n=this._buffers[t.bufferId],i=t.vertexOffset*this.vertexFormatBytes,r=t.vb.byteLength;if(0!==r){for(var a=!1,o=0,s=null,c=e[o];c&&c.offset<i;)s=c,c=e[++o];if(s&&0==i-(s.offset+s.length)&&(s.length+=r,i=s.offset,r=s.length,c&&c.offset-(i+r)==0&&(s.length+=c.length,e.splice(o,1),z0.free(c),c=null),a=!0),!a&&c){if(0==c.offset-(i+r))c.offset=i,c.length+=r;else{var l=z0.alloc();l.offset=i,l.length=r,e.splice(o,0,l)}a=!0}if(a)i+r===n.byteOffset&&(n.byteOffset=i);else{var u=z0.alloc();u.offset=i,u.length=r,e.push(u)}}},n._allocateChunkFromEntry=function(t,e,n,i){var r=n.length-i,a=n.offset+i,o=this._buffers[t];o.byteOffset<a&&(o.byteOffset=a),I(r>=0,9004,t,n.offset,n.length),0===r?(this._freeLists[t].splice(e,1),z0.free(n)):(n.offset+=i,n.length=r)},n._allocateBuffer=function(){I(this._buffers.length===this._freeLists.length,9003);var t=new N0,e=this._vCount*this._floatsPerVertex;t.initialize(this._device,this._attributes,e,this._iCount),this._buffers.push(t);var n=z0.alloc();n.offset=0,n.length=t.vData.byteLength;var i=[n];return this._freeLists.push(i),this._buffers.length-1},e}(F0);k0.IB_SCALE=4;var G0=new Ja(null),H0=new Ri,V0=t("UI",function(){function t(t){var e=this;this.device=void 0,this._screens=[],this._staticVBBuffer=null,this._bufferAccessors=new Map,this._drawBatchPool=void 0,this._batches=void 0,this._currBID=-1,this._indexStart=0,this._emptyMaterial=new bv,this._currRenderData=null,this._currMaterial=this._emptyMaterial,this._currTexture=null,this._currSampler=null,this._currStaticRoot=null,this._currComponent=null,this._currTransform=null,this._currTextureHash=0,this._currSamplerHash=0,this._currLayer=0,this._currDepthStencilStateStage=null,this._currIsStatic=!1,this._currHash=0,this._pOpacity=1,this._opacityDirty=0,this._descriptorSetCache=new W0,this._meshDataArray=[],this._root=t,this.device=t.device,this._batches=new Xt(64),this._drawBatchPool=new jt((function(){return new GZ}),128,(function(t){return t.destroy(e)}))}var e=t.prototype;return e.initialize=function(){return!0},e.destroy=function(){for(var t=0;t<this._batches.length;t++)this._batches.array[t]&&this._batches.array[t].destroy(this);this._batches.destroy(),this._bufferAccessors.forEach((function(t){t.destroy()})),this._bufferAccessors.clear(),this._drawBatchPool&&this._drawBatchPool.destroy(),this._descriptorSetCache.destroy(),rX.sharedManager.destroy()},e.addScreen=function(t){this._screens.push(t),this._screens.sort(this._screenSort)},e.removeScreen=function(t){var e=this._screens.indexOf(t);-1!==e&&this._screens.splice(e,1)},e.sortScreens=function(){this._screens.sort(this._screenSort)},e.getFirstRenderCamera=function(t){if(t.scene&&t.scene.renderScene)for(var e=t.scene.renderScene.cameras,n=0;n<e.length;n++){var i=e[n];if(i.visibility&t.layer)return i}return null},e.update=function(){for(var t=this._screens,e=0,n=0;n<t.length;++n){var i=t[n],r=i._getRenderScene();if(i.enabledInHierarchy&&r){this._opacityDirty=0,this._pOpacity=1,this.walk(i.node),this.autoMergeBatches(this._currComponent),this.resetRenderStates();var a=0;if(this._batches.length>e)for(;e<this._batches.length;++e){var o=this._batches.array[e];if(o.model)for(var s=o.model.subModels,c=0;c<s.length;c++)s[c].priority=a++;else o.descriptorSet=this._descriptorSetCache.getDescriptorSet(o);r.addBatch(o)}}}},e.uploadBuffers=function(){this._batches.length>0&&(this._meshDataArray.forEach((function(t){t.uploadBuffers()})),this._bufferAccessors.forEach((function(t){t.uploadBuffers(),t.reset()})),this._descriptorSetCache.update())},e.reset=function(){for(var t=0;t<this._batches.length;++t){var e=this._batches.array[t];e.isStatic||(e.clear(),this._drawBatchPool.free(e))}this._bufferAccessors.forEach((function(t){t.reset()})),this._meshDataArray.forEach((function(t){t.freeIAPool()})),this._meshDataArray.length=0,this._staticVBBuffer=null,this._currBID=-1,this._indexStart=0,this._currHash=0,this._currLayer=0,this._currRenderData=null,this._currMaterial=this._emptyMaterial,this._currTexture=null,this._currSampler=null,this._currComponent=null,this._currTransform=null,this._batches.clear(),rX.sharedManager.reset()},e.switchBufferAccessor=function(t){void 0===t&&(t=rW);var e=t===rW?36:sW(t);if(!this._staticVBBuffer||this._staticVBBuffer.vertexFormatBytes!==e){var n=this._bufferAccessors.get(e);n||(n=new k0(this.device,t),this._bufferAccessors.set(e,n)),this._staticVBBuffer=n,this._currBID=-1}return this._staticVBBuffer},e.registerBufferAccessor=function(t,e){this._bufferAccessors.set(t,e)},e.updateBuffer=function(t,e){var n=this.switchBufferAccessor(t);this._currBID!==e&&(this._currBID=e,this._indexStart=n.getMeshBuffer(e).indexOffset)},e.commitComp=function(t,e,n,i,r){var a,o=0,s=-1;if(e&&e.chunk){if(!e.isValid())return;o=e.dataHash,a=e.material,s=e.chunk.bufferId}t.stencilStage=rX.sharedManager.stage;var c=t.stencilStage;this._currHash===o&&0!==o&&this._currMaterial===a&&this._currDepthStencilStateStage===c||(this.autoMergeBatches(this._currComponent),e&&!e.isMeshBuffer&&this.updateBuffer(e.vertexFormat,s),this._currRenderData=e,this._currHash=e?e.dataHash:0,this._currComponent=t,this._currTransform=r,this._currMaterial=t.getRenderMaterial(0),this._currDepthStencilStateStage=c,this._currLayer=t.node.layer,n?(this._currTexture=n.getGFXTexture(),this._currSampler=n.getGFXSampler(),this._currTextureHash=n.getHash(),this._currSamplerHash=this._currSampler.hash):(this._currTexture=null,this._currSampler=null,this._currTextureHash=0,this._currSamplerHash=0)),i.fillBuffers(t,this)},e.commitIA=function(t,e,n,i,r){var a,o;this._currMaterial!==this._emptyMaterial&&(this.autoMergeBatches(this._currComponent),this.resetRenderStates());var s=0,c=0;t&&(a=-1===t.blendHash?null:t.getBlendState(),c=t.blendHash,t.stencilStage=rX.sharedManager.stage,o=null!==t.customMaterial?rX.sharedManager.getStencilStage(t.stencilStage,i):rX.sharedManager.getStencilStage(t.stencilStage),s=rX.sharedManager.getStencilHash(t.stencilStage));var l=this._currStaticRoot?this._currStaticRoot._requireDrawBatch():this._drawBatchPool.alloc();l.visFlags=t.node.layer,l.inputAssembler=e,l.useLocalData=r||null,n&&(l.texture=n.getGFXTexture(),l.sampler=n.getGFXSampler(),l.textureHash=n.getHash(),l.samplerHash=l.sampler.hash),l.fillPasses(i||null,o,s,a,c,null,this),this._batches.push(l)},e.commitModel=function(t,e,n){var r;this._currMaterial!==this._emptyMaterial&&(this.autoMergeBatches(this._currComponent),this.resetRenderStates());var a=0;n&&(t.stencilStage!==TW.ENABLED&&t.stencilStage!==TW.DISABLED||(t.stencilStage=rX.sharedManager.stage),r=rX.sharedManager.getStencilStage(t.stencilStage,n),a=rX.sharedManager.getStencilHash(t.stencilStage));var o=i.director.getTotalFrames();e&&(e.updateTransform(o),e.updateUBOs(o));for(var s=0;s<e.subModels.length;s++){var c=this._drawBatchPool.alloc(),l=e.subModels[s];c.visFlags=t.node.layer,c.model=e,c.texture=null,c.sampler=null,c.useLocalData=null,r||(r=null),c.fillPasses(n,r,a,null,0,l.patches,this),c.inputAssembler=l.inputAssembler,c.model.visFlags=c.visFlags,c.descriptorSet=l.descriptorSet,this._batches.push(c)}},e.setupStaticBatch=function(t,e){this.finishMergeBatches(),this._staticVBBuffer=e,this.currStaticRoot=t},e.endStaticBatch=function(){this.finishMergeBatches(),this.currStaticRoot=null,this._staticVBBuffer=null,this.switchBufferAccessor()},e.commitStaticBatch=function(t){this._batches.concat(t.drawBatchList),this.finishMergeBatches()},e.autoMergeBatches=function(t){var e=this._currMaterial;if(e){var n,i=this._currRenderData,r=this._staticVBBuffer;if(i&&i.isMeshBuffer)n=i.requestIA(this.device),-1===this._meshDataArray.indexOf(i)&&this._meshDataArray.push(i);else if(r){var a=this._currBID,o=r.getMeshBuffer(a);if(!o)return;var s=o.indexOffset-this._indexStart;if(s<=0)return;this._indexStart,o.indexOffset,o.setDirty(),(n=o.requireFreeIA(this.device)).firstIndex=this._indexStart,n.indexCount=s,this._indexStart=o.indexOffset}if(this._currBID=-1,n){var c,l,u=0,h=0;t&&(c=-1===t.blendHash?null:t.getBlendState(),h=t.blendHash,l=null!==t.customMaterial?rX.sharedManager.getStencilStage(t.stencilStage,e):rX.sharedManager.getStencilStage(t.stencilStage),u=rX.sharedManager.getStencilHash(t.stencilStage));var f=this._currStaticRoot?this._currStaticRoot._requireDrawBatch():this._drawBatchPool.alloc();f.visFlags=this._currLayer,f.texture=this._currTexture,f.sampler=this._currSampler,f.inputAssembler=n,f.useLocalData=this._currTransform,f.textureHash=this._currTextureHash,f.samplerHash=this._currSamplerHash,f.fillPasses(e,l,u,c,h,null,this),this._batches.push(f)}}},e.forceMergeBatches=function(t,e,n){this._currMaterial=t,e?(this._currTexture=e.getGFXTexture(),this._currSampler=e.getGFXSampler(),this._currTextureHash=e.getHash(),this._currSamplerHash=this._currSampler.hash):(this._currTexture=this._currSampler=null,this._currTextureHash=this._currSamplerHash=0),this._currLayer=n.node.layer,this.autoMergeBatches(n)},e.resetRenderStates=function(){this._currMaterial=this._emptyMaterial,this._currRenderData=null,this._currTexture=null,this._currComponent=null,this._currTransform=null,this._currTextureHash=0,this._currSamplerHash=0,this._currLayer=0},e.finishMergeBatches=function(){this.autoMergeBatches(),this.resetRenderStates()},e.flushMaterial=function(t){this._currMaterial=t},e.walk=function(t,e){if(void 0===e&&(e=0),t.activeInHierarchy){var n=t.children,i=t._uiProps,r=i.uiComp,a=this._pOpacity,o=a,s=r&&r.color?r.color.a/255:1;if(this._pOpacity=o*=s*i.localOpacity,i._opacity=o,i.colorDirty&&this._opacityDirty++,r&&r.enabledInHierarchy&&r.updateAssembler(this),this._opacityDirty&&r&&r.renderData&&r.renderData.vertexCount>0){!function(t,e){for(var n,i,r,a=t.vertexFormat,o=t.chunk.vb,s=0,c=0;c<a.length;++c){if(n=a[c],(i=lo[n.format]).hasAlpha)if(r=t.floatStride,i.size/i.count==1)for(var l=~~Yn(Math.round(255*e),0,255),u=s;u<o.length;u+=r)o[u]=(4294967040&o[u]|l)>>>0;else if(i.size/i.count==4)for(var h=s+3;h<o.length;h+=r)o[h]=e;s+=i.size>>2}}(r.renderData,o);var c=r.renderData.getMeshBuffer();c&&c.setDirty()}if(n.length>0&&!t._static)for(var l=0;l<n.length;++l){var u=n[l];this.walk(u,e)}i.colorDirty&&(this._opacityDirty--,i.colorDirty=!1),this._pOpacity=a,r&&r.enabledInHierarchy&&r.postUpdateAssembler(this),e+=1}},e._screenSort=function(t,e){return t.node.getSiblingIndex()-e.node.getSiblingIndex()},e._releaseDescriptorSetCache=function(t){this._descriptorSetCache.releaseDescriptorSetCache(t)},L(t,[{key:"currBufferAccessor",get:function(){return this._staticVBBuffer||(this._staticVBBuffer=this.switchBufferAccessor()),this._staticVBBuffer}},{key:"batches",get:function(){return this._batches}},{key:"currStaticRoot",set:function(t){this._currStaticRoot=t}},{key:"currIsStatic",set:function(t){this._currIsStatic=t}}]),t}()),j0=function(){function t(){this._descriptorSet=null,this._transform=null,this._textureHash=0,this._samplerHash=0,this._localBuffer=null,this._transformUpdate=!0;var t=i.director.root.device;this._localData=new Float32Array(hd.COUNT),this._localBuffer=t.createBuffer(new Ta(Er.UNIFORM|Er.TRANSFER_DST,wr.HOST|wr.DEVICE,hd.SIZE,hd.SIZE))}var e=t.prototype;return e.initialize=function(t){var e=i.director.root.device;this._transform=t.useLocalData,this._textureHash=t.textureHash,this._samplerHash=t.samplerHash,G0.layout=t.passes[0].localSetLayout,this._descriptorSet=e.createDescriptorSet(G0),this._descriptorSet.bindBuffer(hd.BINDING,this._localBuffer);var n=Vp.SAMPLER_SPRITE;this._descriptorSet.bindTexture(n,t.texture),this._descriptorSet.bindSampler(n,t.sampler),this._descriptorSet.update(),this._transformUpdate=!0},e.updateTransform=function(t){t!==this._transform&&(this._transform=t,this._transformUpdate=!0,this.uploadLocalData())},e.equals=function(t,e,n){return this._transform===t&&this._textureHash===e&&this._samplerHash===n},e.reset=function(){this._transform=null,this._textureHash=0,this._samplerHash=0},e.destroy=function(){this._localBuffer&&(this._localBuffer.destroy(),this._localBuffer=null),this._descriptorSet&&(this._descriptorSet.destroy(),this._descriptorSet=null),this._localData=null},e.isValid=function(){return this._transform&&this._transform.isValid},e.uploadLocalData=function(){var t=this._transform;if((t.hasChangedFlags||t._dirtyFlags)&&(t.updateWorldTransform(),this._transformUpdate=!0),this._transformUpdate){var e=t.worldMatrix;Ri.toArray(this._localData,e,hd.MAT_WORLD_OFFSET),Ri.inverseTranspose(H0,e);var n=Ri.determinant(H0),i=1/Math.sqrt(n);Ri.multiplyScalar(H0,H0,i),Ri.toArray(this._localData,H0,hd.MAT_WORLD_IT_OFFSET),this._localBuffer.update(this._localData),this._transformUpdate=!1}},L(t,[{key:"descriptorSet",get:function(){return this._descriptorSet}}]),t}(),W0=function(){function t(){this._descriptorSetCache=new Map,this._dsCacheHashByTexture=new Map,this._localDescriptorSetCache=[],this._localCachePool=void 0,this._localCachePool=new jt((function(){return new j0}),16,(function(t){return t.destroy()}))}var e=t.prototype;return e.getDescriptorSet=function(t){var e,n=i.director.root;if(t.useLocalData){for(var r=this._localDescriptorSetCache,a=0,o=r.length;a<o;a++){var s=r[a];if(s.equals(t.useLocalData,t.textureHash,t.samplerHash))return s.descriptorSet}var c=this._localCachePool.alloc();return c.initialize(t),this._localDescriptorSetCache.push(c),c.descriptorSet}if(e=t.textureHash^t.samplerHash,this._descriptorSetCache.has(e))return this._descriptorSetCache.get(e);G0.layout=t.passes[0].localSetLayout;var l=n.device.createDescriptorSet(G0),u=Vp.SAMPLER_SPRITE;return l.bindTexture(u,t.texture),l.bindSampler(u,t.sampler),l.update(),this._descriptorSetCache.set(e,l),this._dsCacheHashByTexture.set(t.textureHash,e),l},e.update=function(){var t=this._localDescriptorSetCache,e=[];t.forEach((function(n){if(n.isValid())n.uploadLocalData();else{n.reset();var i=t.indexOf(n);e.push(i)}}));for(var n=e.length-1;n>=0;n--)t.splice(e[n],1)},e.reset=function(){var t=this;this._localDescriptorSetCache.forEach((function(e){t._localCachePool.free(e)})),this._localDescriptorSetCache.length=0},e.releaseDescriptorSetCache=function(t){var e=this._dsCacheHashByTexture.get(t);e&&this._descriptorSetCache.has(e)&&(this._descriptorSetCache.get(e).destroy(),this._descriptorSetCache.delete(e),this._dsCacheHashByTexture.delete(t))},e.destroy=function(){this._descriptorSetCache.forEach((function(t){t.destroy()})),this._descriptorSetCache.clear(),this._dsCacheHashByTexture.clear(),this._localDescriptorSetCache.length=0,this._localCachePool.destroy()},t}();i.internal.Batcher2D=V0,Bn(N0.prototype,"MeshBuffer",["byteStart","vertexStart","indicesStart","request"].map((function(t){return{name:t,suggest:"please use meshBuffer.accessor."+t+" instead"}}))),Nn(N0.prototype,"MeshBuffer",[{name:"indicesOffset",newName:"indexOffset"}]),Ln(N0.prototype,"MeshBuffer",[{name:"vertexBuffers"},{name:"indexBuffer"}]),Nn(V0.prototype,"Batcher2D",[{name:"currBufferBatch",newName:"currBufferAccessor"},{name:"acquireBufferBatch",newName:"switchBufferAccessor"}]),Ln(PW.prototype,"MeshRenderData",[{name:"formatByte"},{name:"byteStart"},{name:"byteCount"}]),Nn(PW.prototype,"MeshRenderData",[{name:"indicesStart",newName:"indexStart"}]),t("QuadRenderData",function(t){function e(e){var n;return n=t.call(this,e)||this,E(9006),n}return F(e,t),e}(PW));var X0,q0,Y0,K0,Q0,Z0,J0,$0,t1,e1,n1,i1,r1,a1,o1,s1,c1,l1,u1,h1,f1,_1,p1,d1,m1,g1,v1,y1,x1,S1,T1,A1,E1,C1,b1,w1,P1,I1,R1,D1,O1,M1,N1,L1,B1,F1,z1,U1,k1,G1,H1,V1,j1,W1,X1,q1,Y1,K1,Q1,Z1,J1,$1=null,t2=-1,e2="BES bswy:->@123丁ぁᄁ",n2=Object.create(null),i2=[],r2=3e3;function a2(){for(var t=!0,e=Date.now(),n=i2.length-1;n>=0;n--){var i=i2[n],r=i.fontFamilyName;if(e-i.startTime>r2)E(4933,r),i.onComplete(null,r),i2.splice(n,1);else{var a=i.refWidth,o="40px "+r;$1.font=o,a!==Wj($1,e2,o)?(i2.splice(n,1),i.onComplete(null,r)):t=!1}}t&&(clearInterval(t2),t2=-1)}function o2(t,e,n){var i=function(t){var e=t.lastIndexOf(".ttf");if(-1===e)return t;var n,i=t.lastIndexOf("/");return-1!==(n=-1===i?t.substring(0,e)+"_LABEL":t.substring(i+1,e)+"_LABEL").indexOf(" ")&&(n='"'+n+'"'),n}(t);if(n2[i])n(null,i);else{if(!$1){var r=document.createElement("canvas");r.width=100,r.height=100,$1=r.getContext("2d")}var a=Wj($1,e2,"40px "+i),o=document.createElement("style");o.type="text/css";var s="";Number.isNaN(i)?s+="@font-face { font-family:"+i+"; src:":s+='@font-face { font-family:"'+i+'"; src:',s+='url("'+t+'");',o.textContent=s+"}",document.body.appendChild(o);var c=document.createElement("div"),l=c.style;if(l.fontFamily=i,c.innerHTML=".",l.position="absolute",l.left="-100px",l.top="-100px",document.body.appendChild(c),function(){if(void 0===X0)if("FontFace"in window){var t=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent),e=/OS X.*Version\/10\..*Safari/.exec(window.navigator.userAgent)&&/Apple/.exec(window.navigator.vendor);X0=t?parseInt(t[1],10)>42:!e}else X0=!1;return X0}())!function(t,e,n){var i=new Promise((function(n,i){!function r(){Date.now()-t>=r2?i():document.fonts.load("40px "+e).then((function(t){t.length>=1?n():setTimeout(r,100)}),(function(){i()}))}()})),r=null,a=new Promise((function(t,e){r=setTimeout(e,r2)}));Promise.race([a,i]).then((function(){r&&(clearTimeout(r),r=null),n(null,e)}),(function(){E(4933,e),n(null,e)}))}(Date.now(),i,n);else{var u={fontFamilyName:i,refWidth:a,onComplete:n,startTime:Date.now()};i2.push(u),-1===t2&&(t2=setInterval(a2,100))}n2[i]=o}}function s2(t,e,n,i){var r=new wj;r._nativeUrl=t,r._nativeAsset=e,i(null,r)}LN.register({".font":o2,".eot":o2,".ttf":o2,".woff":o2,".svg":o2,".ttc":o2}),HN.register({".font":s2,".eot":s2,".ttf":s2,".woff":s2,".svg":s2,".ttc":s2}),i.UI={MeshBuffer:N0,spriteAssembler:P0,graphicsAssembler:PJ,labelAssembler:K$,RenderData:wW,MeshRenderData:PW};var c2,l2,u2,h2=new _i;!function(t){t[t.NONE=0]="NONE",t[t.COLOR=1]="COLOR",t[t.SPRITE=2]="SPRITE",t[t.SCALE=3]="SCALE"}(c2||(c2={})),Zt(c2),function(t){t.NORMAL="normal",t.HOVER="hover",t.PRESSED="pressed",t.DISABLED="disabled"}(l2||(l2={})),function(t){t.CLICK="click"}(u2||(u2={}));var f2=function(e){return t({Button:e,ButtonComponent:e}),e}((q0=nl("cc.Button"),Y0=vl(),K0=rl(110),Q0=pl(),Z0=il(FW),J0=Bl(qC),$0=Il(),t1=Al(),e1=Il(),n1=Al(),i1=Bl(c2),r1=Il(),a1=Al(),o1=Il(),s1=Al(),c1=Il(),l1=Al(),u1=Il(),h1=Al(),f1=Il(),_1=Al(),p1=Cl(),d1=bl(),m1=Il(),g1=Al(),v1=Il(),y1=Al(),x1=Bl(uj),S1=Il(),T1=Al(),A1=Bl(uj),E1=Il(),C1=Al(),b1=Bl(uj),w1=Il(),P1=Al(),I1=Bl(uj),R1=Il(),D1=Al(),O1=Bl([GB]),M1=Il(),N1=Al(),q0(L1=Y0(L1=K0(L1=Q0(L1=Z0(L1=_l((J1=Z1=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return X(e=t.call.apply(t,[this].concat(i))||this,"clickEvents",F1,V(e)),X(e,"_interactable",z1,V(e)),X(e,"_transition",U1,V(e)),X(e,"_normalColor",k1,V(e)),X(e,"_hoverColor",G1,V(e)),X(e,"_pressedColor",H1,V(e)),X(e,"_disabledColor",V1,V(e)),X(e,"_normalSprite",j1,V(e)),X(e,"_hoverSprite",W1,V(e)),X(e,"_pressedSprite",X1,V(e)),X(e,"_disabledSprite",q1,V(e)),X(e,"_duration",Y1,V(e)),X(e,"_zoomScale",K1,V(e)),X(e,"_target",Q1,V(e)),e._pressed=!1,e._hovered=!1,e._fromColor=new _i,e._toColor=new _i,e._time=0,e._transitionFinished=!0,e._fromScale=new di,e._toScale=new di,e._originalScale=null,e._sprite=null,e._targetScale=new di,e}F(e,t);var n=e.prototype;return n.__preload=function(){this.target||(this.target=this.node);var t=this.node.getComponent(eQ);t&&(this._normalSprite=t.spriteFrame),this._applyTarget(),this._resetState()},n.onEnable=function(){this._registerNodeEvent()},n.onDisable=function(){this._resetState(),this._unregisterNodeEvent()},n.onDestroy=function(){this.target.isValid&&this._unregisterTargetEvent(this.target)},n.update=function(t){var e=this.target;if(!this._transitionFinished&&e&&(this._transition===c2.COLOR||this._transition===c2.SCALE)){this._time+=t;var n=1;if(this._duration>0&&(n=this._time/this._duration),n>=1&&(n=1),this._transition===c2.COLOR){var i=e._uiProps.uiComp;_i.lerp(h2,this._fromColor,this._toColor,n),i&&(i.color=h2)}else this.transition===c2.SCALE&&(e.getScale(this._targetScale),this._targetScale.x=Qn(this._fromScale.x,this._toScale.x,n),this._targetScale.y=Qn(this._fromScale.y,this._toScale.y,n),e.setScale(this._targetScale));1===n&&(this._transitionFinished=!0)}},n._resizeNodeToTargetNode=function(){this.target&&this.target._uiProps.uiTransformComp},n._resetState=function(){this._pressed=!1,this._hovered=!1;var t=this.target;if(t){var e=this._transition;if(e===c2.COLOR&&this._interactable){var n=t.getComponent(Sq);n&&(n.color=this._normalColor)}else e===c2.SCALE&&this._originalScale&&t.setScale(this._originalScale);this._transitionFinished=!0}},n._registerNodeEvent=function(){this.node.on(WA.TOUCH_START,this._onTouchBegan,this),this.node.on(WA.TOUCH_MOVE,this._onTouchMove,this),this.node.on(WA.TOUCH_END,this._onTouchEnded,this),this.node.on(WA.TOUCH_CANCEL,this._onTouchCancel,this),this.node.on(WA.MOUSE_ENTER,this._onMouseMoveIn,this),this.node.on(WA.MOUSE_LEAVE,this._onMouseMoveOut,this)},n._registerTargetEvent=function(t){t.on(WA.TRANSFORM_CHANGED,this._onTargetTransformChanged,this)},n._unregisterNodeEvent=function(){this.node.off(WA.TOUCH_START,this._onTouchBegan,this),this.node.off(WA.TOUCH_MOVE,this._onTouchMove,this),this.node.off(WA.TOUCH_END,this._onTouchEnded,this),this.node.off(WA.TOUCH_CANCEL,this._onTouchCancel,this),this.node.off(WA.MOUSE_ENTER,this._onMouseMoveIn,this),this.node.off(WA.MOUSE_LEAVE,this._onMouseMoveOut,this)},n._unregisterTargetEvent=function(t){t.off(WA.TRANSFORM_CHANGED)},n._getTargetSprite=function(t){var e=null;return t&&(e=t.getComponent(eQ)),e},n._applyTarget=function(){this.target&&(this._sprite=this._getTargetSprite(this.target),this._originalScale||(this._originalScale=new di),di.copy(this._originalScale,this.target.getScale()),this._registerTargetEvent(this.target))},n._onTargetSpriteFrameChanged=function(t){this._transition===c2.SPRITE&&this._setCurrentStateSpriteFrame(t.spriteFrame)},n._setCurrentStateSpriteFrame=function(t){if(t)switch(this._getButtonState()){case l2.NORMAL:this._normalSprite=t;break;case l2.HOVER:this._hoverSprite=t;break;case l2.PRESSED:this._pressedSprite=t;break;case l2.DISABLED:this._disabledSprite=t}},n._onTargetColorChanged=function(t){this._transition===c2.COLOR&&this._setCurrentStateColor(t)},n._setCurrentStateColor=function(t){switch(this._getButtonState()){case l2.NORMAL:this._normalColor=t;break;case l2.HOVER:this._hoverColor=t;break;case l2.PRESSED:this._pressedColor=t;break;case l2.DISABLED:this._disabledColor=t}},n._onTargetTransformChanged=function(t){t&Kg.SCALE&&this._originalScale&&this._transition===c2.SCALE&&this._transitionFinished&&di.copy(this._originalScale,this.target.getScale())},n._onTouchBegan=function(t){this._interactable&&this.enabledInHierarchy&&(this._pressed=!0,this._updateState(),t&&(t.propagationStopped=!0))},n._onTouchMove=function(t){if(this._interactable&&this.enabledInHierarchy&&this._pressed&&t){var e=t.touch;if(e){var n,i=this.node._uiProps.uiTransformComp.isHit(e.getUILocation());this._transition===c2.SCALE&&this.target&&this._originalScale?i?(di.copy(this._fromScale,this._originalScale),di.multiplyScalar(this._toScale,this._originalScale,this._zoomScale),this._transitionFinished=!1):(this._time=0,this._transitionFinished=!0,this.target.setScale(this._originalScale)):(n=i?l2.PRESSED:l2.NORMAL,this._applyTransition(n)),t&&(t.propagationStopped=!0)}}},n._onTouchEnded=function(t){this._interactable&&this.enabledInHierarchy&&(this._pressed&&(GB.emitEvents(this.clickEvents,t),this.node.emit(u2.CLICK,this)),this._pressed=!1,this._updateState(),t&&(t.propagationStopped=!0))},n._onTouchCancel=function(){this._interactable&&this.enabledInHierarchy&&(this._pressed=!1,this._updateState())},n._onMouseMoveIn=function(){!this._pressed&&this.interactable&&this.enabledInHierarchy&&(this._transition!==c2.SPRITE||this._hoverSprite)&&(this._hovered||(this._hovered=!0,this._updateState()))},n._onMouseMoveOut=function(){this._hovered&&(this._hovered=!1,this._updateState())},n._updateState=function(){var t=this._getButtonState();this._applyTransition(t)},n._getButtonState=function(){var t=l2.NORMAL;return this._interactable?this._pressed?t=l2.PRESSED:this._hovered&&(t=l2.HOVER):t=l2.DISABLED,t.toString()},n._updateColorTransition=function(t){var e,n=this[t+"Color"],i=null===(e=this.target)||void 0===e?void 0:e.getComponent(Sq);i&&(t===l2.DISABLED?i.color=n:(this._fromColor=i.color.clone(),this._toColor=n,this._time=0,this._transitionFinished=!1))},n._updateSpriteTransition=function(t){var e=this[t+"Sprite"];this._sprite&&e&&(this._sprite.spriteFrame=e)},n._updateScaleTransition=function(t){this._interactable&&(t===l2.PRESSED?this._zoomUp():this._zoomBack())},n._zoomUp=function(){this._originalScale&&(di.copy(this._fromScale,this._originalScale),di.multiplyScalar(this._toScale,this._originalScale,this._zoomScale),this._time=0,this._transitionFinished=!1)},n._zoomBack=function(){this.target&&this._originalScale&&(di.copy(this._fromScale,this.target.getScale()),di.copy(this._toScale,this._originalScale),this._time=0,this._transitionFinished=!1)},n._applyTransition=function(t){var e=this._transition;e===c2.COLOR?this._updateColorTransition(t):e===c2.SPRITE?this._updateSpriteTransition(t):e===c2.SCALE&&this._updateScaleTransition(t)},L(e,[{key:"target",get:function(){return this._target||this.node},set:function(t){this._target!==t&&(this._target&&this._unregisterTargetEvent(this._target),this._target=t,this._applyTarget())}},{key:"interactable",get:function(){return this._interactable},set:function(t){this._interactable=t,this._updateState(),this._interactable||this._resetState()}},{key:"_resizeToTarget",set:function(t){t&&this._resizeNodeToTargetNode()}},{key:"transition",get:function(){return this._transition},set:function(t){this._transition!==t&&(this._transition===c2.COLOR?this._updateColorTransition(l2.NORMAL):this._transition===c2.SPRITE&&this._updateSpriteTransition(l2.NORMAL),this._transition=t,this._updateState())}},{key:"normalColor",get:function(){return this._normalColor},set:function(t){this._normalColor!==t&&(this._normalColor.set(t),this._updateState())}},{key:"pressedColor",get:function(){return this._pressedColor},set:function(t){this._pressedColor!==t&&this._pressedColor.set(t)}},{key:"hoverColor",get:function(){return this._hoverColor},set:function(t){this._hoverColor!==t&&this._hoverColor.set(t)}},{key:"disabledColor",get:function(){return this._disabledColor},set:function(t){this._disabledColor!==t&&(this._disabledColor.set(t),this._updateState())}},{key:"duration",get:function(){return this._duration},set:function(t){this._duration!==t&&(this._duration=t)}},{key:"zoomScale",get:function(){return this._zoomScale},set:function(t){this._zoomScale!==t&&(this._zoomScale=t)}},{key:"normalSprite",get:function(){return this._normalSprite},set:function(t){if(this._normalSprite!==t){this._normalSprite=t;var e=this.node.getComponent(eQ);e&&(e.spriteFrame=t),this._updateState()}}},{key:"pressedSprite",get:function(){return this._pressedSprite},set:function(t){this._pressedSprite!==t&&(this._pressedSprite=t,this._updateState())}},{key:"hoverSprite",get:function(){return this._hoverSprite},set:function(t){this._hoverSprite!==t&&(this._hoverSprite=t,this._updateState())}},{key:"disabledSprite",get:function(){return this._disabledSprite},set:function(t){this._disabledSprite!==t&&(this._disabledSprite=t,this._updateState())}}]),e}($u),Z1.Transition=c2,Z1.EventType=u2,q((B1=J1).prototype,"target",[J0,$0,t1],Object.getOwnPropertyDescriptor(B1.prototype,"target"),B1.prototype),q(B1.prototype,"interactable",[e1,n1],Object.getOwnPropertyDescriptor(B1.prototype,"interactable"),B1.prototype),q(B1.prototype,"transition",[i1,r1,a1],Object.getOwnPropertyDescriptor(B1.prototype,"transition"),B1.prototype),q(B1.prototype,"normalColor",[o1,s1],Object.getOwnPropertyDescriptor(B1.prototype,"normalColor"),B1.prototype),q(B1.prototype,"pressedColor",[c1,l1],Object.getOwnPropertyDescriptor(B1.prototype,"pressedColor"),B1.prototype),q(B1.prototype,"hoverColor",[u1,h1],Object.getOwnPropertyDescriptor(B1.prototype,"hoverColor"),B1.prototype),q(B1.prototype,"disabledColor",[f1,_1],Object.getOwnPropertyDescriptor(B1.prototype,"disabledColor"),B1.prototype),q(B1.prototype,"duration",[p1,d1,m1,g1],Object.getOwnPropertyDescriptor(B1.prototype,"duration"),B1.prototype),q(B1.prototype,"zoomScale",[v1,y1],Object.getOwnPropertyDescriptor(B1.prototype,"zoomScale"),B1.prototype),q(B1.prototype,"normalSprite",[x1,S1,T1],Object.getOwnPropertyDescriptor(B1.prototype,"normalSprite"),B1.prototype),q(B1.prototype,"pressedSprite",[A1,E1,C1],Object.getOwnPropertyDescriptor(B1.prototype,"pressedSprite"),B1.prototype),q(B1.prototype,"hoverSprite",[b1,w1,P1],Object.getOwnPropertyDescriptor(B1.prototype,"hoverSprite"),B1.prototype),q(B1.prototype,"disabledSprite",[I1,R1,D1],Object.getOwnPropertyDescriptor(B1.prototype,"disabledSprite"),B1.prototype),F1=q(B1.prototype,"clickEvents",[O1,cl,M1,N1],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),z1=q(B1.prototype,"_interactable",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),U1=q(B1.prototype,"_transition",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return c2.NONE}}),k1=q(B1.prototype,"_normalColor",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return _i.WHITE.clone()}}),G1=q(B1.prototype,"_hoverColor",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new _i(211,211,211,255)}}),H1=q(B1.prototype,"_pressedColor",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return _i.WHITE.clone()}}),V1=q(B1.prototype,"_disabledColor",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new _i(124,124,124,255)}}),j1=q(B1.prototype,"_normalSprite",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W1=q(B1.prototype,"_hoverSprite",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),X1=q(B1.prototype,"_pressedSprite",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q1=q(B1.prototype,"_disabledSprite",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Y1=q(B1.prototype,"_duration",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),K1=q(B1.prototype,"_zoomScale",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.2}}),Q1=q(B1.prototype,"_target",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L1=B1))||L1)||L1)||L1)||L1)||L1)||L1));i.Button=f2;var _2,p2,d2,m2=function(){function t(){}return t.add=function(t){var e=this._tabIndexList;-1===e.indexOf(t)&&e.push(t)},t.remove=function(t){var e=this._tabIndexList,n=e.indexOf(t);-1!==n&&e.splice(n,1)},t.resort=function(){this._tabIndexList.sort((function(t,e){return t._delegate.tabIndex-e._delegate.tabIndex}))},t.next=function(t){var e=this._tabIndexList,n=e.indexOf(t);if(t.setFocus(!1),-1!==n){var i=e[n+1];i&&i._delegate.tabIndex>=0&&i.setFocus(!0)}},t}();m2._tabIndexList=[],function(t){t[t.DEFAULT=0]="DEFAULT",t[t.DONE=1]="DONE",t[t.SEND=2]="SEND",t[t.SEARCH=3]="SEARCH",t[t.GO=4]="GO",t[t.NEXT=5]="NEXT"}(_2||(_2={})),Yt(_2),function(t){t[t.ANY=0]="ANY",t[t.EMAIL_ADDR=1]="EMAIL_ADDR",t[t.NUMERIC=2]="NUMERIC",t[t.PHONE_NUMBER=3]="PHONE_NUMBER",t[t.URL=4]="URL",t[t.DECIMAL=5]="DECIMAL",t[t.SINGLE_LINE=6]="SINGLE_LINE"}(p2||(p2={})),Yt(p2),function(t){t[t.PASSWORD=0]="PASSWORD",t[t.SENSITIVE=1]="SENSITIVE",t[t.INITIAL_CAPS_WORD=2]="INITIAL_CAPS_WORD",t[t.INITIAL_CAPS_SENTENCE=3]="INITIAL_CAPS_SENTENCE",t[t.INITIAL_CAPS_ALL_CHARACTERS=4]="INITIAL_CAPS_ALL_CHARACTERS",t[t.DEFAULT=5]="DEFAULT"}(d2||(d2={})),Yt(d2);var g2,v2,y2,x2,S2,T2,A2,E2,C2,b2,w2,P2,I2,R2,D2,O2,M2,N2,L2,B2,F2,z2,U2,k2,G2,H2,V2,j2,W2,X2,q2,Y2,K2,Q2,Z2,J2,$2,t4,e4,n4,i4,r4,a4,o4,s4,c4,l4,u4,h4,f4,_4,p4,d4,m4,g4,v4,y4,x4,S4,T4,A4,E4=function(){function t(){this._editing=!1,this._delegate=null}var e=t.prototype;return e.init=function(){},e.onEnable=function(){},e.update=function(){},e.onDisable=function(){this._editing&&this.endEditing()},e.clear=function(){this._delegate=null},e.setTabIndex=function(){},e.setSize=function(){},e.setFocus=function(t){t?this.beginEditing():this.endEditing()},e.isFocused=function(){return this._editing},e.beginEditing=function(){},e.endEditing=function(){},t}(),C4=new Ri,b4=new Ri,w4=new di,P4=null,I4=0,R4=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._delegate=null,e._inputMode=-1,e._inputFlag=-1,e._returnType=-1,e.__eventListeners={},e.__autoResize=!1,e.__orientationChanged=void 0,e._edTxt=null,e._isTextArea=!1,e._textLabelFont=null,e._textLabelFontSize=null,e._textLabelFontColor=null,e._textLabelAlign=null,e._placeholderLabelFont=null,e._placeholderLabelFontSize=null,e._placeholderLabelFontColor=null,e._placeholderLabelAlign=null,e._placeholderLineHeight=null,e._placeholderStyleSheet=null,e._domId="EditBoxId_"+ ++I4,e}F(e,t);var n=e.prototype;return n.init=function(t){t&&(this._delegate=t,t.inputMode===p2.ANY?this._createTextArea():this._createInput(),m2.add(this),this.setTabIndex(t.tabIndex),this._initStyleSheet(),this._registerEventListeners(),this._addDomToGameContainer())},n.clear=function(){this._removeEventListeners(),this._removeDomFromGameContainer(),m2.remove(this),P4===this&&(P4=null),this._delegate=null},n.update=function(){this._updateMatrix()},n.setTabIndex=function(t){this._edTxt.tabIndex=t,m2.resort()},n.setSize=function(t,e){var n=this._edTxt;n&&(n.style.width=t+"px",n.style.height=e+"px")},n.beginEditing=function(){P4&&P4!==this&&P4.setFocus(!1),this._editing=!0,P4=this,this._delegate._editBoxEditingDidBegan(),this._showDom(),this._edTxt.focus()},n.endEditing=function(){this._edTxt.blur()},n._createInput=function(){this._isTextArea=!1,this._edTxt=document.createElement("input")},n._createTextArea=function(){this._isTextArea=!0,this._edTxt=document.createElement("textarea")},n._addDomToGameContainer=function(){i.GAME_VIEW&&this._edTxt?(i.gameView.container.appendChild(this._edTxt),i.gameView.head.appendChild(this._placeholderStyleSheet)):VM.container&&this._edTxt&&(VM.container.appendChild(this._edTxt),document.head.appendChild(this._placeholderStyleSheet))},n._removeDomFromGameContainer=function(){(i.GAME_VIEW?se(i.gameView.container,this._edTxt):se(VM.container,this._edTxt))&&this._edTxt&&(i.GAME_VIEW?i.gameView.container.removeChild(this._edTxt):VM.container.removeChild(this._edTxt)),(i.GAME_VIEW?se(i.gameView.head,this._placeholderStyleSheet):se(document.head,this._placeholderStyleSheet))&&(i.GAME_VIEW?i.gameView.head.removeChild(this._placeholderStyleSheet):document.head.removeChild(this._placeholderStyleSheet)),this._edTxt=null,this._placeholderStyleSheet=null},n._showDom=function(){this._updateMaxLength(),this._updateInputType(),this._updateStyleSheet(),this._edTxt&&this._delegate&&(this._edTxt.style.display="",this._delegate._hideLabels()),lh.isMobile&&this._showDomOnMobile()},n._hideDom=function(){var t=this._edTxt;t&&this._delegate&&(t.style.display="none",this._delegate._showLabels()),lh.isMobile&&this._hideDomOnMobile()},n._showDomOnMobile=function(){lh.os!==ln.ANDROID&&lh.os!==ln.OHOS||(oh.handleResizeEvent=!1,this._adjustWindowScroll())},n._hideDomOnMobile=function(){lh.os!==ln.ANDROID&&lh.os!==ln.OHOS||(oh.handleResizeEvent=!0),this._scrollBackWindow()},n._adjustWindowScroll=function(){var t=this;setTimeout((function(){window.scrollY<40&&t._edTxt.scrollIntoView({block:"start",inline:"nearest",behavior:"smooth"})}),400)},n._scrollBackWindow=function(){setTimeout((function(){lh.browserType!==on.WECHAT||lh.os!==ln.IOS?window.scrollTo(0,0):window.top&&window.top.scrollTo(0,0)}),400)},n._updateMatrix=function(){if(this._edTxt){var t=this._delegate.node,e=eN.getScaleX(),n=eN.getScaleY(),r=1,a=1;i.GAME_VIEW&&(r=i.gameView.canvas.width/i.game.canvas.width,a=i.gameView.canvas.height/i.game.canvas.height),e*=r,n*=a;var o=eN.getViewportRect(),s=oh.devicePixelRatio;t.getWorldMatrix(C4);var c=t._uiProps.uiTransformComp;if(c&&di.set(w4,-c.anchorX*c.width,-c.anchorY*c.height,w4.z),Ri.transform(C4,C4,w4),t._uiProps.uiTransformComp){var l=WM.root.batcher2D.getFirstRenderCamera(t);if(l){l.node.getWorldRT(b4);var u=b4.m12,h=b4.m13,f=YM.center;b4.m12=f.x-(b4.m00*u+b4.m04*h),b4.m13=f.y-(b4.m01*u+b4.m05*h),Ri.multiply(b4,b4,C4),e/=s,n/=s;var _=i.GAME_VIEW?i.gameView.container:VM.container,p=b4.m00*e,d=C4.m01,m=C4.m04,g=b4.m05*n,v=parseInt(_&&_.style.paddingLeft||"0");v+=o.x*r/s;var y=parseInt(_&&_.style.paddingBottom||"0");y+=o.y/s;var x="matrix("+p+","+-d+","+-m+","+g+","+(b4.m12*e+v)+","+-(b4.m13*n+y)+")";this._edTxt.style.transform=x,this._edTxt.style["-webkit-transform"]=x,this._edTxt.style["transform-origin"]="0px 100% 0px",this._edTxt.style["-webkit-transform-origin"]="0px 100% 0px"}}}},n._updateInputType=function(){var t=this._delegate,e=t.inputMode,n=t.inputFlag,i=t.returnType,r=this._edTxt;if(this._inputMode!==e||this._inputFlag!==n||this._returnType!==i){if(this._inputMode=e,this._inputFlag=n,this._returnType=i,this._isTextArea){var a="none";return n===d2.INITIAL_CAPS_ALL_CHARACTERS?a="uppercase":n===d2.INITIAL_CAPS_WORD&&(a="capitalize"),void(r.style.textTransform=a)}if(r=r,n===d2.PASSWORD)return r.type="password",void(r.style.textTransform="none");var o=r.type;e===p2.EMAIL_ADDR?o="email":e===p2.NUMERIC||e===p2.DECIMAL?o="number":e===p2.PHONE_NUMBER?(o="number",r.pattern="[0-9]*",r.addEventListener("wheel",(function(){return!1}))):e===p2.URL?o="url":(o="text",i===_2.SEARCH&&(o="search")),r.type=o;var s="none";n===d2.INITIAL_CAPS_ALL_CHARACTERS?s="uppercase":n===d2.INITIAL_CAPS_WORD&&(s="capitalize"),r.style.textTransform=s}},n._updateMaxLength=function(){var t=this._delegate.maxLength;t<0&&(t=65535),this._edTxt.maxLength=t},n._initStyleSheet=function(){if(this._edTxt){var t=this._edTxt;t.style.color="#000000",t.style.border="0px",t.style.background="transparent",t.style.width="100%",t.style.height="100%",t.style.outline="medium",t.style.padding="0",t.style.textTransform="none",t.style.display="none",t.style.position="absolute",t.style.bottom="0px",t.style.left="2px",t.className="cocosEditBox",t.style.fontFamily="Arial",t.id=this._domId,this._isTextArea?(t.style.resize="none",t.style.overflowY="scroll"):((t=t).type="text",t.style["-moz-appearance"]="textfield"),this._placeholderStyleSheet=document.createElement("style")}},n._updateStyleSheet=function(){var t=this._delegate,e=this._edTxt;e&&t&&(e.value=t.string,e.placeholder=t.placeholder,this._updateTextLabel(t.textLabel),this._updatePlaceholderLabel(t.placeholderLabel))},n._updateTextLabel=function(t){if(t){var e=t.font;e=!e||e instanceof Dj?t.fontFamily:e._fontFamily;var n=t.fontSize*t.node.scale.y;if((this._textLabelFont!==e||this._textLabelFontSize!==n||this._textLabelFontColor!==t.fontColor||this._textLabelAlign!==t.horizontalAlign)&&(this._textLabelFont=e,this._textLabelFontSize=n,this._textLabelFontColor=t.fontColor,this._textLabelAlign=t.horizontalAlign,this._edTxt)){var i=this._edTxt;switch(i.style.fontSize=n+"px",i.style.color=t.color.toCSS(),i.style.fontFamily=e,t.horizontalAlign){case Cq.HorizontalAlign.LEFT:i.style.textAlign="left";break;case Cq.HorizontalAlign.CENTER:i.style.textAlign="center";break;case Cq.HorizontalAlign.RIGHT:i.style.textAlign="right"}}}},n._updatePlaceholderLabel=function(t){if(t){var e=t.font;e=!e||e instanceof Dj?t.fontFamily:t.font._fontFamily;var n=t.fontSize*t.node.scale.y;if(this._placeholderLabelFont!==e||this._placeholderLabelFontSize!==n||this._placeholderLabelFontColor!==t.fontColor||this._placeholderLabelAlign!==t.horizontalAlign||this._placeholderLineHeight!==t.fontSize){this._placeholderLabelFont=e,this._placeholderLabelFontSize=n,this._placeholderLabelFontColor=t.fontColor,this._placeholderLabelAlign=t.horizontalAlign,this._placeholderLineHeight=t.fontSize;var i=this._placeholderStyleSheet,r=t.color.toCSS(),a=t.fontSize,o="";switch(t.horizontalAlign){case Cq.HorizontalAlign.LEFT:o="left";break;case Cq.HorizontalAlign.CENTER:o="center";break;case Cq.HorizontalAlign.RIGHT:o="right"}i.innerHTML="#"+this._domId+"::-webkit-input-placeholder{text-transform: initial;-family: "+e+";font-size: "+n+"px;color: "+r+";line-height: "+a+"px;text-align: "+o+";}#"+this._domId+"::-moz-placeholder{text-transform: initial;-family: "+e+";font-size: "+n+"px;color: "+r+";line-height: "+a+"px;text-align: "+o+";}#"+this._domId+"::-ms-input-placeholder{text-transform: initial;-family: "+e+";font-size: "+n+"px;color: "+r+";line-height: "+a+"px;text-align: "+o+";}",lh.browserType===on.EDGE&&(i.innerHTML+="#"+this._domId+"::-ms-clear{display: none;}")}}},n._registerEventListeners=function(){var t=this;if(this._edTxt){var e=this._edTxt,n=!1,i=this.__eventListeners;i.compositionStart=function(){n=!0},i.compositionEnd=function(){n=!1,t._delegate._editBoxTextChanged(e.value)},i.onInput=function(){if(!n){var i=t._delegate,r=i.maxLength;r>=0&&(e.value=e.value.slice(0,r)),i._editBoxTextChanged(e.value)}},i.onClick=function(){t._editing&&lh.isMobile&&t._adjustWindowScroll()},i.onKeydown=function(n){n.keyCode===QR.ENTER?(n.propagationStopped=!0,t._delegate._editBoxEditingReturn(),t._isTextArea||e.blur()):n.keyCode===QR.TAB&&(n.propagationStopped=!0,n.preventDefault(),m2.next(t))},i.onBlur=function(){lh.isMobile&&n&&i.compositionEnd(),t._editing=!1,P4=null,t._hideDom(),t._delegate._editBoxEditingDidEnded()},e.addEventListener("compositionstart",i.compositionStart),e.addEventListener("compositionend",i.compositionEnd),e.addEventListener("input",i.onInput),e.addEventListener("keydown",i.onKeydown),e.addEventListener("blur",i.onBlur),e.addEventListener("touchstart",i.onClick)}},n._removeEventListeners=function(){if(this._edTxt){var t=this._edTxt,e=this.__eventListeners;t.removeEventListener("compositionstart",e.compositionStart),t.removeEventListener("compositionend",e.compositionEnd),t.removeEventListener("input",e.onInput),t.removeEventListener("keydown",e.onKeydown),t.removeEventListener("blur",e.onBlur),t.removeEventListener("touchstart",e.onClick),e.compositionStart=null,e.compositionEnd=null,e.onInput=null,e.onKeydown=null,e.onBlur=null,e.onClick=null}},e}(E4);!function(t){t.EDITING_DID_BEGAN="editing-did-began",t.EDITING_DID_ENDED="editing-did-ended",t.TEXT_CHANGED="text-changed",t.EDITING_RETURN="editing-return"}(A4||(A4={}));var D4,O4,M4,N4,L4,B4,F4,z4,U4,k4,G4,H4,V4,j4,W4,X4,q4,Y4,K4,Q4,Z4,J4,$4,t3,e3,n3,i3,r3,a3,o3,s3,c3,l3,u3,h3,f3,_3,p3,d3,m3,g3,v3,y3,x3,S3,T3,A3,E3,C3,b3,w3,P3,I3,R3,D3,O3,M3,N3,L3,B3,F3,z3=function(e){return t({EditBox:e,EditBoxComponent:e}),e}((g2=nl("cc.EditBox"),v2=vl(),y2=rl(110),x2=pl(),S2=il(FW),T2=Il(),A2=Al(),E2=Il(),C2=Al(),b2=Bl(Cq),w2=Il(),P2=Al(),I2=Bl(Cq),R2=Il(),D2=Al(),O2=Bl(uj),M2=Il(),N2=Al(),L2=Bl(d2),B2=Il(),F2=Al(),z2=Bl(p2),U2=Il(),k2=Al(),G2=Bl(_2),H2=Il(),V2=Al(),j2=Il(),W2=Al(),X2=Il(),q2=Al(),Y2=Bl([GB]),K2=Il(),Q2=Al(),Z2=Bl([GB]),J2=Il(),$2=Al(),t4=Bl([GB]),e4=Il(),n4=Al(),i4=Bl([GB]),r4=Il(),a4=Al(),g2(o4=v2(o4=y2(o4=x2(o4=S2(o4=_l((T4=S4=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return X(e=t.call.apply(t,[this].concat(i))||this,"editingDidBegan",c4,V(e)),X(e,"textChanged",l4,V(e)),X(e,"editingDidEnded",u4,V(e)),X(e,"editingReturn",h4,V(e)),e._impl=null,e._background=null,X(e,"_textLabel",f4,V(e)),X(e,"_placeholderLabel",_4,V(e)),X(e,"_returnType",p4,V(e)),X(e,"_string",d4,V(e)),X(e,"_tabIndex",m4,V(e)),X(e,"_backgroundImage",g4,V(e)),X(e,"_inputFlag",v4,V(e)),X(e,"_inputMode",y4,V(e)),X(e,"_maxLength",x4,V(e)),e._isLabelVisible=!1,e}F(e,t);var n=e.prototype;return n.__preload=function(){this._init()},n.onEnable=function(){this._registerEvent(),this._ensureBackgroundSprite(),this._impl&&this._impl.onEnable()},n.update=function(){this._impl&&this._impl.update()},n.onDisable=function(){this._unregisterEvent(),this._unregisterBackgroundEvent(),this._impl&&this._impl.onDisable()},n.onDestroy=function(){this._impl&&this._impl.clear()},n.setFocus=function(){this._impl&&this._impl.setFocus(!0)},n.focus=function(){this._impl&&this._impl.setFocus(!0)},n.blur=function(){this._impl&&this._impl.setFocus(!1)},n.isFocused=function(){return!!this._impl&&this._impl.isFocused()},n._editBoxEditingDidBegan=function(){GB.emitEvents(this.editingDidBegan,this),this.node.emit(A4.EDITING_DID_BEGAN,this)},n._editBoxEditingDidEnded=function(){GB.emitEvents(this.editingDidEnded,this),this.node.emit(A4.EDITING_DID_ENDED,this)},n._editBoxTextChanged=function(t){t=this._updateLabelStringStyle(t,!0),this.string=t,GB.emitEvents(this.textChanged,t,this),this.node.emit(A4.TEXT_CHANGED,this)},n._editBoxEditingReturn=function(){GB.emitEvents(this.editingReturn,this),this.node.emit(A4.EDITING_RETURN,this)},n._showLabels=function(){this._isLabelVisible=!0,this._updateLabels()},n._hideLabels=function(){this._isLabelVisible=!1,this._textLabel&&(this._textLabel.node.active=!1),this._placeholderLabel&&(this._placeholderLabel.node.active=!1)},n._onTouchBegan=function(t){t.propagationStopped=!0},n._onTouchCancel=function(t){t.propagationStopped=!0},n._onTouchEnded=function(t){this._impl&&this._impl.beginEditing(),t.propagationStopped=!0},n._init=function(){this._updatePlaceholderLabel(),this._updateTextLabel(),this._isLabelVisible=!0,this.node.on(WA.SIZE_CHANGED,this._resizeChildNodes,this),(this._impl=new e._EditBoxImpl).init(this),this._updateString(this._string),this._syncSize()},n._ensureBackgroundSprite=function(){if(!this._background){var t=this.node.getComponent(eQ);t||(t=this.node.addComponent(eQ)),t!==this._background&&(t.type=eQ.Type.SLICED,t.spriteFrame=this._backgroundImage,this._background=t,this._registerBackgroundEvent())}},n._updateTextLabel=function(){var t=this._textLabel;if(!t){var e=this.node.getChildByName("TEXT_LABEL");e||((e=new qC("TEXT_LABEL")).layer=this.node.layer),(t=e.getComponent(Cq))||(t=e.addComponent(Cq)),e.parent=this.node,this._textLabel=t}this._textLabel.node._uiProps.uiTransformComp.setAnchorPoint(0,1),t.overflow=Cq.Overflow.CLAMP,this._inputMode===p2.ANY?(t.verticalAlign=vq.TOP,t.enableWrapText=!0):t.enableWrapText=!1,t.string=this._updateLabelStringStyle(this._string)},n._updatePlaceholderLabel=function(){var t=this._placeholderLabel;if(!t){var e=this.node.getChildByName("PLACEHOLDER_LABEL");e||((e=new qC("PLACEHOLDER_LABEL")).layer=this.node.layer),(t=e.getComponent(Cq))||(t=e.addComponent(Cq)),e.parent=this.node,this._placeholderLabel=t}this._placeholderLabel.node._uiProps.uiTransformComp.setAnchorPoint(0,1),t.overflow=Cq.Overflow.CLAMP,this._inputMode===p2.ANY?(t.verticalAlign=vq.TOP,t.enableWrapText=!0):t.enableWrapText=!1,t.string=this.placeholder},n._syncSize=function(){var t=this.node._uiProps.uiTransformComp,e=t.contentSize;if(this._background){var n=this._background.node._uiProps.uiTransformComp;n.anchorPoint=t.anchorPoint,n.setContentSize(e)}this._updateLabelPosition(e),this._impl&&this._impl.setSize(e.width,e.height)},n._updateLabels=function(){if(this._isLabelVisible){var t=this._string;this._textLabel&&(this._textLabel.node.active=""!==t),this._placeholderLabel&&(this._placeholderLabel.node.active=""===t)}},n._updateString=function(t){var e=this._textLabel;if(e){var n=t;n&&(n=this._updateLabelStringStyle(n)),e.string=n,this._updateLabels()}},n._updateLabelStringStyle=function(t,e){void 0===e&&(e=!1);var n,i=this._inputFlag;if(e||i!==d2.PASSWORD)i===d2.INITIAL_CAPS_ALL_CHARACTERS?t=t.toUpperCase():i===d2.INITIAL_CAPS_WORD?t=t.replace(/(?:^|\s)\S/g,(function(t){return t.toUpperCase()})):i===d2.INITIAL_CAPS_SENTENCE&&(t=(n=t).charAt(0).toUpperCase()+n.slice(1));else{for(var r="",a=t.length,o=0;o<a;++o)r+="●";t=r}return t},n._registerEvent=function(){this.node.on(WA.TOUCH_START,this._onTouchBegan,this),this.node.on(WA.TOUCH_END,this._onTouchEnded,this)},n._unregisterEvent=function(){this.node.off(WA.TOUCH_START,this._onTouchBegan,this),this.node.off(WA.TOUCH_END,this._onTouchEnded,this)},n._onBackgroundSpriteFrameChanged=function(){this._background&&(this.backgroundImage=this._background.spriteFrame)},n._registerBackgroundEvent=function(){var t=this._background&&this._background.node;null==t||t.on(eQ.EventType.SPRITE_FRAME_CHANGED,this._onBackgroundSpriteFrameChanged,this)},n._unregisterBackgroundEvent=function(){var t=this._background&&this._background.node;null==t||t.off(eQ.EventType.SPRITE_FRAME_CHANGED,this._onBackgroundSpriteFrameChanged,this)},n._updateLabelPosition=function(t){var e=this.node._uiProps.uiTransformComp,n=-e.anchorX*e.width,i=-e.anchorY*e.height,r=this._placeholderLabel,a=this._textLabel;a&&(a.node._uiProps.uiTransformComp.setContentSize(t.width-2,t.height),a.node.setPosition(n+2,i+t.height,a.node.position.z),this._inputMode===p2.ANY&&(a.verticalAlign=vq.TOP),a.enableWrapText=this._inputMode===p2.ANY),r&&(r.node._uiProps.uiTransformComp.setContentSize(t.width-2,t.height),r.lineHeight=t.height,r.node.setPosition(n+2,i+t.height,r.node.position.z),this._inputMode===p2.ANY&&(r.verticalAlign=vq.TOP),r.enableWrapText=this._inputMode===p2.ANY)},n._resizeChildNodes=function(){var t=this.node._uiProps.uiTransformComp,e=this._textLabel&&this._textLabel.node;e&&(e.setPosition(-t.width/2,t.height/2,e.position.z),e._uiProps.uiTransformComp.setContentSize(t.contentSize));var n=this._placeholderLabel&&this._placeholderLabel.node;n&&(n.setPosition(-t.width/2,t.height/2,n.position.z),n._uiProps.uiTransformComp.setContentSize(t.contentSize));var i=this._background&&this._background.node;i&&i._uiProps.uiTransformComp.setContentSize(t.contentSize),this._syncSize()},L(e,[{key:"string",get:function(){return this._string},set:function(t){this._maxLength>=0&&t.length>=this._maxLength&&(t=t.slice(0,this._maxLength)),this._string=t,this._updateString(t)}},{key:"placeholder",get:function(){return this._placeholderLabel?this._placeholderLabel.string:""},set:function(t){this._placeholderLabel&&(this._placeholderLabel.string=t)}},{key:"textLabel",get:function(){return this._textLabel},set:function(t){this._textLabel!==t&&(this._textLabel=t,this._textLabel&&(this._updateTextLabel(),this._updateLabels()))}},{key:"placeholderLabel",get:function(){return this._placeholderLabel},set:function(t){this._placeholderLabel!==t&&(this._placeholderLabel=t,this._placeholderLabel&&(this._updatePlaceholderLabel(),this._updateLabels()))}},{key:"backgroundImage",get:function(){return this._backgroundImage},set:function(t){this._backgroundImage!==t&&(this._backgroundImage=t,this._ensureBackgroundSprite(),this._background.spriteFrame=t)}},{key:"inputFlag",get:function(){return this._inputFlag},set:function(t){this._inputFlag=t,this._updateString(this._string)}},{key:"inputMode",get:function(){return this._inputMode},set:function(t){this._inputMode!==t&&(this._inputMode=t,this._updateTextLabel(),this._updatePlaceholderLabel())}},{key:"returnType",get:function(){return this._returnType},set:function(t){this._returnType=t}},{key:"maxLength",get:function(){return this._maxLength},set:function(t){this._maxLength=t}},{key:"tabIndex",get:function(){return this._tabIndex},set:function(t){this._tabIndex!==t&&(this._tabIndex=t,this._impl&&this._impl.setTabIndex(t))}}]),e}($u),S4._EditBoxImpl=E4,S4.KeyboardReturnType=_2,S4.InputFlag=d2,S4.InputMode=p2,S4.EventType=A4,q((s4=T4).prototype,"string",[T2,A2],Object.getOwnPropertyDescriptor(s4.prototype,"string"),s4.prototype),q(s4.prototype,"placeholder",[E2,C2],Object.getOwnPropertyDescriptor(s4.prototype,"placeholder"),s4.prototype),q(s4.prototype,"textLabel",[b2,w2,P2],Object.getOwnPropertyDescriptor(s4.prototype,"textLabel"),s4.prototype),q(s4.prototype,"placeholderLabel",[I2,R2,D2],Object.getOwnPropertyDescriptor(s4.prototype,"placeholderLabel"),s4.prototype),q(s4.prototype,"backgroundImage",[O2,M2,N2],Object.getOwnPropertyDescriptor(s4.prototype,"backgroundImage"),s4.prototype),q(s4.prototype,"inputFlag",[L2,B2,F2],Object.getOwnPropertyDescriptor(s4.prototype,"inputFlag"),s4.prototype),q(s4.prototype,"inputMode",[z2,U2,k2],Object.getOwnPropertyDescriptor(s4.prototype,"inputMode"),s4.prototype),q(s4.prototype,"returnType",[G2,H2,V2],Object.getOwnPropertyDescriptor(s4.prototype,"returnType"),s4.prototype),q(s4.prototype,"maxLength",[j2,W2],Object.getOwnPropertyDescriptor(s4.prototype,"maxLength"),s4.prototype),q(s4.prototype,"tabIndex",[X2,q2],Object.getOwnPropertyDescriptor(s4.prototype,"tabIndex"),s4.prototype),c4=q(s4.prototype,"editingDidBegan",[Y2,cl,K2,Q2],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),l4=q(s4.prototype,"textChanged",[Z2,cl,J2,$2],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),u4=q(s4.prototype,"editingDidEnded",[t4,cl,e4,n4],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),h4=q(s4.prototype,"editingReturn",[i4,cl,r4,a4],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),f4=q(s4.prototype,"_textLabel",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_4=q(s4.prototype,"_placeholderLabel",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),p4=q(s4.prototype,"_returnType",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return _2.DEFAULT}}),d4=q(s4.prototype,"_string",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),m4=q(s4.prototype,"_tabIndex",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),g4=q(s4.prototype,"_backgroundImage",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v4=q(s4.prototype,"_inputFlag",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return d2.DEFAULT}}),y4=q(s4.prototype,"_inputMode",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return p2.ANY}}),x4=q(s4.prototype,"_maxLength",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),o4=s4))||o4)||o4)||o4)||o4)||o4)||o4));"object"==typeof window&&"object"==typeof document&&(z3._EditBoxImpl=R4),i.internal.EditBox=z3,function(t){t[t.NONE=0]="NONE",t[t.HORIZONTAL=1]="HORIZONTAL",t[t.VERTICAL=2]="VERTICAL",t[t.GRID=3]="GRID"}(O3||(O3={})),Zt(O3),function(t){t[t.NONE=0]="NONE",t[t.CONTAINER=1]="CONTAINER",t[t.CHILDREN=2]="CHILDREN"}(M3||(M3={})),Zt(M3),function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL"}(N3||(N3={})),Zt(N3),function(t){t[t.BOTTOM_TO_TOP=0]="BOTTOM_TO_TOP",t[t.TOP_TO_BOTTOM=1]="TOP_TO_BOTTOM"}(L3||(L3={})),Zt(L3),function(t){t[t.LEFT_TO_RIGHT=0]="LEFT_TO_RIGHT",t[t.RIGHT_TO_LEFT=1]="RIGHT_TO_LEFT"}(B3||(B3={})),Zt(B3),function(t){t[t.NONE=0]="NONE",t[t.FIXED_ROW=1]="FIXED_ROW",t[t.FIXED_COL=2]="FIXED_COL"}(F3||(F3={})),Zt(F3);var U3,k3,G3,H3,V3,j3,W3,X3,q3,Y3,K3,Q3,Z3,J3,$3,t5,e5,n5,i5,r5,a5,o5,s5,c5=new di,l5=function(e){return t({Layout:e,LayoutComponent:e}),e}((D4=nl("cc.Layout"),O4=vl(),M4=rl(110),N4=pl(),L4=il(FW),B4=xl(),F4=Al(),z4=xl(),U4=Al(),k4=Bl(O3),G4=Il(),H4=Al(),V4=Bl(M3),j4=xl(),W4=Al(),X4=xl(),q4=Al(),Y4=Bl(N3),K4=Al(),Q4=Al(),Z4=Al(),J4=Al(),$4=Al(),t3=Al(),e3=Al(),n3=Bl(L3),i3=Al(),r3=Bl(B3),a3=Al(),o3=Bl(F3),s3=xl(),c3=Al(),l3=xl(),u3=Al(),h3=Al(),D4(f3=O4(f3=M4(f3=N4(f3=L4(f3=_l((D3=R3=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return X(e=t.call.apply(t,[this].concat(i))||this,"_resizeMode",p3,V(e)),X(e,"_layoutType",d3,V(e)),X(e,"_cellSize",m3,V(e)),X(e,"_startAxis",g3,V(e)),X(e,"_paddingLeft",v3,V(e)),X(e,"_paddingRight",y3,V(e)),X(e,"_paddingTop",x3,V(e)),X(e,"_paddingBottom",S3,V(e)),X(e,"_spacingX",T3,V(e)),X(e,"_spacingY",A3,V(e)),X(e,"_verticalDirection",E3,V(e)),X(e,"_horizontalDirection",C3,V(e)),X(e,"_constraint",b3,V(e)),X(e,"_constraintNum",w3,V(e)),X(e,"_affectedByScale",P3,V(e)),X(e,"_isAlign",I3,V(e)),e._layoutSize=new Gi(300,200),e._layoutDirty=!0,e._childrenDirty=!1,e._usefulLayoutObj=[],e._init=!1,e}F(e,t);var n=e.prototype;return n.updateLayout=function(t){void 0===t&&(t=!1),(this._layoutDirty||t)&&this.node.children.length>0&&(this._doLayout(),this._layoutDirty=!1)},n.onEnable=function(){this._addEventListeners();var t=this.node._uiProps.uiTransformComp;t.contentSize.equals(Gi.ZERO)&&t.setContentSize(this._layoutSize),this._childrenChanged()},n.onDisable=function(){this._usefulLayoutObj.length=0,this._removeEventListeners()},n._checkUsefulObj=function(){this._usefulLayoutObj.length=0;for(var t=this.node.children,e=0;e<t.length;++e){var n=t[e],i=n._uiProps.uiTransformComp;n.activeInHierarchy&&i&&this._usefulLayoutObj.push(i)}},n._addEventListeners=function(){WM.on(jM.EVENT_AFTER_UPDATE,this.updateLayout,this),this.node.on(WA.SIZE_CHANGED,this._resized,this),this.node.on(WA.ANCHOR_CHANGED,this._doLayoutDirty,this),this.node.on(WA.CHILD_ADDED,this._childAdded,this),this.node.on(WA.CHILD_REMOVED,this._childRemoved,this),this.node.on(WA.SIBLING_ORDER_CHANGED,this._childrenChanged,this),this.node.on("childrenSiblingOrderChanged",this.updateLayout,this),this._addChildrenEventListeners()},n._removeEventListeners=function(){WM.off(jM.EVENT_AFTER_UPDATE,this.updateLayout,this),this.node.off(WA.SIZE_CHANGED,this._resized,this),this.node.off(WA.ANCHOR_CHANGED,this._doLayoutDirty,this),this.node.off(WA.CHILD_ADDED,this._childAdded,this),this.node.off(WA.CHILD_REMOVED,this._childRemoved,this),this.node.off(WA.SIBLING_ORDER_CHANGED,this._childrenChanged,this),this.node.off("childrenSiblingOrderChanged",this.updateLayout,this),this._removeChildrenEventListeners()},n._addChildrenEventListeners=function(){for(var t=this.node.children,e=0;e<t.length;++e){var n=t[e];n.on(WA.SIZE_CHANGED,this._doLayoutDirty,this),n.on(WA.TRANSFORM_CHANGED,this._transformDirty,this),n.on(WA.ANCHOR_CHANGED,this._doLayoutDirty,this),n.on(WA.ACTIVE_IN_HIERARCHY_CHANGED,this._childrenChanged,this)}},n._removeChildrenEventListeners=function(){for(var t=this.node.children,e=0;e<t.length;++e){var n=t[e];n.off(WA.SIZE_CHANGED,this._doLayoutDirty,this),n.off(WA.TRANSFORM_CHANGED,this._transformDirty,this),n.off(WA.ANCHOR_CHANGED,this._doLayoutDirty,this),n.off(WA.ACTIVE_IN_HIERARCHY_CHANGED,this._childrenChanged,this)}},n._childAdded=function(t){t.on(WA.SIZE_CHANGED,this._doLayoutDirty,this),t.on(WA.TRANSFORM_CHANGED,this._transformDirty,this),t.on(WA.ANCHOR_CHANGED,this._doLayoutDirty,this),t.on(WA.ACTIVE_IN_HIERARCHY_CHANGED,this._childrenChanged,this),this._childrenChanged()},n._childRemoved=function(t){t.off(WA.SIZE_CHANGED,this._doLayoutDirty,this),t.off(WA.TRANSFORM_CHANGED,this._transformDirty,this),t.off(WA.ANCHOR_CHANGED,this._doLayoutDirty,this),t.off(WA.ACTIVE_IN_HIERARCHY_CHANGED,this._childrenChanged,this),this._childrenChanged()},n._resized=function(){this._layoutSize.set(this.node._uiProps.uiTransformComp.contentSize),this._doLayoutDirty()},n._doLayoutHorizontally=function(t,e,n,i){var r=this.node._uiProps.uiTransformComp.anchorPoint,a=this._getFixedBreakingNum(),o=1,s=this._paddingLeft;this._horizontalDirection===B3.RIGHT_TO_LEFT&&(o=-1,s=this._paddingRight);var c=(this._horizontalDirection-r.x)*t+o*s,l=c-o*this._spacingX,u=0,h=0,f=0,_=0,p=!1,d=this._usefulLayoutObj.length,m=this._cellSize.width,g=this._getPaddingH();this._layoutType!==O3.GRID&&this._resizeMode===M3.CHILDREN&&(m=(t-g-(d-1)*this._spacingX)/d);for(var v=this._usefulLayoutObj,y=0;y<v.length;++y){var x=v[y],S=x.node,T=S.scale,A=this._getUsedScaleValue(T.x),E=this._getUsedScaleValue(T.y);this._resizeMode===M3.CHILDREN&&(x.width=m/A,this._layoutType===O3.GRID&&(x.height=this._cellSize.height/E));var C=Math.abs(this._horizontalDirection-x.anchorX),b=x.width*A,w=x.height*E;w>f&&(_=Math.max(f,_),h=f||w,f=w),l+=o*(C*b+this._spacingX);var P=o*(1-C)*b;if(e){if(a>0)(p=y/a>0&&y%a==0)&&(h=f>w?f:h);else if(b>t-g)l>c+o*C*b&&(p=!0);else{var I=(1-this._horizontalDirection-r.x)*t,R=l+P+o*(o>0?this._paddingRight:this._paddingLeft);p=Math.abs(R)>Math.abs(I)}p&&(l=c+o*C*b,w!==f&&(h=f),u+=h+this._spacingY,h=f=w)}var D=n(S,x,u);i&&S.setPosition(l,D),l+=P}return h=Math.max(h,f),Math.max(_,u+h)+this._getPaddingV()},n._doLayoutVertically=function(t,e,n,i){var r=this.node._uiProps.uiTransformComp.anchorPoint,a=this._getFixedBreakingNum(),o=1,s=this._paddingBottom;this._verticalDirection===L3.TOP_TO_BOTTOM&&(o=-1,s=this._paddingTop);var c=(this._verticalDirection-r.y)*t+o*s,l=c-o*this._spacingY,u=0,h=0,f=0,_=0,p=!1,d=this._usefulLayoutObj.length,m=this._cellSize.height,g=this._getPaddingV();this._layoutType!==O3.GRID&&this._resizeMode===M3.CHILDREN&&(m=(t-g-(d-1)*this._spacingY)/d);for(var v=this._usefulLayoutObj,y=0;y<v.length;++y){var x=v[y],S=x.node,T=S.scale,A=this._getUsedScaleValue(T.x),E=this._getUsedScaleValue(T.y);this._resizeMode===M3.CHILDREN&&(x.height=m/E,this._layoutType===O3.GRID&&(x.width=this._cellSize.width/A));var C=Math.abs(this._verticalDirection-x.anchorY),b=x.width*A,w=x.height*E;b>u&&(h=Math.max(u,h),f=u||b,u=b),l+=o*(C*w+this._spacingY);var P=o*(1-C)*w;if(e){if(a>0)(p=y/a>0&&y%a==0)&&(f=u>w?u:f);else if(w>t-g)l>c+o*C*w&&(p=!0);else{var I=(1-this._verticalDirection-r.y)*t,R=l+P+o*(o>0?this._paddingTop:this._paddingBottom);p=Math.abs(R)>Math.abs(I)}p&&(l=c+o*C*w,b!==u&&(f=u),_+=f+this._spacingX,f=u=b)}var D=n(S,x,_);i&&(S.getPosition(c5),S.setPosition(D,l,c5.z)),l+=P}return f=Math.max(f,u),Math.max(h,_+f)+this._getPaddingH()},n._doLayoutGridAxisHorizontal=function(t,e){var n=this,i=e.width,r=1,a=-t.y*e.height,o=this._paddingBottom;this._verticalDirection===L3.TOP_TO_BOTTOM&&(r=-1,a=(1-t.y)*e.height,o=this._paddingTop);var s=function(t,e,i){return a+r*(i+(1-e.anchorY)*e.height*n._getUsedScaleValue(t.scale.y)+o)},c=0;this._resizeMode===M3.CONTAINER&&(c=this._doLayoutHorizontally(i,!0,s,!1),a=-t.y*c,this._verticalDirection===L3.TOP_TO_BOTTOM&&(r=-1,a=(1-t.y)*c)),this._doLayoutHorizontally(i,!0,s,!0),this._resizeMode===M3.CONTAINER&&this.node._uiProps.uiTransformComp.setContentSize(i,c)},n._doLayoutGridAxisVertical=function(t,e){var n=this,i=e.height,r=1,a=-t.x*e.width,o=this._paddingLeft;this._horizontalDirection===B3.RIGHT_TO_LEFT&&(r=-1,a=(1-t.x)*e.width,o=this._paddingRight);var s=function(t,e,i){return a+r*(i+(1-e.anchorX)*e.width*n._getUsedScaleValue(t.scale.x)+o)},c=0;this._resizeMode===M3.CONTAINER&&(c=this._doLayoutVertically(i,!0,s,!1),a=-t.x*c,this._horizontalDirection===B3.RIGHT_TO_LEFT&&(r=-1,a=(1-t.x)*c)),this._doLayoutVertically(i,!0,s,!0),this._resizeMode===M3.CONTAINER&&this.node._uiProps.uiTransformComp.setContentSize(c,i)},n._doLayoutGrid=function(){var t=this.node._uiProps.uiTransformComp,e=t.anchorPoint,n=t.contentSize;this.startAxis===N3.HORIZONTAL?this._doLayoutGridAxisHorizontal(e,n):this.startAxis===N3.VERTICAL&&this._doLayoutGridAxisVertical(e,n)},n._getHorizontalBaseWidth=function(){var t=this._usefulLayoutObj,e=0,n=t.length;if(this._resizeMode===M3.CONTAINER){for(var i=0;i<t.length;++i){var r=t[i],a=r.node.scale;e+=r.width*this._getUsedScaleValue(a.x)}e+=(n-1)*this._spacingX+this._getPaddingH()}else e=this.node._uiProps.uiTransformComp.width;return e},n._getVerticalBaseHeight=function(){var t=this._usefulLayoutObj,e=0,n=t.length;if(this._resizeMode===M3.CONTAINER){for(var i=0;i<t.length;++i){var r=t[i],a=r.node.scale;e+=r.height*this._getUsedScaleValue(a.y)}e+=(n-1)*this._spacingY+this._getPaddingV()}else e=this.node._uiProps.uiTransformComp.height;return e},n._doLayout=function(){var t=this;if(this._init&&!this._childrenDirty||(this._checkUsefulObj(),this._init=!0,this._childrenDirty=!1),this._layoutType===O3.HORIZONTAL){var e=this._getHorizontalBaseWidth();this._doLayoutHorizontally(e,!1,(function(e){return(t._isAlign?di.ZERO:e.position).y}),!0),this.node._uiProps.uiTransformComp.width=e}else if(this._layoutType===O3.VERTICAL){var n=this._getVerticalBaseHeight();this._doLayoutVertically(n,!1,(function(e){return(t._isAlign?di.ZERO:e.position).x}),!0),this.node._uiProps.uiTransformComp.height=n}else this._layoutType===O3.GRID&&this._doLayoutGrid()},n._getUsedScaleValue=function(t){return this._affectedByScale?Math.abs(t):1},n._transformDirty=function(t){t&Kg.SCALE&&t&Kg.POSITION&&this._affectedByScale&&this._doLayoutDirty()},n._doLayoutDirty=function(){this._layoutDirty=!0},n._childrenChanged=function(){this._childrenDirty=!0,this._doLayoutDirty()},n._getPaddingH=function(){return this._paddingLeft+this._paddingRight},n._getPaddingV=function(){return this._paddingTop+this._paddingBottom},n._getFixedBreakingNum=function(){if(this._layoutType!==O3.GRID||this._constraint===F3.NONE||this._constraintNum<=0)return 0;var t=this._constraint===F3.FIXED_ROW?Math.ceil(this._usefulLayoutObj.length/this._constraintNum):this._constraintNum;return this._startAxis===N3.VERTICAL&&(t=this._constraint===F3.FIXED_COL?Math.ceil(this._usefulLayoutObj.length/this._constraintNum):this._constraintNum),t},L(e,[{key:"alignHorizontal",get:function(){return this._isAlign},set:function(t){this._layoutType===O3.HORIZONTAL&&(this._isAlign=t,this._doLayoutDirty())}},{key:"alignVertical",get:function(){return this._isAlign},set:function(t){this._layoutType===O3.VERTICAL&&(this._isAlign=t,this._doLayoutDirty())}},{key:"type",get:function(){return this._layoutType},set:function(t){this._layoutType=t,this._doLayoutDirty()}},{key:"resizeMode",get:function(){return this._resizeMode},set:function(t){this._layoutType!==O3.NONE&&(this._resizeMode=t,this._doLayoutDirty())}},{key:"cellSize",get:function(){return this._cellSize},set:function(t){this._cellSize!==t&&(this._cellSize.set(t),this._doLayoutDirty())}},{key:"startAxis",get:function(){return this._startAxis},set:function(t){this._startAxis!==t&&(this._startAxis=t,this._doLayoutDirty())}},{key:"paddingLeft",get:function(){return this._paddingLeft},set:function(t){this._paddingLeft!==t&&(this._paddingLeft=t,this._doLayoutDirty())}},{key:"paddingRight",get:function(){return this._paddingRight},set:function(t){this._paddingRight!==t&&(this._paddingRight=t,this._doLayoutDirty())}},{key:"paddingTop",get:function(){return this._paddingTop},set:function(t){this._paddingTop!==t&&(this._paddingTop=t,this._doLayoutDirty())}},{key:"paddingBottom",get:function(){return this._paddingBottom},set:function(t){this._paddingBottom!==t&&(this._paddingBottom=t,this._doLayoutDirty())}},{key:"spacingX",get:function(){return this._spacingX},set:function(t){this._spacingX!==t&&(this._spacingX=t,this._doLayoutDirty())}},{key:"spacingY",get:function(){return this._spacingY},set:function(t){this._spacingY!==t&&(this._spacingY=t,this._doLayoutDirty())}},{key:"verticalDirection",get:function(){return this._verticalDirection},set:function(t){this._verticalDirection!==t&&(this._verticalDirection=t,this._doLayoutDirty())}},{key:"horizontalDirection",get:function(){return this._horizontalDirection},set:function(t){this._horizontalDirection!==t&&(this._horizontalDirection=t,this._doLayoutDirty())}},{key:"padding",get:function(){return this._paddingLeft},set:function(t){this.paddingLeft===t&&this._paddingRight===t&&this._paddingTop===t&&this._paddingBottom===t||(this._paddingLeft=this._paddingRight=this._paddingTop=this._paddingBottom=t,this._doLayoutDirty())}},{key:"constraint",get:function(){return this._constraint},set:function(t){this._layoutType!==O3.NONE&&this._constraint!==t&&(this._constraint=t,this._doLayoutDirty())}},{key:"constraintNum",get:function(){return this._constraintNum},set:function(t){this._constraint!==F3.NONE&&this._constraintNum!==t&&(t<=0&&p("Limit values to be greater than 0"),this._constraintNum=t,this._doLayoutDirty())}},{key:"affectedByScale",get:function(){return this._affectedByScale},set:function(t){this._affectedByScale=t,this._doLayoutDirty()}}]),e}($u),R3.Type=O3,R3.VerticalDirection=L3,R3.HorizontalDirection=B3,R3.ResizeMode=M3,R3.AxisDirection=N3,R3.Constraint=F3,q((_3=D3).prototype,"alignHorizontal",[B4,F4],Object.getOwnPropertyDescriptor(_3.prototype,"alignHorizontal"),_3.prototype),q(_3.prototype,"alignVertical",[z4,U4],Object.getOwnPropertyDescriptor(_3.prototype,"alignVertical"),_3.prototype),q(_3.prototype,"type",[k4,G4,H4],Object.getOwnPropertyDescriptor(_3.prototype,"type"),_3.prototype),q(_3.prototype,"resizeMode",[V4,j4,W4],Object.getOwnPropertyDescriptor(_3.prototype,"resizeMode"),_3.prototype),q(_3.prototype,"cellSize",[X4,q4],Object.getOwnPropertyDescriptor(_3.prototype,"cellSize"),_3.prototype),q(_3.prototype,"startAxis",[Y4,K4],Object.getOwnPropertyDescriptor(_3.prototype,"startAxis"),_3.prototype),q(_3.prototype,"paddingLeft",[Q4],Object.getOwnPropertyDescriptor(_3.prototype,"paddingLeft"),_3.prototype),q(_3.prototype,"paddingRight",[Z4],Object.getOwnPropertyDescriptor(_3.prototype,"paddingRight"),_3.prototype),q(_3.prototype,"paddingTop",[J4],Object.getOwnPropertyDescriptor(_3.prototype,"paddingTop"),_3.prototype),q(_3.prototype,"paddingBottom",[$4],Object.getOwnPropertyDescriptor(_3.prototype,"paddingBottom"),_3.prototype),q(_3.prototype,"spacingX",[t3],Object.getOwnPropertyDescriptor(_3.prototype,"spacingX"),_3.prototype),q(_3.prototype,"spacingY",[e3],Object.getOwnPropertyDescriptor(_3.prototype,"spacingY"),_3.prototype),q(_3.prototype,"verticalDirection",[n3,i3],Object.getOwnPropertyDescriptor(_3.prototype,"verticalDirection"),_3.prototype),q(_3.prototype,"horizontalDirection",[r3,a3],Object.getOwnPropertyDescriptor(_3.prototype,"horizontalDirection"),_3.prototype),q(_3.prototype,"constraint",[o3,s3,c3],Object.getOwnPropertyDescriptor(_3.prototype,"constraint"),_3.prototype),q(_3.prototype,"constraintNum",[l3,u3],Object.getOwnPropertyDescriptor(_3.prototype,"constraintNum"),_3.prototype),q(_3.prototype,"affectedByScale",[h3],Object.getOwnPropertyDescriptor(_3.prototype,"affectedByScale"),_3.prototype),p3=q(_3.prototype,"_resizeMode",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return M3.NONE}}),d3=q(_3.prototype,"_layoutType",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return O3.NONE}}),m3=q(_3.prototype,"_cellSize",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Gi(40,40)}}),g3=q(_3.prototype,"_startAxis",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return N3.HORIZONTAL}}),v3=q(_3.prototype,"_paddingLeft",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),y3=q(_3.prototype,"_paddingRight",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),x3=q(_3.prototype,"_paddingTop",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),S3=q(_3.prototype,"_paddingBottom",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),T3=q(_3.prototype,"_spacingX",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),A3=q(_3.prototype,"_spacingY",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),E3=q(_3.prototype,"_verticalDirection",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return L3.TOP_TO_BOTTOM}}),C3=q(_3.prototype,"_horizontalDirection",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return B3.LEFT_TO_RIGHT}}),b3=q(_3.prototype,"_constraint",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return F3.NONE}}),w3=q(_3.prototype,"_constraintNum",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),P3=q(_3.prototype,"_affectedByScale",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),I3=q(_3.prototype,"_isAlign",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),f3=_3))||f3)||f3)||f3)||f3)||f3)||f3));i.Layout=l5,function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL",t[t.FILLED=2]="FILLED"}(s5||(s5={})),Yt(s5);var u5,h5,f5,_5,p5,d5,m5,g5,v5,y5,x5,S5,T5,A5,E5,C5,b5,w5,P5,I5,R5,D5,O5,M5,N5=function(e){return t({ProgressBar:e,ProgressBarComponent:e}),e}((U3=nl("cc.ProgressBar"),k3=vl(),G3=rl(110),H3=pl(),V3=il(FW),j3=Bl(eQ),W3=Al(),X3=Bl(s5),q3=Al(),Y3=Al(),K3=El(),Q3=Al(),Z3=Al(),U3(J3=k3(J3=G3(J3=H3(J3=V3((o5=a5=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return X(e=t.call.apply(t,[this].concat(i))||this,"_barSprite",t5,V(e)),X(e,"_mode",e5,V(e)),X(e,"_totalLength",n5,V(e)),X(e,"_progress",i5,V(e)),X(e,"_reverse",r5,V(e)),e}F(e,t);var n=e.prototype;return n._initBarSprite=function(){if(this._barSprite){var t=this._barSprite.node;if(!t)return;var e=this.node._uiProps.uiTransformComp,n=e.contentSize,i=e.anchorPoint,r=t._uiProps.uiTransformComp.contentSize;if(this._barSprite.fillType===eQ.FillType.RADIAL&&(this._mode=s5.FILLED),this._mode===s5.HORIZONTAL?this.totalLength=r.width:this._mode===s5.VERTICAL?this.totalLength=r.height:this.totalLength=this._barSprite.fillRange,t.parent===this.node){var a=-n.width*i.x;t.setPosition(a,0,0)}}},n._updateBarStatus=function(){if(this._barSprite){var t=this._barSprite.node;if(!t)return;var e=t._uiProps.uiTransformComp,n=e.anchorPoint,i=e.contentSize,r=t.getPosition(),a=new Ni(0,.5),o=Kn(this._progress),s=this._totalLength*o,c=i,l=0,u=0;switch(this._mode){case s5.HORIZONTAL:this._reverse&&(a=new Ni(1,.5)),c=new Gi(s,i.height),l=this._totalLength,u=i.height;break;case s5.VERTICAL:a=this._reverse?new Ni(.5,1):new Ni(.5,0),c=new Gi(i.width,s),l=i.width,u=this._totalLength}if(this._mode===s5.FILLED)this._barSprite.type!==eQ.Type.FILLED?p("ProgressBar FILLED mode only works when barSprite's Type is FILLED!"):(this._reverse&&(s*=-1),this._barSprite.fillRange=s);else if(this._barSprite.type!==eQ.Type.FILLED){var h=a.x-n.x,f=a.y-n.y,_=new di(l*h,u*f,0);t.setPosition(r.x+_.x,r.y+_.y,r.z),e.setAnchorPoint(a),e.setContentSize(c)}else p("ProgressBar non-FILLED mode only works when barSprite's Type is non-FILLED!")}},L(e,[{key:"barSprite",get:function(){return this._barSprite},set:function(t){this._barSprite!==t&&(this._barSprite=t,this._initBarSprite())}},{key:"mode",get:function(){return this._mode},set:function(t){if(this._mode!==t&&(this._mode=t,this._barSprite)){var e=this._barSprite.node;if(!e)return;var n=e._uiProps.uiTransformComp.contentSize;this._mode===s5.HORIZONTAL?this.totalLength=n.width:this._mode===s5.VERTICAL?this.totalLength=n.height:this._mode===s5.FILLED&&(this.totalLength=this._barSprite.fillRange)}}},{key:"totalLength",get:function(){return this._totalLength},set:function(t){this._mode===s5.FILLED&&(t=Kn(t)),this._totalLength=t,this._updateBarStatus()}},{key:"progress",get:function(){return this._progress},set:function(t){this._progress!==t&&(this._progress=t,this._updateBarStatus())}},{key:"reverse",get:function(){return this._reverse},set:function(t){this._reverse!==t&&(this._reverse=t,this._barSprite&&(this._barSprite.fillStart=1-this._barSprite.fillStart),this._updateBarStatus())}}]),e}($u),a5.Mode=s5,q(($3=o5).prototype,"barSprite",[j3,W3],Object.getOwnPropertyDescriptor($3.prototype,"barSprite"),$3.prototype),q($3.prototype,"mode",[X3,q3],Object.getOwnPropertyDescriptor($3.prototype,"mode"),$3.prototype),q($3.prototype,"totalLength",[Y3],Object.getOwnPropertyDescriptor($3.prototype,"totalLength"),$3.prototype),q($3.prototype,"progress",[K3,Pl,Q3],Object.getOwnPropertyDescriptor($3.prototype,"progress"),$3.prototype),q($3.prototype,"reverse",[Z3],Object.getOwnPropertyDescriptor($3.prototype,"reverse"),$3.prototype),t5=q($3.prototype,"_barSprite",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),e5=q($3.prototype,"_mode",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return s5.HORIZONTAL}}),n5=q($3.prototype,"_totalLength",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),i5=q($3.prototype,"_progress",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),r5=q($3.prototype,"_reverse",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),J3=$3))||J3)||J3)||J3)||J3)||J3));i.ProgressBar=N5;var L5,B5=new di,F5=new di,z5=new di,U5=new Ni,k5=new _i,G5=new Ni;!function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL"}(L5||(L5={})),Zt(L5);var H5,V5=function(e){return t({ScrollBar:e,ScrollBarComponent:e}),e}((u5=nl("cc.ScrollBar"),h5=vl(),f5=rl(110),_5=pl(),p5=il(FW),d5=Bl(eQ),m5=Il(),g5=Al(),v5=Bl(L5),y5=Il(),x5=Al(),S5=Il(),T5=Al(),A5=Il(),E5=Al(),u5(C5=h5(C5=f5(C5=_5(C5=p5((M5=O5=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return X(e=t.call.apply(t,[this].concat(i))||this,"_scrollView",w5,V(e)),X(e,"_handle",P5,V(e)),X(e,"_direction",I5,V(e)),X(e,"_enableAutoHide",R5,V(e)),X(e,"_autoHideTime",D5,V(e)),e._touching=!1,e._opacity=255,e._autoHideRemainingTime=0,e}F(e,t);var n=e.prototype;return n.hide=function(){this._autoHideRemainingTime=0,this._setOpacity(0)},n.show=function(){this._autoHideRemainingTime=this._autoHideTime,this._setOpacity(this._opacity)},n.onScroll=function(t){if(this._scrollView){var e=this._scrollView.content;if(e){var n=e._uiProps.uiTransformComp.contentSize,i=this._scrollView.node._uiProps.uiTransformComp.contentSize,r=this.node._uiProps.uiTransformComp.contentSize;if(!this._conditionalDisableScrollBar(n,i)){this._enableAutoHide&&(this._autoHideRemainingTime=this._autoHideTime,this._setOpacity(this._opacity));var a=0,o=0,s=0,c=0,l=0,u=G5;u.set(0,0),this._direction===L5.HORIZONTAL?(a=n.width,o=i.width,l=r.width,s=t.x,this._convertToScrollViewSpace(u,e),c=-u.x):this._direction===L5.VERTICAL&&(a=n.height,o=i.height,l=r.height,s=t.y,this._convertToScrollViewSpace(u,e),c=-u.y);var h=this._calculateLength(a,o,l,s),f=G5;this._calculatePosition(f,a,o,l,c,s,h),this._updateLength(h),this._updateHandlerPosition(f)}}}},n.setScrollView=function(t){this._scrollView=t},n.onTouchBegan=function(){this._enableAutoHide&&(this._touching=!0)},n.onTouchEnded=function(){if(this._enableAutoHide&&(this._touching=!1,!(this._autoHideTime<=0))){if(this._scrollView){var t=this._scrollView.content;if(t){var e=t._uiProps.uiTransformComp.contentSize,n=this._scrollView.node._uiProps.uiTransformComp.contentSize;if(this._conditionalDisableScrollBar(e,n))return}}this._autoHideRemainingTime=this._autoHideTime}},n.onEnable=function(){var t=this.node.getComponent(eQ);t&&(this._opacity=t.color.a)},n.start=function(){this._enableAutoHide&&this._setOpacity(0)},n.update=function(t){this._processAutoHide(t)},n._convertToScrollViewSpace=function(t,e){var n=this._scrollView&&this._scrollView.node._uiProps.uiTransformComp,i=e._uiProps.uiTransformComp;if(n&&i){B5.set(-i.anchorX*i.width,-i.anchorY*i.height,0),i.convertToWorldSpaceAR(B5,F5);var r=n.convertToNodeSpaceAR(F5);r.x+=n.anchorX*n.width,r.y+=n.anchorY*n.height,t.set(r.x,r.y)}else t.set(Ni.ZERO)},n._setOpacity=function(t){if(this._handle){var e=this.node.getComponent(eQ);e&&(k5.set(e.color),k5.a=t,e.color=k5),(e=this._handle.getComponent(eQ))&&(k5.set(e.color),k5.a=t,e.color=k5)}},n._updateHandlerPosition=function(t){if(this._handle){var e=z5;this._fixupHandlerPosition(e),this._handle.node.setPosition(t.x+e.x,t.y+e.y,e.z)}},n._fixupHandlerPosition=function(t){var e=this.node._uiProps.uiTransformComp,n=e.contentSize,i=e.anchorPoint,r=this.handle.node._uiProps.uiTransformComp.contentSize,a=this.handle.node.parent;di.set(B5,-n.width*i.x,-n.height*i.y,0);var o=this.node._uiProps.uiTransformComp.convertToWorldSpaceAR(B5,F5),s=t;s.set(0,0,0),a._uiProps.uiTransformComp.convertToNodeSpaceAR(o,s),this.direction===L5.HORIZONTAL?s.set(s.x,s.y+(n.height-r.height)/2,s.z):this.direction===L5.VERTICAL&&s.set(s.x+(n.width-r.width)/2,s.y,s.z),this.handle.node.setPosition(s)},n._conditionalDisableScrollBar=function(t,e){return t.width<=e.width&&this._direction===L5.HORIZONTAL||t.height<=e.height&&this._direction===L5.VERTICAL},n._calculateLength=function(t,e,n,i){var r=t;return i&&(r+=20*(i>0?i:-i)),n*(e/r)},n._calculatePosition=function(t,e,n,i,r,a,o){var s=e-n;a&&(s+=Math.abs(a));var c=0;s&&(c=Kn(c=r/s));var l=(i-o)*c;this._direction===L5.VERTICAL?t.set(0,l):t.set(l,0)},n._updateLength=function(t){if(this._handle){var e=this._handle.node._uiProps.uiTransformComp,n=e.contentSize,i=e.anchorPoint;i.x===U5.x&&i.y===U5.y||e.setAnchorPoint(U5),this._direction===L5.HORIZONTAL?e.setContentSize(t,n.height):e.setContentSize(n.width,t)}},n._processAutoHide=function(t){if(this._enableAutoHide&&!(this._autoHideRemainingTime<=0)&&!this._touching&&(this._autoHideRemainingTime-=t,this._autoHideRemainingTime<=this._autoHideTime)){this._autoHideRemainingTime=Math.max(0,this._autoHideRemainingTime);var e=this._opacity*(this._autoHideRemainingTime/this._autoHideTime);this._setOpacity(e)}},L(e,[{key:"handle",get:function(){return this._handle},set:function(t){this._handle!==t&&(this._handle=t,this.onScroll(Ni.ZERO))}},{key:"direction",get:function(){return this._direction},set:function(t){this._direction!==t&&(this._direction=t,this.onScroll(Ni.ZERO))}},{key:"enableAutoHide",get:function(){return this._enableAutoHide},set:function(t){this._enableAutoHide!==t&&(this._enableAutoHide=t,this._enableAutoHide&&this._setOpacity(0))}},{key:"autoHideTime",get:function(){return this._autoHideTime},set:function(t){this._autoHideTime!==t&&(this._autoHideTime=t)}}]),e}($u),O5.Direction=L5,q((b5=M5).prototype,"handle",[d5,m5,g5],Object.getOwnPropertyDescriptor(b5.prototype,"handle"),b5.prototype),q(b5.prototype,"direction",[v5,y5,x5],Object.getOwnPropertyDescriptor(b5.prototype,"direction"),b5.prototype),q(b5.prototype,"enableAutoHide",[S5,T5],Object.getOwnPropertyDescriptor(b5.prototype,"enableAutoHide"),b5.prototype),q(b5.prototype,"autoHideTime",[A5,E5],Object.getOwnPropertyDescriptor(b5.prototype,"autoHideTime"),b5.prototype),w5=q(b5.prototype,"_scrollView",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P5=q(b5.prototype,"_handle",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I5=q(b5.prototype,"_direction",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return L5.HORIZONTAL}}),R5=q(b5.prototype,"_enableAutoHide",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),D5=q(b5.prototype,"_autoHideTime",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),C5=b5))||C5)||C5)||C5)||C5)||C5));i.ScrollBar=V5;var j5,W5,X5,q5,Y5,K5,Q5,Z5,J5,$5,t8,e8,n8,i8,r8,a8,o8,s8,c8,l8,u8,h8,f8,_8,p8,d8,m8,g8,v8,y8,x8,S8,T8,A8,E8,C8,b8,w8,P8,I8,R8,D8,O8,M8,N8,L8,B8,F8,z8=t("ViewGroup",nl("cc.ViewGroup")(H5=rl(110)(H5=function(t){function e(){return t.apply(this,arguments)||this}return F(e,t),e}($u))||H5)||H5);i.ViewGroup=z8;var U8,k8=1e-4,G8=new di,H8=new di,V8=new Ni,j8=new Ni,W8=function(){return(new Date).getMilliseconds()},X8={"scroll-to-top":0,"scroll-to-bottom":1,"scroll-to-left":2,"scroll-to-right":3,scrolling:4,"bounce-bottom":6,"bounce-left":7,"bounce-right":8,"bounce-top":5,"scroll-ended":9,"touch-up":10,"scroll-ended-with-threshold":11,"scroll-began":12};!function(t){t.SCROLL_TO_TOP="scroll-to-top",t.SCROLL_TO_BOTTOM="scroll-to-bottom",t.SCROLL_TO_LEFT="scroll-to-left",t.SCROLL_TO_RIGHT="scroll-to-right",t.SCROLL_BEGAN="scroll-began",t.SCROLL_ENDED="scroll-ended",t.BOUNCE_TOP="bounce-top",t.BOUNCE_BOTTOM="bounce-bottom",t.BOUNCE_LEFT="bounce-left",t.BOUNCE_RIGHT="bounce-right",t.SCROLLING="scrolling",t.SCROLL_ENG_WITH_THRESHOLD="scroll-ended-with-threshold",t.TOUCH_UP="touch-up"}(U8||(U8={}));var q8,Y8,K8,Q8,Z8,J8,$8,t6,e6,n6,i6,r6,a6,o6,s6,c6,l6,u6,h6,f6,_6,p6=function(e){return t({ScrollView:e,ScrollViewComponent:e}),e}((j5=nl("cc.ScrollView"),W5=vl(),X5=rl(110),q5=pl(),Y5=il(FW),K5=El(),Q5=Il(),Z5=Al(),J5=El(),$5=Il(),t8=Al(),e8=Il(),n8=Al(),i8=Il(),r8=Al(),a8=Bl(qC),o8=Il(),s8=Al(),c8=Il(),l8=Al(),u8=Bl(V5),h8=Il(),f8=Al(),_8=Il(),p8=Al(),d8=Bl(V5),m8=Il(),g8=Al(),v8=Il(),y8=Al(),x8=Bl([GB]),S8=Il(),T8=Al(),j5(A8=W5(A8=X5(A8=q5(A8=Y5((F8=B8=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return X(e=t.call.apply(t,[this].concat(i))||this,"bounceDuration",C8,V(e)),X(e,"brake",b8,V(e)),X(e,"elastic",w8,V(e)),X(e,"inertia",P8,V(e)),X(e,"horizontal",I8,V(e)),X(e,"vertical",R8,V(e)),X(e,"cancelInnerEvents",D8,V(e)),X(e,"scrollEvents",O8,V(e)),e._autoScrolling=!1,e._scrolling=!1,X(e,"_content",M8,V(e)),X(e,"_horizontalScrollBar",N8,V(e)),X(e,"_verticalScrollBar",L8,V(e)),e._topBoundary=0,e._bottomBoundary=0,e._leftBoundary=0,e._rightBoundary=0,e._touchMoveDisplacements=[],e._touchMoveTimeDeltas=[],e._touchMovePreviousTimestamp=0,e._touchMoved=!1,e._autoScrollAttenuate=!1,e._autoScrollStartPosition=new di,e._autoScrollTargetDelta=new di,e._autoScrollTotalTime=0,e._autoScrollAccumulatedTime=0,e._autoScrollCurrentlyOutOfBoundary=!1,e._autoScrollBraking=!1,e._autoScrollBrakingStartPosition=new di,e._outOfBoundaryAmount=new di,e._outOfBoundaryAmountDirty=!0,e._stopMouseWheel=!1,e._mouseWheelEventElapsedTime=0,e._isScrollEndedWithThresholdEventFired=!1,e._scrollEventEmitMask=0,e._isBouncing=!1,e._contentPos=new di,e._deltaPos=new di,e}F(e,t);var n=e.prototype;return n.scrollToBottom=function(t,e){void 0===e&&(e=!0);var n=this._calculateMovePercentDelta({anchor:new Ni(0,0),applyToHorizontal:!1,applyToVertical:!0});t?this._startAutoScroll(n,t,!1!==e):this._moveContent(n,!0)},n.scrollToTop=function(t,e){void 0===e&&(e=!0);var n=this._calculateMovePercentDelta({anchor:new Ni(0,1),applyToHorizontal:!1,applyToVertical:!0});t?this._startAutoScroll(n,t,!1!==e):this._moveContent(n)},n.scrollToLeft=function(t,e){void 0===e&&(e=!0);var n=this._calculateMovePercentDelta({anchor:new Ni(0,0),applyToHorizontal:!0,applyToVertical:!1});t?this._startAutoScroll(n,t,!1!==e):this._moveContent(n)},n.scrollToRight=function(t,e){void 0===e&&(e=!0);var n=this._calculateMovePercentDelta({anchor:new Ni(1,0),applyToHorizontal:!0,applyToVertical:!1});t?this._startAutoScroll(n,t,!1!==e):this._moveContent(n)},n.scrollToTopLeft=function(t,e){void 0===e&&(e=!0);var n=this._calculateMovePercentDelta({anchor:new Ni(0,1),applyToHorizontal:!0,applyToVertical:!0});t?this._startAutoScroll(n,t,!1!==e):this._moveContent(n)},n.scrollToTopRight=function(t,e){void 0===e&&(e=!0);var n=this._calculateMovePercentDelta({anchor:new Ni(1,1),applyToHorizontal:!0,applyToVertical:!0});t?this._startAutoScroll(n,t,!1!==e):this._moveContent(n)},n.scrollToBottomLeft=function(t,e){void 0===e&&(e=!0);var n=this._calculateMovePercentDelta({anchor:new Ni(0,0),applyToHorizontal:!0,applyToVertical:!0});t?this._startAutoScroll(n,t,!1!==e):this._moveContent(n)},n.scrollToBottomRight=function(t,e){void 0===e&&(e=!0);var n=this._calculateMovePercentDelta({anchor:new Ni(1,0),applyToHorizontal:!0,applyToVertical:!0});t?this._startAutoScroll(n,t,!1!==e):this._moveContent(n)},n.scrollToOffset=function(t,e,n){void 0===n&&(n=!0);var i=this.getMaxScrollOffset(),r=new Ni(0,0);0===i.x?r.x=0:r.x=t.x/i.x,0===i.y?r.y=1:r.y=(i.y-t.y)/i.y,this.scrollTo(r,e,n)},n.getScrollOffset=function(){var t=this._getContentTopBoundary()-this._topBoundary,e=this._getContentLeftBoundary()-this._leftBoundary;return new Ni(e,t)},n.getMaxScrollOffset=function(){if(!this._content||!this.view)return Ni.ZERO;var t=this._content._uiProps.uiTransformComp.contentSize,e=t.width-this.view.width,n=t.height-this.view.height;return new Ni(e=e>=0?e:0,n=n>=0?n:0)},n.scrollToPercentHorizontal=function(t,e,n){var i=this._calculateMovePercentDelta({anchor:new Ni(t,0),applyToHorizontal:!0,applyToVertical:!1});e?this._startAutoScroll(i,e,!1!==n):this._moveContent(i)},n.scrollTo=function(t,e,n){var i=this._calculateMovePercentDelta({anchor:new Ni(t),applyToHorizontal:!0,applyToVertical:!0});e?this._startAutoScroll(i,e,n):this._moveContent(i)},n.scrollToPercentVertical=function(t,e,n){var i=this._calculateMovePercentDelta({anchor:new Ni(0,t),applyToHorizontal:!1,applyToVertical:!0});e?this._startAutoScroll(i,e,n):this._moveContent(i)},n.stopAutoScroll=function(){this._autoScrolling=!1,this._autoScrollAccumulatedTime=this._autoScrollTotalTime},n.setContentPosition=function(t){this._setContentPosition(t)},n._setContentPosition=function(t){if(this._content){var e=this._getContentPosition();Math.abs(t.x-e.x)<k8&&Math.abs(t.y-e.y)<k8||(this._content.setPosition(t),this._outOfBoundaryAmountDirty=!0)}},n.getContentPosition=function(){return this._getContentPosition()},n._getContentPosition=function(){return this._content?(this._contentPos.set(this._content.position),this._contentPos):di.ZERO.clone()},n.isScrolling=function(){return this._scrolling},n.isAutoScrolling=function(){return this._autoScrolling},n.getScrollEndedEventTiming=function(){return k8},n.start=function(){this._calculateBoundary(),this._content&&WM.once(jM.EVENT_BEFORE_DRAW,this._adjustContentOutOfBoundary,this)},n.onEnable=function(){this._registerEvent(),this._content&&(this._content.on(WA.SIZE_CHANGED,this._calculateBoundary,this),this._content.on(WA.TRANSFORM_CHANGED,this._scaleChanged,this),this.view&&(this.view.node.on(WA.TRANSFORM_CHANGED,this._scaleChanged,this),this.view.node.on(WA.SIZE_CHANGED,this._calculateBoundary,this))),this._calculateBoundary(),this._updateScrollBarState()},n.update=function(t){this._autoScrolling&&this._processAutoScrolling(t)},n.onDisable=function(){this._unregisterEvent(),this._content&&(this._content.off(WA.SIZE_CHANGED,this._calculateBoundary,this),this._content.off(WA.TRANSFORM_CHANGED,this._scaleChanged,this),this.view&&(this.view.node.off(WA.TRANSFORM_CHANGED,this._scaleChanged,this),this.view.node.off(WA.SIZE_CHANGED,this._calculateBoundary,this))),this._hideScrollBar(),this.stopAutoScroll()},n._registerEvent=function(){this.node.on(WA.TOUCH_START,this._onTouchBegan,this,!0),this.node.on(WA.TOUCH_MOVE,this._onTouchMoved,this,!0),this.node.on(WA.TOUCH_END,this._onTouchEnded,this,!0),this.node.on(WA.TOUCH_CANCEL,this._onTouchCancelled,this,!0),this.node.on(WA.MOUSE_WHEEL,this._onMouseWheel,this,!0)},n._unregisterEvent=function(){this.node.off(WA.TOUCH_START,this._onTouchBegan,this,!0),this.node.off(WA.TOUCH_MOVE,this._onTouchMoved,this,!0),this.node.off(WA.TOUCH_END,this._onTouchEnded,this,!0),this.node.off(WA.TOUCH_CANCEL,this._onTouchCancelled,this,!0),this.node.off(WA.MOUSE_WHEEL,this._onMouseWheel,this,!0)},n._onMouseWheel=function(t,e){if(this.enabledInHierarchy&&!this._hasNestedViewGroup(t,e)){var n=new di,i=t.getScrollY();this.vertical?n.set(0,-.1*i,0):this.horizontal&&n.set(-.1*i,0,0),this._mouseWheelEventElapsedTime=0,this._processDeltaMove(n),this._stopMouseWheel||(this._handlePressLogic(),this.schedule(this._checkMouseWheel,1/60,NaN,0),this._stopMouseWheel=!0),this._stopPropagationIfTargetIsMe(t)}},n._onTouchBegan=function(t,e){this.enabledInHierarchy&&this._content&&(this._hasNestedViewGroup(t,e)||(this._handlePressLogic(),this._touchMoved=!1,this._stopPropagationIfTargetIsMe(t)))},n._onTouchMoved=function(t,e){if(this.enabledInHierarchy&&this._content&&!this._hasNestedViewGroup(t,e)){var n=t.touch;if(this._handleMoveLogic(n),this.cancelInnerEvents){var i=n.getUILocation(V8);if(i.subtract(n.getUIStartLocation(j8)),i.length()>7&&!this._touchMoved&&t.target!==this.node){var r=new KR(t.getTouches(),t.bubbles,Gb.TOUCH_CANCEL);r.touch=t.touch,r.simulate=!0,t.target.dispatchEvent(r),this._touchMoved=!0}this._stopPropagationIfTargetIsMe(t)}}},n._onTouchEnded=function(t,e){if(this.enabledInHierarchy&&this._content&&t&&!this._hasNestedViewGroup(t,e)){this._dispatchEvent(U8.TOUCH_UP);var n=t.touch;this._handleReleaseLogic(n),this._touchMoved?t.propagationStopped=!0:this._stopPropagationIfTargetIsMe(t)}},n._onTouchCancelled=function(t,e){if(this.enabledInHierarchy&&this._content&&!this._hasNestedViewGroup(t,e)){if(t&&!t.simulate){var n=t.touch;this._handleReleaseLogic(n)}this._stopPropagationIfTargetIsMe(t)}},n._calculateBoundary=function(){if(this._content&&this.view){var t=this._content.getComponent(l5);t&&t.enabledInHierarchy&&t.updateLayout();var e=this.view,n=e.width*e.anchorX,i=e.height*e.anchorY;this._leftBoundary=-n,this._bottomBoundary=-i,this._rightBoundary=this._leftBoundary+e.width,this._topBoundary=this._bottomBoundary+e.height,this._moveContentToTopLeft(e.contentSize)}},n._hasNestedViewGroup=function(t,e){if(!t||t.eventPhase!==jR.CAPTURING_PHASE)return!1;if(e)for(var n,i=W(e);!(n=i()).done;){var r=n.value;if(this.node===r)return!(!t.target||!t.target.getComponent(z8));if(r.getComponent(z8))return!0}return!1},n._startInertiaScroll=function(t){var e=new di(t);e.multiplyScalar(.7),this._startAttenuatingAutoScroll(e,t)},n._calculateAttenuatedFactor=function(t){return this.brake<=0?1-this.brake:(1-this.brake)*(1/(1+14e-6*t+t*t*8e-9))},n._startAttenuatingAutoScroll=function(t,e){var n=t.clone();if(n.normalize(),this._content&&this.view){var i=this._content._uiProps.uiTransformComp.contentSize,r=this.view.contentSize,a=i.width-r.width,o=i.height-r.height,s=this._calculateAttenuatedFactor(a),c=this._calculateAttenuatedFactor(o);n.x=n.x*a*(1-this.brake)*s,n.y=n.y*o*c*(1-this.brake),n.z=0}var l=t.length(),u=n.length()/l;if(n.add(t),this.brake>0&&u>7){u=Math.sqrt(u);var h=t.clone();h.multiplyScalar(u),n.set(h),n.add(t)}var f=this._calculateAutoScrollTimeByInitialSpeed(e.length());this.brake>0&&u>3&&(f*=u=3),0===this.brake&&u>1&&(f*=u),this._startAutoScroll(n,f,!0)},n._calculateAutoScrollTimeByInitialSpeed=function(t){return Math.sqrt(Math.sqrt(t/5))},n._startAutoScroll=function(t,e,n){void 0===n&&(n=!1);var i=this._flattenVectorByDirection(t);this._autoScrolling=!0,this._autoScrollTargetDelta=i,this._autoScrollAttenuate=n,di.copy(this._autoScrollStartPosition,this._getContentPosition()),this._autoScrollTotalTime=e,this._autoScrollAccumulatedTime=0,this._autoScrollBraking=!1,this._isScrollEndedWithThresholdEventFired=!1,this._autoScrollBrakingStartPosition.set(0,0,0),this._getHowMuchOutOfBoundary().equals(di.ZERO,k8)||(this._autoScrollCurrentlyOutOfBoundary=!0)},n._calculateTouchMoveVelocity=function(){var t=new di,e=0;if((e=this._touchMoveTimeDeltas.reduce((function(t,e){return t+e}),e))<=0||e>=.5)t.set(di.ZERO);else{var n=new di;n=this._touchMoveDisplacements.reduce((function(t,e){return t.add(e),t}),n),t.set(n.x*(1-this.brake)/e,n.y*(1-this.brake)/e,n.z)}return t},n._flattenVectorByDirection=function(t){var e=t;return e.x=this.horizontal?e.x:0,e.y=this.vertical?e.y:0,e},n._moveContent=function(t,e){var n=this._flattenVectorByDirection(t);G8.set(this._getContentPosition()),G8.add(n),G8.set(Math.round(1e4*G8.x)*k8,Math.round(1e4*G8.y)*k8,G8.z),this._setContentPosition(G8);var i=this._getHowMuchOutOfBoundary();V8.set(i.x,i.y),this._updateScrollBar(V8),this.elastic&&e&&this._startBounceBackIfNeeded()},n._getContentLeftBoundary=function(){if(!this._content)return-1;var t=this._getContentPosition(),e=this._content._uiProps.uiTransformComp;return t.x-e.anchorX*e.width},n._getContentRightBoundary=function(){if(!this._content)return-1;var t=this._content._uiProps.uiTransformComp;return this._getContentLeftBoundary()+t.width},n._getContentTopBoundary=function(){if(!this._content)return-1;var t=this._content._uiProps.uiTransformComp;return this._getContentBottomBoundary()+t.height},n._getContentBottomBoundary=function(){if(!this._content)return-1;var t=this._getContentPosition(),e=this._content._uiProps.uiTransformComp;return t.y-e.anchorY*e.height},n._getHowMuchOutOfBoundary=function(t){if((t=t||new di).equals(di.ZERO,k8)&&!this._outOfBoundaryAmountDirty)return this._outOfBoundaryAmount;var e=new di,n=this._getContentLeftBoundary(),i=this._getContentRightBoundary();n+t.x>this._leftBoundary?e.x=this._leftBoundary-(n+t.x):i+t.x<this._rightBoundary&&(e.x=this._rightBoundary-(i+t.x));var r=this._getContentTopBoundary(),a=this._getContentBottomBoundary();return r+t.y<this._topBoundary?e.y=this._topBoundary-(r+t.y):a+t.y>this._bottomBoundary&&(e.y=this._bottomBoundary-(a+t.y)),t.equals(di.ZERO,k8)&&(this._outOfBoundaryAmount=e,this._outOfBoundaryAmountDirty=!1),this._clampDelta(e),e},n._updateScrollBar=function(t){this._horizontalScrollBar&&this._horizontalScrollBar.onScroll(t),this.verticalScrollBar&&this.verticalScrollBar.onScroll(t)},n._onScrollBarTouchBegan=function(){this._horizontalScrollBar&&this._horizontalScrollBar.onTouchBegan(),this.verticalScrollBar&&this.verticalScrollBar.onTouchBegan()},n._onScrollBarTouchEnded=function(){this._horizontalScrollBar&&this._horizontalScrollBar.onTouchEnded(),this.verticalScrollBar&&this.verticalScrollBar.onTouchEnded()},n._dispatchEvent=function(t){if(t===U8.SCROLL_ENDED)this._scrollEventEmitMask=0;else if(t===U8.SCROLL_TO_TOP||t===U8.SCROLL_TO_BOTTOM||t===U8.SCROLL_TO_LEFT||t===U8.SCROLL_TO_RIGHT){var e=1<<X8[t];if(this._scrollEventEmitMask&e)return;this._scrollEventEmitMask|=e}GB.emitEvents(this.scrollEvents,this,X8[t]),this.node.emit(t,this)},n._adjustContentOutOfBoundary=function(){if(this._content&&(this._outOfBoundaryAmountDirty=!0,this._isOutOfBoundary())){var t=this._getHowMuchOutOfBoundary();G8.set(this._getContentPosition()),G8.add(t),this._content.setPosition(G8),this._updateScrollBar(Ni.ZERO)}},n._hideScrollBar=function(){this._horizontalScrollBar&&this._horizontalScrollBar.hide(),this._verticalScrollBar&&this._verticalScrollBar.hide()},n._updateScrollBarState=function(){if(this._content&&this.view){var t=this.view,e=this._content._uiProps.uiTransformComp;this.verticalScrollBar&&(e.height<t.height?this.verticalScrollBar.hide():this.verticalScrollBar.show()),this.horizontalScrollBar&&(e.width<t.width?this.horizontalScrollBar.hide():this.horizontalScrollBar.show())}},n._stopPropagationIfTargetIsMe=function(t){t.eventPhase===jR.AT_TARGET&&t.target===this.node&&(t.propagationStopped=!0)},n._processDeltaMove=function(t){this._scrollChildren(t),this._gatherTouchMove(t)},n._handleMoveLogic=function(t){this._getLocalAxisAlignDelta(this._deltaPos,t),this._processDeltaMove(this._deltaPos)},n._handleReleaseLogic=function(t){this._getLocalAxisAlignDelta(this._deltaPos,t),this._gatherTouchMove(this._deltaPos),this._processInertiaScroll(),this._scrolling&&(this._scrolling=!1,this._autoScrolling||this._dispatchEvent(U8.SCROLL_ENDED))},n._getLocalAxisAlignDelta=function(t,e){var n=this.node._uiProps.uiTransformComp,i=new di;n&&(e.getUILocation(V8),e.getUIPreviousLocation(j8),G8.set(V8.x,V8.y,0),H8.set(j8.x,j8.y,0),n.convertToNodeSpaceAR(G8,G8),n.convertToNodeSpaceAR(H8,H8),di.subtract(i,G8,H8)),t.set(i)},n._scrollChildren=function(t){this._clampDelta(t);var e,n=t;this.elastic&&(e=this._getHowMuchOutOfBoundary(),n.x*=0===e.x?1:.5,n.y*=0===e.y?1:.5),this.elastic||(e=this._getHowMuchOutOfBoundary(n),n.add(e));var i="",r="";if(this._content){var a=this._content._uiProps.uiTransformComp,o=a.anchorX,s=a.anchorY,c=a.width,l=a.height,u=this._content.position||di.ZERO;this.vertical&&(n.y>0?u.y-s*l+n.y>=this._bottomBoundary&&(i=U8.SCROLL_TO_BOTTOM):n.y<0&&u.y-s*l+l+n.y<=this._topBoundary&&(i=U8.SCROLL_TO_TOP)),this.horizontal&&(n.x<0?u.x-o*c+c+n.x<=this._rightBoundary&&(r=U8.SCROLL_TO_RIGHT):n.x>0&&u.x-o*c+n.x>=this._leftBoundary&&(r=U8.SCROLL_TO_LEFT))}this._moveContent(n,!1),(this.horizontal&&0!==n.x||this.vertical&&0!==n.y)&&(this._scrolling||(this._scrolling=!0,this._dispatchEvent(U8.SCROLL_BEGAN)),this._dispatchEvent(U8.SCROLLING)),""!==i&&this._dispatchEvent(i),""!==r&&this._dispatchEvent(r)},n._handlePressLogic=function(){this._autoScrolling&&this._dispatchEvent(U8.SCROLL_ENDED),this._autoScrolling=!1,this._isBouncing=!1,this._touchMovePreviousTimestamp=W8(),this._touchMoveDisplacements.length=0,this._touchMoveTimeDeltas.length=0,this._onScrollBarTouchBegan()},n._clampDelta=function(t){if(this._content&&this.view){var e=this.view.contentSize,n=this._content._uiProps.uiTransformComp;n.width<e.width&&(t.x=0),n.height<e.height&&(t.y=0)}},n._gatherTouchMove=function(t){var e=t.clone();for(this._clampDelta(e);this._touchMoveDisplacements.length>=5;)this._touchMoveDisplacements.shift(),this._touchMoveTimeDeltas.shift();this._touchMoveDisplacements.push(e);var n=W8();this._touchMoveTimeDeltas.push((n-this._touchMovePreviousTimestamp)/1e3),this._touchMovePreviousTimestamp=n},n._startBounceBackIfNeeded=function(){if(!this.elastic)return!1;var t=this._getHowMuchOutOfBoundary();if(this._clampDelta(t),t.equals(di.ZERO,k8))return!1;var e=Math.max(this.bounceDuration,0);return this._startAutoScroll(t,e,!0),this._isBouncing||(t.y>0&&this._dispatchEvent(U8.BOUNCE_TOP),t.y<0&&this._dispatchEvent(U8.BOUNCE_BOTTOM),t.x>0&&this._dispatchEvent(U8.BOUNCE_RIGHT),t.x<0&&this._dispatchEvent(U8.BOUNCE_LEFT),this._isBouncing=!0),!0},n._processInertiaScroll=function(){if(!this._startBounceBackIfNeeded()&&this.inertia){var t=this._calculateTouchMoveVelocity();!t.equals(G8,k8)&&this.brake<1&&this._startInertiaScroll(t)}this._onScrollBarTouchEnded()},n._isOutOfBoundary=function(){return!this._getHowMuchOutOfBoundary().equals(di.ZERO,k8)},n._isNecessaryAutoScrollBrake=function(){if(this._autoScrollBraking)return!0;if(this._isOutOfBoundary()){if(!this._autoScrollCurrentlyOutOfBoundary)return this._autoScrollCurrentlyOutOfBoundary=!0,this._autoScrollBraking=!0,this._autoScrollBrakingStartPosition=this._getContentPosition(),!0}else this._autoScrollCurrentlyOutOfBoundary=!1;return!1},n._processAutoScrolling=function(t){var e=this._isNecessaryAutoScrollBrake(),n=e?.05:1;this._autoScrollAccumulatedTime+=t*(1/n);var i,r=Math.min(1,this._autoScrollAccumulatedTime/this._autoScrollTotalTime);this._autoScrollAttenuate&&(i=r,r=(i-=1)*i*i*i*i+1);var a=this._autoScrollTargetDelta.clone();a.multiplyScalar(r);var o=this._autoScrollStartPosition.clone();o.add(a);var s=Math.abs(r-1)<=k8;if(Math.abs(r-1)<=this.getScrollEndedEventTiming()&&!this._isScrollEndedWithThresholdEventFired&&(this._dispatchEvent(U8.SCROLL_ENG_WITH_THRESHOLD),this._isScrollEndedWithThresholdEventFired=!0),this.elastic){var c=o.clone();c.subtract(this._autoScrollBrakingStartPosition),e&&c.multiplyScalar(n),o.set(this._autoScrollBrakingStartPosition),o.add(c)}else{var l=o.clone();l.subtract(this.getContentPosition());var u=this._getHowMuchOutOfBoundary(l);u.equals(di.ZERO,k8)||(o.add(u),s=!0)}s&&(this._autoScrolling=!1);var h=o.clone();h.subtract(this._getContentPosition()),this._clampDelta(h),this._moveContent(h,s),this._dispatchEvent(U8.SCROLLING),this._autoScrolling||(this._isBouncing=!1,this._scrolling=!1,this._dispatchEvent(U8.SCROLL_ENDED))},n._checkMouseWheel=function(t){if(!this._getHowMuchOutOfBoundary().equals(di.ZERO,k8))return this._processInertiaScroll(),this.unschedule(this._checkMouseWheel),this._dispatchEvent(U8.SCROLL_ENDED),void(this._stopMouseWheel=!1);this._mouseWheelEventElapsedTime+=t,this._mouseWheelEventElapsedTime>.1&&(this._onScrollBarTouchEnded(),this.unschedule(this._checkMouseWheel),this._dispatchEvent(U8.SCROLL_ENDED),this._stopMouseWheel=!1)},n._calculateMovePercentDelta=function(t){var e=t.anchor,n=t.applyToHorizontal,i=t.applyToVertical;this._calculateBoundary(),e.clampf(Ni.ZERO,Ni.ONE);var r=this._getContentBottomBoundary()-this._bottomBoundary;r=-r;var a=this._getContentLeftBoundary()-this._leftBoundary;a=-a;var o=new di;if(this._content&&this.view){var s=0,c=this._content._uiProps.uiTransformComp.contentSize,l=this.view.contentSize;n&&(s=c.width-l.width,o.x=a-s*e.x),i&&(s=c.height-l.height,o.y=r-s*e.y)}return o},n._moveContentToTopLeft=function(t){var e=this._getContentBottomBoundary()-this._bottomBoundary;e=-e;var n=new di,i=0,r=this._getContentLeftBoundary()-this._leftBoundary;if(r=-r,this._content){var a=this._content._uiProps.uiTransformComp.contentSize;a.height<t.height&&(i=a.height-t.height,n.y=e-i),a.width<t.width&&(i=a.width-t.width,n.x=r)}this._updateScrollBarState(),this._moveContent(n),this._adjustContentOutOfBoundary()},n._scaleChanged=function(t){t===Kg.SCALE&&this._calculateBoundary()},L(e,[{key:"content",get:function(){return this._content},set:function(t){if(this._content!==t){var e=t&&t.parent&&t.parent._uiProps.uiTransformComp;!t||t&&e?(this._content=t,this._calculateBoundary()):T(4302)}}},{key:"horizontalScrollBar",get:function(){return this._horizontalScrollBar},set:function(t){this._horizontalScrollBar!==t&&(this._horizontalScrollBar=t,this._horizontalScrollBar&&(this._horizontalScrollBar.setScrollView(this),this._updateScrollBar(Ni.ZERO)))}},{key:"verticalScrollBar",get:function(){return this._verticalScrollBar},set:function(t){this._verticalScrollBar!==t&&(this._verticalScrollBar=t,this._verticalScrollBar&&(this._verticalScrollBar.setScrollView(this),this._updateScrollBar(Ni.ZERO)))}},{key:"view",get:function(){var t=this._content&&this._content.parent;return t?t._uiProps.uiTransformComp:null}}]),e}(z8),B8.EventType=U8,C8=q((E8=F8).prototype,"bounceDuration",[cl,K5,Q5,Z5],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),b8=q(E8.prototype,"brake",[cl,J5,$5,t8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),w8=q(E8.prototype,"elastic",[cl,e8,n8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),P8=q(E8.prototype,"inertia",[cl,i8,r8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),q(E8.prototype,"content",[a8,o8,s8],Object.getOwnPropertyDescriptor(E8.prototype,"content"),E8.prototype),I8=q(E8.prototype,"horizontal",[cl,c8,l8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),q(E8.prototype,"horizontalScrollBar",[u8,h8,f8],Object.getOwnPropertyDescriptor(E8.prototype,"horizontalScrollBar"),E8.prototype),R8=q(E8.prototype,"vertical",[cl,_8,p8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),q(E8.prototype,"verticalScrollBar",[d8,m8,g8],Object.getOwnPropertyDescriptor(E8.prototype,"verticalScrollBar"),E8.prototype),D8=q(E8.prototype,"cancelInnerEvents",[cl,v8,y8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),O8=q(E8.prototype,"scrollEvents",[x8,cl,S8,T8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),M8=q(E8.prototype,"_content",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N8=q(E8.prototype,"_horizontalScrollBar",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L8=q(E8.prototype,"_verticalScrollBar",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A8=E8))||A8)||A8)||A8)||A8)||A8));i.ScrollView=p6;var d6,m6=new di;!function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical"}(d6||(d6={})),Zt(d6);var g6,v6,y6,x6,S6,T6,A6,E6,C6,b6,w6,P6,I6,R6,D6,O6,M6,N6,L6,B6,F6=function(e){return t({Slider:e,SliderComponent:e}),e}((q8=nl("cc.Slider"),Y8=vl(),K8=rl(110),Q8=pl(),Z8=il(FW),J8=Bl(eQ),$8=Al(),t6=Bl(d6),e6=Al(),n6=El(),i6=Al(),r6=Bl([GB]),a6=Al(),q8(o6=Y8(o6=K8(o6=Q8(o6=Z8((_6=f6=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return X(e=t.call.apply(t,[this].concat(i))||this,"slideEvents",c6,V(e)),X(e,"_handle",l6,V(e)),X(e,"_direction",u6,V(e)),X(e,"_progress",h6,V(e)),e._offset=new di,e._dragging=!1,e._touchHandle=!1,e._handleLocalPos=new di,e._touchPos=new di,e}F(e,t);var n=e.prototype;return n.__preload=function(){this._updateHandlePosition()},n.onEnable=function(){this._updateHandlePosition(),this.node.on(WA.TOUCH_START,this._onTouchBegan,this),this.node.on(WA.TOUCH_MOVE,this._onTouchMoved,this),this.node.on(WA.TOUCH_END,this._onTouchEnded,this),this.node.on(WA.TOUCH_CANCEL,this._onTouchCancelled,this),this._handle&&this._handle.isValid&&(this._handle.node.on(WA.TOUCH_START,this._onHandleDragStart,this),this._handle.node.on(WA.TOUCH_MOVE,this._onTouchMoved,this),this._handle.node.on(WA.TOUCH_END,this._onTouchEnded,this))},n.onDisable=function(){this.node.off(WA.TOUCH_START,this._onTouchBegan,this),this.node.off(WA.TOUCH_MOVE,this._onTouchMoved,this),this.node.off(WA.TOUCH_END,this._onTouchEnded,this),this.node.off(WA.TOUCH_CANCEL,this._onTouchCancelled,this),this._handle&&this._handle.isValid&&(this._handle.node.off(WA.TOUCH_START,this._onHandleDragStart,this),this._handle.node.off(WA.TOUCH_MOVE,this._onTouchMoved,this),this._handle.node.off(WA.TOUCH_END,this._onTouchEnded,this))},n._onHandleDragStart=function(t){if(t&&this._handle&&this._handle.node._uiProps.uiTransformComp){this._dragging=!0,this._touchHandle=!0;var e=t.touch.getUILocation();di.set(this._touchPos,e.x,e.y,0),this._handle.node._uiProps.uiTransformComp.convertToNodeSpaceAR(this._touchPos,this._offset),t.propagationStopped=!0}},n._onTouchBegan=function(t){this._handle&&t&&(this._dragging=!0,this._touchHandle||this._handleSliderLogic(t.touch),t.propagationStopped=!0)},n._onTouchMoved=function(t){this._dragging&&t&&(this._handleSliderLogic(t.touch),t.propagationStopped=!0)},n._onTouchEnded=function(t){this._dragging=!1,this._touchHandle=!1,this._offset=new di,t&&(t.propagationStopped=!0)},n._onTouchCancelled=function(t){this._dragging=!1,t&&(t.propagationStopped=!0)},n._handleSliderLogic=function(t){this._updateProgress(t),this._emitSlideEvent()},n._emitSlideEvent=function(){GB.emitEvents(this.slideEvents,this),this.node.emit("slide",this)},n._updateProgress=function(t){if(this._handle&&t){var e=t.getUILocation();di.set(this._touchPos,e.x,e.y,0);var n=this.node._uiProps.uiTransformComp,i=n.convertToNodeSpaceAR(this._touchPos,m6);this.direction===d6.Horizontal?this.progress=Kn(.5+(i.x-this._offset.x)/n.width):this.progress=Kn(.5+(i.y-this._offset.y)/n.height)}},n._updateHandlePosition=function(){if(this._handle){this._handleLocalPos.set(this._handle.node.getPosition());var t=this.node._uiProps.uiTransformComp;this._direction===d6.Horizontal?this._handleLocalPos.x=-t.width*t.anchorX+this.progress*t.width:this._handleLocalPos.y=-t.height*t.anchorY+this.progress*t.height,this._handle.node.setPosition(this._handleLocalPos)}},n._changeLayout=function(){var t=this.node._uiProps.uiTransformComp,e=t.contentSize;if(t.setContentSize(e.height,e.width),this._handle){var n=this._handle.node.position;this._direction===d6.Horizontal?this._handle.node.setPosition(n.x,0,n.z):this._handle.node.setPosition(0,n.y,n.z),this._updateHandlePosition()}},L(e,[{key:"handle",get:function(){return this._handle},set:function(t){this._handle!==t&&(this._handle=t)}},{key:"direction",get:function(){return this._direction},set:function(t){this._direction!==t&&(this._direction=t,this._changeLayout())}},{key:"progress",get:function(){return this._progress},set:function(t){this._progress!==t&&(this._progress=t,this._updateHandlePosition())}}]),e}($u),f6.Direction=d6,q((s6=_6).prototype,"handle",[J8,$8],Object.getOwnPropertyDescriptor(s6.prototype,"handle"),s6.prototype),q(s6.prototype,"direction",[t6,e6],Object.getOwnPropertyDescriptor(s6.prototype,"direction"),s6.prototype),q(s6.prototype,"progress",[Pl,n6,i6],Object.getOwnPropertyDescriptor(s6.prototype,"progress"),s6.prototype),c6=q(s6.prototype,"slideEvents",[r6,cl,a6],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),l6=q(s6.prototype,"_handle",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),u6=q(s6.prototype,"_direction",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return d6.Horizontal}}),h6=q(s6.prototype,"_progress",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),o6=s6))||o6)||o6)||o6)||o6)||o6));function z6(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return Object.assign.apply(Object,[{}].concat(e))}i.Slider=F6,function(t){t.TOGGLE="toggle"}(B6||(B6={}));var U6,k6,G6,H6,V6,j6,W6,X6,q6,Y6,K6,Q6,Z6=function(e){return t({Toggle:e,ToggleComponent:e}),e}((g6=nl("cc.Toggle"),v6=vl(),y6=rl(110),x6=pl(),S6=il(FW),T6=Il(),A6=Al(),E6=Bl(eQ),C6=Il(),b6=Al(),w6=Bl([GB]),P6=Al(),g6(I6=v6(I6=y6(I6=x6(I6=S6((L6=N6=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return X(e=t.call.apply(t,[this].concat(i))||this,"checkEvents",D6,V(e)),X(e,"_isChecked",O6,V(e)),X(e,"_checkMark",M6,V(e)),e}F(e,t);var n=e.prototype;return n._internalToggle=function(){this.isChecked=!this.isChecked},n._set=function(t,e){if(void 0===e&&(e=!0),this._isChecked!=t){this._isChecked=t;var n=this._toggleContainer;n&&n.enabled&&this.enabled&&(t||!n.anyTogglesChecked()&&!n.allowSwitchOff)&&(this._isChecked=!0,n.notifyToggleCheck(this,e)),this.playEffect(),e&&this._emitToggleEvents()}},n.playEffect=function(){this._checkMark&&(this._checkMark.node.active=this._isChecked)},n.setIsCheckedWithoutNotify=function(t){this._set(t,!1)},n.onEnable=function(){t.prototype.onEnable.call(this),this.playEffect(),this.node.on(e.EventType.CLICK,this._internalToggle,this)},n.onDisable=function(){t.prototype.onDisable.call(this),this.node.off(e.EventType.CLICK,this._internalToggle,this)},n.OnDestroy=function(){var t=this._toggleContainer;t&&t.ensureValidState()},n._emitToggleEvents=function(){this.node.emit(e.EventType.TOGGLE,this),this.checkEvents&&GB.emitEvents(this.checkEvents,this)},L(e,[{key:"isChecked",get:function(){return this._isChecked},set:function(t){this._set(t)}},{key:"checkMark",get:function(){return this._checkMark},set:function(t){this._checkMark!==t&&(this._checkMark=t)}},{key:"_resizeToTarget",set:function(t){t&&this._resizeNodeToTargetNode()}},{key:"_toggleContainer",get:function(){var t=this.node.parent;return i.Node.isNode(t)?t.getComponent("cc.ToggleContainer"):null}}]),e}(f2),N6.EventType=z6(B6,u2),q((R6=L6).prototype,"isChecked",[T6,A6],Object.getOwnPropertyDescriptor(R6.prototype,"isChecked"),R6.prototype),q(R6.prototype,"checkMark",[E6,C6,b6],Object.getOwnPropertyDescriptor(R6.prototype,"checkMark"),R6.prototype),D6=q(R6.prototype,"checkEvents",[w6,cl,P6],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),O6=q(R6.prototype,"_isChecked",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),M6=q(R6.prototype,"_checkMark",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I6=R6))||I6)||I6)||I6)||I6)||I6));i.Toggle=Z6;var J6,$6,t7,e7,n7,i7,r7,a7,o7,s7,c7,l7,u7,h7,f7,_7,p7,d7,m7,g7,v7,y7,x7,S7,T7,A7,E7,C7,b7,w7,P7,I7,R7,D7,O7,M7,N7,L7,B7,F7,z7,U7,k7,G7,H7,V7=function(e){return t({ToggleContainer:e,ToggleContainerComponent:e}),e}((U6=nl("cc.ToggleContainer"),k6=vl(),G6=rl(110),H6=pl(),V6=Al(),j6=Bl([GB]),W6=Al(),U6(X6=k6(X6=G6(X6=H6(X6=_l((Q6=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return X(e=t.call.apply(t,[this].concat(i))||this,"_allowSwitchOff",Y6,V(e)),X(e,"checkEvents",K6,V(e)),e}F(e,t);var n=e.prototype;return n.onEnable=function(){this.ensureValidState(),this.node.on(WA.CHILD_ADDED,this.ensureValidState,this),this.node.on(WA.CHILD_REMOVED,this.ensureValidState,this)},n.onDisable=function(){this.node.off(WA.CHILD_ADDED,this.ensureValidState,this),this.node.off(WA.CHILD_REMOVED,this.ensureValidState,this)},n.activeToggles=function(){return this.toggleItems.filter((function(t){return t.isChecked}))},n.anyTogglesChecked=function(){return!!this.toggleItems.find((function(t){return t.isChecked}))},n.notifyToggleCheck=function(t,e){if(void 0===e&&(e=!0),this.enabledInHierarchy){for(var n=0;n<this.toggleItems.length;n++){var r=this.toggleItems[n];r!==t&&(e?r.isChecked=!1:r.setIsCheckedWithoutNotify(!1))}this.checkEvents&&i.Component.EventHandler.emitEvents(this.checkEvents,t)}},n.ensureValidState=function(){var t=this.toggleItems;if(!this._allowSwitchOff&&!this.anyTogglesChecked()&&0!==t.length){var e=t[0];e.isChecked=!0,this.notifyToggleCheck(e)}var n=this.activeToggles();if(n.length>1)for(var i=n[0],r=0;r<n.length;++r){var a=n[r];a!==i&&(a.isChecked=!1)}},L(e,[{key:"allowSwitchOff",get:function(){return this._allowSwitchOff},set:function(t){this._allowSwitchOff=t}},{key:"toggleItems",get:function(){return this.node.children.map((function(t){var e=t.getComponent("cc.Toggle");return e&&e.enabled?e:null})).filter(Boolean)}}]),e}($u),Y6=q((q6=Q6).prototype,"_allowSwitchOff",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),q(q6.prototype,"allowSwitchOff",[V6],Object.getOwnPropertyDescriptor(q6.prototype,"allowSwitchOff"),q6.prototype),K6=q(q6.prototype,"checkEvents",[j6,cl,W6],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),X6=q6))||X6)||X6)||X6)||X6)||X6));i.ToggleContainer=V7;var j7,W7,X7=new Ni;function q7(t){return t instanceof AD?YM:t._uiProps.uiTransformComp?t._uiProps.uiTransformComp.contentSize:Gi.ZERO}function Y7(t,e,n,i){t.parent?X7.set(t.parent.getScale().x,t.parent.getScale().y):X7.set(0,0);for(var r=X7.x,a=X7.y,o=0,s=0,c=t.parent;;){if(!c)return n.x=n.y=0,void(i.x=i.y=1);var l=c.getPosition();if(o+=l.x,s+=l.y,(c=c.parent)===e)break;c?X7.set(c.getScale().x,c.getScale().y):X7.set(0,0);var u=X7.x,h=X7.y;o*=u,s*=h,r*=u,a*=h}i.x=0!==r?1/r:1,i.y=0!==a?1/a:1,n.x=-o,n.y=-s}!function(t){t[t.ONCE=0]="ONCE",t[t.ALWAYS=1]="ALWAYS",t[t.ON_WINDOW_RESIZE=2]="ON_WINDOW_RESIZE"}(j7||(j7={})),Zt(j7),function(t){t[t.TOP=1]="TOP",t[t.MID=2]="MID",t[t.BOT=4]="BOT",t[t.LEFT=8]="LEFT",t[t.CENTER=16]="CENTER",t[t.RIGHT=32]="RIGHT",t[t.HORIZONTAL=56]="HORIZONTAL",t[t.VERTICAL=7]="VERTICAL"}(W7||(W7={}));var K7,Q7,Z7,J7,$7,t9,e9,n9,i9,r9,a9,o9,s9,c9,l9,u9,h9,f9,_9,p9=W7.TOP|W7.BOT,d9=W7.LEFT|W7.RIGHT,m9=function(e){return t({Widget:e,WidgetComponent:e}),e}((J6=nl("cc.Widget"),$6=vl(),t7=rl(110),e7=pl(),n7=il(FW),i7=Bl(qC),r7=Al(),a7=Al(),o7=Al(),s7=Al(),c7=Al(),l7=Al(),u7=Al(),h7=xl(),f7=xl(),_7=Al(),p7=Al(),d7=Al(),m7=Al(),g7=Al(),v7=Al(),y7=Bl(j7),x7=Al(),J6(S7=$6(S7=t7(S7=e7(S7=n7(S7=_l((H7=G7=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._lastPos=new di,e._lastSize=new Gi,e._dirty=!0,e._hadAlignOnce=!1,X(e,"_alignFlags",A7,V(e)),X(e,"_target",E7,V(e)),X(e,"_left",C7,V(e)),X(e,"_right",b7,V(e)),X(e,"_top",w7,V(e)),X(e,"_bottom",P7,V(e)),X(e,"_horizontalCenter",I7,V(e)),X(e,"_verticalCenter",R7,V(e)),X(e,"_isAbsLeft",D7,V(e)),X(e,"_isAbsRight",O7,V(e)),X(e,"_isAbsTop",M7,V(e)),X(e,"_isAbsBottom",N7,V(e)),X(e,"_isAbsHorizontalCenter",L7,V(e)),X(e,"_isAbsVerticalCenter",B7,V(e)),X(e,"_originalWidth",F7,V(e)),X(e,"_originalHeight",z7,V(e)),X(e,"_alignMode",U7,V(e)),X(e,"_lockFlags",k7,V(e)),e}F(e,t);var n=e.prototype;return n.updateAlignment=function(){i._widgetManager.updateAlignment(this.node)},n._validateTargetInDEV=function(){},n.setDirty=function(){this._recursiveDirty()},n.onEnable=function(){this.node.getPosition(this._lastPos),this._lastSize.set(this.node._uiProps.uiTransformComp.contentSize),i._widgetManager.add(this),this._hadAlignOnce=!1,this._registerEvent(),this._registerTargetEvents()},n.onDisable=function(){i._widgetManager.remove(this),this._unregisterEvent(),this._unregisterTargetEvents()},n.onDestroy=function(){this._removeParentEvent()},n._adjustWidgetToAllowMovingInEditor=function(){},n._adjustWidgetToAllowResizingInEditor=function(){},n._adjustWidgetToAnchorChanged=function(){this.setDirty()},n._adjustTargetToParentChanged=function(t){t&&this._unregisterOldParentEvents(t),this.node.getParent()&&this._registerTargetEvents(),this._setDirtyByMode()},n._registerEvent=function(){this.node.on(WA.TRANSFORM_CHANGED,this._setDirtyByMode,this),this.node.on(WA.SIZE_CHANGED,this._setDirtyByMode,this),this.node.on(WA.ANCHOR_CHANGED,this._adjustWidgetToAnchorChanged,this),this.node.on(WA.PARENT_CHANGED,this._adjustTargetToParentChanged,this)},n._unregisterEvent=function(){this.node.off(WA.TRANSFORM_CHANGED,this._setDirtyByMode,this),this.node.off(WA.SIZE_CHANGED,this._setDirtyByMode,this),this.node.off(WA.ANCHOR_CHANGED,this._adjustWidgetToAnchorChanged,this)},n._removeParentEvent=function(){this.node.off(WA.PARENT_CHANGED,this._adjustTargetToParentChanged,this)},n._autoChangedValue=function(t,e){if((this._alignFlags&t)>0){var n=this.node.parent&&this.node.parent._uiProps,i=n&&n.uiTransformComp,r=i?i.contentSize:YM;this.isAlignLeft&&t===W7.LEFT?this._left=e?this._left*r.width:this._left/r.width:this.isAlignRight&&t===W7.RIGHT?this._right=e?this._right*r.width:this._right/r.width:this.isAlignHorizontalCenter&&t===W7.CENTER?this._horizontalCenter=e?this._horizontalCenter*r.width:this._horizontalCenter/r.width:this.isAlignTop&&t===W7.TOP?this._top=e?this._top*r.height:this._top/r.height:this.isAlignBottom&&t===W7.BOT?this._bottom=e?this._bottom*r.height:this._bottom/r.height:this.isAbsoluteVerticalCenter&&t===W7.MID&&(this._verticalCenter=this._verticalCenter/r.height),this._recursiveDirty()}},n._registerTargetEvents=function(){var t=this._target||this.node.parent;t&&t.getComponent(FW)&&(t.on(WA.TRANSFORM_CHANGED,this._setDirtyByMode,this),t.on(WA.SIZE_CHANGED,this._setDirtyByMode,this),t.on(WA.ANCHOR_CHANGED,this._setDirtyByMode,this))},n._unregisterTargetEvents=function(){var t=this._target||this.node.parent;t&&(t.off(WA.TRANSFORM_CHANGED,this._setDirtyByMode,this),t.off(WA.SIZE_CHANGED,this._setDirtyByMode,this),t.off(WA.ANCHOR_CHANGED,this._setDirtyByMode,this))},n._unregisterOldParentEvents=function(t){var e=this._target||t;e&&(e.off(WA.TRANSFORM_CHANGED,this._setDirtyByMode,this),e.off(WA.SIZE_CHANGED,this._setDirtyByMode,this))},n._setDirtyByMode=function(){this.alignMode===j7.ALWAYS&&this._recursiveDirty()},n._setAlign=function(t,e){if(e!==(this._alignFlags&t)>0){var n=(t&d9)>0,i=this.node._uiProps.uiTransformComp;e?(this._alignFlags|=t,n?(this.isAlignHorizontalCenter=!1,this.isStretchWidth&&(this._originalWidth=i.width)):(this.isAlignVerticalCenter=!1,this.isStretchHeight&&(this._originalHeight=i.height))):(n?this.isStretchWidth&&(i.width=this._originalWidth):this.isStretchHeight&&(i.height=this._originalHeight),this._alignFlags&=~t)}},n._recursiveDirty=function(){this._dirty||(this._dirty=!0)},L(e,[{key:"target",get:function(){return this._target},set:function(t){this._target!==t&&(this._unregisterTargetEvents(),this._target=t,this._registerTargetEvents(),this._validateTargetInDEV(),this._recursiveDirty())}},{key:"isAlignTop",get:function(){return(this._alignFlags&W7.TOP)>0},set:function(t){this._setAlign(W7.TOP,t),this._recursiveDirty()}},{key:"isAlignBottom",get:function(){return(this._alignFlags&W7.BOT)>0},set:function(t){this._setAlign(W7.BOT,t),this._recursiveDirty()}},{key:"isAlignLeft",get:function(){return(this._alignFlags&W7.LEFT)>0},set:function(t){this._setAlign(W7.LEFT,t),this._recursiveDirty()}},{key:"isAlignRight",get:function(){return(this._alignFlags&W7.RIGHT)>0},set:function(t){this._setAlign(W7.RIGHT,t),this._recursiveDirty()}},{key:"isAlignVerticalCenter",get:function(){return(this._alignFlags&W7.MID)>0},set:function(t){t?(this.isAlignTop=!1,this.isAlignBottom=!1,this._alignFlags|=W7.MID):this._alignFlags&=~W7.MID,this._recursiveDirty()}},{key:"isAlignHorizontalCenter",get:function(){return(this._alignFlags&W7.CENTER)>0},set:function(t){t?(this.isAlignLeft=!1,this.isAlignRight=!1,this._alignFlags|=W7.CENTER):this._alignFlags&=~W7.CENTER,this._recursiveDirty()}},{key:"isStretchWidth",get:function(){return(this._alignFlags&d9)===d9}},{key:"isStretchHeight",get:function(){return(this._alignFlags&p9)===p9}},{key:"top",get:function(){return this._top},set:function(t){this._top=t,this._recursiveDirty()}},{key:"editorTop",get:function(){return this._isAbsTop?this._top:100*this._top},set:function(t){this._top=this._isAbsTop?t:t/100,this._recursiveDirty()}},{key:"bottom",get:function(){return this._bottom},set:function(t){this._bottom=t,this._recursiveDirty()}},{key:"editorBottom",get:function(){return this._isAbsBottom?this._bottom:100*this._bottom},set:function(t){this._bottom=this._isAbsBottom?t:t/100,this._recursiveDirty()}},{key:"left",get:function(){return this._left},set:function(t){this._left=t,this._recursiveDirty()}},{key:"editorLeft",get:function(){return this._isAbsLeft?this._left:100*this._left},set:function(t){this._left=this._isAbsLeft?t:t/100,this._recursiveDirty()}},{key:"right",get:function(){return this._right},set:function(t){this._right=t,this._recursiveDirty()}},{key:"editorRight",get:function(){return this._isAbsRight?this._right:100*this._right},set:function(t){this._right=this._isAbsRight?t:t/100,this._recursiveDirty()}},{key:"horizontalCenter",get:function(){return this._horizontalCenter},set:function(t){this._horizontalCenter=t,this._recursiveDirty()}},{key:"editorHorizontalCenter",get:function(){return this._isAbsHorizontalCenter?this._horizontalCenter:100*this._horizontalCenter},set:function(t){this._horizontalCenter=this._isAbsHorizontalCenter?t:t/100,this._recursiveDirty()}},{key:"verticalCenter",get:function(){return this._verticalCenter},set:function(t){this._verticalCenter=t,this._recursiveDirty()}},{key:"editorVerticalCenter",get:function(){return this._isAbsVerticalCenter?this._verticalCenter:100*this._verticalCenter},set:function(t){this._verticalCenter=this._isAbsVerticalCenter?t:t/100,this._recursiveDirty()}},{key:"isAbsoluteTop",get:function(){return this._isAbsTop},set:function(t){this._isAbsTop!==t&&(this._isAbsTop=t,this._autoChangedValue(W7.TOP,this._isAbsTop))}},{key:"isAbsoluteBottom",get:function(){return this._isAbsBottom},set:function(t){this._isAbsBottom!==t&&(this._isAbsBottom=t,this._autoChangedValue(W7.BOT,this._isAbsBottom))}},{key:"isAbsoluteLeft",get:function(){return this._isAbsLeft},set:function(t){this._isAbsLeft!==t&&(this._isAbsLeft=t,this._autoChangedValue(W7.LEFT,this._isAbsLeft))}},{key:"isAbsoluteRight",get:function(){return this._isAbsRight},set:function(t){this._isAbsRight!==t&&(this._isAbsRight=t,this._autoChangedValue(W7.RIGHT,this._isAbsRight))}},{key:"isAbsoluteHorizontalCenter",get:function(){return this._isAbsHorizontalCenter},set:function(t){this._isAbsHorizontalCenter!==t&&(this._isAbsHorizontalCenter=t,this._autoChangedValue(W7.CENTER,this._isAbsHorizontalCenter))}},{key:"isAbsoluteVerticalCenter",get:function(){return this._isAbsVerticalCenter},set:function(t){this._isAbsVerticalCenter!==t&&(this._isAbsVerticalCenter=t,this._autoChangedValue(W7.MID,this._isAbsVerticalCenter))}},{key:"alignMode",get:function(){return this._alignMode},set:function(t){this._alignMode=t,this._recursiveDirty()}},{key:"alignFlags",get:function(){return this._alignFlags},set:function(t){this._alignFlags!==t&&(this._alignFlags=t,this._recursiveDirty())}}]),e}($u),G7.AlignMode=j7,q((T7=H7).prototype,"target",[i7,r7],Object.getOwnPropertyDescriptor(T7.prototype,"target"),T7.prototype),q(T7.prototype,"isAlignTop",[a7],Object.getOwnPropertyDescriptor(T7.prototype,"isAlignTop"),T7.prototype),q(T7.prototype,"isAlignBottom",[o7],Object.getOwnPropertyDescriptor(T7.prototype,"isAlignBottom"),T7.prototype),q(T7.prototype,"isAlignLeft",[s7],Object.getOwnPropertyDescriptor(T7.prototype,"isAlignLeft"),T7.prototype),q(T7.prototype,"isAlignRight",[c7],Object.getOwnPropertyDescriptor(T7.prototype,"isAlignRight"),T7.prototype),q(T7.prototype,"isAlignVerticalCenter",[l7],Object.getOwnPropertyDescriptor(T7.prototype,"isAlignVerticalCenter"),T7.prototype),q(T7.prototype,"isAlignHorizontalCenter",[u7],Object.getOwnPropertyDescriptor(T7.prototype,"isAlignHorizontalCenter"),T7.prototype),q(T7.prototype,"isStretchWidth",[h7],Object.getOwnPropertyDescriptor(T7.prototype,"isStretchWidth"),T7.prototype),q(T7.prototype,"isStretchHeight",[f7],Object.getOwnPropertyDescriptor(T7.prototype,"isStretchHeight"),T7.prototype),q(T7.prototype,"top",[_7],Object.getOwnPropertyDescriptor(T7.prototype,"top"),T7.prototype),q(T7.prototype,"editorTop",[yl],Object.getOwnPropertyDescriptor(T7.prototype,"editorTop"),T7.prototype),q(T7.prototype,"bottom",[p7],Object.getOwnPropertyDescriptor(T7.prototype,"bottom"),T7.prototype),q(T7.prototype,"editorBottom",[yl],Object.getOwnPropertyDescriptor(T7.prototype,"editorBottom"),T7.prototype),q(T7.prototype,"left",[d7],Object.getOwnPropertyDescriptor(T7.prototype,"left"),T7.prototype),q(T7.prototype,"editorLeft",[yl],Object.getOwnPropertyDescriptor(T7.prototype,"editorLeft"),T7.prototype),q(T7.prototype,"right",[m7],Object.getOwnPropertyDescriptor(T7.prototype,"right"),T7.prototype),q(T7.prototype,"editorRight",[yl],Object.getOwnPropertyDescriptor(T7.prototype,"editorRight"),T7.prototype),q(T7.prototype,"horizontalCenter",[g7],Object.getOwnPropertyDescriptor(T7.prototype,"horizontalCenter"),T7.prototype),q(T7.prototype,"editorHorizontalCenter",[yl],Object.getOwnPropertyDescriptor(T7.prototype,"editorHorizontalCenter"),T7.prototype),q(T7.prototype,"verticalCenter",[v7],Object.getOwnPropertyDescriptor(T7.prototype,"verticalCenter"),T7.prototype),q(T7.prototype,"editorVerticalCenter",[yl],Object.getOwnPropertyDescriptor(T7.prototype,"editorVerticalCenter"),T7.prototype),q(T7.prototype,"isAbsoluteTop",[yl],Object.getOwnPropertyDescriptor(T7.prototype,"isAbsoluteTop"),T7.prototype),q(T7.prototype,"isAbsoluteBottom",[yl],Object.getOwnPropertyDescriptor(T7.prototype,"isAbsoluteBottom"),T7.prototype),q(T7.prototype,"isAbsoluteLeft",[yl],Object.getOwnPropertyDescriptor(T7.prototype,"isAbsoluteLeft"),T7.prototype),q(T7.prototype,"isAbsoluteRight",[yl],Object.getOwnPropertyDescriptor(T7.prototype,"isAbsoluteRight"),T7.prototype),q(T7.prototype,"isAbsoluteHorizontalCenter",[yl],Object.getOwnPropertyDescriptor(T7.prototype,"isAbsoluteHorizontalCenter"),T7.prototype),q(T7.prototype,"isAbsoluteVerticalCenter",[yl],Object.getOwnPropertyDescriptor(T7.prototype,"isAbsoluteVerticalCenter"),T7.prototype),q(T7.prototype,"alignMode",[y7,x7],Object.getOwnPropertyDescriptor(T7.prototype,"alignMode"),T7.prototype),q(T7.prototype,"alignFlags",[yl],Object.getOwnPropertyDescriptor(T7.prototype,"alignFlags"),T7.prototype),A7=q(T7.prototype,"_alignFlags",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),E7=q(T7.prototype,"_target",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C7=q(T7.prototype,"_left",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),b7=q(T7.prototype,"_right",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),w7=q(T7.prototype,"_top",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),P7=q(T7.prototype,"_bottom",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),I7=q(T7.prototype,"_horizontalCenter",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),R7=q(T7.prototype,"_verticalCenter",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),D7=q(T7.prototype,"_isAbsLeft",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),O7=q(T7.prototype,"_isAbsRight",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),M7=q(T7.prototype,"_isAbsTop",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),N7=q(T7.prototype,"_isAbsBottom",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),L7=q(T7.prototype,"_isAbsHorizontalCenter",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),B7=q(T7.prototype,"_isAbsVerticalCenter",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),F7=q(T7.prototype,"_originalWidth",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),z7=q(T7.prototype,"_originalHeight",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),U7=q(T7.prototype,"_alignMode",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return j7.ON_WINDOW_RESIZE}}),k7=q(T7.prototype,"_lockFlags",[cl,ul],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),S7=T7))||S7)||S7)||S7)||S7)||S7)||S7));i.internal.computeInverseTransForTarget=Y7,i.internal.getReadonlyNodeSize=q7,i.Widget=m9;var g9,v9=new _i;!function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL"}(g9||(g9={})),Zt(g9);var y9,x9,S9,T9,A9,E9,C9,b9,w9,P9,I9,R9,D9,O9,M9,N9,L9,B9,F9,z9,U9,k9,G9,H9,V9,j9,W9,X9,q9,Y9,K9,Q9,Z9,J9,$9,ttt,ett,ntt,itt,rtt,att,ott,stt,ctt=function(e){return t({PageViewIndicator:e,PageViewIndicatorComponent:e}),e}((K7=nl("cc.PageViewIndicator"),Q7=vl(),Z7=rl(110),J7=pl(),$7=Bl(uj),t9=Al(),e9=Bl(g9),n9=Al(),i9=Bl(Gi),r9=Al(),a9=Al(),K7(o9=Q7(o9=Z7(o9=J7((_9=f9=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return X(e=t.call.apply(t,[this].concat(i))||this,"spacing",c9,V(e)),X(e,"_spriteFrame",l9,V(e)),X(e,"_direction",u9,V(e)),X(e,"_cellSize",h9,V(e)),e._layout=null,e._pageView=null,e._indicators=[],e}F(e,t);var n=e.prototype;return n.onLoad=function(){this._updateLayout()},n.setPageView=function(t){this._pageView=t,this._refresh()},n._updateLayout=function(){this._layout=this.getComponent(l5),this._layout||(this._layout=this.addComponent(l5));var t=this._layout;this.direction===g9.HORIZONTAL?(t.type=l5.Type.HORIZONTAL,t.spacingX=this.spacing):this.direction===g9.VERTICAL&&(t.type=l5.Type.VERTICAL,t.spacingY=this.spacing),t.resizeMode=l5.ResizeMode.CONTAINER},n._createIndicator=function(){var t=new qC;t.layer=this.node.layer;var e=t.addComponent(eQ);return e.spriteFrame=this.spriteFrame,e.sizeMode=eQ.SizeMode.CUSTOM,t.parent=this.node,t._uiProps.uiTransformComp.setContentSize(this._cellSize),t},n._changedState=function(){var t=this._indicators;if(0!==t.length&&this._pageView){var e=this._pageView.curPageIdx;if(!(e>=t.length)){for(var n=0;n<t.length;++n){var i=t[n];if(i._uiProps.uiComp){var r=i._uiProps.uiComp;v9.set(r.color),v9.a=127.5,r.color=v9}}if(t[e]._uiProps.uiComp){var a=t[e]._uiProps.uiComp;v9.set(a.color),v9.a=255,a.color=v9}}}},n._refresh=function(){if(this._pageView){var t=this._indicators,e=this._pageView.getPages();if(e.length!==t.length){var n=0;if(e.length>t.length)for(n=0;n<e.length;++n)t[n]||(t[n]=this._createIndicator());else for(n=t.length-e.length;n>0;--n){var i=t[n-1];this.node.removeChild(i),t.splice(n-1,1)}this._layout&&this._layout.enabledInHierarchy&&this._layout.updateLayout(),this._changedState()}}},L(e,[{key:"spriteFrame",get:function(){return this._spriteFrame},set:function(t){this._spriteFrame!==t&&(this._spriteFrame=t)}},{key:"direction",get:function(){return this._direction},set:function(t){this._direction!==t&&(this._direction=t)}},{key:"cellSize",get:function(){return this._cellSize},set:function(t){this._cellSize!==t&&(this._cellSize=t)}}]),e}($u),f9.Direction=g9,q((s9=_9).prototype,"spriteFrame",[$7,t9],Object.getOwnPropertyDescriptor(s9.prototype,"spriteFrame"),s9.prototype),q(s9.prototype,"direction",[e9,n9],Object.getOwnPropertyDescriptor(s9.prototype,"direction"),s9.prototype),q(s9.prototype,"cellSize",[i9,r9],Object.getOwnPropertyDescriptor(s9.prototype,"cellSize"),s9.prototype),c9=q(s9.prototype,"spacing",[cl,a9],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),l9=q(s9.prototype,"_spriteFrame",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),u9=q(s9.prototype,"_direction",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return g9.HORIZONTAL}}),h9=q(s9.prototype,"_cellSize",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Gi(20,20)}}),o9=s9))||o9)||o9)||o9)||o9));i.PageViewIndicator=ctt;var ltt,utt,htt,ftt=new Ni;!function(t){t[t.Unified=0]="Unified",t[t.Free=1]="Free"}(ltt||(ltt={})),Zt(ltt),function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical"}(utt||(utt={})),Zt(utt),function(t){t.PAGE_TURNING="page-turning"}(htt||(htt={}));var _tt=function(e){return t({PageView:e,PageViewComponent:e}),e}((y9=nl("cc.PageView"),x9=vl(),S9=rl(110),T9=pl(),A9=Bl(ltt),E9=Al(),C9=Bl(utt),b9=Al(),w9=El(),P9=Al(),I9=El(),R9=Al(),D9=Bl(ctt),O9=Al(),M9=Al(),N9=Bl(V5),L9=xl(),B9=Bl(V5),F9=xl(),z9=xl(),U9=xl(),k9=xl(),G9=Bl([GB]),H9=xl(),V9=Al(),j9=Bl([GB]),W9=Al(),y9(X9=x9(X9=S9(X9=T9((stt=ott=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return X(e=t.call.apply(t,[this].concat(i))||this,"autoPageTurningThreshold",Y9,V(e)),X(e,"horizontal",K9,V(e)),X(e,"vertical",Q9,V(e)),X(e,"cancelInnerEvents",Z9,V(e)),X(e,"scrollEvents",J9,V(e)),X(e,"pageTurningSpeed",$9,V(e)),X(e,"pageEvents",ttt,V(e)),X(e,"_sizeMode",ett,V(e)),X(e,"_direction",ntt,V(e)),X(e,"_scrollThreshold",itt,V(e)),X(e,"_pageTurningEventTiming",rtt,V(e)),X(e,"_indicator",att,V(e)),e._curPageIdx=0,e._lastPageIdx=0,e._pages=[],e._initContentPos=new di,e._scrollCenterOffsetX=[],e._scrollCenterOffsetY=[],e._touchBeganPosition=new Ni,e._touchEndPosition=new Ni,e}F(e,t);var n=e.prototype;return n.onEnable=function(){t.prototype.onEnable.call(this),this.node.on(WA.SIZE_CHANGED,this._updateAllPagesSize,this),this.node.on(e.EventType.SCROLL_ENG_WITH_THRESHOLD,this._dispatchPageTurningEvent,this)},n.onDisable=function(){t.prototype.onDisable.call(this),this.node.off(WA.SIZE_CHANGED,this._updateAllPagesSize,this),this.node.off(e.EventType.SCROLL_ENG_WITH_THRESHOLD,this._dispatchPageTurningEvent,this)},n.onLoad=function(){this._initPages(),this.indicator&&this.indicator.setPageView(this)},n.getCurrentPageIndex=function(){return this._curPageIdx},n.setCurrentPageIndex=function(t){this.scrollToPage(t,1)},n.getPages=function(){return this._pages},n.addPage=function(t){t&&-1===this._pages.indexOf(t)&&this.content&&(t._uiProps.uiTransformComp?(this.content.addChild(t),this._pages.push(t),this._updatePageView()):T(4301))},n.insertPage=function(t,e){if(!(e<0)&&t&&-1===this._pages.indexOf(t)&&this.content)if(e>=this._pages.length)this.addPage(t);else{if(!t._uiProps.uiTransformComp)return void T(4301);this._pages.splice(e,0,t),this.content.insertChild(t,e),this._updatePageView()}},n.removePage=function(t){if(t&&this.content){var e=this._pages.indexOf(t);-1!==e?this.removePageAtIndex(e):E(4300,t.name)}},n.removePageAtIndex=function(t){var e=this._pages;if(!(t<0||t>=e.length)){var n=e[t];n&&this.content&&(this.content.removeChild(n),e.splice(t,1),this._updatePageView())}},n.removeAllPages=function(){if(this.content){for(var t=this._pages,e=0,n=t.length;e<n;e++)this.content.removeChild(t[e]);this._pages.length=0,this._updatePageView()}},n.scrollToPage=function(t,e){void 0===e&&(e=.3),t<0||t>=this._pages.length||(this._curPageIdx=t,this.scrollToOffset(this._moveOffsetValue(t),e,!0),this.indicator&&this.indicator._changedState())},n.getScrollEndedEventTiming=function(){return this.pageTurningEventTiming},n._updatePageView=function(){if(this.content){var t=this.content.getComponent(l5);t&&t.enabled&&t.updateLayout();var e=this._pages.length;this._curPageIdx>=e&&(this._curPageIdx=0===e?0:e-1,this._lastPageIdx=this._curPageIdx);for(var n=this._initContentPos,i=0;i<e;++i){var r=this._pages[i].position;this.direction===utt.Horizontal?this._scrollCenterOffsetX[i]=Math.abs(n.x+r.x):this._scrollCenterOffsetY[i]=Math.abs(n.y+r.y)}this.indicator&&this.indicator._refresh()}},n._updateAllPagesSize=function(){var t=this.view;if(this.content&&t&&this._sizeMode===ltt.Unified)for(var e=this._pages,n=t.contentSize,i=0,r=e.length;i<r;i++)e[i]._uiProps.uiTransformComp.setContentSize(n)},n._handleReleaseLogic=function(){this._autoScrollToPage(),this._scrolling&&(this._scrolling=!1,this._autoScrolling||this._dispatchEvent(e.EventType.SCROLL_ENDED))},n._onTouchBegan=function(e,n){e.touch.getUILocation(ftt),Ni.set(this._touchBeganPosition,ftt.x,ftt.y),t.prototype._onTouchBegan.call(this,e,n)},n._onTouchMoved=function(e,n){t.prototype._onTouchMoved.call(this,e,n)},n._onTouchEnded=function(e,n){e.touch.getUILocation(ftt),Ni.set(this._touchEndPosition,ftt.x,ftt.y),t.prototype._onTouchEnded.call(this,e,n)},n._onTouchCancelled=function(e,n){e.touch.getUILocation(ftt),Ni.set(this._touchEndPosition,ftt.x,ftt.y),t.prototype._onTouchCancelled.call(this,e,n)},n._onMouseWheel=function(){},n._syncScrollDirection=function(){this.horizontal=this.direction===utt.Horizontal,this.vertical=this.direction===utt.Vertical},n._syncSizeMode=function(){var t=this.view;if(this.content&&t){var e=this.content.getComponent(l5);if(e){if(this._sizeMode===ltt.Free&&this._pages.length>0){var n=this._pages[0]._uiProps.uiTransformComp,i=this._pages[this._pages.length-1]._uiProps.uiTransformComp;this.direction===utt.Horizontal?(e.paddingLeft=(t.width-n.width)/2,e.paddingRight=(t.width-i.width)/2):this.direction===utt.Vertical&&(e.paddingTop=(t.height-n.height)/2,e.paddingBottom=(t.height-i.height)/2)}e.updateLayout()}}},n._initPages=function(){if(this.content){this._initContentPos=this.content.position;for(var t=this.content.children,e=0;e<t.length;++e){var n=t[e];this._pages.indexOf(n)>=0||this._pages.push(n)}this._syncScrollDirection(),this._syncSizeMode(),this._updatePageView()}},n._dispatchPageTurningEvent=function(){this._lastPageIdx!==this._curPageIdx&&(this._lastPageIdx=this._curPageIdx,GB.emitEvents(this.pageEvents,this,htt.PAGE_TURNING),this.node.emit(htt.PAGE_TURNING,this))},n._isQuicklyScrollable=function(t){if(this.direction===utt.Horizontal){if(Math.abs(t.x)>this.autoPageTurningThreshold)return!0}else if(this.direction===utt.Vertical&&Math.abs(t.y)>this.autoPageTurningThreshold)return!0;return!1},n._moveOffsetValue=function(t){var e=new Ni;if(this._sizeMode===ltt.Free)this.direction===utt.Horizontal?e.x=this._scrollCenterOffsetX[t]:this.direction===utt.Vertical&&(e.y=this._scrollCenterOffsetY[t]);else{var n=this.view;if(!n)return e;this.direction===utt.Horizontal?e.x=t*n.width:this.direction===utt.Vertical&&(e.y=t*n.height)}return e},n._getDragDirection=function(t){return this._direction===utt.Horizontal?0===t.x?0:t.x>0?1:-1:0===t.y?0:t.y<0?1:-1},n._isScrollable=function(t,e,n){if(this._sizeMode===ltt.Free){var i=0,r=0;if(this.direction===utt.Horizontal)return i=this._scrollCenterOffsetX[e],r=this._scrollCenterOffsetX[n],Math.abs(t.x)>=Math.abs(i-r)*this.scrollThreshold;if(this.direction===utt.Vertical)return i=this._scrollCenterOffsetY[e],r=this._scrollCenterOffsetY[n],Math.abs(t.y)>=Math.abs(i-r)*this.scrollThreshold}else{var a=this.view;if(!a)return!1;if(this.direction===utt.Horizontal)return Math.abs(t.x)>=a.width*this.scrollThreshold;if(this.direction===utt.Vertical)return Math.abs(t.y)>=a.height*this.scrollThreshold}return!1},n._autoScrollToPage=function(){if(this._startBounceBackIfNeeded()){var t=this._getHowMuchOutOfBoundary();this._clampDelta(t),(t.x>0||t.y<0)&&(this._curPageIdx=0===this._pages.length?0:this._pages.length-1),(t.x<0||t.y>0)&&(this._curPageIdx=0),this.indicator&&this.indicator._changedState()}else{var e=new Ni;Ni.subtract(e,this._touchBeganPosition,this._touchEndPosition);var n=this._curPageIdx,i=n+this._getDragDirection(e),r=this.pageTurningSpeed*Math.abs(n-i);if(i<this._pages.length){if(this._isScrollable(e,n,i))return void this.scrollToPage(i,r);var a=this._calculateTouchMoveVelocity();if(this._isQuicklyScrollable(a))return void this.scrollToPage(i,r)}this.scrollToPage(n,r)}},L(e,[{key:"sizeMode",get:function(){return this._sizeMode},set:function(t){this._sizeMode!==t&&(this._sizeMode=t,this._syncSizeMode())}},{key:"direction",get:function(){return this._direction},set:function(t){this._direction!==t&&(this._direction=t,this._syncScrollDirection())}},{key:"scrollThreshold",get:function(){return this._scrollThreshold},set:function(t){this._scrollThreshold!==t&&(this._scrollThreshold=t)}},{key:"pageTurningEventTiming",get:function(){return this._pageTurningEventTiming},set:function(t){this._pageTurningEventTiming!==t&&(this._pageTurningEventTiming=t)}},{key:"indicator",get:function(){return this._indicator},set:function(t){this._indicator!==t&&(this._indicator=t,this.indicator&&this.indicator.setPageView(this))}},{key:"curPageIdx",get:function(){return this._curPageIdx}},{key:"verticalScrollBar",get:function(){return t.prototype.verticalScrollBar},set:function(t){this.verticalScrollBar=t}},{key:"horizontalScrollBar",get:function(){return t.prototype.horizontalScrollBar},set:function(t){this.horizontalScrollBar=t}}]),e}(p6),ott.SizeMode=ltt,ott.Direction=utt,ott.EventType=z6(htt,U8),q((q9=stt).prototype,"sizeMode",[A9,E9],Object.getOwnPropertyDescriptor(q9.prototype,"sizeMode"),q9.prototype),q(q9.prototype,"direction",[C9,b9],Object.getOwnPropertyDescriptor(q9.prototype,"direction"),q9.prototype),q(q9.prototype,"scrollThreshold",[Pl,w9,P9],Object.getOwnPropertyDescriptor(q9.prototype,"scrollThreshold"),q9.prototype),q(q9.prototype,"pageTurningEventTiming",[Pl,I9,R9],Object.getOwnPropertyDescriptor(q9.prototype,"pageTurningEventTiming"),q9.prototype),q(q9.prototype,"indicator",[D9,O9],Object.getOwnPropertyDescriptor(q9.prototype,"indicator"),q9.prototype),Y9=q(q9.prototype,"autoPageTurningThreshold",[cl,M9],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),q(q9.prototype,"verticalScrollBar",[N9,Xl,L9],Object.getOwnPropertyDescriptor(q9.prototype,"verticalScrollBar"),q9.prototype),q(q9.prototype,"horizontalScrollBar",[B9,Xl,F9],Object.getOwnPropertyDescriptor(q9.prototype,"horizontalScrollBar"),q9.prototype),K9=q(q9.prototype,"horizontal",[Xl,cl,z9],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Q9=q(q9.prototype,"vertical",[Xl,cl,U9],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Z9=q(q9.prototype,"cancelInnerEvents",[Xl,cl,k9],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),J9=q(q9.prototype,"scrollEvents",[G9,cl,Xl,H9],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),$9=q(q9.prototype,"pageTurningSpeed",[cl,yl,V9],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),ttt=q(q9.prototype,"pageEvents",[j9,cl,W9],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ett=q(q9.prototype,"_sizeMode",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ltt.Unified}}),ntt=q(q9.prototype,"_direction",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return utt.Horizontal}}),itt=q(q9.prototype,"_scrollThreshold",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),rtt=q(q9.prototype,"_pageTurningEventTiming",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),att=q(q9.prototype,"_indicator",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),X9=q9))||X9)||X9)||X9)||X9));i.PageView=_tt;var ptt=new di,dtt=new Ni,mtt=new Ni,gtt=new Ni(1,1),vtt=new Ni,ytt=new Ni;function xtt(t,e){if(!e._hadAlignOnce){e.alignMode===j7.ONCE&&(e._hadAlignOnce=!0);var n,i=e.target,r=mtt,a=gtt;i?Y7(t,n=i,r,a):n=t.parent;var o=q7(n),s=n instanceof AD||!n.getComponent(FW),c=s?dtt:n.getComponent(FW).anchorPoint,l=s;t.getPosition(ptt);var u=t._uiProps.uiTransformComp,h=ptt.x,f=ptt.y,_=u.anchorPoint,p=t.getScale();if(e.alignFlags&W7.HORIZONTAL){var d=0,m=0,g=o.width;l?(d=YM.left.x,m=YM.right.x):m=(d=-c.x*g)+g,d+=e.isAbsoluteLeft?e.left:e.left*g,m-=e.isAbsoluteRight?e.right:e.right*g,i&&(d+=r.x,d*=a.x,m+=r.x,m*=a.x);var v=0,y=_.x,x=p.x;if(x<0&&(y=1-y,x=-x),e.isStretchWidth)v=m-d,0!==x&&(u.width=v/x),h=d+y*v;else if(v=u.width*x,e.isAlignHorizontalCenter){var S=e.isAbsoluteHorizontalCenter?e.horizontalCenter:e.horizontalCenter*g,T=(.5-c.x)*o.width;i&&(S*=a.x,T+=r.x,T*=a.x),h=T+(y-.5)*v+S}else h=e.isAlignLeft?d+y*v:m+(y-1)*v;e._lastSize.width=v}if(e.alignFlags&W7.VERTICAL){var A=0,E=0,C=o.height;l?(E=YM.bottom.y,A=YM.top.y):A=(E=-c.y*C)+C,E+=e.isAbsoluteBottom?e.bottom:e.bottom*C,A-=e.isAbsoluteTop?e.top:e.top*C,i&&(E+=r.y,E*=a.y,A+=r.y,A*=a.y);var b=0,w=_.y,P=p.y;if(P<0&&(w=1-w,P=-P),e.isStretchHeight)b=A-E,0!==P&&(u.height=b/P),f=E+w*b;else if(b=u.height*P,e.isAlignVerticalCenter){var I=e.isAbsoluteVerticalCenter?e.verticalCenter:e.verticalCenter*C,R=(.5-c.y)*o.height;i&&(I*=a.y,R+=r.y,R*=a.y),f=R+(w-.5)*b+I}else f=e.isAlignBottom?E+w*b:A+(w-1)*b;e._lastSize.height=b}t.setPosition(h,f,ptt.z),di.set(e._lastPos,h,f,ptt.z)}}function Stt(t){var e=t.getComponent(m9);if(e&&e.enabled){if(!i.isValid(t,!0))return;Ett.push(e)}for(var n,r=W(t.children);!(n=r()).done;){var a=n.value;a.active&&Stt(a)}}function Ttt(){var t=WM.getScene();if(t){Ctt.isAligning=!0,Ctt._nodesOrderDirty&&(Ett.length=0,Stt(t),Ctt._nodesOrderDirty=!1);var e=null,n=Ctt._activeWidgetsIterator;for(n.i=0;n.i<Ett.length;++n.i)(e=Ett[n.i])._dirty&&(xtt(e.node,e),e._dirty=!1);Ctt.isAligning=!1}}var Att,Ett=[],Ctt=t("widgetManager",i._widgetManager={isAligning:!1,_nodesOrderDirty:!1,_activeWidgetsIterator:new kt.MutableForwardIterator(Ett),animationState:null,init:function(){WM.on(jM.EVENT_AFTER_SCENE_LAUNCH,Ttt),WM.on(jM.EVENT_AFTER_UPDATE,Ttt),ZM.instance.on("design-resolution-changed",this.onResized,this);var t=this.onResized.bind(this);ZM.instance.on("canvas-resize",t),oh.on("orientation-change",t)},add:function(){this._nodesOrderDirty=!0},remove:function(t){this._activeWidgetsIterator.remove(t)},onResized:function(){var t=WM.getScene();t&&this.refreshWidgetOnResized(t)},refreshWidgetOnResized:function(t){var e=qC.isNode(t)&&t.getComponent(m9);e&&e.enabled&&(e.alignMode===j7.ON_WINDOW_RESIZE||e.alignMode===j7.ALWAYS)&&e.setDirty();for(var n,i=W(t.children);!(n=i()).done;){var r=n.value;this.refreshWidgetOnResized(r)}},updateOffsetsToStayPut:function(t,e){function n(t,e){return Math.abs(t-e)>1e-10?e:t}var i=t.node,r=i.parent;if(r){var a=vtt;a.set(0,0);var o=ytt;if(o.set(1,1),t.target&&Y7(i,r=t.target,a,o),!e)return;var s=r._uiProps&&r._uiProps.uiTransformComp,c=s?s.anchorPoint:dtt,l=i._uiProps.uiTransformComp,u=q7(r),h=l.anchorPoint,f=i.getPosition(),_=W7,p=i.getScale(),d=0;if(e&_.LEFT){var m=-c.x*u.width;m+=a.x,m*=o.x,d=f.x-h.x*l.width*p.x-m,t.isAbsoluteLeft||(d/=u.width),d/=o.x,t.left=n(t.left,d)}if(e&_.RIGHT){var g=(1-c.x)*u.width;g+=a.x,d=(g*=o.x)-(f.x+(1-h.x)*l.width*p.x),t.isAbsoluteRight||(d/=u.width),d/=o.x,t.right=n(t.right,d)}if(e&_.TOP){var v=(1-c.y)*u.height;v+=a.y,d=(v*=o.y)-(f.y+(1-h.y)*l.height*p.y),t.isAbsoluteTop||(d/=u.height),d/=o.y,t.top=n(t.top,d)}if(e&_.BOT){var y=-c.y*u.height;y+=a.y,y*=o.y,d=f.y-h.y*l.height*p.y-y,t.isAbsoluteBottom||(d/=u.height),d/=o.y,t.bottom=n(t.bottom,d)}}},updateAlignment:function t(e){var n=e.parent;n&&qC.isNode(n)&&t(n);var i=e.getComponent(m9);i&&n&&xtt(e,i)},AlignMode:j7,AlignFlags:W7});WM.on(jM.EVENT_INIT,(function(){Ctt.init()}));var btt,wtt,Ptt,Itt,Rtt,Dtt,Ott,Mtt,Ntt,Ltt,Btt,Ftt,ztt,Utt,ktt,Gtt,Htt,Vtt,jtt,Wtt=function(e){return t({SafeArea:e,SafeAreaComponent:e}),e}(nl("cc.SafeArea")(Att=vl()(Att=rl(110)(Att=_l(Att=pl()(Att=il(m9)(Att=function(t){function e(){return t.apply(this,arguments)||this}F(e,t);var n=e.prototype;return n.onEnable=function(){this.updateArea(),oh.on("window-resize",this.updateArea,this),oh.on("orientation-change",this.updateArea,this)},n.onDisable=function(){oh.off("window-resize",this.updateArea,this),oh.off("orientation-change",this.updateArea,this)},n.updateArea=function(){var t=this.node.getComponent(m9),e=this.node.getComponent(FW);if(t&&e){t.updateAlignment();var n=this.node.position.clone(),i=e.anchorPoint.clone();t.isAlignTop=t.isAlignBottom=t.isAlignLeft=t.isAlignRight=!0;var r=eN.getVisibleSize(),a=r.width,o=r.height,s=lh.getSafeAreaRect();t.top=o-s.y-s.height,t.bottom=s.y,t.left=s.x,t.right=a-s.x-s.width,t.updateAlignment();var c=this.node.position.clone(),l=i.x-(c.x-n.x)/e.width,u=i.y-(c.y-n.y)/e.height;e.setAnchorPoint(l,u),Ctt.add(t)}},e}($u))||Att)||Att)||Att)||Att)||Att)||Att);i.SafeArea=Wtt;var Xtt,qtt=function(e){return t({UICoordinateTracker:e,UICoordinateTrackerComponent:e}),e}((btt=nl("cc.UICoordinateTracker"),wtt=vl(),Ptt=pl(),Itt=rl(110),Rtt=Bl(qC),Dtt=Al(),Ott=Bl(oF),Mtt=Al(),Ntt=Al(),Ltt=Al(),Btt=Bl([GB]),Ftt=Al(),btt(ztt=wtt(ztt=Ptt(ztt=Itt((q((Utt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return X(e=t.call.apply(t,[this].concat(i))||this,"syncEvents",ktt,V(e)),X(e,"_target",Gtt,V(e)),X(e,"_camera",Htt,V(e)),X(e,"_useScale",Vtt,V(e)),X(e,"_distance",jtt,V(e)),e._transformPos=new di,e._viewPos=new di,e._canMove=!0,e._lastWPos=new di,e._lastCameraPos=new di,e}F(e,t);var n=e.prototype;return n.onEnable=function(){this._checkCanMove()},n.update=function(){var t=this.node.worldPosition,e=this._camera;if(this._canMove&&e&&e.camera&&(!this._lastWPos.equals(t)||!this._lastCameraPos.equals(e.node.worldPosition))&&(this._lastWPos.set(t),this._lastCameraPos.set(e.node.worldPosition),e.camera.update(),e.convertToUINode(t,this._target,this._transformPos),this._useScale&&di.transformMat4(this._viewPos,this.node.worldPosition,e.camera.matView),this.syncEvents.length>0)){var n=this._distance/Math.abs(this._viewPos.z);GB.emitEvents(this.syncEvents,this._transformPos,n)}},n._checkCanMove=function(){this._canMove=!(!this._camera||!this._target)},L(e,[{key:"target",get:function(){return this._target},set:function(t){this._target!==t&&(this._target=t,this._checkCanMove())}},{key:"camera",get:function(){return this._camera},set:function(t){this._camera!==t&&(this._camera=t,this._checkCanMove())}},{key:"useScale",get:function(){return this._useScale},set:function(t){this._useScale!==t&&(this._useScale=t)}},{key:"distance",get:function(){return this._distance},set:function(t){this._distance!==t&&(this._distance=t)}}]),e}($u)).prototype,"target",[Rtt,Dtt],Object.getOwnPropertyDescriptor(Utt.prototype,"target"),Utt.prototype),q(Utt.prototype,"camera",[Ott,Mtt],Object.getOwnPropertyDescriptor(Utt.prototype,"camera"),Utt.prototype),q(Utt.prototype,"useScale",[Ntt],Object.getOwnPropertyDescriptor(Utt.prototype,"useScale"),Utt.prototype),q(Utt.prototype,"distance",[Ltt],Object.getOwnPropertyDescriptor(Utt.prototype,"distance"),Utt.prototype),ktt=q(Utt.prototype,"syncEvents",[Btt,cl,Ftt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Gtt=q(Utt.prototype,"_target",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Htt=q(Utt.prototype,"_camera",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Vtt=q(Utt.prototype,"_useScale",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),jtt=q(Utt.prototype,"_distance",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),ztt=Utt))||ztt)||ztt)||ztt)||ztt)),Ytt=[WA.TOUCH_START,WA.TOUCH_END,WA.TOUCH_MOVE,WA.MOUSE_DOWN,WA.MOUSE_MOVE,WA.MOUSE_UP,WA.MOUSE_ENTER,WA.MOUSE_LEAVE,WA.MOUSE_WHEEL];function Ktt(t){t.propagationStopped=!0}var Qtt,Ztt,Jtt,$tt,tet,eet,net,iet,ret,aet,oet,set,cet=function(e){return t({BlockInputEvents:e,BlockInputEventsComponent:e}),e}(nl("cc.BlockInputEvents")(Xtt=vl()(Xtt=pl()(Xtt=function(t){function e(){return t.apply(this,arguments)||this}F(e,t);var n=e.prototype;return n.onEnable=function(){for(var t=0;t<Ytt.length;t++)this.node.on(Ytt[t],Ktt,this)},n.onDisable=function(){for(var t=0;t<Ytt.length;t++)this.node.off(Ytt[t],Ktt,this)},e}($u))||Xtt)||Xtt)||Xtt),uet={},het=t("SubContextView",(Qtt=nl("cc.SubContextView"),Ztt=vl(),Jtt=rl(110),$tt=il(FW),tet=pl(),eet=Al(),net=Al(),Qtt(iet=Ztt(iet=Jtt(iet=$tt(iet=tet((q((ret=function(t){function e(){var e;return X(e=t.call(this)||this,"_fps",aet,V(e)),e._sprite=void 0,e._imageAsset=void 0,e._texture=void 0,e._updatedTime=0,e._updateInterval=0,e._openDataContext=void 0,e._content=void 0,X(e,"_designResolutionSize",oet,V(e)),e._content=new qC("content"),e._content.hideFlags|=Ye.Flags.DontSave|Ye.Flags.HideInHierarchy,e._sprite=null,e._imageAsset=new Dm,e._openDataContext=null,e._updatedTime=performance.now(),e._texture=new ng,e}F(e,t);var n=e.prototype;return n.onLoad=function(){uet.getOpenDataContext?(this._updateInterval=1e3/this._fps,this._openDataContext=uet.getOpenDataContext(),this._initSharedCanvas(),this._initContentNode(),this._updateSubContextView(),this._updateContentLayer()):this.enabled=!1},n.onEnable=function(){this._registerNodeEvent()},n.onDisable=function(){this._unregisterNodeEvent()},n._initSharedCanvas=function(){if(this._openDataContext){var t=this._openDataContext.canvas;t.width=this._designResolutionSize.width,t.height=this._designResolutionSize.height}},n._initContentNode=function(){if(this._openDataContext){var t=this._openDataContext.canvas,e=this._imageAsset;if(e.reset(t),this._texture.image=e,this._texture.create(t.width,t.height),this._sprite=this._content.getComponent(eQ),this._sprite||(this._sprite=this._content.addComponent(eQ)),this._sprite.spriteFrame)this._sprite.spriteFrame.texture=this._texture;else{var n=new uj;n.texture=this._texture,this._sprite.spriteFrame=n}this._content.parent=this.node}},n._updateSubContextView=function(){if(this._openDataContext){var t=this.node.getComponent(FW),e=this._content.getComponent(FW),n=t.width/e.width,i=t.height/e.height,r=n>i?i:n;e.width*=r,e.height*=r;var a=eN.getViewportRect(),o=e.getBoundingBoxToWorld(),s=eN.getVisibleSize(),c=oh.devicePixelRatio,l=(a.width*(o.x/s.width)+a.x)/c,u=(a.height*(o.y/s.height)+a.y)/c,h=a.width*(o.width/s.width)/c,f=a.height*(o.height/s.height)/c;this._openDataContext.postMessage({fromEngine:!0,type:"engine",event:"viewport",x:l,y:u,width:h,height:f})}},n._updateSubContextTexture=function(){var t=this._imageAsset;if(t&&this._openDataContext&&!(t.width<=0||t.height<=0)){var e=this._openDataContext.canvas;t.reset(e),(e.width>t.width||e.height>t.height)&&this._texture.create(e.width,e.height),this._texture.uploadData(e)}},n._registerNodeEvent=function(){this.node.on(WA.TRANSFORM_CHANGED,this._updateSubContextView,this),this.node.on(WA.SIZE_CHANGED,this._updateSubContextView,this),this.node.on(WA.LAYER_CHANGED,this._updateContentLayer,this)},n._unregisterNodeEvent=function(){this.node.off(WA.TRANSFORM_CHANGED,this._updateSubContextView,this),this.node.off(WA.SIZE_CHANGED,this._updateSubContextView,this),this.node.off(WA.LAYER_CHANGED,this._updateContentLayer,this)},n._updateContentLayer=function(){this._content.layer=this.node.layer},n.update=function(t){void 0===t?this._updateSubContextTexture():performance.now()-this._updatedTime>=this._updateInterval&&(this._updatedTime+=this._updateInterval,this._updateSubContextTexture())},n.onDestroy=function(){this._content.destroy(),this._texture.destroy(),this._sprite&&this._sprite.destroy(),this._imageAsset.destroy(),this._openDataContext=null},L(e,[{key:"designResolutionSize",get:function(){return this._designResolutionSize},set:function(){}},{key:"fps",get:function(){return this._fps},set:function(t){this._fps!==t&&(this._fps=t,this._updateInterval=1e3/t)}}]),e}($u)).prototype,"designResolutionSize",[eet],Object.getOwnPropertyDescriptor(ret.prototype,"designResolutionSize"),ret.prototype),q(ret.prototype,"fps",[net],Object.getOwnPropertyDescriptor(ret.prototype,"fps"),ret.prototype),aet=q(ret.prototype,"_fps",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 60}}),oet=q(ret.prototype,"_designResolutionSize",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Gi(640,960)}}),iet=ret))||iet)||iet)||iet)||iet)||iet));i.SubContextView=het;var fet=t("UIReorderComponent",nl("cc.UIReorderComponent")(set=function(){E(1408,"UIReorderComponent")})||set);function _et(t,e,n,i){var r=(i.x-n.x)*(t.y-n.y)-(i.y-n.y)*(t.x-n.x),a=(e.x-t.x)*(t.y-n.y)-(e.y-t.y)*(t.x-n.x),o=(i.y-n.y)*(e.x-t.x)-(i.x-n.x)*(e.y-t.y);if(0!==o){var s=r/o,c=a/o;if(s>=0&&s<=1&&c>=0&&c<=1)return!0}return!1}i.UIReorderComponent=fet,i.ButtonComponent=f2,Gt.setClassAlias(f2,"cc.ButtonComponent"),i.EditBoxComponent=z3,Gt.setClassAlias(z3,"cc.EditBoxComponent"),i.LayoutComponent=l5,Gt.setClassAlias(l5,"cc.LayoutComponent"),i.ProgressBarComponent=N5,Gt.setClassAlias(N5,"cc.ProgressBarComponent"),i.ScrollViewComponent=p6,Gt.setClassAlias(p6,"cc.ScrollViewComponent"),i.ScrollBarComponent=V5,Gt.setClassAlias(V5,"cc.ScrollBarComponent"),i.SliderComponent=F6,Gt.setClassAlias(F6,"cc.SliderComponent"),i.ToggleComponent=Z6,Gt.setClassAlias(Z6,"cc.ToggleComponent"),i.ToggleContainerComponent=V7,Gt.setClassAlias(V7,"cc.ToggleContainerComponent"),i.WidgetComponent=m9,Gt.setClassAlias(m9,"cc.WidgetComponent"),i.PageViewComponent=_tt,Gt.setClassAlias(_tt,"cc.PageViewComponent"),i.PageViewIndicatorComponent=ctt,Gt.setClassAlias(ctt,"cc.PageViewIndicatorComponent"),i.SafeAreaComponent=Wtt,Gt.setClassAlias(Wtt,"cc.SafeAreaComponent"),Gt.setClassAlias(qtt,"cc.UICoordinateTrackerComponent"),i.BlockInputEventsComponent=cet,Gt.setClassAlias(cet,"cc.BlockInputEventsComponent");var pet=new Ni,det=new Ni,met=new Ni,get=new Ni;function vet(t,e,n){for(var i=n.length,r=0;r<i;++r)if(_et(t,e,n[r],n[(r+1)%i]))return!0;return!1}function yet(t,e){for(var n=!1,i=t.x,r=t.y,a=e.length,o=0,s=a-1;o<a;s=o++){var c=e[o].x,l=e[o].y,u=e[s].x,h=e[s].y;l>r!=h>r&&i<(u-c)*(r-l)/(h-l)+c&&(n=!n)}return n}function xet(t,e,n,i){var r,a=n.x-e.x,o=n.y-e.y,s=a*a+o*o,c=((t.x-e.x)*a+(t.y-e.y)*o)/s;return r=i?s?c<0?e:c>1?n:pet.set(e.x+c*a,e.y+c*o):e:pet.set(e.x+c*a,e.y+c*o),a=t.x-r.x,o=t.y-r.y,Math.sqrt(a*a+o*o)}var Tet=t("Intersection2D",(function(){}));Tet.lineLine=_et,Tet.lineRect=function(t,e,n){var i=pet.set(n.x,n.y),r=det.set(n.x,n.yMax),a=met.set(n.xMax,n.yMax),o=get.set(n.xMax,n.y);return!!(_et(t,e,i,r)||_et(t,e,r,a)||_et(t,e,a,o)||_et(t,e,o,i))},Tet.linePolygon=vet,Tet.rectRect=function(t,e){var n=t.x,i=t.y,r=t.x+t.width,a=t.y+t.height,o=e.x,s=e.y,c=e.x+e.width,l=e.y+e.height;return n<=c&&r>=o&&i<=l&&a>=s},Tet.rectPolygon=function(t,e){var n=pet.set(t.x,t.y),i=det.set(t.x,t.yMax),r=met.set(t.xMax,t.yMax),a=get.set(t.xMax,t.y);if(vet(n,i,e))return!0;if(vet(i,r,e))return!0;if(vet(r,a,e))return!0;if(vet(a,n,e))return!0;for(var o=0,s=e.length;o<s;++o)if(t.contains(e[o]))return!0;return!!(yet(n,e)||yet(i,e)||yet(r,e)||yet(a,e))},Tet.rectCircle=function(t,e,n){var i=e.x,r=e.y,a=t.x,o=t.y,s=t.width,c=t.height,l=i,u=r;i<a?l=a:i>a+s&&(l=a+s),r<o?u=o:r>o+c&&(u=o+c);var h=i-l,f=r-u;return Math.sqrt(h*h+f*f)<=n},Tet.polygonPolygon=function(t,e){var n,i;for(n=0,i=t.length;n<i;++n)if(vet(t[n],t[(n+1)%i],e))return!0;for(n=0,i=e.length;n<i;++n)if(yet(e[n],t))return!0;for(n=0,i=t.length;n<i;++n)if(yet(t[n],e))return!0;return!1},Tet.circleCircle=function(t,e,n,i){return Ni.distance(t,n)<e+i},Tet.polygonCircle=function(t,e,n){var i=e;if(yet(i,t))return!0;for(var r=0,a=t.length;r<a;r++)if(xet(i,0===r?t[t.length-1]:t[r-1],t[r],!0)<n)return!0;return!1},Tet.pointInPolygon=yet,Tet.pointLineDistance=xet;var Aet,Eet,Cet,bet,wet,Pet=function(){function t(){this._arrayBufferOrPaddings=[],this._length=0}var e=t.prototype;return e.setNextAlignment=function(t){if(0!==t){var e=this._length%t;if(0!==e){var n=t-e;this._arrayBufferOrPaddings.push(n),this._length+=n}}},e.addBuffer=function(t){var e=this._length;return this._arrayBufferOrPaddings.push(t),this._length+=t.byteLength,e},e.getLength=function(){return this._length},e.getCombined=function(){var t=new Uint8Array(this._length),e=0;return this._arrayBufferOrPaddings.forEach((function(n){"number"==typeof n?e+=n:(t.set(new Uint8Array(n),e),e+=n.byteLength)})),t.buffer},t}(),Iet=function(){function t(t,e){if(this._mesh=void 0,this._subMeshRenderings=[],this._mesh=t,this._mesh.struct.morph){var n=this._mesh.struct.primitives.length;this._subMeshRenderings=new Array(n).fill(null);for(var i=0;i<n;++i){var r=this._mesh.struct.morph.subMeshMorphs[i];r&&(r.targets.length>xd.MAX_MORPH_TARGET_COUNT?this._subMeshRenderings[i]=new Det(this._mesh,i,this._mesh.struct.morph,e):this._subMeshRenderings[i]=new Ret(this._mesh,i,this._mesh.struct.morph,e))}}}return t.prototype.createInstance=function(){for(var t=this,e=this._mesh.struct.primitives.length,n=new Array(e),i=0;i<e;++i){var r,a;n[i]=null!==(r=null===(a=this._subMeshRenderings[i])||void 0===a?void 0:a.createInstance())&&void 0!==r?r:null}return{setWeights:function(t,e){var i;null===(i=n[t])||void 0===i||i.setWeights(e)},requiredPatches:function(e){t._mesh.struct.morph;var i=t._mesh.struct.morph.subMeshMorphs[e],r=n[e];if(null===r)return null;var a=[{name:"CC_USE_MORPH",value:!0},{name:"CC_MORPH_TARGET_COUNT",value:i.targets.length}];return i.attributes.includes(oa.ATTR_POSITION)&&a.push({name:"CC_MORPH_TARGET_HAS_POSITION",value:!0}),i.attributes.includes(oa.ATTR_NORMAL)&&a.push({name:"CC_MORPH_TARGET_HAS_NORMAL",value:!0}),i.attributes.includes(oa.ATTR_TANGENT)&&a.push({name:"CC_MORPH_TARGET_HAS_TANGENT",value:!0}),a.push.apply(a,r.requiredPatches()),a},adaptPipelineState:function(t,e){var i;null===(i=n[t])||void 0===i||i.adaptPipelineState(e)},destroy:function(){for(var t,e=W(n);!(t=e()).done;){var i=t.value;null==i||i.destroy()}}}},t}(),Ret=function(){function t(t,e,n,i){this._gfxDevice=void 0,this._subMeshMorph=void 0,this._textureInfo=void 0,this._attributes=void 0,this._verticesCount=void 0,this._gfxDevice=i;var r=n.subMeshMorphs[e];this._subMeshMorph=r,Let(t,e,i);var a=t.struct.vertexBundles[t.struct.primitives[e].vertexBundelIndices[0]].view.count;this._verticesCount=a;var o=r.targets.length,s=Net(i,a*o);this._textureInfo={width:s.width,height:s.height},this._attributes=r.attributes.map((function(e,n){var i=s.create(),o=i.valueView;return r.targets.forEach((function(e,i){for(var r=e.displacements[n],s=new Float32Array(t.data.buffer,t.data.byteOffset+r.offset,r.count),c=a*i*4,l=0;l<a;++l)o[c+4*l+0]=s[3*l+0],o[c+4*l+1]=s[3*l+1],o[c+4*l+2]=s[3*l+2]})),i.updatePixels(),{name:e,morphTexture:i}}))}var e=t.prototype;return e.destroy=function(){for(var t,e=W(this._attributes);!(t=e()).done;)t.value.morphTexture.destroy()},e.createInstance=function(){var t=this,e=new Met(this._gfxDevice,this._subMeshMorph.targets.length);return e.setMorphTextureInfo(this._textureInfo.width,this._textureInfo.height),e.setVerticesCount(this._verticesCount),e.commit(),{setWeights:function(t){e.setWeights(t),e.commit()},requiredPatches:function(){return[{name:"CC_MORPH_TARGET_USE_TEXTURE",value:!0}]},adaptPipelineState:function(n){for(var i,r=W(t._attributes);!(i=r()).done;){var a=i.value,o=void 0;switch(a.name){case oa.ATTR_POSITION:o=Cd;break;case oa.ATTR_NORMAL:o=Pd;break;case oa.ATTR_TANGENT:o=Dd;break;default:p("Unexpected attribute!")}void 0!==o&&(n.bindSampler(o,a.morphTexture.sampler),n.bindTexture(o,a.morphTexture.texture))}n.bindBuffer(xd.BINDING,e.buffer),n.update()},destroy:function(){}}},t}(),Det=function(){function t(t,e,n,i){this._gfxDevice=void 0,this._attributes=[],this._gfxDevice=i;var r=n.subMeshMorphs[e];Let(t,e,i),this._attributes=r.attributes.map((function(e,n){return{name:e,targets:r.targets.map((function(e){return{displacements:new Float32Array(t.data.buffer,t.data.byteOffset+e.displacements[n].offset,e.displacements[n].count)}}))}}))}return t.prototype.createInstance=function(){return new Oet(this,this._attributes[0].targets[0].displacements.length/3,this._gfxDevice)},L(t,[{key:"data",get:function(){return this._attributes}}]),t}(),Oet=function(){function t(t,e,n){this._attributes=void 0,this._owner=void 0,this._morphUniforms=void 0,this._owner=t,this._morphUniforms=new Met(n,0);var i=Net(n,e);this._morphUniforms.setMorphTextureInfo(i.width,i.height),this._morphUniforms.commit(),this._attributes=this._owner.data.map((function(t){var e=i.create();return{attributeName:t.name,morphTexture:e}}))}var e=t.prototype;return e.setWeights=function(t){for(var e=0;e<this._attributes.length;++e){var n=this._attributes[e],i=n.morphTexture.valueView,r=this._owner.data[e];t.length,r.targets.length;for(var a=0;a<r.targets.length;++a){var o=r.targets[a].displacements,s=t[a],c=o.length/3;if(0===a)for(var l=0;l<c;++l)i[4*l+0]=o[3*l+0]*s,i[4*l+1]=o[3*l+1]*s,i[4*l+2]=o[3*l+2]*s;else if(0!==s)for(var u=0;u<c;++u)i[4*u+0]+=o[3*u+0]*s,i[4*u+1]+=o[3*u+1]*s,i[4*u+2]+=o[3*u+2]*s}n.morphTexture.updatePixels()}},e.requiredPatches=function(){return[{name:"CC_MORPH_TARGET_USE_TEXTURE",value:!0},{name:"CC_MORPH_PRECOMPUTED",value:!0}]},e.adaptPipelineState=function(t){for(var e,n=W(this._attributes);!(e=n()).done;){var i=e.value,r=void 0;switch(i.attributeName){case oa.ATTR_POSITION:r=Cd;break;case oa.ATTR_NORMAL:r=Pd;break;case oa.ATTR_TANGENT:r=Dd;break;default:p("Unexpected attribute!")}void 0!==r&&(t.bindSampler(r,i.morphTexture.sampler),t.bindTexture(r,i.morphTexture.texture))}t.bindBuffer(xd.BINDING,this._morphUniforms.buffer),t.update()},e.destroy=function(){this._morphUniforms.destroy();for(var t=0;t<this._attributes.length;++t)this._attributes[t].morphTexture.destroy()},t}(),Met=function(){function t(t,e){this._targetCount=void 0,this._localBuffer=void 0,this._remoteBuffer=void 0,this._targetCount=e,this._localBuffer=new DataView(new ArrayBuffer(xd.SIZE)),this._remoteBuffer=t.createBuffer(new Ta(Er.UNIFORM|Er.TRANSFER_DST,wr.HOST|wr.DEVICE,xd.SIZE,xd.SIZE))}var e=t.prototype;return e.destroy=function(){this._remoteBuffer.destroy()},e.setWeights=function(t){t.length,this._targetCount;for(var e=0;e<t.length;++e)this._localBuffer.setFloat32(xd.OFFSET_OF_WEIGHTS+4*e,t[e],i.sys.isLittleEndian)},e.setMorphTextureInfo=function(t,e){this._localBuffer.setFloat32(xd.OFFSET_OF_DISPLACEMENT_TEXTURE_WIDTH,t,i.sys.isLittleEndian),this._localBuffer.setFloat32(xd.OFFSET_OF_DISPLACEMENT_TEXTURE_HEIGHT,e,i.sys.isLittleEndian)},e.setVerticesCount=function(t){this._localBuffer.setFloat32(xd.OFFSET_OF_VERTICES_COUNT,t,i.sys.isLittleEndian)},e.commit=function(){this._remoteBuffer.update(this._localBuffer.buffer)},L(t,[{key:"buffer",get:function(){return this._remoteBuffer}}]),t}();function Net(t,e){var n,i,r,a;t.hasFeature(xr.TEXTURE_FLOAT)?(n=e,r=16,i=ng.PixelFormat.RGBA32F,a=Float32Array):(n=4*e,r=4,i=ng.PixelFormat.RGBA8888,a=Uint8Array);var o=function(t){t<5&&(t=5);var e=In(Dn(t)),n=e>>1;return{width:1<<(1&e?n+1:n),height:1<<n}}(n),s=o.width,c=o.height;return{width:s,height:c,create:function(){var e=new ArrayBuffer(s*c*r),n=new Float32Array(e),o=a===Float32Array?n:new a(e),l=new Dm({width:s,height:c,_data:o,_compressed:!1,format:i}),u=new ng;u.setFilters(ng.Filter.NEAREST,ng.Filter.NEAREST),u.setMipFilter(ng.Filter.NONE),u.setWrapMode(ng.WrapMode.CLAMP_TO_EDGE,ng.WrapMode.CLAMP_TO_EDGE,ng.WrapMode.CLAMP_TO_EDGE),u.image=l,u.getGFXTexture()||p("Unexpected: failed to create morph texture?");var h=t.getSampler(u.getSamplerInfo());return{get texture(){return u.getGFXTexture()},get sampler(){return h},get valueView(){return n},destroy:function(){u.destroy()},updatePixels:function(){u.uploadData(o)}}}}}function Let(t,e,n){t.renderingSubMeshes[e].enableVertexIdChannel(n)}function Bet(t){switch(t){case 1:return Uint8Array;case 2:return Uint16Array;case 4:return Uint32Array;default:return Uint8Array}}var Fet=new di,zet=new di,Uet=new Uint8Array,ket=nl("cc.Mesh")((wet=function(t){function e(){var e;return(e=t.call(this)||this).morphRendering=null,X(e,"_struct",Cet,V(e)),X(e,"_hash",bet,V(e)),e._data=Uet,e._initialized=!1,e._renderingSubMeshes=null,e._boneSpaceBounds=new Map,e._jointBufferIndices=null,e}F(e,t);var n=e.prototype;return n.onLoaded=function(){this.initialize()},n.initialize=function(){if(!this._initialized){this._initialized=!0;for(var t=this._data.buffer,e=i.director.root.device,n=this._createVertexBuffers(e,t),r=[],a=0;a<this._struct.primitives.length;a++){var o=this._struct.primitives[a];if(0!==o.vertexBundelIndices.length){var s=null,c=null;if(o.indexView){var l=o.indexView,u=l.stride,h=l.length;if(4===u&&!e.hasFeature(xr.ELEMENT_INDEX_UINT)){var f=this._struct.vertexBundles[o.vertexBundelIndices[0]].view.count;if(f>=65536){E(10001,f,65536);continue}u>>=1,h>>=1}s=e.createBuffer(new Ta(Er.INDEX,wr.DEVICE,h,u)),c=new(Bet(l.stride))(t,l.offset,l.count),l.stride!==u&&(c=Bet(u).from(c)),s.update(c)}var _=o.vertexBundelIndices.map((function(t){return n[t]})),p=[];if(o.vertexBundelIndices.length>0)for(var d=o.vertexBundelIndices[0],m=this._struct.vertexBundles[d].attributes,g=0;g<m.length;++g){var v=m[g];p[g]=new Ua(v.name,v.format,v.isNormalized,v.stream,v.isInstanced,v.location)}var y=new Vb(_,p,o.primitiveMode,s);y.mesh=this,y.subMeshIdx=a,r.push(y)}}this._renderingSubMeshes=r,this._struct.morph&&(this.morphRendering=function(t,e){return new Iet(t,e)}(this,e))}},n.destroy=function(){return this.destroyRenderingMesh(),t.prototype.destroy.call(this)},n.destroyRenderingMesh=function(){if(this._renderingSubMeshes){for(var t=0;t<this._renderingSubMeshes.length;t++)this._renderingSubMeshes[t].destroy();this._renderingSubMeshes=null,this._initialized=!1}},n.assign=function(t,e){this.reset({struct:t,data:e})},n.reset=function(t){this.destroyRenderingMesh(),this._struct=t.struct,this._data=t.data,this._hash=0},n.getBoneSpaceBounds=function(t){if(this._boneSpaceBounds.has(t.hash))return this._boneSpaceBounds.get(t.hash);var e=[];this._boneSpaceBounds.set(t.hash,e);for(var n=[],i=t.bindposes,r=0;r<i.length;r++)e.push(new Mc(1/0,1/0,1/0,-1/0,-1/0,-1/0)),n.push(!1);for(var a=this._struct.primitives,o=0;o<a.length;o++){var s=this.readAttribute(o,oa.ATTR_JOINTS),c=this.readAttribute(o,oa.ATTR_WEIGHTS),l=this.readAttribute(o,oa.ATTR_POSITION);if(s&&c&&l)for(var u=Math.min(s.length/4,c.length/4,l.length/3),h=0;h<u;h++){di.set(Fet,l[3*h+0],l[3*h+1],l[3*h+2]);for(var f=0;f<4;++f){var _=4*h+f,p=s[_];if(!(0===c[_]||p>=i.length)){di.transformMat4(zet,Fet,i[p]),n[p]=!0;var d=e[p];di.min(d.center,d.center,zet),di.max(d.halfExtents,d.halfExtents,zet)}}}}for(var m=0;m<i.length;m++){var g=e[m];n[m]?Mc.fromPoints(g,g.center,g.halfExtents):e[m]=null}return e},n.merge=function(t,e,n){if(n&&!this.validateMergingMesh(t))return!1;var i=new di,r=e&&new Ti,a=e&&new Mc;if(r&&e.getRotation(r),!this._initialized){var o=JSON.parse(JSON.stringify(t._struct)),s=t._data.slice();if(e){o.maxPosition&&o.minPosition&&(di.add(a.center,o.maxPosition,o.minPosition),di.multiplyScalar(a.center,a.center,.5),di.subtract(a.halfExtents,o.maxPosition,o.minPosition),di.multiplyScalar(a.halfExtents,a.halfExtents,.5),Mc.transform(a,a,e),di.add(o.maxPosition,a.center,a.halfExtents),di.subtract(o.minPosition,a.center,a.halfExtents));for(var c=0;c<o.vertexBundles.length;c++)for(var l=o.vertexBundles[c],u=0;u<l.attributes.length;u++)if(l.attributes[u].name===oa.ATTR_POSITION||l.attributes[u].name===oa.ATTR_NORMAL){var h=l.attributes[u].format,f=new DataView(s.buffer,l.view.offset+Get(l.attributes,u)),_=jet(f,h),p=Wet(f,h);if(!_||!p)continue;for(var d=l.view.count,m=l.view.stride,g=Vet(h),v=0;v<d;v++){var y=v*m,x=y+g,S=x+g;switch(i.set(_(y),_(x),_(S)),l.attributes[u].name){case oa.ATTR_POSITION:i.transformMat4(e);break;case oa.ATTR_NORMAL:di.transformQuat(i,i,r)}p(y,i.x),p(x,i.y),p(S,i.z)}}}return this.reset({struct:o,data:s}),this.initialize(),!0}for(var T,A,E,C,b,w=new Pet,P=0,I=0,R=0,D=0,O=0,M=0,N=0,L=0,B=!1,F=new Array(this._struct.vertexBundles.length),z=0;z<this._struct.vertexBundles.length;++z){var U=this._struct.vertexBundles[z],k=t._struct.vertexBundles[z];R=U.view.offset,D=k.view.offset,I=U.view.stride,P=U.view.count+k.view.count,T=new ArrayBuffer(P*I),A=new Uint8Array(T),R+=(E=this._data.subarray(R,R+U.view.length)).length,D+=(C=t._data.subarray(D,D+k.view.length)).length,A.set(E),O=0;for(var G,H=W(U.attributes);!(G=H()).done;){var V=G.value;N=0,B=!1;for(var j,X=W(k.attributes);!(j=X()).done;){var q=j.value;if(V.name===q.name&&V.format===q.format){B=!0;break}N+=lo[q.format].size}if(B){L=lo[V.format].size,M=U.view.length+O;for(var Y=0;Y<k.view.count;++Y){if(b=C.subarray(N,N+L),A.set(b,M),(V.name===oa.ATTR_POSITION||V.name===oa.ATTR_NORMAL)&&e){var K=new Float32Array(A.buffer,M,3);switch(i.set(K[0],K[1],K[2]),V.name){case oa.ATTR_POSITION:i.transformMat4(e);break;case oa.ATTR_NORMAL:di.transformQuat(i,i,r)}K[0]=i.x,K[1]=i.y,K[2]=i.z}M+=U.view.stride,N+=k.view.stride}}O+=lo[V.format].size}F[z]={attributes:U.attributes,view:{offset:w.getLength(),length:T.byteLength,count:P,stride:I}},w.addBuffer(T)}for(var Q,Z,J,$=0,tt=2,et=0,nt=new Array(this._struct.primitives.length),it=0;it<this._struct.primitives.length;++it){var rt=this._struct.primitives[it],at=t._struct.primitives[it];nt[it]={primitiveMode:rt.primitiveMode,vertexBundelIndices:rt.vertexBundelIndices};for(var ot,st=W(rt.vertexBundelIndices);!(ot=st()).done;){var ct=ot.value;et=Math.max(et,this._struct.vertexBundles[ct].view.count)}if(rt.indexView&&at.indexView){$=rt.indexView.count,$+=at.indexView.count,R=rt.indexView.offset,D=at.indexView.offset,tt=$<256?1:$<65536?2:4;var lt=new ArrayBuffer($*tt);if(Q=2===tt?new Uint16Array(lt):1===tt?new Uint8Array(lt):new Uint32Array(lt),Z=2===rt.indexView.stride?new Uint16Array(this._data.buffer,R,rt.indexView.count):1===rt.indexView.stride?new Uint8Array(this._data.buffer,R,rt.indexView.count):new Uint32Array(this._data.buffer,R,rt.indexView.count),tt===rt.indexView.stride)Q.set(Z);else for(var ut=0;ut<rt.indexView.count;++ut)Q[ut]=Z[ut];R+=rt.indexView.length,J=2===at.indexView.stride?new Uint16Array(t._data.buffer,D,at.indexView.count):1===at.indexView.stride?new Uint8Array(t._data.buffer,D,at.indexView.count):new Uint32Array(t._data.buffer,D,at.indexView.count);for(var ht=0;ht<at.indexView.count;++ht)Q[rt.indexView.count+ht]=et+J[ht];D+=at.indexView.length,nt[it].indexView={offset:w.getLength(),length:lt.byteLength,count:$,stride:tt},w.setNextAlignment(tt),w.addBuffer(lt)}}var ft={vertexBundles:F,primitives:nt,minPosition:this._struct.minPosition,maxPosition:this._struct.maxPosition};return ft.minPosition&&t._struct.minPosition&&ft.maxPosition&&t._struct.maxPosition&&(e?(di.add(a.center,t._struct.maxPosition,t._struct.minPosition),di.multiplyScalar(a.center,a.center,.5),di.subtract(a.halfExtents,t._struct.maxPosition,t._struct.minPosition),di.multiplyScalar(a.halfExtents,a.halfExtents,.5),Mc.transform(a,a,e),di.add(i,a.center,a.halfExtents),di.max(ft.maxPosition,ft.maxPosition,i),di.subtract(i,a.center,a.halfExtents),di.min(ft.minPosition,ft.minPosition,i)):(di.min(ft.minPosition,ft.minPosition,t._struct.minPosition),di.max(ft.maxPosition,ft.maxPosition,t._struct.maxPosition))),this.reset({struct:ft,data:new Uint8Array(w.getCombined())}),this.initialize(),!0},n.validateMergingMesh=function(t){if(this._struct.vertexBundles.length!==t._struct.vertexBundles.length)return!1;for(var e=0;e<this._struct.vertexBundles.length;++e){var n=this._struct.vertexBundles[e],i=t._struct.vertexBundles[e];if(n.attributes.length!==i.attributes.length)return!1;for(var r=0;r<n.attributes.length;++r)if(n.attributes[r].format!==i.attributes[r].format)return!1}if(this._struct.primitives.length!==t._struct.primitives.length)return!1;for(var a=0;a<this._struct.primitives.length;++a){var o=this._struct.primitives[a],s=t._struct.primitives[a];if(o.vertexBundelIndices.length!==s.vertexBundelIndices.length)return!1;for(var c=0;c<o.vertexBundelIndices.length;++c)if(o.vertexBundelIndices[c]!==s.vertexBundelIndices[c])return!1;if(o.primitiveMode!==s.primitiveMode)return!1;if(o.indexView){if(void 0===s.indexView)return!1}else if(s.indexView)return!1}return!0},n.readAttribute=function(t,e){var n=this,i=null;return this._accessAttribute(t,e,(function(t,e){var r=t.view.count,a=t.attributes[e].format,o=yo(lo[a]);if(0!==r){var s=new DataView(n._data.buffer,t.view.offset+Get(t.attributes,e)),c=lo[a],l=jet(s,a);if(o&&l){for(var u=c.count,h=new o(r*u),f=t.view.stride,_=0;_<r;++_)for(var p=0;p<u;++p)h[u*_+p]=l(f*_+h.BYTES_PER_ELEMENT*p);i=h}}})),i},n.copyAttribute=function(t,e,n,i,r){var a=this,o=!1;return this._accessAttribute(t,e,(function(t,e){var s=t.view.count;if(0!==s){var c=t.attributes[e].format,l=new DataView(a._data.buffer,t.view.offset+Get(t.attributes,e)),u=new DataView(n,r),h=lo[c],f=jet(l,c),_=Wet(u,c);if(f&&_){for(var p=h.count,d=t.view.stride,m=Vet(c),g=i,v=m,y=0;y<s;++y)for(var x=0;x<p;++x)_(g*y+v*x,f(d*y+m*x));o=!0}}else o=!0})),o},n.readIndices=function(t){if(t>=this._struct.primitives.length)return null;var e=this._struct.primitives[t];if(!e.indexView)return null;var n=e.indexView.stride;return new(1===n?Uint8Array:2===n?Uint16Array:Uint32Array)(this._data.buffer,e.indexView.offset,e.indexView.count)},n.copyIndices=function(t,e){if(t>=this._struct.primitives.length)return!1;var n=this._struct.primitives[t];if(!n.indexView)return!1;for(var i=n.indexView.count,r=1===n.indexView.stride?Sr.R8UI:2===n.indexView.stride?Sr.R16UI:Sr.R32UI,a=jet(new DataView(this._data.buffer),r),o=0;o<i;++o)e[o]=a(n.indexView.offset+lo[r].size*o);return!0},n._accessAttribute=function(t,e,n){if(!(t>=this._struct.primitives.length))for(var i,r=W(this._struct.primitives[t].vertexBundelIndices);!(i=r()).done;){var a=i.value,o=this._struct.vertexBundles[a],s=o.attributes.findIndex((function(t){return t.name===e}));if(!(s<0)){n(o,s);break}}},n._createVertexBuffers=function(t,e){return this._struct.vertexBundles.map((function(n){var i=t.createBuffer(new Ta(Er.VERTEX,wr.DEVICE,n.view.length,n.view.stride)),r=new Uint8Array(e,n.view.offset,n.view.length);return i.update(r),i}))},n.initDefault=function(e){t.prototype.initDefault.call(this,e),this.reset({struct:{vertexBundles:[],primitives:[]},data:Uet})},L(e,[{key:"_nativeAsset",get:function(){return this._data.buffer},set:function(t){this._data=new Uint8Array(t)}},{key:"subMeshCount",get:function(){var t=this.renderingSubMeshes;return t?t.length:0}},{key:"minPosition",get:function(){return this.struct.minPosition}},{key:"maxPosition",get:function(){return this.struct.maxPosition}},{key:"struct",get:function(){return this._struct}},{key:"data",get:function(){return this._data}},{key:"hash",get:function(){return this._hash||(this._hash=Po(this._data,666)),this._hash}},{key:"jointBufferIndices",get:function(){return this._jointBufferIndices?this._jointBufferIndices:this._jointBufferIndices=this._struct.primitives.map((function(t){return t.jointMapIndex||0}))}},{key:"renderingSubMeshes",get:function(){return this.initialize(),this._renderingSubMeshes}}]),e}(Ou),Cet=q((Eet=wet).prototype,"_struct",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{vertexBundles:[],primitives:[]}}}),bet=q(Eet.prototype,"_hash",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Aet=Eet))||Aet;function Get(t,e){for(var n=0,i=0;i<e;++i){var r=t[i];n+=lo[r.format].size}return n}i.Mesh=ket;var Het=lh.isLittleEndian;function Vet(t){var e=lo[t];return e.size/e.count}function jet(t,e){var n=lo[e],i=n.size/n.count;switch(n.type){case Tr.UNORM:switch(i){case 1:return function(e){return t.getUint8(e)};case 2:return function(e){return t.getUint16(e,Het)};case 4:return function(e){return t.getUint32(e,Het)}}break;case Tr.SNORM:case Tr.INT:switch(i){case 1:return function(e){return t.getInt8(e)};case 2:return function(e){return t.getInt16(e,Het)};case 4:return function(e){return t.getInt32(e,Het)}}break;case Tr.UINT:switch(i){case 1:return function(e){return t.getUint8(e)};case 2:return function(e){return t.getUint16(e,Het)};case 4:return function(e){return t.getUint32(e,Het)}}break;case Tr.FLOAT:return function(e){return t.getFloat32(e,Het)}}return null}function Wet(t,e){var n=lo[e],i=n.size/n.count;switch(n.type){case Tr.UNORM:switch(i){case 1:return function(e,n){return t.setUint8(e,n)};case 2:return function(e,n){return t.setUint16(e,n,Het)};case 4:return function(e,n){return t.setUint32(e,n,Het)}}break;case Tr.SNORM:case Tr.INT:switch(i){case 1:return function(e,n){return t.setInt8(e,n)};case 2:return function(e,n){return t.setInt16(e,n,Het)};case 4:return function(e,n){return t.setInt32(e,n,Het)}}break;case Tr.UINT:switch(i){case 1:return function(e,n){return t.setUint8(e,n)};case 2:return function(e,n){return t.setUint16(e,n,Het)};case 4:return function(e,n){return t.setUint32(e,n,Het)}}break;case Tr.FLOAT:return function(e,n){return t.setFloat32(e,n,Het)}}return null}var Xet,qet,Yet,Ket,Qet,Zet,Jet,$et,tnt,ent,nnt,int,rnt,ant,ont,snt,cnt,lnt,unt,hnt,fnt,_nt,pnt,dnt,mnt,gnt,vnt,ynt,xnt,Snt,Tnt,Ant,Ent=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._morphRenderingInstance=null,e._usedMaterials=new Set,e}F(e,t);var n=e.prototype;return n.getMacroPatches=function(e){return this._morphRenderingInstance?this._morphRenderingInstance.requiredPatches(e):t.prototype.getMacroPatches.call(this,e)},n.initSubModel=function(e,n,i){return t.prototype.initSubModel.call(this,e,n,this._launderMaterial(i))},n.destroy=function(){t.prototype.destroy.call(this),this._morphRenderingInstance=null},n.setSubModelMaterial=function(e,n){return t.prototype.setSubModelMaterial.call(this,e,this._launderMaterial(n))},n._updateLocalDescriptors=function(e,n){t.prototype._updateLocalDescriptors.call(this,e,n),this._morphRenderingInstance&&this._morphRenderingInstance.adaptPipelineState(e,n)},n._launderMaterial=function(t){return t},n.setMorphRendering=function(t){this._morphRenderingInstance=t},e}(Jg),Cnt=Yt({OFF:0,ON:1}),bnt=Yt({OFF:0,ON:1}),wnt=(Xet=nl("cc.ModelLightmapSettings"),qet=ll("_recieveShadow"),Xet((nnt=function(){function t(){X(this,"texture",Qet,this),X(this,"uvParam",Zet,this),X(this,"_bakeable",Jet,this),X(this,"_castShadow",$et,this),X(this,"_receiveShadow",tnt,this),X(this,"_lightmapSize",ent,this)}return L(t,[{key:"bakeable",get:function(){return this._bakeable},set:function(t){this._bakeable=t}},{key:"castShadow",get:function(){return this._castShadow},set:function(t){this._castShadow=t}},{key:"receiveShadow",get:function(){return this._receiveShadow},set:function(t){this._receiveShadow=t}},{key:"lightmapSize",get:function(){return this._lightmapSize},set:function(t){this._lightmapSize=t}}]),t}(),Qet=q((Ket=nnt).prototype,"texture",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Zet=q(Ket.prototype,"uvParam",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new zi}}),Jet=q(Ket.prototype,"_bakeable",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),$et=q(Ket.prototype,"_castShadow",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),tnt=q(Ket.prototype,"_receiveShadow",[qet],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ent=q(Ket.prototype,"_lightmapSize",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 64}}),q(Ket.prototype,"bakeable",[yl],Object.getOwnPropertyDescriptor(Ket.prototype,"bakeable"),Ket.prototype),q(Ket.prototype,"castShadow",[yl],Object.getOwnPropertyDescriptor(Ket.prototype,"castShadow"),Ket.prototype),q(Ket.prototype,"receiveShadow",[yl],Object.getOwnPropertyDescriptor(Ket.prototype,"receiveShadow"),Ket.prototype),q(Ket.prototype,"lightmapSize",[yl],Object.getOwnPropertyDescriptor(Ket.prototype,"lightmapSize"),Ket.prototype),Yet=Ket))||Yet),Pnt=(int=nl("cc.MeshRenderer"),rnt=vl(),ant=rl(100),ont=pl(),snt=Bl(Cnt),cnt=Al(),lnt=Bl(bnt),unt=Al(),hnt=Bl(ket),fnt=Al(),_nt=xl(),int(pnt=rnt(pnt=ant(pnt=ont(pnt=_l((Tnt=Snt=function(t){function e(){var e;return X(e=t.call(this)||this,"lightmapSettings",mnt,V(e)),X(e,"_mesh",gnt,V(e)),X(e,"_shadowCastingMode",vnt,V(e)),X(e,"_shadowReceivingMode",ynt,V(e)),e._subMeshShapesWeights=[],e._modelType=void 0,e._model=null,e._morphInstance=null,X(e,"_enableMorph",xnt,V(e)),e._modelType=Jg,e}F(e,t);var n=e.prototype;return n.onLoad=function(){this._mesh&&this._mesh.initialize(),this._validateShapeWeights()||this._initSubMeshShapesWeights(),this._watchMorphInMesh(),this._updateModels(),this._updateCastShadow(),this._updateReceiveShadow()},n.onRestore=function(){this._updateModels(),this._updateCastShadow(),this._updateReceiveShadow()},n.onEnable=function(){this._model||this._updateModels(),this._updateCastShadow(),this._updateReceiveShadow(),this._attachToScene()},n.onDisable=function(){this._model&&this._detachFromScene()},n.onDestroy=function(){this._model&&(i.director.root.destroyModel(this._model),this._model=null,this._models.length=0),this._morphInstance&&this._morphInstance.destroy()},n.getWeight=function(t,e){this._subMeshShapesWeights.length;var n=this._subMeshShapesWeights[t];return n.length,n[e]},n.setWeights=function(t,e){var n=this._subMeshShapesWeights;e>=n.length||n[e].length===t.length&&(n[e]=t.slice(0),this._uploadSubMeshShapesWeights(e))},n.setWeight=function(t,e,n){var i=this._subMeshShapesWeights;if(!(e>=i.length)){var r=i[e];n>=r.length||(r[n]=t,this._uploadSubMeshShapesWeights(e))}},n.setInstancedAttribute=function(t,e){if(this.model)for(var n=this.model.instancedAttributes,i=n.attributes,r=n.views,a=0;a<i.length;a++)if(i[a].name===t){r[a].set(e);break}},n._updateLightmap=function(t,e,n,i,r){this.lightmapSettings.texture=t,this.lightmapSettings.uvParam.x=e,this.lightmapSettings.uvParam.y=n,this.lightmapSettings.uvParam.z=i,this.lightmapSettings.uvParam.w=r,this._onUpdateLightingmap()},n._updateModels=function(){if(this.enabledInHierarchy&&this._mesh){var t=this._model;t?(t.destroy(),t.initialize(),t.node=t.transform=this.node):this._createModel(),this._model&&(this._model.createBoundingShape(this._mesh.struct.minPosition,this._mesh.struct.maxPosition),this._updateModelParams(),this._onUpdateLightingmap())}},n._createModel=function(){var t=this._morphInstance&&this._modelType===Jg?Ent:this._modelType,e=this._model=i.director.root.createModel(t);e.visFlags=this.visibility,e.node=e.transform=this.node,this._models.length=0,this._models.push(this._model),this._morphInstance&&e instanceof Ent&&e.setMorphRendering(this._morphInstance)},n._attachToScene=function(){if(this.node.scene&&this._model){var t=this._getRenderScene();null!==this._model.scene&&this._detachFromScene(),t.addModel(this._model)}},n._detachFromScene=function(){this._model&&this._model.scene&&this._model.scene.removeModel(this._model)},n._updateModelParams=function(){if(this._mesh&&this._model){this.node.hasChangedFlags|=Kg.POSITION,this._model.transform.hasChangedFlags|=Kg.POSITION,this._model.isDynamicBatching=this._isBatchingEnabled();var t=this._mesh?this._mesh.renderingSubMeshes.length:0,e=this._mesh.renderingSubMeshes;if(e)for(var n=0;n<t;++n){var i=this.getRenderMaterial(n);i&&!i.isValid&&(i=null);var r=e[n];r&&this._model.initSubModel(n,r,i||this._getBuiltinMaterial())}this._model.enabled=!0}},n._onUpdateLightingmap=function(){null!==this.model&&this.model.updateLightingmap(this.lightmapSettings.texture,this.lightmapSettings.uvParam),this.setInstancedAttribute("a_lightingMapUVParam",[this.lightmapSettings.uvParam.x,this.lightmapSettings.uvParam.y,this.lightmapSettings.uvParam.z,this.lightmapSettings.uvParam.w])},n._onMaterialModified=function(t,e){this._model&&this._model.inited&&this._onRebuildPSO(t,e||this._getBuiltinMaterial())},n._onRebuildPSO=function(t,e){this._model&&this._model.inited&&(this._model.isDynamicBatching=this._isBatchingEnabled(),this._model.setSubModelMaterial(t,e),this._onUpdateLightingmap())},n._onMeshChanged=function(){},n._clearMaterials=function(){if(this._model)for(var t=this._model.subModels,e=0;e<t.length;++e)this._onMaterialModified(e,null)},n._getBuiltinMaterial=function(){return Lg.get("missing-material")},n._onVisibilityChange=function(t){this._model&&(this._model.visFlags=t)},n._updateCastShadow=function(){this._model&&(this._shadowCastingMode===Cnt.OFF?this._model.castShadow=!1:(this._shadowCastingMode,Cnt.ON,this._shadowCastingMode,this._model.castShadow=!0))},n._updateReceiveShadow=function(){this._model&&(this._shadowReceivingMode===bnt.OFF?this._model.receiveShadow=!1:this._model.receiveShadow=!0)},n._isBatchingEnabled=function(){for(var t=0;t<this._materials.length;++t){var e=this._materials[t];if(e)for(var n=0;n<e.passes.length;++n)if(e.passes[n].batchingScheme)return!0}return!1},n._watchMorphInMesh=function(){if(this._morphInstance&&(this._morphInstance.destroy(),this._morphInstance=null),this._enableMorph&&this._mesh&&this._mesh.struct.morph&&this._mesh.morphRendering){this._morphInstance=this._mesh.morphRendering.createInstance();for(var t=this._mesh.struct.primitives.length,e=0;e<t;++e)this._uploadSubMeshShapesWeights(e);this._model&&this._model instanceof Ent&&this._model.setMorphRendering(this._morphInstance)}},n._initSubMeshShapesWeights=function(){var t=this._mesh;if(this._subMeshShapesWeights.length=0,t){var e=t.struct.morph;if(e){var n=e.weights;this._subMeshShapesWeights=e.subMeshMorphs.map((function(t){return t?t.weights?t.weights.slice(0):n?(n.length,t.targets.length,n.slice(0)):new Array(t.targets.length).fill(0):[]}))}}},n._validateShapeWeights=function(){var t=this._mesh,e=this._subMeshShapesWeights;if(!t||!t.struct.morph)return 0===e.length;var n=t.struct.morph;return n.subMeshMorphs.length===e.length&&e.every((function(t,e){var i,r,a=t.length;return(null!==(i=null===(r=n.subMeshMorphs[e])||void 0===r?void 0:r.targets.length)&&void 0!==i?i:0)===a}))},n._uploadSubMeshShapesWeights=function(t){var e;null===(e=this._morphInstance)||void 0===e||e.setWeights(t,this._subMeshShapesWeights[t])},L(e,[{key:"shadowCastingMode",get:function(){return this._shadowCastingMode},set:function(t){this._shadowCastingMode=t,this._updateCastShadow()}},{key:"receiveShadow",get:function(){return this._shadowReceivingMode},set:function(t){this._shadowReceivingMode=t,this._updateReceiveShadow()}},{key:"mesh",get:function(){return this._mesh},set:function(t){var e=this._mesh,n=this._mesh=t;null==n||n.initialize(),this._initSubMeshShapesWeights(),this._watchMorphInMesh(),this._onMeshChanged(e),this._updateModels(),this.enabledInHierarchy&&this._attachToScene(),this._updateCastShadow(),this._updateReceiveShadow()}},{key:"model",get:function(){return this._model}},{key:"enableMorph",get:function(){return this._enableMorph},set:function(t){this._enableMorph=t}}]),e}(mF),Snt.ShadowCastingMode=Cnt,Snt.ShadowReceivingMode=bnt,mnt=q((dnt=Tnt).prototype,"lightmapSettings",[cl,yl,Dl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new wnt}}),gnt=q(dnt.prototype,"_mesh",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),vnt=q(dnt.prototype,"_shadowCastingMode",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Cnt.OFF}}),ynt=q(dnt.prototype,"_shadowReceivingMode",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return bnt.ON}}),q(dnt.prototype,"shadowCastingMode",[snt,cnt,Dl],Object.getOwnPropertyDescriptor(dnt.prototype,"shadowCastingMode"),dnt.prototype),q(dnt.prototype,"receiveShadow",[lnt,unt,Dl],Object.getOwnPropertyDescriptor(dnt.prototype,"receiveShadow"),dnt.prototype),q(dnt.prototype,"mesh",[hnt,fnt],Object.getOwnPropertyDescriptor(dnt.prototype,"mesh"),dnt.prototype),q(dnt.prototype,"enableMorph",[_nt,Dl],Object.getOwnPropertyDescriptor(dnt.prototype,"enableMorph"),dnt.prototype),xnt=q(dnt.prototype,"_enableMorph",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),pnt=dnt))||pnt)||pnt)||pnt)||pnt)||pnt);!function(t){t[t.positions=oa.ATTR_POSITION]="positions",t[t.normals=oa.ATTR_NORMAL]="normals",t[t.uvs=oa.ATTR_TEX_COORD]="uvs",t[t.colors=oa.ATTR_COLOR]="colors"}(Ant||(Ant={}));var Int,Rnt=[new Ua(oa.ATTR_POSITION,Sr.RGB32F),new Ua(oa.ATTR_NORMAL,Sr.RGB32F),new Ua(oa.ATTR_TEX_COORD,Sr.RG32F),new Ua(oa.ATTR_TANGENT,Sr.RGBA32F),new Ua(oa.ATTR_COLOR,Sr.RGBA32F)],Dnt=new di,Ont=function(){function t(t,e,n){this._id=void 0,this._opts=void 0,this._accumStart=void 0,this._total=0,this._value=0,this._averageValue=0,this._accumValue=0,this._accumSamples=0,this._id=t,this._opts=e,this._accumStart=n}var e=t.prototype;return e.sample=function(t){this._average(this._value,t)},e.human=function(){var t=this._opts,e=t.average,n=t.isInteger,i=e?this._averageValue:this._value;return n?Math.round(i):Math.round(100*i)/100},e.alarm=function(){return this._opts.below&&this._value<this._opts.below||this._opts.over&&this._value>this._opts.over},e._average=function(t,e){if(void 0===e&&(e=0),this._opts.average){this._accumValue+=t,++this._accumSamples;var n=e;n-this._accumStart>=this._opts.average&&(this._averageValue=this._accumValue/this._accumSamples,this._accumValue=0,this._accumStart=n,this._accumSamples=0)}},L(t,[{key:"value",get:function(){return this._value},set:function(t){this._value=t}}]),t}(),Mnt=nl("cc.PerfCounter")(Int=function(t){function e(e,n,i){var r;return(r=t.call(this,e,n,i)||this)._time=void 0,r._time=i,r}F(e,t);var n=e.prototype;return n.start=function(t){void 0===t&&(t=0),this._time=t},n.end=function(t){void 0===t&&(t=0),this._value=t-this._time,this._average(this._value)},n.tick=function(){this.end(),this.start()},n.frame=function(t){var e=t,n=e-this._time;this._total++,n>(this._opts.average||1e3)&&(this._value=1e3*this._total/n,this._total=0,this._time=e,this._average(this._value))},e}(Ont))||Int,Nnt="0123456789. ",Lnt=500,Bnt={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,".":10},Fnt={fps:{desc:"Framerate (FPS)",below:30,average:Lnt,isInteger:!0},draws:{desc:"Draw call",isInteger:!0},frame:{desc:"Frame time (ms)",min:0,max:50,average:Lnt},instances:{desc:"Instance Count",isInteger:!0},tricount:{desc:"Triangle",isInteger:!0},logic:{desc:"Game Logic (ms)",min:0,max:50,average:Lnt,color:"#080"},physics:{desc:"Physics (ms)",min:0,max:50,average:Lnt},render:{desc:"Renderer (ms)",min:0,max:50,average:Lnt,color:"#f90"},textureMemory:{desc:"GFX Texture Mem(M)"},bufferMemory:{desc:"GFX Buffer Mem(M)"}},znt=t("Profiler",function(){function t(){this._stats=null,this.id="__Profiler__",this._showFPS=!1,this._rootNode=null,this._device=null,this._swapchain=null,this._pipeline=null,this._meshRenderer=null,this._canvas=null,this._ctx=null,this._texture=null,this._region=new ma,this._canvasArr=[],this._regionArr=[this._region],this.digitsData=null,this.offsetData=null,this.pass=null,this._canvasDone=!1,this._statsDone=!1,this._inited=!1,this._lineHeight=256/(Object.keys(Fnt).length+1),this._wordHeight=0,this._eachNumWidth=0,this._totalLines=0,this.lastTime=0,this._canvas=document.createElement("canvas"),this._ctx=this._canvas.getContext("2d"),this._canvasArr.push(this._canvas)}var e=t.prototype;return e.reset=function(){this._stats=null,this._showFPS=!1,this._rootNode=null,this._device=null,this._swapchain=null,this._pipeline=null,this._meshRenderer&&this._meshRenderer.destroy(),this._meshRenderer=null,this.digitsData=null,this.offsetData=null,this.pass=null,this._canvasDone=!1,this._statsDone=!1,this._inited=!1,this._lineHeight=256/(Object.keys(Fnt).length+1),this._wordHeight=0,this._eachNumWidth=0,this._totalLines=0,this.lastTime=0},e.isShowingStats=function(){return this._showFPS},e.hideStats=function(){this._showFPS&&(this._rootNode&&(this._rootNode.active=!1),i.director.off(i.Director.EVENT_BEFORE_UPDATE,this.beforeUpdate,this),i.director.off(i.Director.EVENT_AFTER_UPDATE,this.afterUpdate,this),i.director.off(i.Director.EVENT_BEFORE_PHYSICS,this.beforePhysics,this),i.director.off(i.Director.EVENT_AFTER_PHYSICS,this.afterPhysics,this),i.director.off(i.Director.EVENT_BEFORE_DRAW,this.beforeDraw,this),i.director.off(i.Director.EVENT_AFTER_DRAW,this.afterDraw,this),this._showFPS=!1,this._pipeline.profiler=null,i.game.config.showFPS=!1)},e.showStats=function(){if(!this._showFPS){if(!this._device){var t=i.director.root;this._device=t.device,this._swapchain=t.mainWindow.swapchain,this._pipeline=t.pipeline}this.generateCanvas(),this.generateStats(),i.game.once(i.Game.EVENT_ENGINE_INITED,this.generateNode,this),this._rootNode&&(this._rootNode.active=!0),i.director.on(i.Director.EVENT_BEFORE_UPDATE,this.beforeUpdate,this),i.director.on(i.Director.EVENT_AFTER_UPDATE,this.afterUpdate,this),i.director.on(i.Director.EVENT_BEFORE_PHYSICS,this.beforePhysics,this),i.director.on(i.Director.EVENT_AFTER_PHYSICS,this.afterPhysics,this),i.director.on(i.Director.EVENT_BEFORE_DRAW,this.beforeDraw,this),i.director.on(i.Director.EVENT_AFTER_DRAW,this.afterDraw,this),this._showFPS=!0,this._canvasDone=!0,this._statsDone=!0,i.game.config.showFPS=!0}},e.generateCanvas=function(){if(!this._canvasDone){this._ctx&&this._canvas&&(this._canvas.width=256,this._canvas.height=256,this._canvas.style.width=""+this._canvas.width,this._canvas.style.height=""+this._canvas.height,this._ctx.font="23px Arial",this._ctx.textBaseline="top",this._ctx.fillStyle="#fff",this._texture=this._device.createTexture(new wa(Pr.TEX2D,Ir.SAMPLED|Ir.TRANSFER_DST,Sr.RGBA8,256,256)),this._region.texExtent.width=256,this._region.texExtent.height=256)}},e.generateStats=function(){if(!this._statsDone&&this._ctx&&this._canvas){this._stats=null;var t=performance.now();this._ctx.textAlign="left";var e=0;for(var n in Fnt){var i=Fnt[n];this._ctx.fillText(i.desc,0,e*this._lineHeight),i.counter=new Mnt(n,i,t),e++}this._totalLines=e,this._wordHeight=this._totalLines*this._lineHeight/this._canvas.height;for(var r=0;r<Nnt.length;++r){var a=this._ctx.measureText(Nnt[r]).width;this._eachNumWidth=Math.max(this._eachNumWidth,a)}for(var o=0;o<Nnt.length;++o)this._ctx.fillText(Nnt[o],o*this._eachNumWidth,this._totalLines*this._lineHeight);this._eachNumWidth/=this._canvas.width,this._stats=Fnt,this._canvasArr[0]=this._canvas,this._device.copyTexImagesToTexture(this._canvasArr,this._texture,this._regionArr)}},e.generateNode=function(){if(!this._rootNode||!this._rootNode.isValid){this._rootNode=new qC("PROFILER_NODE"),i.game.addPersistRootNode(this._rootNode);var t=new qC("Profiler_Root");t.parent=this._rootNode;for(var e=.4,n=e/this._totalLines,r=e/this._wordHeight,a=n/23,o=this._eachNumWidth*this._canvas.width*a,s=[0,e,0,r,e,0,r,0,0,0,0,0],c=[0,2,1,0,3,2],l=[0,0,-1,0,1,0,-1,0,1,this._wordHeight,-1,0,0,this._wordHeight,-1,0],u=0,h=0;h<this._totalLines;h++)for(var f=0;f<8;f++){s.push(r+f*o,e-h*n,0),s.push(r+(f+1)*o,e-h*n,0),s.push(r+(f+1)*o,e-(h+1)*n,0),s.push(r+f*o,e-(h+1)*n,0),u=4*(8*h+f+1),c.push(0+u,2+u,1+u,0+u,3+u,2+u);var _=8*h+f,p=Math.floor(_/4),d=_-4*p;l.push(0,this._wordHeight,p,d),l.push(this._eachNumWidth,this._wordHeight,p,d),l.push(this._eachNumWidth,1,p,d),l.push(0,1,p,d)}this._meshRenderer=t.addComponent(Pnt),this._meshRenderer.mesh=function(t,e,n){n=n||{};var i,r=[],a=0,o=[],s=0,c=t.positions.slice();if(c.length>0){if(i=null,t.attributes)for(var l,u=W(t.attributes);!(l=u()).done;){var h=l.value;if(h.name===oa.ATTR_POSITION){i=h;break}}i||(i=Rnt[0]),r.push(i);var f=lo[i.format];s=Math.max(s,Math.floor(c.length/f.count)),o.push({offset:a,data:c,attribute:i}),a+=f.size}if(t.normals&&t.normals.length>0){if(i=null,t.attributes)for(var _,p=W(t.attributes);!(_=p()).done;){var d=_.value;if(d.name===oa.ATTR_NORMAL){i=d;break}}i||(i=Rnt[1]);var m=lo[i.format];r.push(i),s=Math.max(s,Math.floor(t.normals.length/m.count)),o.push({offset:a,data:t.normals,attribute:i}),a+=m.size}if(t.uvs&&t.uvs.length>0){if(i=null,t.attributes)for(var g,v=W(t.attributes);!(g=v()).done;){var y=g.value;if(y.name===oa.ATTR_TEX_COORD){i=y;break}}i||(i=Rnt[2]);var x=lo[i.format];r.push(i),s=Math.max(s,Math.floor(t.uvs.length/x.count)),o.push({offset:a,data:t.uvs,attribute:i}),a+=x.size}if(t.tangents&&t.tangents.length>0){if(i=null,t.attributes)for(var S,T=W(t.attributes);!(S=T()).done;){var A=S.value;if(A.name===oa.ATTR_TANGENT){i=A;break}}i||(i=Rnt[3]);var E=lo[i.format];r.push(i),s=Math.max(s,Math.floor(t.tangents.length/E.count)),o.push({offset:a,data:t.tangents,attribute:i}),a+=E.size}if(t.colors&&t.colors.length>0){if(i=null,t.attributes)for(var C,b=W(t.attributes);!(C=b()).done;){var w=C.value;if(w.name===oa.ATTR_COLOR){i=w;break}}i||(i=Rnt[4]);var P=lo[i.format];r.push(i),s=Math.max(s,Math.floor(t.colors.length/P.count)),o.push({offset:a,data:t.colors,attribute:i}),a+=P.size}if(t.customAttributes)for(var I,R=W(t.customAttributes);!(I=R()).done;){var D=I.value,O=lo[D.attr.format];r.push(D.attr),s=Math.max(s,Math.floor(D.values.length/O.count)),o.push({offset:a,data:D.values,attribute:D.attr}),a+=O.size}for(var M=new Pet,N=new ArrayBuffer(s*a),L=new DataView(N),B=0,F=o;B<F.length;B++){var z=F[B];Ub(L,z.data,z.attribute.format,z.offset,a)}M.setNextAlignment(0);var U={attributes:r,view:{offset:M.getLength(),length:N.byteLength,count:s,stride:a}};M.addBuffer(N);var k=null,G=0;if(t.indices){var H=t.indices;G=H.length,k=new ArrayBuffer(2*G),Ub(new DataView(k),H,Sr.R16UI)}var V={primitiveMode:t.primitiveMode||Xr.TRIANGLE_LIST,vertexBundelIndices:[0]};k&&(M.setNextAlignment(2),V.indexView={offset:M.getLength(),length:k.byteLength,count:G,stride:2},M.addBuffer(k));var j=t.minPos;if(!j&&n.calculateBounds){j=di.set(new di,1/0,1/0,1/0);for(var X=0;X<s;++X)di.set(Dnt,c[3*X+0],c[3*X+1],c[3*X+2]),di.min(j,j,Dnt)}var q=t.maxPos;if(!q&&n.calculateBounds){q=di.set(new di,-1/0,-1/0,-1/0);for(var Y=0;Y<s;++Y)di.set(Dnt,c[3*Y+0],c[3*Y+1],c[3*Y+2]),di.max(q,q,Dnt)}var K={vertexBundles:[U],primitives:[V]};return j&&(K.minPosition=new di(j.x,j.y,j.z)),q&&(K.maxPosition=new di(q.x,q.y,q.z)),e||(e=new ket),e.reset({struct:K,data:new Uint8Array(M.getCombined())}),e}({positions:s,indices:c,colors:l});var m=new bv;m.initialize({effectName:"profiler"});var g=this.pass=m.passes[0],v=g.getBinding("mainTexture"),y=g.getBinding("digits"),x=g.getBinding("offset");g.bindTexture(v,this._texture),this.digitsData=g.blocks[y],this.offsetData=g.blocks[x],this.offsetData[3]=-1,this._meshRenderer.material=m,this._meshRenderer.node.layer=Np.Enum.PROFILER,this._inited=!0}},e.beforeUpdate=function(){if(this._stats){var t=performance.now();this._stats.frame.counter.start(t),this._stats.logic.counter.start(t)}},e.afterUpdate=function(){if(this._stats){var t=performance.now();i.director.isPaused()?this._stats.frame.counter.start(t):this._stats.logic.counter.end(t)}},e.beforePhysics=function(){if(this._stats){var t=performance.now();this._stats.physics.counter.start(t)}},e.afterPhysics=function(){if(this._stats){var t=performance.now();this._stats.physics.counter.end(t)}},e.beforeDraw=function(){if(this._stats&&this._inited){var t=this._swapchain.surfaceTransform,e=this._device.capabilities.clipSpaceSignY;if(t!==this.offsetData[3]){var n=Ii[t],i=-.9*e;this.offsetData[0]=-.9*n[0]+i*n[2],this.offsetData[1]=-.9*n[1]+i*n[3],this.offsetData[2]=this._eachNumWidth,this.offsetData[3]=t}this.pass._setRootBufferDirty(!0),this._meshRenderer.model&&(this._pipeline.profiler=this._meshRenderer.model);var r=performance.now();this._stats.render.counter.start(r)}},e.afterDraw=function(){if(this._stats&&this._inited){var t=performance.now();if(this._stats.frame.counter.end(t),this._stats.fps.counter.frame(t),this._stats.render.counter.end(t),!(t-this.lastTime<Lnt)){this.lastTime=t;var e=this._device;this._stats.draws.counter.value=e.numDrawCalls,this._stats.instances.counter.value=e.numInstances,this._stats.bufferMemory.counter.value=e.memoryStatus.bufferSize/1048576,this._stats.textureMemory.counter.value=e.memoryStatus.textureSize/1048576,this._stats.tricount.counter.value=e.numTris;var n=0,i=this.digitsData;for(var r in this._stats){var a=this._stats[r];a.counter.sample(t);for(var o=a.counter.human().toString(),s=7;s>=0;s--){var c=8*n+s,l=o[o.length-(8-s)],u=Bnt[l];void 0===u&&(u=11),i[c]=u}n++}}}},t}()),Unt=t("profiler",new znt);i.profiler=Unt;var knt,Gnt,Hnt,Vnt,jnt=Yt({GRAVITY:0,RADIUS:1}),Wnt=Yt({FREE:0,RELATIVE:1,GROUPED:2}),Xnt=new Ni(0,0),qnt=new Ni,Ynt=new Ni,Knt=new Ni,Qnt=new Ni,Znt=oW(rW),Jnt=function(){this.pos=new Ni(0,0),this.startPos=new Ni(0,0),this.color=new _i(0,0,0,255),this.deltaColor={r:0,g:0,b:0,a:255},this.size=0,this.deltaSize=0,this.rotation=0,this.deltaRotation=0,this.timeToLive=0,this.drawPos=new Ni(0,0),this.aspectRatio=1,this.dir=new Ni(0,0),this.radialAccel=0,this.tangentialAccel=0,this.angle=0,this.degreesPerSecond=0,this.radius=0,this.deltaRadius=0},$nt=new(function(t){function e(){return t.apply(this,arguments)||this}return F(e,t),e.prototype.get=function(){return this._get()||new Jnt},e}(Ut))((function(t){t.pos.set(Xnt),t.startPos.set(Xnt),t.color._val=4278190080,t.deltaColor.r=t.deltaColor.g=t.deltaColor.b=0,t.deltaColor.a=255,t.size=0,t.deltaSize=0,t.rotation=0,t.deltaRotation=0,t.timeToLive=0,t.drawPos.set(Xnt),t.aspectRatio=1,t.dir.set(Xnt),t.radialAccel=0,t.tangentialAccel=0,t.angle=0,t.degreesPerSecond=0,t.radius=0,t.deltaRadius=0}),1024),tit=function(){function t(t){this.particles=[],this.active=!1,this.uvFilled=0,this.finished=!1,this.readyToPlay=!0,this.elapsed=0,this.emitCounter=0,this._worldRotation=0,this.sys=t,this.particles=[],this.active=!1,this.readyToPlay=!0,this.finished=!1,this.elapsed=0,this.emitCounter=0,this.uvFilled=0,this._worldRotation=0}var e=t.prototype;return e.stop=function(){this.active=!1,this.readyToPlay=!1,this.elapsed=this.sys.duration,this.emitCounter=0},e.reset=function(){this.active=!0,this.readyToPlay=!0,this.elapsed=0,this.emitCounter=0,this.finished=!1;for(var t=this.particles,e=0;e<t.length;++e)$nt.put(t[e]);t.length=0},e.emitParticle=function(t){var e=this.sys,n=$nt.get();this.particles.push(n),n.timeToLive=e.life+e.lifeVar*(Math.random()-.5)*2;var i=n.timeToLive=Math.max(0,n.timeToLive);n.pos.x=e.sourcePos.x+e.posVar.x*(Math.random()-.5)*2,n.pos.y=e.sourcePos.y+e.posVar.y*(Math.random()-.5)*2;var r,a,o,s,c=e.startColor,l=e.startColorVar,u=e.endColor,h=e.endColorVar;n.color.r=r=he(c.r+l.r*(Math.random()-.5)*2,0,255),n.color.g=a=he(c.g+l.g*(Math.random()-.5)*2,0,255),n.color.b=o=he(c.b+l.b*(Math.random()-.5)*2,0,255),n.color.a=s=he(c.a+l.a*(Math.random()-.5)*2,0,255),n.deltaColor.r=(he(u.r+h.r*(Math.random()-.5)*2,0,255)-r)/i,n.deltaColor.g=(he(u.g+h.g*(Math.random()-.5)*2,0,255)-a)/i,n.deltaColor.b=(he(u.b+h.b*(Math.random()-.5)*2,0,255)-o)/i,n.deltaColor.a=(he(u.a+h.a*(Math.random()-.5)*2,0,255)-s)/i;var f=e.startSize+e.startSizeVar*(Math.random()-.5)*2;if(f=Math.max(0,f),n.size=f,-1===e.endSize)n.deltaSize=0;else{var _=e.endSize+e.endSizeVar*(Math.random()-.5)*2;_=Math.max(0,_),n.deltaSize=(_-f)/i}var p=e.startSpin+e.startSpinVar*(Math.random()-.5)*2,d=e.endSpin+e.endSpinVar*(Math.random()-.5)*2;n.rotation=p,n.deltaRotation=(d-p)/i,n.startPos.x=t.x,n.startPos.y=t.y,n.aspectRatio=e.aspectRatio||1;var m=fe(e.angle+this._worldRotation+e.angleVar*(Math.random()-.5)*2);if(e.emitterMode===jnt.GRAVITY){var g=e.speed+e.speedVar*(Math.random()-.5)*2;n.dir.x=Math.cos(m),n.dir.y=Math.sin(m),n.dir.multiplyScalar(g),n.radialAccel=e.radialAccel+e.radialAccelVar*(Math.random()-.5)*2,n.tangentialAccel=e.tangentialAccel+e.tangentialAccelVar*(Math.random()-.5)*2,e.rotationIsDir&&(n.rotation=-_e(Math.atan2(n.dir.y,n.dir.x)))}else{var v=e.startRadius+e.startRadiusVar*(Math.random()-.5)*2,y=e.endRadius+e.endRadiusVar*(Math.random()-.5)*2;n.radius=v,n.deltaRadius=-1===e.endRadius?0:(y-v)/i,n.angle=m,n.degreesPerSecond=fe(e.rotatePerS+e.rotatePerSVar*(Math.random()-.5)*2)}},e.updateUVs=function(t){var e=this.renderData;if(e&&this.sys._renderSpriteFrame){for(var n=e.vData,i=this.sys._renderSpriteFrame.uv,r=t?0:this.uvFilled,a=this.particles.length,o=r;o<a;o++){var s=o*Znt*4;n[s+3]=i[0],n[s+4]=i[1],n[s+12]=i[2],n[s+13]=i[3],n[s+21]=i[4],n[s+22]=i[5],n[s+30]=i[6],n[s+31]=i[7]}this.uvFilled=a}},e.updateParticleBuffer=function(t,e,n,i){var r=n.vData,a=e.x,o=e.y,s=t.size,c=s,l=t.aspectRatio;l>1?c=s/l:s=c*l;var u=s/2,h=c/2;if(t.rotation){var f=-u,_=-h,p=u,d=h,m=-fe(t.rotation),g=Math.cos(m),v=Math.sin(m);r[i]=f*g-_*v+a,r[i+1]=f*v+_*g+o,r[i+2]=0,r[i+9]=p*g-_*v+a,r[i+10]=p*v+_*g+o,r[i+11]=0,r[i+18]=f*g-d*v+a,r[i+19]=f*v+d*g+o,r[i+20]=0,r[i+27]=p*g-d*v+a,r[i+28]=p*v+d*g+o,r[i+29]=0}else r[i]=a-u,r[i+1]=o-h,r[i+2]=0,r[i+9]=a+u,r[i+10]=o-h,r[i+11]=0,r[i+18]=a-u,r[i+19]=o+h,r[i+20]=0,r[i+27]=a+u,r[i+28]=o+h,r[i+29]=0;_i.toArray(r,t.color,i+5),_i.toArray(r,t.color,i+14),_i.toArray(r,t.color,i+23),_i.toArray(r,t.color,i+32)},e.step=function(t){var e=this.sys.assembler,n=this.sys,i=n.node,r=this.particles;if(t=t>e.maxParticleDeltaTime?e.maxParticleDeltaTime:t,i.updateWorldTransform(),n.positionType===Wnt.FREE){this._worldRotation=function(t){for(var e=0,n=t;n;)e+=n.eulerAngles.z,n=n.parent;return e}(i);var a=i.worldMatrix;qnt.x=a.m12,qnt.y=a.m13}else n.positionType===Wnt.RELATIVE?(this._worldRotation=i.eulerAngles.z,qnt.x=i.position.x,qnt.y=i.position.y):this._worldRotation=0;if(this.active&&n.emissionRate){var o=1/n.emissionRate;for(r.length<n.totalParticles&&(this.emitCounter+=t);r.length<n.totalParticles&&this.emitCounter>o;)this.emitParticle(qnt),this.emitCounter-=o;this.elapsed+=t,-1!==n.duration&&n.duration<this.elapsed&&n.stopSystem()}var s=this.renderData,c=r.length;s.reset(),this.requestData(4*c,6*c),c>this.uvFilled&&this.updateUVs();for(var l=0;l<r.length;){Ynt.x=Ynt.y=Knt.x=Knt.y=Qnt.x=Qnt.y=0;var u=r[l];if(u.timeToLive-=t,u.timeToLive>0){if(n.emitterMode===jnt.GRAVITY){var h=Qnt,f=Ynt,_=Knt;(u.pos.x||u.pos.y)&&(f.set(u.pos),f.normalize()),_.set(f),f.multiplyScalar(u.radialAccel);var p=_.x;_.x=-_.y,_.y=p,_.multiplyScalar(u.tangentialAccel),h.set(f),h.add(_),h.add(n.gravity),h.multiplyScalar(t),u.dir.add(h),h.set(u.dir),h.multiplyScalar(t),u.pos.add(h)}else u.angle+=u.degreesPerSecond*t,u.radius+=u.deltaRadius*t,u.pos.x=-Math.cos(u.angle)*u.radius,u.pos.y=-Math.sin(u.angle)*u.radius;u.color.r+=u.deltaColor.r*t,u.color.g+=u.deltaColor.g*t,u.color.b+=u.deltaColor.b*t,u.color.a+=u.deltaColor.a*t,u.size+=u.deltaSize*t,u.size<0&&(u.size=0),u.rotation+=u.deltaRotation*t;var d=Ynt;d.set(u.pos),n.positionType!==Wnt.GROUPED&&d.add(u.startPos);var m=Znt*l*4;this.updateParticleBuffer(u,d,s,m),++l}else{var g=r[l];l!==r.length-1&&(r[l]=r[r.length-1]),$nt.put(g),r.length--,s.resize(s.vertexCount-4,s.indexCount-6)}}0!==r.length||this.active||this.readyToPlay||(this.finished=!0,n._finishedSimulation())},e.requestData=function(t,e){var n=this.renderData.indexCount;this.renderData.request(t,e);for(var i=this.renderData.indexCount/6,r=this.renderData.iData,a=n;a<i;a++){var o=4*a;r[n++]=o,r[n++]=o+1,r[n++]=o+2,r[n++]=o+1,r[n++]=o+3,r[n++]=o+2}},t}(),eit=t("ParticleAsset",nl("cc.ParticleAsset")((Vnt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return X(e=t.call.apply(t,[this].concat(i))||this,"spriteFrame",Hnt,V(e)),e}return F(e,t),e}(Ou),Hnt=q((Gnt=Vnt).prototype,"spriteFrame",[cl,yl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),knt=Gnt))||knt);i.ParticleAsset=eit;
/** @license zlib.js 2012 - imaya [ https://github.com/imaya/zlib.js ] The MIT License */
var nit={};(function(){function t(t){throw t}var e=void 0,n=!0,i=this;function r(t,n){var r,a=t.split("."),o=i;!(a[0]in o)&&o.execScript&&o.execScript("var "+a[0]);for(;a.length&&(r=a.shift());)a.length||n===e?o=o[r]?o[r]:o[r]={}:o[r]=n}var a="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array;function o(t){if("string"==typeof t){var e,n,i=t.split("");for(e=0,n=i.length;e<n;e++)i[e]=(255&i[e].charCodeAt(0))>>>0;t=i}for(var r,a=1,o=0,s=t.length,c=0;0<s;){s-=r=1024<s?1024:s;do{o+=a+=t[c++]}while(--r);a%=65521,o%=65521}return(o<<16|a)>>>0}function s(e,n){this.index="number"==typeof n?n:0,this.i=0,this.buffer=e instanceof(a?Uint8Array:Array)?e:new(a?Uint8Array:Array)(32768),2*this.buffer.length<=this.index&&t(Error("invalid index")),this.buffer.length<=this.index&&this.f()}s.prototype.f=function(){var t,e=this.buffer,n=e.length,i=new(a?Uint8Array:Array)(n<<1);if(a)i.set(e);else for(t=0;t<n;++t)i[t]=e[t];return this.buffer=i},s.prototype.d=function(t,e,n){var i,r=this.buffer,a=this.index,o=this.i,s=r[a];if(n&&1<e&&(t=8<e?(_[255&t]<<24|_[t>>>8&255]<<16|_[t>>>16&255]<<8|_[t>>>24&255])>>32-e:_[t]>>8-e),8>e+o)s=s<<e|t,o+=e;else for(i=0;i<e;++i)s=s<<1|t>>e-i-1&1,8==++o&&(o=0,r[a++]=_[s],s=0,a===r.length&&(r=this.f()));r[a]=s,this.buffer=r,this.i=o,this.index=a},s.prototype.finish=function(){var t,e=this.buffer,n=this.index;return 0<this.i&&(e[n]<<=8-this.i,e[n]=_[e[n]],n++),a?t=e.subarray(0,n):(e.length=n,t=e),t};var c,l=new(a?Uint8Array:Array)(256);for(c=0;256>c;++c){for(var u=f=c,h=7,f=f>>>1;f;f>>>=1)u<<=1,u|=1&f,--h;l[c]=(u<<h&255)>>>0}var _=l;function p(t){this.buffer=new(a?Uint16Array:Array)(2*t),this.length=0}function d(t){var e,n,i,r,o,s,c,l,u,h=t.length,f=0,_=Number.POSITIVE_INFINITY;for(l=0;l<h;++l)t[l]>f&&(f=t[l]),t[l]<_&&(_=t[l]);for(e=1<<f,n=new(a?Uint32Array:Array)(e),i=1,r=0,o=2;i<=f;){for(l=0;l<h;++l)if(t[l]===i){for(s=0,c=r,u=0;u<i;++u)s=s<<1|1&c,c>>=1;for(u=s;u<e;u+=o)n[u]=i<<16|l;++r}++i,r<<=1,o<<=1}return[n,f,_]}function m(t,e){this.h=v,this.w=0,this.input=t,this.b=0,e&&(e.lazy&&(this.w=e.lazy),"number"==typeof e.compressionType&&(this.h=e.compressionType),e.outputBuffer&&(this.a=a&&e.outputBuffer instanceof Array?new Uint8Array(e.outputBuffer):e.outputBuffer),"number"==typeof e.outputIndex&&(this.b=e.outputIndex)),this.a||(this.a=new(a?Uint8Array:Array)(32768))}p.prototype.getParent=function(t){return 2*((t-2)/4|0)},p.prototype.push=function(t,e){var n,i,r,a=this.buffer;for(n=this.length,a[this.length++]=e,a[this.length++]=t;0<n&&(i=this.getParent(n),a[n]>a[i]);)r=a[n],a[n]=a[i],a[i]=r,r=a[n+1],a[n+1]=a[i+1],a[i+1]=r,n=i;return this.length},p.prototype.pop=function(){var t,e,n,i,r,a=this.buffer;for(e=a[0],t=a[1],this.length-=2,a[0]=a[this.length],a[1]=a[this.length+1],r=0;!((i=2*r+2)>=this.length)&&(i+2<this.length&&a[i+2]>a[i]&&(i+=2),a[i]>a[r]);)n=a[r],a[r]=a[i],a[i]=n,n=a[r+1],a[r+1]=a[i+1],a[i+1]=n,r=i;return{index:t,value:e,length:this.length}};var g,v=2,y={NONE:0,r:1,j:v,N:3},x=[];for(g=0;288>g;g++)switch(n){case 143>=g:x.push([g+48,8]);break;case 255>=g:x.push([g-144+400,9]);break;case 279>=g:x.push([g-256+0,7]);break;case 287>=g:x.push([g-280+192,8]);break;default:t("invalid literal: "+g)}function S(t,e){this.length=t,this.G=e}function T(){var e=A;switch(n){case 3===e:return[257,e-3,0];case 4===e:return[258,e-4,0];case 5===e:return[259,e-5,0];case 6===e:return[260,e-6,0];case 7===e:return[261,e-7,0];case 8===e:return[262,e-8,0];case 9===e:return[263,e-9,0];case 10===e:return[264,e-10,0];case 12>=e:return[265,e-11,1];case 14>=e:return[266,e-13,1];case 16>=e:return[267,e-15,1];case 18>=e:return[268,e-17,1];case 22>=e:return[269,e-19,2];case 26>=e:return[270,e-23,2];case 30>=e:return[271,e-27,2];case 34>=e:return[272,e-31,2];case 42>=e:return[273,e-35,3];case 50>=e:return[274,e-43,3];case 58>=e:return[275,e-51,3];case 66>=e:return[276,e-59,3];case 82>=e:return[277,e-67,4];case 98>=e:return[278,e-83,4];case 114>=e:return[279,e-99,4];case 130>=e:return[280,e-115,4];case 162>=e:return[281,e-131,5];case 194>=e:return[282,e-163,5];case 226>=e:return[283,e-195,5];case 257>=e:return[284,e-227,5];case 258===e:return[285,e-258,0];default:t("invalid length: "+e)}}m.prototype.n=function(){var i,r,o,c,l=this.input;switch(this.h){case 0:for(o=0,c=l.length;o<c;){var u,h,f,_=r=a?l.subarray(o,o+65535):l.slice(o,o+65535),p=(o+=r.length)===c,d=e,m=e,g=this.a,y=this.b;if(a){for(g=new Uint8Array(this.a.buffer);g.length<=y+_.length+5;)g=new Uint8Array(g.length<<1);g.set(this.a)}if(u=p?1:0,g[y++]=0|u,f=65536+~(h=_.length)&65535,g[y++]=255&h,g[y++]=h>>>8&255,g[y++]=255&f,g[y++]=f>>>8&255,a)g.set(_,y),y+=_.length,g=g.subarray(0,y);else{for(d=0,m=_.length;d<m;++d)g[y++]=_[d];g.length=y}this.b=y,this.a=g}break;case 1:var S=new s(new Uint8Array(this.a.buffer),this.b);S.d(1,1,n),S.d(1,2,n);var T,A,E,C=w(this,l);for(T=0,A=C.length;T<A;T++)if(E=C[T],s.prototype.d.apply(S,x[E]),256<E)S.d(C[++T],C[++T],n),S.d(C[++T],5),S.d(C[++T],C[++T],n);else if(256===E)break;this.a=S.finish(),this.b=this.a.length;break;case v:var b,R,D,O,M,N,L,B,F,z,U,k,G,H,V,j=new s(new Uint8Array(this.a),this.b),W=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],X=Array(19);for(b=v,j.d(1,1,n),j.d(b,2,n),R=w(this,l),L=I(N=P(this.L,15)),F=I(B=P(this.K,7)),D=286;257<D&&0===N[D-1];D--);for(O=30;1<O&&0===B[O-1];O--);var q,Y,K,Q,Z,J,$=D,tt=O,et=new(a?Uint32Array:Array)($+tt),nt=new(a?Uint32Array:Array)(316),it=new(a?Uint8Array:Array)(19);for(q=Y=0;q<$;q++)et[Y++]=N[q];for(q=0;q<tt;q++)et[Y++]=B[q];if(!a)for(q=0,Q=it.length;q<Q;++q)it[q]=0;for(q=Z=0,Q=et.length;q<Q;q+=Y){for(Y=1;q+Y<Q&&et[q+Y]===et[q];++Y);if(K=Y,0===et[q])if(3>K)for(;0<K--;)nt[Z++]=0,it[0]++;else for(;0<K;)(J=138>K?K:138)>K-3&&J<K&&(J=K-3),10>=J?(nt[Z++]=17,nt[Z++]=J-3,it[17]++):(nt[Z++]=18,nt[Z++]=J-11,it[18]++),K-=J;else if(nt[Z++]=et[q],it[et[q]]++,3>--K)for(;0<K--;)nt[Z++]=et[q],it[et[q]]++;else for(;0<K;)(J=6>K?K:6)>K-3&&J<K&&(J=K-3),nt[Z++]=16,nt[Z++]=J-3,it[16]++,K-=J}for(i=a?nt.subarray(0,Z):nt.slice(0,Z),z=P(it,7),H=0;19>H;H++)X[H]=z[W[H]];for(M=19;4<M&&0===X[M-1];M--);for(U=I(z),j.d(D-257,5,n),j.d(O-1,5,n),j.d(M-4,4,n),H=0;H<M;H++)j.d(X[H],3,n);for(H=0,V=i.length;H<V;H++)if(k=i[H],j.d(U[k],z[k],n),16<=k){switch(H++,k){case 16:G=2;break;case 17:G=3;break;case 18:G=7;break;default:t("invalid code: "+k)}j.d(i[H],G,n)}var rt,at,ot,st,ct,lt,ut,ht,ft=[L,N],_t=[F,B];for(ct=ft[0],lt=ft[1],ut=_t[0],ht=_t[1],rt=0,at=R.length;rt<at;++rt)if(ot=R[rt],j.d(ct[ot],lt[ot],n),256<ot)j.d(R[++rt],R[++rt],n),st=R[++rt],j.d(ut[st],ht[st],n),j.d(R[++rt],R[++rt],n);else if(256===ot)break;this.a=j.finish(),this.b=this.a.length;break;default:t("invalid compression type")}return this.a};var A,E,C=[];for(A=3;258>=A;A++)E=T(),C[A]=E[2]<<24|E[1]<<16|E[0];var b=a?new Uint32Array(C):C;function w(i,r){function o(e,i){var r,a,o,s,c=e.G,l=[],u=0;switch(r=b[e.length],l[u++]=65535&r,l[u++]=r>>16&255,l[u++]=r>>24,n){case 1===c:a=[0,c-1,0];break;case 2===c:a=[1,c-2,0];break;case 3===c:a=[2,c-3,0];break;case 4===c:a=[3,c-4,0];break;case 6>=c:a=[4,c-5,1];break;case 8>=c:a=[5,c-7,1];break;case 12>=c:a=[6,c-9,2];break;case 16>=c:a=[7,c-13,2];break;case 24>=c:a=[8,c-17,3];break;case 32>=c:a=[9,c-25,3];break;case 48>=c:a=[10,c-33,4];break;case 64>=c:a=[11,c-49,4];break;case 96>=c:a=[12,c-65,5];break;case 128>=c:a=[13,c-97,5];break;case 192>=c:a=[14,c-129,6];break;case 256>=c:a=[15,c-193,6];break;case 384>=c:a=[16,c-257,7];break;case 512>=c:a=[17,c-385,7];break;case 768>=c:a=[18,c-513,8];break;case 1024>=c:a=[19,c-769,8];break;case 1536>=c:a=[20,c-1025,9];break;case 2048>=c:a=[21,c-1537,9];break;case 3072>=c:a=[22,c-2049,10];break;case 4096>=c:a=[23,c-3073,10];break;case 6144>=c:a=[24,c-4097,11];break;case 8192>=c:a=[25,c-6145,11];break;case 12288>=c:a=[26,c-8193,12];break;case 16384>=c:a=[27,c-12289,12];break;case 24576>=c:a=[28,c-16385,13];break;case 32768>=c:a=[29,c-24577,13];break;default:t("invalid distance")}for(r=a,l[u++]=r[0],l[u++]=r[1],l[u++]=r[2],o=0,s=l.length;o<s;++o)g[v++]=l[o];x[l[0]]++,T[l[3]]++,y=e.length+i-1,p=null}var s,c,l,u,h,f,_,p,d,m={},g=a?new Uint16Array(2*r.length):[],v=0,y=0,x=new(a?Uint32Array:Array)(286),T=new(a?Uint32Array:Array)(30),A=i.w;if(!a){for(l=0;285>=l;)x[l++]=0;for(l=0;29>=l;)T[l++]=0}for(x[256]=1,s=0,c=r.length;s<c;++s){for(l=h=0,u=3;l<u&&s+l!==c;++l)h=h<<8|r[s+l];if(m[h]===e&&(m[h]=[]),f=m[h],!(0<y--)){for(;0<f.length&&32768<s-f[0];)f.shift();if(s+3>=c){for(p&&o(p,-1),l=0,u=c-s;l<u;++l)d=r[s+l],g[v++]=d,++x[d];break}if(0<f.length){var E=e,C=e,w=0,P=e,I=e,R=e,D=r.length,O=(I=0,f.length);t:for(;I<O;I++){if(E=f[O-I-1],P=3,3<w){for(R=w;3<R;R--)if(r[E+R-1]!==r[s+R-1])continue t;P=w}for(;258>P&&s+P<D&&r[E+P]===r[s+P];)++P;if(P>w&&(C=E,w=P),258===P)break}_=new S(w,s-C),p?p.length<_.length?(d=r[s-1],g[v++]=d,++x[d],o(_,0)):o(p,-1):_.length<A?p=_:o(_,0)}else p?o(p,-1):(d=r[s],g[v++]=d,++x[d])}f.push(s)}return g[v++]=256,x[256]++,i.L=x,i.K=T,a?g.subarray(0,v):g}function P(t,e){function n(t){var e=A[t][E[t]];e===v?(n(t+1),n(t+1)):--S[e],++E[t]}var i,r,o,s,c,l=t.length,u=new p(572),h=new(a?Uint8Array:Array)(l);if(!a)for(s=0;s<l;s++)h[s]=0;for(s=0;s<l;++s)0<t[s]&&u.push(s,t[s]);if(i=Array(u.length/2),r=new(a?Uint32Array:Array)(u.length/2),1===i.length)return h[u.pop().index]=1,h;for(s=0,c=u.length/2;s<c;++s)i[s]=u.pop(),r[s]=i[s].value;var f,_,d,m,g,v=r.length,y=new(a?Uint16Array:Array)(e),x=new(a?Uint8Array:Array)(e),S=new(a?Uint8Array:Array)(v),T=Array(e),A=Array(e),E=Array(e),C=(1<<e)-v,b=1<<e-1;for(y[e-1]=v,_=0;_<e;++_)C<b?x[_]=0:(x[_]=1,C-=b),C<<=1,y[e-2-_]=(y[e-1-_]/2|0)+v;for(y[0]=x[0],T[0]=Array(y[0]),A[0]=Array(y[0]),_=1;_<e;++_)y[_]>2*y[_-1]+x[_]&&(y[_]=2*y[_-1]+x[_]),T[_]=Array(y[_]),A[_]=Array(y[_]);for(f=0;f<v;++f)S[f]=e;for(d=0;d<y[e-1];++d)T[e-1][d]=r[d],A[e-1][d]=d;for(f=0;f<e;++f)E[f]=0;for(1===x[e-1]&&(--S[0],++E[e-1]),_=e-2;0<=_;--_){for(m=f=0,g=E[_+1],d=0;d<y[_];d++)(m=T[_+1][g]+T[_+1][g+1])>r[f]?(T[_][d]=m,A[_][d]=v,g+=2):(T[_][d]=r[f],A[_][d]=f,++f);E[_]=0,1===x[_]&&n(_)}for(o=S,s=0,c=i.length;s<c;++s)h[i[s].index]=o[s];return h}function I(e){var n,i,r,o,s=new(a?Uint16Array:Array)(e.length),c=[],l=[],u=0;for(n=0,i=e.length;n<i;n++)c[e[n]]=1+(0|c[e[n]]);for(n=1,i=16;n<=i;n++)l[n]=u,(u+=0|c[n])>1<<n&&t("overcommitted"),u<<=1;for(65536>u&&t("undercommitted"),n=0,i=e.length;n<i;n++)for(u=l[e[n]],l[e[n]]+=1,r=s[n]=0,o=e[n];r<o;r++)s[n]=s[n]<<1|1&u,u>>>=1;return s}function R(t,e){this.input=t,this.a=new(a?Uint8Array:Array)(32768),this.h=D.j;var n,i={};for(n in!e&&(e={})||"number"!=typeof e.compressionType||(this.h=e.compressionType),e)i[n]=e[n];i.outputBuffer=this.a,this.z=new m(this.input,i)}var D=y;function O(e,n){switch(this.k=[],this.l=32768,this.e=this.g=this.c=this.q=0,this.input=a?new Uint8Array(e):e,this.s=!1,this.m=N,this.B=!1,!n&&(n={})||(n.index&&(this.c=n.index),n.bufferSize&&(this.l=n.bufferSize),n.bufferType&&(this.m=n.bufferType),n.resize&&(this.B=n.resize)),this.m){case M:this.b=32768,this.a=new(a?Uint8Array:Array)(32768+this.l+258);break;case N:this.b=0,this.a=new(a?Uint8Array:Array)(this.l),this.f=this.J,this.t=this.H,this.o=this.I;break;default:t(Error("invalid inflate mode"))}}R.prototype.n=function(){var e,n,i,r,s,c,l,u=0;switch(l=this.a,e=ut){case ut:n=Math.LOG2E*Math.log(32768)-8;break;default:t(Error("invalid compression method"))}switch(i=n<<4|e,l[u++]=i,e){case ut:switch(this.h){case D.NONE:s=0;break;case D.r:s=1;break;case D.j:s=2;break;default:t(Error("unsupported compression type"))}break;default:t(Error("invalid compression method"))}return r=s<<6|0,l[u++]=r|31-(256*i+r)%31,c=o(this.input),this.z.b=u,u=(l=this.z.n()).length,a&&((l=new Uint8Array(l.buffer)).length<=u+4&&(this.a=new Uint8Array(l.length+4),this.a.set(l),l=this.a),l=l.subarray(0,u+4)),l[u++]=c>>24&255,l[u++]=c>>16&255,l[u++]=c>>8&255,l[u++]=255&c,l},r("Zlib.Deflate",R),r("Zlib.Deflate.compress",(function(t,e){return new R(t,e).n()})),r("Zlib.Deflate.CompressionType",D),r("Zlib.Deflate.CompressionType.NONE",D.NONE),r("Zlib.Deflate.CompressionType.FIXED",D.r),r("Zlib.Deflate.CompressionType.DYNAMIC",D.j);var M=0,N=1,L={D:M,C:N};O.prototype.p=function(){for(;!this.s;){var i=tt(this,3);switch(1&i&&(this.s=n),i>>>=1){case 0:var r=this.input,o=this.c,s=this.a,c=this.b,l=e,u=e,h=e,f=s.length,_=e;switch(this.e=this.g=0,(l=r[o++])===e&&t(Error("invalid uncompressed block header: LEN (first byte)")),u=l,(l=r[o++])===e&&t(Error("invalid uncompressed block header: LEN (second byte)")),u|=l<<8,(l=r[o++])===e&&t(Error("invalid uncompressed block header: NLEN (first byte)")),h=l,(l=r[o++])===e&&t(Error("invalid uncompressed block header: NLEN (second byte)")),u===~(h|=l<<8)&&t(Error("invalid uncompressed block header: length verify")),o+u>r.length&&t(Error("input buffer is broken")),this.m){case M:for(;c+u>s.length;){if(u-=_=f-c,a)s.set(r.subarray(o,o+_),c),c+=_,o+=_;else for(;_--;)s[c++]=r[o++];this.b=c,s=this.f(),c=this.b}break;case N:for(;c+u>s.length;)s=this.f({v:2});break;default:t(Error("invalid inflate mode"))}if(a)s.set(r.subarray(o,o+u),c),c+=u,o+=u;else for(;u--;)s[c++]=r[o++];this.c=o,this.b=c,this.a=s;break;case 1:this.o(Z,$);break;case 2:nt(this);break;default:t(Error("unknown BTYPE: "+i))}}return this.t()};var B,F,z=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],U=a?new Uint16Array(z):z,k=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],G=a?new Uint16Array(k):k,H=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],V=a?new Uint8Array(H):H,j=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],W=a?new Uint16Array(j):j,X=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],q=a?new Uint8Array(X):X,Y=new(a?Uint8Array:Array)(288);for(B=0,F=Y.length;B<F;++B)Y[B]=143>=B?8:255>=B?9:279>=B?7:8;var K,Q,Z=d(Y),J=new(a?Uint8Array:Array)(30);for(K=0,Q=J.length;K<Q;++K)J[K]=5;var $=d(J);function tt(n,i){for(var r,a=n.g,o=n.e,s=n.input,c=n.c;o<i;)(r=s[c++])===e&&t(Error("input buffer is broken")),a|=r<<o,o+=8;return r=a&(1<<i)-1,n.g=a>>>i,n.e=o-i,n.c=c,r}function et(n,i){for(var r,a,o,s=n.g,c=n.e,l=n.input,u=n.c,h=i[0],f=i[1];c<f;)(r=l[u++])===e&&t(Error("input buffer is broken")),s|=r<<c,c+=8;return o=(a=h[s&(1<<f)-1])>>>16,n.g=s>>o,n.e=c-o,n.c=u,65535&a}function nt(t){function e(t,e,n){var i,r,a,o;for(o=0;o<t;)switch(i=et(this,e)){case 16:for(a=3+tt(this,2);a--;)n[o++]=r;break;case 17:for(a=3+tt(this,3);a--;)n[o++]=0;r=0;break;case 18:for(a=11+tt(this,7);a--;)n[o++]=0;r=0;break;default:r=n[o++]=i}return n}var n,i,r,o,s=tt(t,5)+257,c=tt(t,5)+1,l=tt(t,4)+4,u=new(a?Uint8Array:Array)(U.length);for(o=0;o<l;++o)u[U[o]]=tt(t,3);n=d(u),i=new(a?Uint8Array:Array)(s),r=new(a?Uint8Array:Array)(c),t.o(d(e.call(t,s,n,i)),d(e.call(t,c,n,r)))}function it(e,n){var i,r;switch(this.input=e,this.c=0,!n&&(n={})||(n.index&&(this.c=n.index),n.verify&&(this.M=n.verify)),i=e[this.c++],r=e[this.c++],15&i){case ut:this.method=ut;break;default:t(Error("unsupported compression method"))}0!=((i<<8)+r)%31&&t(Error("invalid fcheck flag:"+((i<<8)+r)%31)),32&r&&t(Error("fdict flag is not supported")),this.A=new O(e,{index:this.c,bufferSize:n.bufferSize,bufferType:n.bufferType,resize:n.resize})}O.prototype.o=function(t,e){var n=this.a,i=this.b;this.u=t;for(var r,a,o,s,c=n.length-258;256!==(r=et(this,t));)if(256>r)i>=c&&(this.b=i,n=this.f(),i=this.b),n[i++]=r;else for(s=G[a=r-257],0<V[a]&&(s+=tt(this,V[a])),r=et(this,e),o=W[r],0<q[r]&&(o+=tt(this,q[r])),i>=c&&(this.b=i,n=this.f(),i=this.b);s--;)n[i]=n[i++-o];for(;8<=this.e;)this.e-=8,this.c--;this.b=i},O.prototype.I=function(t,e){var n=this.a,i=this.b;this.u=t;for(var r,a,o,s,c=n.length;256!==(r=et(this,t));)if(256>r)i>=c&&(c=(n=this.f()).length),n[i++]=r;else for(s=G[a=r-257],0<V[a]&&(s+=tt(this,V[a])),r=et(this,e),o=W[r],0<q[r]&&(o+=tt(this,q[r])),i+s>c&&(c=(n=this.f()).length);s--;)n[i]=n[i++-o];for(;8<=this.e;)this.e-=8,this.c--;this.b=i},O.prototype.f=function(){var t,e,n=new(a?Uint8Array:Array)(this.b-32768),i=this.b-32768,r=this.a;if(a)n.set(r.subarray(32768,n.length));else for(t=0,e=n.length;t<e;++t)n[t]=r[t+32768];if(this.k.push(n),this.q+=n.length,a)r.set(r.subarray(i,i+32768));else for(t=0;32768>t;++t)r[t]=r[i+t];return this.b=32768,r},O.prototype.J=function(t){var e,n,i,r=this.input.length/this.c+1|0,o=this.input,s=this.a;return t&&("number"==typeof t.v&&(r=t.v),"number"==typeof t.F&&(r+=t.F)),n=2>r?(i=(o.length-this.c)/this.u[2]/2*258|0)<s.length?s.length+i:s.length<<1:s.length*r,a?(e=new Uint8Array(n)).set(s):e=s,this.a=e},O.prototype.t=function(){var t,e,n,i,r,o=0,s=this.a,c=this.k,l=new(a?Uint8Array:Array)(this.q+(this.b-32768));if(0===c.length)return a?this.a.subarray(32768,this.b):this.a.slice(32768,this.b);for(e=0,n=c.length;e<n;++e)for(i=0,r=(t=c[e]).length;i<r;++i)l[o++]=t[i];for(e=32768,n=this.b;e<n;++e)l[o++]=s[e];return this.k=[],this.buffer=l},O.prototype.H=function(){var t,e=this.b;return a?this.B?(t=new Uint8Array(e)).set(this.a.subarray(0,e)):t=this.a.subarray(0,e):(this.a.length>e&&(this.a.length=e),t=this.a),this.buffer=t},it.prototype.p=function(){var e,n=this.input;return e=this.A.p(),this.c=this.A.c,this.M&&(n[this.c++]<<24|n[this.c++]<<16|n[this.c++]<<8|n[this.c++])>>>0!==o(e)&&t(Error("invalid adler-32 checksum")),e},r("Zlib.Inflate",it),r("Zlib.Inflate.BufferType",L),L.ADAPTIVE=L.C,L.BLOCK=L.D,r("Zlib.Inflate.prototype.decompress",it.prototype.p);var rt,at,ot=new(a?Uint8Array:Array)(288);for(rt=0,at=ot.length;rt<at;++rt)ot[rt]=143>=rt?8:255>=rt?9:279>=rt?7:8;d(ot);var st,ct,lt=new(a?Uint8Array:Array)(30);for(st=0,ct=lt.length;st<ct;++st)lt[st]=5;d(lt);var ut=8}).call(nit);var iit=nit.Zlib;iit.Deflate=iit.Deflate,iit.Deflate.compress=iit.Deflate.compress,iit.Inflate=iit.Inflate,iit.Inflate.BufferType=iit.Inflate.BufferType,iit.Inflate.prototype.decompress=iit.Inflate.prototype.decompress;for(var rit=function(){function t(t){var e,n=this;this.pos=8,this.palette=[],this.imgData=[],this.text={},this.width=0,this.height=0,this.bits=0,this.colorType=0,this.compressionMethod=0,this.filterMethod=0,this.interlaceMethod=0,this.colors=0,this.hasAlphaChannel=!1,this.pixelBitlength=0,this.data=t,this.transparency={indexed:[],rgb:0,grayscale:0};for(var i=0,r=0,a=0;;){a=this.readUInt32();var o=function(){var t=[];for(i=0;i<4;++i)t.push(String.fromCharCode(n.data[n.pos++]));return t}.call(this).join("");switch(o){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(a);break;case"fcTL":e&&this.animation.frames.push(e),this.pos+=4,e={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()};var s=this.readUInt16(),c=this.readUInt16()||100;e.delay=1e3*s/c,e.disposeOp=this.data[this.pos++],e.blendOp=this.data[this.pos++],e.data=[];break;case"IDAT":case"fdAT":for("fdAT"===o&&(this.pos+=4,a-=4),t=(null!=e?e.data:void 0)||this.imgData,i=0;a>=0?i<a:i>a;a>=0?++i:--i)t.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:this.transparency.indexed=this.read(a);var l=255-this.transparency.indexed.length;if(l>0)for(r=0;l>=0?r<l:r>l;l>=0?++r:--r)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(a)[0];break;case 2:this.transparency.rgb=this.read(a)}break;case"tEXt":var u=this.read(a),h=u.indexOf(0),f=String.fromCharCode.apply(String,u.slice(0,h));this.text[f]=String.fromCharCode.apply(String,u.slice(h+1));break;case"IEND":e&&this.animation.frames.push(e),this.colors=function(){switch(n.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}.call(this);var _=this.colorType;this.hasAlphaChannel=4===_||6===_;var p=this.colors+(this.hasAlphaChannel?1:0);return this.pixelBitlength=this.bits*p,this.colorSpace=function(){switch(n.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}.call(this),void(this.imgData instanceof Uint8Array||(this.imgData=new Uint8Array(this.imgData)));default:this.pos+=a}if(this.pos+=4,this.pos>this.data.length)throw new Error(R(6017))}}var e=t.prototype;return e.read=function(t){var e=0,n=[];for(e=0;t>=0?e<t:e>t;t>=0?++e:--e)n.push(this.data[this.pos++]);return n},e.readUInt32=function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},e.readUInt16=function(){return this.data[this.pos++]<<8|this.data[this.pos++]},e.decodePixels=function(t){if(null==t&&(t=this.imgData),0===t.length)return new Uint8Array(0);t=new iit.Inflate(t,{index:0,verify:!1}).decompress();for(var e=this.pixelBitlength/8,n=e*this.width,i=new Uint8Array(n*this.height),r=t.length,a=0,o=0,s=0,c=0,l=0,u=0,h=0,f=0,_=0,p=0,d=0,m=0,g=0,v=0,y=0,x=0,S=0,T=0,A=0;o<r;){switch(t[o++]){case 0:for(u=h=0;h<n;u=h+=1)i[s++]=t[o++];break;case 1:for(u=f=0;f<n;u=f+=1)c=t[o++],m=u<e?0:i[s-e],i[s++]=(c+m)%256;break;case 2:for(u=_=0;_<n;u=_+=1)c=t[o++],l=(u-u%e)/e,T=a&&i[(a-1)*n+l*e+u%e],i[s++]=(T+c)%256;break;case 3:for(u=p=0;p<n;u=p+=1)c=t[o++],l=(u-u%e)/e,m=u<e?0:i[s-e],T=a&&i[(a-1)*n+l*e+u%e],i[s++]=(c+Math.floor((m+T)/2))%256;break;case 4:for(u=d=0;d<n;u=d+=1)c=t[o++],l=(u-u%e)/e,m=u<e?0:i[s-e],0===a?T=A=0:(T=i[(a-1)*n+l*e+u%e],A=l&&i[(a-1)*n+(l-1)*e+u%e]),g=m+T-A,v=Math.abs(g-m),x=Math.abs(g-T),S=Math.abs(g-A),y=v<=x&&v<=S?m:x<=S?T:A,i[s++]=(c+y)%256;break;default:throw new Error(R(6018,t[o-1]))}a++}return i},e.copyToImageData=function(t,e){var n,i=this.hasAlphaChannel,r=this.colors;this.palette.length&&(n=null!=this._decodedPalette?this._decodedPalette:this._decodedPalette=this.decodePalette(),r=4,i=!0);var a=t.data||t,o=a.length,s=n||e,c=0,l=0,u=0,h=0;if(1===r)for(;c<o;)u=n?4*e[c/4]:l,h=s[u++],a[c++]=h,a[c++]=h,a[c++]=h,a[c++]=i?s[u++]:255,l=u;else for(;c<o;)u=n?4*e[c/4]:l,a[c++]=s[u++],a[c++]=s[u++],a[c++]=s[u++],a[c++]=i?s[u++]:255,l=u},e.decodePalette=function(){for(var t=this.palette,e=this.transparency.indexed||[],n=new Uint8Array((e.length||0)+t.length),i=0,r=0,a=0,o=0,s=0,c=t.length;s<c;o=s+=3)n[i++]=t[o],n[i++]=t[o+1],n[i++]=t[o+2],a=e[r++],n[i++]=null!=a?a:255;return n},e.render=function(t){t.width=this.width,t.height=this.height;var e=t.getContext("2d"),n=e.createImageData(this.width,this.height);return this.copyToImageData(n,this.decodePixels(null)),e.putImageData(n,0,0)},t}(),ait=function(){function t(){this._littleEndian=!1,this._tiffData=[],this._fileDirectories=[]}var e=t.prototype;return e.getUint8=function(t){return this._tiffData[t]},e.getUint16=function(t){return this._littleEndian?this._tiffData[t+1]<<8|this._tiffData[t]:this._tiffData[t]<<8|this._tiffData[t+1]},e.getUint32=function(t){var e=this._tiffData;return this._littleEndian?e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t]:e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]},e.checkLittleEndian=function(){var t=this.getUint16(0);if(18761===t)this._littleEndian=!0;else{if(19789!==t)throw console.log(t),TypeError(R(6019));this._littleEndian=!1}return this._littleEndian},e.hasTowel=function(){if(42!==this.getUint16(2))throw RangeError(R(6020));return!0},e.getFieldTypeName=function(t){return t in sit?sit[t]:null},e.getFieldTagName=function(t){return t in oit?oit[t]:(T(6021,t),"Tag"+t)},e.getFieldTypeLength=function(t){return-1!==["BYTE","ASCII","SBYTE","UNDEFINED"].indexOf(t)?1:-1!==["SHORT","SSHORT"].indexOf(t)?2:-1!==["LONG","SLONG","FLOAT"].indexOf(t)?4:-1!==["RATIONAL","SRATIONAL","DOUBLE"].indexOf(t)?8:0},e.getFieldValues=function(t,e,n,i){var r=[],a=this.getFieldTypeLength(e);if(a*n<=4)!1===this._littleEndian?r.push(i>>>8*(4-a)):r.push(i);else for(var o=0;o<n;o++){var s=a*o;a>=8?-1!==["RATIONAL","SRATIONAL"].indexOf(e)?(r.push(this.getUint32(i+s)),r.push(this.getUint32(i+s+4))):T(8e3):r.push(this.getBytes(a,i+s))}return"ASCII"===e&&r.forEach((function(t,e,n){n[e]=String.fromCharCode(t)})),r},e.getBytes=function(t,e){if(t<=0)T(8001);else{if(t<=1)return this.getUint8(e);if(t<=2)return this.getUint16(e);if(t<=3)return this.getUint32(e)>>>8;if(t<=4)return this.getUint32(e);T(8002)}return 0},e.getBits=function(t,e,n){n=n||0;var i=e+Math.floor(n/8),r=n+t,a=32-t,o=0,s=0;return r<=0?T(6023):r<=8?(o=24+n,s=this.getUint8(i)):r<=16?(o=16+n,s=this.getUint16(i)):r<=32?(o=n,s=this.getUint32(i)):T(6022),{bits:s<<o>>>a,byteOffset:i+Math.floor(r/8),bitOffset:r%8}},e.parseFileDirectory=function(t){var e=this.getUint16(t),n=[],i=0,r=0;for(i=t+2,r=0;r<e;i+=12,r++){var a=this.getUint16(i),o=this.getUint16(i+2),s=this.getUint32(i+4),c=this.getUint32(i+8),l=this.getFieldTagName(a),u=this.getFieldTypeName(o),h=this.getFieldValues(l,u,s,c);n[l]={type:u,values:h}}this._fileDirectories.push(n);var f=this.getUint32(i);0!==f&&this.parseFileDirectory(f)},e.clampColorSample=function(t,e){var n=Math.pow(2,8-e);return Math.floor(t*n+(n-1))},e.parseTIFF=function(t,e){var n=this;if(e=e||document.createElement("canvas"),this._tiffData=t,this._canvas=e,this.checkLittleEndian(),this.hasTowel()){var i=this.getUint32(4);this._fileDirectories.length=0,this.parseFileDirectory(i);var r=this._fileDirectories[0],a=r.ImageWidth.values[0],o=r.ImageLength.values[0];this._canvas.width=a,this._canvas.height=o;var s=[],c=r.Compression?r.Compression.values[0]:1,l=r.SamplesPerPixel.values[0],u=[],h=0,f=!1;r.BitsPerSample.values.forEach((function(t,e){u[e]={bitsPerSample:t,hasBytesPerSample:!1,bytesPerSample:void 0},t%8==0&&(u[e].hasBytesPerSample=!0,u[e].bytesPerSample=t/8),h+=t}),this);var _=0;h%8==0&&(f=!0,_=h/8);var p,d=r.StripOffsets.values,m=d.length;if(r.StripByteCounts)p=r.StripByteCounts.values;else{if(T(8003),1!==m)throw Error(R(6024));p=[Math.ceil(a*o*h/8)]}for(var g=1,v=1,y=0;y<m;y++){var x=d[y];s[y]=[];for(var S=p[y],A=0,E=0,C=1,b=!0,w=[],P=0,I=0,D=0;A<S;A+=C)switch(c){case 1:w=[];for(var O=0;O<l;O++){var M=u[O];if(!M.hasBytesPerSample){var N=this.getBits(M.bitsPerSample,x+A,E);throw w.push(N.bits),A=N.byteOffset-x,E=N.bitOffset,RangeError(R(6025))}var L=M.bytesPerSample*O;w.push(this.getBytes(M.bytesPerSample,x+A+L))}if(s[y].push(w),!f)throw C=0,RangeError(R(6026));C=_;break;case 2:case 3:case 4:case 5:case 6:case 7:break;case 32773:if(b){b=!1;var B=this.getUint8(x+A);B>=0&&B<=127?g=B+1:B>=-127&&B<=-1?v=1-B:b=!0}else{for(var F=this.getUint8(x+A),z=0;z<v;z++){var U=u[I];if(!U.hasBytesPerSample)throw RangeError(R(6025));D=D<<8*P|F,++P===U.bytesPerSample&&(w.push(D),D=P=0,I++),I===l&&(s[y].push(w),w=[],I=0)}0==--g&&(b=!0)}C=1}}if(e.getContext){var k=this._canvas.getContext("2d");k.fillStyle="rgba(255, 255, 255, 0)";var G=r.RowsPerStrip?r.RowsPerStrip.values[0]:o,H=s.length,V=o%G,j=0===V?G:V,W=G,X=0,q=r.PhotometricInterpretation.values[0],Y=[],K=0;r.ExtraSamples&&(K=(Y=r.ExtraSamples.values).length);var Q=[],Z=0;r.ColorMap&&(Q=r.ColorMap.values,Z=Math.pow(2,u[0].bitsPerSample));for(var J=0;J<H;J++){J+1===H&&(W=j);for(var $=s[J].length,tt=X*J,et=0,nt=0;et<W&&nt<$;et++)for(var it=0;it<a;it++,nt++){var rt=s[J][nt],at=0,ot=0,st=0,ct=1;if(K>0)for(var lt=0;lt<K;lt++)if(1===Y[lt]||2===Y[lt]){ct=rt[3+lt]/256;break}!function(){switch(q){case 0:var t=0;u[0].hasBytesPerSample&&(t=Math.pow(16,2*u[0].bytesPerSample)),rt.forEach((function(e,n,i){i[n]=t-e}));case 1:at=ot=st=n.clampColorSample(rt[0],u[0].bitsPerSample);break;case 2:at=n.clampColorSample(rt[0],u[0].bitsPerSample),ot=n.clampColorSample(rt[1],u[1].bitsPerSample),st=n.clampColorSample(rt[2],u[2].bitsPerSample);break;case 3:if(void 0===Q)throw Error(R(6027));var e=rt[0];at=n.clampColorSample(Q[e],16),ot=n.clampColorSample(Q[Z+e],16),st=n.clampColorSample(Q[2*Z+e],16);break;default:throw RangeError(R(6028,q))}}(),k.fillStyle="rgba("+at+", "+ot+", "+st+", "+ct+")",k.fillRect(it,tt+et,1,1)}X=W}}return this._canvas}},t}(),oit={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop"},sit={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE"},cit=new Array(123),lit=0;lit<123;++lit)cit[lit]=64;for(var uit=0;uit<64;++uit)cit["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charCodeAt(uit)]=uit;var hit={name:"Jacob__Codec__Base64",decode:function(t){var e,n,i,r,a,o,s=[],c=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");c<t.length;)e=cit[t.charCodeAt(c++)]<<2|(r=cit[t.charCodeAt(c++)])>>4,n=(15&r)<<4|(a=cit[t.charCodeAt(c++)])>>2,i=(3&a)<<6|(o=cit[t.charCodeAt(c++)]),s.push(String.fromCharCode(e)),64!==a&&s.push(String.fromCharCode(n)),64!==o&&s.push(String.fromCharCode(i));return s.join("")},decodeAsArray:function(t,e){var n,i,r,a=this.decode(t),o=[];for(n=0,r=a.length/e;n<r;n++)for(o[n]=0,i=e-1;i>=0;--i)o[n]+=a.charCodeAt(n*e+i)<<8*i;return o}},fit=function(t){this.data=t,this.debug=!1,this.gpflags=void 0,this.files=0,this.unzipped=[],this.buf32k=new Array(32768),this.bIdx=0,this.modeZIP=!1,this.bytepos=0,this.bb=1,this.bits=0,this.nameBuf=[],this.fileout=void 0,this.literalTree=new Array(fit.LITERALS),this.distanceTree=new Array(32),this.treepos=0,this.Places=null,this.len=0,this.fpos=new Array(17),this.fpos[0]=0,this.flens=void 0,this.fmax=void 0};fit.gunzip=function(t){return t.constructor===Array||t.constructor,new fit(t).gunzip()[0][0]},fit.HufNode=function(){this.b0=0,this.b1=0,this.jump=null,this.jumppos=-1},fit.LITERALS=288,fit.NAMEMAX=256,fit.bitReverse=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254,1,129,65,193,33,161,97,225,17,145,81,209,49,177,113,241,9,137,73,201,41,169,105,233,25,153,89,217,57,185,121,249,5,133,69,197,37,165,101,229,21,149,85,213,53,181,117,245,13,141,77,205,45,173,109,237,29,157,93,221,61,189,125,253,3,131,67,195,35,163,99,227,19,147,83,211,51,179,115,243,11,139,75,203,43,171,107,235,27,155,91,219,59,187,123,251,7,135,71,199,39,167,103,231,23,151,87,215,55,183,119,247,15,143,79,207,47,175,111,239,31,159,95,223,63,191,127,255],fit.cplens=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],fit.cplext=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99],fit.cpdist=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],fit.cpdext=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],fit.border=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],fit.prototype.gunzip=function(){return this.outputArr=[],this.nextFile(),this.unzipped},fit.prototype.readByte=function(){return this.bits+=8,this.bytepos<this.data.length?this.data.charCodeAt(this.bytepos++):-1},fit.prototype.byteAlign=function(){this.bb=1},fit.prototype.readBit=function(){var t;return this.bits++,t=1&this.bb,this.bb>>=1,0===this.bb&&(this.bb=this.readByte(),t=1&this.bb,this.bb=this.bb>>1|128),t},fit.prototype.readBits=function(t){for(var e=0,n=t;n--;)e=e<<1|this.readBit();return t&&(e=fit.bitReverse[e]>>8-t),e},fit.prototype.flushBuffer=function(){this.bIdx=0},fit.prototype.addBuffer=function(t){this.buf32k[this.bIdx++]=t,this.outputArr.push(String.fromCharCode(t)),32768===this.bIdx&&(this.bIdx=0)},fit.prototype.IsPat=function(){for(;;){if(this.fpos[this.len]>=this.fmax)return-1;if(this.flens[this.fpos[this.len]]===this.len)return this.fpos[this.len]++;this.fpos[this.len]++}},fit.prototype.Rec=function(){var t,e=this.Places[this.treepos];if(17===this.len)return-1;if(this.treepos++,this.len++,(t=this.IsPat())>=0)e.b0=t;else if(e.b0=32768,this.Rec())return-1;if((t=this.IsPat())>=0)e.b1=t,e.jump=null;else if(e.b1=32768,e.jump=this.Places[this.treepos],e.jumppos=this.treepos,this.Rec())return-1;return this.len--,0},fit.prototype.CreateTree=function(t,e,n){var i;for(this.Places=t,this.treepos=0,this.flens=n,this.fmax=e,i=0;i<17;i++)this.fpos[i]=0;return this.len=0,this.Rec()?-1:0},fit.prototype.DecodeValue=function(t){for(var e,n,i=0,r=t[i];;)if(this.readBit()){if(!(32768&r.b1))return r.b1;for(r=r.jump,e=t.length,n=0;n<e;n++)if(t[n]===r){i=n;break}}else{if(!(32768&r.b0))return r.b0;r=t[++i]}return-1},fit.prototype.DeflateLoop=function(){var t,e,n;do{var i,r;if(t=this.readBit(),0===(e=this.readBits(2)))for(this.byteAlign(),i=this.readByte(),i|=this.readByte()<<8,r=this.readByte(),65535&(i^~(r|=this.readByte()<<8))&&document.write("BlockLen checksum mismatch\n");i--;)a=this.readByte(),this.addBuffer(a);else if(1===e)for(;;)if((o=fit.bitReverse[this.readBits(7)]>>1)>23?(o=o<<1|this.readBit())>199?o=(o-=128)<<1|this.readBit():(o-=48)>143&&(o+=136):o+=256,o<256)this.addBuffer(o);else{if(256===o)break;for(o-=257,p=this.readBits(fit.cplext[o])+fit.cplens[o],o=fit.bitReverse[this.readBits(5)]>>3,fit.cpdext[o]>8?(d=this.readBits(8),d|=this.readBits(fit.cpdext[o]-8)<<8):d=this.readBits(fit.cpdext[o]),d+=fit.cpdist[o],o=0;o<p;o++){var a=this.buf32k[this.bIdx-d&32767];this.addBuffer(a)}}else if(2===e){var o,s,c,l,u,h=new Array(320);for(c=257+this.readBits(5),l=1+this.readBits(5),u=4+this.readBits(4),o=0;o<19;o++)h[o]=0;for(o=0;o<u;o++)h[fit.border[o]]=this.readBits(3);for(p=this.distanceTree.length,n=0;n<p;n++)this.distanceTree[n]=new fit.HufNode;if(this.CreateTree(this.distanceTree,19,h,0))return this.flushBuffer(),1;for(s=c+l,n=0;n<s;)if((o=this.DecodeValue(this.distanceTree))<16)h[n++]=o;else if(16===o){var f;if(n+(o=3+this.readBits(2))>s)return this.flushBuffer(),1;for(f=n?h[n-1]:0;o--;)h[n++]=f}else{if(n+(o=17===o?3+this.readBits(3):11+this.readBits(7))>s)return this.flushBuffer(),1;for(;o--;)h[n++]=0}for(p=this.literalTree.length,n=0;n<p;n++)this.literalTree[n]=new fit.HufNode;if(this.CreateTree(this.literalTree,c,h,0))return this.flushBuffer(),1;for(p=this.literalTree.length,n=0;n<p;n++)this.distanceTree[n]=new fit.HufNode;var _=new Array;for(n=c;n<h.length;n++)_[n-c]=h[n];if(this.CreateTree(this.distanceTree,l,_,0))return this.flushBuffer(),1;for(;;)if((o=this.DecodeValue(this.literalTree))>=256){var p,d;if(0==(o-=256))break;for(o--,p=this.readBits(fit.cplext[o])+fit.cplens[o],o=this.DecodeValue(this.distanceTree),fit.cpdext[o]>8?(d=this.readBits(8),d|=this.readBits(fit.cpdext[o]-8)<<8):d=this.readBits(fit.cpdext[o]),d+=fit.cpdist[o];p--;)a=this.buf32k[this.bIdx-d&32767],this.addBuffer(a)}else this.addBuffer(o)}}while(!t);return this.flushBuffer(),this.byteAlign(),0},fit.prototype.unzipFile=function(t){var e;for(this.gunzip(),e=0;e<this.unzipped.length;e++)if(this.unzipped[e][1]===t)return this.unzipped[e][0]},fit.prototype.nextFile=function(){this.outputArr=[],this.modeZIP=!1;var t=[];if(t[0]=this.readByte(),t[1]=this.readByte(),120===t[0]&&218===t[1]&&(this.DeflateLoop(),this.unzipped[this.files]=[this.outputArr.join(""),"geonext.gxt"],this.files++),31===t[0]&&139===t[1]&&(this.skipdir(),this.unzipped[this.files]=[this.outputArr.join(""),"file"],this.files++),80===t[0]&&75===t[1]&&(this.modeZIP=!0,t[2]=this.readByte(),t[3]=this.readByte(),3===t[2]&&4===t[3])){t[0]=this.readByte(),t[1]=this.readByte(),this.gpflags=this.readByte(),this.gpflags|=this.readByte()<<8;var e=this.readByte();e|=this.readByte()<<8,this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte();var n=this.readByte();n|=this.readByte()<<8;var i=this.readByte();for(i|=this.readByte()<<8,a=0,this.nameBuf=[];n--;){var r=this.readByte();"/"===r|":"===r?a=0:a<fit.NAMEMAX-1&&(this.nameBuf[a++]=String.fromCharCode(r))}this.fileout||(this.fileout=this.nameBuf);for(var a=0;a<i;)r=this.readByte(),a++;8===e&&(this.DeflateLoop(),this.unzipped[this.files]=[this.outputArr.join(""),this.nameBuf.join("")],this.files++),this.skipdir()}},fit.prototype.skipdir=function(){var t,e,n=[];if(8&this.gpflags&&(n[0]=this.readByte(),n[1]=this.readByte(),n[2]=this.readByte(),n[3]=this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte()),this.modeZIP&&this.nextFile(),n[0]=this.readByte(),8!==n[0])return 0;if(this.gpflags=this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),4&this.gpflags)for(n[0]=this.readByte(),n[2]=this.readByte(),this.len=n[0]+256*n[1],t=0;t<this.len;t++)this.readByte();if(8&this.gpflags)for(t=0,this.nameBuf=[];e=this.readByte();)"7"!==e&&":"!==e||(t=0),t<fit.NAMEMAX-1&&(this.nameBuf[t++]=e);if(16&this.gpflags)for(;e=this.readByte(););2&this.gpflags&&(this.readByte(),this.readByte()),this.DeflateLoop(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.modeZIP&&this.nextFile()};var _it,pit,dit,mit,git,vit,yit,xit,Sit,Tit,Ait,Eit,Cit,bit,wit,Pit,Iit,Rit,Dit,Oit,Mit,Nit,Lit,Bit,Fit,zit,Uit,kit,Git,Hit,Vit,jit,Wit,Xit,qit,Yit,Kit,Qit,Zit,Jit,$it,trt,ert,nrt,irt,rrt,art,ort,srt,crt,lrt,urt,hrt,frt,_rt,prt,drt,mrt,grt,vrt,yrt,xrt,Srt,Trt,Art,Ert,Crt,brt,wrt,Prt,Irt,Rrt,Drt,Ort,Mrt,Nrt,Lrt,Brt,Frt,zrt,Urt,krt,Grt,Hrt,Vrt,jrt,Wrt,Xrt,qrt,Yrt,Krt,Qrt,Zrt,Jrt,$rt,tat,eat,nat,iat,rat,aat,oat,sat,cat={name:"Jacob__Codec"};function lat(t){var e=t.parent,n=t.getComponent(Eat);return e&&n?lat(e):t.getComponentsInChildren(Eat)}cat.Base64=hit,cat.GZip=fit,cat.unzip=function(){return cat.GZip.gunzip.apply(cat.GZip,arguments)},cat.unzipBase64=function(){var t=cat.Base64.decode.apply(cat.Base64,arguments);try{return cat.GZip.gunzip.call(cat.GZip,t)}catch(e){return t.slice(7)}},cat.unzipBase64AsArray=function(t,e){e=e||1;var n,i,r,a=this.unzipBase64(t),o=[];for(n=0,r=a.length/e;n<r;n++)for(o[n]=0,i=e-1;i>=0;--i)o[n]+=a.charCodeAt(n*e+i)<<8*i;return o},cat.unzipAsArray=function(t,e){e=e||1;var n,i,r,a=this.unzip(t),o=[];for(n=0,r=a.length/e;n<r;n++)for(o[n]=0,i=e-1;i>=0;--i)o[n]+=a.charCodeAt(n*e+i)<<8*i;return o},function(t){t[t.JPG=0]="JPG",t[t.PNG=1]="PNG",t[t.TIFF=2]="TIFF",t[t.WEBP=3]="WEBP",t[t.PVR=4]="PVR",t[t.ETC=5]="ETC",t[t.S3TC=6]="S3TC",t[t.ATITC=7]="ATITC",t[t.TGA=8]="TGA",t[t.RAWDATA=9]="RAWDATA",t[t.UNKNOWN=10]="UNKNOWN"}(sat||(sat={}));var uat,hat,fat,_at,pat,dat,mat,gat,vat,yat,xat,Sat,Tat,Aat,Eat=t("ParticleSystem2D",(_it=nl("cc.ParticleSystem2D"),pit=pl(),dit=Il(),mit=Al(),git=Bl(eit),vit=Il(),yit=Al(),xit=Bl(uj),Sit=Al(),Tit=Al(),Ait=Al(),Eit=Al(),Cit=Al(),bit=Al(),wit=Al(),Pit=Al(),Iit=xl(),Rit=Al(),Dit=Al(),Oit=Al(),Mit=Al(),Nit=Al(),Lit=Al(),Bit=Al(),Fit=Al(),zit=Al(),Uit=Al(),kit=Al(),Git=Al(),Hit=Al(),Vit=Bl(Wnt),jit=Al(),Wit=Il(),Xit=Al(),qit=Bl(jnt),Yit=Al(),Kit=Al(),Qit=Al(),Zit=Al(),Jit=Al(),$it=Al(),trt=Al(),ert=Al(),nrt=Al(),irt=Al(),rrt=Al(),art=Al(),ort=Al(),srt=Al(),crt=Al(),lrt=Il(),urt=Al(),hrt=Il(),frt=Al(),_rt=ll("preview"),_it(prt=pit(prt=dl(prt=_l((oat=aat=function(t){function e(){var e;return X(e=t.call(this)||this,"duration",mrt,V(e)),X(e,"emissionRate",grt,V(e)),X(e,"life",vrt,V(e)),X(e,"lifeVar",yrt,V(e)),X(e,"angle",xrt,V(e)),X(e,"angleVar",Srt,V(e)),X(e,"startSize",Trt,V(e)),X(e,"startSizeVar",Art,V(e)),X(e,"endSize",Ert,V(e)),X(e,"endSizeVar",Crt,V(e)),X(e,"startSpin",brt,V(e)),X(e,"startSpinVar",wrt,V(e)),X(e,"endSpin",Prt,V(e)),X(e,"endSpinVar",Irt,V(e)),X(e,"sourcePos",Rrt,V(e)),X(e,"posVar",Drt,V(e)),X(e,"emitterMode",Ort,V(e)),X(e,"gravity",Mrt,V(e)),X(e,"speed",Nrt,V(e)),X(e,"speedVar",Lrt,V(e)),X(e,"tangentialAccel",Brt,V(e)),X(e,"tangentialAccelVar",Frt,V(e)),X(e,"radialAccel",zrt,V(e)),X(e,"radialAccelVar",Urt,V(e)),X(e,"rotationIsDir",krt,V(e)),X(e,"startRadius",Grt,V(e)),X(e,"startRadiusVar",Hrt,V(e)),X(e,"endRadius",Vrt,V(e)),X(e,"endRadiusVar",jrt,V(e)),X(e,"rotatePerS",Wrt,V(e)),X(e,"rotatePerSVar",Xrt,V(e)),e.aspectRatio=1,X(e,"playOnLoad",qrt,V(e)),X(e,"autoRemoveOnFinish",Yrt,V(e)),X(e,"_preview",Krt,V(e)),X(e,"_custom",Qrt,V(e)),X(e,"_file",Zrt,V(e)),X(e,"_spriteFrame",Jrt,V(e)),X(e,"_totalParticles",$rt,V(e)),X(e,"_startColor",tat,V(e)),X(e,"_startColorVar",eat,V(e)),X(e,"_endColor",nat,V(e)),X(e,"_endColorVar",iat,V(e)),X(e,"_positionType",rat,V(e)),e._stopped=!0,e.initProperties(),e}F(e,t);var n=e.prototype;return n.onEnable=function(){t.prototype.onEnable.call(this),this._updateMaterial()},n.onDestroy=function(){t.prototype.onDestroy.call(this),this.autoRemoveOnFinish&&(this.autoRemoveOnFinish=!1),this._simulator.uvFilled=0,this._simulator.renderData&&this._assembler&&this._assembler.removeData(this._simulator.renderData)},n.initProperties=function(){this._previewTimer=null,this._focused=!1,this.aspectRatio=1,this._simulator=new tit(this)},n.onFocusInEditor=function(){this._focused=!0;for(var t=lat(this.node),e=0;e<t.length;++e)t[e]._startPreview()},n.onLostFocusInEditor=function(){this._focused=!1;for(var t=lat(this.node),e=0;e<t.length;++e)t[e]._stopPreview()},n._startPreview=function(){this._preview&&this.resetSystem()},n._stopPreview=function(){this._preview&&(this.resetSystem(),this.stopSystem()),this._previewTimer&&clearInterval(this._previewTimer)},n.__preload=function(){t.prototype.__preload.call(this),this._custom&&this.spriteFrame&&!this._renderSpriteFrame?this._applySpriteFrame():this._file&&(this._custom?!this._getTexture()&&this._applyFile():this._applyFile()),this.playOnLoad&&this.resetSystem()},n._flushAssembler=function(){var t=e.Assembler.getAssembler(this);this._assembler!==t&&(this._assembler=t),this._assembler&&this._assembler.createData&&(this._simulator.renderData=this._assembler.createData(this))},n.lateUpdate=function(t){this._simulator.finished||this._simulator.step(t)},n.addParticle=function(){},n.stopSystem=function(){this._stopped=!0,this._simulator.stop()},n.resetSystem=function(){this._stopped=!1,this._simulator.reset(),this._renderFlag=this._canRender()},n.isFull=function(){return this.particleCount>=this.totalParticles},n._applyFile=function(){var t=this._file;if(t){if(!t)return void b(6029);if(!this.isValid)return;this._plistFile=t.nativeUrl,this._custom||(this._spriteFrame!==t.spriteFrame&&(this.spriteFrame=t.spriteFrame),this._initWithDictionary(t._nativeAsset)),this._spriteFrame?!this._renderSpriteFrame&&this._spriteFrame&&this._applySpriteFrame():t.spriteFrame?this.spriteFrame=t.spriteFrame:this._custom&&this._initTextureWithDictionary(t._nativeAsset)}},n._initTextureWithDictionary=function(t){var e,n=this;if(t.spriteFrameUuid){var i=t.spriteFrameUuid;rL.loadAny(i,(function(e,i){e?(t.spriteFrameUuid=void 0,n._initTextureWithDictionary(t),d(e)):n.spriteFrame=i}))}else{var r=An(this._plistFile,t.textureFileName||"");if(t.textureFileName)rL.loadRemote(r,(function(e,i){e?(t.textureFileName=void 0,n._initTextureWithDictionary(t),d(e)):n.spriteFrame=i?uj.createWithImage(i):uj.createWithImage(Lg.get("white-texture"))}));else if(t.textureImageData){var a=t.textureImageData;if(!(a&&a.length>0))return!1;var o=rL.assets.get(r);if(!o){var s=cat.unzipBase64AsArray(a,1);if(!s)return E(6030,this._file.name),!1;var c=(e=s).length>8&&137===e[0]&&80===e[1]&&78===e[2]&&71===e[3]&&13===e[4]&&10===e[5]&&26===e[6]&&10===e[7]?sat.PNG:e.length>2&&(73===e[0]&&73===e[1]||77===e[0]&&77===e[1]||255===e[0]&&216===e[1])?sat.TIFF:sat.UNKNOWN;if(c!==sat.TIFF&&c!==sat.PNG)return E(6031,this._file.name),!1;var l=document.createElement("canvas");c===sat.PNG?new rit(s).render(l):(this._tiffReader||(this._tiffReader=new ait),this._tiffReader.parseTIFF(s,l)),o=new Dm(l),rL.assets.add(r,o)}o||E(6032,this._file.name),this.spriteFrame=o?uj.createWithImage(o):uj.createWithImage(Lg.get("white-texture"))}}return!0},n._initWithDictionary=function(t){this.totalParticles=parseInt(t.maxParticles||0),this.life=parseFloat(t.particleLifespan||0),this.lifeVar=parseFloat(t.particleLifespanVariance||0);var e=t.emissionRate;this.emissionRate=e||Math.min(this.totalParticles/this.life,Number.MAX_VALUE),this.duration=parseFloat(t.duration||0),this._srcBlendFactor=parseInt(t.blendFuncSource||Fr.SRC_ALPHA),this._dstBlendFactor=parseInt(t.blendFuncDestination||Fr.ONE_MINUS_SRC_ALPHA);var n=this._startColor;n.r=255*parseFloat(t.startColorRed||0),n.g=255*parseFloat(t.startColorGreen||0),n.b=255*parseFloat(t.startColorBlue||0),n.a=255*parseFloat(t.startColorAlpha||0);var i=this._startColorVar;i.r=255*parseFloat(t.startColorVarianceRed||0),i.g=255*parseFloat(t.startColorVarianceGreen||0),i.b=255*parseFloat(t.startColorVarianceBlue||0),i.a=255*parseFloat(t.startColorVarianceAlpha||0);var r=this._endColor;r.r=255*parseFloat(t.finishColorRed||0),r.g=255*parseFloat(t.finishColorGreen||0),r.b=255*parseFloat(t.finishColorBlue||0),r.a=255*parseFloat(t.finishColorAlpha||0);var a=this._endColorVar;if(a.r=255*parseFloat(t.finishColorVarianceRed||0),a.g=255*parseFloat(t.finishColorVarianceGreen||0),a.b=255*parseFloat(t.finishColorVarianceBlue||0),a.a=255*parseFloat(t.finishColorVarianceAlpha||0),this.startSize=parseFloat(t.startParticleSize||0),this.startSizeVar=parseFloat(t.startParticleSizeVariance||0),this.endSize=parseFloat(t.finishParticleSize||0),this.endSizeVar=parseFloat(t.finishParticleSizeVariance||0),this.positionType=parseFloat(void 0!==t.positionType?t.positionType:Wnt.FREE),this.sourcePos.set(0,0),this.posVar.set(parseFloat(t.sourcePositionVariancex||0),parseFloat(t.sourcePositionVariancey||0)),this.angle=parseFloat(t.angle||0),this.angleVar=parseFloat(t.angleVariance||0),this.startSpin=parseFloat(t.rotationStart||0),this.startSpinVar=parseFloat(t.rotationStartVariance||0),this.endSpin=parseFloat(t.rotationEnd||0),this.endSpinVar=parseFloat(t.rotationEndVariance||0),this.emitterMode=parseInt(t.emitterType||jnt.GRAVITY),this.emitterMode===jnt.GRAVITY){this.gravity.set(parseFloat(t.gravityx||0),parseFloat(t.gravityy||0)),this.speed=parseFloat(t.speed||0),this.speedVar=parseFloat(t.speedVariance||0),this.radialAccel=parseFloat(t.radialAcceleration||0),this.radialAccelVar=parseFloat(t.radialAccelVariance||0),this.tangentialAccel=parseFloat(t.tangentialAcceleration||0),this.tangentialAccelVar=parseFloat(t.tangentialAccelVariance||0);var o=t.rotationIsDir||"";null!==o?(o=o.toString().toLowerCase(),this.rotationIsDir="true"===o||"1"===o):this.rotationIsDir=!1}else{if(this.emitterMode!==jnt.RADIUS)return E(6009),!1;this.startRadius=parseFloat(t.maxRadius||0),this.startRadiusVar=parseFloat(t.maxRadiusVariance||0),this.endRadius=parseFloat(t.minRadius||0),this.endRadiusVar=parseFloat(t.minRadiusVariance||0),this.rotatePerS=parseFloat(t.rotatePerSecond||0),this.rotatePerSVar=parseFloat(t.rotatePerSecondVariance||0)}return this._initTextureWithDictionary(t),!0},n._syncAspect=function(){if(this._renderSpriteFrame){var t=this._renderSpriteFrame.rect;this.aspectRatio=t.width/t.height}},n._applySpriteFrame=function(){this._renderSpriteFrame=this._renderSpriteFrame||this._spriteFrame,this._renderSpriteFrame?this._renderSpriteFrame.texture&&(this._simulator.updateUVs(!0),this._syncAspect(),this._updateMaterial(),this._stopped=!1,this._renderFlag=this._canRender()):this.resetSystem()},n._getTexture=function(){return this._renderSpriteFrame&&this._renderSpriteFrame.texture},n._updateMaterial=function(){var t=this.getMaterialInstance(0);t&&t.recompileShaders({USE_LOCAL:this._positionType!==Wnt.FREE})},n._finishedSimulation=function(){this.resetSystem(),this.stopSystem(),this._renderFlag=this._canRender(),this.autoRemoveOnFinish&&this._stopped&&this.node.destroy()},n._canRender=function(){return t.prototype._canRender.call(this)&&!this._stopped&&null!==this._renderSpriteFrame},n._render=function(t){this._positionType===Wnt.RELATIVE?t.commitComp(this,this._simulator.renderData,this._renderSpriteFrame,this._assembler,this.node.parent):this.positionType===Wnt.GROUPED?t.commitComp(this,this._simulator.renderData,this._renderSpriteFrame,this._assembler,this.node):t.commitComp(this,this._simulator.renderData,this._renderSpriteFrame,this._assembler,null)},L(e,[{key:"custom",get:function(){return this._custom},set:function(t){this._custom!==t&&(this._custom=t,this._applyFile())}},{key:"file",get:function(){return this._file},set:function(t){this._file!==t&&(this._file=t,t?this._applyFile():this.custom=!0)}},{key:"spriteFrame",get:function(){return this._spriteFrame},set:function(t){this._renderSpriteFrame!==t&&(this._renderSpriteFrame=t,t&&!t._uuid||(this._spriteFrame=t),this._applySpriteFrame())}},{key:"particleCount",get:function(){return this._simulator.particles.length}},{key:"totalParticles",get:function(){return this._totalParticles},set:function(t){this._totalParticles!==t&&(this._totalParticles=t)}},{key:"startColor",get:function(){return this._startColor},set:function(t){this._startColor.r=t.r,this._startColor.g=t.g,this._startColor.b=t.b,this._startColor.a=t.a}},{key:"startColorVar",get:function(){return this._startColorVar},set:function(t){this._startColorVar.r=t.r,this._startColorVar.g=t.g,this._startColorVar.b=t.b,this._startColorVar.a=t.a}},{key:"color",get:function(){return this._color},set:function(){}},{key:"endColor",get:function(){return this._endColor},set:function(t){this._endColor.r=t.r,this._endColor.g=t.g,this._endColor.b=t.b,this._endColor.a=t.a}},{key:"endColorVar",get:function(){return this._endColorVar},set:function(t){this._endColorVar.r=t.r,this._endColorVar.g=t.g,this._endColorVar.b=t.b,this._endColorVar.a=t.a}},{key:"positionType",get:function(){return this._positionType},set:function(t){this._positionType=t,this._updateMaterial()}},{key:"preview",get:function(){return this._preview},set:function(t){t?this._startPreview():this._stopPreview(),this._preview=t}},{key:"stopped",get:function(){return this._stopped}},{key:"active",get:function(){return this._simulator.active}},{key:"assembler",get:function(){return this._assembler}}]),e}(Sq),aat.EmitterMode=jnt,aat.PositionType=Wnt,aat.DURATION_INFINITY=-1,aat.START_SIZE_EQUAL_TO_END_SIZE=-1,aat.START_RADIUS_EQUAL_TO_END_RADIUS=-1,q((drt=oat).prototype,"custom",[yl,dit,mit],Object.getOwnPropertyDescriptor(drt.prototype,"custom"),drt.prototype),q(drt.prototype,"file",[git,vit,yit],Object.getOwnPropertyDescriptor(drt.prototype,"file"),drt.prototype),q(drt.prototype,"spriteFrame",[xit,Sit],Object.getOwnPropertyDescriptor(drt.prototype,"spriteFrame"),drt.prototype),q(drt.prototype,"totalParticles",[yl,Tit],Object.getOwnPropertyDescriptor(drt.prototype,"totalParticles"),drt.prototype),mrt=q(drt.prototype,"duration",[cl,yl,Ait],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),grt=q(drt.prototype,"emissionRate",[cl,yl,Eit],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),vrt=q(drt.prototype,"life",[cl,yl,Cit],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),yrt=q(drt.prototype,"lifeVar",[cl,yl,bit],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),q(drt.prototype,"startColor",[yl,wit],Object.getOwnPropertyDescriptor(drt.prototype,"startColor"),drt.prototype),q(drt.prototype,"startColorVar",[yl,Pit],Object.getOwnPropertyDescriptor(drt.prototype,"startColorVar"),drt.prototype),q(drt.prototype,"color",[Iit],Object.getOwnPropertyDescriptor(drt.prototype,"color"),drt.prototype),q(drt.prototype,"endColor",[yl,Rit],Object.getOwnPropertyDescriptor(drt.prototype,"endColor"),drt.prototype),q(drt.prototype,"endColorVar",[yl,Dit],Object.getOwnPropertyDescriptor(drt.prototype,"endColorVar"),drt.prototype),xrt=q(drt.prototype,"angle",[cl,yl,Oit],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 90}}),Srt=q(drt.prototype,"angleVar",[cl,yl,Mit],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),Trt=q(drt.prototype,"startSize",[cl,yl,Nit],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),Art=q(drt.prototype,"startSizeVar",[cl,yl,Lit],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Ert=q(drt.prototype,"endSize",[cl,yl,Bit],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Crt=q(drt.prototype,"endSizeVar",[cl,yl,Fit],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),brt=q(drt.prototype,"startSpin",[cl,yl,zit],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),wrt=q(drt.prototype,"startSpinVar",[cl,yl,Uit],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Prt=q(drt.prototype,"endSpin",[cl,yl,kit],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Irt=q(drt.prototype,"endSpinVar",[cl,yl,Git],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Rrt=q(drt.prototype,"sourcePos",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ni.ZERO.clone()}}),Drt=q(drt.prototype,"posVar",[cl,yl,Hit],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ni.ZERO.clone()}}),q(drt.prototype,"positionType",[Vit,jit],Object.getOwnPropertyDescriptor(drt.prototype,"positionType"),drt.prototype),q(drt.prototype,"preview",[yl,Wit,Xit],Object.getOwnPropertyDescriptor(drt.prototype,"preview"),drt.prototype),Ort=q(drt.prototype,"emitterMode",[cl,yl,qit,Yit],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return jnt.GRAVITY}}),Mrt=q(drt.prototype,"gravity",[cl,yl,Kit],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ni.ZERO.clone()}}),Nrt=q(drt.prototype,"speed",[cl,yl,Qit],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 180}}),Lrt=q(drt.prototype,"speedVar",[cl,yl,Zit],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),Brt=q(drt.prototype,"tangentialAccel",[cl,yl,Jit],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 80}}),Frt=q(drt.prototype,"tangentialAccelVar",[cl,yl,$it],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),zrt=q(drt.prototype,"radialAccel",[cl,yl,trt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Urt=q(drt.prototype,"radialAccelVar",[cl,yl,ert],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),krt=q(drt.prototype,"rotationIsDir",[cl,yl,nrt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Grt=q(drt.prototype,"startRadius",[cl,yl,irt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Hrt=q(drt.prototype,"startRadiusVar",[cl,yl,rrt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Vrt=q(drt.prototype,"endRadius",[cl,yl,art],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),jrt=q(drt.prototype,"endRadiusVar",[cl,yl,ort],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Wrt=q(drt.prototype,"rotatePerS",[cl,yl,srt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Xrt=q(drt.prototype,"rotatePerSVar",[cl,yl,crt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),qrt=q(drt.prototype,"playOnLoad",[cl,yl,lrt,urt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Yrt=q(drt.prototype,"autoRemoveOnFinish",[cl,yl,hrt,frt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Krt=q(drt.prototype,"_preview",[_rt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Qrt=q(drt.prototype,"_custom",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Zrt=q(drt.prototype,"_file",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Jrt=q(drt.prototype,"_spriteFrame",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$rt=q(drt.prototype,"_totalParticles",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),tat=q(drt.prototype,"_startColor",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new _i(255,255,255,255)}}),eat=q(drt.prototype,"_startColorVar",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new _i(0,0,0,0)}}),nat=q(drt.prototype,"_endColor",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new _i(255,255,255,0)}}),iat=q(drt.prototype,"_endColorVar",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new _i(0,0,0,0)}}),rat=q(drt.prototype,"_positionType",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Wnt.FREE}}),prt=drt))||prt)||prt)||prt)||prt)),Cat=function(){function t(t,e){this.point=new Ni,this.dir=new Ni,this.distance=0,this.time=0,t&&this.point.set(t),e&&this.dir.set(e)}var e=t.prototype;return e.setPoint=function(t,e){this.point.x=t,this.point.y=e},e.setDir=function(t,e){this.dir.x=t,this.dir.y=e},t}(),bat=t("MotionStreak",(uat=nl("cc.MotionStreak"),hat=pl(),fat=vl(),_at=Bl(ng),uat(pat=_l(pat=dl(pat=hat(pat=fat((Aat=Tat=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return X(e=t.call.apply(t,[this].concat(i))||this,"_preview",mat,V(e)),X(e,"_fadeTime",gat,V(e)),X(e,"_minSeg",vat,V(e)),X(e,"_stroke",yat,V(e)),X(e,"_texture",xat,V(e)),X(e,"_fastMode",Sat,V(e)),e._points=[],e}F(e,t);var n=e.prototype;return n.onEnable=function(){t.prototype.onEnable.call(this),this.reset()},n._flushAssembler=function(){var t=e.Assembler.getAssembler(this);this._assembler!==t&&(this._assembler=t),this._renderData||this._assembler&&this._assembler.createData&&(this._renderData=this._assembler.createData(this),this._renderData.material=this.material)},n.onFocusInEditor=function(){this._preview&&this.reset()},n.onLostFocusInEditor=function(){this._preview&&this.reset()},n.reset=function(){this._points.length=0,this._renderData&&this._renderData.clear()},n.lateUpdate=function(t){this._assembler&&this._assembler.update(this,t)},n._render=function(t){t.commitComp(this,this.renderData,this._texture,this._assembler,null)},L(e,[{key:"preview",get:function(){return this._preview},set:function(t){this._preview=t,this.reset()}},{key:"fadeTime",get:function(){return this._fadeTime},set:function(t){this._fadeTime=t,this.reset()}},{key:"minSeg",get:function(){return this._minSeg},set:function(t){this._minSeg=t}},{key:"stroke",get:function(){return this._stroke},set:function(t){this._stroke=t}},{key:"texture",get:function(){return this._texture},set:function(t){this._texture!==t&&(this._texture=t)}},{key:"fastMode",get:function(){return this._fastMode},set:function(t){this._fastMode=t}},{key:"points",get:function(){return this._points}}]),e}(Sq),Tat.Point=Cat,q((dat=Aat).prototype,"preview",[yl],Object.getOwnPropertyDescriptor(dat.prototype,"preview"),dat.prototype),q(dat.prototype,"fadeTime",[yl],Object.getOwnPropertyDescriptor(dat.prototype,"fadeTime"),dat.prototype),q(dat.prototype,"minSeg",[yl],Object.getOwnPropertyDescriptor(dat.prototype,"minSeg"),dat.prototype),q(dat.prototype,"stroke",[yl],Object.getOwnPropertyDescriptor(dat.prototype,"stroke"),dat.prototype),q(dat.prototype,"texture",[_at],Object.getOwnPropertyDescriptor(dat.prototype,"texture"),dat.prototype),q(dat.prototype,"fastMode",[yl],Object.getOwnPropertyDescriptor(dat.prototype,"fastMode"),dat.prototype),mat=q(dat.prototype,"_preview",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),gat=q(dat.prototype,"_fadeTime",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),vat=q(dat.prototype,"_minSeg",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),yat=q(dat.prototype,"_stroke",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 64}}),xat=q(dat.prototype,"_texture",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Sat=q(dat.prototype,"_fastMode",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),pat=dat))||pat)||pat)||pat)||pat)||pat)),wat=(new Ni,new Ni),Pat=new Ni;function Iat(t,e){return t.x=-e.y,t.y=e.x,t}var Rat={createData:function(t){var e=t.requestRenderData();return e.dataLength=4,e.resize(16,42),e},update:function(t,e){var n,i=t.stroke/2,r=t.node.worldMatrix,a=r.m12,o=r.m13,s=t.points;if(s.length>1){var c=s[0],l=c.point.x-a,u=c.point.y-o;l*l+u*u<t.minSeg&&(n=c)}n||(n=new bat.Point,s.unshift(n)),n.setPoint(a,o),n.time=t.fadeTime+e;var h,f=0;if(!(s.length<2)){var _=t.renderData;this.updateRenderDataCache(t,_);var p=t.color,d=p.r,m=p.g,g=p.b,v=p.a,y=s[1];y.distance=Ni.subtract(Pat,n.point,y.point).length(),Pat.normalize(),y.setDir(Pat.x,Pat.y),n.setDir(Pat.x,Pat.y),_.dataLength=2*s.length;for(var x=_.data,S=t.fadeTime,T=!1,A=s.length-1;A>=0;A--){var E=s[A],C=E.point,b=E.dir;if(E.time-=e,E.time<0)s.splice(A,1);else{var w=E.time/S,P=s[A-1];if(!T){if(!P){s.splice(A,1);continue}C.x=P.point.x-b.x*w,C.y=P.point.y-b.y*w}T=!0,Iat(wat,b);var I=(w*v<<24>>>0)+(g<<16)+(m<<8)+d,R=f;x[R].x=C.x+wat.x*i,x[R].y=C.y+wat.y*i,x[R].u=1,x[R].v=w,x[R].color._val=I,x[R+=1].x=C.x-wat.x*i,x[R].y=C.y-wat.y*i,x[R].u=0,x[R].v=w,x[R].color._val=I,f+=2}}h=f<=2?0:3*(f-2),_.resize(f,h)}},updateRenderDataCache:function(t,e){e.passDirty&&e.updatePass(t),e.nodeDirty&&e.updateNode(t),e.textureDirty&&t.texture&&(e.updateTexture(t.texture),e.material=t.getRenderMaterial(0)),e.hashDirty&&e.updateHash()},updateRenderData:function(){},updateColor:function(){},fillBuffers:function(t){for(var e=t.renderData,n=e.chunk,i=e.data,r=e.vertexCount,a=e.indexCount,o=n.vb,s=0,c=0;c<r;c++){var l=i[c];o[s++]=l.x,o[s++]=l.y,o[s++]=l.z,o[s++]=l.u,o[s++]=l.v,_i.toArray(o,l.color,s),s+=4}for(var u=n.bufferId,h=n.vertexOffset,f=n.vertexAccessor.getMeshBuffer(n.bufferId),_=n.vertexAccessor.getIndexBuffer(u),p=f.indexOffset,d=0,m=a;d<m;d+=2){var g=h+d;_[p++]=g,_[p++]=g+2,_[p++]=g+1,_[p++]=g+1,_[p++]=g+2,_[p++]=g+3}f.indexOffset+=e.indexCount,f.setDirty()}},Dat=t("MotionStreakAssemblerManager",{getAssembler:function(){return Rat}});bat.Assembler=Dat;var Oat,Mat,Nat,Lat={maxParticleDeltaTime:0,createData:function(){return PW.add()},removeData:function(t){PW.remove(t)},updateRenderData:function(){},fillBuffers:function(){}},Bat=t("ParticleSystem2DAssembler",{getAssembler:function(){return Lat.maxParticleDeltaTime||(Lat.maxParticleDeltaTime=i.game.frameTime/1e3*2),Lat}});Eat.Assembler=Bat,function(t){t.PLAYED="play",t.PAUSED="pause",t.STOPPED="stop",t.SEEKED="seeked",t.ENDED="ended",t.INTERRUPTION_BEGIN="interruptionBegin",t.INTERRUPTION_END="interruptionEnd",t.USER_GESTURE="on_gesture"}(Oat||(Oat={})),function(t){t[t.DOM_AUDIO=0]="DOM_AUDIO",t[t.WEB_AUDIO=1]="WEB_AUDIO",t[t.MINIGAME_AUDIO=2]="MINIGAME_AUDIO",t[t.NATIVE_AUDIO=3]="NATIVE_AUDIO",t[t.UNKNOWN_AUDIO=4]="UNKNOWN_AUDIO"}(Mat||(Mat={})),function(t){t[t.INIT=0]="INIT",t[t.PLAYING=1]="PLAYING",t[t.PAUSED=2]="PAUSED",t[t.STOPPED=3]="STOPPED",t[t.INTERRUPTED=4]="INTERRUPTED"}(Nat||(Nat={}));var Fat,zat=0;function Uat(t,e){var n;e.invoking||(e.invoking=!0,(n=e.func).call.apply(n,[t].concat(e.args)).then((function(){e.invoking=!1,t._operationQueue.shift(),t._eventTarget.emit(e.id.toString());var n=t._operationQueue[0];n&&Uat(t,n)})).catch((function(){})))}function kat(t,e,n){var i=n.value;n.value=function(){for(var t=this,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return new Promise((function(e){var r=zat++,a=t;a._operationQueue.push({id:r,func:i,args:n,invoking:!1}),a._eventTarget.once(r.toString(),e),Uat(a,a._operationQueue[0])}))}}function Gat(t){return new Promise((function(e){var n=t.play();return void 0===n?e():(n.then(e).catch((function(){var n=function(){t.play().catch((function(){})),e()},i=document.getElementById("GameCanvas");null==i||i.addEventListener("touchend",n,{once:!0}),null==i||i.addEventListener("mousedown",n,{once:!0})})),null)}))}var Hat,Vat,jat=function(){function t(t,e){this._domAudio=void 0,this._onPlayCb=void 0,this._onEndCb=void 0,this._domAudio=t,t.volume=e}var e=t.prototype;return e.play=function(){var t=this;Gat(this._domAudio).then((function(){var e;null===(e=t.onPlay)||void 0===e||e.call(t)})).catch((function(){}))},e.stop=function(){this._domAudio.pause()},L(t,[{key:"onPlay",get:function(){return this._onPlayCb},set:function(t){this._onPlayCb=t}},{key:"onEnd",get:function(){return this._onEndCb},set:function(t){this._onEndCb&&this._domAudio.removeEventListener("ended",this._onEndCb),this._onEndCb=t,t&&this._domAudio.addEventListener("ended",t)}}]),t}(),Wat=(q((Fat=function(){function t(t){var e=this;this._domAudio=void 0,this._state=Nat.INIT,this._onEnded=void 0,this._eventTarget=new fn,this._operationQueue=[],this._domAudio=t,_n.on("hide",this._onHide,this),_n.on("show",this._onShow,this),this._onEnded=function(){e.seek(0).catch((function(){})),e._state=Nat.INIT,e._eventTarget.emit(Oat.ENDED)},this._domAudio.addEventListener("ended",this._onEnded)}var e=t.prototype;return e.destroy=function(){_n.off("hide",this._onHide,this),_n.off("show",this._onShow,this),this._domAudio.removeEventListener("ended",this._onEnded),this._domAudio=null},t.load=function(e){return new Promise((function(n){t.loadNative(e).then((function(e){n(new t(e))})).catch((function(){}))}))},t.loadNative=function(t){return new Promise((function(e,n){var i=document.createElement("audio"),r="canplaythrough";_n.os===ln.IOS?r="loadedmetadata":_n.browserType===on.FIREFOX&&(r="canplay");var a=setTimeout((function(){0===i.readyState?c():s()}),8e3),o=function(){clearTimeout(a),i.removeEventListener(r,s,!1),i.removeEventListener("error",c,!1)},s=function(){o(),e(i)},c=function(){o(),n("load audio failure - "+t)};i.addEventListener(r,s,!1),i.addEventListener("error",c,!1),i.src=t}))},t.loadOneShotAudio=function(e,n){return new Promise((function(i,r){t.loadNative(e).then((function(t){var e=new jat(t,n);i(e)})).catch(r)}))},e._onHide=function(){var t=this;this._state===Nat.PLAYING&&this.pause().then((function(){t._state=Nat.INTERRUPTED,t._eventTarget.emit(Oat.INTERRUPTION_BEGIN)})).catch((function(){}))},e._onShow=function(){var t=this;this._state===Nat.INTERRUPTED&&this.play().then((function(){t._eventTarget.emit(Oat.INTERRUPTION_END)})).catch((function(){}))},e.seek=function(t){return t=Yn(t,0,this.duration),this._domAudio.currentTime=t,Promise.resolve()},e.play=function(){var t=this;return new Promise((function(e){Gat(t._domAudio).then((function(){t._state=Nat.PLAYING,e()})).catch((function(){}))}))},e.pause=function(){return this._domAudio.pause(),this._state=Nat.PAUSED,Promise.resolve()},e.stop=function(){var t=this;return new Promise((function(e){t._domAudio.pause(),t._domAudio.currentTime=0,t._state=Nat.STOPPED,e()}))},e.onInterruptionBegin=function(t){this._eventTarget.on(Oat.INTERRUPTION_BEGIN,t)},e.offInterruptionBegin=function(t){this._eventTarget.off(Oat.INTERRUPTION_BEGIN,t)},e.onInterruptionEnd=function(t){this._eventTarget.on(Oat.INTERRUPTION_END,t)},e.offInterruptionEnd=function(t){this._eventTarget.off(Oat.INTERRUPTION_END,t)},e.onEnded=function(t){this._eventTarget.on(Oat.ENDED,t)},e.offEnded=function(t){this._eventTarget.off(Oat.ENDED,t)},L(t,[{key:"src",get:function(){return this._domAudio?this._domAudio.src:""}},{key:"type",get:function(){return Mat.DOM_AUDIO}},{key:"state",get:function(){return this._state}},{key:"loop",get:function(){return this._domAudio.loop},set:function(t){this._domAudio.loop=t}},{key:"volume",get:function(){return this._domAudio.volume},set:function(t){t=Kn(t),this._domAudio.volume=t}},{key:"duration",get:function(){return this._domAudio.duration}},{key:"currentTime",get:function(){return this._domAudio.currentTime}}]),t}()).prototype,"seek",[kat],Object.getOwnPropertyDescriptor(Fat.prototype,"seek"),Fat.prototype),q(Fat.prototype,"play",[kat],Object.getOwnPropertyDescriptor(Fat.prototype,"play"),Fat.prototype),q(Fat.prototype,"pause",[kat],Object.getOwnPropertyDescriptor(Fat.prototype,"pause"),Fat.prototype),q(Fat.prototype,"stop",[kat],Object.getOwnPropertyDescriptor(Fat.prototype,"stop"),Fat.prototype),Fat),Xat=function(){function t(t){this._nativeAudio=void 0,this._startTime=0,this._startOffset=0,this._isPaused=!0,this._nativeAudio=t}var e=t.prototype;return e.destroy=function(){this._nativeAudio=void 0},e._now=function(){return performance.now()/1e3},e._calculateCurrentTime=function(){var t=this._now()-this._startTime,e=this._startOffset+t;return e>=this.duration&&(this._startTime=this._now(),this._startOffset=0),e%this.duration},e.start=function(){this._isPaused=!1,this._startTime=this._now()},e.pause=function(){this._isPaused||(this._isPaused=!0,this._startOffset=this._calculateCurrentTime())},e.stop=function(){this._isPaused=!0,this._startOffset=0},e.seek=function(t){this._startTime=this._now(),this._startOffset=Yn(t,0,this.duration)},L(t,[{key:"duration",get:function(){return this._nativeAudio.duration}},{key:"currentTime",get:function(){return this._isPaused?this._startOffset:this._calculateCurrentTime()}}]),t}(),qat=new(function(){function t(){this._audioBufferDataMap={}}var e=t.prototype;return e.addCache=function(t,e){this._audioBufferDataMap[t]?console.warn("Audio buffer "+t+" has been cached"):this._audioBufferDataMap[t]={usedCount:1,audioBuffer:e}},e.retainCache=function(t){var e=this._audioBufferDataMap[t];e?e.usedCount++:console.warn("Audio buffer cache "+t+" has not been added.")},e.getCache=function(t){var e=this._audioBufferDataMap[t];return null==e?void 0:e.audioBuffer},e.tryReleasingCache=function(t){var e=this._audioBufferDataMap[t];e?--e.usedCount<=0&&delete this._audioBufferDataMap[t]:console.warn("Audio buffer cache "+t+" has not been added.")},t}()),Yat=window.AudioContext||window.webkitAudioContext||window.mozAudioContext,Kat=function(){function t(){this._context=void 0,this._context=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext)}var e=t.prototype;return e.decodeAudioData=function(t){var e=this;return new Promise((function(n){var i=e._context.decodeAudioData(t,(function(t){n(t)}),(function(t){console.error("failed to load Web Audio",t)}));null==i||i.catch((function(){}))}))},e.runContext=function(){var t=this;return new Promise((function(e){var n=t._context;if(n.resume)if("running"!==n.state){var i=document.getElementById("GameCanvas"),r=function(){n.resume().then(e).catch((function(){}))};null==i||i.addEventListener("touchend",r,{once:!0,capture:!0}),null==i||i.addEventListener("mouseup",r,{once:!0,capture:!0})}else e();else e()}))},e.createBufferSource=function(t,e){var n=this._context.createBufferSource();return void 0!==t&&(n.buffer=t),void 0!==e&&(n.loop=e),n},e.createGain=function(t){void 0===t&&(t=1);var e=this._context.createGain();return this.setGainValue(e,t),e},e.setGainValue=function(t,e){if(t.gain.setTargetAtTime)try{t.gain.setTargetAtTime(e,this._context.currentTime,0)}catch(n){t.gain.setTargetAtTime(e,this._context.currentTime,.01)}else t.gain.value=e},e.connectContext=function(t){this._context&&t.connect(this._context.destination)},L(t,[{key:"currentTime",get:function(){return this._context.currentTime}}]),t}();Kat.support=!!Yat,Kat.support&&(Vat=new Kat);var Qat,Zat,Jat,$at,tot,eot=function(){function t(t,e,n){this._duration=void 0,this._bufferSourceNode=void 0,this._onPlayCb=void 0,this._currentTimer=0,this._url=void 0,this._onEndCb=void 0,this._duration=t.duration,this._url=n,this._bufferSourceNode=Vat.createBufferSource(t,!1);var i=Vat.createGain(e);this._bufferSourceNode.connect(i),Vat.connectContext(i)}var e=t.prototype;return e.play=function(){var t=this;this._bufferSourceNode.start(),Vat.runContext().then((function(){var e;null===(e=t.onPlay)||void 0===e||e.call(t),t._currentTimer=window.setTimeout((function(){var e;qat.tryReleasingCache(t._url),null===(e=t.onEnd)||void 0===e||e.call(t)}),1e3*t._duration)})).catch((function(){}))},e.stop=function(){clearTimeout(this._currentTimer),qat.tryReleasingCache(this._url),this._bufferSourceNode.stop(),this._bufferSourceNode.buffer=null},L(t,[{key:"onPlay",get:function(){return this._onPlayCb},set:function(t){this._onPlayCb=t}},{key:"onEnd",get:function(){return this._onEndCb},set:function(t){this._onEndCb=t}}]),t}(),not=(q((Hat=function(){function t(t,e){this._src=void 0,this._audioBuffer=void 0,this._sourceNode=void 0,this._gainNode=void 0,this._currentTimer=0,this._volume=1,this._loop=!1,this._state=Nat.INIT,this._audioTimer=void 0,this._eventTarget=new fn,this._operationQueue=[],this._audioBuffer=t,this._audioTimer=new Xat(t),this._gainNode=Vat.createGain(),Vat.connectContext(this._gainNode),this._src=e,_n.on("hide",this._onHide,this),_n.on("show",this._onShow,this)}var e=t.prototype;return e.destroy=function(){this._audioTimer.destroy(),this._audioBuffer&&(this._audioBuffer=null),qat.tryReleasingCache(this._src),_n.off("hide",this._onHide,this),_n.off("show",this._onShow,this)},t.load=function(e){return new Promise((function(n){t.loadNative(e).then((function(i){n(new t(i,e))})).catch((function(){}))}))},t.loadNative=function(t){return new Promise((function(e,n){var i=qat.getCache(t);if(i)return qat.retainCache(t),void e(i);var r=new XMLHttpRequest,a="load audio failed: "+t+", status: ";r.open("GET",t,!0),r.responseType="arraybuffer",r.onload=function(){200===r.status||0===r.status?Vat.decodeAudioData(r.response).then((function(n){qat.addCache(t,n),e(n)})).catch((function(){})):n(new Error(""+a+r.status+"(no response)"))},r.onerror=function(){n(new Error(""+a+r.status+"(error)"))},r.ontimeout=function(){n(new Error(""+a+r.status+"(time out)"))},r.onabort=function(){n(new Error(""+a+r.status+"(abort)"))},r.send(null)}))},t.loadOneShotAudio=function(e,n){return new Promise((function(i,r){t.loadNative(e).then((function(t){var r=new eot(t,n,e);i(r)})).catch(r)}))},e._onHide=function(){var t=this;this._state===Nat.PLAYING&&this.pause().then((function(){t._state=Nat.INTERRUPTED,t._eventTarget.emit(Oat.INTERRUPTION_BEGIN)})).catch((function(){}))},e._onShow=function(){var t=this;this._state===Nat.INTERRUPTED&&this.play().then((function(){t._eventTarget.emit(Oat.INTERRUPTION_END)})).catch((function(){}))},e.seek=function(t){var e=this;return new Promise((function(n){e._audioTimer.seek(t),e._state===Nat.PLAYING?e._doPlay().then(n).catch((function(){})):n()}))},e.play=function(){return this._doPlay()},e._doPlay=function(){var t=this;return new Promise((function(e){t._stopSourceNode(),t._sourceNode=Vat.createBufferSource(t._audioBuffer,t.loop),t._sourceNode.connect(t._gainNode),t._sourceNode.start(0,t._audioTimer.currentTime),Vat.runContext().then((function(){t._state=Nat.PLAYING,t._audioTimer.start(),window.clearTimeout(t._currentTimer),t._currentTimer=window.setTimeout((function e(){t.loop?t._currentTimer=window.setTimeout(e,1e3*t._audioBuffer.duration):(t._audioTimer.stop(),t._eventTarget.emit(Oat.ENDED),t._state=Nat.INIT)}),1e3*(t._audioBuffer.duration-t._audioTimer.currentTime)),e()})).catch((function(){}))}))},e._stopSourceNode=function(){try{this._sourceNode&&(this._sourceNode.stop(),this._sourceNode.buffer=null)}catch(t){}},e.pause=function(){return this._state===Nat.PLAYING&&this._sourceNode?(this._audioTimer.pause(),this._state=Nat.PAUSED,window.clearTimeout(this._currentTimer),this._stopSourceNode(),Promise.resolve()):Promise.resolve()},e.stop=function(){return this._sourceNode?(this._audioTimer.stop(),this._state=Nat.STOPPED,window.clearTimeout(this._currentTimer),this._stopSourceNode(),Promise.resolve()):Promise.resolve()},e.onInterruptionBegin=function(t){this._eventTarget.on(Oat.INTERRUPTION_BEGIN,t)},e.offInterruptionBegin=function(t){this._eventTarget.off(Oat.INTERRUPTION_BEGIN,t)},e.onInterruptionEnd=function(t){this._eventTarget.on(Oat.INTERRUPTION_END,t)},e.offInterruptionEnd=function(t){this._eventTarget.off(Oat.INTERRUPTION_END,t)},e.onEnded=function(t){this._eventTarget.on(Oat.ENDED,t)},e.offEnded=function(t){this._eventTarget.off(Oat.ENDED,t)},L(t,[{key:"src",get:function(){return this._src}},{key:"type",get:function(){return Mat.WEB_AUDIO}},{key:"state",get:function(){return this._state}},{key:"loop",get:function(){return this._loop},set:function(t){this._loop=t,this._sourceNode&&(this._sourceNode.loop=t)}},{key:"volume",get:function(){return this._volume},set:function(t){t=Kn(t),this._volume=t,Vat.setGainValue(this._gainNode,t)}},{key:"duration",get:function(){return this._audioBuffer.duration}},{key:"currentTime",get:function(){return this._audioTimer.currentTime}}]),t}()).prototype,"seek",[kat],Object.getOwnPropertyDescriptor(Hat.prototype,"seek"),Hat.prototype),q(Hat.prototype,"play",[kat],Object.getOwnPropertyDescriptor(Hat.prototype,"play"),Hat.prototype),q(Hat.prototype,"pause",[kat],Object.getOwnPropertyDescriptor(Hat.prototype,"pause"),Hat.prototype),q(Hat.prototype,"stop",[kat],Object.getOwnPropertyDescriptor(Hat.prototype,"stop"),Hat.prototype),Hat),iot=function(){function t(t){this._audio=void 0,this._audio=t}var e=t.prototype;return e.play=function(){this._audio.play()},e.stop=function(){this._audio.stop()},L(t,[{key:"onPlay",get:function(){return this._audio.onPlay},set:function(t){this._audio.onPlay=t}},{key:"onEnd",get:function(){return this._audio.onEnd},set:function(t){this._audio.onEnd=t}}]),t}(),rot=function(){function t(t){this._player=void 0,this._player=t}t.load=function(e,n){return new Promise((function(i){(null==n?void 0:n.audioLoadMode)!==Mat.DOM_AUDIO&&Kat.support?not.load(e).then((function(e){i(new t(e))})).catch((function(){})):(Kat.support||E(5201),Wat.load(e).then((function(e){i(new t(e))})).catch((function(){})))}))};var e=t.prototype;return e.destroy=function(){this._player.destroy()},t.loadNative=function(t,e){return(null==e?void 0:e.audioLoadMode)!==Mat.DOM_AUDIO&&Kat.support?not.loadNative(t):(Kat.support||E(5201),Wat.loadNative(t))},t.loadOneShotAudio=function(t,e,n){return new Promise((function(i,r){(null==n?void 0:n.audioLoadMode)!==Mat.DOM_AUDIO&&Kat.support?not.loadOneShotAudio(t,e).then((function(t){i(new iot(t))})).catch(r):(Kat.support||E(5201),Wat.loadOneShotAudio(t,e).then((function(t){i(new iot(t))})).catch(r))}))},e.seek=function(t){return this._player.seek(t)},e.play=function(){return this._player.play()},e.pause=function(){return this._player.pause()},e.stop=function(){return this._player.stop()},e.onInterruptionBegin=function(t){this._player.onInterruptionBegin(t)},e.offInterruptionBegin=function(t){this._player.offInterruptionBegin(t)},e.onInterruptionEnd=function(t){this._player.onInterruptionEnd(t)},e.offInterruptionEnd=function(t){this._player.offInterruptionEnd(t)},e.onEnded=function(t){this._player.onEnded(t)},e.offEnded=function(t){this._player.offEnded(t)},L(t,[{key:"src",get:function(){return this._player.src}},{key:"type",get:function(){return this._player.type}},{key:"state",get:function(){return this._player.state}},{key:"loop",get:function(){return this._player.loop},set:function(t){this._player.loop=t}},{key:"volume",get:function(){return this._player.volume},set:function(t){this._player.volume=t}},{key:"duration",get:function(){return this._player.duration}},{key:"currentTime",get:function(){return this._player.currentTime}}]),t}();rot.maxAudioChannel=24;var aot=t("AudioClip",nl("cc.AudioClip")((tot=$at=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return X(e=t.call.apply(t,[this].concat(i))||this,"_duration",Jat,V(e)),e._loadMode=Mat.UNKNOWN_AUDIO,e._meta=null,e._player=null,e}F(e,t);var n=e.prototype;return n.destroy=function(){var e,n=t.prototype.destroy.call(this);return null===(e=this._player)||void 0===e||e.destroy(),this._player=null,this._meta&&(this._meta.player=null),n},n.validate=function(){return!!this._meta},n.getDuration=function(){return this._duration?this._duration:this._meta?this._meta.duration:0},n.getCurrentTime=function(){return this._player?this._player.currentTime:0},n.getVolume=function(){return this._player?this._player.volume:0},n.getLoop=function(){return!!this._player&&this._player.loop},n.setCurrentTime=function(t){var e;null===(e=this._player)||void 0===e||e.seek(t).catch((function(){}))},n.setVolume=function(t){this._player&&(this._player.volume=t)},n.setLoop=function(t){this._player&&(this._player.loop=t)},n.play=function(){var t;null===(t=this._player)||void 0===t||t.play().catch((function(){}))},n.pause=function(){var t;null===(t=this._player)||void 0===t||t.pause().catch((function(){}))},n.stop=function(){var t;null===(t=this._player)||void 0===t||t.stop().catch((function(){}))},n.playOneShot=function(t){void 0===t&&(t=1),this._nativeAsset&&rot.loadOneShotAudio(this._nativeAsset.url,t).then((function(t){t.play()})).catch((function(){}))},L(e,[{key:"_nativeAsset",get:function(){return this._meta},set:function(t){this._meta=t,t?(this._loadMode=t.type,this._player=t.player):(this._meta=null,this._loadMode=Mat.UNKNOWN_AUDIO,this._duration=0)}},{key:"_nativeDep",get:function(){return{uuid:this._uuid,audioLoadMode:this.loadMode,ext:this._native,__isNative__:!0}}},{key:"loadMode",get:function(){return this._loadMode}},{key:"state",get:function(){return this._player?this._player.state:Nat.INIT}}]),e}(Ou),$at.AudioType=Mat,Jat=q((Zat=tot).prototype,"_duration",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),q(Zat.prototype,"_nativeDep",[Xl],Object.getOwnPropertyDescriptor(Zat.prototype,"_nativeDep"),Zat.prototype),Qat=Zat))||Qat);function oot(t,e,n){rot.load(t,{audioLoadMode:e.audioLoadMode}).then((function(e){var i={player:e,url:t,duration:e.duration,type:e.type};n(null,i)})).catch((function(t){n(t)}))}function sot(t,e,n,i){var r=new aot;r._nativeUrl=t,r._nativeAsset=e,r._duration=e.duration,i(null,r)}i.AudioClip=aot,LN.register({".mp3":oot,".ogg":oot,".wav":oot,".m4a":oot}),HN.register({".mp3":sot,".ogg":sot,".wav":sot,".m4a":sot});var cot,lot,uot,hot,fot,_ot,pot,dot,mot,got,vot,yot,xot,Sot,Tot,Aot,Eot,Cot,bot,wot=new(function(){function t(){this._oneShotAudioInfoList=[],this._audioPlayerInfoList=[]}var e=t.prototype;return e._findIndex=function(t,e){return t.findIndex((function(t){return t.audio===e}))},e._tryAddPlaying=function(t,e){var n=this._findIndex(t,e);return n>-1?(t[n].playTime=performance.now(),!1):(t.push({audio:e,playTime:performance.now()}),!0)},e.addPlaying=function(t){if(t instanceof rot){if(this._tryAddPlaying(this._audioPlayerInfoList,t))return}else this._tryAddPlaying(this._oneShotAudioInfoList,t)},e._tryRemovePlaying=function(t,e){var n=this._findIndex(t,e);return-1!==n&&(Q(t,n),!0)},e.removePlaying=function(t){if(t instanceof rot){if(this._tryRemovePlaying(this._audioPlayerInfoList,t))return}else this._tryRemovePlaying(this._oneShotAudioInfoList,t)},e.discardOnePlayingIfNeeded=function(){var t;this._audioPlayerInfoList.length+this._oneShotAudioInfoList.length<rot.maxAudioChannel||(this._oneShotAudioInfoList.length>0?this._oneShotAudioInfoList.forEach((function(e){(!t||e.playTime<t.playTime)&&(t=e)})):this._audioPlayerInfoList.forEach((function(e){(!t||e.playTime<t.playTime)&&(t=e)})),t&&(t.audio.stop(),this.removePlaying(t.audio)))},t}());!function(t){t.STARTED="started",t.ENDED="ended"}(bot||(bot={}));var Pot,Iot,Rot,Dot,Oot=function(e){return t({AudioSource:e,AudioSourceComponent:e}),e}((cot=nl("cc.AudioSource"),lot=vl(),uot=pl(),hot=Bl(aot),fot=Bl(aot),_ot=Al(),pot=Al(),dot=Al(),mot=El(),got=Al(),cot(vot=lot(vot=uot((Cot=Eot=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return X(e=t.call.apply(t,[this].concat(i))||this,"_clip",xot,V(e)),e._player=null,X(e,"_loop",Sot,V(e)),X(e,"_playOnAwake",Tot,V(e)),X(e,"_volume",Aot,V(e)),e._cachedCurrentTime=0,e._operationsBeforeLoading=[],e._isLoaded=!1,e._lastSetClip=null,e}F(e,t);var n=e.prototype;return n._syncPlayer=function(){var t=this,e=this._clip;this._isLoaded=!1,this._lastSetClip!==e&&(e?e._nativeAsset?(this._lastSetClip=e,rot.load(e._nativeAsset.url,{audioLoadMode:e.loadMode}).then((function(n){t._lastSetClip===e?(t._isLoaded=!0,t._player&&(t._player.offEnded(),t._player.offInterruptionBegin(),t._player.offInterruptionEnd(),t._player.destroy()),t._player=n,n.onEnded((function(){wot.removePlaying(n),t.node.emit(bot.ENDED,t)})),n.onInterruptionBegin((function(){wot.removePlaying(n)})),n.onInterruptionEnd((function(){wot.addPlaying(n)})),t._syncStates()):n.destroy()})).catch((function(){}))):console.error("Invalid audio clip"):this._lastSetClip=null)},n.onLoad=function(){this._syncPlayer()},n.onEnable=function(){this._playOnAwake&&!this.playing&&this.play()},n.onDisable=function(){var t=this._getRootNode();(null==t?void 0:t._persistNode)||this.pause()},n.onDestroy=function(){var t;this.stop(),null===(t=this._player)||void 0===t||t.destroy(),this._player=null},n._getRootNode=function(){for(var t,e,n=this.node,i=null===(t=n)||void 0===t||null===(e=t.parent)||void 0===e?void 0:e.parent;i;){var r,a,o;i=null===(a=n=null===(r=n)||void 0===r?void 0:r.parent)||void 0===a||null===(o=a.parent)||void 0===o?void 0:o.parent}return n},n.play=function(){var t,e,n=this;this._isLoaded?(wot.discardOnePlayingIfNeeded(),this.state===Nat.PLAYING&&(null===(e=this._player)||void 0===e||e.stop().catch((function(){}))),null===(t=this._player)||void 0===t||t.play().then((function(){wot.addPlaying(n._player),n.node.emit(bot.STARTED,n)})).catch((function(){}))):this._operationsBeforeLoading.push("play")},n.pause=function(){var t,e=this;this._isLoaded?null===(t=this._player)||void 0===t||t.pause().then((function(){wot.removePlaying(e._player)})).catch((function(){})):this._operationsBeforeLoading.push("pause")},n.stop=function(){var t,e=this;this._isLoaded?null===(t=this._player)||void 0===t||t.stop().then((function(){wot.removePlaying(e._player)})).catch((function(){})):this._operationsBeforeLoading.push("stop")},n.playOneShot=function(t,e){void 0===e&&(e=1),t._nativeAsset?rot.loadOneShotAudio(t._nativeAsset.url,this._volume*e,{audioLoadMode:t.loadMode}).then((function(t){wot.discardOnePlayingIfNeeded(),t.onPlay=function(){wot.addPlaying(t)},t.onEnd=function(){wot.removePlaying(t)},t.play()})).catch((function(){})):console.error("Invalid audio clip")},n._syncStates=function(){var t=this;this._player&&this._player.seek(this._cachedCurrentTime).then((function(){t._player&&(t._player.loop=t._loop,t._player.volume=t._volume,t._operationsBeforeLoading.forEach((function(e){var n;null===(n=t[e])||void 0===n||n.call(t)})),t._operationsBeforeLoading.length=0)})).catch((function(){}))},L(e,[{key:"clip",get:function(){return this._clip},set:function(t){t!==this._clip&&(this._clip=t,this._syncPlayer())}},{key:"loop",get:function(){return this._loop},set:function(t){this._loop=t,this._player&&(this._player.loop=t)}},{key:"playOnAwake",get:function(){return this._playOnAwake},set:function(t){this._playOnAwake=t}},{key:"volume",get:function(){return this._volume},set:function(t){Number.isNaN(t)?console.warn("illegal audio volume!"):(t=Yn(t,0,1),this._player?(this._player.volume=t,this._volume=this._player.volume):this._volume=t)}},{key:"currentTime",get:function(){return this._player?this._player.currentTime:this._cachedCurrentTime},set:function(t){var e;Number.isNaN(t)?console.warn("illegal audio time!"):(t=Yn(t,0,this.duration),this._cachedCurrentTime=t,null===(e=this._player)||void 0===e||e.seek(this._cachedCurrentTime).catch((function(){})))}},{key:"duration",get:function(){var t,e;return null!==(t=null===(e=this._clip)||void 0===e?void 0:e.getDuration())&&void 0!==t?t:this._player?this._player.currentTime:0}},{key:"state",get:function(){return this._player?this._player.state:Nat.INIT}},{key:"playing",get:function(){return this.state===e.AudioState.PLAYING}}],[{key:"maxAudioChannel",get:function(){return rot.maxAudioChannel}}]),e}($u),Eot.AudioState=Nat,Eot.EventType=bot,xot=q((yot=Cot).prototype,"_clip",[hot],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Sot=q(yot.prototype,"_loop",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Tot=q(yot.prototype,"_playOnAwake",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Aot=q(yot.prototype,"_volume",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),q(yot.prototype,"clip",[fot,_ot],Object.getOwnPropertyDescriptor(yot.prototype,"clip"),yot.prototype),q(yot.prototype,"loop",[pot],Object.getOwnPropertyDescriptor(yot.prototype,"loop"),yot.prototype),q(yot.prototype,"playOnAwake",[dot],Object.getOwnPropertyDescriptor(yot.prototype,"playOnAwake"),yot.prototype),q(yot.prototype,"volume",[mot,got],Object.getOwnPropertyDescriptor(yot.prototype,"volume"),yot.prototype),vot=yot))||vot)||vot)||vot));Nn(aot,"AudioClip",[{name:"PlayingState",newName:"AudioState",target:Oot,targetName:"AudioSource"}]),Bn(aot.prototype,"AudioClip.prototype",["state","play","pause","stop","playOneShot","setCurrentTime","setVolume","setLoop","getCurrentTime","getVolume","getLoop"].map((function(t){return{name:t,suggest:"please use AudioSource.prototype."+t+" instead"}}))),i.AudioSourceComponent=Oot,Gt.setClassAlias(Oot,"cc.AudioSourceComponent");var Mot=t("VideoClip",nl("cc.VideoClip")((Dot=function(t){function e(){var e;return X(e=t.call(this)||this,"_duration",Rot,V(e)),e._video=null,e}return F(e,t),L(e,[{key:"_nativeAsset",get:function(){return this._video},set:function(t){this._video=t,this._duration=t?t.duration:0}}]),e}(Ou),Rot=q((Iot=Dot).prototype,"_duration",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Pot=Iot))||Pot);function Not(t,e,n){var i=document.createElement("video"),r=document.createElement("source");i.appendChild(r);var a=new XMLHttpRequest;a.open("GET",t,!0),a.responseType="blob",a.onload=function(){200===this.status||0===this.status?(r.src=URL.createObjectURL(this.response),n(null,i)):n(new Error(a.status+"(no response)"))},a.onerror=function(){var e="load video failure - "+t;_(e),n(new Error(e))},a.send()}function Lot(t,e,n,i){var r=new Mot;r._nativeUrl=t,r._nativeAsset=e,i(null,r)}LN.register({".mp4":Not,".avi":Not,".mov":Not,".mpg":Not,".mpeg":Not,".rm":Not,".rmvb":Not}),HN.register({".mp4":Lot,".avi":Lot,".mov":Lot,".mpg":Lot,".mpeg":Lot,".rm":Lot,".rmvb":Lot});var Bot,Fot,zot=Yt({REMOTE:0,LOCAL:1});!function(t){t.NONE="none",t.PLAYING="playing",t.PAUSED="paused",t.STOPPED="stopped",t.COMPLETED="completed",t.META_LOADED="meta-loaded",t.READY_TO_PLAY="ready-to-play",t.ERROR="error",t.CLICKED="clicked"}(Bot||(Bot={})),function(t){t[t.HAVE_NOTHING=0]="HAVE_NOTHING",t[t.HAVE_METADATA=1]="HAVE_METADATA",t[t.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",t[t.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",t[t.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"}(Fot||(Fot={}));var Uot=function(){function t(t){var e=this;this._componentEventList=new Map,this._state=Bot.NONE,this._video=null,this._onHide=void 0,this._onShow=void 0,this._interrupted=!1,this._loaded=!1,this._loadedMeta=!1,this._ignorePause=!1,this._fullScreenOnAwake=!1,this._visible=!0,this._playing=!1,this._cachedCurrentTime=-1,this._waitingFullscreen=!1,this._waitingPlay=!1,this._keepAspectRatio=!1,this._component=null,this._uiTrans=null,this._node=null,this._stayOnBottom=!1,this._dirty=!1,this._forceUpdate=!1,this._w=0,this._h=0,this._m00=0,this._m01=0,this._m04=0,this._m05=0,this._m12=0,this._m13=0,this._component=t,this._node=t.node,this._uiTrans=t.node.getComponent(FW),this._onHide=function(){e.video&&e._state===Bot.PLAYING&&(e.video.pause(),e._interrupted=!0)},this._onShow=function(){e._interrupted&&e.video&&(e.video.play(),e._interrupted=!1)},i.game.on(i.Game.EVENT_HIDE,this._onHide),i.game.on(i.Game.EVENT_SHOW,this._onShow)}var e=t.prototype;return e.onLoadedMetadata=function(t){this._loadedMeta=!0,this._forceUpdate=!0,this._visible?this.enable():this.disable(),this.dispatchEvent(Bot.META_LOADED);var e=t.target;this._keepAspectRatio&&e&&this.syncUITransform(e.videoWidth,e.videoHeight),this.delayedFullScreen(),this.delayedPlay()},e.onCanPlay=function(){this._loaded=!0,this.dispatchEvent(Bot.READY_TO_PLAY)},e.onPlay=function(){this._playing=!0,this.dispatchEvent(Bot.PLAYING)},e.onPlaying=function(){this.dispatchEvent(Bot.PLAYING)},e.onPause=function(){this._ignorePause?this._ignorePause=!1:(this._playing=!1,this.dispatchEvent(Bot.PAUSED))},e.onStoped=function(){this._playing=!1,this._ignorePause=!1,this.dispatchEvent(Bot.STOPPED)},e.onEnded=function(){this.dispatchEvent(Bot.COMPLETED)},e.onClick=function(){this.dispatchEvent(Bot.CLICKED)},e.onError=function(t){this.dispatchEvent(Bot.ERROR);var e=t.target;e&&e.error&&d("Error "+e.error.code+"; details: "+e.error.message)},e.play=function(){this._loadedMeta||this._loaded?this.canPlay():this._waitingPlay=!0},e.delayedPlay=function(){this._waitingPlay&&(this.canPlay(),this._waitingPlay=!1)},e.syncFullScreenOnAwake=function(t){this._fullScreenOnAwake=t,this._loadedMeta||this._loaded?this.canFullScreen(t):this._waitingFullscreen=!0},e.delayedFullScreen=function(){this._waitingFullscreen&&(this.canFullScreen(this._fullScreenOnAwake),this._waitingFullscreen=!1)},e.dispatchEvent=function(t){var e=this._componentEventList.get(t);e&&(this._state=t,e.call(this))},e.syncUITransform=function(t,e){this._uiTrans&&(this._uiTrans.width=t,this._uiTrans.height=e)},e.syncCurrentTime=function(){this.video&&-1!==this._cachedCurrentTime&&this.video.currentTime!==this._cachedCurrentTime&&(this.seekTo(this._cachedCurrentTime),this._cachedCurrentTime=-1)},e.destroy=function(){this.removeVideoPlayer(),this._componentEventList.clear(),i.game.off(i.Game.EVENT_HIDE,this._onHide),i.game.off(i.Game.EVENT_SHOW,this._onShow)},L(t,[{key:"fullScreenOnAwake",get:function(){return this._fullScreenOnAwake}},{key:"loaded",get:function(){return this._loaded}},{key:"componentEventList",get:function(){return this._componentEventList}},{key:"video",get:function(){return this._video}},{key:"state",get:function(){return this._state}},{key:"isPlaying",get:function(){return this._playing}},{key:"UICamera",get:function(){return WM.root.batcher2D.getFirstRenderCamera(this._node)}}]),t}();i.internal.VideoPlayerImpl=Uot;var kot,Got,Hot,Vot,jot,Wot,Xot,qot,Yot,Kot,Qot,Zot,Jot,$ot,tst,est,nst,ist,rst,ast,ost,sst,cst,lst,ust,hst,fst,_st,pst,dst,mst,gst,vst,yst,xst,Sst,Tst,Ast,Est,Cst=-Math.pow(2,15),bst=Mi(),wst=function(t){function e(e){var n;return(n=t.call(this,e)||this)._eventList=new Map,n._clearColorA=-1,n._clearFlag=void 0,n}F(e,t);var n=e.prototype;return n.addListener=function(t,e){this._video&&(this._eventList.set(t,e),this._video.addEventListener(t,e))},n.removeAllListeners=function(){var t=this;this._eventList.forEach((function(e,n){t._video&&t._video.removeEventListener(n,e)})),this._eventList.clear()},n.canPlay=function(){var t=this;if(this.video){var e=this.video.play();window.Promise&&e instanceof Promise&&e.catch((function(){})).then((function(){t.syncCurrentTime()}))}},n.pause=function(){this.video&&(this.video.pause(),this._cachedCurrentTime=this.video.currentTime)},n.resume=function(){this.play()},n.stop=function(){var t=this;this.video&&(this._ignorePause=!0,this.video.currentTime=0,this.video.pause(),this._cachedCurrentTime=0,setTimeout((function(){t._ignorePause=!1,t.dispatchEvent(Bot.STOPPED)}),0))},n.syncClip=function(t){this.removeVideoPlayer(),t&&this.createVideoPlayer(t.nativeUrl)},n.syncURL=function(t){this.removeVideoPlayer(),t&&this.createVideoPlayer(t)},n.syncPlaybackRate=function(t){lh.browserType!==on.UC?this.video&&(this.video.playbackRate=t):p("playbackRate is not supported by the uc mobile browser.")},n.syncVolume=function(t){this.video&&(this.video.volume=t)},n.syncMute=function(t){this.video&&(this.video.muted=t)},n.syncLoop=function(t){this.video&&(this.video.loop=t)},n.getDuration=function(){return this.video?this.video.duration:0},n.getCurrentTime=function(){return this.video?this.video.currentTime:-1},n.seekTo=function(t){this.video&&(this.video.currentTime=t)},n.canFullScreen=function(t){var e=this,n=this._video;if(n&&n.readyState===Fot.HAVE_ENOUGH_DATA)return lh.os===ln.IOS&&lh.isBrowser?(t?n.webkitEnterFullscreen&&n.webkitEnterFullscreen():n.webkitExitFullscreen&&n.webkitExitFullscreen(),void(this._fullScreenOnAwake=n.webkitDisplayingFullscreen)):ch.supportsFullScreen?void(t?(lh.browserType===on.IE&&(n.style.transform=""),n.setAttribute("x5-video-player-fullscreen","true"),ch.requestFullScreen(n,(function(t){var i=lh.browserType===on.IE?t.msFullscreenElement:t.fullscreenElement;e._fullScreenOnAwake=i===n}),(function(){e._fullScreenOnAwake=!1}))):(n.removeAttribute("x5-video-player-fullscreen"),ch.exitFullScreen())):(this._fullScreenOnAwake=t,this._forceUpdate=!0,void this.syncMatrix())},n.syncStayOnBottom=function(t){this._video&&(this._video.style["z-index"]=t?Cst:0,this._stayOnBottom=t),this._dirty=!0},n.syncKeepAspectRatio=function(t){this._keepAspectRatio=t,t&&this._loadedMeta&&this._video&&this.syncUITransform(this._video.videoWidth,this._video.videoHeight)},n.removeVideoPlayer=function(){var t=this._video;t&&se(VM.container,t)&&(VM.container.removeChild(t),this.removeAllListeners()),this._cachedCurrentTime=0,this._playing=!1,this._loaded=!1,this._loadedMeta=!1,this._video=null},n.createVideoPlayer=function(t){var e=this._video=document.createElement("video");e.className="cocosVideo",e.style.visibility="hidden",e.style.position="absolute",e.style.bottom="0px",e.style.left="0px",e.style["transform-origin"]="0px 100% 0px",e.style["-webkit-transform-origin"]="0px 100% 0px",e.setAttribute("preload","auto"),e.setAttribute("webkit-playsinline",""),e.setAttribute("x5-playsinline",""),e.setAttribute("playsinline",""),this._bindDomEvent(),VM.container.appendChild(e);var n=document.createElement("source");e.appendChild(n),n.src=t},n._bindDomEvent=function(){this._video,this.addListener("loadedmetadata",this.onLoadedMetadata.bind(this)),this.addListener("canplay",this.onCanPlay.bind(this)),this.addListener("canplaythrough",this.onCanPlay.bind(this)),this.addListener("play",this.onPlay.bind(this)),this.addListener("playing",this.onPlaying.bind(this)),this.addListener("pause",this.onPause.bind(this)),this.addListener("click",this.onClick.bind(this)),this.addListener("ended",this.onEnded.bind(this)),this.addListener("error",this.onError.bind(this))},n.onCanPlay=function(e){var n=e.target;if(!this._loaded||!n)switch(n.readyState){case Fot.HAVE_METADATA:case Fot.HAVE_ENOUGH_DATA:t.prototype.onCanPlay.call(this,e)}},n.enable=function(){if(this._video){if(this._visible=!0,"visible"===this._video.style.visibility)return;this._video.style.visibility="visible"}},n.disable=function(t){if(this._video){if(!t&&this._playing&&this._video.pause(),this._visible=!1,"hidden"===this._video.style.visibility)return;this._video.style.visibility="hidden"}},n.syncMatrix=function(){if(this._video&&this._visible&&this._component){var t=this.UICamera;if(t&&!ch.fullScreen()){this._dirty&&(this._dirty=!1,this._stayOnBottom?(this._clearColorA=t.clearColor.w,this._clearFlag=t.clearFlag,t.clearColor.w=0,t.clearFlag=na.ALL):this._clearFlag&&(t.clearColor.w=this._clearColorA,t.clearFlag=this._clearFlag,this._clearColorA=-1,this._clearFlag=null)),this._component.node.getWorldMatrix(bst),t.update(!0),t.worldMatrixToScreen(bst,bst,VM.canvas.width,VM.canvas.height);var e=0,n=0;if(this._fullScreenOnAwake?(e=YM.width,n=YM.height):(e=this._uiTrans.contentSize.width,n=this._uiTrans.contentSize.height),this._forceUpdate||this._m00!==bst.m00||this._m01!==bst.m01||this._m04!==bst.m04||this._m05!==bst.m05||this._m12!==bst.m12||this._m13!==bst.m13||this._w!==e||this._h!==n){this._m00=bst.m00,this._m01=bst.m01,this._m04=bst.m04,this._m05=bst.m05,this._m12=bst.m12,this._m13=bst.m13,this._w=e,this._h=n;var i=oh.devicePixelRatio,r=1/i,a=1/i,o=VM.container,s=bst.m00*r,c=bst.m01,l=bst.m04,u=bst.m05*a;this._video.style.width=this._w+"px",this._video.style.height=this._h+"px",lh.browserType!==on.MOBILE_QQ?this._video.style.objectFit=this._keepAspectRatio?"none":"fill":p("keepAspectRatio is not supported by the qq mobile browser.");var h=this._w*r,f=this._h*a,_=this._uiTrans.anchorPoint,d=_.x,m=_.y,g=h*bst.m00*d,v=f*bst.m05*m,y=o&&o.style.paddingLeft?parseInt(o.style.paddingLeft):0,x=o&&o.style.paddingBottom?parseInt(o.style.paddingBottom):0,S="matrix("+s+","+-c+","+-l+","+u+","+(bst.m12*r-g+y)+","+-(bst.m13*a-v+x)+")";this._video.style.transform=S,this._video.style["-webkit-transform"]=S,lh.browserType!==on.IE&&(this._forceUpdate=!1)}}}},e}(Uot),Pst=function(){function t(){}return t.getImpl=function(t){return new wst(t)},t}();i.internal.VideoPlayerImplManager=Pst;var Ist,Rst=t("VideoPlayer",(kot=nl("cc.VideoPlayer"),Got=vl(),Hot=pl(),Vot=il(FW),jot=Bl(Mot),Wot=Bl(zot),Xot=Al(),qot=Al(),Yot=Bl(Mot),Kot=Al(),Qot=Al(),Zot=El(),Jot=Al(),$ot=El(),tst=Al(),est=Al(),nst=Al(),ist=Al(),rst=Al(),ast=Al(),ost=Bl([GB]),sst=Il(),cst=Al(),kot(lst=Got(lst=Hot(lst=Vot(lst=_l((Est=Ast=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return X(e=t.call.apply(t,[this].concat(i))||this,"_resourceType",hst,V(e)),X(e,"_remoteURL",fst,V(e)),X(e,"_clip",_st,V(e)),X(e,"_playOnAwake",pst,V(e)),X(e,"_volume",dst,V(e)),X(e,"_mute",mst,V(e)),X(e,"_playbackRate",gst,V(e)),X(e,"_loop",vst,V(e)),X(e,"_fullScreenOnAwake",yst,V(e)),X(e,"_stayOnBottom",xst,V(e)),X(e,"_keepAspectRatio",Sst,V(e)),e._impl=null,e._cachedCurrentTime=0,X(e,"videoPlayerEvent",Tst,V(e)),e}F(e,t);var n=e.prototype;return n.syncSource=function(){this._impl&&(this._resourceType===zot.REMOTE?this._impl.syncURL(this._remoteURL):this._impl.syncClip(this._clip))},n.__preload=function(){this._impl=Pst.getImpl(this),this.syncSource(),this._impl.syncLoop(this._loop),this._impl.syncVolume(this._volume),this._impl.syncMute(this._mute),this._impl.seekTo(this._cachedCurrentTime),this._impl.syncPlaybackRate(this._playbackRate),this._impl.syncStayOnBottom(this._stayOnBottom),this._impl.syncKeepAspectRatio(this._keepAspectRatio),this._impl.syncFullScreenOnAwake(this._fullScreenOnAwake),this._impl.componentEventList.set(Bot.META_LOADED,this.onMetaLoaded.bind(this)),this._impl.componentEventList.set(Bot.READY_TO_PLAY,this.onReadyToPlay.bind(this)),this._impl.componentEventList.set(Bot.PLAYING,this.onPlaying.bind(this)),this._impl.componentEventList.set(Bot.PAUSED,this.onPaused.bind(this)),this._impl.componentEventList.set(Bot.STOPPED,this.onStopped.bind(this)),this._impl.componentEventList.set(Bot.COMPLETED,this.onCompleted.bind(this)),this._impl.componentEventList.set(Bot.ERROR,this.onError.bind(this)),this._playOnAwake&&this._impl.loaded&&this.play()},n.onEnable=function(){this._impl&&this._impl.enable()},n.onDisable=function(){this._impl&&this._impl.disable()},n.onDestroy=function(){this._impl&&(this._impl.destroy(),this._impl=null)},n.update=function(){this._impl&&this._impl.syncMatrix()},n.onMetaLoaded=function(){GB.emitEvents(this.videoPlayerEvent,this,Bot.META_LOADED),this.node.emit("meta-loaded",this)},n.onReadyToPlay=function(){this._playOnAwake&&!this.isPlaying&&this.play(),GB.emitEvents(this.videoPlayerEvent,this,Bot.READY_TO_PLAY),this.node.emit(Bot.READY_TO_PLAY,this)},n.onPlaying=function(){GB.emitEvents(this.videoPlayerEvent,this,Bot.PLAYING),this.node.emit(Bot.PLAYING,this)},n.onPaused=function(){GB.emitEvents(this.videoPlayerEvent,this,Bot.PAUSED),this.node.emit(Bot.PAUSED,this)},n.onStopped=function(){GB.emitEvents(this.videoPlayerEvent,this,Bot.STOPPED),this.node.emit(Bot.STOPPED,this)},n.onCompleted=function(){GB.emitEvents(this.videoPlayerEvent,this,Bot.COMPLETED),this.node.emit(Bot.COMPLETED,this)},n.onError=function(){GB.emitEvents(this.videoPlayerEvent,this,Bot.ERROR),this.node.emit(Bot.ERROR,this)},n.play=function(){this._impl&&this._impl.play()},n.resume=function(){this._impl&&this._impl.resume()},n.pause=function(){this._impl&&this._impl.pause()},n.stop=function(){this._impl&&this._impl.stop()},L(e,[{key:"resourceType",get:function(){return this._resourceType},set:function(t){this._resourceType!==t&&(this._resourceType=t,this.syncSource())}},{key:"remoteURL",get:function(){return this._remoteURL},set:function(t){this._remoteURL!==t&&(this._remoteURL=t,this.syncSource())}},{key:"clip",get:function(){return this._clip},set:function(t){this._clip!==t&&(this._clip=t,this.syncSource())}},{key:"playOnAwake",get:function(){return this._playOnAwake},set:function(t){this._playOnAwake=t}},{key:"playbackRate",get:function(){return this._playbackRate},set:function(t){this._playbackRate=t,this._impl&&this._impl.syncPlaybackRate(t)}},{key:"volume",get:function(){return this._volume},set:function(t){this._volume=t,this._impl&&this._impl.syncVolume(t)}},{key:"mute",get:function(){return this._mute},set:function(t){this._mute=t,this._impl&&this._impl.syncMute(t)}},{key:"loop",get:function(){return this._loop},set:function(t){this._loop=t,this._impl&&this._impl.syncLoop(t)}},{key:"keepAspectRatio",get:function(){return this._keepAspectRatio},set:function(t){this._keepAspectRatio!==t&&(this._keepAspectRatio=t,this._impl&&this._impl.syncKeepAspectRatio(t))}},{key:"fullScreenOnAwake",get:function(){return this._impl?(this._fullScreenOnAwake=this._impl.fullScreenOnAwake,this._fullScreenOnAwake):this._fullScreenOnAwake},set:function(t){this._fullScreenOnAwake!==t&&(this._fullScreenOnAwake=t,this._impl&&this._impl.syncFullScreenOnAwake(t))}},{key:"stayOnBottom",get:function(){return this._stayOnBottom},set:function(t){this._stayOnBottom!==t&&(this._stayOnBottom=t,this._impl&&this._impl.syncStayOnBottom(t))}},{key:"nativeVideo",get:function(){return this._impl&&this._impl.video||null}},{key:"currentTime",get:function(){return this._impl?this._impl.getCurrentTime():this._cachedCurrentTime},set:function(t){Number.isNaN(t)?p("illegal video time! value:"+t):(t=Yn(t,0,this.duration),this._cachedCurrentTime=t,this._impl&&this._impl.seekTo(t))}},{key:"duration",get:function(){return this._impl?this._impl.getDuration():0}},{key:"state",get:function(){return this._impl?this._impl.state:Bot.NONE}},{key:"isPlaying",get:function(){return!!this._impl&&this._impl.isPlaying}}]),e}($u),Ast.EventType=Bot,Ast.ResourceType=zot,hst=q((ust=Est).prototype,"_resourceType",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return zot.LOCAL}}),fst=q(ust.prototype,"_remoteURL",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),_st=q(ust.prototype,"_clip",[jot,cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),pst=q(ust.prototype,"_playOnAwake",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),dst=q(ust.prototype,"_volume",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),mst=q(ust.prototype,"_mute",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),gst=q(ust.prototype,"_playbackRate",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),vst=q(ust.prototype,"_loop",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),yst=q(ust.prototype,"_fullScreenOnAwake",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),xst=q(ust.prototype,"_stayOnBottom",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Sst=q(ust.prototype,"_keepAspectRatio",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),q(ust.prototype,"resourceType",[Wot,Xot],Object.getOwnPropertyDescriptor(ust.prototype,"resourceType"),ust.prototype),q(ust.prototype,"remoteURL",[qot],Object.getOwnPropertyDescriptor(ust.prototype,"remoteURL"),ust.prototype),q(ust.prototype,"clip",[Yot,Kot],Object.getOwnPropertyDescriptor(ust.prototype,"clip"),ust.prototype),q(ust.prototype,"playOnAwake",[Qot],Object.getOwnPropertyDescriptor(ust.prototype,"playOnAwake"),ust.prototype),q(ust.prototype,"playbackRate",[Pl,Zot,Jot],Object.getOwnPropertyDescriptor(ust.prototype,"playbackRate"),ust.prototype),q(ust.prototype,"volume",[Pl,$ot,tst],Object.getOwnPropertyDescriptor(ust.prototype,"volume"),ust.prototype),q(ust.prototype,"mute",[est],Object.getOwnPropertyDescriptor(ust.prototype,"mute"),ust.prototype),q(ust.prototype,"loop",[nst],Object.getOwnPropertyDescriptor(ust.prototype,"loop"),ust.prototype),q(ust.prototype,"keepAspectRatio",[ist],Object.getOwnPropertyDescriptor(ust.prototype,"keepAspectRatio"),ust.prototype),q(ust.prototype,"fullScreenOnAwake",[rst],Object.getOwnPropertyDescriptor(ust.prototype,"fullScreenOnAwake"),ust.prototype),q(ust.prototype,"stayOnBottom",[ast],Object.getOwnPropertyDescriptor(ust.prototype,"stayOnBottom"),ust.prototype),Tst=q(ust.prototype,"videoPlayerEvent",[cl,ost,sst,cst],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),lst=ust))||lst)||lst)||lst)||lst)||lst));i.internal.VideoPlayer=Rst,Nn(Rst.prototype,"VideoPlayer.prototype",[{name:"onPasued",newName:"onPaused"}]),function(t){t.NONE="none",t.LOADING="loading",t.LOADED="loaded",t.ERROR="error"}(Ist||(Ist={}));var Dst=function(){function t(t){this._componentEventList=new Map,this._state=Ist.NONE,this._wrapper=void 0,this._webview=null,this._loaded=!1,this._forceUpdate=!1,this._component=null,this._uiTrans=null,this._node=null,this._w=0,this._h=0,this._m00=0,this._m01=0,this._m04=0,this._m05=0,this._m12=0,this._m13=0,this._component=t,this._node=t.node,this._uiTrans=t.node.getComponent(FW),this.reset(),this.createWebView()}var e=t.prototype;return e.reset=function(){this._wrapper=null,this._webview=null,this._loaded=!1,this._w=0,this._h=0,this._m00=0,this._m01=0,this._m04=0,this._m05=0,this._m12=0,this._m13=0,this._state=Ist.NONE,this._forceUpdate=!1},e.dispatchEvent=function(t){var e=this._componentEventList.get(t);if(e){this._state=t;for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];e.call(this,i)}},e.destroy=function(){this.removeWebView(),this._wrapper=null,this._webview=null,this._loaded=!1,this._component=null,this._uiTrans=null,this._forceUpdate=!1,this._componentEventList.clear()},L(t,[{key:"loaded",get:function(){return this._loaded}},{key:"componentEventList",get:function(){return this._componentEventList}},{key:"webview",get:function(){return this._webview}},{key:"state",get:function(){return this._state}},{key:"UICamera",get:function(){return WM.root.batcher2D.getFirstRenderCamera(this._node)}}]),t}();i.internal.WebViewImpl=Dst;var Ost,Mst,Nst,Lst,Bst,Fst,zst,Ust,kst,Gst,Hst,Vst,jst,Wst,Xst=Mi(),qst=function(t){function e(e){return t.call(this,e)||this}F(e,t);var n=e.prototype;return n._bindDomEvent=function(){var t=this;this.webview&&this.webview.addEventListener("load",(function(e){t._forceUpdate=!0,t.dispatchEvent(Ist.LOADED);var n=e.target,i=n.contentDocument&&n.contentDocument.body;i&&i.innerHTML.includes("404")&&t.dispatchEvent(Ist.ERROR,i.innerHTML)}))},n.loadURL=function(t){this.webview&&(this.webview.src=t,this.dispatchEvent(Ist.LOADING))},n.createWebView=function(){var t=document.createElement("div");this._wrapper=t,t.id="webview-wrapper",t.style["-webkit-overflow"]="auto",t.style["-webkit-overflow-scrolling"]="touch",t.style.position="absolute",t.style.bottom="0px",t.style.left="0px",t.style.transformOrigin="0px 100% 0px",t.style["-webkit-transform-origin"]="0px 100% 0px",VM.container.appendChild(t);var e=document.createElement("iframe");this._webview=e,e.id="webview",e.style.border="none",e.style.width="100%",e.style.height="100%",t.appendChild(e),this._bindDomEvent()},n.removeWebView=function(){var t=this._wrapper;se(VM.container,t)&&VM.container.removeChild(t),this.reset()},n.enable=function(){this._wrapper&&(this._wrapper.style.visibility="visible")},n.disable=function(){this._wrapper&&(this._wrapper.style.visibility="hidden")},n.evaluateJS=function(t){if(this.webview){var e=this.webview.contentWindow;if(e)try{e.eval(t)}catch(t){this.dispatchEvent(Ist.ERROR,t),d(t)}}},n.setOnJSCallback=function(){p("The platform does not support")},n.setJavascriptInterfaceScheme=function(){p("The platform does not support")},n.syncMatrix=function(){if(this._wrapper&&this._uiTrans&&this._component&&"hidden"!==this._wrapper.style.visibility){var t=this.UICamera;if(t){this._component.node.getWorldMatrix(Xst),t.update(!0),t.worldMatrixToScreen(Xst,Xst,VM.canvas.width,VM.canvas.height);var e=this._uiTrans.contentSize,n=e.width,i=e.height;if(this._forceUpdate||this._m00!==Xst.m00||this._m01!==Xst.m01||this._m04!==Xst.m04||this._m05!==Xst.m05||this._m12!==Xst.m12||this._m13!==Xst.m13||this._w!==n||this._h!==i){this._m00=Xst.m00,this._m01=Xst.m01,this._m04=Xst.m04,this._m05=Xst.m05,this._m12=Xst.m12,this._m13=Xst.m13,this._w=n,this._h=i;var r=oh.devicePixelRatio,a=1/r,o=1/r,s=VM.container,c=Xst.m00*a,l=Xst.m01,u=Xst.m04,h=Xst.m05*o;this._wrapper.style.width=n+"px",this._wrapper.style.height=i+"px";var f=this._w*a,_=this._h*o,p=f*Xst.m00*this._uiTrans.anchorX,d=_*Xst.m05*this._uiTrans.anchorY,m=s&&s.style.paddingLeft?parseInt(s.style.paddingLeft):0,g=s&&s.style.paddingBottom?parseInt(s.style.paddingBottom):0,v="matrix("+c+","+-l+","+-u+","+h+","+(Xst.m12*a-p+m)+","+-(Xst.m13*o-d+g)+")";this._wrapper.style.transform=v,this._wrapper.style["-webkit-transform"]=v,this._forceUpdate=!1}}}},e}(Dst),Yst=function(){function t(){}return t.getImpl=function(t){return new qst(t)},t}();i.internal.WebViewImplManager=Yst;var Kst=t("WebView",(Ost=nl("cc.WebView"),Mst=vl(),Nst=pl(),Lst=il(FW),Bst=Al(),Fst=Bl([GB]),zst=Il(),Ust=Al(),Ost(kst=Mst(kst=Nst(kst=Lst(kst=_l((Wst=jst=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return X(e=t.call.apply(t,[this].concat(i))||this,"_url",Hst,V(e)),e._impl=null,X(e,"webviewEvents",Vst,V(e)),e}F(e,t);var n=e.prototype;return n.setJavascriptInterfaceScheme=function(t){this._impl&&this._impl.setJavascriptInterfaceScheme(t)},n.setOnJSCallback=function(t){this._impl&&this._impl.setOnJSCallback(t)},n.evaluateJS=function(t){this._impl&&this._impl.evaluateJS(t)},n.__preload=function(){this._impl=Yst.getImpl(this),this._impl.componentEventList.set(Ist.LOADING,this.onLoading.bind(this)),this._impl.componentEventList.set(Ist.LOADED,this.onLoaded.bind(this)),this._impl.componentEventList.set(Ist.ERROR,this.onError.bind(this)),this._impl.loadURL(this._url)},n.onLoading=function(){GB.emitEvents(this.webviewEvents,this,Ist.LOADING),this.node.emit(Ist.LOADING,this)},n.onLoaded=function(){GB.emitEvents(this.webviewEvents,this,Ist.LOADED),this.node.emit(Ist.LOADED,this)},n.onError=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];GB.emitEvents(this.webviewEvents,this,Ist.ERROR,e),this.node.emit(Ist.ERROR,this,e)},n.onEnable=function(){this._impl&&this._impl.enable()},n.onDisable=function(){this._impl&&this._impl.disable()},n.onDestroy=function(){this._impl&&(this._impl.destroy(),this._impl=null)},n.update=function(){this._impl&&this._impl.syncMatrix()},L(e,[{key:"url",get:function(){return this._url},set:function(t){this._url=t,this._impl&&this._impl.loadURL(t)}},{key:"nativeWebView",get:function(){return this._impl&&this._impl.webview||null}},{key:"state",get:function(){return this._impl?this._impl.state:Ist.NONE}}]),e}($u),jst.EventType=Ist,Hst=q((Gst=Wst).prototype,"_url",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"https://cocos.com"}}),q(Gst.prototype,"url",[Bst],Object.getOwnPropertyDescriptor(Gst.prototype,"url"),Gst.prototype),Vst=q(Gst.prototype,"webviewEvents",[cl,Fst,zst,Ust],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),kst=Gst))||kst)||kst)||kst)||kst)||kst));i.internal.WebView=Kst;var Qst=function(){function t(){this.originalTarget=null,this.target=null,this.tag=t.TAG_INVALID}var e=t.prototype;return e.clone=function(){var e=new t;return e.originalTarget=null,e.target=null,e.tag=this.tag,e},e.isDone=function(){return!0},e.startWithTarget=function(t){this.originalTarget=t,this.target=t},e.stop=function(){this.target=null},e.step=function(){T(1006)},e.update=function(){T(1007)},e.getTarget=function(){return this.target},e.setTarget=function(t){this.target=t},e.getOriginalTarget=function(){return this.originalTarget},e.setOriginalTarget=function(t){this.originalTarget=t},e.getTag=function(){return this.tag},e.setTag=function(t){this.tag=t},e.reverse=function(){return T(1008),null},e.retain=function(){},e.release=function(){},t}();Qst.TAG_INVALID=-1;var Zst=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._duration=0,e._timesForRepeat=1,e}F(e,t);var n=e.prototype;return n.getDuration=function(){return this._duration*(this._timesForRepeat||1)},n.setDuration=function(t){this._duration=t},n.clone=function(){return new e},e}(Qst),Jst=(function(t){function e(e,n){var i;return void 0===n&&(n=1),(i=t.call(this)||this)._speed=0,i._innerAction=null,e&&i.initWithAction(e,n),i}F(e,t);var n=e.prototype;n.getSpeed=function(){return this._speed},n.setSpeed=function(t){this._speed=t},n.initWithAction=function(t,e){return t?(this._innerAction=t,this._speed=e,!0):(b(1021),!1)},n.clone=function(){var t=new e;return t.initWithAction(this._innerAction.clone(),this._speed),t},n.startWithTarget=function(t){Qst.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t)},n.stop=function(){this._innerAction.stop(),Qst.prototype.stop.call(this)},n.step=function(t){this._innerAction.step(t*this._speed)},n.isDone=function(){return this._innerAction.isDone()},n.reverse=function(){return new e(this._innerAction.reverse(),this._speed)},n.setInnerAction=function(t){this._innerAction!==t&&(this._innerAction=t)},n.getInnerAction=function(){return this._innerAction}}(Qst),0),$st=function(){this.actions=[],this.target=null,this.actionIndex=0,this.currentAction=null,this.paused=!1,this.lock=!1},tct=function(){function t(){this._hashTargets=new Map,this._arrayTargets=[],this._elementPool=[]}var e=t.prototype;return e._searchElementByTarget=function(t,e){for(var n=0;n<t.length;n++)if(e===t[n].target)return t[n];return null},e._getElement=function(t,e){var n=this._elementPool.pop();return n||(n=new $st),n.target=t,n.paused=!!e,n},e._putElement=function(t){t.actions.length=0,t.actionIndex=0,t.currentAction=null,t.paused=!1,t.target=null,t.lock=!1,this._elementPool.push(t)},e.addAction=function(t,e,n){if(t&&e){null==e.uuid&&(e.uuid="_TWEEN_UUID_"+Jst++);var i=this._hashTargets.get(e);i?i.actions||(i.actions=[]):(i=this._getElement(e,n),this._hashTargets.set(e,i),this._arrayTargets.push(i)),i.target=e,i.actions.push(t),t.startWithTarget(e)}else b(1e3)},e.removeAllActions=function(){for(var t=this._arrayTargets,e=0;e<t.length;e++){var n=t[e];n&&this._putElement(n)}this._arrayTargets.length=0,this._hashTargets=new Map},e.removeAllActionsFromTarget=function(t){if(null!=t){var e=this._hashTargets.get(t);e&&(e.actions.length=0,this._deleteHashElement(e))}},e.removeAction=function(t){if(null!=t){var e=t.getOriginalTarget(),n=this._hashTargets.get(e);if(n)for(var i=0;i<n.actions.length;i++)if(n.actions[i]===t){n.actions.splice(i,1),n.actionIndex>=i&&n.actionIndex--;break}}},e._removeActionByTag=function(t,e,n){for(var i=0,r=e.actions.length;i<r;++i){var a=e.actions[i];if(a&&a.getTag()===t){if(n&&a.getOriginalTarget()!==n)continue;this._removeActionAtIndex(i,e);break}}},e._removeAllActionsByTag=function(t,e,n){for(var i=e.actions.length-1;i>=0;--i){var r=e.actions[i];if(r&&r.getTag()===t){if(n&&r.getOriginalTarget()!==n)continue;this._removeActionAtIndex(i,e)}}},e.removeActionByTag=function(t,e){var n=this;t===Qst.TAG_INVALID&&T(1002);var i=this._hashTargets;if(e){var r=i.get(e);r&&this._removeActionByTag(t,r,e)}else i.forEach((function(e){n._removeActionByTag(t,e)}))},e.removeAllActionsByTag=function(t,e){var n=this;t===Qst.TAG_INVALID&&T(1002);var i=this._hashTargets;if(e){var r=i.get(e);r&&this._removeAllActionsByTag(t,r,e)}else i.forEach((function(e){n._removeAllActionsByTag(t,e)}))},e.getActionByTag=function(t,e){t===Qst.TAG_INVALID&&T(1004);var n=this._hashTargets.get(e);if(n){if(null!=n.actions)for(var i=0;i<n.actions.length;++i){var r=n.actions[i];if(r&&r.getTag()===t)return r}T(1005,t)}return null},e.getNumberOfRunningActionsInTarget=function(t){var e=this._hashTargets.get(t);return e&&e.actions?e.actions.length:0},e.pauseTarget=function(t){var e=this._hashTargets.get(t);e&&(e.paused=!0)},e.resumeTarget=function(t){var e=this._hashTargets.get(t);e&&(e.paused=!1)},e.pauseAllRunningActions=function(){for(var t=[],e=this._arrayTargets,n=0;n<e.length;n++){var i=e[n];i&&!i.paused&&(i.paused=!0,t.push(i.target))}return t},e.resumeTargets=function(t){if(t)for(var e=0;e<t.length;e++)t[e]&&this.resumeTarget(t[e])},e.pauseTargets=function(t){if(t)for(var e=0;e<t.length;e++)t[e]&&this.pauseTarget(t[e])},e.purgeSharedManager=function(){i.director.getScheduler().unscheduleUpdate(this)},e._removeActionAtIndex=function(t,e){e.actions[t],e.actions.splice(t,1),e.actionIndex>=t&&e.actionIndex--,0===e.actions.length&&this._deleteHashElement(e)},e._deleteHashElement=function(t){var e=!1;if(t&&!t.lock&&this._hashTargets.get(t.target)){this._hashTargets.delete(t.target);for(var n=this._arrayTargets,i=0,r=n.length;i<r;i++)if(n[i]===t){n.splice(i,1);break}this._putElement(t),e=!0}return e},e.update=function(t){for(var e,n=this._arrayTargets,i=0;i<n.length;i++){this._currentTarget=n[i];var r=(e=this._currentTarget).target;if(r instanceof Ye&&!r.isValid)this.removeAllActionsFromTarget(r),i--;else{if(!e.paused&&e.actions){for(e.lock=!0,e.actionIndex=0;e.actionIndex<e.actions.length;e.actionIndex++)if(e.currentAction=e.actions[e.actionIndex],e.currentAction){if(e.currentAction.step(t*(e.currentAction._speedMethod?e.currentAction._speed:1)),e.currentAction&&e.currentAction.isDone()){e.currentAction.stop();var a=e.currentAction;e.currentAction=null,this.removeAction(a)}e.currentAction=null}e.lock=!1}0===e.actions.length&&this._deleteHashElement(e)&&i--}}},t}(),ect=t("TweenSystem",function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).actionMgr=new tct,e}return F(e,t),e.prototype.update=function(t){this.actionMgr.update(t)},L(e,[{key:"ActionManager",get:function(){return this.actionMgr}}]),e}(DM));ect.ID="TWEEN",ect.instance=void 0,WM.on(jM.EVENT_INIT,(function(){var t=new ect;ect.instance=t,WM.registerSystem(ect.ID,t,DM.Priority.MEDIUM)}));var nct=function(t){function e(){return t.apply(this,arguments)||this}F(e,t);var n=e.prototype;return n.isDone=function(){return!0},n.step=function(){this.update(1)},n.update=function(){},n.reverse=function(){return this.clone()},n.clone=function(){return new e},e}(Zst),ict=function(t){function e(){return t.apply(this,arguments)||this}F(e,t);var n=e.prototype;return n.update=function(){for(var t=this.target.getComponentsInChildren(mF),e=0;e<t.length;++e)t[e].enabled=!0},n.reverse=function(){return new rct},n.clone=function(){return new e},e}(nct),rct=function(t){function e(){return t.apply(this,arguments)||this}F(e,t);var n=e.prototype;return n.update=function(){for(var t=this.target.getComponentsInChildren(mF),e=0;e<t.length;++e)t[e].enabled=!1},n.reverse=function(){return new ict},n.clone=function(){return new e},e}(nct);!function(t){function e(){return t.apply(this,arguments)||this}F(e,t);var n=e.prototype;n.update=function(){for(var t=this.target.getComponentsInChildren(mF),e=0;e<t.length;++e){var n=t[e];n.enabled=!n.enabled}},n.reverse=function(){return new e},n.clone=function(){return new e}}(nct);var act=function(t){function e(e){var n;return(n=t.call(this)||this)._isNeedCleanUp=!0,void 0!==e&&n.init(e),n}F(e,t);var n=e.prototype;return n.update=function(){this.target.removeFromParent(),this._isNeedCleanUp&&this.target.destroy()},n.init=function(t){return this._isNeedCleanUp=t,!0},n.reverse=function(){return new e(this._isNeedCleanUp)},n.clone=function(){return new e(this._isNeedCleanUp)},e}(nct),oct=function(t){function e(e,n,i){var r;return(r=t.call(this)||this)._selectorTarget=null,r._function=null,r._data=null,r.initWithFunction(e,n,i),r}F(e,t);var n=e.prototype;return n.initWithFunction=function(t,e,n){return t&&(this._function=t),e&&(this._selectorTarget=e),void 0!==n&&(this._data=n),!0},n.execute=function(){this._function&&this._function.call(this._selectorTarget,this.target,this._data)},n.update=function(){this.execute()},n.getTargetCallback=function(){return this._selectorTarget},n.setTargetCallback=function(t){t!==this._selectorTarget&&(this._selectorTarget&&(this._selectorTarget=null),this._selectorTarget=t)},n.clone=function(){var t=new e;return t.initWithFunction(this._function,this._selectorTarget,this._data),t},e}(nct),sct=function(t){function e(e){var n;return(n=t.call(this)||this).MAX_VALUE=2,n._elapsed=0,n._firstTick=!1,n._easeList=[],n._speed=1,n._repeatForever=!1,n._repeatMethod=!1,n._speedMethod=!1,void 0===e||isNaN(e)||n.initWithDuration(e),n}F(e,t);var n=e.prototype;return n.getElapsed=function(){return this._elapsed},n.initWithDuration=function(t){return this._duration=0===t?$t.FLT_EPSILON:t,this._elapsed=0,this._firstTick=!0,!0},n.isDone=function(){return this._elapsed>=this._duration},n._cloneDecoration=function(t){t._repeatForever=this._repeatForever,t._speed=this._speed,t._timesForRepeat=this._timesForRepeat,t._easeList=this._easeList,t._speedMethod=this._speedMethod,t._repeatMethod=this._repeatMethod},n._reverseEaseList=function(t){if(this._easeList){t._easeList=[];for(var e=0;e<this._easeList.length;e++)t._easeList.push(this._easeList[e])}},n.clone=function(){var t=new e(this._duration);return this._cloneDecoration(t),t},n.easing=function(t){this._easeList?this._easeList.length=0:this._easeList=[];for(var e=0;e<arguments.length;e++)this._easeList.push(arguments[e]);return this},n._computeEaseTime=function(t){return t},n.step=function(t){this._firstTick?(this._firstTick=!1,this._elapsed=0):this._elapsed+=t;var e=this._elapsed/(this._duration>1.192092896e-7?this._duration:1.192092896e-7);e=e<1?e:1,this.update(e>0?e:0),this._repeatMethod&&this._timesForRepeat>1&&this.isDone()&&(this._repeatForever||this._timesForRepeat--,this.startWithTarget(this.target),this.step(this._elapsed-this._duration))},n.startWithTarget=function(t){Qst.prototype.startWithTarget.call(this,t),this._elapsed=0,this._firstTick=!0},n.reverse=function(){return T(1010),this},n.setAmplitudeRate=function(){T(1011)},n.getAmplitudeRate=function(){return T(1012),0},n.speed=function(t){return t<=0?(T(1013),this):(this._speedMethod=!0,this._speed*=t,this)},n.getSpeed=function(){return this._speed},n.setSpeed=function(t){return this._speed=t,this},n.repeat=function(t){return t=Math.round(t),isNaN(t)||t<1?(T(1014),this):(this._repeatMethod=!0,this._timesForRepeat*=t,this)},n.repeatForever=function(){return this._repeatMethod=!0,this._timesForRepeat=this.MAX_VALUE,this._repeatForever=!0,this},e}(Zst),cct=function(t){function e(n){var i;(i=t.call(this)||this)._actions=[],i._split=0,i._last=0,i._reversed=!1;var r=n instanceof Array?n:arguments;if(1===r.length)return b(1019),V(i);var a=r.length-1;if(a>=0&&null==r[a]&&T(1015),a>=0){for(var o,s=r[0],c=1;c<a;c++)r[c]&&(o=s,s=e._actionOneTwo(o,r[c]));i.initWithTwoActions(s,r[a])}return i}F(e,t);var n=e.prototype;return n.initWithTwoActions=function(t,e){if(!t||!e)return b(1025),!1;var n=t._duration,i=e._duration,r=(n*=t._repeatMethod?t._timesForRepeat:1)+(i*=e._repeatMethod?e._timesForRepeat:1);return this.initWithDuration(r),this._actions[0]=t,this._actions[1]=e,!0},n.clone=function(){var t=new e;return this._cloneDecoration(t),t.initWithTwoActions(this._actions[0].clone(),this._actions[1].clone()),t},n.startWithTarget=function(t){sct.prototype.startWithTarget.call(this,t),this._split=this._actions[0]._duration/this._duration,this._split*=this._actions[0]._repeatMethod?this._actions[0]._timesForRepeat:1,this._last=-1},n.stop=function(){-1!==this._last&&this._actions[this._last].stop(),Qst.prototype.stop.call(this)},n.update=function(t){var e,n,i=0,r=this._split,a=this._actions,o=this._last;(t=this._computeEaseTime(t))<r?(e=0!==r?t/r:1,0===i&&1===o&&this._reversed&&(a[1].update(0),a[1].stop())):(i=1,e=1===r?1:(t-r)/(1-r),-1===o&&(a[0].startWithTarget(this.target),a[0].update(1),a[0].stop()),0===o&&(a[0].update(1),a[0].stop())),n=a[i],o===i&&n.isDone()||(o!==i&&n.startWithTarget(this.target),e*=n._timesForRepeat,n.update(e>1?e%1:e),this._last=i)},n.reverse=function(){var t=e._actionOneTwo(this._actions[1].reverse(),this._actions[0].reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t._reversed=!0,t},e}(sct);function lct(t){var e=t instanceof Array?t:arguments;if(1===e.length)return b(1019),null;var n=e.length-1;n>=0&&null==e[n]&&T(1015);var i=null;if(n>=0){i=e[0];for(var r=1;r<=n;r++)e[r]&&(i=cct._actionOneTwo(i,e[r]))}return i}cct._actionOneTwo=function(t,e){var n=new cct;return n.initWithTwoActions(t,e),n};var uct=function(t){function e(e,n){var i;return(i=t.call(this)||this)._times=0,i._total=0,i._nextDt=0,i._actionInstant=!1,i._innerAction=null,void 0!==n&&i.initWithAction(e,n),i}F(e,t);var n=e.prototype;return n.initWithAction=function(t,e){var n=t._duration*e;return!!this.initWithDuration(n)&&(this._times=e,this._innerAction=t,t instanceof nct&&(this._actionInstant=!0,this._times-=1),this._total=0,!0)},n.clone=function(){var t=new e;return this._cloneDecoration(t),t.initWithAction(this._innerAction.clone(),this._times),t},n.startWithTarget=function(t){this._total=0,this._nextDt=this._innerAction._duration/this._duration,sct.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t)},n.stop=function(){this._innerAction.stop(),Qst.prototype.stop.call(this)},n.update=function(t){t=this._computeEaseTime(t);var e=this._innerAction,n=this._duration,i=this._times,r=this._nextDt;if(t>=r){for(;t>r&&this._total<i;)e.update(1),this._total++,e.stop(),e.startWithTarget(this.target),r+=e._duration/n,this._nextDt=r>1?1:r;t>=1&&this._total<i&&(e.update(1),this._total++),this._actionInstant||(this._total===i?e.stop():e.update(t-(r-e._duration/n)))}else e.update(t*i%1)},n.isDone=function(){return this._total===this._times},n.reverse=function(){var t=new e(this._innerAction.reverse(),this._times);return this._cloneDecoration(t),this._reverseEaseList(t),t},n.setInnerAction=function(t){this._innerAction!==t&&(this._innerAction=t)},n.getInnerAction=function(){return this._innerAction},e}(sct),hct=function(t){function e(e){var n;return(n=t.call(this)||this)._innerAction=null,e&&n.initWithAction(e),n}F(e,t);var n=e.prototype;return n.initWithAction=function(t){return t?(this._innerAction=t,!0):(b(1026),!1)},n.clone=function(){var t=new e;return this._cloneDecoration(t),t.initWithAction(this._innerAction.clone()),t},n.startWithTarget=function(t){sct.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t)},n.step=function(t){var e=this._innerAction;e.step(t),e.isDone()&&(e.startWithTarget(this.target),e.step(e.getElapsed()-e._duration))},n.isDone=function(){return!1},n.reverse=function(){var t=new e(this._innerAction.reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t},n.setInnerAction=function(t){this._innerAction!==t&&(this._innerAction=t)},n.getInnerAction=function(){return this._innerAction},e}(sct),fct=function(t){function e(n){var i;(i=t.call(this)||this)._one=null,i._two=null;var r=n instanceof Array?n:arguments;if(1===r.length)return b(1020),V(i);var a=r.length-1;if(a>=0&&null==r[a]&&T(1015),a>=0){for(var o,s=r[0],c=1;c<a;c++)r[c]&&(o=s,s=e._actionOneTwo(o,r[c]));i.initWithTwoActions(s,r[a])}return i}F(e,t);var n=e.prototype;return n.initWithTwoActions=function(t,e){if(!t||!e)return b(1027),!1;var n=!1,i=t._duration,r=e._duration;return this.initWithDuration(Math.max(i,r))&&(this._one=t,this._two=e,i>r?this._two=cct._actionOneTwo(e,dct(i-r)):i<r&&(this._one=cct._actionOneTwo(t,dct(r-i))),n=!0),n},n.clone=function(){var t=new e;return this._cloneDecoration(t),t.initWithTwoActions(this._one.clone(),this._two.clone()),t},n.startWithTarget=function(t){sct.prototype.startWithTarget.call(this,t),this._one.startWithTarget(t),this._two.startWithTarget(t)},n.stop=function(){this._one.stop(),this._two.stop(),Qst.prototype.stop.call(this)},n.update=function(t){t=this._computeEaseTime(t),this._one&&this._one.update(t),this._two&&this._two.update(t)},n.reverse=function(){var t=e._actionOneTwo(this._one.reverse(),this._two.reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t},e}(sct);function _ct(t){var e=t instanceof Array?t:arguments;if(1===e.length)return b(1020),null;e.length>0&&null==e[e.length-1]&&T(1015);for(var n=e[0],i=1;i<e.length;i++)null!=e[i]&&(n=fct._actionOneTwo(n,e[i]));return n}fct._actionOneTwo=function(t,e){var n=new fct;return n.initWithTwoActions(t,e),n};var pct=function(t){function e(){return t.apply(this,arguments)||this}F(e,t);var n=e.prototype;return n.update=function(){},n.reverse=function(){var t=new e(this._duration);return this._cloneDecoration(t),this._reverseEaseList(t),t},n.clone=function(){var t=new e;return this._cloneDecoration(t),t.initWithDuration(this._duration),t},e}(sct);function dct(t){return new pct(t)}var mct,gct,vct,yct,xct,Sct,Tct,Act=function(t){function e(e){var n;return(n=t.call(this)||this)._other=null,e&&n.initWithAction(e),n}F(e,t);var n=e.prototype;return n.initWithAction=function(t){return t?t===this._other?(b(1029),!1):!!sct.prototype.initWithDuration.call(this,t._duration)&&(this._other=t,!0):(b(1028),!1)},n.clone=function(){var t=new e;return this._cloneDecoration(t),t.initWithAction(this._other.clone()),t},n.startWithTarget=function(t){sct.prototype.startWithTarget.call(this,t),this._other.startWithTarget(t)},n.update=function(t){t=this._computeEaseTime(t),this._other&&this._other.update(1-t)},n.reverse=function(){return this._other.clone()},n.stop=function(){this._other.stop(),Qst.prototype.stop.call(this)},e}(sct),Ect=t("TweenAction",function(t){function e(e,n,i){var a;if((a=t.call(this)||this)._opts=void 0,a._props=void 0,a._originProps=void 0,null==i)i=Object.create(null);else if(function(t){var e=" [Tween:] ",n=" option is not support in v + "+r,i=t;i.delay&&p(e+"delay"+n),i.repeat&&p(e+"repeat"+n),i.repeatDelay&&p(e+"repeatDelay"+n),i.interpolation&&p(e+"interpolation"+n),i.onStop&&p(e+"onStop"+n)}(i),i.easing&&"string"==typeof i.easing&&(i.easing=function(t){var e=t.charAt(0);if(/[A-Z]/.test(e)){var n=(t=t.replace(e,e.toLowerCase())).split("-");if(2===n.length){var i=n[0];if("linear"===i)t="linear";else{var r=n[1];switch(i){case"quadratic":t="quad"+r;break;case"quartic":t="quart"+r;break;case"quintic":t="quint"+r;break;case"sinusoidal":t="sine"+r;break;case"exponential":t="expo"+r;break;case"circular":t="circ"+r;break;default:t=i+r}}}}return t}(i.easing)),i.progress||(i.progress=a.progress),i.easing&&"string"==typeof i.easing){var o=i.easing;i.easing=e_[o],i.easing||E(1031,o)}for(var s in a._opts=i,a._props=Object.create(null),n)if(n.hasOwnProperty(s)){var c=n[s];if("function"==typeof c&&(c=c()),null!=c&&"string"!=typeof c){var l=void 0,u=void 0;void 0!==c.value&&(c.easing||c.progress)&&("string"==typeof c.easing?(l=e_[c.easing])||E(1031,c.easing):l=c.easing,u=c.progress,c=c.value);var h=Object.create(null);h.value=c,h.easing=l,h.progress=u,a._props[s]=h}}return a._originProps=n,a.initWithDuration(e),a}F(e,t);var n=e.prototype;return n.clone=function(){var t=new e(this._duration,this._originProps,this._opts);return this._cloneDecoration(t),t},n.startWithTarget=function(t){sct.prototype.startWithTarget.call(this,t);var e=!!this._opts.relative,n=this._props;for(var i in n){var r=t[i];if(void 0!==r){var a=n[i],o=a.value;if("number"==typeof r)a.start=r,a.current=r,a.end=e?r+o:o;else if("object"==typeof r)for(var s in null==a.start&&(a.start={},a.current={},a.end={}),o)isNaN(r[s])||(a.start[s]=r[s],a.current[s]=r[s],a.end[s]=e?r[s]+o[s]:o[s])}}this._opts.onStart&&this._opts.onStart(this.target)},n.update=function(t){var e=this.target;if(e){var n=this._props,i=this._opts,r=t;i.easing&&(r=i.easing(t));var a=i.progress;for(var o in n){var s=n[o],c=s.easing?s.easing(t):r,l=s.progress?s.progress:a,u=s.start,h=s.end;if("number"==typeof u)s.current=l(u,h,s.current,c);else if("object"==typeof u)for(var f in u)s.current[f]=l(u[f],h[f],s.current[f],c);e[o]=s.current}i.onUpdate&&i.onUpdate(this.target,t),1===t&&i.onComplete&&i.onComplete(this.target)}},n.progress=function(t,e,n,i){return t+(e-t)*i},e}(sct)),Cct=function(t){function e(e){var n;return(n=t.call(this)||this)._props=void 0,n._props={},void 0!==e&&n.init(e),n}F(e,t);var n=e.prototype;return n.init=function(t){for(var e in t)this._props[e]=t[e];return!0},n.update=function(){var t=this._props,e=this.target;for(var n in t)e[n]=t[n]},n.clone=function(){var t=new e;return t.init(this._props),t},e}(nct),bct=t("Tween",function(){function t(t){this._actions=[],this._finalAction=null,this._target=null,this._tag=Qst.TAG_INVALID,this._target=void 0===t?null:t}var e=t.prototype;return e.tag=function(t){return this._tag=t,this},e.then=function(t){return t instanceof Qst?this._actions.push(t.clone()):this._actions.push(t._union()),this},e.target=function(t){return this._target=t,this},e.start=function(){return this._target?(this._finalAction&&ect.instance.ActionManager.removeAction(this._finalAction),this._finalAction=this._union(),this._finalAction.setTag(this._tag),ect.instance.ActionManager.addAction(this._finalAction,this._target,!1),this):(p("Please set target to tween first"),this)},e.stop=function(){return this._finalAction&&ect.instance.ActionManager.removeAction(this._finalAction),this},e.clone=function(t){var e=this._union();return wct(t).then(e.clone())},e.union=function(){var t=this._union();return this._actions.length=0,this._actions.push(t),this},e.to=function(t,e,n){(n=n||Object.create(null)).relative=!1;var i=new Ect(t,e,n);return this._actions.push(i),this},e.by=function(t,e,n){(n=n||Object.create(null)).relative=!0;var i=new Ect(t,e,n);return this._actions.push(i),this},e.set=function(t){var e=new Cct(t);return this._actions.push(e),this},e.delay=function(t){var e=dct(t);return this._actions.push(e),this},e.call=function(t){var e=new oct(t,undefined,undefined);return this._actions.push(e),this},e.sequence=function(){var e=t._wrappedSequence.apply(t,arguments);return this._actions.push(e),this},e.parallel=function(){var e=t._wrappedParallel.apply(t,arguments);return this._actions.push(e),this},e.repeat=function(e,n){if(e===1/0)return this.repeatForever(n);var i,r=this._actions;return i=n instanceof t?n._union():r.pop(),r.push(function(t,e){return new uct(t,e)}(i,e)),this},e.repeatForever=function(e){var n,i=this._actions;return n=e instanceof t?e._union():i.pop(),i.push(function(t){return new hct(t)}(n)),this},e.reverseTime=function(e){var n,i=this._actions;return n=e instanceof t?e._union():i.pop(),i.push(function(t){return new Act(t)}(n)),this},e.hide=function(){var t=new rct;return this._actions.push(t),this},e.show=function(){var t=new ict;return this._actions.push(t),this},e.removeSelf=function(){var t=new act(!1);return this._actions.push(t),this},t.stopAll=function(){ect.instance.ActionManager.removeAllActions()},t.stopAllByTag=function(t,e){ect.instance.ActionManager.removeAllActionsByTag(t,e)},t.stopAllByTarget=function(t){ect.instance.ActionManager.removeAllActionsFromTarget(t)},e._union=function(){var t=this._actions;return 1===t.length?t[0]:lct(t)},e._destroy=function(){this.stop()},t._wrappedSequence=function(){var e=t._tmp_args;e.length=0;for(var n=arguments.length,i=0;i<n;i++){var r=e[i]=i<0||arguments.length<=i?void 0:arguments[i];r instanceof t&&(e[i]=r._union())}return lct.apply(lct,e)},t._wrappedParallel=function(){var e=t._tmp_args;e.length=0;for(var n=arguments.length,i=0;i<n;i++){var r=e[i]=i<0||arguments.length<=i?void 0:arguments[i];r instanceof t&&(e[i]=r._union())}return _ct.apply(_ct,e)},t}());function wct(t){return new bct(t)}function Pct(t){return p("tweenUtil' is deprecated, please use 'tween' instead "),new bct(t)}bct._tmp_args=[],i.Tween=bct,i.tween=wct,i.tweenUtil=Pct,function(t){t[t.ORTHO=0]="ORTHO",t[t.HEX=1]="HEX",t[t.ISO=2]="ISO"}(mct||(mct={})),Zt(mct),function(t){t[t.NONE=0]="NONE",t[t.MAP=1]="MAP",t[t.LAYER=2]="LAYER",t[t.OBJECTGROUP=3]="OBJECTGROUP",t[t.OBJECT=4]="OBJECT",t[t.TILE=5]="TILE"}(gct||(gct={})),Zt(gct),function(t){t[t.HORIZONTAL=2147483648]="HORIZONTAL",t[t.VERTICAL=1073741824]="VERTICAL",t[t.DIAGONAL=536870912]="DIAGONAL",t[t.FLIPPED_ALL=4026531840]="FLIPPED_ALL",t[t.FLIPPED_MASK=268435455]="FLIPPED_MASK"}(vct||(vct={})),Zt(vct),function(t){t[t.STAGGERAXIS_X=0]="STAGGERAXIS_X",t[t.STAGGERAXIS_Y=1]="STAGGERAXIS_Y"}(yct||(yct={})),Zt(yct),function(t){t[t.STAGGERINDEX_ODD=0]="STAGGERINDEX_ODD",t[t.STAGGERINDEX_EVEN=1]="STAGGERINDEX_EVEN"}(xct||(xct={})),Zt(xct),function(t){t[t.RightDown=0]="RightDown",t[t.RightUp=1]="RightUp",t[t.LeftDown=2]="LeftDown",t[t.LeftUp=3]="LeftUp"}(Sct||(Sct={})),Zt(Sct),function(t){t[t.RECT=0]="RECT",t[t.ELLIPSE=1]="ELLIPSE",t[t.POLYGON=2]="POLYGON",t[t.POLYLINE=3]="POLYLINE",t[t.IMAGE=4]="IMAGE",t[t.TEXT=5]="TEXT"}(Tct||(Tct={})),Zt(Tct);var Ict=function(){function t(){this.name="",this.firstGid=0,this.spacing=0,this.margin=0,this.sourceImage=void 0,this.imageName=null,this.imageSize=new Gi(0,0),this.tileOffset=new Ni(0,0),this._tileSize=new Gi(0,0),this.collection=!1}return t.prototype.rectForGID=function(t,e){var n=e||new Vi(0,0,0,0);n.width=this._tileSize.width,n.height=this._tileSize.height;var i=t;i&=vct.FLIPPED_MASK,i-=this.firstGid;var r=Math.floor((this.imageSize.width-2*this.margin+this.spacing)/(this._tileSize.width+this.spacing));return n.x=Math.round(i%r*(this._tileSize.width+this.spacing)+this.margin),n.y=Math.round(Math.floor(i/r)*(this._tileSize.height+this.spacing)+this.margin),n},t}(),Rct=function(){function t(){this.properties={},this.name="",this.objects=[],this.visible=!0,this.opacity=0,this.color=new _i(255,255,255,255),this.offset=new Ni(0,0),this.draworder="topdown",this.tintColor=null}var e=t.prototype;return e.getProperties=function(){return this.properties},e.setProperties=function(t){this.properties=t},t}(),Dct=function(){function t(){this.properties={},this.name="",this.layerSize=null,this.tiles=[],this.visible=!0,this.opacity=0,this.ownTiles=!0,this.minGID=1e5,this.maxGID=0,this.offset=new Ni(0,0),this.tintColor=null}var e=t.prototype;return e.getProperties=function(){return this.properties},e.setProperties=function(t){this.properties=t},t}();Dct.ATTRIB_NONE=1,Dct.ATTRIB_BASE64=2,Dct.ATTRIB_GZIP=4,Dct.ATTRIB_ZLIB=8;var Oct=function(){this.name="",this.visible=!0,this.width=0,this.height=0,this.offset=new Ni(0,0),this.opacity=0,this.trans=new _i(255,255,255,255),this.sourceImage=void 0,this.tintColor=null};function Mct(t){var e=Cq.HorizontalAlign;switch(t){case"center":return e.CENTER;case"right":return e.RIGHT;default:return e.LEFT}}function Nct(t){var e=Cq.VerticalAlign;switch(t){case"center":return e.CENTER;case"bottom":return e.BOTTOM;default:return e.TOP}}function Lct(t){if(!t)return new _i(0,0,0,255);if(8===(t=-1!==t.indexOf("#")?t.substring(1):t).length){var e=parseInt(t.substr(0,2),16)||255,n=parseInt(t.substr(2,2),16)||0,i=parseInt(t.substr(4,2),16)||0,r=parseInt(t.substr(6,2),16)||0;return new _i(n,i,r,e)}var a=parseInt(t.substr(0,2),16)||0,o=parseInt(t.substr(2,2),16)||0,s=parseInt(t.substr(4,2),16)||0;return new _i(a,o,s,255)}function Bct(t,e){for(var n=[],i=t.getElementsByTagName("properties"),r=0;r<i.length;++r)for(var a=i[r].getElementsByTagName("property"),o=0;o<a.length;++o)n.push(a[o]);e=e||{};for(var s=0;s<n.length;s++){var c=n[s],l=c.getAttribute("name"),u=c.getAttribute("type")||"string",h=c.getAttribute("value");"int"===u?h=parseInt(h):"float"===u?h=parseFloat(h):"bool"===u?h="true"===h:"color"===u&&(h=Lct(h)),e[l]=h}return e}var Fct,zct,Uct,kct,Gct,Hct,Vct,jct,Wct,Xct,qct,Yct,Kct,Qct,Zct,Jct,$ct=function(){function t(t,e,n,i,r){this.properties={},this.orientation=null,this.parentElement=null,this.parentGID=0,this.layerAttrs=0,this.storingCharacters=!1,this.currentString=null,this.renderOrder=Sct.RightDown,this._supportVersion=[1,4,0],this._objectGroups=[],this._allChildren=[],this._mapSize=new Gi(0,0),this._tileSize=new Gi(0,0),this._layers=[],this._tilesets=[],this._imageLayers=[],this._tileProperties=new Map,this._tileAnimations={},this._tsxContentMap=null,this._spriteFrameMap=null,this._spfSizeMap={},this._staggerAxis=null,this._staggerIndex=null,this._hexSideLength=0,this._imageLayerSPF=null,this.initWithXML(t,e,n,i,r)}var e=t.prototype;return e.getOrientation=function(){return this.orientation},e.setOrientation=function(t){this.orientation=t},e.getStaggerAxis=function(){return this._staggerAxis},e.setStaggerAxis=function(t){this._staggerAxis=t},e.getStaggerIndex=function(){return this._staggerIndex},e.setStaggerIndex=function(t){this._staggerIndex=t},e.getHexSideLength=function(){return this._hexSideLength},e.setHexSideLength=function(t){this._hexSideLength=t},e.getMapSize=function(){return new Gi(this._mapSize.width,this._mapSize.height)},e.setMapSize=function(t){this._mapSize.width=t.width,this._mapSize.height=t.height},e.getTileSize=function(){return new Gi(this._tileSize.width,this._tileSize.height)},e.setTileSize=function(t){this._tileSize.width=t.width,this._tileSize.height=t.height},e.getLayers=function(){return this._layers},e.setLayers=function(t){this._allChildren.push(t),this._layers.push(t)},e.getImageLayers=function(){return this._imageLayers},e.setImageLayers=function(t){this._allChildren.push(t),this._imageLayers.push(t)},e.getTilesets=function(){return this._tilesets},e.setTilesets=function(t){this._tilesets.push(t)},e.getObjectGroups=function(){return this._objectGroups},e.setObjectGroups=function(t){this._allChildren.push(t),this._objectGroups.push(t)},e.getAllChildren=function(){return this._allChildren},e.getParentElement=function(){return this.parentElement},e.setParentElement=function(t){this.parentElement=t},e.getParentGID=function(){return this.parentGID},e.setParentGID=function(t){this.parentGID=t},e.getLayerAttribs=function(){return this.layerAttrs},e.setLayerAttribs=function(t){this.layerAttrs=t},e.getStoringCharacters=function(){return this.storingCharacters},e.setStoringCharacters=function(t){this.storingCharacters=t},e.getProperties=function(){return this.properties},e.setProperties=function(t){this.properties=t},e.initWithXML=function(t,e,n,i,r){return this._tilesets.length=0,this._layers.length=0,this._imageLayers.length=0,this._tsxContentMap=e,this._spriteFrameMap=n,this._imageLayerSPF=r,this._spfSizeMap=i,this._objectGroups.length=0,this._allChildren.length=0,this.properties={},this._tileProperties=new Map,this._tileAnimations=new Map,this.currentString="",this.storingCharacters=!1,this.layerAttrs=Dct.ATTRIB_NONE,this.parentElement=null,this.parseXMLString(t)},e.parseXMLString=function(e,n){var i,r=(new XN).parse(e).documentElement,a=r.getAttribute("orientation"),o=r.getAttribute("staggeraxis"),s=r.getAttribute("staggerindex"),c=r.getAttribute("hexsidelength"),l=r.getAttribute("renderorder"),u=r.getAttribute("version")||"1.0.0";if("map"===r.nodeName){var h=u.split("."),f=this._supportVersion;for(i=0;i<f.length;i++){var _=parseInt(h[i])||0;if(f[i]<_){T(7216,u);break}}"orthogonal"===a?this.orientation=mct.ORTHO:"isometric"===a?this.orientation=mct.ISO:"hexagonal"===a?this.orientation=mct.HEX:null!==a&&T(7217,a),this.renderOrder="right-up"===l?Sct.RightUp:"left-up"===l?Sct.LeftUp:"left-down"===l?Sct.LeftDown:Sct.RightDown,"x"===o?this.setStaggerAxis(yct.STAGGERAXIS_X):"y"===o&&this.setStaggerAxis(yct.STAGGERAXIS_Y),"odd"===s?this.setStaggerIndex(xct.STAGGERINDEX_ODD):"even"===s&&this.setStaggerIndex(xct.STAGGERINDEX_EVEN),c&&this.setHexSideLength(parseFloat(c));var p=new Gi(0,0);p.width=parseFloat(r.getAttribute("width")),p.height=parseFloat(r.getAttribute("height")),this.setMapSize(p),(p=new Gi(0,0)).width=parseFloat(r.getAttribute("tilewidth")),p.height=parseFloat(r.getAttribute("tileheight")),this.setTileSize(p),this.properties=Bct(r)}var d=r.getElementsByTagName("tileset");for("map"!==r.nodeName&&(d=[]).push(r),i=0;i<d.length;i++){var m=d[i],g=m.getAttribute("source");if(g){var v=parseInt(m.getAttribute("firstgid")),y=this._tsxContentMap[g];y&&this.parseXMLString(y,v)}else{var x=m.getElementsByTagName("image"),S=x.length>1,A=x[0],E=A.getAttribute("source");E=E.replace(/\\/g,"/");var C=m.getElementsByTagName("tile"),w=C&&C.length||1,P=null,I=m.getAttribute("name")||"",R=parseInt(m.getAttribute("spacing"))||0,D=parseInt(m.getAttribute("margin"))||0,O=n||parseInt(m.getAttribute("firstgid"))||0,M=new Gi(0,0);M.width=parseFloat(m.getAttribute("tilewidth")),M.height=parseFloat(m.getAttribute("tileheight"));var N=m.getElementsByTagName("tileoffset")[0],L=0,B=0;N&&(L=parseFloat(N.getAttribute("x"))||0,B=parseFloat(N.getAttribute("y"))||0);for(var F=null,z=0;z<w;z++){var U=x[z]?x[z]:A;if(U){var k=U.getAttribute("source");if(k=k.replace(/\\/g,"/"),!F||S){if((F=new Ict).name=I,F.firstGid=O&vct.FLIPPED_MASK,F.tileOffset.x=L,F.tileOffset.y=B,F.collection=S,!S&&(F.imageName=k,F.imageSize.width=parseFloat(U.getAttribute("width"))||0,F.imageSize.height=parseFloat(U.getAttribute("height"))||0,F.sourceImage=this._spriteFrameMap[k],!F.sourceImage)){var G=t.getNameWithPostfix(k);if(F.imageName=G,F.sourceImage=this._spriteFrameMap[G],!F.sourceImage){var H=t.getShortName(k);F.imageName=H,F.sourceImage=this._spriteFrameMap[H],F.sourceImage||(console.error("[error]: "+H+" not find in ["+Object.keys(this._spriteFrameMap).join(", ")+"]"),b(7221,k),console.warn("Please try asset type of "+k+" to 'sprite-frame'"))}}F.spacing=R,F.margin=D,F._tileSize.width=M.width,F._tileSize.height=M.height,this.setTilesets(F)}if(P=C&&C[z]){this.parentGID=O+(parseInt(P.getAttribute("id"))||0);var V=P.getElementsByTagName("image");if(V&&V.length>0){var j=V[0],W=j.getAttribute("source");if(W=W.replace(/\\/g,"/"),F.imageName=W,F.imageSize.width=parseFloat(j.getAttribute("width"))||0,F.imageSize.height=parseFloat(j.getAttribute("height"))||0,F._tileSize.width=F.imageSize.width,F._tileSize.height=F.imageSize.height,F.sourceImage=this._spriteFrameMap[W],!F.sourceImage){var X=t.getNameWithPostfix(W);if(F.imageName=X,F.sourceImage=this._spriteFrameMap[X],!F.sourceImage){var q=t.getShortName(W);F.imageName=q,F.sourceImage=this._spriteFrameMap[q],F.sourceImage||(b(7221,W),console.warn("Please try asset type of "+W+" to 'sprite-frame'"))}}F.firstGid=this.parentGID&vct.FLIPPED_MASK}var Y=(vct.FLIPPED_MASK&this.parentGID)>>>0;this._tileProperties.set(Y,Bct(P));var K=P.getElementsByTagName("animation");if(K&&K.length>0){var Q=K[0].getElementsByTagName("frame"),Z={frames:[],dt:0,frameIdx:0};this._tileAnimations.set(Y,Z);for(var J=Z.frames,$=0;$<Q.length;$++){var tt=Q[$],et=O+(parseInt(tt.getAttribute("tileid"))||0),nt=parseFloat(tt.getAttribute("duration"))||0;J.push({tileid:et,duration:nt/1e3,grid:null})}}}}}}}var it=r.childNodes;for(i=0;i<it.length;i++){var rt=it[i];if(!this._shouldIgnoreNode(rt)){if("imagelayer"===rt.nodeName){var at=this._parseImageLayer(rt);at&&this.setImageLayers(at)}if("layer"===rt.nodeName){var ot=this._parseLayer(rt);this.setLayers(ot)}if("objectgroup"===rt.nodeName){var st=this._parseObjectGroup(rt);this.setObjectGroups(st)}}}return r},e._shouldIgnoreNode=function(t){return 3===t.nodeType||8===t.nodeType||4===t.nodeType},e._parseImageLayer=function(t){var e=t.getElementsByTagName("image");if(!e||0===e.length)return null;var n=new Oct;n.name=t.getAttribute("name"),n.offset.x=parseFloat(t.getAttribute("offsetx"))||0,n.offset.y=parseFloat(t.getAttribute("offsety"))||0;var i=t.getAttribute("visible");n.visible=!("0"===i);var r=t.getAttribute("opacity");n.opacity=r?Math.round(255*parseFloat(r)):255;var a=t.getAttribute("tintcolor");n.tintColor=a?Lct(a):null;var o=e[0],s=o.getAttribute("source");return n.sourceImage=this._imageLayerSPF[s],n.width=parseInt(o.getAttribute("width"))||0,n.height=parseInt(o.getAttribute("height"))||0,n.trans=Lct(o.getAttribute("trans")),n.sourceImage?n:(b(7221,s),console.warn("Please try asset type of "+s+" to 'sprite-frame'"),null)},e._parseLayer=function(t){var e=t.getElementsByTagName("data")[0],n=new Dct;n.name=t.getAttribute("name");var i=new Gi(0,0);i.width=parseFloat(t.getAttribute("width")),i.height=parseFloat(t.getAttribute("height")),n.layerSize=i;var r=t.getAttribute("visible");n.visible=!("0"===r);var a=t.getAttribute("opacity");n.opacity=a?Math.round(255*parseFloat(a)):255,n.offset=new Ni(parseFloat(t.getAttribute("offsetx"))||0,parseFloat(t.getAttribute("offsety"))||0);var o=t.getAttribute("tintcolor");n.tintColor=o?Lct(o):null;for(var s="",c=0;c<e.childNodes.length;c++)s+=e.childNodes[c].nodeValue;s=s.trim();var l,u=e.getAttribute("compression"),h=e.getAttribute("encoding");if(u&&"gzip"!==u&&"zlib"!==u)return T(7218),null;switch(u){case"gzip":l=cat.unzipBase64AsArray(s,4);break;case"zlib":l=function(t){if(t.length%4!=0)return null;for(var e=t.length/4,n=window.Uint32Array?new Uint32Array(e):[],i=0;i<e;i++){var r=4*i;n[i]=t[r]+256*t[r+1]+65536*t[r+2]+t[r+3]*(1<<24)}return n}(new iit.Inflate(cat.Base64.decodeAsArray(s,1)).decompress());break;case null:case"":if("base64"===h)l=cat.Base64.decodeAsArray(s,4);else if("csv"===h){l=[];for(var f=s.split(","),_=0;_<f.length;_++)l.push(parseInt(f[_]))}else{var p=e.getElementsByTagName("tile");l=[];for(var d=0;d<p.length;d++)l.push(parseInt(p[d].getAttribute("gid")))}break;default:this.layerAttrs===Dct.ATTRIB_NONE&&T(7219)}return l&&(n.tiles=new Uint32Array(l)),n.properties=Bct(t),n},e._parseObjectGroup=function(t){var e=new Rct;e.name=t.getAttribute("name")||"",e.offset=new Ni(parseFloat(t.getAttribute("offsetx")),parseFloat(t.getAttribute("offsety")));var n=t.getAttribute("opacity");e.opacity=n?Math.round(255*parseFloat(n)):255;var i=t.getAttribute("tintcolor");e.tintColor=i?Lct(i):null;var r=t.getAttribute("visible");r&&0===parseInt(r)&&(e.visible=!1);var a=t.getAttribute("color");a&&e.color.fromHEX(a);var o=t.getAttribute("draworder");o&&(e.draworder=o),e.setProperties(Bct(t));var s=t.getElementsByTagName("object");if(s){for(var c=0;c<s.length;c++){var l=s[c],u={};u.id=l.getAttribute("id")||c,u.name=l.getAttribute("name")||"",u.width=parseFloat(l.getAttribute("width"))||0,u.height=parseFloat(l.getAttribute("height"))||0,u.x=parseFloat(l.getAttribute("x"))||0,u.y=parseFloat(l.getAttribute("y"))||0,u.rotation=parseFloat(l.getAttribute("rotation"))||0,Bct(l,u);var h=l.getAttribute("visible");u.visible=!(h&&0===parseInt(h));var f=l.getElementsByTagName("text");if(f&&f.length>0){var _=f[0];u.type=Tct.TEXT,u.wrap="1"===_.getAttribute("wrap"),u.color=Lct(_.getAttribute("color")),u.halign=Mct(_.getAttribute("halign")),u.valign=Nct(_.getAttribute("valign")),u.pixelsize=parseInt(_.getAttribute("pixelsize"))||16,u.text=_.childNodes[0].nodeValue}var p=l.getAttribute("gid");p&&(u.gid=parseInt(p),u.type=Tct.IMAGE);var d=l.getElementsByTagName("ellipse");d&&d.length>0&&(u.type=Tct.ELLIPSE);var m=l.getElementsByTagName("polygon");if(m&&m.length>0){u.type=Tct.POLYGON;var g=m[0].getAttribute("points");g&&(u.points=this._parsePointsString(g))}var v=l.getElementsByTagName("polyline");if(v&&v.length>0){u.type=Tct.POLYLINE;var y=v[0].getAttribute("points");y&&(u.polylinePoints=this._parsePointsString(y))}u.type||(u.type=Tct.RECT),e.objects.push(u)}"index"!==o&&e.objects.sort((function(t,e){return t.y-e.y}))}return e},e._parsePointsString=function(t){if(!t)return null;for(var e=[],n=t.split(" "),i=0;i<n.length;i++){var r=n[i].split(",");e.push({x:parseFloat(r[0]),y:parseFloat(r[1])})}return e},e.setTileAnimations=function(t){this._tileAnimations=t},e.getTileAnimations=function(){return this._tileAnimations},e.getTileProperties=function(){return this._tileProperties},e.setTileProperties=function(t){this._tileProperties=t},e.getCurrentString=function(){return this.currentString},e.setCurrentString=function(t){this.currentString=t},t.getNameWithPostfix=function(t){var e=(t=t.replace(/\\/g,"/")).lastIndexOf("/")+1,n=t.length;return t.substring(e,n)},t.getShortName=function(t){var e=(t=t.replace(/\\/g,"/")).lastIndexOf("/")+1,n=t.lastIndexOf(".");return n=n<0?t.length:n,t.substring(e,n)},L(t,[{key:"mapSize",get:function(){return this._mapSize}},{key:"tileSize",get:function(){return this._tileSize}},{key:"mapWidth",get:function(){return this._mapSize.width},set:function(t){this._mapSize.width=t}},{key:"mapHeight",get:function(){return this._mapSize.height},set:function(t){this._mapSize.height=t}},{key:"tileWidth",get:function(){return this._tileSize.width},set:function(t){this._tileSize.width=t}},{key:"tileHeight",get:function(){return this._tileSize.height},set:function(t){this._tileSize.height=t}}]),t}(),tlt=t("TiledTile",(Fct=nl("cc.TiledTile"),zct=vl(),Uct=pl(),kct=il(FW),Gct=Bl(Se),Hct=Bl(Se),Vct=Bl(Se),jct=Bl(Se),Wct=Bl(Se),Fct(Xct=zct(Xct=Uct(Xct=kct(Xct=_l((Qct=function(t){function e(){var e;return(e=t.call(this)||this)._layer=null,X(e,"_x",Yct,V(e)),X(e,"_y",Kct,V(e)),e}F(e,t);var n=e.prototype;return n.onEnable=function(){var t=this.node.parent;this._layer=t.getComponent("cc.TiledLayer"),this._resetTile(),this.updateInfo()},n.onDisable=function(){this._resetTile()},n._resetTile=function(){this._layer&&this._layer.getTiledTileAt(this._x,this._y)===this&&this._layer.setTiledTileAt(this._x,this._y,null)},n.updateInfo=function(){if(this._layer){var t=this._x,e=this._y;if(this._layer.getTiledTileAt(t,e))p("There is already a TiledTile at [%s, %s]",t,e);else{var n=this._layer.getPositionAt(t,e);this.node.setPosition(n.x,n.y),this._layer.setTiledTileAt(t,e,this)}}},L(e,[{key:"x",get:function(){return this._x},set:function(t){t!==this._x&&(this._layer&&this._layer.isInvalidPosition(t,this._y)?p("Invalid x, the valid value is between [%s] ~ [%s]",0,this._layer.layerSize.width):(this._resetTile(),this._x=t,this.updateInfo()))}},{key:"y",get:function(){return this._y},set:function(t){t!==this._y&&(this._layer&&this._layer.isInvalidPosition(this._x,t)?p("Invalid y, the valid value is between [%s] ~ [%s]",0,this._layer.layerSize.height):(this._resetTile(),this._y=t,this.updateInfo()))}},{key:"grid",get:function(){return this._layer?this._layer.getTileGIDAt(this._x,this._y):0},set:function(t){this._layer&&this._layer.setTileGIDAt(t,this._x,this._y)}}]),e}($u),Yct=q((qct=Qct).prototype,"_x",[Gct],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Kct=q(qct.prototype,"_y",[Hct],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),q(qct.prototype,"x",[Vct],Object.getOwnPropertyDescriptor(qct.prototype,"x"),qct.prototype),q(qct.prototype,"y",[jct],Object.getOwnPropertyDescriptor(qct.prototype,"y"),qct.prototype),q(qct.prototype,"grid",[Wct],Object.getOwnPropertyDescriptor(qct.prototype,"grid"),qct.prototype),Xct=qct))||Xct)||Xct)||Xct)||Xct)||Xct));function elt(t,e,n){var i=n||t.sourceImage,r=i.texture,a=t.collection;if(!t.imageSize.width||!t.imageSize.height){var o=t.sourceImage;t.imageSize.width=o.width,t.imageSize.height=o.height}var s=t.imageSize.width,c=t.imageSize.height,l=t._tileSize.width,u=t._tileSize.height,h=i.width,f=i.height,_=t.spacing,p=t.margin,d=1;if(!a){var m=Math.floor((s-2*p+_)/(l+_)),g=Math.floor((c-2*p+_)/(u+_));d=Math.max(1,g*m)}for(var v=t.firstGid,y=null,x=!!e.get(v),S=t.firstGid+d,T=v;T<S&&(x&&!e.get(T)&&(x=!1),x||!e.get(T));++T){if(y={tileset:t,x:0,y:0,width:l,height:u,t:0,l:0,r:0,b:0,cx:0,cy:0,offsetX:0,offsetY:0,rotated:!1,gid:T,spriteFrame:i,texture:r},t.rectForGID(T,y),!n||d>1)if(n){y._name=n.name;var A=n.unbiasUV[0],E=n.rotated?n.unbiasUV[1]:n.unbiasUV[5];y.l=A+(y.x+.5)/h,y.t=E+(y.y+.5)/f,y.r=A+(y.x+y.width-.5)/h,y.b=E+(y.y+y.height-.5)/f,y._rect=new Vi(y.x,y.y,y.width,y.height)}else y.l=y.x/h,y.t=y.y/f,y.r=(y.x+y.width)/h,y.b=(y.y+y.height)/f,y._rect=new Vi(y.x,y.y,y.width,y.height);else n.rotated?(y._rotated=!0,y._name=n.name,y._rect=n.getRect(),y.l=n.unbiasUV[0],y.t=n.unbiasUV[1],y.r=n.unbiasUV[4],y.b=n.unbiasUV[3]):(y._name=n.name,y._rect=n.getRect(),y.l=n.unbiasUV[0],y.t=n.unbiasUV[5],y.r=n.unbiasUV[2],y.b=n.unbiasUV[1]);y.cx=(y.l+y.r)/2,y.cy=(y.t+y.b)/2,e.set(T,y)}}for(var nlt,ilt,rlt,alt,olt,slt,clt,llt,ult,hlt,flt,_lt,plt,dlt,mlt,glt,vlt,ylt,xlt,Slt,Tlt,Alt,Elt,Clt,blt,wlt,Plt,Ilt,Rlt,Dlt,Olt,Mlt,Nlt,Llt,Blt,Flt,zlt,Ult,klt=new Ri,Glt=new Ni,Hlt=new di,Vlt=new di,jlt={row:0,col:0},Wlt=t("TiledUserNodeData",nl("cc.TiledUserNodeData")(Zct=function(t){function e(){var e;return(e=t.call(this)||this)._index=-1,e._row=-1,e._col=-1,e._tiledLayer=null,e}return F(e,t),e}($u))||Zct),Xlt=t("TiledLayer",nl("cc.TiledLayer")(Jct=function(t){function e(){var e;return(e=t.call(this)||this)._userNodeGrid={},e._userNodeMap={},e._userNodeDirty=!1,e.tiledTiles=[],e._viewPort={x:-1,y:-1,width:-1,height:-1},e._cullingRect={leftDown:{row:-1,col:-1},rightTop:{row:-1,col:-1}},e._cullingDirty=!0,e._rightTop={row:-1,col:-1},e._layerInfo=null,e._mapInfo=null,e._topOffset=0,e._downOffset=0,e._leftOffset=0,e._rightOffset=0,e.tiles=[],e.vertices=[],e._verticesDirty=!0,e._layerName="",e._layerSize=void 0,e._minGID=void 0,e._maxGID=void 0,e._layerOrientation=null,e._opacity=void 0,e._tintColor=void 0,e.texGrids=null,e._textures=[],e._tilesets=[],e._leftDownToCenterX=0,e._leftDownToCenterY=0,e._hasTiledNodeGrid=!1,e._hasAniGrid=!1,e._animations=null,e._enableCulling=void 0,e.colorChanged=!1,e._properties=void 0,e.renderOrder=void 0,e._staggerAxis=void 0,e._staggerIndex=void 0,e._hexSideLength=void 0,e._mapTileSize=void 0,e._odd_even=void 0,e._diffX1=void 0,e._diffY1=void 0,e._useAutomaticVertexZ=void 0,e._vertexZvalue=void 0,e._offset=void 0,e._meshRenderDataArray=null,e._meshRenderDataArrayIdx=0,e}F(e,t);var n=e.prototype;return n.hasTiledNode=function(){return this._hasTiledNodeGrid},n.hasAnimation=function(){return this._hasAniGrid},n.addUserNode=function(t){var e=t.getComponent(Wlt);return e?(p("CCTiledLayer:addUserNode node has been added"),!1):(e=t.addComponent(Wlt),t.parent=this.node,this._userNodeMap[t.uuid]=e,e._row=-1,e._col=-1,e._tiledLayer=this,this._nodeLocalPosToLayerPos(t.getPosition(),Glt),this._positionToRowCol(Glt.x,Glt.y,jlt),this._addUserNodeToGrid(e,jlt),this._updateCullingOffsetByUserNode(t),t.on(WA.TRANSFORM_CHANGED,this._userNodePosChange,e),t.on(WA.SIZE_CHANGED,this._userNodeSizeChange,e),!0)},n.removeUserNode=function(t){var e=t.getComponent(Wlt);return e?(t.off(WA.TRANSFORM_CHANGED,this._userNodePosChange,e),t.off(WA.SIZE_CHANGED,this._userNodeSizeChange,e),this._removeUserNodeFromGrid(e),delete this._userNodeMap[t.uuid],t._removeComponent(e),e.destroy(),t.removeFromParent(),!0):(p("CCTiledLayer:removeUserNode node is not exist"),!1)},n.destroyUserNode=function(t){this.removeUserNode(t),t.destroy()},n._nodeLocalPosToLayerPos=function(t,e){e.x=t.x+this._leftDownToCenterX,e.y=t.y+this._leftDownToCenterY},n.getNodesByRowCol=function(t,e){var n=this._userNodeGrid[t];return n?n[e]:null},n.getNodesCountByRow=function(t){var e=this._userNodeGrid[t];return e?e.count:0},n._updateAllUserNode=function(){for(var t in this._userNodeGrid={},this._userNodeMap){var e=this._userNodeMap[t];this._nodeLocalPosToLayerPos(e.node.getPosition(),Glt),this._positionToRowCol(Glt.x,Glt.y,jlt),this._addUserNodeToGrid(e,jlt),this._updateCullingOffsetByUserNode(e.node)}},n._updateCullingOffsetByUserNode=function(t){var e=t._uiProps.uiTransformComp.contentSize;this._topOffset<e.height&&(this._topOffset=e.height),this._downOffset<e.height&&(this._downOffset=e.height),this._leftOffset<e.width&&(this._leftOffset=e.width),this._rightOffset<e.width&&(this._rightOffset=e.width)},n._userNodeSizeChange=function(){var t=this.node,e=this._tiledLayer;e._updateCullingOffsetByUserNode(t),e._userNodeDirty=!0,e.markForUpdateRenderData()},n._userNodePosChange=function(){var t=this,e=t.node,n=t._tiledLayer;n._nodeLocalPosToLayerPos(e.getPosition(),Glt),n._positionToRowCol(Glt.x,Glt.y,jlt),n._limitInLayer(jlt),jlt.row===t._row&&jlt.col===t._col||(n._removeUserNodeFromGrid(t),n._addUserNodeToGrid(t,jlt))},n._removeUserNodeFromGrid=function(t){var e=t._row,n=t._col,i=t._index,r=this._userNodeGrid[e],a=r&&r[n];a&&(r.count--,a.count--,a.list[i]=null,a.count<=0&&(a.list.length=0,a.count=0)),t._row=-1,t._col=-1,t._index=-1,this._userNodeDirty=!0,this.markForUpdateRenderData()},n._limitInLayer=function(t){var e=t.row,n=t.col;e<0&&(t.row=0),e>this._rightTop.row&&(t.row=this._rightTop.row),n<0&&(t.col=0),n>this._rightTop.col&&(t.col=this._rightTop.col)},n._addUserNodeToGrid=function(t,e){var n=e.row,i=e.col,r=this._userNodeGrid[n]=this._userNodeGrid[n]||{count:0},a=r[i]=r[i]||{count:0,list:[]};t._row=n,t._col=i,t._index=a.list.length,r.count++,a.count++,a.list.push(t),this._userNodeDirty=!0},n.isUserNodeDirty=function(){return this._userNodeDirty},n.setUserNodeDirty=function(t){this._userNodeDirty=t},n.onEnable=function(){t.prototype.onEnable.call(this),this.node.on(WA.ANCHOR_CHANGED,this._syncAnchorPoint,this),this.node.on(WA.TRANSFORM_CHANGED,this.updateCulling,this),this.node.on(WA.SIZE_CHANGED,this.updateCulling,this),this.node.parent.on(WA.TRANSFORM_CHANGED,this.updateCulling,this),this.node.parent.on(WA.SIZE_CHANGED,this.updateCulling,this),this.markForUpdateRenderData(),this.scheduleOnce(this.updateCulling.bind(this))},n.onDisable=function(){var e,n;t.prototype.onDisable.call(this),null===(e=this.node.parent)||void 0===e||e.off(WA.SIZE_CHANGED,this.updateCulling,this),null===(n=this.node.parent)||void 0===n||n.off(WA.TRANSFORM_CHANGED,this.updateCulling,this),this.node.off(WA.SIZE_CHANGED,this.updateCulling,this),this.node.off(WA.TRANSFORM_CHANGED,this.updateCulling,this),this.node.off(WA.ANCHOR_CHANGED,this._syncAnchorPoint,this)},n._syncAnchorPoint=function(){var t=this.node,e=t._uiProps.uiTransformComp,n=t.getScale();this._leftDownToCenterX=e.width*e.anchorX*n.x,this._leftDownToCenterY=e.height*e.anchorY*n.y,this._cullingDirty=!0,this.markForUpdateRenderData()},n.getLayerName=function(){return this._layerName},n.setLayerName=function(t){this._layerName=t},n.getProperty=function(t){return this._properties[t]},n.getPositionAt=function(t,e){var n;switch(void 0!==e?(n=Math.floor(t),e=Math.floor(e)):(n=Math.floor(t.x),e=Math.floor(t.y)),this._layerOrientation){case mct.ORTHO:return this._positionForOrthoAt(n,e);case mct.ISO:return this._positionForIsoAt(n,e);case mct.HEX:return this._positionForHexAt(n,e)}return null},n.isInvalidPosition=function(t,e){return t>=this._layerSize.width||e>=this._layerSize.height||t<0||e<0},n._positionForIsoAt=function(t,e){var n=0,i=0,r=Math.floor(t)+Math.floor(e)*this._layerSize.width,a=this.tiles[r];if(a){var o=(a&vct.FLIPPED_MASK)>>>0,s=this.texGrids.get(o).tileset.tileOffset;n=s.x,i=s.y}return new Ni(.5*this._mapTileSize.width*(this._layerSize.height+t-e-1)+n,.5*this._mapTileSize.height*(this._layerSize.width-t+this._layerSize.height-e-2)-i)},n._positionForOrthoAt=function(t,e){var n=0,i=0,r=Math.floor(t)+Math.floor(e)*this._layerSize.width,a=this.tiles[r];if(a){var o=(a&vct.FLIPPED_MASK)>>>0,s=this.texGrids.get(o).tileset.tileOffset;n=s.x,i=s.y}return new Ni(t*this._mapTileSize.width+n,(this._layerSize.height-e-1)*this._mapTileSize.height-i)},n._positionForHexAt=function(t,e){var n,i=this._mapTileSize.width,r=this._mapTileSize.height,a=this._layerSize.height,o=Math.floor(t)+Math.floor(e)*this._layerSize.width,s=(this.tiles[o]&vct.FLIPPED_MASK)>>>0;n=this.texGrids.get(s)?this.texGrids.get(s).tileset.tileOffset:{x:0,y:0};var c=this._staggerIndex===xct.STAGGERINDEX_ODD?1:-1,l=0,u=0,h=0,f=0;switch(this._staggerAxis){case yct.STAGGERAXIS_Y:h=0,e%2==1&&(h=i/2*c),l=t*i+h+n.x,u=(a-e-1)*(r-(r-this._hexSideLength)/2)-n.y;break;case yct.STAGGERAXIS_X:f=0,t%2==1&&(f=r/2*-c),l=t*(i-(i-this._hexSideLength)/2)+n.x,u=(a-e-1)*r+f-n.y}return new Ni(l,u)},n.setTilesGIDAt=function(t,e,n,i){if(t&&0!==t.length&&!(i<=0)){n<0&&(n=0),e<0&&(e=0);for(var r=0,a=e+i,o=n;;o++)for(var s=e;s<a;s++){if(r>=t.length)return;this._updateTileForGID(t[r],s,o),r++}}},n.setTileGIDAt=function(t,e,n,i){var r=(t&vct.FLIPPED_MASK)>>>0;if(e=Math.floor(e),n=Math.floor(n),this.isInvalidPosition(e,n))throw new Error("cc.TiledLayer.setTileGIDAt(): invalid position");this.tiles&&this._tilesets&&0!==this._tilesets.length?0!==r&&r<this._tilesets[0].firstGid?T(7239,t):(i=i||0,this._updateTileForGID((r|i)>>>0,e,n)):T(7238)},n._updateTileForGID=function(t,e,n){var i=0|e+n*this._layerSize.width;if(!(i>=this.tiles.length)&&t!==this.tiles[i]){var r=(t&vct.FLIPPED_MASK)>>>0;this.texGrids.get(r)?(this.tiles[i]=t,this._updateVertex(e,n)):this.tiles[i]=0,this._cullingDirty=!0}},n.getTileGIDAt=function(t,e){if(this.isInvalidPosition(t,e))throw new Error("cc.TiledLayer.getTileGIDAt(): invalid position");if(!this.tiles)return T(7237),null;var n=Math.floor(t)+Math.floor(e)*this._layerSize.width;return(this.tiles[n]&vct.FLIPPED_MASK)>>>0},n.getTileFlagsAt=function(t,e){if(this.isInvalidPosition(t,e))throw new Error("TiledLayer.getTileFlagsAt: invalid position");if(!this.tiles)return T(7240),null;var n=Math.floor(t)+Math.floor(e)*this._layerSize.width;return(this.tiles[n]&vct.FLIPPED_ALL)>>>0},n.setCullingDirty=function(t){this._cullingDirty=t},n.isCullingDirty=function(){return this._cullingDirty},n.updateViewPort=function(t,e,n,i){if(this._viewPort.width!==n||this._viewPort.height!==i||this._viewPort.x!==t||this._viewPort.y!==e){this._viewPort.x=t,this._viewPort.y=e,this._viewPort.width=n,this._viewPort.height=i;var r=1;this._layerOrientation===mct.ISO&&(r=2);var a=this._viewPort.x-this._offset.x+this._leftDownToCenterX,o=this._viewPort.y-this._offset.y+this._leftDownToCenterY,s=a-this._leftOffset,c=o-this._downOffset,l=a+n+this._rightOffset,u=o+i+this._topOffset,h=this._cullingRect.leftDown,f=this._cullingRect.rightTop;s<0&&(s=0),c<0&&(c=0),this._positionToRowCol(s,c,jlt),jlt.row-=r,jlt.col-=r,jlt.row=jlt.row>0?jlt.row:0,jlt.col=jlt.col>0?jlt.col:0,jlt.row===h.row&&jlt.col===h.col||(h.row=jlt.row,h.col=jlt.col,this._cullingDirty=!0),l<0||u<0?(jlt.row=-1,jlt.col=-1):(this._positionToRowCol(l,u,jlt),jlt.row++,jlt.col++),jlt.row>this._rightTop.row&&(jlt.row=this._rightTop.row),jlt.col>this._rightTop.col&&(jlt.col=this._rightTop.col),jlt.row===f.row&&jlt.col===f.col||(f.row=jlt.row,f.col=jlt.col,this._cullingDirty=!0,this.markForUpdateRenderData())}},n._positionToRowCol=function(t,e,n){var i=this._mapTileSize.width,r=this._mapTileSize.height,a=.5*i,o=.5*r,s=0,c=0,l=0,u=0,h=this._staggerAxis;switch(this._layerOrientation){case mct.ORTHO:c=Math.floor(t/i),s=Math.floor(e/r);break;case mct.ISO:c=Math.floor(t/a),s=Math.floor(e/o);break;case mct.HEX:h===yct.STAGGERAXIS_Y?(l=(s=Math.floor(e/(r-this._diffY1)))%2==1?a*this._odd_even:0,c=Math.floor((t-l)/i)):(u=(c=Math.floor(t/(i-this._diffX1)))%2==1?o*-this._odd_even:0,s=Math.floor((e-u)/r))}return n.row=s,n.col=c,n},n.updateCulling=function(){if(this._enableCulling){this.node.updateWorldTransform(),Ri.invert(klt,this.node.getWorldMatrix());var t=WM.root.batcher2D.getFirstRenderCamera(this.node);t&&(Hlt.x=0,Hlt.y=0,Hlt.z=0,Vlt.x=t.width,Vlt.y=t.height,Vlt.z=0,t.screenToWorld(Hlt,Hlt),t.screenToWorld(Vlt,Vlt),di.transformMat4(Hlt,Hlt,klt),di.transformMat4(Vlt,Vlt,klt),this.updateViewPort(Hlt.x,Hlt.y,Vlt.x-Hlt.x,Vlt.y-Hlt.y))}},n.getLayerOrientation=function(){return this._layerOrientation},n.getProperties=function(){return this._properties},n._updateVertex=function(t,e){var n=vct.FLIPPED_MASK,i=this.vertices,r=this._layerOrientation,a=this.tiles;if(a){var o,s,c,l,u=this._rightTop,h=this._mapTileSize.width,f=this._mapTileSize.height,_=.5*h,p=.5*f,d=this._layerSize.height,m=this._layerSize.width,g=this.texGrids,v=0,y=0;r===mct.HEX&&(o=this._staggerAxis,s=this._diffX1,c=this._diffY1,l=this._odd_even);var x,S,T,A=0,E=0,C=0,b=0,w=e*m+t;x=(a[w]&n)>>>0;var P=g.get(x);if(P){switch(this._animations.get(x)&&(this._hasAniGrid=this._hasAniGrid||!0),r){case mct.ORTHO:v=(A=t)*h,y=(E=d-e-1)*f;break;case mct.ISO:v=_*(A=d+t-e-1),y=p*(E=d+m-t-e-2);break;case mct.HEX:v=t*(h-s)+(o===yct.STAGGERAXIS_Y&&e%2==1?_*l:0),y=(d-e-1)*(f-c)+(o===yct.STAGGERAXIS_X&&t%2==1?p*-l:0),A=t,E=d-e-1}var I=i[E]=i[E]||{minCol:0,maxCol:0},R=I[A]=I[A]||{};I.minCol>A&&(I.minCol=A),I.maxCol<A&&(I.maxCol=A),u.row<E&&(u.row=E,r===mct.ISO&&(u.row+=1)),u.col<A&&(u.col=A,r===mct.ISO&&(u.col+=1));var D=P.tileset.tileOffset;v+=this._offset.x+D.x+P.offsetX,y+=this._offset.y-D.y-P.offsetY,C=(C=-D.y+P.tileset._tileSize.height-f)<0?0:C,S=D.y<0?0:D.y,T=-D.x<0?0:-D.x,b=(b=D.x+P.tileset._tileSize.width-h)<0?0:b,this._rightOffset<T&&(this._rightOffset=T),this._leftOffset<b&&(this._leftOffset=b),this._topOffset<S&&(this._topOffset=S),this._downOffset<C&&(this._downOffset=C),R.left=v,R.bottom=y,R.index=w,this._cullingDirty=!0}}},n._updateVertices=function(){if(this.vertices.length=0,this.tiles){var t=this._rightTop;t.row=-1,t.col=-1;var e=this._layerSize.height,n=this._layerSize.width;this._topOffset=0,this._downOffset=0,this._leftOffset=0,this._rightOffset=0,this._hasAniGrid=!1;for(var i=0;i<e;++i)for(var r=0;r<n;++r)this._updateVertex(r,i);this._verticesDirty=!1}},n.getTiledTileAt=function(t,e,n){if(this.isInvalidPosition(t,e))throw new Error("TiledLayer.getTiledTileAt: invalid position");if(!this.tiles)return T(7236),null;var i=Math.floor(t)+Math.floor(e)*this._layerSize.width,r=this.tiledTiles[i];if(!r&&n){var a=new qC;return(r=a.addComponent(tlt))._x=t,r._y=e,r._layer=this,r.updateInfo(),a.parent=this.node,r}return r},n.setTiledTileAt=function(t,e,n){if(this.isInvalidPosition(t,e))throw new Error("TiledLayer.setTiledTileAt: invalid position");if(!this.tiles)return T(7236),null;var i=Math.floor(t)+Math.floor(e)*this._layerSize.width;return this.tiledTiles[i]=n,this._cullingDirty=!0,this._hasTiledNodeGrid=!!n||this.tiledTiles.some((function(t){return!!t})),n},n.getTexture=function(t){return t=t||0,this._textures&&t>=0&&this._textures.length>t?this._textures[t]:null},n.getTextures=function(){return this._textures},n.setTexture=function(t){this.setTextures([t])},n.setTextures=function(t){this._textures=t,this.markForUpdateRenderData()},n.getLayerSize=function(){return this._layerSize},n.getMapTileSize=function(){return this._mapTileSize},n.getTileSet=function(t){return t=t||0,this._tilesets&&t>=0&&this._tilesets.length>t?this._tilesets[t]:null},n.getTileSets=function(){return this._tilesets},n.setTileSet=function(t){this.setTileSets([t])},n.setTileSets=function(t){this._tilesets=t;var e=this._textures=[],n=this.texGrids;n.clear();for(var i=0;i<t.length;i++){var r=t[i];r&&(e[i]=r.sourceImage)}for(var a=0,o=t.length;a<o;++a){var s=t[a];s&&elt(s,n,s.sourceImage)}this._prepareToRender()},n.init=function(t,e,n,i,r){this._cullingDirty=!0,this._layerInfo=t,this._mapInfo=e;var a=t.layerSize;this._layerName=t.name,this.tiles=t.tiles,this._properties=t.properties,this._layerSize=a,this._minGID=t.minGID,this._maxGID=t.maxGID,this._opacity=t.opacity,t.tintColor&&(this._tintColor=t.tintColor),this.renderOrder=e.renderOrder,this._staggerAxis=e.getStaggerAxis(),this._staggerIndex=e.getStaggerIndex(),this._hexSideLength=e.getHexSideLength(),this._animations=e.getTileAnimations(),this._tilesets=n,this._textures=i,this.texGrids=r,this._layerOrientation=e.orientation,this._mapTileSize=e.getTileSize();var o=this._mapTileSize.width,s=this._mapTileSize.height,c=this._layerSize.width,l=this._layerSize.height;if(this._layerOrientation===mct.HEX){var u=0,h=0;this._odd_even=this._staggerIndex===xct.STAGGERINDEX_ODD?1:-1,this._staggerAxis===yct.STAGGERAXIS_X?(this._diffX1=(o-this._hexSideLength)/2,this._diffY1=0,h=s*(l+.5),u=(o+this._hexSideLength)*Math.floor(c/2)+o*(c%2)):(this._diffX1=0,this._diffY1=(s-this._hexSideLength)/2,u=o*(c+.5),h=(s+this._hexSideLength)*Math.floor(l/2)+s*(l%2)),this.node._uiProps.uiTransformComp.setContentSize(u,h)}else if(this._layerOrientation===mct.ISO){var f=c+l;this.node._uiProps.uiTransformComp.setContentSize(.5*o*f,.5*s*f)}else this.node._uiProps.uiTransformComp.setContentSize(c*o,l*s);this._offset=new Ni(t.offset.x,-t.offset.y),this._useAutomaticVertexZ=!1,this._vertexZvalue=0,this._syncAnchorPoint(),this._prepareToRender()},n._prepareToRender=function(){this._updateVertices(),this._updateAllUserNode()},n.requestMeshRenderData=function(){this._meshRenderDataArray||(this._meshRenderDataArray=[]);for(var t=this._meshRenderDataArray;t.length>0&&t[t.length-1].subNodes&&0===t[t.length-1].subNodes.length;)t.pop();if(t.length>0){var e=t[t.length-1];if(e.renderData&&0===e.renderData.vertexCount)return e}var n=PW.add(),i={renderData:n,texture:null};return n.material=this.getRenderMaterial(0),this._meshRenderDataArray.push(i),i},n.requestSubNodesData=function(){this._meshRenderDataArray||(this._meshRenderDataArray=[]);var t=this._meshRenderDataArray;if(t.length>0&&t[t.length-1].subNodes&&0===t[t.length-1].subNodes.length)return t[t.length-1];var e={subNodes:[]};return this._meshRenderDataArray.push(e),e},n.destroyRenderData=function(){this._meshRenderDataArray&&(this._meshRenderDataArray.forEach((function(t){var e=t.renderData;e&&PW.remove(e)})),this._meshRenderDataArray.length=0),t.prototype.destroyRenderData.call(this)},n._flushAssembler=function(){var t=e.Assembler.getAssembler(this);this._assembler!==t&&(this._assembler=t),this._meshRenderDataArray||this._assembler&&this._assembler.createData&&(this._assembler.createData(this),this.markForUpdateRenderData(),this._updateColor())},n._render=function(t){if(this._meshRenderDataArray){for(var e=0;e<this._meshRenderDataArray.length;e++){this._meshRenderDataArrayIdx=e;var n=this._meshRenderDataArray[e];n.subNodes?n.subNodes.forEach((function(e){e&&t.walk(e.node)})):n.texture&&t.commitComp(this,n.renderData,n.texture,this._assembler,null)}this.node._static=!0}},L(e,[{key:"cullingRect",get:function(){return this._cullingRect}},{key:"rightTop",get:function(){return this._rightTop}},{key:"layerSize",get:function(){return this._layerSize}},{key:"meshRenderDataArray",get:function(){return this._meshRenderDataArray}},{key:"leftDownToCenterX",get:function(){return this._leftDownToCenterX}},{key:"leftDownToCenterY",get:function(){return this._leftDownToCenterY}},{key:"enableCulling",get:function(){return this._enableCulling},set:function(t){this._enableCulling!==t&&(this._enableCulling=t,this._cullingDirty=!0,this.markForUpdateRenderData())}}]),e}(Sq))||Jct),qlt=t("TiledObjectGroup",(nlt=nl("cc.TiledObjectGroup"),ilt=vl(),rlt=il(FW),alt=Bl(Ae),nlt(olt=ilt(olt=rlt((q((slt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._premultiplyAlpha=!1,e._groupName=void 0,e._positionOffset=void 0,e._mapInfo=void 0,e._properties=void 0,e._offset=void 0,e._opacity=void 0,e._tintColor=null,e._animations=void 0,e._hasAniObj=void 0,e._texGrids=void 0,e.aniObjects=void 0,e._objects=[],e}F(e,t);var n=e.prototype;return n.getPositionOffset=function(){return this._positionOffset},n.getProperties=function(){return this._properties},n.getGroupName=function(){return this._groupName},n.getProperty=function(t){return this._properties[t.toString()]},n.getObject=function(t){for(var e=0,n=this._objects.length;e<n;e++){var i=this._objects[e];if(i&&i.name===t)return i}return null},n.getObjects=function(){return this._objects},n._init=function(t,e,n){var i=vct.FLIPPED_MASK,r=vct.HORIZONTAL,a=vct.VERTICAL;this._groupName=t.name,this._positionOffset=t.offset,this._mapInfo=e,this._properties=t.getProperties(),this._offset=new Ni(t.offset.x,-t.offset.y),this._opacity=t.opacity,t.tintColor&&(this._tintColor=t.tintColor),this._texGrids=n,this._animations=e.getTileAnimations(),this.aniObjects=[],this._hasAniObj=!1;var o=e.mapSize,s=e.tileSize,c=0,l=0,u=new _i,h=mct.ISO===e.orientation;if(e.orientation===mct.HEX)e.getStaggerAxis()===yct.STAGGERAXIS_X?(l=s.height*(o.height+.5),c=(s.width+e.getHexSideLength())*Math.floor(o.width/2)+s.width*(o.width%2)):(c=s.width*(o.width+.5),l=(s.height+e.getHexSideLength())*Math.floor(o.height/2)+s.height*(o.height%2));else if(h){var f=o.width+o.height;c=.5*s.width*f,l=.5*s.height*f}else c=o.width*s.width,l=o.height*s.height;var _=this.node._uiProps.uiTransformComp;_.setContentSize(c,l);for(var p=c*_.anchorX,d=l*(1-_.anchorY),m=t.objects,g={},v=0,y=m.length;v<y;v++){var x=m[v],S=x.type;x.offset=new Ni(x.x,x.y);var T=x.points||x.polylinePoints;if(T)for(var A=0;A<T.length;A++)T[A].y*=-1;if(h){var E=x.x/s.height,C=x.y/s.height;x.x=.5*s.width*(o.height+E-C),x.y=.5*s.height*(o.width+o.height-E-C)}else x.y=l-x.y;if(S===Tct.TEXT){var b="text"+x.id;g[b]=!0;var w=this.node.getChildByName(b);w||(w=new qC),w.setRotationFromEuler(0,0,-x.rotation),w.setPosition(x.x-p,x.y-d),w.name=b,w.parent=this.node,w.setSiblingIndex(v);var P=w.getComponent(Cq);P||(P=w.addComponent(Cq));var I=w._uiProps.uiTransformComp;w.active=x.visible,I.anchorX=0,I.anchorY=1,this._tintColor?(u.set(this._tintColor),u.a*=this._opacity/255,P.color.set(u)):P.color.a*=this._opacity/255,P.overflow=Cq.Overflow.SHRINK,P.lineHeight=x.height,P.string=x.text,P.horizontalAlign=x.halign,P.verticalAlign=x.valign,P.fontSize=x.pixelsize,I.setContentSize(x.width,x.height)}else if(S===Tct.IMAGE){var R=x.gid,D=(R&i)>>>0,O=n.get(D);if(!O)continue;var M=O.tileset,N="img"+x.id;g[N]=!0;var L=this.node.getChildByName(N);x.width=x.width||O.width,x.height=x.height||O.height,L&&L._objFlags&Ye.Flags.HideInHierarchy&&(L.removeFromParent(),L.hideFlags|=Ye.Flags.DontSave,L.destroy(),L=null),L||(L=new qC),this._animations.get(D)&&(this.aniObjects.push({object:x,imgNode:L,gridGID:D}),this._hasAniObj=!0);var B=M.tileOffset.x,F=M.tileOffset.y;L.active=x.visible,L.setRotationFromEuler(0,0,-x.rotation),L.setPosition(x.x-p,x.y-d),L.name=N,L.parent=this.node,L.setSiblingIndex(v);var z=L.getComponent(eQ);z||(z=L.addComponent(eQ));var U=L._uiProps.uiTransformComp;h?(U.anchorX=.5+B/x.width,U.anchorY=F/x.height):(U.anchorX=B/x.width,U.anchorY=F/x.height),this._tintColor?(u.set(this._tintColor),u.a*=this._opacity/255,z.color.set(u)):z.color.a*=this._opacity/255,z.sizeMode=eQ.SizeMode.CUSTOM,z._srcBlendFactor=this._premultiplyAlpha?Fr.ONE:Fr.SRC_ALPHA,z._dstBlendFactor=Fr.ONE_MINUS_SRC_ALPHA,z._updateBlendFunc();var k=O.spriteFrame;k=k?k.clone():new uj,(R&r)>>>0&&(k.flipUVX=!k.flipUVX),(R&a)>>>0&&(k.flipUVY=!k.flipUVY),k.rotated=O._rotated,k.rect=O._rect,z.spriteFrame=k,U.setContentSize(x.width,x.height),z.markForUpdateRenderData()}}this._objects=m;for(var G=this.node.children,H=/^(?:img|text)\d+$/,V=0,j=G.length;V<j;V++){var W=G[V],X=W.name;H.test(X)&&!g[X]&&W.destroy()}},n.update=function(){if(this._hasAniObj)for(var t=this.aniObjects,e=this._texGrids,n=mct.ISO===this._mapInfo.orientation,i=0,r=t.length;i<r;i++){var a=t[i],o=a.gridGID,s=e.get(o);if(s){var c=s.tileset,l=a.object,u=a.imgNode,h=c.tileOffset.x,f=c.tileOffset.y,_=u._uiProps.uiTransformComp;n?(_.anchorX=.5+h/l.width,_.anchorY=f/l.height):(_.anchorX=h/l.width,_.anchorY=f/l.height);var p=u.getComponent(eQ),d=p.spriteFrame;d.rotated=s._rotated,d.rect=s._rect,p.spriteFrame=d,p.markForUpdateRenderData()}}},L(e,[{key:"premultiplyAlpha",get:function(){return this._premultiplyAlpha},set:function(t){this._premultiplyAlpha=t}},{key:"offset",get:function(){return this._offset}}]),e}($u)).prototype,"premultiplyAlpha",[alt],Object.getOwnPropertyDescriptor(slt.prototype,"premultiplyAlpha"),slt.prototype),olt=slt))||olt)||olt)||olt)),Ylt=t("TiledMapAsset",(clt=nl("cc.TiledMapAsset"),llt=Bl([lO]),ult=Bl([Ee]),hlt=Bl([uj]),flt=Bl([uj]),_lt=Bl([Ee]),plt=Bl([Ee]),dlt=Bl([Gi]),clt((blt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return X(e=t.call.apply(t,[this].concat(i))||this,"tmxXmlStr",vlt,V(e)),X(e,"tsxFiles",ylt,V(e)),X(e,"tsxFileNames",xlt,V(e)),X(e,"spriteFrames",Slt,V(e)),X(e,"imageLayerSpriteFrame",Tlt,V(e)),X(e,"imageLayerSpriteFrameNames",Alt,V(e)),X(e,"spriteFrameNames",Elt,V(e)),X(e,"spriteFrameSizes",Clt,V(e)),e}return F(e,t),e}(Ou),vlt=q((glt=blt).prototype,"tmxXmlStr",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),ylt=q(glt.prototype,"tsxFiles",[cl,llt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),xlt=q(glt.prototype,"tsxFileNames",[cl,ult],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Slt=q(glt.prototype,"spriteFrames",[cl,hlt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Tlt=q(glt.prototype,"imageLayerSpriteFrame",[cl,flt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Alt=q(glt.prototype,"imageLayerSpriteFrameNames",[cl,_lt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Elt=q(glt.prototype,"spriteFrameNames",[cl,plt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Clt=q(glt.prototype,"spriteFrameSizes",[cl,dlt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),mlt=glt))||mlt)),Klt=(t("TiledMap",(wlt=nl("cc.TiledMap"),Plt=vl(),Ilt=pl(),Rlt=il(FW),Dlt=Bl(Ylt),Olt=Il(),wlt(Mlt=Plt(Mlt=Ilt(Mlt=Rlt(Mlt=_l((Ult=zlt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._texGrids=new Map,e._textures=[],e._tilesets=[],e._animations=new Map,e._imageLayers=[],e._layers=[],e._groups=[],e._images=[],e._properties={},e._tileProperties=new Map,e._mapInfo=null,e._mapSize=new Gi(0,0),e._tileSize=new Gi(0,0),e._preloaded=!1,e._mapOrientation=mct.ORTHO,X(e,"_tmxFile",Llt,V(e)),X(e,"_enableCulling",Blt,V(e)),X(e,"cleanupImageCache",Flt,V(e)),e}F(e,t);var n=e.prototype;return n.getMapSize=function(){return this._mapSize},n.getTileSize=function(){return this._tileSize},n.getMapOrientation=function(){return this._mapOrientation},n.getObjectGroups=function(){return this._groups},n.getObjectGroup=function(t){for(var e=this._groups,n=0,i=e.length;n<i;n++){var r=e[n];if(r&&r.getGroupName()===t)return r}return null},n.getProperties=function(){return this._properties},n.getLayers=function(){return this._layers},n.getLayer=function(t){for(var e=this._layers,n=0,i=e.length;n<i;n++){var r=e[n];if(r&&r.getLayerName()===t)return r}return null},n._changeLayer=function(t,e){for(var n=this._layers,i=0,r=n.length;i<r;i++){var a=n[i];if(a&&a.getLayerName()===t)return void(n[i]=e)}},n.getProperty=function(t){return this._properties[t.toString()]},n.getPropertiesForGID=function(t){return this._tileProperties.get(t)},n.__preload=function(){this._preloaded=!0,this._tmxFile&&this._applyFile()},n.onEnable=function(){this.node.on(WA.ANCHOR_CHANGED,this._syncAnchorPoint,this)},n.onDisable=function(){this.node.off(WA.ANCHOR_CHANGED,this._syncAnchorPoint,this)},n._applyFile=function(){var t=[],e={},n=this._tmxFile;if(n){for(var i=n.spriteFrameNames,r=n.spriteFrameSizes,a=n.spriteFrames,o={},s={},c=0;c<i.length;++c){var l=i[c];s[l]=r[c],t[c]=a[c];var u=t[c];u&&(e[u.name]=u,o[l]=u)}var h={},f=n.imageLayerSpriteFrame;i=n.imageLayerSpriteFrameNames;for(var _=0;_<f.length;++_)h[i[_]]=f[_];for(var p=n.tsxFileNames,d=n.tsxFiles,m={},g=0;g<p.length;++g)p[g].length>0&&(m[p[g]]=d[g].text);var v=new $ct(n.tmxXmlStr,m,o,s,h),y=v.getTilesets();y&&0!==y.length||T(7241),this._buildWithMapInfo(v)}else this._releaseMapInfo()},n._releaseMapInfo=function(){for(var t=this._layers,e=0,n=t.length;e<n;e++){var i,r;null===(i=t[e].node.parent)||void 0===i||i.off(WA.SIZE_CHANGED,t[e].updateCulling,t[e]),null===(r=t[e].node.parent)||void 0===r||r.off(WA.TRANSFORM_CHANGED,t[e].updateCulling,t[e]),t[e].node.removeFromParent(),t[e].node.destroy()}t.length=0;for(var a=this._groups,o=0,s=a.length;o<s;o++)a[o].node.removeFromParent(),a[o].node.destroy();a.length=0;for(var c=this._images,l=0,u=c.length;l<u;l++)c[l].removeFromParent(),c[l].destroy();c.length=0},n._syncAnchorPoint=function(){var t,e,n=this.node._uiProps.uiTransformComp.anchorPoint,i=this.node._uiProps.uiTransformComp.width*n.x,r=this.node._uiProps.uiTransformComp.height*(1-n.y);for(t=0,e=this._layers.length;t<e;t++)this._layers[t].node._uiProps.uiTransformComp.setAnchorPoint(n);for(t=0,e=this._groups.length;t<e;t++){var a=this._groups[t],o=a.node._uiProps.uiTransformComp;o.anchorX=.5,o.anchorY=.5;var s=a.offset.x-i+o.width*o.anchorX,c=a.offset.y+r-o.height*o.anchorY;a.node.setPosition(s,c)}for(t=0,e=this._images.length;t<e;t++){var l=this._images[t]._uiProps.uiTransformComp;l.anchorX=.5,l.anchorY=.5;var u=this._images[t]._offset.x-i+l.width*l.anchorX,h=this._images[t]._offset.y+r-l.height*l.anchorY;this._images[t].setPosition(u,h)}},n._fillAniGrids=function(t,e){for(var n,i=W(e.keys());!(n=i()).done;){var r=n.value,a=e.get(r);if(a)for(var o=a.frames,s=0;s<o.length;s++){var c=o[s];c.grid=t.get(c.tileid)}}},n._buildLayerAndGroup=function(){var t=this._tilesets,e=this._texGrids,n=this._animations;e.clear();for(var i=0,r=t.length;i<r;++i){var a=t[i];a&&(a.sourceImage?elt(a,e,a.sourceImage):console.warn("Can't find the spriteFrame of tilesets "+i))}this._fillAniGrids(e,n);for(var o=this._layers,s=this._groups,c=this._images,l={},u=0,h=o.length;u<h;u++)l[o[u].node.name]=!0;for(var f=0,_=s.length;f<_;f++)l[s[f].node.name]=!0;for(var p=0,d=c.length;p<d;p++)l[c[p].name]=!0;o=this._layers=[],s=this._groups=[],c=this._images=[];var m=this._mapInfo,g=this.node,v=m.getAllChildren(),y=this._textures,x=0,S=0;if(v&&v.length>0)for(var T=0,A=v.length;T<A;T++){var E=v[T],C=E.name,b=this.node.getChildByName(C);if(l[C]=!1,b||((b=new qC).name=C,b.layer=g.layer,g.addChild(b)),b.setSiblingIndex(T),b.active=E.visible,E instanceof Dct){var w=b.getComponent(Xlt);w||(w=b.addComponent(Xlt)),w.init(E,m,t,y,e),w.enableCulling=this._enableCulling,E.ownTiles=!1,o.push(w)}else if(E instanceof Rct){var P=b.getComponent(qlt);P||(P=b.addComponent(qlt)),P._init(E,m,e),s.push(P)}else if(E instanceof Oct){var I=E.sourceImage;b.layerInfo=E,b._offset=new Ni(E.offset.x,-E.offset.y);var R=b.getComponent(eQ);R||(R=b.addComponent(eQ)),R.color.a*=E.opacity,R.spriteFrame=I,b._uiProps.uiTransformComp.setContentSize(I.width,I.height),c.push(b)}x=Math.max(x,b._uiProps.uiTransformComp.width),S=Math.max(S,b._uiProps.uiTransformComp.height)}for(var D=g.children,O=0,M=D.length;O<M;O++){var N=D[O];l[N.name]&&N.destroy()}this.node._uiProps.uiTransformComp.setContentSize(x,S),this._syncAnchorPoint()},n._buildWithMapInfo=function(t){var e=this;this._mapInfo=t,this._mapSize=t.getMapSize(),this._tileSize=t.getTileSize(),this._mapOrientation=t.orientation,this._properties=t.properties,this._tileProperties=t.getTileProperties(),this._imageLayers=t.getImageLayers(),this._animations=t.getTileAnimations(),this._tilesets=t.getTilesets();var n=this._tilesets;this._textures.length=0;for(var i=[],r=0,a=n.length;r<a;++r){var o=n[r];o&&o.sourceImage&&(this._textures[r]=o.sourceImage,i.push(o.sourceImage))}for(var s=0;s<this._imageLayers.length;s++){var c=this._imageLayers[s];c&&c.sourceImage&&i.push(c.sourceImage)}this._buildLayerAndGroup(),this.cleanupImageCache&&this._textures.forEach((function(t){e.doCleanupImageCache(t)}))},n.doCleanupImageCache=function(t){t._image instanceof HTMLImageElement?t._image.src="":lh.hasFeature(lh.Feature.IMAGE_BITMAP)&&t._image instanceof ImageBitmap&&t._image.close&&t._image.close(),t._image=null},n.lateUpdate=function(t){for(var e,n=this._animations,i=this._texGrids,r=W(n.keys());!(e=r()).done;){var a=e.value,o=n.get(a),s=o.frames,c=s[o.frameIdx];o.dt+=t,c.duration<o.dt&&(o.dt=0,o.frameIdx++,o.frameIdx>=s.length&&(o.frameIdx=0),c=s[o.frameIdx]),i.set(a,c.grid)}for(var l=this.getLayers(),u=0,h=l.length;u<h;u++){var f=l[u];(f.hasAnimation()||f.node.hasChangedFlags)&&f.markForUpdateRenderData()}},L(e,[{key:"tmxAsset",get:function(){return this._tmxFile},set:function(t){this._tmxFile!==t&&(this._tmxFile=t,this._preloaded&&this._applyFile())}},{key:"enableCulling",get:function(){return this._enableCulling},set:function(t){this._enableCulling=t;for(var e=this._layers,n=0;n<e.length;++n)e[n].enableCulling=t}}]),e}($u),zlt.Orientation=mct,zlt.Property=gct,zlt.TileFlag=vct,zlt.StaggerAxis=yct,zlt.StaggerIndex=xct,zlt.TMXObjectType=Tct,zlt.RenderOrder=Sct,Llt=q((Nlt=Ult).prototype,"_tmxFile",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q(Nlt.prototype,"tmxAsset",[Dlt,Olt],Object.getOwnPropertyDescriptor(Nlt.prototype,"tmxAsset"),Nlt.prototype),Blt=q(Nlt.prototype,"_enableCulling",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),q(Nlt.prototype,"enableCulling",[yl],Object.getOwnPropertyDescriptor(Nlt.prototype,"enableCulling"),Nlt.prototype),Flt=q(Nlt.prototype,"cleanupImageCache",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Mlt=Nlt))||Mlt)||Mlt)||Mlt)||Mlt)||Mlt)),Math.ceil(10922.5)),Qlt=[],Zlt=0;Zlt<4;Zlt++)Qlt.push(new di);var Jlt,$lt,tut=new Ri,eut=new di,nut={row:0,col:0},iut={x:0,y:0},rut={x:0,y:0},aut={x:0,y:0},out={x:0,y:0},sut=0,cut=0,lut=0,uut=0,hut={createData:function(t){var e=t.requestMeshRenderData();return t.rightTop.col*t.rightTop.row*4>65535&&console.error("Vertex count exceeds 65535"),e},updateRenderData:function(t){t.updateCulling();var e=t.requestMeshRenderData();if(lut=t.leftDownToCenterX,uut=t.leftDownToCenterY,Jlt=e,t.colorChanged||t.isCullingDirty()||t.isUserNodeDirty()||t.hasAnimation()||t.hasTiledNode()||t.node.hasChangedFlags){var n,i;if(t.colorChanged=!1,t.destroyRenderData(),t.enableCulling){var r=t.cullingRect;n=r.leftDown,i=r.rightTop}else n=nut,i=t.rightTop;switch(t.renderOrder){case Sct.RightDown:put(n,i,-1,1,t);break;case Sct.LeftDown:put(n,i,-1,-1,t);break;case Sct.RightUp:put(n,i,1,1,t);break;case Sct.LeftUp:default:put(n,i,1,-1,t)}t.setCullingDirty(!1),t.setUserNodeDirty(!1)}Jlt=null},updateColor:function(t){var e=t.color,n=new Float32Array(4);n[0]=e.r/255,n[1]=e.g/255,n[2]=e.b/255,n[3]=e.a/255;var i=t.meshRenderDataArray;if(i)for(var r,a=W(i);!(r=a()).done;){var o=r.value;if(o.renderData)for(var s=o.renderData,c=s.vData,l=s.vertexStart,u=s.vertexCount;l<u;l++)c.set(n,9*l+5)}},fillBuffers:function(t){if(t&&t.meshRenderDataArray)for(var e=t.meshRenderDataArray[t._meshRenderDataArrayIdx].renderData,n=e.iData,i=0,r=0,a=e.vertexCount/4,o=0;o<a;o+=1)n[i]=r,n[i+1]=r+1,n[i+2]=r+2,n[i+3]=r+2,n[i+4]=r+1,n[i+5]=r+3,i+=6,r+=4}};function fut(t,e){var n;t._rotated?(iut.x=t.r,iut.y=t.t,rut.x=t.l,rut.y=t.t,aut.x=t.r,aut.y=t.b,out.x=t.l,out.y=t.b):(iut.x=t.l,iut.y=t.t,rut.x=t.l,rut.y=t.b,aut.x=t.r,aut.y=t.t,out.x=t.r,out.y=t.b),(e&vct.DIAGONAL)>>>0&&(n=rut,rut=aut,aut=n),(e&vct.HORIZONTAL)>>>0&&(n=iut,iut=aut,aut=n,n=rut,rut=out,out=n),(e&vct.VERTICAL)>>>0&&(n=iut,iut=rut,rut=n,n=aut,aut=out,out=n)}function _ut(t,e,n){t||(t=e.texture),Jlt.texture||(Jlt.texture=t),(Jlt=n.requestMeshRenderData()).texture=e.texture}function put(t,e,n,i,r){if(!(!Jlt||e.row<0||e.col<0)){Jlt.renderData||(Jlt=r.requestMeshRenderData());var a=Jlt.renderData.vData,o=r.node.worldMatrix;sut=0,cut=0;var s,c,l,u,h,f,_,p,d,m=r.tiledTiles,g=r.texGrids,v=r.tiles,y=18,x=27,S=r.vertices,T=0,A=0,E=0,C=0,b=0,w=null,P=0,I=!0;$lt=fut;var R=new Float32Array(4);for(R[0]=r.color.r/255,R[1]=r.color.g/255,R[2]=r.color.b/255,R[3]=r.color.a/255,-1===n?(u=e.row,h=t.row):(u=t.row,h=e.row);(h-u)*n>=0;u+=n)for(s=S[u],P=r.getNodesCountByRow(u),I=s&&0===P,1===i?(c=I&&t.col<s.minCol?s.minCol:t.col,l=I&&e.col>s.maxCol?s.maxCol:e.col):(c=I&&e.col>s.maxCol?s.maxCol:e.col,l=I&&t.col<s.minCol?s.minCol:t.col);(l-c)*i>=0;c+=i){if(f=s&&s[c],P>0){var D=r.requestSubNodesData(),O=r.getNodesByRowCol(u,c);O&&O.count>0&&(D.subNodes=r.getNodesByRowCol(u,c).list,w=null,Jlt=r.requestMeshRenderData())}if(f&&(T=v[f.index],p=g.get((T&vct.FLIPPED_MASK)>>>0))){w!==p.texture&&(_ut(w,p,r),w=p.texture),_=p.tileset._tileSize,A=f.left-lut,E=f.bottom-uut,C=A+_.width,b=E+_.height,d=m[f.index];var M=Jlt.renderData;M.reserve(4,0),cut=9*M.vertexCount,a=M.vData,d?d.node.active&&dut(d.node,R,a,A,C,b,E,!1):(Qlt[0].x=A,Qlt[0].y=b,Qlt[1].x=A,Qlt[1].y=E,Qlt[2].x=C,Qlt[2].y=b,Qlt[3].x=C,Qlt[3].y=E,Qlt[0].transformMat4(o),a[cut]=Qlt[0].x,a[cut+1]=Qlt[0].y,a[cut+2]=Qlt[0].z,Qlt[1].transformMat4(o),a[cut+9]=Qlt[1].x,a[cut+9+1]=Qlt[1].y,a[cut+9+2]=Qlt[1].z,Qlt[2].transformMat4(o),a[cut+y]=Qlt[2].x,a[cut+y+1]=Qlt[2].y,a[cut+y+2]=Qlt[2].z,Qlt[3].transformMat4(o),a[cut+x]=Qlt[3].x,a[cut+x+1]=Qlt[3].y,a[cut+x+2]=Qlt[3].z,a.set(R,cut+5),a.set(R,cut+9+5),a.set(R,cut+y+5),a.set(R,cut+x+5)),$lt(p,T),a[cut+3]=iut.x,a[cut+4]=iut.y,a[cut+9+3]=rut.x,a[cut+9+4]=rut.y,a[cut+y+3]=aut.x,a[cut+y+4]=aut.y,a[cut+x+3]=out.x,a[cut+x+4]=out.y,sut++,M.request(4,6),M.resize(M.vertexCount,M.indexCount),sut>=Klt&&(_ut(w,p,r),w=p.texture)}}}}function dut(t,e,n,i,r,a,o,s){var c=18,l=27;t.updateWorldTransform(),Ri.fromRTS(tut,t.rotation,t.position,t.scale),di.set(eut,-(i+lut),-(o+uut),0),Ri.transform(tut,tut,eut),Ri.multiply(tut,t.parent.worldMatrix,tut);var u=tut,h=u.m12,f=u.m13,_=u.m00,p=u.m01,d=u.m04,m=u.m05,g=1===_&&0===p&&0===d&&1===m;if(s){var v=(i+r)/2,y=(a+o)/2;g?(n[cut]=v+h,n[cut+1]=a+f,n[cut+9]=i+h,n[cut+9+1]=y+f,n[cut+c]=r+h,n[cut+c+1]=y+f,n[cut+l]=v+h,n[cut+l+1]=o+f):(n[cut]=v*_+a*d+h,n[cut+1]=v*p+a*m+f,n[cut+9]=i*_+y*d+h,n[cut+9+1]=i*p+y*m+f,n[cut+c]=r*_+y*d+h,n[cut+c+1]=r*p+y*m+f,n[cut+l]=v*_+o*d+h,n[cut+l+1]=v*p+o*m+f)}else g?(n[cut]=i+h,n[cut+1]=a+f,n[cut+9]=i+h,n[cut+9+1]=o+f,n[cut+c]=r+h,n[cut+c+1]=a+f,n[cut+l]=r+h,n[cut+l+1]=o+f):(n[cut]=i*_+a*d+h,n[cut+1]=i*p+a*m+f,n[cut+9]=i*_+o*d+h,n[cut+9+1]=i*p+o*m+f,n[cut+c]=r*_+a*d+h,n[cut+c+1]=r*p+a*m+f,n[cut+l]=r*_+o*d+h,n[cut+l+1]=r*p+o*m+f);n.set(e,cut+5),n.set(e,cut+9+5),n.set(e,cut+c+5),n.set(e,cut+l+5)}var mut=t("tiledLayerAssembler",{getAssembler:function(){return hut}});Xlt.Assembler=mut;var gut,vut,yut=(gut=function(t,e){return(gut=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}gut(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});!function(t){var e,n,i,r=function(){function t(t,e,n){if(null==t)throw new Error("name cannot be null.");if(null==e)throw new Error("timelines cannot be null.");this.name=t,this.timelines=e,this.timelineIds=[];for(var i=0;i<e.length;i++)this.timelineIds[e[i].getPropertyId()]=!0;this.duration=n}return t.prototype.hasTimeline=function(t){return 1==this.timelineIds[t]},t.prototype.apply=function(t,e,n,i,r,a,o,s){if(null==t)throw new Error("skeleton cannot be null.");i&&0!=this.duration&&(n%=this.duration,e>0&&(e%=this.duration));for(var c=this.timelines,l=0,u=c.length;l<u;l++)c[l].apply(t,e,n,r,a,o,s)},t.binarySearch=function(t,e,n){void 0===n&&(n=1);var i=0,r=t.length/n-2;if(0==r)return n;for(var a=r>>>1;;){if(t[(a+1)*n]<=e?i=a+1:r=a,i==r)return(i+1)*n;a=i+r>>>1}},t.linearSearch=function(t,e,n){for(var i=0,r=t.length-n;i<=r;i+=n)if(t[i]>e)return i;return-1},t}();t.Animation=r,function(t){t[t.setup=0]="setup",t[t.first=1]="first",t[t.replace=2]="replace",t[t.add=3]="add"}(e=t.MixBlend||(t.MixBlend={})),function(t){t[t.mixIn=0]="mixIn",t[t.mixOut=1]="mixOut"}(n=t.MixDirection||(t.MixDirection={})),function(t){t[t.rotate=0]="rotate",t[t.translate=1]="translate",t[t.scale=2]="scale",t[t.shear=3]="shear",t[t.attachment=4]="attachment",t[t.color=5]="color",t[t.deform=6]="deform",t[t.event=7]="event",t[t.drawOrder=8]="drawOrder",t[t.ikConstraint=9]="ikConstraint",t[t.transformConstraint=10]="transformConstraint",t[t.pathConstraintPosition=11]="pathConstraintPosition",t[t.pathConstraintSpacing=12]="pathConstraintSpacing",t[t.pathConstraintMix=13]="pathConstraintMix",t[t.twoColor=14]="twoColor"}(i=t.TimelineType||(t.TimelineType={}));var a=function(){function e(n){if(n<=0)throw new Error("frameCount must be > 0: "+n);this.curves=t.Utils.newFloatArray((n-1)*e.BEZIER_SIZE)}return e.prototype.getFrameCount=function(){return this.curves.length/e.BEZIER_SIZE+1},e.prototype.setLinear=function(t){this.curves[t*e.BEZIER_SIZE]=e.LINEAR},e.prototype.setStepped=function(t){this.curves[t*e.BEZIER_SIZE]=e.STEPPED},e.prototype.getCurveType=function(t){var n=t*e.BEZIER_SIZE;if(n==this.curves.length)return e.LINEAR;var i=this.curves[n];return i==e.LINEAR?e.LINEAR:i==e.STEPPED?e.STEPPED:e.BEZIER},e.prototype.setCurve=function(t,n,i,r,a){var o=.03*(2*-n+r),s=.03*(2*-i+a),c=.006*(3*(n-r)+1),l=.006*(3*(i-a)+1),u=2*o+c,h=2*s+l,f=.3*n+o+.16666667*c,_=.3*i+s+.16666667*l,p=t*e.BEZIER_SIZE,d=this.curves;d[p++]=e.BEZIER;for(var m=f,g=_,v=p+e.BEZIER_SIZE-1;p<v;p+=2)d[p]=m,d[p+1]=g,f+=u,_+=h,u+=c,h+=l,m+=f,g+=_},e.prototype.getCurvePercent=function(n,i){i=t.MathUtils.clamp(i,0,1);var r=this.curves,a=n*e.BEZIER_SIZE,o=r[a];if(o==e.LINEAR)return i;if(o==e.STEPPED)return 0;for(var s=0,c=++a,l=a+e.BEZIER_SIZE-1;a<l;a+=2)if((s=r[a])>=i){var u=void 0,h=void 0;return a==c?(u=0,h=0):(u=r[a-2],h=r[a-1]),h+(r[a+1]-h)*(i-u)/(s-u)}var f=r[a-1];return f+(1-f)*(i-s)/(1-s)},e.LINEAR=0,e.STEPPED=1,e.BEZIER=2,e.BEZIER_SIZE=19,e}();t.CurveTimeline=a;var o=function(n){function a(e){var i=n.call(this,e)||this;return i.frames=t.Utils.newFloatArray(e<<1),i}return yut(a,n),a.prototype.getPropertyId=function(){return(i.rotate<<24)+this.boneIndex},a.prototype.setFrame=function(t,e,n){t<<=1,this.frames[t]=e,this.frames[t+a.ROTATION]=n},a.prototype.apply=function(t,n,i,o,s,c){var l=this.frames,u=t.bones[this.boneIndex];if(u.active)if(i<l[0])switch(c){case e.setup:return void(u.rotation=u.data.rotation);case e.first:var h=u.data.rotation-u.rotation;u.rotation+=(h-360*(16384-(16384.499999999996-h/360|0)))*s}else if(i>=l[l.length-a.ENTRIES]){var f=l[l.length+a.PREV_ROTATION];switch(c){case e.setup:u.rotation=u.data.rotation+f*s;break;case e.first:case e.replace:f+=u.data.rotation-u.rotation,f-=360*(16384-(16384.499999999996-f/360|0));case e.add:u.rotation+=f*s}}else{var _=r.binarySearch(l,i,a.ENTRIES),p=l[_+a.PREV_ROTATION],d=l[_],m=this.getCurvePercent((_>>1)-1,1-(i-d)/(l[_+a.PREV_TIME]-d)),g=l[_+a.ROTATION]-p;switch(g=p+(g-360*(16384-(16384.499999999996-g/360|0)))*m,c){case e.setup:u.rotation=u.data.rotation+(g-360*(16384-(16384.499999999996-g/360|0)))*s;break;case e.first:case e.replace:g+=u.data.rotation-u.rotation;case e.add:u.rotation+=(g-360*(16384-(16384.499999999996-g/360|0)))*s}}},a.ENTRIES=2,a.PREV_TIME=-2,a.PREV_ROTATION=-1,a.ROTATION=1,a}(a);t.RotateTimeline=o;var s=function(n){function a(e){var i=n.call(this,e)||this;return i.frames=t.Utils.newFloatArray(e*a.ENTRIES),i}return yut(a,n),a.prototype.getPropertyId=function(){return(i.translate<<24)+this.boneIndex},a.prototype.setFrame=function(t,e,n,i){t*=a.ENTRIES,this.frames[t]=e,this.frames[t+a.X]=n,this.frames[t+a.Y]=i},a.prototype.apply=function(t,n,i,o,s,c){var l=this.frames,u=t.bones[this.boneIndex];if(u.active)if(i<l[0])switch(c){case e.setup:return u.x=u.data.x,void(u.y=u.data.y);case e.first:u.x+=(u.data.x-u.x)*s,u.y+=(u.data.y-u.y)*s}else{var h=0,f=0;if(i>=l[l.length-a.ENTRIES])h=l[l.length+a.PREV_X],f=l[l.length+a.PREV_Y];else{var _=r.binarySearch(l,i,a.ENTRIES);h=l[_+a.PREV_X],f=l[_+a.PREV_Y];var p=l[_],d=this.getCurvePercent(_/a.ENTRIES-1,1-(i-p)/(l[_+a.PREV_TIME]-p));h+=(l[_+a.X]-h)*d,f+=(l[_+a.Y]-f)*d}switch(c){case e.setup:u.x=u.data.x+h*s,u.y=u.data.y+f*s;break;case e.first:case e.replace:u.x+=(u.data.x+h-u.x)*s,u.y+=(u.data.y+f-u.y)*s;break;case e.add:u.x+=h*s,u.y+=f*s}}},a.ENTRIES=3,a.PREV_TIME=-3,a.PREV_X=-2,a.PREV_Y=-1,a.X=1,a.Y=2,a}(a);t.TranslateTimeline=s;var c=function(a){function o(t){return a.call(this,t)||this}return yut(o,a),o.prototype.getPropertyId=function(){return(i.scale<<24)+this.boneIndex},o.prototype.apply=function(i,a,s,c,l,u,h){var f=this.frames,_=i.bones[this.boneIndex];if(_.active)if(s<f[0])switch(u){case e.setup:return _.scaleX=_.data.scaleX,void(_.scaleY=_.data.scaleY);case e.first:_.scaleX+=(_.data.scaleX-_.scaleX)*l,_.scaleY+=(_.data.scaleY-_.scaleY)*l}else{var p=0,d=0;if(s>=f[f.length-o.ENTRIES])p=f[f.length+o.PREV_X]*_.data.scaleX,d=f[f.length+o.PREV_Y]*_.data.scaleY;else{var m=r.binarySearch(f,s,o.ENTRIES);p=f[m+o.PREV_X],d=f[m+o.PREV_Y];var g=f[m],v=this.getCurvePercent(m/o.ENTRIES-1,1-(s-g)/(f[m+o.PREV_TIME]-g));p=(p+(f[m+o.X]-p)*v)*_.data.scaleX,d=(d+(f[m+o.Y]-d)*v)*_.data.scaleY}if(1==l)u==e.add?(_.scaleX+=p-_.data.scaleX,_.scaleY+=d-_.data.scaleY):(_.scaleX=p,_.scaleY=d);else{var y=0,x=0;if(h==n.mixOut)switch(u){case e.setup:y=_.data.scaleX,x=_.data.scaleY,_.scaleX=y+(Math.abs(p)*t.MathUtils.signum(y)-y)*l,_.scaleY=x+(Math.abs(d)*t.MathUtils.signum(x)-x)*l;break;case e.first:case e.replace:y=_.scaleX,x=_.scaleY,_.scaleX=y+(Math.abs(p)*t.MathUtils.signum(y)-y)*l,_.scaleY=x+(Math.abs(d)*t.MathUtils.signum(x)-x)*l;break;case e.add:y=_.scaleX,x=_.scaleY,_.scaleX=y+(Math.abs(p)*t.MathUtils.signum(y)-_.data.scaleX)*l,_.scaleY=x+(Math.abs(d)*t.MathUtils.signum(x)-_.data.scaleY)*l}else switch(u){case e.setup:y=Math.abs(_.data.scaleX)*t.MathUtils.signum(p),x=Math.abs(_.data.scaleY)*t.MathUtils.signum(d),_.scaleX=y+(p-y)*l,_.scaleY=x+(d-x)*l;break;case e.first:case e.replace:y=Math.abs(_.scaleX)*t.MathUtils.signum(p),x=Math.abs(_.scaleY)*t.MathUtils.signum(d),_.scaleX=y+(p-y)*l,_.scaleY=x+(d-x)*l;break;case e.add:y=t.MathUtils.signum(p),x=t.MathUtils.signum(d),_.scaleX=Math.abs(_.scaleX)*y+(p-Math.abs(_.data.scaleX)*y)*l,_.scaleY=Math.abs(_.scaleY)*x+(d-Math.abs(_.data.scaleY)*x)*l}}}},o}(s);t.ScaleTimeline=c;var l=function(t){function n(e){return t.call(this,e)||this}return yut(n,t),n.prototype.getPropertyId=function(){return(i.shear<<24)+this.boneIndex},n.prototype.apply=function(t,i,a,o,s,c){var l=this.frames,u=t.bones[this.boneIndex];if(u.active)if(a<l[0])switch(c){case e.setup:return u.shearX=u.data.shearX,void(u.shearY=u.data.shearY);case e.first:u.shearX+=(u.data.shearX-u.shearX)*s,u.shearY+=(u.data.shearY-u.shearY)*s}else{var h=0,f=0;if(a>=l[l.length-n.ENTRIES])h=l[l.length+n.PREV_X],f=l[l.length+n.PREV_Y];else{var _=r.binarySearch(l,a,n.ENTRIES);h=l[_+n.PREV_X],f=l[_+n.PREV_Y];var p=l[_],d=this.getCurvePercent(_/n.ENTRIES-1,1-(a-p)/(l[_+n.PREV_TIME]-p));h+=(l[_+n.X]-h)*d,f+=(l[_+n.Y]-f)*d}switch(c){case e.setup:u.shearX=u.data.shearX+h*s,u.shearY=u.data.shearY+f*s;break;case e.first:case e.replace:u.shearX+=(u.data.shearX+h-u.shearX)*s,u.shearY+=(u.data.shearY+f-u.shearY)*s;break;case e.add:u.shearX+=h*s,u.shearY+=f*s}}},n}(s);t.ShearTimeline=l;var u=function(n){function a(e){var i=n.call(this,e)||this;return i.frames=t.Utils.newFloatArray(e*a.ENTRIES),i}return yut(a,n),a.prototype.getPropertyId=function(){return(i.color<<24)+this.slotIndex},a.prototype.setFrame=function(t,e,n,i,r,o){t*=a.ENTRIES,this.frames[t]=e,this.frames[t+a.R]=n,this.frames[t+a.G]=i,this.frames[t+a.B]=r,this.frames[t+a.A]=o},a.prototype.apply=function(t,n,i,o,s,c){var l=t.slots[this.slotIndex];if(l.bone.active){var u=this.frames;if(i<u[0])switch(c){case e.setup:return void l.color.setFromColor(l.data.color);case e.first:var h=l.color,f=l.data.color;h.add((f.r-h.r)*s,(f.g-h.g)*s,(f.b-h.b)*s,(f.a-h.a)*s)}else{var _=0,p=0,d=0,m=0;if(i>=u[u.length-a.ENTRIES]){var g=u.length;_=u[g+a.PREV_R],p=u[g+a.PREV_G],d=u[g+a.PREV_B],m=u[g+a.PREV_A]}else{var v=r.binarySearch(u,i,a.ENTRIES);_=u[v+a.PREV_R],p=u[v+a.PREV_G],d=u[v+a.PREV_B],m=u[v+a.PREV_A];var y=u[v],x=this.getCurvePercent(v/a.ENTRIES-1,1-(i-y)/(u[v+a.PREV_TIME]-y));_+=(u[v+a.R]-_)*x,p+=(u[v+a.G]-p)*x,d+=(u[v+a.B]-d)*x,m+=(u[v+a.A]-m)*x}1==s?l.color.set(_,p,d,m):(h=l.color,c==e.setup&&h.setFromColor(l.data.color),h.add((_-h.r)*s,(p-h.g)*s,(d-h.b)*s,(m-h.a)*s))}}},a.ENTRIES=5,a.PREV_TIME=-5,a.PREV_R=-4,a.PREV_G=-3,a.PREV_B=-2,a.PREV_A=-1,a.R=1,a.G=2,a.B=3,a.A=4,a}(a);t.ColorTimeline=u;var h=function(n){function a(e){var i=n.call(this,e)||this;return i.frames=t.Utils.newFloatArray(e*a.ENTRIES),i}return yut(a,n),a.prototype.getPropertyId=function(){return(i.twoColor<<24)+this.slotIndex},a.prototype.setFrame=function(t,e,n,i,r,o,s,c,l){t*=a.ENTRIES,this.frames[t]=e,this.frames[t+a.R]=n,this.frames[t+a.G]=i,this.frames[t+a.B]=r,this.frames[t+a.A]=o,this.frames[t+a.R2]=s,this.frames[t+a.G2]=c,this.frames[t+a.B2]=l},a.prototype.apply=function(t,n,i,o,s,c){var l=t.slots[this.slotIndex];if(l.bone.active){var u=this.frames;if(i<u[0])switch(c){case e.setup:return l.color.setFromColor(l.data.color),void l.darkColor.setFromColor(l.data.darkColor);case e.first:var h=l.color,f=l.darkColor,_=l.data.color,p=l.data.darkColor;h.add((_.r-h.r)*s,(_.g-h.g)*s,(_.b-h.b)*s,(_.a-h.a)*s),f.add((p.r-f.r)*s,(p.g-f.g)*s,(p.b-f.b)*s,0)}else{var d=0,m=0,g=0,v=0,y=0,x=0,S=0;if(i>=u[u.length-a.ENTRIES]){var T=u.length;d=u[T+a.PREV_R],m=u[T+a.PREV_G],g=u[T+a.PREV_B],v=u[T+a.PREV_A],y=u[T+a.PREV_R2],x=u[T+a.PREV_G2],S=u[T+a.PREV_B2]}else{var A=r.binarySearch(u,i,a.ENTRIES);d=u[A+a.PREV_R],m=u[A+a.PREV_G],g=u[A+a.PREV_B],v=u[A+a.PREV_A],y=u[A+a.PREV_R2],x=u[A+a.PREV_G2],S=u[A+a.PREV_B2];var E=u[A],C=this.getCurvePercent(A/a.ENTRIES-1,1-(i-E)/(u[A+a.PREV_TIME]-E));d+=(u[A+a.R]-d)*C,m+=(u[A+a.G]-m)*C,g+=(u[A+a.B]-g)*C,v+=(u[A+a.A]-v)*C,y+=(u[A+a.R2]-y)*C,x+=(u[A+a.G2]-x)*C,S+=(u[A+a.B2]-S)*C}1==s?(l.color.set(d,m,g,v),l.darkColor.set(y,x,S,1)):(h=l.color,f=l.darkColor,c==e.setup&&(h.setFromColor(l.data.color),f.setFromColor(l.data.darkColor)),h.add((d-h.r)*s,(m-h.g)*s,(g-h.b)*s,(v-h.a)*s),f.add((y-f.r)*s,(x-f.g)*s,(S-f.b)*s,0))}}},a.ENTRIES=8,a.PREV_TIME=-8,a.PREV_R=-7,a.PREV_G=-6,a.PREV_B=-5,a.PREV_A=-4,a.PREV_R2=-3,a.PREV_G2=-2,a.PREV_B2=-1,a.R=1,a.G=2,a.B=3,a.A=4,a.R2=5,a.G2=6,a.B2=7,a}(a);t.TwoColorTimeline=h;var f=function(){function a(e){this.frames=t.Utils.newFloatArray(e),this.attachmentNames=new Array(e)}return a.prototype.getPropertyId=function(){return(i.attachment<<24)+this.slotIndex},a.prototype.getFrameCount=function(){return this.frames.length},a.prototype.setFrame=function(t,e,n){this.frames[t]=e,this.attachmentNames[t]=n},a.prototype.apply=function(t,i,a,o,s,c,l){var u=t.slots[this.slotIndex];if(u.bone.active)if(l!=n.mixOut||c!=e.setup){var h=this.frames;if(a<h[0]){if(c==e.setup||c==e.first){var f=u.data.attachmentName;u.setAttachment(null==f?null:t.getAttachment(this.slotIndex,f))}}else{var _;_=a>=h[h.length-1]?h.length-1:r.binarySearch(h,a,1)-1;var p=this.attachmentNames[_];t.slots[this.slotIndex].setAttachment(null==p?null:t.getAttachment(this.slotIndex,p))}}else{var d=u.data.attachmentName;u.setAttachment(null==d?null:t.getAttachment(this.slotIndex,d))}},a}();t.AttachmentTimeline=f;var _=null,p=function(n){function a(e){var i=n.call(this,e)||this;return i.frames=t.Utils.newFloatArray(e),i.frameVertices=new Array(e),null==_&&(_=t.Utils.newFloatArray(64)),i}return yut(a,n),a.prototype.getPropertyId=function(){return(i.deform<<27)+ +this.attachment.id+this.slotIndex},a.prototype.setFrame=function(t,e,n){this.frames[t]=e,this.frameVertices[t]=n},a.prototype.apply=function(n,i,a,o,s,c){var l=n.slots[this.slotIndex];if(l.bone.active){var u=l.getAttachment();if(u instanceof t.VertexAttachment&&u.deformAttachment==this.attachment){var h=l.deform;0==h.length&&(c=e.setup);var f=this.frameVertices,_=f[0].length,p=this.frames;if(a<p[0]){var d=u;switch(c){case e.setup:return void(h.length=0);case e.first:if(1==s){h.length=0;break}var m=t.Utils.setArraySize(h,_);if(null==d.bones)for(var g=d.vertices,v=0;v<_;v++)m[v]+=(g[v]-m[v])*s;else for(s=1-s,v=0;v<_;v++)m[v]*=s}}else{var y=t.Utils.setArraySize(h,_);if(a>=p[p.length-1]){var x=f[p.length-1];if(1==s)if(c==e.add)if(null==(d=u).bones){g=d.vertices;for(var S=0;S<_;S++)y[S]+=x[S]-g[S]}else for(var T=0;T<_;T++)y[T]+=x[T];else t.Utils.arrayCopy(x,0,y,0,_);else switch(c){case e.setup:var A=u;if(null==A.bones){g=A.vertices;for(var E=0;E<_;E++){var C=g[E];y[E]=C+(x[E]-C)*s}}else for(var b=0;b<_;b++)y[b]=x[b]*s;break;case e.first:case e.replace:for(var w=0;w<_;w++)y[w]+=(x[w]-y[w])*s;case e.add:if(null==(d=u).bones){g=d.vertices;for(var P=0;P<_;P++)y[P]+=(x[P]-g[P])*s}else for(var I=0;I<_;I++)y[I]+=x[I]*s}}else{var R=r.binarySearch(p,a),D=f[R-1],O=f[R],M=p[R],N=this.getCurvePercent(R-1,1-(a-M)/(p[R-1]-M));if(1==s)if(c==e.add)if(null==(d=u).bones){g=d.vertices;for(var L=0;L<_;L++){var B=D[L];y[L]+=B+(O[L]-B)*N-g[L]}}else for(var F=0;F<_;F++)B=D[F],y[F]+=B+(O[F]-B)*N;else for(var z=0;z<_;z++)B=D[z],y[z]=B+(O[z]-B)*N;else switch(c){case e.setup:var U=u;if(null==U.bones){g=U.vertices;for(var k=0;k<_;k++)B=D[k],C=g[k],y[k]=C+(B+(O[k]-B)*N-C)*s}else for(var G=0;G<_;G++)B=D[G],y[G]=(B+(O[G]-B)*N)*s;break;case e.first:case e.replace:for(var H=0;H<_;H++)B=D[H],y[H]+=(B+(O[H]-B)*N-y[H])*s;break;case e.add:if(null==(d=u).bones){g=d.vertices;for(var V=0;V<_;V++)B=D[V],y[V]+=(B+(O[V]-B)*N-g[V])*s}else for(var j=0;j<_;j++)B=D[j],y[j]+=(B+(O[j]-B)*N)*s}}}}}},a}(a);t.DeformTimeline=p;var d=function(){function e(e){this.frames=t.Utils.newFloatArray(e),this.events=new Array(e)}return e.prototype.getPropertyId=function(){return i.event<<24},e.prototype.getFrameCount=function(){return this.frames.length},e.prototype.setFrame=function(t,e){this.frames[t]=e.time,this.events[t]=e},e.prototype.apply=function(t,e,n,i,a,o,s){if(null!=i){var c=this.frames,l=this.frames.length;if(e>n)this.apply(t,e,Number.MAX_VALUE,i,a,o,s),e=-1;else if(e>=c[l-1])return;if(!(n<c[0])){var u=0;if(e<c[0])u=0;else for(var h=c[u=r.binarySearch(c,e)];u>0&&c[u-1]==h;)u--;for(;u<l&&n>=c[u];u++)i.push(this.events[u])}}},e}();t.EventTimeline=d;var m=function(){function a(e){this.frames=t.Utils.newFloatArray(e),this.drawOrders=new Array(e)}return a.prototype.getPropertyId=function(){return i.drawOrder<<24},a.prototype.getFrameCount=function(){return this.frames.length},a.prototype.setFrame=function(t,e,n){this.frames[t]=e,this.drawOrders[t]=n},a.prototype.apply=function(i,a,o,s,c,l,u){var h=i.drawOrder,f=i.slots;if(u!=n.mixOut||l!=e.setup){var _=this.frames;if(o<_[0])l!=e.setup&&l!=e.first||t.Utils.arrayCopy(i.slots,0,i.drawOrder,0,i.slots.length);else{var p;p=o>=_[_.length-1]?_.length-1:r.binarySearch(_,o)-1;var d=this.drawOrders[p];if(null==d)t.Utils.arrayCopy(f,0,h,0,f.length);else for(var m=0,g=d.length;m<g;m++)h[m]=f[d[m]]}}else t.Utils.arrayCopy(i.slots,0,i.drawOrder,0,i.slots.length)},a}();t.DrawOrderTimeline=m;var g=function(a){function o(e){var n=a.call(this,e)||this;return n.frames=t.Utils.newFloatArray(e*o.ENTRIES),n}return yut(o,a),o.prototype.getPropertyId=function(){return(i.ikConstraint<<24)+this.ikConstraintIndex},o.prototype.setFrame=function(t,e,n,i,r,a,s){t*=o.ENTRIES,this.frames[t]=e,this.frames[t+o.MIX]=n,this.frames[t+o.SOFTNESS]=i,this.frames[t+o.BEND_DIRECTION]=r,this.frames[t+o.COMPRESS]=a?1:0,this.frames[t+o.STRETCH]=s?1:0},o.prototype.apply=function(t,i,a,s,c,l,u){var h=this.frames,f=t.ikConstraints[this.ikConstraintIndex];if(f.active)if(a<h[0])switch(l){case e.setup:return f.mix=f.data.mix,f.softness=f.data.softness,f.bendDirection=f.data.bendDirection,f.compress=f.data.compress,void(f.stretch=f.data.stretch);case e.first:f.mix+=(f.data.mix-f.mix)*c,f.softness+=(f.data.softness-f.softness)*c,f.bendDirection=f.data.bendDirection,f.compress=f.data.compress,f.stretch=f.data.stretch}else if(a>=h[h.length-o.ENTRIES])l==e.setup?(f.mix=f.data.mix+(h[h.length+o.PREV_MIX]-f.data.mix)*c,f.softness=f.data.softness+(h[h.length+o.PREV_SOFTNESS]-f.data.softness)*c,u==n.mixOut?(f.bendDirection=f.data.bendDirection,f.compress=f.data.compress,f.stretch=f.data.stretch):(f.bendDirection=h[h.length+o.PREV_BEND_DIRECTION],f.compress=0!=h[h.length+o.PREV_COMPRESS],f.stretch=0!=h[h.length+o.PREV_STRETCH])):(f.mix+=(h[h.length+o.PREV_MIX]-f.mix)*c,f.softness+=(h[h.length+o.PREV_SOFTNESS]-f.softness)*c,u==n.mixIn&&(f.bendDirection=h[h.length+o.PREV_BEND_DIRECTION],f.compress=0!=h[h.length+o.PREV_COMPRESS],f.stretch=0!=h[h.length+o.PREV_STRETCH]));else{var _=r.binarySearch(h,a,o.ENTRIES),p=h[_+o.PREV_MIX],d=h[_+o.PREV_SOFTNESS],m=h[_],g=this.getCurvePercent(_/o.ENTRIES-1,1-(a-m)/(h[_+o.PREV_TIME]-m));l==e.setup?(f.mix=f.data.mix+(p+(h[_+o.MIX]-p)*g-f.data.mix)*c,f.softness=f.data.softness+(d+(h[_+o.SOFTNESS]-d)*g-f.data.softness)*c,u==n.mixOut?(f.bendDirection=f.data.bendDirection,f.compress=f.data.compress,f.stretch=f.data.stretch):(f.bendDirection=h[_+o.PREV_BEND_DIRECTION],f.compress=0!=h[_+o.PREV_COMPRESS],f.stretch=0!=h[_+o.PREV_STRETCH])):(f.mix+=(p+(h[_+o.MIX]-p)*g-f.mix)*c,f.softness+=(d+(h[_+o.SOFTNESS]-d)*g-f.softness)*c,u==n.mixIn&&(f.bendDirection=h[_+o.PREV_BEND_DIRECTION],f.compress=0!=h[_+o.PREV_COMPRESS],f.stretch=0!=h[_+o.PREV_STRETCH]))}},o.ENTRIES=6,o.PREV_TIME=-6,o.PREV_MIX=-5,o.PREV_SOFTNESS=-4,o.PREV_BEND_DIRECTION=-3,o.PREV_COMPRESS=-2,o.PREV_STRETCH=-1,o.MIX=1,o.SOFTNESS=2,o.BEND_DIRECTION=3,o.COMPRESS=4,o.STRETCH=5,o}(a);t.IkConstraintTimeline=g;var v=function(n){function a(e){var i=n.call(this,e)||this;return i.frames=t.Utils.newFloatArray(e*a.ENTRIES),i}return yut(a,n),a.prototype.getPropertyId=function(){return(i.transformConstraint<<24)+this.transformConstraintIndex},a.prototype.setFrame=function(t,e,n,i,r,o){t*=a.ENTRIES,this.frames[t]=e,this.frames[t+a.ROTATE]=n,this.frames[t+a.TRANSLATE]=i,this.frames[t+a.SCALE]=r,this.frames[t+a.SHEAR]=o},a.prototype.apply=function(t,n,i,o,s,c){var l=this.frames,u=t.transformConstraints[this.transformConstraintIndex];if(u.active)if(i<l[0]){var h=u.data;switch(c){case e.setup:return u.rotateMix=h.rotateMix,u.translateMix=h.translateMix,u.scaleMix=h.scaleMix,void(u.shearMix=h.shearMix);case e.first:u.rotateMix+=(h.rotateMix-u.rotateMix)*s,u.translateMix+=(h.translateMix-u.translateMix)*s,u.scaleMix+=(h.scaleMix-u.scaleMix)*s,u.shearMix+=(h.shearMix-u.shearMix)*s}}else{var f=0,_=0,p=0,d=0;if(i>=l[l.length-a.ENTRIES]){var m=l.length;f=l[m+a.PREV_ROTATE],_=l[m+a.PREV_TRANSLATE],p=l[m+a.PREV_SCALE],d=l[m+a.PREV_SHEAR]}else{var g=r.binarySearch(l,i,a.ENTRIES);f=l[g+a.PREV_ROTATE],_=l[g+a.PREV_TRANSLATE],p=l[g+a.PREV_SCALE],d=l[g+a.PREV_SHEAR];var v=l[g],y=this.getCurvePercent(g/a.ENTRIES-1,1-(i-v)/(l[g+a.PREV_TIME]-v));f+=(l[g+a.ROTATE]-f)*y,_+=(l[g+a.TRANSLATE]-_)*y,p+=(l[g+a.SCALE]-p)*y,d+=(l[g+a.SHEAR]-d)*y}c==e.setup?(h=u.data,u.rotateMix=h.rotateMix+(f-h.rotateMix)*s,u.translateMix=h.translateMix+(_-h.translateMix)*s,u.scaleMix=h.scaleMix+(p-h.scaleMix)*s,u.shearMix=h.shearMix+(d-h.shearMix)*s):(u.rotateMix+=(f-u.rotateMix)*s,u.translateMix+=(_-u.translateMix)*s,u.scaleMix+=(p-u.scaleMix)*s,u.shearMix+=(d-u.shearMix)*s)}},a.ENTRIES=5,a.PREV_TIME=-5,a.PREV_ROTATE=-4,a.PREV_TRANSLATE=-3,a.PREV_SCALE=-2,a.PREV_SHEAR=-1,a.ROTATE=1,a.TRANSLATE=2,a.SCALE=3,a.SHEAR=4,a}(a);t.TransformConstraintTimeline=v;var y=function(n){function a(e){var i=n.call(this,e)||this;return i.frames=t.Utils.newFloatArray(e*a.ENTRIES),i}return yut(a,n),a.prototype.getPropertyId=function(){return(i.pathConstraintPosition<<24)+this.pathConstraintIndex},a.prototype.setFrame=function(t,e,n){t*=a.ENTRIES,this.frames[t]=e,this.frames[t+a.VALUE]=n},a.prototype.apply=function(t,n,i,o,s,c){var l=this.frames,u=t.pathConstraints[this.pathConstraintIndex];if(u.active)if(i<l[0])switch(c){case e.setup:return void(u.position=u.data.position);case e.first:u.position+=(u.data.position-u.position)*s}else{var h=0;if(i>=l[l.length-a.ENTRIES])h=l[l.length+a.PREV_VALUE];else{var f=r.binarySearch(l,i,a.ENTRIES);h=l[f+a.PREV_VALUE];var _=l[f],p=this.getCurvePercent(f/a.ENTRIES-1,1-(i-_)/(l[f+a.PREV_TIME]-_));h+=(l[f+a.VALUE]-h)*p}c==e.setup?u.position=u.data.position+(h-u.data.position)*s:u.position+=(h-u.position)*s}},a.ENTRIES=2,a.PREV_TIME=-2,a.PREV_VALUE=-1,a.VALUE=1,a}(a);t.PathConstraintPositionTimeline=y;var x=function(t){function n(e){return t.call(this,e)||this}return yut(n,t),n.prototype.getPropertyId=function(){return(i.pathConstraintSpacing<<24)+this.pathConstraintIndex},n.prototype.apply=function(t,i,a,o,s,c){var l=this.frames,u=t.pathConstraints[this.pathConstraintIndex];if(u.active)if(a<l[0])switch(c){case e.setup:return void(u.spacing=u.data.spacing);case e.first:u.spacing+=(u.data.spacing-u.spacing)*s}else{var h=0;if(a>=l[l.length-n.ENTRIES])h=l[l.length+n.PREV_VALUE];else{var f=r.binarySearch(l,a,n.ENTRIES);h=l[f+n.PREV_VALUE];var _=l[f],p=this.getCurvePercent(f/n.ENTRIES-1,1-(a-_)/(l[f+n.PREV_TIME]-_));h+=(l[f+n.VALUE]-h)*p}c==e.setup?u.spacing=u.data.spacing+(h-u.data.spacing)*s:u.spacing+=(h-u.spacing)*s}},n}(y);t.PathConstraintSpacingTimeline=x;var S=function(n){function a(e){var i=n.call(this,e)||this;return i.frames=t.Utils.newFloatArray(e*a.ENTRIES),i}return yut(a,n),a.prototype.getPropertyId=function(){return(i.pathConstraintMix<<24)+this.pathConstraintIndex},a.prototype.setFrame=function(t,e,n,i){t*=a.ENTRIES,this.frames[t]=e,this.frames[t+a.ROTATE]=n,this.frames[t+a.TRANSLATE]=i},a.prototype.apply=function(t,n,i,o,s,c){var l=this.frames,u=t.pathConstraints[this.pathConstraintIndex];if(u.active)if(i<l[0])switch(c){case e.setup:return u.rotateMix=u.data.rotateMix,void(u.translateMix=u.data.translateMix);case e.first:u.rotateMix+=(u.data.rotateMix-u.rotateMix)*s,u.translateMix+=(u.data.translateMix-u.translateMix)*s}else{var h=0,f=0;if(i>=l[l.length-a.ENTRIES])h=l[l.length+a.PREV_ROTATE],f=l[l.length+a.PREV_TRANSLATE];else{var _=r.binarySearch(l,i,a.ENTRIES);h=l[_+a.PREV_ROTATE],f=l[_+a.PREV_TRANSLATE];var p=l[_],d=this.getCurvePercent(_/a.ENTRIES-1,1-(i-p)/(l[_+a.PREV_TIME]-p));h+=(l[_+a.ROTATE]-h)*d,f+=(l[_+a.TRANSLATE]-f)*d}c==e.setup?(u.rotateMix=u.data.rotateMix+(h-u.data.rotateMix)*s,u.translateMix=u.data.translateMix+(f-u.data.translateMix)*s):(u.rotateMix+=(h-u.rotateMix)*s,u.translateMix+=(f-u.translateMix)*s)}},a.ENTRIES=3,a.PREV_TIME=-3,a.PREV_ROTATE=-2,a.PREV_TRANSLATE=-1,a.ROTATE=1,a.TRANSLATE=2,a}(a);t.PathConstraintMixTimeline=S}(vut||(vut={})),function(t){var e=function(){function e(e){this.tracks=new Array,this.timeScale=1,this.events=new Array,this.listeners=new Array,this.queue=new r(this),this.propertyIDs=new t.IntSet,this.animationsChanged=!1,this.trackEntryPool=new t.Pool((function(){return new n})),this.data=e}return e.prototype.update=function(t){t*=this.timeScale;for(var e=this.tracks,n=0,i=e.length;n<i;n++){var r=e[n];if(null!=r){r.animationLast=r.nextAnimationLast,r.trackLast=r.nextTrackLast;var a=t*r.timeScale;if(r.delay>0){if(r.delay-=a,r.delay>0)continue;a=-r.delay,r.delay=0}var o=r.next;if(null!=o){var s=r.trackLast-o.delay;if(s>=0){for(o.delay=0,o.trackTime+=0==r.timeScale?0:(s/r.timeScale+t)*o.timeScale,r.trackTime+=a,this.setCurrent(n,o,!0);null!=o.mixingFrom;)o.mixTime+=t,o=o.mixingFrom;continue}}else if(r.trackLast>=r.trackEnd&&null==r.mixingFrom){e[n]=null,this.queue.end(r),this.disposeNext(r);continue}if(null!=r.mixingFrom&&this.updateMixingFrom(r,t)){var c=r.mixingFrom;for(r.mixingFrom=null,null!=c&&(c.mixingTo=null);null!=c;)this.queue.end(c),c=c.mixingFrom}r.trackTime+=a}}this.queue.drain()},e.prototype.updateMixingFrom=function(t,e){var n=t.mixingFrom;if(null==n)return!0;var i=this.updateMixingFrom(n,e);return n.animationLast=n.nextAnimationLast,n.trackLast=n.nextTrackLast,t.mixTime>0&&t.mixTime>=t.mixDuration?(0!=n.totalAlpha&&0!=t.mixDuration||(t.mixingFrom=n.mixingFrom,null!=n.mixingFrom&&(n.mixingFrom.mixingTo=t),t.interruptAlpha=n.interruptAlpha,this.queue.end(n)),i):(n.trackTime+=e*n.timeScale,t.mixTime+=e,!1)},e.prototype.apply=function(n){if(null==n)throw new Error("skeleton cannot be null.");this.animationsChanged&&this._animationsChanged();for(var i=this.events,r=this.tracks,a=!1,o=0,s=r.length;o<s;o++){var c=r[o];if(!(null==c||c.delay>0)){a=!0;var l=0==o?t.MixBlend.first:c.mixBlend,u=c.alpha;null!=c.mixingFrom?u*=this.applyMixingFrom(c,n,l):c.trackTime>=c.trackEnd&&null==c.next&&(u=0);var h=c.animationLast,f=c.getAnimationTime(),_=c.animation.timelines.length,p=c.animation.timelines;if(0==o&&1==u||l==t.MixBlend.add)for(var d=0;d<_;d++)t.Utils.webkit602BugfixHelper(u,l),p[d].apply(n,h,f,i,u,l,t.MixDirection.mixIn);else{var m=c.timelineMode,g=0==c.timelinesRotation.length;g&&t.Utils.setArraySize(c.timelinesRotation,_<<1,null);var v=c.timelinesRotation;for(d=0;d<_;d++){var y=p[d],x=(m[d]&e.NOT_LAST-1)==e.SUBSEQUENT?l:t.MixBlend.setup;y instanceof t.RotateTimeline?this.applyRotateTimeline(y,n,f,u,x,v,d<<1,g):(t.Utils.webkit602BugfixHelper(u,l),y.apply(n,h,f,i,u,x,t.MixDirection.mixIn))}}this.queueEvents(c,f),i.length=0,c.nextAnimationLast=f,c.nextTrackLast=c.trackTime}}return this.queue.drain(),a},e.prototype.applyMixingFrom=function(n,i,r){var a=n.mixingFrom;null!=a.mixingFrom&&this.applyMixingFrom(a,i,r);var o=0;0==n.mixDuration?(o=1,r==t.MixBlend.first&&(r=t.MixBlend.setup)):((o=n.mixTime/n.mixDuration)>1&&(o=1),r!=t.MixBlend.first&&(r=a.mixBlend));var s=o<a.eventThreshold?this.events:null,c=o<a.attachmentThreshold,l=o<a.drawOrderThreshold,u=a.animationLast,h=a.getAnimationTime(),f=a.animation.timelines.length,_=a.animation.timelines,p=a.alpha*n.interruptAlpha,d=p*(1-o);if(r==t.MixBlend.add)for(var m=0;m<f;m++)_[m].apply(i,u,h,s,d,r,t.MixDirection.mixOut);else{var g=a.timelineMode,v=a.timelineHoldMix,y=0==a.timelinesRotation.length;y&&t.Utils.setArraySize(a.timelinesRotation,f<<1,null);var x=a.timelinesRotation;for(a.totalAlpha=0,m=0;m<f;m++){var S=_[m],T=t.MixDirection.mixOut,A=void 0,E=0;switch(g[m]&e.NOT_LAST-1){case e.SUBSEQUENT:if(A=r,!c&&S instanceof t.AttachmentTimeline){if((g[m]&e.NOT_LAST)==e.NOT_LAST)continue;A=t.MixBlend.setup}if(!l&&S instanceof t.DrawOrderTimeline)continue;E=d;break;case e.FIRST:A=t.MixBlend.setup,E=d;break;case e.HOLD:A=t.MixBlend.setup,E=p;break;default:A=t.MixBlend.setup;var C=v[m];E=p*Math.max(0,1-C.mixTime/C.mixDuration)}a.totalAlpha+=E,S instanceof t.RotateTimeline?this.applyRotateTimeline(S,i,h,E,A,x,m<<1,y):(t.Utils.webkit602BugfixHelper(E,r),A==t.MixBlend.setup&&(S instanceof t.AttachmentTimeline?(c||(g[m]&e.NOT_LAST)==e.NOT_LAST)&&(T=t.MixDirection.mixIn):S instanceof t.DrawOrderTimeline&&l&&(T=t.MixDirection.mixIn)),S.apply(i,u,h,s,E,A,T))}}return n.mixDuration>0&&this.queueEvents(a,h),this.events.length=0,a.nextAnimationLast=h,a.nextTrackLast=a.trackTime,o},e.prototype.applyRotateTimeline=function(e,n,i,r,a,o,s,c){if(c&&(o[s]=0),1!=r){var l=e,u=l.frames,h=n.bones[l.boneIndex];if(h.active){var f=0,_=0;if(i<u[0])switch(a){case t.MixBlend.setup:h.rotation=h.data.rotation;default:return;case t.MixBlend.first:f=h.rotation,_=h.data.rotation}else if(f=a==t.MixBlend.setup?h.data.rotation:h.rotation,i>=u[u.length-t.RotateTimeline.ENTRIES])_=h.data.rotation+u[u.length+t.RotateTimeline.PREV_ROTATION];else{var p=t.Animation.binarySearch(u,i,t.RotateTimeline.ENTRIES),d=u[p+t.RotateTimeline.PREV_ROTATION],m=u[p],g=l.getCurvePercent((p>>1)-1,1-(i-m)/(u[p+t.RotateTimeline.PREV_TIME]-m));_=u[p+t.RotateTimeline.ROTATION]-d,_=d+(_-=360*(16384-(16384.499999999996-_/360|0)))*g+h.data.rotation,_-=360*(16384-(16384.499999999996-_/360|0))}var v=0,y=_-f;if(0==(y-=360*(16384-(16384.499999999996-y/360|0))))v=o[s];else{var x=0,S=0;c?(x=0,S=y):(x=o[s],S=o[s+1]);var T=y>0,A=x>=0;t.MathUtils.signum(S)!=t.MathUtils.signum(y)&&Math.abs(S)<=90&&(Math.abs(x)>180&&(x+=360*t.MathUtils.signum(x)),A=T),v=y+x-x%360,A!=T&&(v+=360*t.MathUtils.signum(x)),o[s]=v}o[s+1]=y,f+=v*r,h.rotation=f-360*(16384-(16384.499999999996-f/360|0))}}else e.apply(n,0,i,null,1,a,t.MixDirection.mixIn)},e.prototype.queueEvents=function(t,e){for(var n=t.animationStart,i=t.animationEnd,r=i-n,a=t.trackLast%r,o=this.events,s=0,c=o.length;s<c;s++){var l=o[s];if(l.time<a)break;l.time>i||this.queue.event(t,l)}for((t.loop?0==r||a>t.trackTime%r:e>=i&&t.animationLast<i)&&this.queue.complete(t);s<c;s++)o[s].time<n||this.queue.event(t,o[s])},e.prototype.clearTracks=function(){var t=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(var e=0,n=this.tracks.length;e<n;e++)this.clearTrack(e);this.tracks.length=0,this.queue.drainDisabled=t,this.queue.drain()},e.prototype.clearTrack=function(t){if(!(t>=this.tracks.length)){var e=this.tracks[t];if(null!=e){this.queue.end(e),this.disposeNext(e);for(var n=e;;){var i=n.mixingFrom;if(null==i)break;this.queue.end(i),n.mixingFrom=null,n.mixingTo=null,n=i}this.tracks[e.trackIndex]=null,this.queue.drain()}}},e.prototype.setCurrent=function(t,e,n){var i=this.expandToIndex(t);this.tracks[t]=e,null!=i&&(n&&this.queue.interrupt(i),e.mixingFrom=i,i.mixingTo=e,e.mixTime=0,null!=i.mixingFrom&&i.mixDuration>0&&(e.interruptAlpha*=Math.min(1,i.mixTime/i.mixDuration)),i.timelinesRotation.length=0),this.queue.start(e)},e.prototype.setAnimation=function(t,e,n){var i=this.data.skeletonData.findAnimation(e);if(null==i)throw new Error("Animation not found: "+e);return this.setAnimationWith(t,i,n)},e.prototype.setAnimationWith=function(t,e,n){if(null==e)throw new Error("animation cannot be null.");var i=!0,r=this.expandToIndex(t);null!=r&&(-1==r.nextTrackLast?(this.tracks[t]=r.mixingFrom,this.queue.interrupt(r),this.queue.end(r),this.disposeNext(r),r=r.mixingFrom,i=!1):this.disposeNext(r));var a=this.trackEntry(t,e,n,r);return this.setCurrent(t,a,i),this.queue.drain(),a},e.prototype.addAnimation=function(t,e,n,i){var r=this.data.skeletonData.findAnimation(e);if(null==r)throw new Error("Animation not found: "+e);return this.addAnimationWith(t,r,n,i)},e.prototype.addAnimationWith=function(t,e,n,i){if(null==e)throw new Error("animation cannot be null.");var r=this.expandToIndex(t);if(null!=r)for(;null!=r.next;)r=r.next;var a=this.trackEntry(t,e,n,r);if(null==r)this.setCurrent(t,a,!0),this.queue.drain();else if(r.next=a,i<=0){var o=r.animationEnd-r.animationStart;0!=o?(r.loop?i+=o*(1+(r.trackTime/o|0)):i+=Math.max(o,r.trackTime),i-=this.data.getMix(r.animation,e)):i=r.trackTime}return a.delay=i,a},e.prototype.setEmptyAnimation=function(t,n){var i=this.setAnimationWith(t,e.emptyAnimation,!1);return i.mixDuration=n,i.trackEnd=n,i},e.prototype.addEmptyAnimation=function(t,n,i){i<=0&&(i-=n);var r=this.addAnimationWith(t,e.emptyAnimation,!1,i);return r.mixDuration=n,r.trackEnd=n,r},e.prototype.setEmptyAnimations=function(t){var e=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(var n=0,i=this.tracks.length;n<i;n++){var r=this.tracks[n];null!=r&&this.setEmptyAnimation(r.trackIndex,t)}this.queue.drainDisabled=e,this.queue.drain()},e.prototype.expandToIndex=function(e){return e<this.tracks.length?this.tracks[e]:(t.Utils.ensureArrayCapacity(this.tracks,e+1,null),this.tracks.length=e+1,null)},e.prototype.trackEntry=function(t,e,n,i){var r=this.trackEntryPool.obtain();return r.trackIndex=t,r.animation=e,r.loop=n,r.holdPrevious=!1,r.eventThreshold=0,r.attachmentThreshold=0,r.drawOrderThreshold=0,r.animationStart=0,r.animationEnd=e.duration,r.animationLast=-1,r.nextAnimationLast=-1,r.delay=0,r.trackTime=0,r.trackLast=-1,r.nextTrackLast=-1,r.trackEnd=Number.MAX_VALUE,r.timeScale=1,r.alpha=1,r.interruptAlpha=1,r.mixTime=0,r.mixDuration=null==i?0:this.data.getMix(i.animation,e),r},e.prototype.disposeNext=function(t){for(var e=t.next;null!=e;)this.queue.dispose(e),e=e.next;t.next=null},e.prototype._animationsChanged=function(){this.animationsChanged=!1,this.propertyIDs.clear();for(var e=0,n=this.tracks.length;e<n;e++)if(null!=(i=this.tracks[e])){for(;null!=i.mixingFrom;)i=i.mixingFrom;do{null!=i.mixingFrom&&i.mixBlend==t.MixBlend.add||this.computeHold(i),i=i.mixingTo}while(null!=i)}for(this.propertyIDs.clear(),e=this.tracks.length-1;e>=0;e--)for(var i=this.tracks[e];null!=i;)this.computeNotLast(i),i=i.mixingFrom},e.prototype.computeHold=function(n){var i=n.mixingTo,r=n.animation.timelines,a=n.animation.timelines.length,o=t.Utils.setArraySize(n.timelineMode,a);n.timelineHoldMix.length=0;var s=t.Utils.setArraySize(n.timelineHoldMix,a),c=this.propertyIDs;if(null!=i&&i.holdPrevious)for(var l=0;l<a;l++)c.add(r[l].getPropertyId()),o[l]=e.HOLD;else t:for(l=0;l<a;l++){var u=r[l],h=u.getPropertyId();if(c.add(h))if(null==i||u instanceof t.AttachmentTimeline||u instanceof t.DrawOrderTimeline||u instanceof t.EventTimeline||!i.animation.hasTimeline(h))o[l]=e.FIRST;else{for(var f=i.mixingTo;null!=f;f=f.mixingTo)if(!f.animation.hasTimeline(h)){if(n.mixDuration>0){o[l]=e.HOLD_MIX,s[l]=f;continue t}break}o[l]=e.HOLD}else o[l]=e.SUBSEQUENT}},e.prototype.computeNotLast=function(n){for(var i=n.animation.timelines,r=n.animation.timelines.length,a=n.timelineMode,o=this.propertyIDs,s=0;s<r;s++)if(i[s]instanceof t.AttachmentTimeline){var c=i[s];o.add(c.slotIndex)||(a[s]|=e.NOT_LAST)}},e.prototype.getCurrent=function(t){return t>=this.tracks.length?null:this.tracks[t]},e.prototype.addListener=function(t){if(null==t)throw new Error("listener cannot be null.");this.listeners.push(t)},e.prototype.removeListener=function(t){var e=this.listeners.indexOf(t);e>=0&&this.listeners.splice(e,1)},e.prototype.clearListeners=function(){this.listeners.length=0},e.prototype.clearListenerNotifications=function(){this.queue.clear()},e.emptyAnimation=new t.Animation("<empty>",[],0),e.SUBSEQUENT=0,e.FIRST=1,e.HOLD=2,e.HOLD_MIX=3,e.NOT_LAST=4,e}();t.AnimationState=e;var n=function(){function e(){this.mixBlend=t.MixBlend.replace,this.timelineMode=new Array,this.timelineHoldMix=new Array,this.timelinesRotation=new Array}return e.prototype.reset=function(){this.next=null,this.mixingFrom=null,this.mixingTo=null,this.animation=null,this.listener=null,this.timelineMode.length=0,this.timelineHoldMix.length=0,this.timelinesRotation.length=0},e.prototype.getAnimationTime=function(){if(this.loop){var t=this.animationEnd-this.animationStart;return 0==t?this.animationStart:this.trackTime%t+this.animationStart}return Math.min(this.trackTime+this.animationStart,this.animationEnd)},e.prototype.setAnimationLast=function(t){this.animationLast=t,this.nextAnimationLast=t},e.prototype.isComplete=function(){return this.trackTime>=this.animationEnd-this.animationStart},e.prototype.resetRotationDirections=function(){this.timelinesRotation.length=0},e}();t.TrackEntry=n;var i,r=function(){function t(t){this.objects=[],this.drainDisabled=!1,this.animState=t}return t.prototype.start=function(t){this.objects.push(i.start),this.objects.push(t),this.animState.animationsChanged=!0},t.prototype.interrupt=function(t){this.objects.push(i.interrupt),this.objects.push(t)},t.prototype.end=function(t){this.objects.push(i.end),this.objects.push(t),this.animState.animationsChanged=!0},t.prototype.dispose=function(t){this.objects.push(i.dispose),this.objects.push(t)},t.prototype.complete=function(t){this.objects.push(i.complete),this.objects.push(t)},t.prototype.event=function(t,e){this.objects.push(i.event),this.objects.push(t),this.objects.push(e)},t.prototype.drain=function(){if(!this.drainDisabled){this.drainDisabled=!0;for(var t=this.objects,e=this.animState.listeners,n=0;n<t.length;n+=2){var r=t[n],a=t[n+1];switch(r){case i.start:null!=a.listener&&a.listener.start&&a.listener.start(a);for(var o=0;o<e.length;o++)e[o].start&&e[o].start(a);break;case i.interrupt:for(null!=a.listener&&a.listener.interrupt&&a.listener.interrupt(a),o=0;o<e.length;o++)e[o].interrupt&&e[o].interrupt(a);break;case i.end:for(null!=a.listener&&a.listener.end&&a.listener.end(a),o=0;o<e.length;o++)e[o].end&&e[o].end(a);case i.dispose:for(null!=a.listener&&a.listener.dispose&&a.listener.dispose(a),o=0;o<e.length;o++)e[o].dispose&&e[o].dispose(a);this.animState.trackEntryPool.free(a);break;case i.complete:for(null!=a.listener&&a.listener.complete&&a.listener.complete(a),o=0;o<e.length;o++)e[o].complete&&e[o].complete(a);break;case i.event:var s=t[2+n++];for(null!=a.listener&&a.listener.event&&a.listener.event(a,s),o=0;o<e.length;o++)e[o].event&&e[o].event(a,s)}}this.clear(),this.drainDisabled=!1}},t.prototype.clear=function(){this.objects.length=0},t}();t.EventQueue=r,function(t){t[t.start=0]="start",t[t.interrupt=1]="interrupt",t[t.end=2]="end",t[t.dispose=3]="dispose",t[t.complete=4]="complete",t[t.event=5]="event"}(i=t.EventType||(t.EventType={}));var a=function(){function t(){}return t.prototype.start=function(){},t.prototype.interrupt=function(){},t.prototype.end=function(){},t.prototype.dispose=function(){},t.prototype.complete=function(){},t.prototype.event=function(){},t}();t.AnimationStateAdapter=a}(vut||(vut={})),function(t){var e=function(){function t(t){if(this.animationToMixTime={},this.defaultMix=0,null==t)throw new Error("skeletonData cannot be null.");this.skeletonData=t}return t.prototype.setMix=function(t,e,n){var i=this.skeletonData.findAnimation(t);if(null==i)throw new Error("Animation not found: "+t);var r=this.skeletonData.findAnimation(e);if(null==r)throw new Error("Animation not found: "+e);this.setMixWith(i,r,n)},t.prototype.setMixWith=function(t,e,n){if(null==t)throw new Error("from cannot be null.");if(null==e)throw new Error("to cannot be null.");var i=t.name+"."+e.name;this.animationToMixTime[i]=n},t.prototype.getMix=function(t,e){var n=t.name+"."+e.name,i=this.animationToMixTime[n];return void 0===i?this.defaultMix:i},t}();t.AnimationStateData=e}(vut||(vut={})),function(t){var e=function(){function e(t,e){void 0===e&&(e=""),this.assets={},this.errors={},this.toLoad=0,this.loaded=0,this.textureLoader=t,this.pathPrefix=e}return e.downloadText=function(t,e,n){var i=new XMLHttpRequest;i.open("GET",t,!0),i.onload=function(){200==i.status?e(i.responseText):n(i.status,i.responseText)},i.onerror=function(){n(i.status,i.responseText)},i.send()},e.downloadBinary=function(t,e,n){var i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType="arraybuffer",i.onload=function(){200==i.status?e(new Uint8Array(i.response)):n(i.status,i.responseText)},i.onerror=function(){n(i.status,i.responseText)},i.send()},e.prototype.loadBinary=function(t,n,i){var r=this;void 0===n&&(n=null),void 0===i&&(i=null),t=this.pathPrefix+t,this.toLoad++,e.downloadBinary(t,(function(e){r.assets[t]=e,n&&n(t,e),r.toLoad--,r.loaded++}),(function(e,n){r.errors[t]="Couldn't load binary "+t+": status "+status+", "+n,i&&i(t,"Couldn't load binary "+t+": status "+status+", "+n),r.toLoad--,r.loaded++}))},e.prototype.loadText=function(t,n,i){var r=this;void 0===n&&(n=null),void 0===i&&(i=null),t=this.pathPrefix+t,this.toLoad++,e.downloadText(t,(function(e){r.assets[t]=e,n&&n(t,e),r.toLoad--,r.loaded++}),(function(e,n){r.errors[t]="Couldn't load text "+t+": status "+status+", "+n,i&&i(t,"Couldn't load text "+t+": status "+status+", "+n),r.toLoad--,r.loaded++}))},e.prototype.loadTexture=function(t,e,n){var i=this;void 0===e&&(e=null),void 0===n&&(n=null),t=this.pathPrefix+t,this.toLoad++;var r=new Image;r.crossOrigin="anonymous",r.onload=function(){var n=i.textureLoader(r);i.assets[t]=n,i.toLoad--,i.loaded++,e&&e(t,r)},r.onerror=function(){i.errors[t]="Couldn't load image "+t,i.toLoad--,i.loaded++,n&&n(t,"Couldn't load image "+t)},r.src=t},e.prototype.loadTextureData=function(t,e,n,i){var r=this;void 0===n&&(n=null),void 0===i&&(i=null),t=this.pathPrefix+t,this.toLoad++;var a=new Image;a.onload=function(){var e=r.textureLoader(a);r.assets[t]=e,r.toLoad--,r.loaded++,n&&n(t,a)},a.onerror=function(){r.errors[t]="Couldn't load image "+t,r.toLoad--,r.loaded++,i&&i(t,"Couldn't load image "+t)},a.src=e},e.prototype.loadTextureAtlas=function(n,i,r){var a=this;void 0===i&&(i=null),void 0===r&&(r=null);var o=n.lastIndexOf("/")>=0?n.substring(0,n.lastIndexOf("/")):"";n=this.pathPrefix+n,this.toLoad++,e.downloadText(n,(function(e){var s={count:0},c=new Array;try{new t.TextureAtlas(e,(function(e){c.push(o+"/"+e);var n=document.createElement("img");return n.width=16,n.height=16,new t.FakeTexture(n)}))}catch(t){var l=t;return a.errors[n]="Couldn't load texture atlas "+n+": "+l.message,r&&r(n,"Couldn't load texture atlas "+n+": "+l.message),a.toLoad--,void a.loaded++}for(var u=function(l){var u=!1;a.loadTexture(l,(function(l){if(s.count++,s.count==c.length)if(u)a.errors[n]="Couldn't load texture atlas page "+l+"} of atlas "+n,r&&r(n,"Couldn't load texture atlas page "+l+" of atlas "+n),a.toLoad--,a.loaded++;else try{var h=new t.TextureAtlas(e,(function(t){return a.get(o+"/"+t)}));a.assets[n]=h,i&&i(n,h),a.toLoad--,a.loaded++}catch(t){var f=t;a.errors[n]="Couldn't load texture atlas "+n+": "+f.message,r&&r(n,"Couldn't load texture atlas "+n+": "+f.message),a.toLoad--,a.loaded++}}),(function(t){u=!0,s.count++,s.count==c.length&&(a.errors[n]="Couldn't load texture atlas page "+t+"} of atlas "+n,r&&r(n,"Couldn't load texture atlas page "+t+" of atlas "+n),a.toLoad--,a.loaded++)}))},h=0,f=c;h<f.length;h++)u(f[h])}),(function(t,e){a.errors[n]="Couldn't load texture atlas "+n+": status "+status+", "+e,r&&r(n,"Couldn't load texture atlas "+n+": status "+status+", "+e),a.toLoad--,a.loaded++}))},e.prototype.get=function(t){return t=this.pathPrefix+t,this.assets[t]},e.prototype.remove=function(t){t=this.pathPrefix+t;var e=this.assets[t];e.dispose&&e.dispose(),this.assets[t]=null},e.prototype.removeAll=function(){for(var t in this.assets){var e=this.assets[t];e.dispose&&e.dispose()}this.assets={}},e.prototype.isLoadingComplete=function(){return 0==this.toLoad},e.prototype.getToLoad=function(){return this.toLoad},e.prototype.getLoaded=function(){return this.loaded},e.prototype.dispose=function(){this.removeAll()},e.prototype.hasErrors=function(){return Object.keys(this.errors).length>0},e.prototype.getErrors=function(){return this.errors},e}();t.AssetManager=e}(vut||(vut={})),function(t){var e=function(){function e(t){this.atlas=t}return e.prototype.newRegionAttachment=function(e,n,i){var r=this.atlas.findRegion(i);if(null==r)return null;r.renderObject=r;var a=new t.RegionAttachment(n);return a.setRegion(r),a},e.prototype.newMeshAttachment=function(e,n,i){var r=this.atlas.findRegion(i);if(null==r)return null;r.renderObject=r;var a=new t.MeshAttachment(n);return a.region=r,a},e.prototype.newBoundingBoxAttachment=function(e,n){return new t.BoundingBoxAttachment(n)},e.prototype.newPathAttachment=function(e,n){return new t.PathAttachment(n)},e.prototype.newPointAttachment=function(e,n){return new t.PointAttachment(n)},e.prototype.newClippingAttachment=function(e,n){return new t.ClippingAttachment(n)},e}();t.AtlasAttachmentLoader=e}(vut||(vut={})),function(t){!function(t){t[t.Normal=0]="Normal",t[t.Additive=1]="Additive",t[t.Multiply=2]="Multiply",t[t.Screen=3]="Screen"}(t.BlendMode||(t.BlendMode={}))}(vut||(vut={})),function(t){var e=function(){function e(t,e,n){if(this.children=new Array,this.x=0,this.y=0,this.rotation=0,this.scaleX=0,this.scaleY=0,this.shearX=0,this.shearY=0,this.ax=0,this.ay=0,this.arotation=0,this.ascaleX=0,this.ascaleY=0,this.ashearX=0,this.ashearY=0,this.appliedValid=!1,this.a=0,this.b=0,this.c=0,this.d=0,this.worldY=0,this.worldX=0,this.sorted=!1,this.active=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.skeleton=e,this.parent=n,this.setToSetupPose()}return e.prototype.isActive=function(){return this.active},e.prototype.update=function(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)},e.prototype.updateWorldTransform=function(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)},e.prototype.updateWorldTransformWith=function(e,n,i,r,a,o,s){this.ax=e,this.ay=n,this.arotation=i,this.ascaleX=r,this.ascaleY=a,this.ashearX=o,this.ashearY=s,this.appliedValid=!0;var c=this.parent;if(null==c){var l=this.skeleton,u=i+90+s,h=l.scaleX,f=l.scaleY;return this.a=t.MathUtils.cosDeg(i+o)*r*h,this.b=t.MathUtils.cosDeg(u)*a*h,this.c=t.MathUtils.sinDeg(i+o)*r*f,this.d=t.MathUtils.sinDeg(u)*a*f,this.worldX=e*h+l.x,void(this.worldY=n*f+l.y)}var _=c.a,p=c.b,d=c.c,m=c.d;switch(this.worldX=_*e+p*n+c.worldX,this.worldY=d*e+m*n+c.worldY,this.data.transformMode){case t.TransformMode.Normal:u=i+90+s;var g=t.MathUtils.cosDeg(i+o)*r,v=t.MathUtils.cosDeg(u)*a,y=t.MathUtils.sinDeg(i+o)*r,x=t.MathUtils.sinDeg(u)*a;return this.a=_*g+p*y,this.b=_*v+p*x,this.c=d*g+m*y,void(this.d=d*v+m*x);case t.TransformMode.OnlyTranslation:u=i+90+s,this.a=t.MathUtils.cosDeg(i+o)*r,this.b=t.MathUtils.cosDeg(u)*a,this.c=t.MathUtils.sinDeg(i+o)*r,this.d=t.MathUtils.sinDeg(u)*a;break;case t.TransformMode.NoRotationOrReflection:var S=0;(E=_*_+d*d)>1e-4?(p=d*(E=Math.abs(_*m-p*d)/E),m=_*E,S=Math.atan2(d,_)*t.MathUtils.radDeg):(_=0,d=0,S=90-Math.atan2(m,p)*t.MathUtils.radDeg);var T=i+o-S,A=i+s-S+90;g=t.MathUtils.cosDeg(T)*r,v=t.MathUtils.cosDeg(A)*a,y=t.MathUtils.sinDeg(T)*r,x=t.MathUtils.sinDeg(A)*a,this.a=_*g-p*y,this.b=_*v-p*x,this.c=d*g+m*y,this.d=d*v+m*x;break;case t.TransformMode.NoScale:case t.TransformMode.NoScaleOrReflection:var E,C=t.MathUtils.cosDeg(i),b=t.MathUtils.sinDeg(i),w=(_*C+p*b)/this.skeleton.scaleX,P=(d*C+m*b)/this.skeleton.scaleY;(E=Math.sqrt(w*w+P*P))>1e-5&&(E=1/E),w*=E,P*=E,E=Math.sqrt(w*w+P*P),this.data.transformMode==t.TransformMode.NoScale&&_*m-p*d<0!=(this.skeleton.scaleX<0!=this.skeleton.scaleY<0)&&(E=-E);var I=Math.PI/2+Math.atan2(P,w),R=Math.cos(I)*E,D=Math.sin(I)*E;g=t.MathUtils.cosDeg(o)*r,v=t.MathUtils.cosDeg(90+s)*a,y=t.MathUtils.sinDeg(o)*r,x=t.MathUtils.sinDeg(90+s)*a,this.a=w*g+R*y,this.b=w*v+R*x,this.c=P*g+D*y,this.d=P*v+D*x}this.a*=this.skeleton.scaleX,this.b*=this.skeleton.scaleX,this.c*=this.skeleton.scaleY,this.d*=this.skeleton.scaleY},e.prototype.setToSetupPose=function(){var t=this.data;this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.shearX=t.shearX,this.shearY=t.shearY},e.prototype.getWorldRotationX=function(){return Math.atan2(this.c,this.a)*t.MathUtils.radDeg},e.prototype.getWorldRotationY=function(){return Math.atan2(this.d,this.b)*t.MathUtils.radDeg},e.prototype.getWorldScaleX=function(){return Math.sqrt(this.a*this.a+this.c*this.c)},e.prototype.getWorldScaleY=function(){return Math.sqrt(this.b*this.b+this.d*this.d)},e.prototype.updateAppliedTransform=function(){this.appliedValid=!0;var e=this.parent;if(null==e)return this.ax=this.worldX,this.ay=this.worldY,this.arotation=Math.atan2(this.c,this.a)*t.MathUtils.radDeg,this.ascaleX=Math.sqrt(this.a*this.a+this.c*this.c),this.ascaleY=Math.sqrt(this.b*this.b+this.d*this.d),this.ashearX=0,void(this.ashearY=Math.atan2(this.a*this.b+this.c*this.d,this.a*this.d-this.b*this.c)*t.MathUtils.radDeg);var n=e.a,i=e.b,r=e.c,a=e.d,o=1/(n*a-i*r),s=this.worldX-e.worldX,c=this.worldY-e.worldY;this.ax=s*a*o-c*i*o,this.ay=c*n*o-s*r*o;var l=o*a,u=o*n,h=o*i,f=o*r,_=l*this.a-h*this.c,p=l*this.b-h*this.d,d=u*this.c-f*this.a,m=u*this.d-f*this.b;if(this.ashearX=0,this.ascaleX=Math.sqrt(_*_+d*d),this.ascaleX>1e-4){var g=_*m-p*d;this.ascaleY=g/this.ascaleX,this.ashearY=Math.atan2(_*p+d*m,g)*t.MathUtils.radDeg,this.arotation=Math.atan2(d,_)*t.MathUtils.radDeg}else this.ascaleX=0,this.ascaleY=Math.sqrt(p*p+m*m),this.ashearY=0,this.arotation=90-Math.atan2(m,p)*t.MathUtils.radDeg},e.prototype.worldToLocal=function(t){var e=this.a,n=this.b,i=this.c,r=this.d,a=1/(e*r-n*i),o=t.x-this.worldX,s=t.y-this.worldY;return t.x=o*r*a-s*n*a,t.y=s*e*a-o*i*a,t},e.prototype.localToWorld=function(t){var e=t.x,n=t.y;return t.x=e*this.a+n*this.b+this.worldX,t.y=e*this.c+n*this.d+this.worldY,t},e.prototype.worldToLocalRotation=function(e){var n=t.MathUtils.sinDeg(e),i=t.MathUtils.cosDeg(e);return Math.atan2(this.a*n-this.c*i,this.d*i-this.b*n)*t.MathUtils.radDeg+this.rotation-this.shearX},e.prototype.localToWorldRotation=function(e){e-=this.rotation-this.shearX;var n=t.MathUtils.sinDeg(e),i=t.MathUtils.cosDeg(e);return Math.atan2(i*this.c+n*this.d,i*this.a+n*this.b)*t.MathUtils.radDeg},e.prototype.rotateWorld=function(e){var n=this.a,i=this.b,r=this.c,a=this.d,o=t.MathUtils.cosDeg(e),s=t.MathUtils.sinDeg(e);this.a=o*n-s*r,this.b=o*i-s*a,this.c=s*n+o*r,this.d=s*i+o*a,this.appliedValid=!1},e}();t.Bone=e}(vut||(vut={})),function(t){var e;t.BoneData=function(n,i,r){if(this.x=0,this.y=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.shearX=0,this.shearY=0,this.transformMode=e.Normal,this.skinRequired=!1,this.color=new t.Color,n<0)throw new Error("index must be >= 0.");if(null==i)throw new Error("name cannot be null.");this.index=n,this.name=i,this.parent=r},function(t){t[t.Normal=0]="Normal",t[t.OnlyTranslation=1]="OnlyTranslation",t[t.NoRotationOrReflection=2]="NoRotationOrReflection",t[t.NoScale=3]="NoScale",t[t.NoScaleOrReflection=4]="NoScaleOrReflection"}(e=t.TransformMode||(t.TransformMode={}))}(vut||(vut={})),function(t){t.ConstraintData=function(t,e,n){this.name=t,this.order=e,this.skinRequired=n}}(vut||(vut={})),function(t){t.Event=function(t,e){if(null==e)throw new Error("data cannot be null.");this.time=t,this.data=e}}(vut||(vut={})),function(t){t.EventData=function(t){this.name=t}}(vut||(vut={})),function(t){var e=function(){function e(t,e){if(this.bendDirection=0,this.compress=!1,this.stretch=!1,this.mix=1,this.softness=0,this.active=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.mix=t.mix,this.softness=t.softness,this.bendDirection=t.bendDirection,this.compress=t.compress,this.stretch=t.stretch,this.bones=new Array;for(var n=0;n<t.bones.length;n++)this.bones.push(e.findBone(t.bones[n].name));this.target=e.findBone(t.target.name)}return e.prototype.isActive=function(){return this.active},e.prototype.apply=function(){this.update()},e.prototype.update=function(){var t=this.target,e=this.bones;switch(e.length){case 1:this.apply1(e[0],t.worldX,t.worldY,this.compress,this.stretch,this.data.uniform,this.mix);break;case 2:this.apply2(e[0],e[1],t.worldX,t.worldY,this.bendDirection,this.stretch,this.softness,this.mix)}},e.prototype.apply1=function(e,n,i,r,a,o,s){e.appliedValid||e.updateAppliedTransform();var c=e.parent,l=1/(c.a*c.d-c.b*c.c),u=n-c.worldX,h=i-c.worldY,f=(u*c.d-h*c.b)*l-e.ax,_=(h*c.a-u*c.c)*l-e.ay,p=Math.atan2(_,f)*t.MathUtils.radDeg-e.ashearX-e.arotation;e.ascaleX<0&&(p+=180),p>180?p-=360:p<-180&&(p+=360);var d=e.ascaleX,m=e.ascaleY;if(r||a){var g=e.data.length*d,v=Math.sqrt(f*f+_*_);if(r&&v<g||a&&v>g&&g>1e-4){var y=(v/g-1)*s+1;d*=y,o&&(m*=y)}}e.updateWorldTransformWith(e.ax,e.ay,e.arotation+p*s,d,m,e.ashearX,e.ashearY)},e.prototype.apply2=function(e,n,i,r,a,o,s,c){if(0!=c){e.appliedValid||e.updateAppliedTransform(),n.appliedValid||n.updateAppliedTransform();var l=e.ax,u=e.ay,h=e.ascaleX,f=h,_=e.ascaleY,p=n.ascaleX,d=0,m=0,g=0;h<0?(h=-h,d=180,g=-1):(d=0,g=1),_<0&&(_=-_,g=-g),p<0?(p=-p,m=180):m=0;var v=n.ax,y=0,x=0,S=0,T=e.a,A=e.b,E=e.c,C=e.d,b=Math.abs(h-_)<=1e-4;b?(x=T*v+A*(y=n.ay)+e.worldX,S=E*v+C*y+e.worldY):(y=0,x=T*v+e.worldX,S=E*v+e.worldY);var w=e.parent;T=w.a,A=w.b,E=w.c;var P,I,R=1/(T*(C=w.d)-A*E),D=x-w.worldX,O=S-w.worldY,M=(D*C-O*A)*R-l,N=(O*T-D*E)*R-u,L=Math.sqrt(M*M+N*N),B=n.data.length*p;if(L<1e-4)return this.apply1(e,i,r,!1,o,!1,c),void n.updateWorldTransformWith(v,y,0,n.ascaleX,n.ascaleY,n.ashearX,n.ashearY);var F=((D=i-w.worldX)*C-(O=r-w.worldY)*A)*R-l,z=(O*T-D*E)*R-u,U=F*F+z*z;if(0!=s){s*=h*(p+1)/2;var k=Math.sqrt(U),G=k-L-B*h+s;if(G>0){var H=Math.min(1,G/(2*s))-1;U=(F-=(H=(G-s*(1-H*H))/k)*F)*F+(z-=H*z)*z}}t:if(b){var V=(U-L*L-(B*=h)*B)/(2*L*B);V<-1?V=-1:V>1&&(V=1,o&&(f*=(Math.sqrt(U)/(L+B)-1)*c+1)),I=Math.acos(V)*a,T=L+B*V,A=B*Math.sin(I),P=Math.atan2(z*T-F*A,F*T+z*A)}else{var j=(T=h*B)*T,W=(A=_*B)*A,X=Math.atan2(z,F),q=-2*W*L,Y=W-j;if((C=q*q-4*Y*(E=W*L*L+j*U-j*W))>=0){var K=Math.sqrt(C);q<0&&(K=-K);var Q=(K=-(q+K)/2)/Y,Z=E/K,J=Math.abs(Q)<Math.abs(Z)?Q:Z;if(J*J<=U){O=Math.sqrt(U-J*J)*a,P=X-Math.atan2(O,J),I=Math.atan2(O/_,(J-L)/h);break t}}var $=t.MathUtils.PI,tt=L-T,et=tt*tt,nt=0,it=0,rt=L+T,at=rt*rt,ot=0;(E=-T*L/(j-W))>=-1&&E<=1&&(E=Math.acos(E),(C=(D=T*Math.cos(E)+L)*D+(O=A*Math.sin(E))*O)<et&&($=E,et=C,tt=D,nt=O),C>at&&(it=E,at=C,rt=D,ot=O)),U<=(et+at)/2?(P=X-Math.atan2(nt*a,tt),I=$*a):(P=X-Math.atan2(ot*a,rt),I=it*a)}var st=Math.atan2(y,v)*g,ct=e.arotation;(P=(P-st)*t.MathUtils.radDeg+d-ct)>180?P-=360:P<-180&&(P+=360),e.updateWorldTransformWith(l,u,ct+P*c,f,e.ascaleY,0,0),ct=n.arotation,(I=((I+st)*t.MathUtils.radDeg-n.ashearX)*g+m-ct)>180?I-=360:I<-180&&(I+=360),n.updateWorldTransformWith(v,y,ct+I*c,n.ascaleX,n.ascaleY,n.ashearX,n.ashearY)}else n.updateWorldTransform()},e}();t.IkConstraint=e}(vut||(vut={})),function(t){var e=function(t){function e(e){var n=t.call(this,e,0,!1)||this;return n.bones=new Array,n.bendDirection=1,n.compress=!1,n.stretch=!1,n.uniform=!1,n.mix=1,n.softness=0,n}return yut(e,t),e}(t.ConstraintData);t.IkConstraintData=e}(vut||(vut={})),function(t){var e=function(){function e(t,e){if(this.position=0,this.spacing=0,this.rotateMix=0,this.translateMix=0,this.spaces=new Array,this.positions=new Array,this.world=new Array,this.curves=new Array,this.lengths=new Array,this.segments=new Array,this.active=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.bones=new Array;for(var n=0,i=t.bones.length;n<i;n++)this.bones.push(e.findBone(t.bones[n].name));this.target=e.findSlot(t.target.name),this.position=t.position,this.spacing=t.spacing,this.rotateMix=t.rotateMix,this.translateMix=t.translateMix}return e.prototype.isActive=function(){return this.active},e.prototype.apply=function(){this.update()},e.prototype.update=function(){var n=this.target.getAttachment();if(n instanceof t.PathAttachment){var i=this.rotateMix,r=this.translateMix,a=i>0;if(r>0||a){var o=this.data,s=o.spacingMode==t.SpacingMode.Percent,c=o.rotateMode,l=c==t.RotateMode.Tangent,u=c==t.RotateMode.ChainScale,h=this.bones.length,f=l?h:h+1,_=this.bones,p=t.Utils.setArraySize(this.spaces,f),d=null,m=this.spacing;if(u||!s){u&&(d=t.Utils.setArraySize(this.lengths,h));for(var g=o.spacingMode==t.SpacingMode.Length,v=0,y=f-1;v<y;){var x=(D=_[v]).data.length;if(x<e.epsilon)u&&(d[v]=0),p[++v]=0;else if(s){if(u){var S=x*D.a,T=x*D.c,A=Math.sqrt(S*S+T*T);d[v]=A}p[++v]=m}else{S=x*D.a,T=x*D.c;var E=Math.sqrt(S*S+T*T);u&&(d[v]=E),p[++v]=(g?x+m:m)*E/x}}}else for(v=1;v<f;v++)p[v]=m;var C=this.computeWorldPositions(n,f,l,o.positionMode==t.PositionMode.Percent,s),b=C[0],w=C[1],P=o.offsetRotation,I=!1;0==P?I=c==t.RotateMode.Chain:(I=!1,P*=(R=this.target.bone).a*R.d-R.b*R.c>0?t.MathUtils.degRad:-t.MathUtils.degRad),v=0;for(var R=3;v<h;v++,R+=3){var D;(D=_[v]).worldX+=(b-D.worldX)*r,D.worldY+=(w-D.worldY)*r;var O=(S=C[R])-b,M=(T=C[R+1])-w;if(u){var N=d[v];if(0!=N){var L=(Math.sqrt(O*O+M*M)/N-1)*i+1;D.a*=L,D.c*=L}}if(b=S,w=T,a){var B=D.a,F=D.b,z=D.c,U=D.d,k=0,G=0,H=0;if(k=l?C[R-1]:0==p[v+1]?C[R+2]:Math.atan2(M,O),k-=Math.atan2(z,B),I){G=Math.cos(k),H=Math.sin(k);var V=D.data.length;b+=(V*(G*B-H*z)-O)*i,w+=(V*(H*B+G*z)-M)*i}else k+=P;k>t.MathUtils.PI?k-=t.MathUtils.PI2:k<-t.MathUtils.PI&&(k+=t.MathUtils.PI2),k*=i,G=Math.cos(k),H=Math.sin(k),D.a=G*B-H*z,D.b=G*F-H*U,D.c=H*B+G*z,D.d=H*F+G*U}D.appliedValid=!1}}}},e.prototype.computeWorldPositions=function(n,i,r,a,o){var s=this.target,c=this.position,l=this.spaces,u=t.Utils.setArraySize(this.positions,3*i+2),h=null,f=n.closed,_=n.worldVerticesLength,p=_/6,d=e.NONE;if(!n.constantSpeed){var m=n.lengths,g=m[p-=f?1:2];if(a&&(c*=g),o)for(var v=1;v<i;v++)l[v]*=g;h=t.Utils.setArraySize(this.world,8),v=0;for(var y=0,x=0;v<i;v++,y+=3){var S=c+=W=l[v];if(f)(S%=g)<0&&(S+=g),x=0;else{if(S<0){d!=e.BEFORE&&(d=e.BEFORE,n.computeWorldVertices(s,2,4,h,0,2)),this.addBeforePosition(S,h,0,u,y);continue}if(S>g){d!=e.AFTER&&(d=e.AFTER,n.computeWorldVertices(s,_-6,4,h,0,2)),this.addAfterPosition(S-g,h,0,u,y);continue}}for(;;x++){var T=m[x];if(!(S>T)){0==x?S/=T:S=(S-(K=m[x-1]))/(T-K);break}}x!=d&&(d=x,f&&x==p?(n.computeWorldVertices(s,_-4,4,h,0,2),n.computeWorldVertices(s,0,4,h,4,2)):n.computeWorldVertices(s,6*x+2,8,h,0,2)),this.addCurvePosition(S,h[0],h[1],h[2],h[3],h[4],h[5],h[6],h[7],u,y,r||v>0&&0==W)}return u}f?(_+=2,h=t.Utils.setArraySize(this.world,_),n.computeWorldVertices(s,2,_-4,h,0,2),n.computeWorldVertices(s,0,2,h,_-4,2),h[_-2]=h[0],h[_-1]=h[1]):(p--,_-=4,h=t.Utils.setArraySize(this.world,_),n.computeWorldVertices(s,2,_,h,0,2));for(var A=t.Utils.setArraySize(this.curves,p),E=0,C=h[0],b=h[1],w=0,P=0,I=0,R=0,D=0,O=0,M=0,N=0,L=0,B=0,F=0,z=0,U=0,k=0,G=(v=0,2);v<p;v++,G+=6)w=h[G],P=h[G+1],I=h[G+2],R=h[G+3],F=2*(M=.1875*(C-2*w+I))+(L=.09375*(3*(w-I)-C+(D=h[G+4]))),z=2*(N=.1875*(b-2*P+R))+(B=.09375*(3*(P-R)-b+(O=h[G+5]))),U=.75*(w-C)+M+.16666667*L,k=.75*(P-b)+N+.16666667*B,E+=Math.sqrt(U*U+k*k),U+=F,k+=z,F+=L,z+=B,E+=Math.sqrt(U*U+k*k),U+=F,k+=z,E+=Math.sqrt(U*U+k*k),U+=F+L,k+=z+B,E+=Math.sqrt(U*U+k*k),A[v]=E,C=D,b=O;if(c*=a?E:E/n.lengths[p-1],o)for(v=1;v<i;v++)l[v]*=E;for(var H=this.segments,V=0,j=(v=0,y=0,x=0,0);v<i;v++,y+=3){var W;if(S=c+=W=l[v],f)(S%=E)<0&&(S+=E),x=0;else{if(S<0){this.addBeforePosition(S,h,0,u,y);continue}if(S>E){this.addAfterPosition(S-E,h,_-4,u,y);continue}}for(;;x++){var X=A[x];if(!(S>X)){0==x?S/=X:S=(S-(K=A[x-1]))/(X-K);break}}if(x!=d){d=x;var q=6*x;for(C=h[q],b=h[q+1],w=h[q+2],P=h[q+3],I=h[q+4],R=h[q+5],F=2*(M=.03*(C-2*w+I))+(L=.006*(3*(w-I)-C+(D=h[q+6]))),z=2*(N=.03*(b-2*P+R))+(B=.006*(3*(P-R)-b+(O=h[q+7]))),U=.3*(w-C)+M+.16666667*L,k=.3*(P-b)+N+.16666667*B,V=Math.sqrt(U*U+k*k),H[0]=V,q=1;q<8;q++)U+=F,k+=z,F+=L,z+=B,V+=Math.sqrt(U*U+k*k),H[q]=V;U+=F,k+=z,V+=Math.sqrt(U*U+k*k),H[8]=V,U+=F+L,k+=z+B,V+=Math.sqrt(U*U+k*k),H[9]=V,j=0}for(S*=V;;j++){var Y=H[j];if(!(S>Y)){var K;0==j?S/=Y:S=j+(S-(K=H[j-1]))/(Y-K);break}}this.addCurvePosition(.1*S,C,b,w,P,I,R,D,O,u,y,r||v>0&&0==W)}return u},e.prototype.addBeforePosition=function(t,e,n,i,r){var a=e[n],o=e[n+1],s=e[n+2]-a,c=e[n+3]-o,l=Math.atan2(c,s);i[r]=a+t*Math.cos(l),i[r+1]=o+t*Math.sin(l),i[r+2]=l},e.prototype.addAfterPosition=function(t,e,n,i,r){var a=e[n+2],o=e[n+3],s=a-e[n],c=o-e[n+1],l=Math.atan2(c,s);i[r]=a+t*Math.cos(l),i[r+1]=o+t*Math.sin(l),i[r+2]=l},e.prototype.addCurvePosition=function(t,e,n,i,r,a,o,s,c,l,u,h){if(0==t||isNaN(t))return l[u]=e,l[u+1]=n,void(l[u+2]=Math.atan2(r-n,i-e));var f=t*t,_=f*t,p=1-t,d=p*p,m=d*p,g=p*t,v=3*g,y=p*v,x=v*t,S=e*m+i*y+a*x+s*_,T=n*m+r*y+o*x+c*_;l[u]=S,l[u+1]=T,h&&(l[u+2]=t<.001?Math.atan2(r-n,i-e):Math.atan2(T-(n*d+r*g*2+o*f),S-(e*d+i*g*2+a*f)))},e.NONE=-1,e.BEFORE=-2,e.AFTER=-3,e.epsilon=1e-5,e}();t.PathConstraint=e}(vut||(vut={})),function(t){var e,n,i,r=function(t){function e(e){var n=t.call(this,e,0,!1)||this;return n.bones=new Array,n}return yut(e,t),e}(t.ConstraintData);t.PathConstraintData=r,(i=t.PositionMode||(t.PositionMode={}))[i.Fixed=0]="Fixed",i[i.Percent=1]="Percent",(n=t.SpacingMode||(t.SpacingMode={}))[n.Length=0]="Length",n[n.Fixed=1]="Fixed",n[n.Percent=2]="Percent",(e=t.RotateMode||(t.RotateMode={}))[e.Tangent=0]="Tangent",e[e.Chain=1]="Chain",e[e.ChainScale=2]="ChainScale"}(vut||(vut={})),function(t){var e=function(){function t(t){this.toLoad=new Array,this.assets={},this.clientId=t}return t.prototype.loaded=function(){var t=0;for(var e in this.assets)t++;return t},t}(),n=function(){function t(t){void 0===t&&(t=""),this.clientAssets={},this.queuedAssets={},this.rawAssets={},this.errors={},this.pathPrefix=t}return t.prototype.queueAsset=function(t,n,i){var r=this.clientAssets[t];return null==r&&(r=new e(t),this.clientAssets[t]=r),null!==n&&(r.textureLoader=n),r.toLoad.push(i),this.queuedAssets[i]!==i&&(this.queuedAssets[i]=i,!0)},t.prototype.loadText=function(t,e){var n=this;if(e=this.pathPrefix+e,this.queueAsset(t,null,e)){var i=new XMLHttpRequest;i.onreadystatechange=function(){i.readyState==XMLHttpRequest.DONE&&(i.status>=200&&i.status<300?n.rawAssets[e]=i.responseText:n.errors[e]="Couldn't load text "+e+": status "+i.status+", "+i.responseText)},i.open("GET",e,!0),i.send()}},t.prototype.loadJson=function(t,e){var n=this;if(e=this.pathPrefix+e,this.queueAsset(t,null,e)){var i=new XMLHttpRequest;i.onreadystatechange=function(){i.readyState==XMLHttpRequest.DONE&&(i.status>=200&&i.status<300?n.rawAssets[e]=JSON.parse(i.responseText):n.errors[e]="Couldn't load text "+e+": status "+i.status+", "+i.responseText)},i.open("GET",e,!0),i.send()}},t.prototype.loadTexture=function(t,e,n){var i=this;if(n=this.pathPrefix+n,this.queueAsset(t,e,n)){var r=new Image;r.src=n,r.crossOrigin="anonymous",r.onload=function(){i.rawAssets[n]=r},r.onerror=function(){i.errors[n]="Couldn't load image "+n}}},t.prototype.get=function(t,e){e=this.pathPrefix+e;var n=this.clientAssets[t];return null==n||n.assets[e]},t.prototype.updateClientAssets=function(t){for(var e=0;e<t.toLoad.length;e++){var n=t.toLoad[e];if(null==t.assets[n]){var i=this.rawAssets[n];if(null==i)continue;i instanceof HTMLImageElement?t.assets[n]=t.textureLoader(i):t.assets[n]=i}}},t.prototype.isLoadingComplete=function(t){var e=this.clientAssets[t];return null==e||(this.updateClientAssets(e),e.toLoad.length==e.loaded())},t.prototype.dispose=function(){},t.prototype.hasErrors=function(){return Object.keys(this.errors).length>0},t.prototype.getErrors=function(){return this.errors},t}();t.SharedAssetManager=n}(vut||(vut={})),function(t){var e=function(){function e(e){if(this._updateCache=new Array,this.updateCacheReset=new Array,this.time=0,this.scaleX=1,this.scaleY=1,this.x=0,this.y=0,null==e)throw new Error("data cannot be null.");this.data=e,this.bones=new Array;for(var n=0;n<e.bones.length;n++){var i=e.bones[n],r=void 0;if(null==i.parent)r=new t.Bone(i,this,null);else{var a=this.bones[i.parent.index];r=new t.Bone(i,this,a),a.children.push(r)}this.bones.push(r)}for(this.slots=new Array,this.drawOrder=new Array,n=0;n<e.slots.length;n++){var o=e.slots[n],s=(r=this.bones[o.boneData.index],new t.Slot(o,r));this.slots.push(s),this.drawOrder.push(s)}for(this.ikConstraints=new Array,n=0;n<e.ikConstraints.length;n++){var c=e.ikConstraints[n];this.ikConstraints.push(new t.IkConstraint(c,this))}for(this.transformConstraints=new Array,n=0;n<e.transformConstraints.length;n++){var l=e.transformConstraints[n];this.transformConstraints.push(new t.TransformConstraint(l,this))}for(this.pathConstraints=new Array,n=0;n<e.pathConstraints.length;n++){var u=e.pathConstraints[n];this.pathConstraints.push(new t.PathConstraint(u,this))}this.color=new t.Color(1,1,1,1),this.updateCache()}return e.prototype.updateCache=function(){this._updateCache.length=0,this.updateCacheReset.length=0;for(var t=this.bones,e=0,n=t.length;e<n;e++)(r=t[e]).sorted=r.data.skinRequired,r.active=!r.sorted;if(null!=this.skin){var i=this.skin.bones;for(e=0,n=this.skin.bones.length;e<n;e++){var r=this.bones[i[e].index];do{r.sorted=!1,r.active=!0,r=r.parent}while(null!=r)}}var a=this.ikConstraints,o=this.transformConstraints,s=this.pathConstraints,c=a.length,l=o.length,u=s.length,h=c+l+u;t:for(e=0;e<h;e++){for(var f=0;f<c;f++)if((_=a[f]).data.order==e){this.sortIkConstraint(_);continue t}for(f=0;f<l;f++)if((_=o[f]).data.order==e){this.sortTransformConstraint(_);continue t}for(f=0;f<u;f++){var _;if((_=s[f]).data.order==e){this.sortPathConstraint(_);continue t}}}for(e=0,n=t.length;e<n;e++)this.sortBone(t[e])},e.prototype.sortIkConstraint=function(e){if(e.active=e.target.isActive()&&(!e.data.skinRequired||null!=this.skin&&t.Utils.contains(this.skin.constraints,e.data,!0)),e.active){var n=e.target;this.sortBone(n);var i=e.bones,r=i[0];if(this.sortBone(r),i.length>1){var a=i[i.length-1];this._updateCache.indexOf(a)>-1||this.updateCacheReset.push(a)}this._updateCache.push(e),this.sortReset(r.children),i[i.length-1].sorted=!0}},e.prototype.sortPathConstraint=function(e){if(e.active=e.target.bone.isActive()&&(!e.data.skinRequired||null!=this.skin&&t.Utils.contains(this.skin.constraints,e.data,!0)),e.active){var n=e.target,i=n.data.index,r=n.bone;null!=this.skin&&this.sortPathConstraintAttachment(this.skin,i,r),null!=this.data.defaultSkin&&this.data.defaultSkin!=this.skin&&this.sortPathConstraintAttachment(this.data.defaultSkin,i,r);for(var a=0,o=this.data.skins.length;a<o;a++)this.sortPathConstraintAttachment(this.data.skins[a],i,r);var s=n.getAttachment();s instanceof t.PathAttachment&&this.sortPathConstraintAttachmentWith(s,r);var c=e.bones,l=c.length;for(a=0;a<l;a++)this.sortBone(c[a]);for(this._updateCache.push(e),a=0;a<l;a++)this.sortReset(c[a].children);for(a=0;a<l;a++)c[a].sorted=!0}},e.prototype.sortTransformConstraint=function(e){if(e.active=e.target.isActive()&&(!e.data.skinRequired||null!=this.skin&&t.Utils.contains(this.skin.constraints,e.data,!0)),e.active){this.sortBone(e.target);var n=e.bones,i=n.length;if(e.data.local)for(var r=0;r<i;r++){var a=n[r];this.sortBone(a.parent),this._updateCache.indexOf(a)>-1||this.updateCacheReset.push(a)}else for(r=0;r<i;r++)this.sortBone(n[r]);this._updateCache.push(e);for(var o=0;o<i;o++)this.sortReset(n[o].children);for(o=0;o<i;o++)n[o].sorted=!0}},e.prototype.sortPathConstraintAttachment=function(t,e,n){var i=t.attachments[e];if(i)for(var r in i)this.sortPathConstraintAttachmentWith(i[r],n)},e.prototype.sortPathConstraintAttachmentWith=function(e,n){if(e instanceof t.PathAttachment){var i=e.bones;if(null==i)this.sortBone(n);else for(var r=this.bones,a=0;a<i.length;)for(var o=i[a++],s=a+o;a<s;a++){var c=i[a];this.sortBone(r[c])}}},e.prototype.sortBone=function(t){if(!t.sorted){var e=t.parent;null!=e&&this.sortBone(e),t.sorted=!0,this._updateCache.push(t)}},e.prototype.sortReset=function(t){for(var e=0,n=t.length;e<n;e++){var i=t[e];i.active&&(i.sorted&&this.sortReset(i.children),i.sorted=!1)}},e.prototype.updateWorldTransform=function(){for(var t=this.updateCacheReset,e=0,n=t.length;e<n;e++){var i=t[e];i.ax=i.x,i.ay=i.y,i.arotation=i.rotation,i.ascaleX=i.scaleX,i.ascaleY=i.scaleY,i.ashearX=i.shearX,i.ashearY=i.shearY,i.appliedValid=!0}var r=this._updateCache;for(e=0,n=r.length;e<n;e++)r[e].update()},e.prototype.setToSetupPose=function(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()},e.prototype.setBonesToSetupPose=function(){for(var t=this.bones,e=0,n=t.length;e<n;e++)t[e].setToSetupPose();var i=this.ikConstraints;for(e=0,n=i.length;e<n;e++)(s=i[e]).mix=s.data.mix,s.softness=s.data.softness,s.bendDirection=s.data.bendDirection,s.compress=s.data.compress,s.stretch=s.data.stretch;var r=this.transformConstraints;for(e=0,n=r.length;e<n;e++){var a=(s=r[e]).data;s.rotateMix=a.rotateMix,s.translateMix=a.translateMix,s.scaleMix=a.scaleMix,s.shearMix=a.shearMix}var o=this.pathConstraints;for(e=0,n=o.length;e<n;e++){var s;a=(s=o[e]).data,s.position=a.position,s.spacing=a.spacing,s.rotateMix=a.rotateMix,s.translateMix=a.translateMix}},e.prototype.setSlotsToSetupPose=function(){var e=this.slots;t.Utils.arrayCopy(e,0,this.drawOrder,0,e.length);for(var n=0,i=e.length;n<i;n++)e[n].setToSetupPose()},e.prototype.getRootBone=function(){return 0==this.bones.length?null:this.bones[0]},e.prototype.findBone=function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,n=0,i=e.length;n<i;n++){var r=e[n];if(r.data.name==t)return r}return null},e.prototype.findBoneIndex=function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,n=0,i=e.length;n<i;n++)if(e[n].data.name==t)return n;return-1},e.prototype.findSlot=function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,n=0,i=e.length;n<i;n++){var r=e[n];if(r.data.name==t)return r}return null},e.prototype.findSlotIndex=function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,n=0,i=e.length;n<i;n++)if(e[n].data.name==t)return n;return-1},e.prototype.setSkinByName=function(t){var e=this.data.findSkin(t);if(null==e)throw new Error("Skin not found: "+t);this.setSkin(e)},e.prototype.setSkin=function(t){if(t!=this.skin){if(null!=t)if(null!=this.skin)t.attachAll(this,this.skin);else for(var e=this.slots,n=0,i=e.length;n<i;n++){var r=e[n],a=r.data.attachmentName;if(null!=a){var o=t.getAttachment(n,a);null!=o&&r.setAttachment(o)}}this.skin=t,this.updateCache()}},e.prototype.getAttachmentByName=function(t,e){return this.getAttachment(this.data.findSlotIndex(t),e)},e.prototype.getAttachment=function(t,e){if(null==e)throw new Error("attachmentName cannot be null.");if(null!=this.skin){var n=this.skin.getAttachment(t,e);if(null!=n)return n}return null!=this.data.defaultSkin?this.data.defaultSkin.getAttachment(t,e):null},e.prototype.setAttachment=function(t,e){if(null==t)throw new Error("slotName cannot be null.");for(var n=this.slots,i=0,r=n.length;i<r;i++){var a=n[i];if(a.data.name==t){var o=null;if(null!=e&&null==(o=this.getAttachment(i,e)))throw new Error("Attachment not found: "+e+", for slot: "+t);return void a.setAttachment(o)}}throw new Error("Slot not found: "+t)},e.prototype.findIkConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.ikConstraints,n=0,i=e.length;n<i;n++){var r=e[n];if(r.data.name==t)return r}return null},e.prototype.findTransformConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.transformConstraints,n=0,i=e.length;n<i;n++){var r=e[n];if(r.data.name==t)return r}return null},e.prototype.findPathConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.pathConstraints,n=0,i=e.length;n<i;n++){var r=e[n];if(r.data.name==t)return r}return null},e.prototype.getBounds=function(e,n,i){if(void 0===i&&(i=new Array(2)),null==e)throw new Error("offset cannot be null.");if(null==n)throw new Error("size cannot be null.");for(var r=this.drawOrder,a=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY,c=Number.NEGATIVE_INFINITY,l=0,u=r.length;l<u;l++){var h=r[l];if(h.bone.active){var f=0,_=null,p=h.getAttachment();if(p instanceof t.RegionAttachment)f=8,_=t.Utils.setArraySize(i,f,0),p.computeWorldVertices(h.bone,_,0,2);else if(p instanceof t.MeshAttachment){var d=p;f=d.worldVerticesLength,_=t.Utils.setArraySize(i,f,0),d.computeWorldVertices(h,0,f,_,0,2)}if(null!=_)for(var m=0,g=_.length;m<g;m+=2){var v=_[m],y=_[m+1];a=Math.min(a,v),o=Math.min(o,y),s=Math.max(s,v),c=Math.max(c,y)}}}e.set(a,o),n.set(s-a,c-o)},e.prototype.update=function(t){this.time+=t},e}();t.Skeleton=e}(vut||(vut={})),function(t){var e=function(){function e(t){this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=t}return e.prototype.readSkeletonData=function(i){var r=this.scale,a=new t.SkeletonData;a.name="";var o=new n(i);a.hash=o.readString(),a.version=o.readString(),a.x=o.readFloat(),a.y=o.readFloat(),a.width=o.readFloat(),a.height=o.readFloat();var s=o.readBoolean();s&&(a.fps=o.readFloat(),a.imagesPath=o.readString(),a.audioPath=o.readString());var c=0;c=o.readInt(!0);for(var l=0;l<c;l++)o.strings.push(o.readString());for(c=o.readInt(!0),l=0;l<c;l++){var u=o.readString(),h=0==l?null:a.bones[o.readInt(!0)];(p=new t.BoneData(l,u,h)).rotation=o.readFloat(),p.x=o.readFloat()*r,p.y=o.readFloat()*r,p.scaleX=o.readFloat(),p.scaleY=o.readFloat(),p.shearX=o.readFloat(),p.shearY=o.readFloat(),p.length=o.readFloat()*r,p.transformMode=e.TransformModeValues[o.readInt(!0)],p.skinRequired=o.readBoolean(),s&&t.Color.rgba8888ToColor(p.color,o.readInt32()),a.bones.push(p)}for(c=o.readInt(!0),l=0;l<c;l++){var f=o.readString(),_=a.bones[o.readInt(!0)],p=new t.SlotData(l,f,_);t.Color.rgba8888ToColor(p.color,o.readInt32());var d=o.readInt32();-1!=d&&t.Color.rgb888ToColor(p.darkColor=new t.Color,d),p.attachmentName=o.readStringRef(),p.blendMode=e.BlendModeValues[o.readInt(!0)],a.slots.push(p)}c=o.readInt(!0),l=0;for(var m=void 0;l<c;l++){(p=new t.IkConstraintData(o.readString())).order=o.readInt(!0),p.skinRequired=o.readBoolean(),m=o.readInt(!0);for(var g=0;g<m;g++)p.bones.push(a.bones[o.readInt(!0)]);p.target=a.bones[o.readInt(!0)],p.mix=o.readFloat(),p.softness=o.readFloat()*r,p.bendDirection=o.readByte(),p.compress=o.readBoolean(),p.stretch=o.readBoolean(),p.uniform=o.readBoolean(),a.ikConstraints.push(p)}for(c=o.readInt(!0),l=0,m=void 0;l<c;l++){for((p=new t.TransformConstraintData(o.readString())).order=o.readInt(!0),p.skinRequired=o.readBoolean(),m=o.readInt(!0),g=0;g<m;g++)p.bones.push(a.bones[o.readInt(!0)]);p.target=a.bones[o.readInt(!0)],p.local=o.readBoolean(),p.relative=o.readBoolean(),p.offsetRotation=o.readFloat(),p.offsetX=o.readFloat()*r,p.offsetY=o.readFloat()*r,p.offsetScaleX=o.readFloat(),p.offsetScaleY=o.readFloat(),p.offsetShearY=o.readFloat(),p.rotateMix=o.readFloat(),p.translateMix=o.readFloat(),p.scaleMix=o.readFloat(),p.shearMix=o.readFloat(),a.transformConstraints.push(p)}for(c=o.readInt(!0),l=0,m=void 0;l<c;l++){for((p=new t.PathConstraintData(o.readString())).order=o.readInt(!0),p.skinRequired=o.readBoolean(),m=o.readInt(!0),g=0;g<m;g++)p.bones.push(a.bones[o.readInt(!0)]);p.target=a.slots[o.readInt(!0)],p.positionMode=e.PositionModeValues[o.readInt(!0)],p.spacingMode=e.SpacingModeValues[o.readInt(!0)],p.rotateMode=e.RotateModeValues[o.readInt(!0)],p.offsetRotation=o.readFloat(),p.position=o.readFloat(),p.positionMode==t.PositionMode.Fixed&&(p.position*=r),p.spacing=o.readFloat(),p.spacingMode!=t.SpacingMode.Length&&p.spacingMode!=t.SpacingMode.Fixed||(p.spacing*=r),p.rotateMix=o.readFloat(),p.translateMix=o.readFloat(),a.pathConstraints.push(p)}var v=this.readSkin(o,a,!0,s);for(null!=v&&(a.defaultSkin=v,a.skins.push(v)),l=a.skins.length,t.Utils.setArraySize(a.skins,c=l+o.readInt(!0));l<c;l++)a.skins[l]=this.readSkin(o,a,!1,s);for(c=this.linkedMeshes.length,l=0;l<c;l++){var y=this.linkedMeshes[l],x=null==y.skin?a.defaultSkin:a.findSkin(y.skin);if(null==x)throw new Error("Skin not found: "+y.skin);var S=x.getAttachment(y.slotIndex,y.parent);if(null==S)throw new Error("Parent mesh not found: "+y.parent);y.mesh.deformAttachment=y.inheritDeform?S:y.mesh,y.mesh.setParentMesh(S),y.mesh.updateUVs()}for(this.linkedMeshes.length=0,c=o.readInt(!0),l=0;l<c;l++)(p=new t.EventData(o.readStringRef())).intValue=o.readInt(!1),p.floatValue=o.readFloat(),p.stringValue=o.readString(),p.audioPath=o.readString(),null!=p.audioPath&&(p.volume=o.readFloat(),p.balance=o.readFloat()),a.events.push(p);for(c=o.readInt(!0),l=0;l<c;l++)a.animations.push(this.readAnimation(o,o.readString(),a));return a},e.prototype.readSkin=function(e,n,i,r){var a=null,o=0;if(i){if(0==(o=e.readInt(!0)))return null;a=new t.Skin("default")}else{(a=new t.Skin(e.readStringRef())).bones.length=e.readInt(!0);for(var s=0,c=a.bones.length;s<c;s++)a.bones[s]=n.bones[e.readInt(!0)];for(s=0,c=e.readInt(!0);s<c;s++)a.constraints.push(n.ikConstraints[e.readInt(!0)]);for(s=0,c=e.readInt(!0);s<c;s++)a.constraints.push(n.transformConstraints[e.readInt(!0)]);for(s=0,c=e.readInt(!0);s<c;s++)a.constraints.push(n.pathConstraints[e.readInt(!0)]);o=e.readInt(!0)}for(s=0;s<o;s++)for(var l=e.readInt(!0),u=0,h=e.readInt(!0);u<h;u++){var f=e.readStringRef(),_=this.readAttachment(e,n,a,l,f,r);null!=_&&a.setAttachment(l,f,_)}return a},e.prototype.readAttachment=function(n,r,a,o,s,c){var l=this.scale,u=n.readStringRef();null==u&&(u=s);var h=n.readByte();switch(e.AttachmentTypeValues[h]){case t.AttachmentType.Region:var f=n.readStringRef(),_=n.readFloat(),p=n.readFloat(),d=n.readFloat(),m=n.readFloat(),g=n.readFloat(),v=n.readFloat(),y=n.readFloat(),x=n.readInt32();null==f&&(f=u);var S=this.attachmentLoader.newRegionAttachment(a,u,f);return null==S?null:(S.path=f,S.x=p*l,S.y=d*l,S.scaleX=m,S.scaleY=g,S.rotation=_,S.width=v*l,S.height=y*l,t.Color.rgba8888ToColor(S.color,x),S.updateOffset(),S);case t.AttachmentType.BoundingBox:var T=n.readInt(!0),A=this.readVertices(n,T),E=(x=c?n.readInt32():0,this.attachmentLoader.newBoundingBoxAttachment(a,u));return null==E?null:(E.worldVerticesLength=T<<1,E.vertices=A.vertices,E.bones=A.bones,c&&t.Color.rgba8888ToColor(E.color,x),E);case t.AttachmentType.Mesh:f=n.readStringRef(),x=n.readInt32(),T=n.readInt(!0);var C=this.readFloatArray(n,T<<1,1),b=this.readShortArray(n),w=(A=this.readVertices(n,T),n.readInt(!0)),P=null;return v=0,y=0,c&&(P=this.readShortArray(n),v=n.readFloat(),y=n.readFloat()),null==f&&(f=u),null==(I=this.attachmentLoader.newMeshAttachment(a,u,f))?null:(I.path=f,t.Color.rgba8888ToColor(I.color,x),I.bones=A.bones,I.vertices=A.vertices,I.worldVerticesLength=T<<1,I.triangles=b,I.regionUVs=C,I.updateUVs(),I.hullLength=w<<1,c&&(I.edges=P,I.width=v*l,I.height=y*l),I);case t.AttachmentType.LinkedMesh:f=n.readStringRef(),x=n.readInt32();var I,R=n.readStringRef(),D=n.readStringRef(),O=n.readBoolean();return v=0,y=0,c&&(v=n.readFloat(),y=n.readFloat()),null==f&&(f=u),null==(I=this.attachmentLoader.newMeshAttachment(a,u,f))?null:(I.path=f,t.Color.rgba8888ToColor(I.color,x),c&&(I.width=v*l,I.height=y*l),this.linkedMeshes.push(new i(I,R,o,D,O)),I);case t.AttachmentType.Path:for(var M=n.readBoolean(),N=n.readBoolean(),L=(T=n.readInt(!0),A=this.readVertices(n,T),t.Utils.newArray(T/3,0)),B=0,F=L.length;B<F;B++)L[B]=n.readFloat()*l;return x=c?n.readInt32():0,null==(f=this.attachmentLoader.newPathAttachment(a,u))?null:(f.closed=M,f.constantSpeed=N,f.worldVerticesLength=T<<1,f.vertices=A.vertices,f.bones=A.bones,f.lengths=L,c&&t.Color.rgba8888ToColor(f.color,x),f);case t.AttachmentType.Point:_=n.readFloat(),p=n.readFloat(),d=n.readFloat(),x=c?n.readInt32():0;var z=this.attachmentLoader.newPointAttachment(a,u);return null==z?null:(z.x=p*l,z.y=d*l,z.rotation=_,c&&t.Color.rgba8888ToColor(z.color,x),z);case t.AttachmentType.Clipping:var U=n.readInt(!0),k=(T=n.readInt(!0),A=this.readVertices(n,T),x=c?n.readInt32():0,this.attachmentLoader.newClippingAttachment(a,u));return null==k?null:(k.endSlot=r.slots[U],k.worldVerticesLength=T<<1,k.vertices=A.vertices,k.bones=A.bones,c&&t.Color.rgba8888ToColor(k.color,x),k)}return null},e.prototype.readVertices=function(e,n){var i=n<<1,a=new r,o=this.scale;if(!e.readBoolean())return a.vertices=this.readFloatArray(e,i,o),a;for(var s=new Array,c=new Array,l=0;l<n;l++){var u=e.readInt(!0);c.push(u);for(var h=0;h<u;h++)c.push(e.readInt(!0)),s.push(e.readFloat()*o),s.push(e.readFloat()*o),s.push(e.readFloat())}return a.vertices=t.Utils.toFloatArray(s),a.bones=c,a},e.prototype.readFloatArray=function(t,e,n){var i=new Array(e);if(1==n)for(var r=0;r<e;r++)i[r]=t.readFloat();else for(r=0;r<e;r++)i[r]=t.readFloat()*n;return i},e.prototype.readShortArray=function(t){for(var e=t.readInt(!0),n=new Array(e),i=0;i<e;i++)n[i]=t.readShort();return n},e.prototype.readAnimation=function(n,i,r){for(var a=new Array,o=this.scale,s=0,c=new t.Color,l=new t.Color,u=0,h=n.readInt(!0);u<h;u++)for(var f=n.readInt(!0),_=0,p=n.readInt(!0);_<p;_++){var d=n.readByte(),m=n.readInt(!0);switch(d){case e.SLOT_ATTACHMENT:(x=new t.AttachmentTimeline(m)).slotIndex=f;for(var g=0;g<m;g++)x.setFrame(g,n.readFloat(),n.readStringRef());a.push(x),s=Math.max(s,x.frames[m-1]);break;case e.SLOT_COLOR:for((x=new t.ColorTimeline(m)).slotIndex=f,g=0;g<m;g++){var v=n.readFloat();t.Color.rgba8888ToColor(c,n.readInt32()),x.setFrame(g,v,c.r,c.g,c.b,c.a),g<m-1&&this.readCurve(n,g,x)}a.push(x),s=Math.max(s,x.frames[(m-1)*t.ColorTimeline.ENTRIES]);break;case e.SLOT_TWO_COLOR:for((x=new t.TwoColorTimeline(m)).slotIndex=f,g=0;g<m;g++)v=n.readFloat(),t.Color.rgba8888ToColor(c,n.readInt32()),t.Color.rgb888ToColor(l,n.readInt32()),x.setFrame(g,v,c.r,c.g,c.b,c.a,l.r,l.g,l.b),g<m-1&&this.readCurve(n,g,x);a.push(x),s=Math.max(s,x.frames[(m-1)*t.TwoColorTimeline.ENTRIES])}}for(u=0,h=n.readInt(!0);u<h;u++){var y=n.readInt(!0);for(_=0,p=n.readInt(!0);_<p;_++)switch(d=n.readByte(),m=n.readInt(!0),d){case e.BONE_ROTATE:for((x=new t.RotateTimeline(m)).boneIndex=y,g=0;g<m;g++)x.setFrame(g,n.readFloat(),n.readFloat()),g<m-1&&this.readCurve(n,g,x);a.push(x),s=Math.max(s,x.frames[(m-1)*t.RotateTimeline.ENTRIES]);break;case e.BONE_TRANSLATE:case e.BONE_SCALE:case e.BONE_SHEAR:var x=void 0,S=1;for(d==e.BONE_SCALE?x=new t.ScaleTimeline(m):d==e.BONE_SHEAR?x=new t.ShearTimeline(m):(x=new t.TranslateTimeline(m),S=o),x.boneIndex=y,g=0;g<m;g++)x.setFrame(g,n.readFloat(),n.readFloat()*S,n.readFloat()*S),g<m-1&&this.readCurve(n,g,x);a.push(x),s=Math.max(s,x.frames[(m-1)*t.TranslateTimeline.ENTRIES])}}for(u=0,h=n.readInt(!0);u<h;u++){var T=n.readInt(!0);for(m=n.readInt(!0),(x=new t.IkConstraintTimeline(m)).ikConstraintIndex=T,g=0;g<m;g++)x.setFrame(g,n.readFloat(),n.readFloat(),n.readFloat()*o,n.readByte(),n.readBoolean(),n.readBoolean()),g<m-1&&this.readCurve(n,g,x);a.push(x),s=Math.max(s,x.frames[(m-1)*t.IkConstraintTimeline.ENTRIES])}for(u=0,h=n.readInt(!0);u<h;u++){for(T=n.readInt(!0),m=n.readInt(!0),(x=new t.TransformConstraintTimeline(m)).transformConstraintIndex=T,g=0;g<m;g++)x.setFrame(g,n.readFloat(),n.readFloat(),n.readFloat(),n.readFloat(),n.readFloat()),g<m-1&&this.readCurve(n,g,x);a.push(x),s=Math.max(s,x.frames[(m-1)*t.TransformConstraintTimeline.ENTRIES])}for(u=0,h=n.readInt(!0);u<h;u++){T=n.readInt(!0);var A=r.pathConstraints[T];for(_=0,p=n.readInt(!0);_<p;_++)switch(d=n.readByte(),m=n.readInt(!0),d){case e.PATH_POSITION:case e.PATH_SPACING:for(x=void 0,S=1,d==e.PATH_SPACING?(x=new t.PathConstraintSpacingTimeline(m),A.spacingMode!=t.SpacingMode.Length&&A.spacingMode!=t.SpacingMode.Fixed||(S=o)):(x=new t.PathConstraintPositionTimeline(m),A.positionMode==t.PositionMode.Fixed&&(S=o)),x.pathConstraintIndex=T,g=0;g<m;g++)x.setFrame(g,n.readFloat(),n.readFloat()*S),g<m-1&&this.readCurve(n,g,x);a.push(x),s=Math.max(s,x.frames[(m-1)*t.PathConstraintPositionTimeline.ENTRIES]);break;case e.PATH_MIX:for((x=new t.PathConstraintMixTimeline(m)).pathConstraintIndex=T,g=0;g<m;g++)x.setFrame(g,n.readFloat(),n.readFloat(),n.readFloat()),g<m-1&&this.readCurve(n,g,x);a.push(x),s=Math.max(s,x.frames[(m-1)*t.PathConstraintMixTimeline.ENTRIES])}}for(u=0,h=n.readInt(!0);u<h;u++){var E=r.skins[n.readInt(!0)];for(_=0,p=n.readInt(!0);_<p;_++){f=n.readInt(!0);for(var C=0,b=n.readInt(!0);C<b;C++){var w=E.getAttachment(f,n.readStringRef()),P=null!=w.bones,I=w.vertices,R=P?I.length/3*2:I.length;for(m=n.readInt(!0),(x=new t.DeformTimeline(m)).slotIndex=f,x.attachment=w,g=0;g<m;g++){v=n.readFloat();var D=void 0,O=n.readInt(!0);if(0==O)D=P?t.Utils.newFloatArray(R):I;else{D=t.Utils.newFloatArray(R);var M=n.readInt(!0);if(O+=M,1==o)for(var N=M;N<O;N++)D[N]=n.readFloat();else for(N=M;N<O;N++)D[N]=n.readFloat()*o;if(!P){N=0;for(var L=D.length;N<L;N++)D[N]+=I[N]}}x.setFrame(g,v,D),g<m-1&&this.readCurve(n,g,x)}a.push(x),s=Math.max(s,x.frames[m-1])}}}var B=n.readInt(!0);if(B>0){x=new t.DrawOrderTimeline(B);var F=r.slots.length;for(u=0;u<B;u++){v=n.readFloat();var z=n.readInt(!0),U=t.Utils.newArray(F,0);for(_=F-1;_>=0;_--)U[_]=-1;var k=t.Utils.newArray(F-z,0),G=0,H=0;for(_=0;_<z;_++){for(f=n.readInt(!0);G!=f;)k[H++]=G++;U[G+n.readInt(!0)]=G++}for(;G<F;)k[H++]=G++;for(_=F-1;_>=0;_--)-1==U[_]&&(U[_]=k[--H]);x.setFrame(u,v,U)}a.push(x),s=Math.max(s,x.frames[B-1])}var V=n.readInt(!0);if(V>0){for(x=new t.EventTimeline(V),u=0;u<V;u++){v=n.readFloat();var j=r.events[n.readInt(!0)],W=new t.Event(v,j);W.intValue=n.readInt(!1),W.floatValue=n.readFloat(),W.stringValue=n.readBoolean()?n.readString():j.stringValue,null!=W.data.audioPath&&(W.volume=n.readFloat(),W.balance=n.readFloat()),x.setFrame(u,W)}a.push(x),s=Math.max(s,x.frames[V-1])}return new t.Animation(i,a,s)},e.prototype.readCurve=function(t,n,i){switch(t.readByte()){case e.CURVE_STEPPED:i.setStepped(n);break;case e.CURVE_BEZIER:this.setCurve(i,n,t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat())}},e.prototype.setCurve=function(t,e,n,i,r,a){t.setCurve(e,n,i,r,a)},e.AttachmentTypeValues=[0,1,2,3,4,5,6],e.TransformModeValues=[t.TransformMode.Normal,t.TransformMode.OnlyTranslation,t.TransformMode.NoRotationOrReflection,t.TransformMode.NoScale,t.TransformMode.NoScaleOrReflection],e.PositionModeValues=[t.PositionMode.Fixed,t.PositionMode.Percent],e.SpacingModeValues=[t.SpacingMode.Length,t.SpacingMode.Fixed,t.SpacingMode.Percent],e.RotateModeValues=[t.RotateMode.Tangent,t.RotateMode.Chain,t.RotateMode.ChainScale],e.BlendModeValues=[t.BlendMode.Normal,t.BlendMode.Additive,t.BlendMode.Multiply,t.BlendMode.Screen],e.BONE_ROTATE=0,e.BONE_TRANSLATE=1,e.BONE_SCALE=2,e.BONE_SHEAR=3,e.SLOT_ATTACHMENT=0,e.SLOT_COLOR=1,e.SLOT_TWO_COLOR=2,e.PATH_POSITION=0,e.PATH_SPACING=1,e.PATH_MIX=2,e.CURVE_LINEAR=0,e.CURVE_STEPPED=1,e.CURVE_BEZIER=2,e}();t.SkeletonBinary=e;var n=function(){function t(t,e,n,i){void 0===e&&(e=new Array),void 0===n&&(n=0),void 0===i&&(i=new DataView(t.buffer)),this.strings=e,this.index=n,this.buffer=i}return t.prototype.readByte=function(){return this.buffer.getInt8(this.index++)},t.prototype.readShort=function(){var t=this.buffer.getInt16(this.index);return this.index+=2,t},t.prototype.readInt32=function(){var t=this.buffer.getInt32(this.index);return this.index+=4,t},t.prototype.readInt=function(t){var e=this.readByte(),n=127&e;return 0!=(128&e)&&(n|=(127&(e=this.readByte()))<<7,0!=(128&e)&&(n|=(127&(e=this.readByte()))<<14,0!=(128&e)&&(n|=(127&(e=this.readByte()))<<21,0!=(128&e)&&(n|=(127&(e=this.readByte()))<<28)))),t?n:n>>>1^-(1&n)},t.prototype.readStringRef=function(){var t=this.readInt(!0);return 0==t?null:this.strings[t-1]},t.prototype.readString=function(){var t=this.readInt(!0);switch(t){case 0:return null;case 1:return""}t--;for(var e="",n=0;n<t;){var i=this.readByte();switch(i>>4){case 12:case 13:e+=String.fromCharCode((31&i)<<6|63&this.readByte()),n+=2;break;case 14:e+=String.fromCharCode((15&i)<<12|(63&this.readByte())<<6|63&this.readByte()),n+=3;break;default:e+=String.fromCharCode(i),n++}}return e},t.prototype.readFloat=function(){var t=this.buffer.getFloat32(this.index);return this.index+=4,t},t.prototype.readBoolean=function(){return 0!=this.readByte()},t}(),i=function(t,e,n,i,r){this.mesh=t,this.skin=e,this.slotIndex=n,this.parent=i,this.inheritDeform=r},r=function(t,e){void 0===t&&(t=null),void 0===e&&(e=null),this.bones=t,this.vertices=e}}(vut||(vut={})),function(t){var e=function(){function e(){this.minX=0,this.minY=0,this.maxX=0,this.maxY=0,this.boundingBoxes=new Array,this.polygons=new Array,this.polygonPool=new t.Pool((function(){return t.Utils.newFloatArray(16)}))}return e.prototype.update=function(e,n){if(null==e)throw new Error("skeleton cannot be null.");var i=this.boundingBoxes,r=this.polygons,a=this.polygonPool,o=e.slots,s=o.length;i.length=0,a.freeAll(r),r.length=0;for(var c=0;c<s;c++){var l=o[c];if(l.bone.active){var u=l.getAttachment();if(u instanceof t.BoundingBoxAttachment){var h=u;i.push(h);var f=a.obtain();f.length!=h.worldVerticesLength&&(f=t.Utils.newFloatArray(h.worldVerticesLength)),r.push(f),h.computeWorldVertices(l,0,h.worldVerticesLength,f,0,2)}}}n?this.aabbCompute():(this.minX=Number.POSITIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY)},e.prototype.aabbCompute=function(){for(var t=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,i=Number.NEGATIVE_INFINITY,r=this.polygons,a=0,o=r.length;a<o;a++)for(var s=r[a],c=s,l=0,u=s.length;l<u;l+=2){var h=c[l],f=c[l+1];t=Math.min(t,h),e=Math.min(e,f),n=Math.max(n,h),i=Math.max(i,f)}this.minX=t,this.minY=e,this.maxX=n,this.maxY=i},e.prototype.aabbContainsPoint=function(t,e){return t>=this.minX&&t<=this.maxX&&e>=this.minY&&e<=this.maxY},e.prototype.aabbIntersectsSegment=function(t,e,n,i){var r=this.minX,a=this.minY,o=this.maxX,s=this.maxY;if(t<=r&&n<=r||e<=a&&i<=a||t>=o&&n>=o||e>=s&&i>=s)return!1;var c=(i-e)/(n-t),l=c*(r-t)+e;if(l>a&&l<s)return!0;if((l=c*(o-t)+e)>a&&l<s)return!0;var u=(a-e)/c+t;return u>r&&u<o||(u=(s-e)/c+t)>r&&u<o},e.prototype.aabbIntersectsSkeleton=function(t){return this.minX<t.maxX&&this.maxX>t.minX&&this.minY<t.maxY&&this.maxY>t.minY},e.prototype.containsPoint=function(t,e){for(var n=this.polygons,i=0,r=n.length;i<r;i++)if(this.containsPointPolygon(n[i],t,e))return this.boundingBoxes[i];return null},e.prototype.containsPointPolygon=function(t,e,n){for(var i=t,r=t.length,a=r-2,o=!1,s=0;s<r;s+=2){var c=i[s+1],l=i[a+1];if(c<n&&l>=n||l<n&&c>=n){var u=i[s];u+(n-c)/(l-c)*(i[a]-u)<e&&(o=!o)}a=s}return o},e.prototype.intersectsSegment=function(t,e,n,i){for(var r=this.polygons,a=0,o=r.length;a<o;a++)if(this.intersectsSegmentPolygon(r[a],t,e,n,i))return this.boundingBoxes[a];return null},e.prototype.intersectsSegmentPolygon=function(t,e,n,i,r){for(var a=t,o=t.length,s=e-i,c=n-r,l=e*r-n*i,u=a[o-2],h=a[o-1],f=0;f<o;f+=2){var _=a[f],p=a[f+1],d=u*p-h*_,m=u-_,g=h-p,v=s*g-c*m,y=(l*m-s*d)/v;if((y>=u&&y<=_||y>=_&&y<=u)&&(y>=e&&y<=i||y>=i&&y<=e)){var x=(l*g-c*d)/v;if((x>=h&&x<=p||x>=p&&x<=h)&&(x>=n&&x<=r||x>=r&&x<=n))return!0}u=_,h=p}return!1},e.prototype.getPolygon=function(t){if(null==t)throw new Error("boundingBox cannot be null.");var e=this.boundingBoxes.indexOf(t);return-1==e?null:this.polygons[e]},e.prototype.getWidth=function(){return this.maxX-this.minX},e.prototype.getHeight=function(){return this.maxY-this.minY},e}();t.SkeletonBounds=e}(vut||(vut={})),function(t){var e=function(){function e(){this.triangulator=new t.Triangulator,this.clippingPolygon=new Array,this.clipOutput=new Array,this.clippedVertices=new Array,this.clippedTriangles=new Array,this.scratch=new Array}return e.prototype.clipStart=function(n,i){if(null!=this.clipAttachment)return 0;this.clipAttachment=i;var r=i.worldVerticesLength,a=t.Utils.setArraySize(this.clippingPolygon,r);i.computeWorldVertices(n,0,r,a,0,2);var o=this.clippingPolygon;e.makeClockwise(o);for(var s=this.clippingPolygons=this.triangulator.decompose(o,this.triangulator.triangulate(o)),c=0,l=s.length;c<l;c++){var u=s[c];e.makeClockwise(u),u.push(u[0]),u.push(u[1])}return s.length},e.prototype.clipEndWithSlot=function(t){null!=this.clipAttachment&&this.clipAttachment.endSlot==t.data&&this.clipEnd()},e.prototype.clipEnd=function(){null!=this.clipAttachment&&(this.clipAttachment=null,this.clippingPolygons=null,this.clippedVertices.length=0,this.clippedTriangles.length=0,this.clippingPolygon.length=0)},e.prototype.isClipping=function(){return null!=this.clipAttachment},e.prototype.clipTriangles=function(e,n,i,r,a,o,s,c,l,u,h){void 0===l&&(l=2),void 0===u&&(u=0),void 0===h&&(h=0);var f=this.clipOutput,_=this.clippedVertices,p=this.clippedTriangles,d=this.clippingPolygons,m=this.clippingPolygons.length,g=c?12:8,v=0;_.length=0,p.length=0;t:for(var y=0;y<r;y+=3)for(var x=i[y]*l,S=e[x+u],T=e[x+u+1],A=a[x+h],E=a[x+h+1],C=e[(x=i[y+1]*l)+u],b=e[x+u+1],w=a[x+h],P=a[x+h+1],I=e[(x=i[y+2]*l)+u],R=e[x+u+1],D=a[x+h],O=a[x+h+1],M=0;M<m;M++){var N=_.length;if(!this.clip(S,T,C,b,I,R,d[M],f)){(V=t.Utils.setArraySize(_,N+3*g))[N]=S,V[N+1]=T,V[N+2]=o.r,V[N+3]=o.g,V[N+4]=o.b,V[N+5]=o.a,c?(V[N+6]=A,V[N+7]=E,V[N+8]=s.r,V[N+9]=s.g,V[N+10]=s.b,V[N+11]=s.a,V[N+12]=C,V[N+13]=b,V[N+14]=o.r,V[N+15]=o.g,V[N+16]=o.b,V[N+17]=o.a,V[N+18]=w,V[N+19]=P,V[N+20]=s.r,V[N+21]=s.g,V[N+22]=s.b,V[N+23]=s.a,V[N+24]=I,V[N+25]=R,V[N+26]=o.r,V[N+27]=o.g,V[N+28]=o.b,V[N+29]=o.a,V[N+30]=D,V[N+31]=O,V[N+32]=s.r,V[N+33]=s.g,V[N+34]=s.b,V[N+35]=s.a):(V[N+6]=A,V[N+7]=E,V[N+8]=C,V[N+9]=b,V[N+10]=o.r,V[N+11]=o.g,V[N+12]=o.b,V[N+13]=o.a,V[N+14]=w,V[N+15]=P,V[N+16]=I,V[N+17]=R,V[N+18]=o.r,V[N+19]=o.g,V[N+20]=o.b,V[N+21]=o.a,V[N+22]=D,V[N+23]=O),N=p.length,(J=t.Utils.setArraySize(p,N+3))[N]=v,J[N+1]=v+1,J[N+2]=v+2,v+=3;continue t}var L=f.length;if(0!=L){for(var B=b-R,F=I-C,z=S-I,U=R-T,k=1/(B*z+F*(T-R)),G=L>>1,H=this.clipOutput,V=t.Utils.setArraySize(_,N+G*g),j=0;j<L;j+=2){var W=H[j],X=H[j+1];V[N]=W,V[N+1]=X,V[N+2]=o.r,V[N+3]=o.g,V[N+4]=o.b,V[N+5]=o.a;var q=W-I,Y=X-R,K=(B*q+F*Y)*k,Q=(U*q+z*Y)*k,Z=1-K-Q;V[N+6]=A*K+w*Q+D*Z,V[N+7]=E*K+P*Q+O*Z,c&&(V[N+8]=s.r,V[N+9]=s.g,V[N+10]=s.b,V[N+11]=s.a),N+=g}N=p.length;var J=t.Utils.setArraySize(p,N+3*(G-2));for(G--,j=1;j<G;j++)J[N]=v,J[N+1]=v+j,J[N+2]=v+j+1,N+=3;v+=G+1}}},e.prototype.clip=function(t,e,n,i,r,a,o,s){var c=s,l=!1,u=null;o.length%4>=2?(u=s,s=this.scratch):u=this.scratch,u.length=0,u.push(t),u.push(e),u.push(n),u.push(i),u.push(r),u.push(a),u.push(t),u.push(e),s.length=0;for(var h=o,f=o.length-4,_=0;;_+=2){for(var p=h[_],d=h[_+1],m=h[_+2],g=h[_+3],v=p-m,y=d-g,x=u,S=u.length-2,T=s.length,A=0;A<S;A+=2){var E=x[A],C=x[A+1],b=x[A+2],w=x[A+3],P=v*(w-g)-y*(b-m)>0;if(v*(C-g)-y*(E-m)>0){if(P){s.push(b),s.push(w);continue}var I=(D=w-C)*(m-p)-(O=b-E)*(g-d);if(Math.abs(I)>1e-6){var R=(O*(d-C)-D*(p-E))/I;s.push(p+(m-p)*R),s.push(d+(g-d)*R)}else s.push(p),s.push(d)}else if(P){var D,O;I=(D=w-C)*(m-p)-(O=b-E)*(g-d),Math.abs(I)>1e-6?(R=(O*(d-C)-D*(p-E))/I,s.push(p+(m-p)*R),s.push(d+(g-d)*R)):(s.push(p),s.push(d)),s.push(b),s.push(w)}l=!0}if(T==s.length)return c.length=0,!0;if(s.push(s[0]),s.push(s[1]),_==f)break;var M=s;(s=u).length=0,u=M}if(c!=s){c.length=0,_=0;for(var N=s.length-2;_<N;_++)c[_]=s[_]}else c.length=c.length-2;return l},e.makeClockwise=function(t){for(var e=t,n=t.length,i=e[n-2]*e[1]-e[0]*e[n-1],r=0,a=0,o=0,s=0,c=n-3;s<c;s+=2)r=e[s],a=e[s+1],o=e[s+2],i+=r*e[s+3]-o*a;if(!(i<0)){s=0;var l=n-2;for(c=n>>1;s<c;s+=2){var u=e[s],h=e[s+1],f=l-s;e[s]=e[f],e[s+1]=e[f+1],e[f]=u,e[f+1]=h}}},e}();t.SkeletonClipping=e}(vut||(vut={})),function(t){var e=function(){function t(){this.bones=new Array,this.slots=new Array,this.skins=new Array,this.events=new Array,this.animations=new Array,this.ikConstraints=new Array,this.transformConstraints=new Array,this.pathConstraints=new Array,this.fps=0}return t.prototype.findBone=function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,n=0,i=e.length;n<i;n++){var r=e[n];if(r.name==t)return r}return null},t.prototype.findBoneIndex=function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,n=0,i=e.length;n<i;n++)if(e[n].name==t)return n;return-1},t.prototype.findSlot=function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,n=0,i=e.length;n<i;n++){var r=e[n];if(r.name==t)return r}return null},t.prototype.findSlotIndex=function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,n=0,i=e.length;n<i;n++)if(e[n].name==t)return n;return-1},t.prototype.findSkin=function(t){if(null==t)throw new Error("skinName cannot be null.");for(var e=this.skins,n=0,i=e.length;n<i;n++){var r=e[n];if(r.name==t)return r}return null},t.prototype.findEvent=function(t){if(null==t)throw new Error("eventDataName cannot be null.");for(var e=this.events,n=0,i=e.length;n<i;n++){var r=e[n];if(r.name==t)return r}return null},t.prototype.findAnimation=function(t){if(null==t)throw new Error("animationName cannot be null.");for(var e=this.animations,n=0,i=e.length;n<i;n++){var r=e[n];if(r.name==t)return r}return null},t.prototype.findIkConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.ikConstraints,n=0,i=e.length;n<i;n++){var r=e[n];if(r.name==t)return r}return null},t.prototype.findTransformConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.transformConstraints,n=0,i=e.length;n<i;n++){var r=e[n];if(r.name==t)return r}return null},t.prototype.findPathConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.pathConstraints,n=0,i=e.length;n<i;n++){var r=e[n];if(r.name==t)return r}return null},t.prototype.findPathConstraintIndex=function(t){if(null==t)throw new Error("pathConstraintName cannot be null.");for(var e=this.pathConstraints,n=0,i=e.length;n<i;n++)if(e[n].name==t)return n;return-1},t}();t.SkeletonData=e}(vut||(vut={})),function(t){var e=function(){function e(t){this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=t}return e.prototype.readSkeletonData=function(n){var i=this.scale,r=new t.SkeletonData,a="string"==typeof n?JSON.parse(n):n,o=a.skeleton;if(null!=o&&(r.hash=o.hash,r.version=o.spine,r.x=o.x,r.y=o.y,r.width=o.width,r.height=o.height,r.fps=o.fps,r.imagesPath=o.images),a.bones)for(var s=0;s<a.bones.length;s++){var c=a.bones[s],l=null,u=this.getValue(c,"parent",null);if(null!=u&&null==(l=r.findBone(u)))throw new Error("Parent bone not found: "+u);(p=new t.BoneData(r.bones.length,c.name,l)).length=this.getValue(c,"length",0)*i,p.x=this.getValue(c,"x",0)*i,p.y=this.getValue(c,"y",0)*i,p.rotation=this.getValue(c,"rotation",0),p.scaleX=this.getValue(c,"scaleX",1),p.scaleY=this.getValue(c,"scaleY",1),p.shearX=this.getValue(c,"shearX",0),p.shearY=this.getValue(c,"shearY",0),p.transformMode=e.transformModeFromString(this.getValue(c,"transform","normal")),p.skinRequired=this.getValue(c,"skin",!1),r.bones.push(p)}if(a.slots)for(s=0;s<a.slots.length;s++){var h=(I=a.slots[s]).name,f=I.bone,_=r.findBone(f);if(null==_)throw new Error("Slot bone not found: "+f);var p=new t.SlotData(r.slots.length,h,_),d=this.getValue(I,"color",null);null!=d&&p.color.setFromString(d);var m=this.getValue(I,"dark",null);null!=m&&(p.darkColor=new t.Color(1,1,1,1),p.darkColor.setFromString(m)),p.attachmentName=this.getValue(I,"attachment",null),p.blendMode=e.blendModeFromString(this.getValue(I,"blend","normal")),r.slots.push(p)}if(a.ik)for(s=0;s<a.ik.length;s++){var g=a.ik[s];(p=new t.IkConstraintData(g.name)).order=this.getValue(g,"order",0),p.skinRequired=this.getValue(g,"skin",!1);for(var v=0;v<g.bones.length;v++){if(f=g.bones[v],null==(b=r.findBone(f)))throw new Error("IK bone not found: "+f);p.bones.push(b)}var y=g.target;if(p.target=r.findBone(y),null==p.target)throw new Error("IK target bone not found: "+y);p.mix=this.getValue(g,"mix",1),p.softness=this.getValue(g,"softness",0)*i,p.bendDirection=this.getValue(g,"bendPositive",!0)?1:-1,p.compress=this.getValue(g,"compress",!1),p.stretch=this.getValue(g,"stretch",!1),p.uniform=this.getValue(g,"uniform",!1),r.ikConstraints.push(p)}if(a.transform)for(s=0;s<a.transform.length;s++){for(g=a.transform[s],(p=new t.TransformConstraintData(g.name)).order=this.getValue(g,"order",0),p.skinRequired=this.getValue(g,"skin",!1),v=0;v<g.bones.length;v++){if(f=g.bones[v],null==(b=r.findBone(f)))throw new Error("Transform constraint bone not found: "+f);p.bones.push(b)}if(y=g.target,p.target=r.findBone(y),null==p.target)throw new Error("Transform constraint target bone not found: "+y);p.local=this.getValue(g,"local",!1),p.relative=this.getValue(g,"relative",!1),p.offsetRotation=this.getValue(g,"rotation",0),p.offsetX=this.getValue(g,"x",0)*i,p.offsetY=this.getValue(g,"y",0)*i,p.offsetScaleX=this.getValue(g,"scaleX",0),p.offsetScaleY=this.getValue(g,"scaleY",0),p.offsetShearY=this.getValue(g,"shearY",0),p.rotateMix=this.getValue(g,"rotateMix",1),p.translateMix=this.getValue(g,"translateMix",1),p.scaleMix=this.getValue(g,"scaleMix",1),p.shearMix=this.getValue(g,"shearMix",1),r.transformConstraints.push(p)}if(a.path)for(s=0;s<a.path.length;s++){for(g=a.path[s],(p=new t.PathConstraintData(g.name)).order=this.getValue(g,"order",0),p.skinRequired=this.getValue(g,"skin",!1),v=0;v<g.bones.length;v++){if(f=g.bones[v],null==(b=r.findBone(f)))throw new Error("Transform constraint bone not found: "+f);p.bones.push(b)}if(y=g.target,p.target=r.findSlot(y),null==p.target)throw new Error("Path target slot not found: "+y);p.positionMode=e.positionModeFromString(this.getValue(g,"positionMode","percent")),p.spacingMode=e.spacingModeFromString(this.getValue(g,"spacingMode","length")),p.rotateMode=e.rotateModeFromString(this.getValue(g,"rotateMode","tangent")),p.offsetRotation=this.getValue(g,"rotation",0),p.position=this.getValue(g,"position",0),p.positionMode==t.PositionMode.Fixed&&(p.position*=i),p.spacing=this.getValue(g,"spacing",0),p.spacingMode!=t.SpacingMode.Length&&p.spacingMode!=t.SpacingMode.Fixed||(p.spacing*=i),p.rotateMix=this.getValue(g,"rotateMix",1),p.translateMix=this.getValue(g,"translateMix",1),r.pathConstraints.push(p)}if(a.skins){var x=a.skins;if(!(x instanceof Array)){var S=[];for(var T in x)S.push({name:T,attachments:x[T]});x=S}for(s=0;s<x.length;s++){var A=x[s],E=new t.Skin(A.name);if(A.bones)for(var C=0;C<A.bones.length;C++){var b;if(null==(b=r.findBone(A.bones[C])))throw new Error("Skin bone not found: "+A.bones[s]);E.bones.push(b)}if(A.ik)for(C=0;C<A.ik.length;C++){if(null==(w=r.findIkConstraint(A.ik[C])))throw new Error("Skin IK constraint not found: "+A.ik[s]);E.constraints.push(w)}if(A.transform)for(C=0;C<A.transform.length;C++){if(null==(w=r.findTransformConstraint(A.transform[C])))throw new Error("Skin transform constraint not found: "+A.transform[s]);E.constraints.push(w)}if(A.path)for(C=0;C<A.path.length;C++){var w;if(null==(w=r.findPathConstraint(A.path[C])))throw new Error("Skin path constraint not found: "+A.path[s]);E.constraints.push(w)}for(var h in A.attachments){var P=r.findSlot(h);if(null==P)throw new Error("Slot not found: "+h);var I=A.attachments[h];for(var R in I){var D=this.readAttachment(I[R],E,P.index,R,r);null!=D&&E.setAttachment(P.index,R,D)}}r.skins.push(E),"default"==E.name&&(r.defaultSkin=E)}}s=0;for(var O=this.linkedMeshes.length;s<O;s++){var M=this.linkedMeshes[s];if(null==(E=null==M.skin?r.defaultSkin:r.findSkin(M.skin)))throw new Error("Skin not found: "+M.skin);var N=E.getAttachment(M.slotIndex,M.parent);if(null==N)throw new Error("Parent mesh not found: "+M.parent);M.mesh.deformAttachment=M.inheritDeform?N:M.mesh,M.mesh.setParentMesh(N),M.mesh.updateUVs()}if(this.linkedMeshes.length=0,a.events)for(var L in a.events){var B=a.events[L];(p=new t.EventData(L)).intValue=this.getValue(B,"int",0),p.floatValue=this.getValue(B,"float",0),p.stringValue=this.getValue(B,"string",""),p.audioPath=this.getValue(B,"audio",null),null!=p.audioPath&&(p.volume=this.getValue(B,"volume",1),p.balance=this.getValue(B,"balance",0)),r.events.push(p)}if(a.animations)for(var F in a.animations){var z=a.animations[F];this.readAnimation(z,F,r)}return r},e.prototype.readAttachment=function(e,i,r,a,o){var s=this.scale;switch(a=this.getValue(e,"name",a),this.getValue(e,"type","region")){case"region":var c=this.getValue(e,"path",a),l=this.attachmentLoader.newRegionAttachment(i,a,c);return null==l?null:(l.path=c,l.x=this.getValue(e,"x",0)*s,l.y=this.getValue(e,"y",0)*s,l.scaleX=this.getValue(e,"scaleX",1),l.scaleY=this.getValue(e,"scaleY",1),l.rotation=this.getValue(e,"rotation",0),l.width=e.width*s,l.height=e.height*s,null!=(y=this.getValue(e,"color",null))&&l.color.setFromString(y),l.updateOffset(),l);case"boundingbox":var u=this.attachmentLoader.newBoundingBoxAttachment(i,a);return null==u?null:(this.readVertices(e,u,e.vertexCount<<1),null!=(y=this.getValue(e,"color",null))&&u.color.setFromString(y),u);case"mesh":case"linkedmesh":c=this.getValue(e,"path",a);var h=this.attachmentLoader.newMeshAttachment(i,a,c);if(null==h)return null;h.path=c,null!=(y=this.getValue(e,"color",null))&&h.color.setFromString(y),h.width=this.getValue(e,"width",0)*s,h.height=this.getValue(e,"height",0)*s;var f=this.getValue(e,"parent",null);if(null!=f)return this.linkedMeshes.push(new n(h,this.getValue(e,"skin",null),r,f,this.getValue(e,"deform",!0))),h;var _=e.uvs;return this.readVertices(e,h,_.length),h.triangles=e.triangles,h.regionUVs=_,h.updateUVs(),h.edges=this.getValue(e,"edges",null),h.hullLength=2*this.getValue(e,"hull",0),h;case"path":if(null==(c=this.attachmentLoader.newPathAttachment(i,a)))return null;c.closed=this.getValue(e,"closed",!1),c.constantSpeed=this.getValue(e,"constantSpeed",!0);var p=e.vertexCount;this.readVertices(e,c,p<<1);for(var d=t.Utils.newArray(p/3,0),m=0;m<e.lengths.length;m++)d[m]=e.lengths[m]*s;return c.lengths=d,null!=(y=this.getValue(e,"color",null))&&c.color.setFromString(y),c;case"point":var g=this.attachmentLoader.newPointAttachment(i,a);return null==g?null:(g.x=this.getValue(e,"x",0)*s,g.y=this.getValue(e,"y",0)*s,g.rotation=this.getValue(e,"rotation",0),null!=(y=this.getValue(e,"color",null))&&g.color.setFromString(y),g);case"clipping":var v=this.attachmentLoader.newClippingAttachment(i,a);if(null==v)return null;var y,x=this.getValue(e,"end",null);if(null!=x){var S=o.findSlot(x);if(null==S)throw new Error("Clipping end slot not found: "+x);v.endSlot=S}return p=e.vertexCount,this.readVertices(e,v,p<<1),null!=(y=this.getValue(e,"color",null))&&v.color.setFromString(y),v}return null},e.prototype.readVertices=function(e,n,i){var r=this.scale;n.worldVerticesLength=i;var a=e.vertices;if(i!=a.length){var o=new Array,s=new Array;for(h=0,f=a.length;h<f;){var c=a[h++];s.push(c);for(var l=h+4*c;h<l;h+=4)s.push(a[h]),o.push(a[h+1]*r),o.push(a[h+2]*r),o.push(a[h+3])}n.bones=s,n.vertices=t.Utils.toFloatArray(o)}else{var u=t.Utils.toFloatArray(a);if(1!=r)for(var h=0,f=a.length;h<f;h++)u[h]*=r;n.vertices=u}},e.prototype.readAnimation=function(e,n,i){var r=this.scale,a=new Array,o=0;if(e.slots)for(var s in e.slots){var c=e.slots[s];if(-1==(Z=i.findSlotIndex(s)))throw new Error("Slot not found: "+s);for(var l in c){var u=c[l];if("attachment"==l){(x=new t.AttachmentTimeline(u.length)).slotIndex=Z;for(var h=0,f=0;f<u.length;f++){var _=u[f];x.setFrame(h++,this.getValue(_,"time",0),_.name)}a.push(x),o=Math.max(o,x.frames[x.getFrameCount()-1])}else if("color"==l){for((x=new t.ColorTimeline(u.length)).slotIndex=Z,h=0,f=0;f<u.length;f++){_=u[f];var p=new t.Color;p.setFromString(_.color),x.setFrame(h,this.getValue(_,"time",0),p.r,p.g,p.b,p.a),this.readCurve(_,x,h),h++}a.push(x),o=Math.max(o,x.frames[(x.getFrameCount()-1)*t.ColorTimeline.ENTRIES])}else{if("twoColor"!=l)throw new Error("Invalid timeline type for a slot: "+l+" ("+s+")");for((x=new t.TwoColorTimeline(u.length)).slotIndex=Z,h=0,f=0;f<u.length;f++){_=u[f];var d=new t.Color,m=new t.Color;d.setFromString(_.light),m.setFromString(_.dark),x.setFrame(h,this.getValue(_,"time",0),d.r,d.g,d.b,d.a,m.r,m.g,m.b),this.readCurve(_,x,h),h++}a.push(x),o=Math.max(o,x.frames[(x.getFrameCount()-1)*t.TwoColorTimeline.ENTRIES])}}}if(e.bones)for(var g in e.bones){var v=e.bones[g],y=i.findBoneIndex(g);if(-1==y)throw new Error("Bone not found: "+g);for(var l in v)if(u=v[l],"rotate"===l){for((x=new t.RotateTimeline(u.length)).boneIndex=y,h=0,f=0;f<u.length;f++)_=u[f],x.setFrame(h,this.getValue(_,"time",0),this.getValue(_,"angle",0)),this.readCurve(_,x,h),h++;a.push(x),o=Math.max(o,x.frames[(x.getFrameCount()-1)*t.RotateTimeline.ENTRIES])}else{if("translate"!==l&&"scale"!==l&&"shear"!==l)throw new Error("Invalid timeline type for a bone: "+l+" ("+g+")");var x=null,S=1,T=0;for("scale"===l?(x=new t.ScaleTimeline(u.length),T=1):"shear"===l?x=new t.ShearTimeline(u.length):(x=new t.TranslateTimeline(u.length),S=r),x.boneIndex=y,h=0,f=0;f<u.length;f++){_=u[f];var A=this.getValue(_,"x",T),E=this.getValue(_,"y",T);x.setFrame(h,this.getValue(_,"time",0),A*S,E*S),this.readCurve(_,x,h),h++}a.push(x),o=Math.max(o,x.frames[(x.getFrameCount()-1)*t.TranslateTimeline.ENTRIES])}}if(e.ik)for(var C in e.ik){var b=e.ik[C],w=i.findIkConstraint(C);for((x=new t.IkConstraintTimeline(b.length)).ikConstraintIndex=i.ikConstraints.indexOf(w),h=0,f=0;f<b.length;f++)_=b[f],x.setFrame(h,this.getValue(_,"time",0),this.getValue(_,"mix",1),this.getValue(_,"softness",0)*r,this.getValue(_,"bendPositive",!0)?1:-1,this.getValue(_,"compress",!1),this.getValue(_,"stretch",!1)),this.readCurve(_,x,h),h++;a.push(x),o=Math.max(o,x.frames[(x.getFrameCount()-1)*t.IkConstraintTimeline.ENTRIES])}if(e.transform)for(var C in e.transform){for(b=e.transform[C],w=i.findTransformConstraint(C),(x=new t.TransformConstraintTimeline(b.length)).transformConstraintIndex=i.transformConstraints.indexOf(w),h=0,f=0;f<b.length;f++)_=b[f],x.setFrame(h,this.getValue(_,"time",0),this.getValue(_,"rotateMix",1),this.getValue(_,"translateMix",1),this.getValue(_,"scaleMix",1),this.getValue(_,"shearMix",1)),this.readCurve(_,x,h),h++;a.push(x),o=Math.max(o,x.frames[(x.getFrameCount()-1)*t.TransformConstraintTimeline.ENTRIES])}var P=e.path||e.paths;if(P)for(var C in P){b=P[C];var I=i.findPathConstraintIndex(C);if(-1==I)throw new Error("Path constraint not found: "+C);var R=i.pathConstraints[I];for(var l in b)if(u=b[l],"position"===l||"spacing"===l){for(x=null,S=1,"spacing"===l?(x=new t.PathConstraintSpacingTimeline(u.length),R.spacingMode!=t.SpacingMode.Length&&R.spacingMode!=t.SpacingMode.Fixed||(S=r)):(x=new t.PathConstraintPositionTimeline(u.length),R.positionMode==t.PositionMode.Fixed&&(S=r)),x.pathConstraintIndex=I,h=0,f=0;f<u.length;f++)_=u[f],x.setFrame(h,this.getValue(_,"time",0),this.getValue(_,l,0)*S),this.readCurve(_,x,h),h++;a.push(x),o=Math.max(o,x.frames[(x.getFrameCount()-1)*t.PathConstraintPositionTimeline.ENTRIES])}else if("mix"===l){for((x=new t.PathConstraintMixTimeline(u.length)).pathConstraintIndex=I,h=0,f=0;f<u.length;f++)_=u[f],x.setFrame(h,this.getValue(_,"time",0),this.getValue(_,"rotateMix",1),this.getValue(_,"translateMix",1)),this.readCurve(_,x,h),h++;a.push(x),o=Math.max(o,x.frames[(x.getFrameCount()-1)*t.PathConstraintMixTimeline.ENTRIES])}}if(e.deform)for(var D in e.deform){var O=e.deform[D],M=i.findSkin(D);if(null==M)throw new Error("Skin not found: "+D);for(var s in O){if(c=O[s],-1==(Z=i.findSlotIndex(s)))throw new Error("Slot not found: "+c.name);for(var l in c){u=c[l];var N=M.getAttachment(Z,l);if(null!=N){var L=null!=N.bones,B=N.vertices,F=L?B.length/3*2:B.length;(x=new t.DeformTimeline(u.length)).slotIndex=Z,x.attachment=N,h=0;for(var z=0;z<u.length;z++){_=u[z];var U=void 0,k=this.getValue(_,"vertices",null);if(null==k)U=L?t.Utils.newFloatArray(F):B;else{U=t.Utils.newFloatArray(F);var G=this.getValue(_,"offset",0);if(t.Utils.arrayCopy(k,0,U,G,k.length),1!=r)for(var H=(f=G)+k.length;f<H;f++)U[f]*=r;if(!L)for(f=0;f<F;f++)U[f]+=B[f]}x.setFrame(h,this.getValue(_,"time",0),U),this.readCurve(_,x,h),h++}a.push(x),o=Math.max(o,x.frames[x.getFrameCount()-1])}}}}var V=e.drawOrder;if(null==V&&(V=e.draworder),null!=V){x=new t.DrawOrderTimeline(V.length);var j=i.slots.length;for(h=0,z=0;z<V.length;z++){var W=V[z],X=null,q=this.getValue(W,"offsets",null);if(null!=q){X=t.Utils.newArray(j,-1);var Y=t.Utils.newArray(j-q.length,0),K=0,Q=0;for(f=0;f<q.length;f++){var Z,J=q[f];if(-1==(Z=i.findSlotIndex(J.slot)))throw new Error("Slot not found: "+J.slot);for(;K!=Z;)Y[Q++]=K++;X[K+J.offset]=K++}for(;K<j;)Y[Q++]=K++;for(f=j-1;f>=0;f--)-1==X[f]&&(X[f]=Y[--Q])}x.setFrame(h++,this.getValue(W,"time",0),X)}a.push(x),o=Math.max(o,x.frames[x.getFrameCount()-1])}if(e.events){for(x=new t.EventTimeline(e.events.length),h=0,f=0;f<e.events.length;f++){var $=e.events[f],tt=i.findEvent($.name);if(null==tt)throw new Error("Event not found: "+$.name);var et=new t.Event(t.Utils.toSinglePrecision(this.getValue($,"time",0)),tt);et.intValue=this.getValue($,"int",tt.intValue),et.floatValue=this.getValue($,"float",tt.floatValue),et.stringValue=this.getValue($,"string",tt.stringValue),null!=et.data.audioPath&&(et.volume=this.getValue($,"volume",1),et.balance=this.getValue($,"balance",0)),x.setFrame(h++,et)}a.push(x),o=Math.max(o,x.frames[x.getFrameCount()-1])}if(isNaN(o))throw new Error("Error while parsing animation, duration is NaN");i.animations.push(new t.Animation(n,a,o))},e.prototype.readCurve=function(t,e,n){var i=t.curve;i&&("stepped"==i?e.setStepped(n):"[object Array]"===Object.prototype.toString.call(i)?e.setCurve(n,i[0],i[1],i[2],i[3]):e.setCurve(n,i,this.getValue(t,"c2",0),this.getValue(t,"c3",1),this.getValue(t,"c4",1)))},e.prototype.getValue=function(t,e,n){return void 0!==t[e]?t[e]:n},e.blendModeFromString=function(e){if("normal"==(e=e.toLowerCase()))return t.BlendMode.Normal;if("additive"==e)return t.BlendMode.Additive;if("multiply"==e)return t.BlendMode.Multiply;if("screen"==e)return t.BlendMode.Screen;throw new Error("Unknown blend mode: "+e)},e.positionModeFromString=function(e){if("fixed"==(e=e.toLowerCase()))return t.PositionMode.Fixed;if("percent"==e)return t.PositionMode.Percent;throw new Error("Unknown position mode: "+e)},e.spacingModeFromString=function(e){if("length"==(e=e.toLowerCase()))return t.SpacingMode.Length;if("fixed"==e)return t.SpacingMode.Fixed;if("percent"==e)return t.SpacingMode.Percent;throw new Error("Unknown position mode: "+e)},e.rotateModeFromString=function(e){if("tangent"==(e=e.toLowerCase()))return t.RotateMode.Tangent;if("chain"==e)return t.RotateMode.Chain;if("chainscale"==e)return t.RotateMode.ChainScale;throw new Error("Unknown rotate mode: "+e)},e.transformModeFromString=function(e){if("normal"==(e=e.toLowerCase()))return t.TransformMode.Normal;if("onlytranslation"==e)return t.TransformMode.OnlyTranslation;if("norotationorreflection"==e)return t.TransformMode.NoRotationOrReflection;if("noscale"==e)return t.TransformMode.NoScale;if("noscaleorreflection"==e)return t.TransformMode.NoScaleOrReflection;throw new Error("Unknown transform mode: "+e)},e}();t.SkeletonJson=e;var n=function(t,e,n,i,r){this.mesh=t,this.skin=e,this.slotIndex=n,this.parent=i,this.inheritDeform=r}}(vut||(vut={})),function(t){var e=function(t,e,n){this.slotIndex=t,this.name=e,this.attachment=n};t.SkinEntry=e;var n=function(){function n(t){if(this.attachments=new Array,this.bones=Array(),this.constraints=new Array,null==t)throw new Error("name cannot be null.");this.name=t}return n.prototype.setAttachment=function(t,e,n){if(null==n)throw new Error("attachment cannot be null.");var i=this.attachments;t>=i.length&&(i.length=t+1),i[t]||(i[t]={}),i[t][e]=n},n.prototype.addSkin=function(t){for(var e=0;e<t.bones.length;e++){for(var n=t.bones[e],i=!1,r=0;r<this.bones.length;r++)if(this.bones[r]==n){i=!0;break}i||this.bones.push(n)}for(e=0;e<t.constraints.length;e++){var a=t.constraints[e];for(i=!1,r=0;r<this.constraints.length;r++)if(this.constraints[r]==a){i=!0;break}i||this.constraints.push(a)}var o=t.getAttachments();for(e=0;e<o.length;e++){var s=o[e];this.setAttachment(s.slotIndex,s.name,s.attachment)}},n.prototype.copySkin=function(e){for(var n=0;n<e.bones.length;n++){for(var i=e.bones[n],r=!1,a=0;a<this.bones.length;a++)if(this.bones[a]==i){r=!0;break}r||this.bones.push(i)}for(n=0;n<e.constraints.length;n++){var o=e.constraints[n];for(r=!1,a=0;a<this.constraints.length;a++)if(this.constraints[a]==o){r=!0;break}r||this.constraints.push(o)}var s=e.getAttachments();for(n=0;n<s.length;n++){var c=s[n];null!=c.attachment&&(c.attachment instanceof t.MeshAttachment?(c.attachment=c.attachment.newLinkedMesh(),this.setAttachment(c.slotIndex,c.name,c.attachment)):(c.attachment=c.attachment.copy(),this.setAttachment(c.slotIndex,c.name,c.attachment)))}},n.prototype.getAttachment=function(t,e){var n=this.attachments[t];return n?n[e]:null},n.prototype.removeAttachment=function(t,e){var n=this.attachments[t];n&&(n[e]=null)},n.prototype.getAttachments=function(){for(var t=new Array,n=0;n<this.attachments.length;n++){var i=this.attachments[n];if(i)for(var r in i){var a=i[r];a&&t.push(new e(n,r,a))}}return t},n.prototype.getAttachmentsForSlot=function(t,n){var i=this.attachments[t];if(i)for(var r in i){var a=i[r];a&&n.push(new e(t,r,a))}},n.prototype.clear=function(){this.attachments.length=0,this.bones.length=0,this.constraints.length=0},n.prototype.attachAll=function(t,e){for(var n=0,i=0;i<t.slots.length;i++){var r=t.slots[i],a=r.getAttachment();if(a&&n<e.attachments.length){var o=e.attachments[n];for(var s in o)if(a==o[s]){var c=this.getAttachment(n,s);null!=c&&r.setAttachment(c);break}}n++}},n}();t.Skin=n}(vut||(vut={})),function(t){var e=function(){function e(e,n){if(this.deform=new Array,null==e)throw new Error("data cannot be null.");if(null==n)throw new Error("bone cannot be null.");this.data=e,this.bone=n,this.color=new t.Color,this.darkColor=null==e.darkColor?null:new t.Color,this.setToSetupPose()}return e.prototype.getSkeleton=function(){return this.bone.skeleton},e.prototype.getAttachment=function(){return this.attachment},e.prototype.setAttachment=function(t){this.attachment!=t&&(this.attachment=t,this.attachmentTime=this.bone.skeleton.time,this.deform.length=0)},e.prototype.setAttachmentTime=function(t){this.attachmentTime=this.bone.skeleton.time-t},e.prototype.getAttachmentTime=function(){return this.bone.skeleton.time-this.attachmentTime},e.prototype.setToSetupPose=function(){this.color.setFromColor(this.data.color),null!=this.darkColor&&this.darkColor.setFromColor(this.data.darkColor),null==this.data.attachmentName?this.attachment=null:(this.attachment=null,this.setAttachment(this.bone.skeleton.getAttachment(this.data.index,this.data.attachmentName)))},e}();t.Slot=e}(vut||(vut={})),function(t){t.SlotData=function(e,n,i){if(this.color=new t.Color(1,1,1,1),e<0)throw new Error("index must be >= 0.");if(null==n)throw new Error("name cannot be null.");if(null==i)throw new Error("boneData cannot be null.");this.index=e,this.name=n,this.boneData=i}}(vut||(vut={})),function(t){var e,n,i=function(){function t(t){this._image=t}return t.prototype.getImage=function(){return this._image},t.filterFromString=function(t){switch(t.toLowerCase()){case"nearest":return e.Nearest;case"linear":return e.Linear;case"mipmap":return e.MipMap;case"mipmapnearestnearest":return e.MipMapNearestNearest;case"mipmaplinearnearest":return e.MipMapLinearNearest;case"mipmapnearestlinear":return e.MipMapNearestLinear;case"mipmaplinearlinear":return e.MipMapLinearLinear;default:throw new Error("Unknown texture filter "+t)}},t.wrapFromString=function(t){switch(t.toLowerCase()){case"mirroredtepeat":return n.MirroredRepeat;case"clamptoedge":return n.ClampToEdge;case"repeat":return n.Repeat;default:throw new Error("Unknown texture wrap "+t)}},t}();t.Texture=i,function(t){t[t.Nearest=9728]="Nearest",t[t.Linear=9729]="Linear",t[t.MipMap=9987]="MipMap",t[t.MipMapNearestNearest=9984]="MipMapNearestNearest",t[t.MipMapLinearNearest=9985]="MipMapLinearNearest",t[t.MipMapNearestLinear=9986]="MipMapNearestLinear",t[t.MipMapLinearLinear=9987]="MipMapLinearLinear"}(e=t.TextureFilter||(t.TextureFilter={})),function(t){t[t.MirroredRepeat=33648]="MirroredRepeat",t[t.ClampToEdge=33071]="ClampToEdge",t[t.Repeat=10497]="Repeat"}(n=t.TextureWrap||(t.TextureWrap={}));t.TextureRegion=function(){this.u=0,this.v=0,this.u2=0,this.v2=0,this.width=0,this.height=0,this.rotate=!1,this.offsetX=0,this.offsetY=0,this.originalWidth=0,this.originalHeight=0};var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return yut(e,t),e.prototype.setFilters=function(){},e.prototype.setWraps=function(){},e.prototype.dispose=function(){},e}(i);t.FakeTexture=r}(vut||(vut={})),function(t){var e=function(){function e(t,e){this.pages=new Array,this.regions=new Array,this.load(t,e)}return e.prototype.load=function(e,a){if(null==a)throw new Error("textureLoader cannot be null.");for(var o=new n(e),s=new Array(4),c=null;;){var l=o.readLine();if(null==l)break;if(0==(l=l.trim()).length)c=null;else if(c){var u=new r;u.name=l,u.page=c;var h=o.readValue();"true"==h.toLocaleLowerCase()?u.degrees=90:"false"==h.toLocaleLowerCase()?u.degrees=0:u.degrees=parseFloat(h),u.rotate=90==u.degrees,o.readTuple(s);var f=parseInt(s[0]),_=parseInt(s[1]);o.readTuple(s);var p=parseInt(s[0]),d=parseInt(s[1]);u.u=f/c.width,u.v=_/c.height,u.rotate?(u.u2=(f+d)/c.width,u.v2=(_+p)/c.height):(u.u2=(f+p)/c.width,u.v2=(_+d)/c.height),u.x=f,u.y=_,u.width=Math.abs(p),u.height=Math.abs(d),4==o.readTuple(s)&&4==o.readTuple(s)&&o.readTuple(s),u.originalWidth=parseInt(s[0]),u.originalHeight=parseInt(s[1]),o.readTuple(s),u.offsetX=parseInt(s[0]),u.offsetY=parseInt(s[1]),u.index=parseInt(o.readValue()),u.texture=c.texture,this.regions.push(u)}else{(c=new i).name=l,2==o.readTuple(s)&&(c.width=parseInt(s[0]),c.height=parseInt(s[1]),o.readTuple(s)),o.readTuple(s),c.minFilter=t.Texture.filterFromString(s[0]),c.magFilter=t.Texture.filterFromString(s[1]);var m=o.readValue();c.uWrap=t.TextureWrap.ClampToEdge,c.vWrap=t.TextureWrap.ClampToEdge,"x"==m?c.uWrap=t.TextureWrap.Repeat:"y"==m?c.vWrap=t.TextureWrap.Repeat:"xy"==m&&(c.uWrap=c.vWrap=t.TextureWrap.Repeat),c.texture=a(l),c.texture.setFilters(c.minFilter,c.magFilter),c.texture.setWraps(c.uWrap,c.vWrap),c.width=c.texture.getImage().width,c.height=c.texture.getImage().height,this.pages.push(c)}}},e.prototype.findRegion=function(t){for(var e=0;e<this.regions.length;e++)if(this.regions[e].name==t)return this.regions[e];return null},e.prototype.dispose=function(){for(var t=0;t<this.pages.length;t++)this.pages[t].texture.dispose()},e}();t.TextureAtlas=e;var n=function(){function t(t){this.index=0,this.lines=t.split(/\r\n|\r|\n/)}return t.prototype.readLine=function(){return this.index>=this.lines.length?null:this.lines[this.index++]},t.prototype.readValue=function(){var t=this.readLine(),e=t.indexOf(":");if(-1==e)throw new Error("Invalid line: "+t);return t.substring(e+1).trim()},t.prototype.readTuple=function(t){var e=this.readLine(),n=e.indexOf(":");if(-1==n)throw new Error("Invalid line: "+e);for(var i=0,r=n+1;i<3;i++){var a=e.indexOf(",",r);if(-1==a)break;t[i]=e.substr(r,a-r).trim(),r=a+1}return t[i]=e.substring(r).trim(),i+1},t}(),i=function(){};t.TextureAtlasPage=i;var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return yut(e,t),e}(t.TextureRegion);t.TextureAtlasRegion=r}(vut||(vut={})),function(t){var e=function(){function e(e,n){if(this.rotateMix=0,this.translateMix=0,this.scaleMix=0,this.shearMix=0,this.temp=new t.Vector2,this.active=!1,null==e)throw new Error("data cannot be null.");if(null==n)throw new Error("skeleton cannot be null.");this.data=e,this.rotateMix=e.rotateMix,this.translateMix=e.translateMix,this.scaleMix=e.scaleMix,this.shearMix=e.shearMix,this.bones=new Array;for(var i=0;i<e.bones.length;i++)this.bones.push(n.findBone(e.bones[i].name));this.target=n.findBone(e.target.name)}return e.prototype.isActive=function(){return this.active},e.prototype.apply=function(){this.update()},e.prototype.update=function(){this.data.local?this.data.relative?this.applyRelativeLocal():this.applyAbsoluteLocal():this.data.relative?this.applyRelativeWorld():this.applyAbsoluteWorld()},e.prototype.applyAbsoluteWorld=function(){for(var e=this.rotateMix,n=this.translateMix,i=this.scaleMix,r=this.shearMix,a=this.target,o=a.a,s=a.b,c=a.c,l=a.d,u=o*l-s*c>0?t.MathUtils.degRad:-t.MathUtils.degRad,h=this.data.offsetRotation*u,f=this.data.offsetShearY*u,_=this.bones,p=0,d=_.length;p<d;p++){var m=_[p],g=!1;if(0!=e){var v=m.a,y=m.b,x=m.c,S=m.d;(w=Math.atan2(c,o)-Math.atan2(x,v)+h)>t.MathUtils.PI?w-=t.MathUtils.PI2:w<-t.MathUtils.PI&&(w+=t.MathUtils.PI2),w*=e;var T=Math.cos(w),A=Math.sin(w);m.a=T*v-A*x,m.b=T*y-A*S,m.c=A*v+T*x,m.d=A*y+T*S,g=!0}if(0!=n){var E=this.temp;a.localToWorld(E.set(this.data.offsetX,this.data.offsetY)),m.worldX+=(E.x-m.worldX)*n,m.worldY+=(E.y-m.worldY)*n,g=!0}if(i>0){var C=Math.sqrt(m.a*m.a+m.c*m.c),b=Math.sqrt(o*o+c*c);C>1e-5&&(C=(C+(b-C+this.data.offsetScaleX)*i)/C),m.a*=C,m.c*=C,C=Math.sqrt(m.b*m.b+m.d*m.d),b=Math.sqrt(s*s+l*l),C>1e-5&&(C=(C+(b-C+this.data.offsetScaleY)*i)/C),m.b*=C,m.d*=C,g=!0}if(r>0){y=m.b,S=m.d;var w,P=Math.atan2(S,y);(w=Math.atan2(l,s)-Math.atan2(c,o)-(P-Math.atan2(m.c,m.a)))>t.MathUtils.PI?w-=t.MathUtils.PI2:w<-t.MathUtils.PI&&(w+=t.MathUtils.PI2),w=P+(w+f)*r,C=Math.sqrt(y*y+S*S),m.b=Math.cos(w)*C,m.d=Math.sin(w)*C,g=!0}g&&(m.appliedValid=!1)}},e.prototype.applyRelativeWorld=function(){for(var e=this.rotateMix,n=this.translateMix,i=this.scaleMix,r=this.shearMix,a=this.target,o=a.a,s=a.b,c=a.c,l=a.d,u=o*l-s*c>0?t.MathUtils.degRad:-t.MathUtils.degRad,h=this.data.offsetRotation*u,f=this.data.offsetShearY*u,_=this.bones,p=0,d=_.length;p<d;p++){var m,g=_[p],v=!1;if(0!=e){var y=g.a,x=g.b,S=g.c,T=g.d;(m=Math.atan2(c,o)+h)>t.MathUtils.PI?m-=t.MathUtils.PI2:m<-t.MathUtils.PI&&(m+=t.MathUtils.PI2),m*=e;var A=Math.cos(m),E=Math.sin(m);g.a=A*y-E*S,g.b=A*x-E*T,g.c=E*y+A*S,g.d=E*x+A*T,v=!0}if(0!=n){var C=this.temp;a.localToWorld(C.set(this.data.offsetX,this.data.offsetY)),g.worldX+=C.x*n,g.worldY+=C.y*n,v=!0}if(i>0){var b=(Math.sqrt(o*o+c*c)-1+this.data.offsetScaleX)*i+1;g.a*=b,g.c*=b,b=(Math.sqrt(s*s+l*l)-1+this.data.offsetScaleY)*i+1,g.b*=b,g.d*=b,v=!0}if(r>0)(m=Math.atan2(l,s)-Math.atan2(c,o))>t.MathUtils.PI?m-=t.MathUtils.PI2:m<-t.MathUtils.PI&&(m+=t.MathUtils.PI2),x=g.b,T=g.d,m=Math.atan2(T,x)+(m-t.MathUtils.PI/2+f)*r,b=Math.sqrt(x*x+T*T),g.b=Math.cos(m)*b,g.d=Math.sin(m)*b,v=!0;v&&(g.appliedValid=!1)}},e.prototype.applyAbsoluteLocal=function(){var t=this.rotateMix,e=this.translateMix,n=this.scaleMix,i=this.shearMix,r=this.target;r.appliedValid||r.updateAppliedTransform();for(var a=this.bones,o=0,s=a.length;o<s;o++){var c=a[o];c.appliedValid||c.updateAppliedTransform();var l=c.arotation;if(0!=t){var u=r.arotation-l+this.data.offsetRotation;l+=(u-=360*(16384-(16384.499999999996-u/360|0)))*t}var h=c.ax,f=c.ay;0!=e&&(h+=(r.ax-h+this.data.offsetX)*e,f+=(r.ay-f+this.data.offsetY)*e);var _=c.ascaleX,p=c.ascaleY;0!=n&&(_>1e-5&&(_=(_+(r.ascaleX-_+this.data.offsetScaleX)*n)/_),p>1e-5&&(p=(p+(r.ascaleY-p+this.data.offsetScaleY)*n)/p));var d=c.ashearY;0!=i&&(u=r.ashearY-d+this.data.offsetShearY,u-=360*(16384-(16384.499999999996-u/360|0)),c.shearY+=u*i),c.updateWorldTransformWith(h,f,l,_,p,c.ashearX,d)}},e.prototype.applyRelativeLocal=function(){var t=this.rotateMix,e=this.translateMix,n=this.scaleMix,i=this.shearMix,r=this.target;r.appliedValid||r.updateAppliedTransform();for(var a=this.bones,o=0,s=a.length;o<s;o++){var c=a[o];c.appliedValid||c.updateAppliedTransform();var l=c.arotation;0!=t&&(l+=(r.arotation+this.data.offsetRotation)*t);var u=c.ax,h=c.ay;0!=e&&(u+=(r.ax+this.data.offsetX)*e,h+=(r.ay+this.data.offsetY)*e);var f=c.ascaleX,_=c.ascaleY;0!=n&&(f>1e-5&&(f*=(r.ascaleX-1+this.data.offsetScaleX)*n+1),_>1e-5&&(_*=(r.ascaleY-1+this.data.offsetScaleY)*n+1));var p=c.ashearY;0!=i&&(p+=(r.ashearY+this.data.offsetShearY)*i),c.updateWorldTransformWith(u,h,l,f,_,c.ashearX,p)}},e}();t.TransformConstraint=e}(vut||(vut={})),function(t){var e=function(t){function e(e){var n=t.call(this,e,0,!1)||this;return n.bones=new Array,n.rotateMix=0,n.translateMix=0,n.scaleMix=0,n.shearMix=0,n.offsetRotation=0,n.offsetX=0,n.offsetY=0,n.offsetScaleX=0,n.offsetScaleY=0,n.offsetShearY=0,n.relative=!1,n.local=!1,n}return yut(e,t),e}(t.ConstraintData);t.TransformConstraintData=e}(vut||(vut={})),function(t){var e=function(){function e(){this.convexPolygons=new Array,this.convexPolygonsIndices=new Array,this.indicesArray=new Array,this.isConcaveArray=new Array,this.triangles=new Array,this.polygonPool=new t.Pool((function(){return new Array})),this.polygonIndicesPool=new t.Pool((function(){return new Array}))}return e.prototype.triangulate=function(t){var n=t,i=t.length>>1,r=this.indicesArray;r.length=0;for(var a=0;a<i;a++)r[a]=a;var o=this.isConcaveArray;o.length=0,a=0;for(var s=i;a<s;++a)o[a]=e.isConcave(a,i,n,r);var c=this.triangles;for(c.length=0;i>3;){for(var l=i-1,u=(a=0,1);;){t:if(!o[a]){for(var h=r[l]<<1,f=r[a]<<1,_=r[u]<<1,p=n[h],d=n[h+1],m=n[f],g=n[f+1],v=n[_],y=n[_+1],x=(u+1)%i;x!=l;x=(x+1)%i)if(o[x]){var S=r[x]<<1,T=n[S],A=n[S+1];if(e.positiveArea(v,y,p,d,T,A)&&e.positiveArea(p,d,m,g,T,A)&&e.positiveArea(m,g,v,y,T,A))break t}break}if(0==u){do{if(!o[a])break;a--}while(a>0);break}l=a,a=u,u=(u+1)%i}c.push(r[(i+a-1)%i]),c.push(r[a]),c.push(r[(a+1)%i]),r.splice(a,1),o.splice(a,1);var E=(--i+a-1)%i,C=a==i?0:a;o[E]=e.isConcave(E,i,n,r),o[C]=e.isConcave(C,i,n,r)}return 3==i&&(c.push(r[2]),c.push(r[0]),c.push(r[1])),c},e.prototype.decompose=function(t,n){var i=t,r=this.convexPolygons;this.polygonPool.freeAll(r),r.length=0;var a=this.convexPolygonsIndices;this.polygonIndicesPool.freeAll(a),a.length=0;var o=this.polygonIndicesPool.obtain();o.length=0;var s=this.polygonPool.obtain();s.length=0;for(var c=-1,l=0,u=0,h=n.length;u<h;u+=3){var f=n[u]<<1,_=n[u+1]<<1,p=n[u+2]<<1,d=i[f],m=i[f+1],g=i[_],v=i[_+1],y=i[p],x=i[p+1],S=!1;if(c==f){var T=s.length-4,A=e.winding(s[T],s[T+1],s[T+2],s[T+3],y,x),E=e.winding(y,x,s[0],s[1],s[2],s[3]);A==l&&E==l&&(s.push(y),s.push(x),o.push(p),S=!0)}S||(s.length>0?(r.push(s),a.push(o)):(this.polygonPool.free(s),this.polygonIndicesPool.free(o)),(s=this.polygonPool.obtain()).length=0,s.push(d),s.push(m),s.push(g),s.push(v),s.push(y),s.push(x),(o=this.polygonIndicesPool.obtain()).length=0,o.push(f),o.push(_),o.push(p),l=e.winding(d,m,g,v,y,x),c=f)}for(s.length>0&&(r.push(s),a.push(o)),u=0,h=r.length;u<h;u++)if(0!=(o=a[u]).length)for(var C=o[0],b=o[o.length-1],w=(s=r[u])[T=s.length-4],P=s[T+1],I=s[T+2],R=s[T+3],D=s[0],O=s[1],M=s[2],N=s[3],L=e.winding(w,P,I,R,D,O),B=0;B<h;B++)if(B!=u){var F=a[B];if(3==F.length){var z=F[0],U=F[1],k=F[2],G=r[B];y=G[G.length-2],x=G[G.length-1],z==C&&U==b&&(A=e.winding(w,P,I,R,y,x),E=e.winding(y,x,D,O,M,N),A==L&&E==L&&(G.length=0,F.length=0,s.push(y),s.push(x),o.push(k),w=I,P=R,I=y,R=x,B=0))}}for(u=r.length-1;u>=0;u--)0==(s=r[u]).length&&(r.splice(u,1),this.polygonPool.free(s),o=a[u],a.splice(u,1),this.polygonIndicesPool.free(o));return r},e.isConcave=function(t,e,n,i){var r=i[(e+t-1)%e]<<1,a=i[t]<<1,o=i[(t+1)%e]<<1;return!this.positiveArea(n[r],n[r+1],n[a],n[a+1],n[o],n[o+1])},e.positiveArea=function(t,e,n,i,r,a){return t*(a-i)+n*(e-a)+r*(i-e)>=0},e.winding=function(t,e,n,i,r,a){var o=n-t,s=i-e;return r*s-a*o+o*e-t*s>=0?1:-1},e}();t.Triangulator=e}(vut||(vut={})),function(t){var e=function(){function t(){this.array=new Array}return t.prototype.add=function(t){var e=this.contains(t);return this.array[0|t]=0|t,!e},t.prototype.contains=function(t){return null!=this.array[0|t]},t.prototype.remove=function(t){this.array[0|t]=void 0},t.prototype.clear=function(){this.array.length=0},t}();t.IntSet=e;var n=function(){function t(t,e,n,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),this.r=t,this.g=e,this.b=n,this.a=i}return t.prototype.set=function(t,e,n,i){return this.r=t,this.g=e,this.b=n,this.a=i,this.clamp(),this},t.prototype.setFromColor=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this},t.prototype.setFromString=function(t){return t="#"==t.charAt(0)?t.substr(1):t,this.r=parseInt(t.substr(0,2),16)/255,this.g=parseInt(t.substr(2,2),16)/255,this.b=parseInt(t.substr(4,2),16)/255,this.a=(8!=t.length?255:parseInt(t.substr(6,2),16))/255,this},t.prototype.add=function(t,e,n,i){return this.r+=t,this.g+=e,this.b+=n,this.a+=i,this.clamp(),this},t.prototype.clamp=function(){return this.r<0?this.r=0:this.r>1&&(this.r=1),this.g<0?this.g=0:this.g>1&&(this.g=1),this.b<0?this.b=0:this.b>1&&(this.b=1),this.a<0?this.a=0:this.a>1&&(this.a=1),this},t.rgba8888ToColor=function(t,e){t.r=((4278190080&e)>>>24)/255,t.g=((16711680&e)>>>16)/255,t.b=((65280&e)>>>8)/255,t.a=(255&e)/255},t.rgb888ToColor=function(t,e){t.r=((16711680&e)>>>16)/255,t.g=((65280&e)>>>8)/255,t.b=(255&e)/255},t.WHITE=new t(1,1,1,1),t.RED=new t(1,0,0,1),t.GREEN=new t(0,1,0,1),t.BLUE=new t(0,0,1,1),t.MAGENTA=new t(1,0,1,1),t}();t.Color=n;var i=function(){function t(){}return t.clamp=function(t,e,n){return t<e?e:t>n?n:t},t.cosDeg=function(e){return Math.cos(e*t.degRad)},t.sinDeg=function(e){return Math.sin(e*t.degRad)},t.signum=function(t){return t>0?1:t<0?-1:0},t.toInt=function(t){return t>0?Math.floor(t):Math.ceil(t)},t.cbrt=function(t){var e=Math.pow(Math.abs(t),1/3);return t<0?-e:e},t.randomTriangular=function(e,n){return t.randomTriangularWith(e,n,.5*(e+n))},t.randomTriangularWith=function(t,e,n){var i=Math.random(),r=e-t;return i<=(n-t)/r?t+Math.sqrt(i*r*(n-t)):e-Math.sqrt((1-i)*r*(e-n))},t.PI=3.1415927,t.PI2=2*t.PI,t.radiansToDegrees=180/t.PI,t.radDeg=t.radiansToDegrees,t.degreesToRadians=t.PI/180,t.degRad=t.degreesToRadians,t}();t.MathUtils=i;var r=function(){function t(){}return t.prototype.apply=function(t,e,n){return t+(e-t)*this.applyInternal(n)},t}();t.Interpolation=r;var a=function(t){function e(e){var n=t.call(this)||this;return n.power=2,n.power=e,n}return yut(e,t),e.prototype.applyInternal=function(t){return t<=.5?Math.pow(2*t,this.power)/2:Math.pow(2*(t-1),this.power)/(this.power%2==0?-2:2)+1},e}(r);t.Pow=a;var o=function(t){function e(e){return t.call(this,e)||this}return yut(e,t),e.prototype.applyInternal=function(t){return Math.pow(t-1,this.power)*(this.power%2==0?-1:1)+1},e}(a);t.PowOut=o;var s=function(){function t(){}return t.arrayCopy=function(t,e,n,i,r){for(var a=e,o=i;a<e+r;a++,o++)n[o]=t[a]},t.setArraySize=function(t,e,n){void 0===n&&(n=0);var i=t.length;if(i==e)return t;if(t.length=e,i<e)for(var r=i;r<e;r++)t[r]=n;return t},t.ensureArrayCapacity=function(e,n,i){return void 0===i&&(i=0),e.length>=n?e:t.setArraySize(e,n,i)},t.newArray=function(t,e){for(var n=new Array(t),i=0;i<t;i++)n[i]=e;return n},t.newFloatArray=function(e){if(t.SUPPORTS_TYPED_ARRAYS)return new Float32Array(e);for(var n=new Array(e),i=0;i<n.length;i++)n[i]=0;return n},t.newShortArray=function(e){if(t.SUPPORTS_TYPED_ARRAYS)return new Int16Array(e);for(var n=new Array(e),i=0;i<n.length;i++)n[i]=0;return n},t.toFloatArray=function(e){return t.SUPPORTS_TYPED_ARRAYS?new Float32Array(e):e},t.toSinglePrecision=function(e){return t.SUPPORTS_TYPED_ARRAYS?Math.fround(e):e},t.webkit602BugfixHelper=function(){},t.contains=function(t,e){for(var n=0;n<t.length;n++)if(t[n]==e)return!0;return!1},t.SUPPORTS_TYPED_ARRAYS="undefined"!=typeof Float32Array,t}();t.Utils=s;var c=function(){function t(){}return t.logBones=function(t){for(var e=0;e<t.bones.length;e++){var n=t.bones[e];console.log(n.data.name+", "+n.a+", "+n.b+", "+n.c+", "+n.d+", "+n.worldX+", "+n.worldY)}},t}();t.DebugUtils=c;var l=function(){function t(t){this.items=new Array,this.instantiator=t}return t.prototype.obtain=function(){return this.items.length>0?this.items.pop():this.instantiator()},t.prototype.free=function(t){t.reset&&t.reset(),this.items.push(t)},t.prototype.freeAll=function(t){for(var e=0;e<t.length;e++)t[e].reset&&t[e].reset(),this.items[e]=t[e]},t.prototype.clear=function(){this.items.length=0},t}();t.Pool=l;var u=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return t.prototype.set=function(t,e){return this.x=t,this.y=e,this},t.prototype.length=function(){var t=this.x,e=this.y;return Math.sqrt(t*t+e*e)},t.prototype.normalize=function(){var t=this.length();return 0!=t&&(this.x/=t,this.y/=t),this},t}();t.Vector2=u;var h=function(){function t(){this.maxDelta=.064,this.framesPerSecond=0,this.delta=0,this.totalTime=0,this.lastTime=Date.now()/1e3,this.frameCount=0,this.frameTime=0}return t.prototype.update=function(){var t=Date.now()/1e3;this.delta=t-this.lastTime,this.frameTime+=this.delta,this.totalTime+=this.delta,this.delta>this.maxDelta&&(this.delta=this.maxDelta),this.lastTime=t,this.frameCount++,this.frameTime>1&&(this.framesPerSecond=this.frameCount/this.frameTime,this.frameTime=0,this.frameCount=0)},t}();t.TimeKeeper=h;var f=function(){function t(t){void 0===t&&(t=32),this.addedValues=0,this.lastValue=0,this.mean=0,this.dirty=!0,this.values=new Array(t)}return t.prototype.hasEnoughData=function(){return this.addedValues>=this.values.length},t.prototype.addValue=function(t){this.addedValues<this.values.length&&this.addedValues++,this.values[this.lastValue++]=t,this.lastValue>this.values.length-1&&(this.lastValue=0),this.dirty=!0},t.prototype.getMean=function(){if(this.hasEnoughData()){if(this.dirty){for(var t=0,e=0;e<this.values.length;e++)t+=this.values[e];this.mean=t/this.values.length,this.dirty=!1}return this.mean}return 0},t}();t.WindowedMean=f}(vut||(vut={})),Math.fround||(Math.fround=function(t){return function(e){return t[0]=e,t[0]}}(new Float32Array(1))),function(t){var e=function(t){if(null==t)throw new Error("name cannot be null.");this.name=t};t.Attachment=e;var n=function(e){function n(t){var i=e.call(this,t)||this;return i.id=(65535&n.nextID++)<<11,i.worldVerticesLength=0,i.deformAttachment=i,i}return yut(n,e),n.prototype.computeWorldVertices=function(t,e,n,i,r,a){n=r+(n>>1)*a;var o=t.bone.skeleton,s=t.deform,c=this.vertices,l=this.bones;if(null!=l){for(var u=0,h=0,f=0;f<e;f+=2)u+=(m=l[u])+1,h+=m;var _=o.bones;if(0==s.length)for(P=r,E=3*h;P<n;P+=a){var p=0,d=0,m=l[u++];for(m+=u;u<m;u++,E+=3){x=_[l[u]],I=c[E],R=c[E+1];var g=c[E+2];p+=(I*x.a+R*x.b+x.worldX)*g,d+=(I*x.c+R*x.d+x.worldY)*g}i[P]=p,i[P+1]=d}else for(var v=s,y=(P=r,E=3*h,h<<1);P<n;P+=a){for(p=0,d=0,m=l[u++],m+=u;u<m;u++,E+=3,y+=2)x=_[l[u]],I=c[E]+v[y],R=c[E+1]+v[y+1],g=c[E+2],p+=(I*x.a+R*x.b+x.worldX)*g,d+=(I*x.c+R*x.d+x.worldY)*g;i[P]=p,i[P+1]=d}}else{s.length>0&&(c=s);for(var x,S=(x=t.bone).worldX,T=x.worldY,A=x.a,E=x.b,C=x.c,b=x.d,w=e,P=r;P<n;w+=2,P+=a){var I=c[w],R=c[w+1];i[P]=I*A+R*E+S,i[P+1]=I*C+R*b+T}}},n.prototype.copyTo=function(e){null!=this.bones?(e.bones=new Array(this.bones.length),t.Utils.arrayCopy(this.bones,0,e.bones,0,this.bones.length)):e.bones=null,null!=this.vertices?(e.vertices=t.Utils.newFloatArray(this.vertices.length),t.Utils.arrayCopy(this.vertices,0,e.vertices,0,this.vertices.length)):e.vertices=null,e.worldVerticesLength=this.worldVerticesLength,e.deformAttachment=this.deformAttachment},n.nextID=0,n}(e);t.VertexAttachment=n}(vut||(vut={})),function(t){var e;(e=t.AttachmentType||(t.AttachmentType={}))[e.Region=0]="Region",e[e.BoundingBox=1]="BoundingBox",e[e.Mesh=2]="Mesh",e[e.LinkedMesh=3]="LinkedMesh",e[e.Path=4]="Path",e[e.Point=5]="Point",e[e.Clipping=6]="Clipping"}(vut||(vut={})),function(t){var e=function(e){function n(n){var i=e.call(this,n)||this;return i.color=new t.Color(1,1,1,1),i}return yut(n,e),n.prototype.copy=function(){var t=new n(name);return this.copyTo(t),t.color.setFromColor(this.color),t},n}(t.VertexAttachment);t.BoundingBoxAttachment=e}(vut||(vut={})),function(t){var e=function(e){function n(n){var i=e.call(this,n)||this;return i.color=new t.Color(.2275,.2275,.8078,1),i}return yut(n,e),n.prototype.copy=function(){var t=new n(name);return this.copyTo(t),t.endSlot=this.endSlot,t.color.setFromColor(this.color),t},n}(t.VertexAttachment);t.ClippingAttachment=e}(vut||(vut={})),function(t){var e=function(e){function n(n){var i=e.call(this,n)||this;return i.color=new t.Color(1,1,1,1),i.tempColor=new t.Color(0,0,0,0),i}return yut(n,e),n.prototype.updateUVs=function(){var e=this.regionUVs;null!=this.uvs&&this.uvs.length==e.length||(this.uvs=t.Utils.newFloatArray(e.length));var n=this.uvs,i=this.uvs.length,r=this.region.u,a=this.region.v,o=0,s=0;if(this.region instanceof t.TextureAtlasRegion){var c=this.region,l=c.texture.getImage().width,u=c.texture.getImage().height;switch(c.degrees){case 90:r-=(c.originalHeight-c.offsetY-c.height)/l,a-=(c.originalWidth-c.offsetX-c.width)/u,o=c.originalHeight/l,s=c.originalWidth/u;for(var h=0;h<i;h+=2)n[h]=r+e[h+1]*o,n[h+1]=a+(1-e[h])*s;return;case 180:for(r-=(c.originalWidth-c.offsetX-c.width)/l,a-=c.offsetY/u,o=c.originalWidth/l,s=c.originalHeight/u,h=0;h<i;h+=2)n[h]=r+(1-e[h])*o,n[h+1]=a+(1-e[h+1])*s;return;case 270:for(r-=c.offsetY/l,a-=c.offsetX/u,o=c.originalHeight/l,s=c.originalWidth/u,h=0;h<i;h+=2)n[h]=r+(1-e[h+1])*o,n[h+1]=a+e[h]*s;return}r-=c.offsetX/l,a-=(c.originalHeight-c.offsetY-c.height)/u,o=c.originalWidth/l,s=c.originalHeight/u}else null==this.region?(r=a=0,o=s=1):(o=this.region.u2-r,s=this.region.v2-a);for(h=0;h<i;h+=2)n[h]=r+e[h]*o,n[h+1]=a+e[h+1]*s},n.prototype.getParentMesh=function(){return this.parentMesh},n.prototype.setParentMesh=function(t){this.parentMesh=t,null!=t&&(this.bones=t.bones,this.vertices=t.vertices,this.worldVerticesLength=t.worldVerticesLength,this.regionUVs=t.regionUVs,this.triangles=t.triangles,this.hullLength=t.hullLength,this.worldVerticesLength=t.worldVerticesLength)},n.prototype.copy=function(){if(null!=this.parentMesh)return this.newLinkedMesh();var e=new n(this.name);return e.region=this.region,e.path=this.path,e.color.setFromColor(this.color),this.copyTo(e),e.regionUVs=new Array(this.regionUVs.length),t.Utils.arrayCopy(this.regionUVs,0,e.regionUVs,0,this.regionUVs.length),e.uvs=new Array(this.uvs.length),t.Utils.arrayCopy(this.uvs,0,e.uvs,0,this.uvs.length),e.triangles=new Array(this.triangles.length),t.Utils.arrayCopy(this.triangles,0,e.triangles,0,this.triangles.length),e.hullLength=this.hullLength,null!=this.edges&&(e.edges=new Array(this.edges.length),t.Utils.arrayCopy(this.edges,0,e.edges,0,this.edges.length)),e.width=this.width,e.height=this.height,e},n.prototype.newLinkedMesh=function(){var t=new n(this.name);return t.region=this.region,t.path=this.path,t.color.setFromColor(this.color),t.deformAttachment=this.deformAttachment,t.setParentMesh(null!=this.parentMesh?this.parentMesh:this),t.updateUVs(),t},n}(t.VertexAttachment);t.MeshAttachment=e}(vut||(vut={})),function(t){var e=function(e){function n(n){var i=e.call(this,n)||this;return i.closed=!1,i.constantSpeed=!1,i.color=new t.Color(1,1,1,1),i}return yut(n,e),n.prototype.copy=function(){var e=new n(name);return this.copyTo(e),e.lengths=new Array(this.lengths.length),t.Utils.arrayCopy(this.lengths,0,e.lengths,0,this.lengths.length),e.closed=closed,e.constantSpeed=this.constantSpeed,e.color.setFromColor(this.color),e},n}(t.VertexAttachment);t.PathAttachment=e}(vut||(vut={})),function(t){var e=function(e){function n(n){var i=e.call(this,n)||this;return i.color=new t.Color(.38,.94,0,1),i}return yut(n,e),n.prototype.computeWorldPosition=function(t,e){return e.x=this.x*t.a+this.y*t.b+t.worldX,e.y=this.x*t.c+this.y*t.d+t.worldY,e},n.prototype.computeWorldRotation=function(e){var n=t.MathUtils.cosDeg(this.rotation),i=t.MathUtils.sinDeg(this.rotation),r=n*e.a+i*e.b,a=n*e.c+i*e.d;return Math.atan2(a,r)*t.MathUtils.radDeg},n.prototype.copy=function(){var t=new n(name);return t.x=this.x,t.y=this.y,t.rotation=this.rotation,t.color.setFromColor(this.color),t},n}(t.VertexAttachment);t.PointAttachment=e}(vut||(vut={})),function(t){var e=function(e){function n(n){var i=e.call(this,n)||this;return i.x=0,i.y=0,i.scaleX=1,i.scaleY=1,i.rotation=0,i.width=0,i.height=0,i.color=new t.Color(1,1,1,1),i.offset=t.Utils.newFloatArray(8),i.uvs=t.Utils.newFloatArray(8),i.tempColor=new t.Color(1,1,1,1),i}return yut(n,e),n.prototype.updateOffset=function(){var t=this.width/this.region.originalWidth*this.scaleX,e=this.height/this.region.originalHeight*this.scaleY,i=-this.width/2*this.scaleX+this.region.offsetX*t,r=-this.height/2*this.scaleY+this.region.offsetY*e,a=i+this.region.width*t,o=r+this.region.height*e,s=this.rotation*Math.PI/180,c=Math.cos(s),l=Math.sin(s),u=i*c+this.x,h=i*l,f=r*c+this.y,_=r*l,p=a*c+this.x,d=a*l,m=o*c+this.y,g=o*l,v=this.offset;v[n.OX1]=u-_,v[n.OY1]=f+h,v[n.OX2]=u-g,v[n.OY2]=m+h,v[n.OX3]=p-g,v[n.OY3]=m+d,v[n.OX4]=p-_,v[n.OY4]=f+d},n.prototype.setRegion=function(t){this.region=t;var e=this.uvs;t.rotate?(e[2]=t.u,e[3]=t.v2,e[4]=t.u,e[5]=t.v,e[6]=t.u2,e[7]=t.v,e[0]=t.u2,e[1]=t.v2):(e[0]=t.u,e[1]=t.v2,e[2]=t.u,e[3]=t.v,e[4]=t.u2,e[5]=t.v,e[6]=t.u2,e[7]=t.v2)},n.prototype.computeWorldVertices=function(t,e,i,r){var a=this.offset,o=t.worldX,s=t.worldY,c=t.a,l=t.b,u=t.c,h=t.d,f=0,_=0;f=a[n.OX1],_=a[n.OY1],e[i]=f*c+_*l+o,e[i+1]=f*u+_*h+s,i+=r,f=a[n.OX2],_=a[n.OY2],e[i]=f*c+_*l+o,e[i+1]=f*u+_*h+s,i+=r,f=a[n.OX3],_=a[n.OY3],e[i]=f*c+_*l+o,e[i+1]=f*u+_*h+s,i+=r,f=a[n.OX4],_=a[n.OY4],e[i]=f*c+_*l+o,e[i+1]=f*u+_*h+s},n.prototype.copy=function(){var e=new n(name);return e.region=this.region,e.rendererObject=this.rendererObject,e.path=this.path,e.x=this.x,e.y=this.y,e.scaleX=this.scaleX,e.scaleY=this.scaleY,e.rotation=this.rotation,e.width=this.width,e.height=this.height,t.Utils.arrayCopy(this.uvs,0,e.uvs,0,8),t.Utils.arrayCopy(this.offset,0,e.offset,0,8),e.color.setFromColor(this.color),e},n.OX1=0,n.OY1=1,n.OX2=2,n.OY2=3,n.OX3=4,n.OY3=5,n.OX4=6,n.OY4=7,n.X1=0,n.Y1=1,n.C1R=2,n.C1G=3,n.C1B=4,n.C1A=5,n.U1=6,n.V1=7,n.X2=8,n.Y2=9,n.C2R=10,n.C2G=11,n.C2B=12,n.C2A=13,n.U2=14,n.V2=15,n.X3=16,n.Y3=17,n.C3R=18,n.C3G=19,n.C3B=20,n.C3A=21,n.U3=22,n.V3=23,n.X4=24,n.Y4=25,n.C4R=26,n.C4G=27,n.C4B=28,n.C4A=29,n.U4=30,n.V4=31,n}(t.Attachment);t.RegionAttachment=e}(vut||(vut={})),function(t){var e=function(){function e(t,e){this.jitterX=0,this.jitterY=0,this.jitterX=t,this.jitterY=e}return e.prototype.begin=function(){},e.prototype.transform=function(e){e.x+=t.MathUtils.randomTriangular(-this.jitterX,this.jitterY),e.y+=t.MathUtils.randomTriangular(-this.jitterX,this.jitterY)},e.prototype.end=function(){},e}();t.JitterEffect=e}(vut||(vut={})),function(t){var e=function(){function e(t,e){this.centerX=0,this.centerY=0,this.radius=0,this.angle=0,this.worldX=0,this.worldY=0,this.radius=t,this.interpolation=e}return e.prototype.begin=function(t){this.worldX=t.x+this.centerX,this.worldY=t.y+this.centerY},e.prototype.transform=function(e){var n=this.angle*t.MathUtils.degreesToRadians,i=e.x-this.worldX,r=e.y-this.worldY,a=Math.sqrt(i*i+r*r);if(a<this.radius){var o=this.interpolation.apply(0,n,(this.radius-a)/this.radius),s=Math.cos(o),c=Math.sin(o);e.x=s*i-c*r+this.worldX,e.y=c*i+s*r+this.worldY}},e.prototype.end=function(){},e.interpolation=new t.PowOut(2),e}();t.SwirlEffect=e}(vut||(vut={}));var xut,Sut,Tut,Aut,Eut,Cut,but=vut,wut=function(){function t(){this.start=void 0,this.interrupt=void 0,this.end=void 0,this.dispose=void 0,this.complete=void 0,this.event=void 0}return t.getListeners=function(e){return e.listener||(e.listener=new t),e.listener},t}(),Put=1/60,Iut=[],Rut=[],Dut=0,Out=0,Mut=0,Nut=null,Lut=null,But=0,Fut=0,zut=0,Uut=0,kut=null,Gut=null,Hut=0,Vut=0,jut=new but.Color(1,1,1,1),Wut=new but.Color(1,1,1,1),Xut=[0,1,2,2,3,0],qut=function(){function t(){this.frames=[],this.totalTime=0,this.isCompleted=!1,this.maxVertexCount=0,this.maxIndexCount=0,this._privateMode=!1,this._inited=!1,this._invalid=!0,this._enableCacheAttachedInfo=!1,this._frameIdx=-1,this._skeletonInfo=null,this._animationName=null,this._tempSegments=null,this._tempColors=null,this._tempBoneInfos=null,this._privateMode=!1,this._inited=!1,this._invalid=!0,this._enableCacheAttachedInfo=!1,this.frames=[],this.totalTime=0,this._frameIdx=-1,this.isCompleted=!1,this._skeletonInfo=null,this._animationName=null,this._tempSegments=null,this._tempColors=null,this._tempBoneInfos=null}var e=t.prototype;return e.init=function(t,e){this._inited=!0,this._animationName=e,this._skeletonInfo=t},e.clear=function(){this._inited=!1;for(var t=0,e=this.frames.length;t<e;t++)this.frames[t].segments.length=0;this.invalidAllFrame()},e.bind=function(t){var e=this;t.complete=function(t){t&&t.animation.name===e._animationName&&(e.isCompleted=!0)}},e.unbind=function(t){t.complete=null},e.begin=function(){if(this._invalid){var t=this._skeletonInfo,e=null==t?void 0:t.curAnimationCache;e&&e!==this&&(this._privateMode?e.invalidAllFrame():e.updateToFrame());var n=null==t?void 0:t.skeleton,i=null==t?void 0:t.listener,r=null==t?void 0:t.state,a=null==n?void 0:n.data.findAnimation(this._animationName);null==r||r.setAnimationWith(0,a,!1),this.bind(i),t.curAnimationCache=this,this._frameIdx=-1,this.isCompleted=!1,this.totalTime=0,this._invalid=!1}},e.end=function(){this.needToUpdate()||(this._skeletonInfo.curAnimationCache=null,this.frames.length=this._frameIdx+1,this.isCompleted=!0,this.unbind(this._skeletonInfo.listener))},e.updateToFrame=function(t){if(this._inited&&(this.begin(),this.needToUpdate(t))){var e=this._skeletonInfo,n=null==e?void 0:e.skeleton,i=null==e?void 0:e.clipper,r=null==e?void 0:e.state;do{null==n||n.update(Put),null==r||r.update(Put),null==r||r.apply(n),null==n||n.updateWorldTransform(),this._frameIdx++,this.updateFrame(n,i,this._frameIdx),this.totalTime+=Put}while(this.needToUpdate(t));this.end()}},e.isInited=function(){return this._inited},e.isInvalid=function(){return this._invalid},e.invalidAllFrame=function(){this.isCompleted=!1,this._invalid=!0},e.updateAllFrame=function(){this.invalidAllFrame(),this.updateToFrame()},e.enableCacheAttachedInfo=function(){this._enableCacheAttachedInfo||(this._enableCacheAttachedInfo=!0,this.invalidAllFrame())},e.fillVertices=function(t,e,n,i,r){if(Aut=n.a*e.a*t.a*255,xut=e.r*t.r*255,Sut=e.g*t.g*255,Tut=e.b*t.b*255,jut.r=xut*n.r,jut.g=Sut*n.g,jut.b=Tut*n.b,jut.a=Aut,null==r.darkColor?Wut.set(0,0,0,1):(Wut.r=r.darkColor.r*xut,Wut.g=r.darkColor.g*Sut,Wut.b=r.darkColor.b*Tut),Wut.a=0,Eut=(jut.a<<24>>>0)+(jut.b<<16)+(jut.g<<8)+jut.r,Cut=(Wut.a<<24>>>0)+(Wut.b<<16)+(Wut.g<<8)+Wut.r,kut!==Eut||Gut!==Cut){var a=this._tempColors;kut=Eut,Gut=Cut,Uut>0&&(a[Uut-1].vfOffset=Mut),a[Uut++]={fr:jut.r,fg:jut.g,fb:jut.b,fa:jut.a,dr:Wut.r,dg:Wut.g,db:Wut.b,da:Wut.a,vfOffset:0}}if(i.isClipping()){i.clipTriangles(Iut,Hut,Rut,Vut,Iut,jut,Wut,!0,6,Mut,Mut+2);var o=i.clippedVertices,s=i.clippedTriangles;Vut=s.length,Hut=o.length/12*6;for(var c=0,l=Out,u=s.length;c<u;)Rut[l++]=s[c++];for(var h=0,f=o.length,_=Mut;h<f;h+=12,_+=6)Iut[_]=o[h],Iut[_+1]=o[h+1],Iut[_+2]=o[h+6],Iut[_+3]=o[h+7],Iut[_+4]=Eut,Iut[_+5]=Cut}else for(var p=Mut,d=Mut+Hut;p<d;p+=6)Iut[p+4]=Eut,Iut[p+5]=Cut},e.updateFrame=function(t,e,n){Mut=0,Dut=0,Out=0,Nut=null,Lut=null,But=0,Fut=0,zut=0,Uut=0,kut=null,Gut=null,this.frames[n]=this.frames[n]||{segments:[],colors:[],boneInfos:[],vertices:null,uintVert:null,indices:null};var i=this.frames[n],r=this._tempSegments=i.segments,a=this._tempColors=i.colors,o=this._tempBoneInfos=i.boneInfos;this.traverseSkeleton(t,e),Uut>0&&(a[Uut-1].vfOffset=Mut),a.length=Uut,o.length=Dut;var s=zut-1;if(s>=0)if(Fut>0){var c=r[s];c.indexCount=Fut,c.vfCount=13*But,c.vertexCount=But,r.length=zut}else r.length=zut-1;if(0!==r.length){var l=i.vertices,u=Mut/6,h=13*u;(!l||l.length<h)&&(l=i.vertices=new Float32Array(h));for(var f=0,_=0;f<h;)l[f]=Iut[_++],l[f+1]=Iut[_++],l[f+3]=Iut[_++],l[f+4]=Iut[_++],this._setVerticeColor(Iut[_++],l,f+5),this._setVerticeColor(Iut[_++],l,f+9),f+=13;var p=i.indices;(!p||p.length<Out)&&(p=i.indices=new Uint16Array(Out));for(var d=0;d<Out;d++)p[d]=Rut[d];i.vertices=l,i.indices=p,this.maxVertexCount=u>this.maxVertexCount?u:this.maxVertexCount,this.maxIndexCount=p.length>this.maxIndexCount?p.length:this.maxIndexCount}},e.needToUpdate=function(t){return!this.isCompleted&&this.totalTime<30&&(void 0===t||this._frameIdx<t)},e.traverseSkeleton=function(t,e){var n,i,r,a,o,s,c,l,u,h,f,_,p=this._tempSegments,d=this._tempBoneInfos,m=t.color,g=t.bones;if(this._enableCacheAttachedInfo)for(var v=0,y=g.length;v<y;v++,Dut++){var x=g[v],S=d[Dut];S||(S=d[Dut]={}),S.a=x.a,S.b=x.b,S.c=x.c,S.d=x.d,S.worldX=x.worldX,S.worldY=x.worldY}for(var T=0,A=t.drawOrder.length;T<A;T++)if(_=t.drawOrder[T],Hut=0,Vut=0,n=_.getAttachment())if(s=n instanceof but.RegionAttachment,c=n instanceof but.MeshAttachment,n instanceof but.ClippingAttachment)e.clipStart(_,n);else if(s||c)if(l=n.region.texture.getRealTexture()){if(f=_.data.blendMode,Nut===l.getId()&&Lut===f||(Nut=l.getId(),Lut=f,(u=zut-1)>=0&&(Fut>0?((h=p[u]).indexCount=Fut,h.vertexCount=But,h.vfCount=13*But):zut--),p[zut]={tex:l,blendMode:f,indexCount:0,vertexCount:0,vfCount:0},zut++,Fut=0,But=0),s)o=Xut,Hut=24,Vut=6,n.computeWorldVertices(_.bone,Iut,Mut,6);else if(c){var E=n;o=E.triangles,Hut=6*(E.worldVerticesLength>>1),Vut=o.length,E.computeWorldVertices(_,0,E.worldVerticesLength,Iut,Mut,6)}if(0!==Hut&&0!==Vut){for(var C=0,b=Out,w=o.length;C<w;)Rut[b++]=o[C++];a=n.uvs;for(var P=Mut,I=Mut+Hut,R=0;P<I;P+=6,R+=2)Iut[P+2]=a[R],Iut[P+3]=a[R+1];if(i=n.color,r=_.color,this.fillVertices(m,i,r,e,_),Vut>0){for(var D=Out,O=Out+Vut;D<O;D++)Rut[D]+=But;Out+=Vut,Mut+=Hut,Fut+=Vut,But+=Hut/6}e.clipEndWithSlot(_)}else e.clipEndWithSlot(_)}else e.clipEndWithSlot(_);else e.clipEndWithSlot(_);else e.clipEndWithSlot(_);e.clipEnd()},e._setVerticeColor=function(t,e,n){e[n]=(255&t)/255,e[n+1]=(t>>8&255)/255,e[n+2]=(t>>16&255)/255,e[n+3]=(t>>24&255)/255},t}(),Yut=function(){function t(){this._privateMode=void 0,this._skeletonCache=void 0,this._animationPool=void 0,this._privateMode=!1,this._animationPool={},this._skeletonCache={}}var e=t.prototype;return e.enablePrivateMode=function(){this._privateMode=!0},e.clear=function(){this._animationPool={},this._skeletonCache={}},e.removeSkeleton=function(t){var e=this._skeletonCache[t];if(e){var n=e.animationsCache;for(var i in n){var r=n[i];r&&(this._animationPool[t+"#"+i]=r,r.clear())}delete this._skeletonCache[t]}},e.getSkeletonCache=function(t,e){var n=this._skeletonCache[t];if(!n){var i=new but.Skeleton(e),r=new but.SkeletonClipping,a=new but.AnimationStateData(i.data),o=new but.AnimationState(a),s=new wut;o.addListener(s),this._skeletonCache[t]=n={skeleton:i,clipper:r,state:o,listener:s,animationsCache:{},curAnimationCache:null}}return n},e.getAnimationCache=function(t,e){var n=this._skeletonCache[t];return n?n.animationsCache[e]:null},e.invalidAnimationCache=function(t){var e=this._skeletonCache[t];if(e&&e.skeleton){var n=e.animationsCache;for(var i in n)n[i].invalidAllFrame()}},e.initAnimationCache=function(t,e){if(!e)return null;var n=this._skeletonCache[t],i=n&&n.skeleton;if(!i)return null;if(!i.data.findAnimation(e))return null;var r=n.animationsCache,a=r[e];if(!a){var o=t+"#"+e;(a=this._animationPool[o])?delete this._animationPool[o]:(a=new qut)._privateMode=this._privateMode,a.init(n,e),r[e]=a}return a},e.updateAnimationCache=function(t,e){if(e){var n=this.initAnimationCache(t,e);if(!n)return;n.updateAllFrame()}else{var i=this._skeletonCache[t];if(!i||!i.skeleton)return;var r=i.animationsCache;for(var a in r)r[a].updateAllFrame()}},t}();Yut.FrameTime=Put,Yut.sharedCache=new Yut;var Kut,Qut,Zut,Jut,$ut,tht,eht,nht,iht,rht,aht,oht=new Ri,sht=new di,cht=function(){function t(){this._inited=!1,this._skeleton=null,this._skeletonNode=null,this._skeletonComp=null,this._inited=!1,this._skeleton=null,this._skeletonNode=null,this._skeletonComp=null}var e=t.prototype;return e.init=function(t){this._inited=!0,this._skeleton=t._skeleton,this._skeletonNode=t.node,this._skeletonComp=t},e.reset=function(){this._inited=!1,this._skeleton=null,this._skeletonNode=null,this._skeletonComp=null},e._syncAttachedNode=function(){if(this._inited){var t=this._skeletonComp.socketNodes;if(0!==t.size){var e;if(e=this._skeletonComp.isAnimationCached()?this._skeletonComp._curFrame&&this._skeletonComp._curFrame.boneInfos:this._skeleton.bones)for(var n,i=function(t,e){sht.set(t.scale);var n=oht;n.m00=e.a,n.m01=e.c,n.m04=e.b,n.m05=e.d,n.m12=e.worldX,n.m13=e.worldY,t.matrix=oht,t.scale=sht},r=W(t.keys());!(n=r()).done;){var a=n.value,o=t.get(a);if(o&&o.isValid){var s=e[a];s?i(o,s):(o.removeFromParent(),o.destroy(),t.delete(a))}else t.delete(a)}}}},t}(),lht=function(t){function e(e){var n;return(n=t.call(this,e)||this).name="sp.SkeletonTexture",n._texture=null,n._material=null,n}F(e,t);var n=e.prototype;return n.setRealTexture=function(t){this._texture=t},n.getRealTexture=function(){return this._texture},n.setFilters=function(t,e){this._texture&&this.getRealTexture().setFilters(uht(t),uht(e))},n.setWraps=function(t,e){this._texture&&this.getRealTexture().setWrapMode(hht(t),hht(e))},n.dispose=function(){},e}(but.Texture);function uht(t){switch(t){case but.TextureFilter.Nearest:case but.TextureFilter.MipMapNearestNearest:case but.TextureFilter.MipMapLinearNearest:return im.NEAREST;case but.TextureFilter.MipMap:case but.TextureFilter.MipMapNearestLinear:case but.TextureFilter.MipMapLinearLinear:case but.TextureFilter.Linear:default:return im.LINEAR}}function hht(t){switch(t){case but.TextureWrap.MirroredRepeat:return nm.MIRRORED_REPEAT;case but.TextureWrap.ClampToEdge:return nm.CLAMP_TO_EDGE;case but.TextureWrap.Repeat:default:return nm.REPEAT}}var fht=(Kut=nl("sp.SkeletonData"),Qut=Bl([ng]),Zut=Bl([Ee]),Kut((aht=function(t){function e(){var e;return X(e=t.call(this)||this,"_skeletonJson",tht,V(e)),X(e,"textures",eht,V(e)),X(e,"textureNames",nht,V(e)),X(e,"scale",iht,V(e)),X(e,"_atlasText",rht,V(e)),e._buffer=void 0,e._skeletonCache=null,e._atlasCache=null,e._skinsEnum=null,e._animsEnum=null,e.reset(),e}F(e,t);var n=e.prototype;return n.createNode=function(t){var e=new qC(this.name);return e.addComponent("cc.Skeleton").skeletonData=this,t(null,e)},n.reset=function(){this._skeletonCache=null,this._atlasCache=null},n.resetEnums=function(){},n.getRuntimeData=function(t){if(this._skeletonCache)return this._skeletonCache;if(!(this.textures&&this.textures.length>0)&&this.textureNames&&this.textureNames.length>0)return t||console.error(this.name+" no textures found!"),null;var e=this._getAtlas(t);if(!e)return null;var n=new but.AtlasAttachmentLoader(e),i=null,r=null;return this.skeletonJson?(r=new but.SkeletonJson(n),i=this.skeletonJson):(r=new but.SkeletonBinary(n),i=new Uint8Array(this._nativeAsset)),r.scale=this.scale,this._skeletonCache=r.readSkeletonData(i),e.dispose(),this._skeletonCache},n.getSkinsEnum=function(){if(this._skinsEnum)return this._skinsEnum;var t=this.getRuntimeData(!0);if(t){for(var e=t.skins,n={},i=0;i<e.length;i++)n[e[i].name]=i;return this._skinsEnum=Yt(n)}return null},n.getAnimsEnum=function(){if(this._animsEnum&&Object.keys(this._animsEnum).length>1)return this._animsEnum;var t=this.getRuntimeData(!0);if(t){for(var e={"<None>":0},n=t.animations,i=0;i<n.length;i++)e[n[i].name]=i+1;return this._animsEnum=Yt(e)}return null},n.destroy=function(){return Yut.sharedCache.removeSkeleton(this._uuid),t.prototype.destroy.call(this)},n._getTexture=function(t){for(var e=this.textureNames,n=0;n<e.length;n++)if(e[n]===t){var i=this.textures[n],r=new lht({width:i.width,height:i.height});return r.setRealTexture(i),r}return console.error(this.name+" no textures found!"),null},n._getAtlas=function(t){return this._atlasCache?this._atlasCache:this.atlasText?this._atlasCache=new but.TextureAtlas(this.atlasText,this._getTexture.bind(this)):(t||console.error(this.name+" no atlas found!"),null)},L(e,[{key:"skeletonJsonStr",get:function(){return this._skeletonJson?JSON.stringify(this._skeletonJson):""}},{key:"skeletonJson",get:function(){return this._skeletonJson},set:function(t){this.reset(),this._skeletonJson="string"==typeof t?JSON.parse(t):t,!this._uuid&&t.skeleton&&(this._uuid=t.skeleton.hash)}},{key:"atlasText",get:function(){return this._atlasText},set:function(t){this._atlasText=t,this.reset()}},{key:"_nativeAsset",get:function(){return this._buffer},set:function(t){this._buffer=t,this.reset()}}]),e}(Ou),tht=q(($ut=aht).prototype,"_skeletonJson",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),eht=q($ut.prototype,"textures",[cl,Qut],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),nht=q($ut.prototype,"textureNames",[cl,Zut],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),iht=q($ut.prototype,"scale",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),rht=q($ut.prototype,"_atlasText",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Jut=$ut))||Jut);i.internal.SpineSkeletonData=fht;var _ht,pht,dht,mht,ght,vht,yht,xht,Sht,Tht,Aht,Eht,Cht,bht,wht,Pht,Iht,Rht,Dht,Oht,Mht,Nht,Lht,Bht,Fht,zht,Uht,kht,Ght,Hht,Vht,jht,Wht,Xht,qht,Yht,Kht,Qht,Zht,Jht,$ht,tft,eft,nft,ift,rft,aft,oft,sft,cft,lft,uft,hft,fft,_ft,pft=function(t){function e(){var e;return(e=t.call(this)||this)._skeletons=new Set,e}F(e,t),e.getInstance=function(){return e._instance||(e._instance=new e,WM.registerSystem(e.ID,e._instance,DM.Priority.HIGH)),e._instance};var n=e.prototype;return n.add=function(t){t&&(this._skeletons.has(t)||this._skeletons.add(t))},n.remove=function(t){t&&this._skeletons.has(t)&&this._skeletons.delete(t)},n.postUpdate=function(t){this._skeletons&&this._skeletons.forEach((function(e){e.updateAnimation(t)}))},e}(DM);function dft(t,e,n){Ge.Attr.setClassAttr(t,e,"type","Enum"),Ge.Attr.setClassAttr(t,e,"enumList",Yt.getList(n))}pft.ID="SKELETON",pft._instance=void 0,function(t){t[t.default=0]="default"}(uft||(uft={})),Zt(uft),function(t){t[t["<None>"]=0]="<None>"}(hft||(hft={})),Zt(hft),function(t){t[t.REALTIME=0]="REALTIME",t[t.SHARED_CACHE=1]="SHARED_CACHE",t[t.PRIVATE_CACHE=2]="PRIVATE_CACHE"}(fft||(fft={})),Zt(fft),function(t){t[t.COLORED_TEXTURED=0]="COLORED_TEXTURED",t[t.TWO_COLORED=1]="TWO_COLORED"}(_ft||(_ft={}));var mft=(_ht=nl("sp.Skeleton.SpineSocket"),pht=Bl(qC),_ht((ght=q((mht=function(t,e){void 0===t&&(t=""),void 0===e&&(e=null),X(this,"path",ght,this),X(this,"target",vht,this),this.path=t,this.target=e}).prototype,"path",[cl,yl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),vht=q(mht.prototype,"target",[pht,yl,cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),dht=mht))||dht);Gt.setClassAlias(mft,"sp.Skeleton.SpineSocket");var gft=(yht=nl("sp.Skeleton"),xht=vl(),Sht=pl(),Tht=Bl(bv),Aht=Il(),Eht=Tl(),Cht=Bl(fht),bht=Tl(),wht=Bl(uft),Pht=Al(),Iht=Tl(),Rht=Bl(hft),Dht=Al(),Oht=Tl(),Mht=Al(),Nht=Bl(fft),Lht=Al(),Bht=Al(),Fht=Al(),zht=Al(),Uht=Al(),kht=Al(),Ght=Al(),Hht=Bl([mft]),Vht=Al(),jht=xl(),Wht=xl(),yht(Xht=xht(Xht=Sht(Xht=_l((lft=cft=function(t){function e(){var e;return X(e=t.call(this)||this,"loop",Yht,V(e)),e.enableBatch=!1,e._frameCache=null,e._curFrame=null,e._effectDelegate=null,e._skeleton=void 0,e._clipper=void 0,e._debugRenderer=void 0,e._startSlotIndex=void 0,e._endSlotIndex=void 0,e._startEntry=void 0,e._endEntry=void 0,e.attachUtil=void 0,e.maxVertexCount=0,e.maxIndexCount=0,e._materialCache={},e._enumSkins=Yt({}),e._enumAnimations=Yt({}),e._playTimes=0,X(e,"_timeScale",Kht,V(e)),e._paused=!1,e._accTime=0,e._playCount=0,e._skeletonCache=null,e._animationName="",e._animationQueue=[],e._headAniInfo=null,e._isAniComplete=!0,X(e,"_useTint",Qht,V(e)),X(e,"_preCacheMode",Zht,V(e)),X(e,"_cacheMode",Jht,V(e)),X(e,"_defaultCacheMode",$ht,V(e)),X(e,"_debugBones",tft,V(e)),X(e,"_debugSlots",eft,V(e)),X(e,"_skeletonData",nft,V(e)),X(e,"_premultipliedAlpha",ift,V(e)),X(e,"defaultSkin",rft,V(e)),X(e,"defaultAnimation",aft,V(e)),X(e,"_sockets",oft,V(e)),e._drawIdx=0,e._drawList=new Wt((function(){return{material:null,texture:null,indexOffset:0,indexCount:0}}),1),X(e,"_debugMesh",sft,V(e)),e._rootBone=void 0,e._state=void 0,e._listener=void 0,e._socketNodes=new Map,e._cachedSockets=new Map,e._effectDelegate=null,e._skeleton=null,e._rootBone=null,e._listener=null,e._debugRenderer=null,e._startSlotIndex=-1,e._endSlotIndex=-1,e._startEntry={animation:{name:""},trackIndex:0},e._endEntry={animation:{name:""},trackIndex:0},e.attachUtil=new cht,dft(V(e),"_defaultSkinIndex",e._enumSkins),dft(V(e),"_animationIndex",e._enumAnimations),e}F(e,t);var n=e.prototype;return n.setSkeletonData=function(t){var e=this.node._uiProps.uiTransformComp;if(null!=t.width&&null!=t.height&&e.setContentSize(t.width,t.height),this._cacheMode===fft.SHARED_CACHE?this._skeletonCache=Yut.sharedCache:this._cacheMode===fft.PRIVATE_CACHE&&(this._skeletonCache=new Yut,this._skeletonCache.enablePrivateMode()),this.isAnimationCached()){(this.debugBones||this.debugSlots)&&p("Debug bones or slots is invalid in cached mode");var n=this._skeletonCache.getSkeletonCache(this.skeletonData._uuid,t);this._skeleton=n.skeleton,this._clipper=n.clipper,this._rootBone=this._skeleton.getRootBone()}else this._skeleton=new but.Skeleton(t),this._clipper=new but.SkeletonClipping,this._rootBone=this._skeleton.getRootBone();this._flushAssembler()},n.setSlotsRange=function(t,e){this.isAnimationCached()?p("Slots visible range can not be modified in cached mode."):(this._startSlotIndex=t,this._endSlotIndex=e)},n.setAnimationStateData=function(t){if(this.isAnimationCached())p("'setAnimationStateData' interface can not be invoked in cached mode.");else{var e=new but.AnimationState(t);this._listener&&(this._state&&this._state.removeListener(this._listener),e.addListener(this._listener)),this._state=e}},n.__preload=function(){t.prototype.__preload.call(this);for(var e=this.node.children,n=0,i=e.length;n<i;n++){var r=e[n];r&&"DEBUG_DRAW_NODE"===r.name&&r.destroy()}this._updateSkeletonData(),this._updateDebugDraw(),this._updateUseTint(),this._indexBoneSockets(),this._updateSocketBindings()},n.setAnimationCacheMode=function(t){this._preCacheMode!==t&&(this._cacheMode=t,this._updateSkeletonData(),this._updateUseTint(),this._updateSocketBindings(),this.markForUpdateRenderData())},n.isAnimationCached=function(){return this._cacheMode!==fft.REALTIME},n.updateAnimation=function(t){if(!this.paused)if(t*=1*this._timeScale,this.isAnimationCached()){if(this._isAniComplete){if(0===this._animationQueue.length&&!this._headAniInfo){var e=this._frameCache;if(e&&e.isInvalid()){e.updateToFrame();var n=e.frames;this._curFrame=n[n.length-1]}return}if(this._headAniInfo||(this._headAniInfo=this._animationQueue.shift()),this._accTime+=t,this._accTime>this._headAniInfo.delay){var i=this._headAniInfo;this._headAniInfo=null,this.setAnimation(0,i.animationName,i.loop)}return}this._updateCache(t)}else this._updateRealtime(t)},n.setVertexEffectDelegate=function(t){this._effectDelegate=t},n.setToSetupPose=function(){this._skeleton&&this._skeleton.setToSetupPose()},n.setBonesToSetupPose=function(){this._skeleton&&this._skeleton.setBonesToSetupPose()},n.setSlotsToSetupPose=function(){this._skeleton&&this._skeleton.setSlotsToSetupPose()},n.updateAnimationCache=function(t){if(this.isAnimationCached()){var e=this._skeletonData._uuid;this._skeletonCache&&this._skeletonCache.updateAnimationCache(e,t)}},n.invalidAnimationCache=function(){this.isAnimationCached()&&this._skeletonCache&&this._skeletonCache.invalidAnimationCache(this._skeletonData._uuid)},n.findBone=function(t){return this._skeleton?this._skeleton.findBone(t):null},n.findSlot=function(t){return this._skeleton?this._skeleton.findSlot(t):null},n.setSkin=function(t){this._skeleton&&(this._skeleton.setSkinByName(t),this._skeleton.setSlotsToSetupPose()),this.invalidAnimationCache()},n.getAttachment=function(t,e){return this._skeleton?this._skeleton.getAttachmentByName(t,e):null},n.setAttachment=function(t,e){this._skeleton&&this._skeleton.setAttachment(t,e),this.invalidAnimationCache()},n.getTextureAtlas=function(t){return t.region},n.setMix=function(t,e,n){this._state&&this._state.data.setMix(t,e,n)},n.setAnimation=function(t,e,n){if(this._playTimes=n?0:1,this._animationName=e,this.isAnimationCached()){if(0!==t&&p("Track index can not greater than 0 in cached mode."),!this._skeletonCache)return null;var i=this._skeletonCache.getAnimationCache(this._skeletonData._uuid,e);i||(i=this._skeletonCache.initAnimationCache(this._skeletonData._uuid,e)),i&&(this._isAniComplete=!1,this._accTime=0,this._playCount=0,this._frameCache=i,this._socketNodes.size>0&&this._frameCache.enableCacheAttachedInfo(),this._frameCache.updateToFrame(0),this._curFrame=this._frameCache.frames[0])}else if(this._skeleton){var r=this._skeleton.data.findAnimation(e);if(!r)return T(7509,e),null;var a=this._state.setAnimationWith(t,r,n);return this._state.apply(this._skeleton),a}return null},n.addAnimation=function(t,e,n,i){if(i=i||0,this.isAnimationCached())0!==t&&p("Track index can not greater than 0 in cached mode."),this._animationQueue.push({animationName:e,loop:n,delay:i});else if(this._skeleton){var r,a=this._skeleton.data.findAnimation(e);return a?null===(r=this._state)||void 0===r?void 0:r.addAnimationWith(t,a,n,i):(T(7510,e),null)}return null},n.findAnimation=function(t){return this._skeleton?this._skeleton.data.findAnimation(t):null},n.getCurrent=function(t){if(this.isAnimationCached())p("'getCurrent' interface can not be invoked in cached mode.");else if(this._state)return this._state.getCurrent(t);return null},n.clearTracks=function(){this.isAnimationCached()?p("'clearTracks' interface can not be invoked in cached mode."):this._state&&(this._state.clearTracks(),this.setToSetupPose())},n.clearTrack=function(t){this.isAnimationCached()?p("'clearTrack' interface can not be invoked in cached mode."):this._state&&this._state.clearTrack(t)},n.setStartListener=function(t){this._ensureListener(),this._listener.start=t},n.setInterruptListener=function(t){this._ensureListener(),this._listener.interrupt=t},n.setEndListener=function(t){this._ensureListener(),this._listener.end=t},n.setDisposeListener=function(t){this._ensureListener(),this._listener.dispose=t},n.setCompleteListener=function(t){this._ensureListener(),this._listener.complete=t},n.setEventListener=function(t){this._ensureListener(),this._listener.event=t},n.setTrackStartListener=function(t,e){wut.getListeners(t).start=e},n.setTrackInterruptListener=function(t,e){wut.getListeners(t).interrupt=e},n.setTrackEndListener=function(t,e){wut.getListeners(t).end=e},n.setTrackDisposeListener=function(t,e){wut.getListeners(t).dispose=e},n.setTrackCompleteListener=function(t,e){wut.getListeners(t).complete=function(t){var n=Math.floor(t.trackTime/t.animationEnd);e(t,n)}},n.setTrackEventListener=function(t,e){wut.getListeners(t).event=e},n.getState=function(){return this._state},n.onEnable=function(){t.prototype.onEnable.call(this),this._flushAssembler(),pft.getInstance().add(this)},n.onDisable=function(){t.prototype.onDisable.call(this),pft.getInstance().remove(this)},n.onDestroy=function(){this._cleanMaterialCache(),this._drawList.destroy(),t.prototype.onDestroy.call(this)},n.destroyRenderData=function(){this._drawList.reset(),t.prototype.destroyRenderData.call(this)},n.getMaterialForBlendAndTint=function(t,e,n){var i=n+"/"+t+"/"+e,r=this._materialCache[i];if(r)return r;var a=this.customMaterial;null===a&&(a=Lg.get("default-spine-material"));var o=!1;switch(n){case _ft.TWO_COLORED:o=!0;break;case _ft.COLORED_TEXTURED:}return r=new Hv({parent:a,subModelIdx:0,owner:this}),this._materialCache[i]=r,r.overridePipelineStates({blendState:{blendColor:_i.WHITE,targets:[{blendEq:zr.ADD,blendAlphaEq:zr.ADD,blendSrc:t,blendDst:e,blendSrcAlpha:t,blendDstAlpha:e}]}}),r.recompileShaders({TWO_COLORED:o,USE_LOCAL:!0}),r},n.onRestore=function(){this.updateMaterial(),this._renderFlag=this._canRender(),this.markForUpdateRenderData()},n.updateMaterial=function(){if(this._customMaterial)return this.setMaterial(this._customMaterial,0),void(this._blendHash=-1);var t=this._updateBuiltinMaterial();this.setMaterial(t,0),this._updateBlendFunc(),this._blendHash=-1},n.querySockets=function(){return this._skeleton?(0===this._cachedSockets.size&&this._indexBoneSockets(),this._cachedSockets.size>0?Array.from(this._cachedSockets.keys()).sort():[]):[]},n._requestDrawData=function(t,e,n,i){var r=this._drawList.add();return r.material=t,r.texture=e,r.indexOffset=n,r.indexCount=i,r},n._render=function(t){if(this._renderData&&this._drawList){var e=this._renderData,n=e.chunk,i=n.vertexAccessor,r=e.getMeshBuffer(),a=r.indexOffset;i.appendIndices(n.bufferId,e.indices);for(var o=0;o<this._drawList.length;o++){this._drawIdx=o;var s=this._drawList.data[o];if(s.texture){var c=r.requireFreeIA(t.device);c.firstIndex=a+s.indexOffset,c.indexCount=s.indexCount,t.commitIA(this,c,s.texture,s.material,this.node)}}}},n.updateWorldTransform=function(){this.isAnimationCached()&&this._skeleton&&this._skeleton.updateWorldTransform()},n._emitCacheCompleteEvent=function(){this._listener&&(this._endEntry.animation.name=this._animationName,this._listener.complete&&this._listener.complete(this._endEntry),this._listener.end&&this._listener.end(this._endEntry))},n._updateCache=function(t){var e=this._frameCache;if(e.isInited()){var n=e.frames,i=Yut.FrameTime;0===this._accTime&&0===this._playCount&&(this._startEntry.animation.name=this._animationName,this._listener&&this._listener.start&&this._listener.start(this._startEntry)),this._accTime+=t;var r=Math.floor(this._accTime/i);if(e.isCompleted||(e.updateToFrame(r),this._renderData&&(this._renderData.vertexCount<e.maxVertexCount||this._renderData.indexCount<e.maxIndexCount)&&(this.maxVertexCount=e.maxVertexCount>this.maxVertexCount?e.maxVertexCount:this.maxVertexCount,this.maxIndexCount=e.maxIndexCount>this.maxIndexCount?e.maxIndexCount:this.maxIndexCount,this._renderData.resize(this.maxVertexCount,this.maxIndexCount),(!this._renderData.indices||this.maxIndexCount>this._renderData.indices.length)&&(this._renderData.indices=new Uint16Array(this.maxIndexCount)))),e.isCompleted&&r>=n.length){if(this._playCount++,this._playTimes>0&&this._playCount>=this._playTimes)return this._curFrame=n[n.length-1],this._accTime=0,this._playCount=0,this._isAniComplete=!0,this._emitCacheCompleteEvent(),void this.markForUpdateRenderData();this._accTime=0,r=0,this._emitCacheCompleteEvent()}this._curFrame=n[r],this.markForUpdateRenderData()}},n._updateRealtime=function(t){var e=this._skeleton,n=this._state;e&&(e.update(t),n&&(n.update(t),n.apply(e)),this.markForUpdateRenderData())},n._indexBoneSockets=function(){if(this._skeleton){this._cachedSockets.clear();for(var t=this._skeleton.bones,e=function e(n){return null==n.parent?n.data.name||"<Unamed>":e(t[n.parent.data.index])+"/"+n.data.name},n=0,i=t.length;n<i;n++){var r=t[n].data,a=e(t[n]);this._cachedSockets.set(a,r.index)}}},n._updateUseTint=function(){this._cleanMaterialCache(),this.destroyRenderData(),this._assembler&&this._skeleton&&(this._renderData=this._assembler.createData(this),this.markForUpdateRenderData())},n._updateBatch=function(){this.markForUpdateRenderData()},n._updateAnimEnum=function(){var t;t=this.skeletonData?this.skeletonData.getAnimsEnum():hft,this._enumAnimations=Yt({}),Object.assign(this._enumAnimations,t),Yt.update(this._enumAnimations),dft(this,"_animationIndex",this._enumAnimations)},n._updateSkinEnum=function(){var t;t=this.skeletonData?this.skeletonData.getSkinsEnum():uft,this._enumSkins=Yt({}),Object.assign(this._enumSkins,t),Yt.update(this._enumSkins),dft(this,"_defaultSkinIndex",this._enumSkins)},n._ensureListener=function(){this._listener||(this._listener=new wut,this._state&&this._state.addListener(this._listener))},n._updateSkeletonData=function(){if(this.skeletonData){var t=this.skeletonData.getRuntimeData();if(t){try{this.setSkeletonData(t),this.isAnimationCached()||this.setAnimationStateData(new but.AnimationStateData(this._skeleton.data)),this.defaultSkin&&this.setSkin(this.defaultSkin)}catch(t){p(t)}this._indexBoneSockets(),this.attachUtil.init(this),this._preCacheMode=this._cacheMode,this.animation=this.defaultAnimation}}},n._refreshInspector=function(){this._updateAnimEnum(),this._updateSkinEnum()},n._updateDebugDraw=function(){if(this.debugBones||this.debugSlots||this.debugMesh){if(!this._debugRenderer){var t=new qC("DEBUG_DRAW_NODE");t.hideFlags|=Ye.Flags.DontSave|Ye.Flags.HideInHierarchy;var e=t.addComponent(LY);e.lineWidth=1,e.strokeColor=new _i(255,0,0,255),this._debugRenderer=e,t.parent=this.node}this.isAnimationCached()&&p("Debug bones or slots is invalid in cached mode")}else this._debugRenderer&&(this._debugRenderer.node.destroy(),this._debugRenderer=null)},n._flushAssembler=function(){var t=e.Assembler.getAssembler(this);this._assembler!==t&&(this._assembler=t),this._skeleton&&this._assembler&&(this._renderData=this._assembler.createData(this),this.markForUpdateRenderData(),this._updateColor())},n._updateSocketBindings=function(){if(this._skeleton){this._socketNodes.clear();for(var t=0,e=this._sockets.length;t<e;t++){var n=this._sockets[t];if(n.path&&n.target){var i=this._cachedSockets.get(n.path);if(!i){console.error("Skeleton data does not contain path "+n.path);continue}this._socketNodes.set(i,n.target)}}}},n._verifySockets=function(t){for(var e=0,n=t.length;e<n;e++){var i=t[e].target;!i||i.parent&&i.parent===this.node||console.error("Target node "+i.name+" is expected to be a direct child of "+this.node.name)}var r=new Map;t.forEach((function(t){t.target&&(r.get(t.target)?console.error("Target node "+t.target.name+" has existed."):r.set(t.target,!0))}))},n._cleanMaterialCache=function(){for(var t in this._materialCache)this._materialCache[t].destroy();this._materialCache={}},L(e,[{key:"drawList",get:function(){return this._drawList}},{key:"customMaterial",get:function(){return this._customMaterial},set:function(t){this._customMaterial=t,this._cleanMaterialCache()}},{key:"paused",get:function(){return this._paused},set:function(t){this._paused=t}},{key:"skeletonData",get:function(){return this._skeletonData},set:function(t){t&&t.resetEnums(),this._skeletonData!==t&&(this._skeletonData=t,this.defaultSkin="",this.defaultAnimation="",this._updateSkeletonData())}},{key:"animation",get:function(){if(this.isAnimationCached())return this._animationName;var t=this.getCurrent(0);return t&&t.animation.name||""},set:function(t){t?(this.setAnimation(0,t,this.loop),this.markForUpdateRenderData()):this.isAnimationCached()||(this.clearTrack(0),this.setToSetupPose())}},{key:"_defaultSkinIndex",get:function(){if(this.skeletonData){var t=this.skeletonData.getSkinsEnum();if(t)if(""===this.defaultSkin){if(t.hasOwnProperty(0))return this._defaultSkinIndex=0,0}else{var e=t[this.defaultSkin];if(void 0!==e)return e}}return 0},set:function(t){var e;if(this.skeletonData&&(e=this.skeletonData.getSkinsEnum()),e){var n=e[t];void 0!==n?(this.defaultSkin=n,this.setSkin(this.defaultSkin)):console.error(this.name+" skin enums are invalid")}else console.error(this.name+" skin enums are invalid")}},{key:"_animationIndex",get:function(){var t=this.animation;if(this.skeletonData)if(t){var e=this.skeletonData.getAnimsEnum();if(e){var n=e[t];if(void 0!==n)return n}}else this._refreshInspector();return 0},set:function(t){var e;if(this.skeletonData&&(e=this.skeletonData.getAnimsEnum()),e){var n=e[t];void 0!==n?(this.animation=n,this.animation=n):console.error(this.name+" animation enums are invalid")}else console.error(this.name+" animation enums are invalid")}},{key:"defaultCacheMode",get:function(){return this._defaultCacheMode},set:function(t){this._defaultCacheMode=t,this.setAnimationCacheMode(this._defaultCacheMode)}},{key:"premultipliedAlpha",get:function(){return this._premultipliedAlpha},set:function(t){t!==this._premultipliedAlpha&&(this._premultipliedAlpha=t,this.markForUpdateRenderData())}},{key:"timeScale",get:function(){return this._timeScale},set:function(t){t!==this._timeScale&&(this._timeScale=t)}},{key:"debugSlots",get:function(){return this._debugSlots},set:function(t){t!==this._debugSlots&&(this._debugSlots=t,this._updateDebugDraw(),this.markForUpdateRenderData())}},{key:"debugBones",get:function(){return this._debugBones},set:function(t){t!==this._debugBones&&(this._debugBones=t,this._updateDebugDraw(),this.markForUpdateRenderData())}},{key:"debugMesh",get:function(){return this._debugMesh},set:function(t){t!==this._debugMesh&&(this._debugMesh=t,this._updateDebugDraw(),this.markForUpdateRenderData())}},{key:"useTint",get:function(){return this._useTint},set:function(t){t!==this._useTint&&(this._useTint=t,this._updateUseTint())}},{key:"sockets",get:function(){return this._sockets},set:function(t){this._sockets=t,this._updateSocketBindings(),this.attachUtil._syncAttachedNode()}},{key:"socketNodes",get:function(){return this._socketNodes}}]),e}(Sq),cft.SpineSocket=mft,cft.AnimationCacheMode=fft,q((qht=lft).prototype,"customMaterial",[Xl,Tht,Aht,Eht],Object.getOwnPropertyDescriptor(qht.prototype,"customMaterial"),qht.prototype),q(qht.prototype,"skeletonData",[yl,Cht],Object.getOwnPropertyDescriptor(qht.prototype,"skeletonData"),qht.prototype),q(qht.prototype,"_defaultSkinIndex",[bht,wht,Pht],Object.getOwnPropertyDescriptor(qht.prototype,"_defaultSkinIndex"),qht.prototype),q(qht.prototype,"_animationIndex",[Iht,Rht,Dht],Object.getOwnPropertyDescriptor(qht.prototype,"_animationIndex"),qht.prototype),q(qht.prototype,"defaultCacheMode",[Oht,Mht,yl,Nht],Object.getOwnPropertyDescriptor(qht.prototype,"defaultCacheMode"),qht.prototype),Yht=q(qht.prototype,"loop",[cl,Lht],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),q(qht.prototype,"premultipliedAlpha",[yl,Bht],Object.getOwnPropertyDescriptor(qht.prototype,"premultipliedAlpha"),qht.prototype),q(qht.prototype,"timeScale",[Fht,yl],Object.getOwnPropertyDescriptor(qht.prototype,"timeScale"),qht.prototype),q(qht.prototype,"debugSlots",[yl,zht],Object.getOwnPropertyDescriptor(qht.prototype,"debugSlots"),qht.prototype),q(qht.prototype,"debugBones",[yl,Uht],Object.getOwnPropertyDescriptor(qht.prototype,"debugBones"),qht.prototype),q(qht.prototype,"debugMesh",[yl,kht],Object.getOwnPropertyDescriptor(qht.prototype,"debugMesh"),qht.prototype),q(qht.prototype,"useTint",[yl,Ght],Object.getOwnPropertyDescriptor(qht.prototype,"useTint"),qht.prototype),q(qht.prototype,"sockets",[Hht,Vht],Object.getOwnPropertyDescriptor(qht.prototype,"sockets"),qht.prototype),Kht=q(qht.prototype,"_timeScale",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Qht=q(qht.prototype,"_useTint",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Zht=q(qht.prototype,"_preCacheMode",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),Jht=q(qht.prototype,"_cacheMode",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return fft.REALTIME}}),$ht=q(qht.prototype,"_defaultCacheMode",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return fft.REALTIME}}),tft=q(qht.prototype,"_debugBones",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),eft=q(qht.prototype,"_debugSlots",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),nft=q(qht.prototype,"_skeletonData",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ift=q(qht.prototype,"_premultipliedAlpha",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),rft=q(qht.prototype,"defaultSkin",[cl,jht],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),aft=q(qht.prototype,"defaultAnimation",[Wht,cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),oft=q(qht.prototype,"_sockets",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),sft=q(qht.prototype,"_debugMesh",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Xht=qht))||Xht)||Xht)||Xht)||Xht);i.internal.SpineSkeleton=gft;var vft,yft,xft,Sft,Tft,Aft,Eft,Cft,bft,wft,Pft,Ift,Rft,Dft,Oft,Mft,Nft,Lft,Bft,Fft,zft,Uft,kft,Gft,Hft,Vft,jft,Wft,Xft,qft,Yft,Kft,Qft,Zft,Jft,$ft,t_t,e_t,n_t,i_t,r_t,a_t,o_t,s_t,c_t=function(){function t(){this.name="sp.VertexEffectDelegate",this._vertexEffect=null,this._interpolation=null,this._effectType=void 0,this._vertexEffect=null,this._interpolation=null,this._effectType="none"}var e=t.prototype;return e.clear=function(){this._vertexEffect=null,this._interpolation=null,this._effectType="none"},e.initJitter=function(t,e){return this._effectType="jitter",this._vertexEffect=new but.JitterEffect(t,e),this._vertexEffect},e.initSwirlWithPow=function(t,e){return this._interpolation=new but.Pow(e),this._vertexEffect=new but.SwirlEffect(t,this._interpolation),this._vertexEffect},e.initSwirlWithPowOut=function(t,e){return this._interpolation=new but.PowOut(e),this._vertexEffect=new but.SwirlEffect(t,this._interpolation),this._vertexEffect},e.getJitterVertexEffect=function(){return this._vertexEffect},e.getSwirlVertexEffect=function(){return this._vertexEffect},e.getVertexEffect=function(){return this._vertexEffect},e.getEffectType=function(){return this._effectType},t}(),l_t=0,u_t=[0,1,2,2,3,0],h_t=new _i(0,0,255,255),f_t=new _i(255,0,0,255),__t=new _i(0,255,0,255),p_t=new _i(255,255,0,255),d_t=new but.Color(1,1,1,1),m_t=new but.Color(1,1,1,1),g_t=new but.Vector2,v_t=new but.Vector2,y_t=new Float32Array(4),x_t=new Float32Array(4),S_t=0,T_t=0,A_t=0,E_t=0,C_t=0,b_t=0,w_t=0,P_t=0,I_t=null,R_t=null,D_t=null;function O_t(t){var e,n;switch(t){case but.BlendMode.Additive:e=vft?Fr.ONE:Fr.SRC_ALPHA,n=Fr.ONE;break;case but.BlendMode.Multiply:e=Fr.DST_COLOR,n=Fr.ONE_MINUS_SRC_ALPHA;break;case but.BlendMode.Screen:e=Fr.ONE,n=Fr.ONE_MINUS_SRC_COLOR;break;case but.BlendMode.Normal:default:e=vft?Fr.ONE:Fr.SRC_ALPHA,n=Fr.ONE_MINUS_SRC_ALPHA}return n_t.getMaterialForBlendAndTint(e,n,Tft?_ft.TWO_COLORED:_ft.COLORED_TEXTURED)}function M_t(t){Zft=t.fa*Ift,Wft=bft*(yft=vft?Zft/255:1),Xft=wft*yft,qft=Pft*yft,Yft=t.fr*Wft,Kft=t.fg*Xft,Qft=t.fb*qft,y_t[0]=Yft/255,y_t[1]=Kft/255,y_t[2]=Qft/255,y_t[3]=Zft/255,Jft=t.dr*Wft,$ft=t.dg*Xft,t_t=t.db*qft,e_t=vft?255:0,x_t[0]=Jft/255,x_t[1]=$ft/255,x_t[2]=t_t/255,x_t[3]=e_t/255}var N_t=new Float32Array(4);function L_t(t){return N_t[0]=t.r/255,N_t[1]=t.g/255,N_t[2]=t.b/255,N_t[3]=t.a/255,N_t}var B_t=null,F_t=null,z_t={vCount:32767,ensureAccessor:function(t){var e=t?F_t:B_t;if(!e){var n=WM.root.device,i=WM.root.batcher2D,r=t?aW:rW;t?(e=F_t=new k0(n,r,this.vCount),i.registerBufferAccessor(Number.parseInt("SPINETINT",36),F_t)):(e=B_t=new k0(n,r,this.vCount),i.registerBufferAccessor(Number.parseInt("SPINE",36),B_t))}return e},createData:function(t){var e=t.renderData;if(!e){for(var n=t.useTint||t.isAnimationCached(),i=this.ensureAccessor(n),r=t._skeleton.data.skins,a=0,o=0,s=0;s<r.length;++s)for(var c=r[s].attachments,l=0;l<c.length;l++){var u=c[l];for(var h in u){var f=u[h];f instanceof but.RegionAttachment?(a+=4,o+=6):f instanceof but.MeshAttachment&&(a+=f.worldVerticesLength>>1,o+=f.triangles.length)}}(e=wW.add(n?aW:rW,i)).resize(a,o),e.indices&&o===e.indices.length||(e.indices=new Uint16Array(o)),t.maxVertexCount=a,t.maxIndexCount=o}return e},updateRenderData:function(t){n_t=t;var e=t._skeleton;!t.isAnimationCached()&&e&&e.updateWorldTransform(),e&&function(t){if(t._skeleton){var e,n=t.color;bft=n.r/255,wft=n.g/255,Pft=n.b/255,Ift=n.a/255,Tft=t.useTint||t.isAnimationCached(),Rft=Tft?13:9,t.drawList.reset(),n_t=t,i_t=t.node,r_t=t.renderData,R_t=null,Bft=!0,vft=t.premultipliedAlpha,yft=1,l_t=0,s_t=!1,I_t=t._effectDelegate&&t._effectDelegate._vertexEffect,(4294967295!==n._val||vft)&&(s_t=!0),Tft&&(l_t|=1),n_t.enableBatch&&(e=i_t.worldMatrix,Bft=!1,l_t|=16),t.isAnimationCached()?function(t){var e=n_t._curFrame;if(e){var n=e.segments;if(0!==n.length){Dft=12,E_t=0,C_t=0,A_t=0,b_t=0;var i=null,r=e.vertices,a=e.indices,o=0,s=0,c=0,l=0;t&&(Uft=t.m00,Hft=t.m01,kft=t.m04,Vft=t.m05,Gft=t.m12,jft=t.m13);var u=16&l_t,h=u&&(1===Uft&&0===Hft&&0===kft&&1===Vft),f=e.colors,_=0,p=f[_++],d=p.vfOffset;M_t(p);for(var m=0,g=r_t,v=g.chunk.vb,y=g.indices,x=0,S=n.length;x<S;x++){var T=n[x];if(i=O_t(T.blendMode)){if(R_t||(R_t=i),Bft||i.hash!==R_t.hash||T.tex&&T.tex!==D_t){Bft=!1;var A=b_t-m;A>0&&(n_t._requestDrawData(R_t,D_t,m,A),m=b_t),R_t=i,D_t=T.tex}T_t=T.vertexCount,C_t=T.indexCount,o=g.chunk.vertexOffset;for(var E=b_t,C=b_t+C_t;E<C;E++)y[E]=o+A_t+a[c++];if(l=T.vfCount,v.set(r.subarray(s,s+l),s),h)for(var b=s,w=s+l;b<w;b+=Rft)v[b]+=Gft,v[b+1]+=jft;else if(u)for(var P=s,I=s+l;P<I;P+=Rft)Fft=v[P],zft=v[P+1],v[P]=Fft*Uft+zft*kft+Gft,v[P+1]=Fft*Hft+zft*Vft+jft;if(s_t)for(var R=s/13*6,D=s,O=s+l;D<O;D+=Rft,R+=6)R>=d&&(M_t(p=f[_++]),d=p.vfOffset),v.set(y_t,D+5),v.set(x_t,D+9);s+=l,A_t+=T_t,b_t+=C_t,T_t=0,C_t=0}}var M=b_t-m;D_t&&M>0&&n_t._requestDrawData(R_t,D_t,m,M)}}}(e):(I_t&&I_t.begin(t._skeleton),function(t,e){var n=r_t;o_t=n.chunk.vb,a_t=n.indices,w_t=n_t.maxVertexCount,P_t=n_t.maxIndexCount;var i,r,a,o,s,c,l=n_t._skeleton,u=l.color,h=n_t._debugRenderer,f=n_t._clipper,_=null;xft=n_t._startSlotIndex,Sft=n_t._endSlotIndex,Lft=!1,-1===xft&&(Lft=!0),Aft=n_t.debugSlots,Eft=n_t.debugBones,Cft=n_t.debugMesh,h&&(Eft||Aft||Cft)&&(h.clear(),h.lineWidth=5),Dft=12,S_t=0,A_t=0,E_t=0,C_t=0,b_t=0;for(var p=0,d=0,m=l.drawOrder.length;d<m;d++)if(void 0!==(c=l.drawOrder[d]))if(xft>=0&&xft===c.data.index&&(Lft=!0),Lft)if(Sft>=0&&Sft===c.data.index&&(Lft=!1),S_t=0,C_t=0,i=c.getAttachment())if(o=i instanceof but.RegionAttachment,s=i instanceof but.MeshAttachment,i instanceof but.ClippingAttachment)f.clipStart(c,i);else if(o||s){var g=i.region.texture.getRealTexture();if(_=O_t(c.data.blendMode)){if(R_t||(R_t=_),Bft||_.hash!==R_t.hash||g&&D_t!==g){Bft=!1;var v=b_t-p;v>0&&(n_t._requestDrawData(R_t,D_t,p,v),p=b_t),D_t=g,R_t=_}if(o){if(a=u_t,S_t=(T_t=4)*Rft,C_t=6,i.computeWorldVertices(c.bone,o_t,E_t,Rft),h&&Aft){h.strokeColor=h_t,h.moveTo(o_t[E_t],o_t[E_t+1]);for(var y=E_t+Rft,x=E_t+S_t;y<x;y+=Rft)h.lineTo(o_t[y],o_t[y+1]);h.close(),h.stroke()}}else if(s){var S=i;if(a=S.triangles,T_t=S.worldVerticesLength>>1,S_t=T_t*Rft,C_t=a.length,S.computeWorldVertices(c,0,S.worldVerticesLength,o_t,E_t,Rft),h&&Cft){h.strokeColor=p_t;for(var T=0,A=a.length;T<A;T+=3){var E=a[T]*Rft+E_t,C=a[T+1]*Rft+E_t,b=a[T+2]*Rft+E_t;h.moveTo(o_t[E],o_t[E+1]),h.lineTo(o_t[C],o_t[C+1]),h.lineTo(o_t[b],o_t[b+1]),h.close(),h.stroke()}}}if(0!==S_t&&0!==C_t){var w=i;(a_t=n.indices).set(a,b_t),r=w.uvs;for(var P=E_t,I=E_t+S_t,R=0;P<I;P+=Rft,R+=2)o_t[P+3]=r[R],o_t[P+4]=r[R+1];if(U_t(u,w.color,c.color,f,c),C_t>0){for(var D=n.chunk.vertexOffset,O=b_t,M=b_t+C_t;O<M;O++)a_t[O]+=A_t+D;if(e){Uft=e.m00,kft=e.m04,Gft=e.m12,Hft=e.m01,Vft=e.m05,jft=e.m13;for(var N=E_t,L=E_t+S_t;N<L;N+=Rft)Fft=o_t[N],zft=o_t[N+1],o_t[N]=Fft*Uft+zft*kft+Gft,o_t[N+1]=Fft*Hft+zft*Vft+jft}}E_t+=S_t,A_t+=T_t,b_t+=C_t,T_t=0,C_t=0,f.clipEndWithSlot(c)}else f.clipEndWithSlot(c)}else f.clipEndWithSlot(c)}else f.clipEndWithSlot(c);else f.clipEndWithSlot(c);else f.clipEndWithSlot(c);var B=b_t-p;if(D_t&&B>0&&n_t._requestDrawData(R_t,D_t,p,B),f.clipEnd(),h&&Eft){var F;h.strokeColor=f_t,h.fillColor=h_t;for(var z=0,U=l.bones.length;z<U;z++){var k=(F=l.bones[z]).data.length*F.a+F.worldX,G=F.data.length*F.c+F.worldY;h.moveTo(F.worldX,F.worldY),h.lineTo(k,G),h.stroke(),h.circle(F.worldX,F.worldY,1.5*Math.PI),h.fill(),0===z&&(h.fillColor=__t)}}}(0,e),I_t&&I_t.end()),(Tft?F_t:B_t).getMeshBuffer(r_t.chunk.bufferId).setDirty(),t.attachUtil._syncAttachedNode(),i_t=void 0,n_t=void 0,I_t=null}}(t)},updateColor:function(t){t&&(n_t=t).markForUpdateRenderData()},fillBuffers:function(){}};function U_t(t,e,n,i,r){if(d_t.a=n.a*e.a*t.a*Ift*255,yft=vft?d_t.a:255,Oft=bft*e.r*t.r*yft,Mft=wft*e.g*t.g*yft,Nft=Pft*e.b*t.b*yft,d_t.r=Oft*n.r,d_t.g=Mft*n.g,d_t.b=Nft*n.b,null==r.darkColor?m_t.set(0,0,0,1):(m_t.r=r.darkColor.r*Oft,m_t.g=r.darkColor.g*Mft,m_t.b=r.darkColor.b*Nft),m_t.a=vft?255:0,i.isClipping()){Dft=Tft?12:8;var a=o_t.subarray(E_t),o=o_t.subarray(E_t+3);i.clipTriangles(a,S_t,a_t.subarray(b_t),C_t,o,d_t,m_t,Tft,Rft);var s=i.clippedVertices,c=i.clippedTriangles;if(function(t,e){var n=T_t,i=C_t,r=r_t;C_t=e.length,T_t=t.length/Dft,S_t=T_t*Rft,w_t+=T_t-n,P_t+=C_t-i;var a=a_t,o=r.chunk.vertexOffset,s=!1;if(w_t>r.vertexCount&&(r.resizeAndCopy(w_t,P_t>r.indexCount?P_t:r.indexCount),o_t=r.chunk.vb,s=!0),P_t>a_t.length&&(a_t=r.indices=new Uint16Array(P_t),s=!0),s)for(var c=r.chunk.vertexOffset-o,l=0;l<b_t;++l)a_t[l]=a[l]+c}(s,c),c.length>0&&a_t.set(c,b_t),I_t)for(var l=0,u=s.length,h=E_t;l<u;l+=Dft,h+=Rft)g_t.x=s[l],g_t.y=s[l+1],d_t.set(s[l+2],s[l+3],s[l+4],s[l+5]),v_t.x=s[l+6],v_t.y=s[l+7],Tft?m_t.set(s[l+8],s[l+9],s[l+10],s[l+11]):m_t.set(0,0,0,0),I_t.transform(g_t,v_t,d_t,m_t),o_t[h]=g_t.x,o_t[h+1]=g_t.y,o_t[h+3]=v_t.x,o_t[h+4]=v_t.y,o_t.set(L_t(d_t),h+5),Tft&&o_t.set(L_t(m_t),h+9);else for(var f=0,_=s.length,p=E_t;f<_;f+=Dft,p+=Rft)o_t[p]=s[f],o_t[p+1]=s[f+1],o_t[p+3]=s[f+6],o_t[p+4]=s[f+7],o_t[p+5]=s[f+2]/255,o_t[p+6]=s[f+3]/255,o_t[p+7]=s[f+4]/255,o_t[p+8]=s[f+5]/255,Tft&&(o_t[p+9]=s[f+8]/255,o_t[p+10]=s[f+9]/255,o_t[p+11]=s[f+10]/255,o_t[p+12]=s[f+11]/255)}else if(I_t)for(var d=E_t,m=E_t+S_t;d<m;d+=Rft)g_t.x=o_t[d],g_t.y=o_t[d+1],v_t.x=o_t[d+3],v_t.y=o_t[d+4],I_t.transform(g_t,v_t,d_t,m_t),o_t[d]=g_t.x,o_t[d+1]=g_t.y,o_t[d+3]=v_t.x,o_t[d+4]=v_t.y,o_t.set(L_t(d_t),d+5),Tft&&o_t.set(L_t(m_t),d+9);else{y_t.set(L_t(d_t)),x_t.set(L_t(m_t));for(var g=E_t,v=E_t+S_t;g<v;g+=Rft)o_t.set(y_t,g+5),Tft&&o_t.set(x_t,g+9)}}i.internal.SpineAssembler=z_t;var k_t,G_t,H_t={getAssembler:function(){return z_t}};gft.Assembler=H_t,function(t){t[t.REGION=0]="REGION",t[t.BOUNDING_BOX=1]="BOUNDING_BOX",t[t.MESH=2]="MESH",t[t.SKINNED_MESH=3]="SKINNED_MESH"}(k_t||(k_t={})),Zt(k_t),function(t){t[t.START=0]="START",t[t.INTERRUPT=1]="INTERRUPT",t[t.END=2]="END",t[t.DISPOSE=3]="DISPOSE",t[t.COMPLETE=4]="COMPLETE",t[t.EVENT=5]="EVENT"}(G_t||(G_t={})),Zt(G_t),t("sp",Object.freeze({__proto__:null,spine:but,get ATTACHMENT_TYPE(){return k_t},get AnimationEventType(){return G_t},timeScale:1,get DefaultSkinsEnum(){return uft},get DefaultAnimsEnum(){return hft},get AnimationCacheMode(){return fft},get SpineMaterialType(){return _ft},SpineSocket:mft,Skeleton:gft,SkeletonData:fht,SkeletonTexture:lht,convertFilter:uht,convertWraps:hht,VertexEffectDelegate:c_t,simpleSpineAssembler:H_t}));var V_t=Object.setPrototypeOf,j_t={};j_t||(j_t={}),function(t){var e=function(){function e(n){this._clock=new t.WorldClock,this._events=[],this._objects=[],this._eventManager=null,this._eventManager=n,console.info("DragonBones: "+e.VERSION+"\nWebsite: http://dragonbones.com/\nSource and Demo: https://github.com/DragonBones/")}return e.prototype.advanceTime=function(e){if(this._objects.length>0){for(var n=0,i=this._objects;n<i.length;n++)i[n].returnToPool();this._objects.length=0}if(this._clock.advanceTime(e),this._events.length>0){for(var r=0;r<this._events.length;++r){var a=this._events[r],o=a.armature;null!==o._armatureData&&(o.eventDispatcher.dispatchDBEvent(a.type,a),a.type===t.EventObject.SOUND_EVENT&&this._eventManager.dispatchDBEvent(a.type,a)),this.bufferObject(a)}this._events.length=0}},e.prototype.bufferEvent=function(t){this._events.indexOf(t)<0&&this._events.push(t)},e.prototype.bufferObject=function(t){this._objects.indexOf(t)<0&&this._objects.push(t)},Object.defineProperty(e.prototype,"clock",{get:function(){return this._clock},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"eventManager",{get:function(){return this._eventManager},enumerable:!0,configurable:!0}),e.VERSION="5.6.300",e.yDown=!1,e.debug=!1,e.debugDraw=!1,e.webAssembly=!1,e}();t.DragonBones=e}(j_t||(j_t={})),console.warn||(console.warn=function(){}),console.assert||(console.assert=function(){}),Date.now||(Date.now=function(){return(new Date).getTime()}),V_t=function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);n.prototype=e.prototype,t.prototype=new n},function(t){var e=function(){function t(){this.hashCode=t._hashCode++,this._isInPool=!1}return t._returnObject=function(e){var n=String(e.constructor),i=n in t._maxCountMap?t._maxCountMap[n]:t._defaultMaxCount,r=t._poolsMap[n]=t._poolsMap[n]||[];r.length<i&&(e._isInPool?console.warn("The object is already in the pool."):(e._isInPool=!0,r.push(e)))},t.toString=function(){throw new Error},t.setMaxCount=function(e,n){if((n<0||n!=n)&&(n=0),null!==e)null!==(r=(i=String(e))in t._poolsMap?t._poolsMap[i]:null)&&r.length>n&&(r.length=n),t._maxCountMap[i]=n;else for(var i in t._defaultMaxCount=n,t._poolsMap){var r;(r=t._poolsMap[i]).length>n&&(r.length=n),i in t._maxCountMap&&(t._maxCountMap[i]=n)}},t.clearPool=function(e){if(void 0===e&&(e=null),null!==e){var n=String(e);null!==(r=n in t._poolsMap?t._poolsMap[n]:null)&&r.length>0&&(r.length=0)}else for(var i in t._poolsMap){var r;(r=t._poolsMap[i]).length=0}},t.borrowObject=function(e){var n=String(e),i=n in t._poolsMap?t._poolsMap[n]:null;if(null!==i&&i.length>0){var r=i.pop();return r._isInPool=!1,r}var a=new e;return a._onClear(),a},t.prototype.returnToPool=function(){this._onClear(),t._returnObject(this)},t._hashCode=0,t._defaultMaxCount=3e3,t._maxCountMap={},t._poolsMap={},t}();t.BaseObject=e}(j_t||(j_t={})),function(t){var e=function(){function t(t,e,n,i,r,a){void 0===t&&(t=1),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=1),void 0===r&&(r=0),void 0===a&&(a=0),this.a=t,this.b=e,this.c=n,this.d=i,this.tx=r,this.ty=a}return t.prototype.toString=function(){return"[object dragonBones.Matrix] a:"+this.a+" b:"+this.b+" c:"+this.c+" d:"+this.d+" tx:"+this.tx+" ty:"+this.ty},t.prototype.copyFrom=function(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this},t.prototype.copyFromArray=function(t,e){return void 0===e&&(e=0),this.a=t[e],this.b=t[e+1],this.c=t[e+2],this.d=t[e+3],this.tx=t[e+4],this.ty=t[e+5],this},t.prototype.identity=function(){return this.a=this.d=1,this.b=this.c=0,this.tx=this.ty=0,this},t.prototype.concat=function(t){var e=this.a*t.a,n=0,i=0,r=this.d*t.d,a=this.tx*t.a+t.tx,o=this.ty*t.d+t.ty;return 0===this.b&&0===this.c||(e+=this.b*t.c,n+=this.b*t.d,i+=this.c*t.a,r+=this.c*t.b),0===t.b&&0===t.c||(n+=this.a*t.b,i+=this.d*t.c,a+=this.ty*t.c,o+=this.tx*t.b),this.a=e,this.b=n,this.c=i,this.d=r,this.tx=a,this.ty=o,this},t.prototype.invert=function(){var t=this.a,e=this.b,n=this.c,i=this.d,r=this.tx,a=this.ty;if(0===e&&0===n)return this.b=this.c=0,0===t||0===i?this.a=this.b=this.tx=this.ty=0:(t=this.a=1/t,i=this.d=1/i,this.tx=-t*r,this.ty=-i*a),this;var o=t*i-e*n;if(0===o)return this.a=this.d=1,this.b=this.c=0,this.tx=this.ty=0,this;o=1/o;var s=this.a=i*o;return e=this.b=-e*o,n=this.c=-n*o,i=this.d=t*o,this.tx=-(s*r+n*a),this.ty=-(e*r+i*a),this},t.prototype.transformPoint=function(t,e,n,i){void 0===i&&(i=!1),n.x=this.a*t+this.c*e,n.y=this.b*t+this.d*e,i||(n.x+=this.tx,n.y+=this.ty)},t.prototype.transformRectangle=function(t,e){void 0===e&&(e=!1);var n=this.a,i=this.b,r=this.c,a=this.d,o=e?0:this.tx,s=e?0:this.ty,c=t.x,l=t.y,u=c+t.width,h=l+t.height,f=n*c+r*l+o,_=i*c+a*l+s,p=n*u+r*l+o,d=i*u+a*l+s,m=n*u+r*h+o,g=i*u+a*h+s,v=n*c+r*h+o,y=i*c+a*h+s,x=0;f>p&&(x=f,f=p,p=x),m>v&&(x=m,m=v,v=x),t.x=Math.floor(f<m?f:m),t.width=Math.ceil((p>v?p:v)-t.x),_>d&&(x=_,_=d,d=x),g>y&&(x=g,g=y,y=x),t.y=Math.floor(_<g?_:g),t.height=Math.ceil((d>y?d:y)-t.y)},t}();t.Matrix=e}(j_t||(j_t={})),function(t){var e=function(){function t(t,e,n,i,r,a){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=1),void 0===a&&(a=1),this.x=t,this.y=e,this.skew=n,this.rotation=i,this.scaleX=r,this.scaleY=a}return t.normalizeRadian=function(t){return(t=(t+Math.PI)%(2*Math.PI))+(t>0?-Math.PI:Math.PI)},t.prototype.toString=function(){return"[object dragonBones.Transform] x:"+this.x+" y:"+this.y+" skewX:"+180*this.skew/Math.PI+" skewY:"+180*this.rotation/Math.PI+" scaleX:"+this.scaleX+" scaleY:"+this.scaleY},t.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.skew=t.skew,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this},t.prototype.identity=function(){return this.x=this.y=0,this.skew=this.rotation=0,this.scaleX=this.scaleY=1,this},t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.skew+=t.skew,this.rotation+=t.rotation,this.scaleX*=t.scaleX,this.scaleY*=t.scaleY,this},t.prototype.minus=function(t){return this.x-=t.x,this.y-=t.y,this.skew-=t.skew,this.rotation-=t.rotation,this.scaleX/=t.scaleX,this.scaleY/=t.scaleY,this},t.prototype.fromMatrix=function(e){var n=this.scaleX,i=this.scaleY,r=t.PI_Q;this.x=e.tx,this.y=e.ty,this.rotation=Math.atan(e.b/e.a);var a=Math.atan(-e.c/e.d);return this.scaleX=this.rotation>-r&&this.rotation<r?e.a/Math.cos(this.rotation):e.b/Math.sin(this.rotation),this.scaleY=a>-r&&a<r?e.d/Math.cos(a):-e.c/Math.sin(a),n>=0&&this.scaleX<0&&(this.scaleX=-this.scaleX,this.rotation=this.rotation-Math.PI),i>=0&&this.scaleY<0&&(this.scaleY=-this.scaleY,a-=Math.PI),this.skew=a-this.rotation,this},t.prototype.toMatrix=function(t){return 0===this.rotation?(t.a=1,t.b=0):(t.a=Math.cos(this.rotation),t.b=Math.sin(this.rotation)),0===this.skew?(t.c=-t.b,t.d=t.a):(t.c=-Math.sin(this.skew+this.rotation),t.d=Math.cos(this.skew+this.rotation)),1!==this.scaleX&&(t.a*=this.scaleX,t.b*=this.scaleX),1!==this.scaleY&&(t.c*=this.scaleY,t.d*=this.scaleY),t.tx=this.x,t.ty=this.y,this},t.PI=Math.PI,t.PI_D=2*Math.PI,t.PI_H=Math.PI/2,t.PI_Q=Math.PI/4,t.RAD_DEG=180/Math.PI,t.DEG_RAD=Math.PI/180,t}();t.Transform=e}(j_t||(j_t={})),function(t){var e=function(){function t(t,e,n,i,r,a,o,s){void 0===t&&(t=1),void 0===e&&(e=1),void 0===n&&(n=1),void 0===i&&(i=1),void 0===r&&(r=0),void 0===a&&(a=0),void 0===o&&(o=0),void 0===s&&(s=0),this.alphaMultiplier=t,this.redMultiplier=e,this.greenMultiplier=n,this.blueMultiplier=i,this.alphaOffset=r,this.redOffset=a,this.greenOffset=o,this.blueOffset=s}return t.prototype.copyFrom=function(t){this.alphaMultiplier=t.alphaMultiplier,this.redMultiplier=t.redMultiplier,this.greenMultiplier=t.greenMultiplier,this.blueMultiplier=t.blueMultiplier,this.alphaOffset=t.alphaOffset,this.redOffset=t.redOffset,this.greenOffset=t.greenOffset,this.blueOffset=t.blueOffset},t.prototype.identity=function(){this.alphaMultiplier=this.redMultiplier=this.greenMultiplier=this.blueMultiplier=1,this.alphaOffset=this.redOffset=this.greenOffset=this.blueOffset=0},t}();t.ColorTransform=e}(j_t||(j_t={})),function(t){var e=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return t.prototype.copyFrom=function(t){this.x=t.x,this.y=t.y},t.prototype.clear=function(){this.x=this.y=0},t}();t.Point=e}(j_t||(j_t={})),function(t){var e=function(){function t(t,e,n,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),this.x=t,this.y=e,this.width=n,this.height=i}return t.prototype.copyFrom=function(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height},t.prototype.clear=function(){this.x=this.y=0,this.width=this.height=0},t}();t.Rectangle=e}(j_t||(j_t={})),function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.ints=[],e.floats=[],e.strings=[],e}return V_t(e,t),e.toString=function(){return"[class dragonBones.UserData]"},e.prototype._onClear=function(){this.ints.length=0,this.floats.length=0,this.strings.length=0},e.prototype.addInt=function(t){this.ints.push(t)},e.prototype.addFloat=function(t){this.floats.push(t)},e.prototype.addString=function(t){this.strings.push(t)},e.prototype.getInt=function(t){return void 0===t&&(t=0),t>=0&&t<this.ints.length?this.ints[t]:0},e.prototype.getFloat=function(t){return void 0===t&&(t=0),t>=0&&t<this.floats.length?this.floats[t]:0},e.prototype.getString=function(t){return void 0===t&&(t=0),t>=0&&t<this.strings.length?this.strings[t]:""},e}(t.BaseObject);t.UserData=e;var n=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.data=null,e}return V_t(e,t),e.toString=function(){return"[class dragonBones.ActionData]"},e.prototype._onClear=function(){null!==this.data&&this.data.returnToPool(),this.type=0,this.name="",this.bone=null,this.slot=null,this.data=null},e}(t.BaseObject);t.ActionData=n}(j_t||(j_t={})),function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.frameIndices=[],e.cachedFrames=[],e.armatureNames=[],e.armatures={},e.userData=null,e}return V_t(e,t),e.toString=function(){return"[class dragonBones.DragonBonesData]"},e.prototype._onClear=function(){for(var t in this.armatures)this.armatures[t].returnToPool(),delete this.armatures[t];null!==this.userData&&this.userData.returnToPool(),this.autoSearch=!1,this.frameRate=0,this.version="",this.name="",this.stage=null,this.frameIndices.length=0,this.cachedFrames.length=0,this.armatureNames.length=0,this.binary=null,this.intArray=null,this.floatArray=null,this.frameIntArray=null,this.frameFloatArray=null,this.frameArray=null,this.timelineArray=null,this.userData=null},e.prototype.addArmature=function(t){t.name in this.armatures?console.warn("Same armature: "+t.name):(t.parent=this,this.armatures[t.name]=t,this.armatureNames.push(t.name))},e.prototype.getArmature=function(t){return t in this.armatures?this.armatures[t]:null},e.prototype.dispose=function(){console.warn("已废弃"),this.returnToPool()},e}(t.BaseObject);t.DragonBonesData=e}(j_t||(j_t={})),function(t){var e=function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.aabb=new t.Rectangle,n.animationNames=[],n.sortedBones=[],n.sortedSlots=[],n.defaultActions=[],n.actions=[],n.bones={},n.slots={},n.constraints={},n.skins={},n.animations={},n.canvas=null,n.userData=null,n}return V_t(n,e),n.toString=function(){return"[class dragonBones.ArmatureData]"},n.prototype._onClear=function(){for(var t=0,e=this.defaultActions;t<e.length;t++)e[t].returnToPool();for(var n=0,i=this.actions;n<i.length;n++)i[n].returnToPool();for(var r in this.bones)this.bones[r].returnToPool(),delete this.bones[r];for(var r in this.slots)this.slots[r].returnToPool(),delete this.slots[r];for(var r in this.constraints)this.constraints[r].returnToPool(),delete this.constraints[r];for(var r in this.skins)this.skins[r].returnToPool(),delete this.skins[r];for(var r in this.animations)this.animations[r].returnToPool(),delete this.animations[r];null!==this.canvas&&this.canvas.returnToPool(),null!==this.userData&&this.userData.returnToPool(),this.type=0,this.frameRate=0,this.cacheFrameRate=0,this.scale=1,this.name="",this.aabb.clear(),this.animationNames.length=0,this.sortedBones.length=0,this.sortedSlots.length=0,this.defaultActions.length=0,this.actions.length=0,this.defaultSkin=null,this.defaultAnimation=null,this.canvas=null,this.userData=null,this.parent=null},n.prototype.sortBones=function(){var t=this.sortedBones.length;if(!(t<=0)){var e=this.sortedBones.concat(),n=0,i=0;for(this.sortedBones.length=0;i<t;){var r=e[n++];if(n>=t&&(n=0),!(this.sortedBones.indexOf(r)>=0)){var a=!1;for(var o in this.constraints){var s=this.constraints[o];if(s.root===r&&this.sortedBones.indexOf(s.target)<0){a=!0;break}}a||null!==r.parent&&this.sortedBones.indexOf(r.parent)<0||(this.sortedBones.push(r),i++)}}}},n.prototype.cacheFrames=function(t){if(!(this.cacheFrameRate>0))for(var e in this.cacheFrameRate=t,this.animations)this.animations[e].cacheFrames(this.cacheFrameRate)},n.prototype.setCacheFrame=function(t,e){var n=this.parent.cachedFrames,i=n.length;return n.length+=10,n[i]=t.a,n[i+1]=t.b,n[i+2]=t.c,n[i+3]=t.d,n[i+4]=t.tx,n[i+5]=t.ty,n[i+6]=e.rotation,n[i+7]=e.skew,n[i+8]=e.scaleX,n[i+9]=e.scaleY,i},n.prototype.getCacheFrame=function(t,e,n){var i=this.parent.cachedFrames;t.a=i[n],t.b=i[n+1],t.c=i[n+2],t.d=i[n+3],t.tx=i[n+4],t.ty=i[n+5],e.rotation=i[n+6],e.skew=i[n+7],e.scaleX=i[n+8],e.scaleY=i[n+9],e.x=t.tx,e.y=t.ty},n.prototype.addBone=function(t){t.name in this.bones?console.warn("Same bone: "+t.name):(this.bones[t.name]=t,this.sortedBones.push(t))},n.prototype.addSlot=function(t){t.name in this.slots?console.warn("Same slot: "+t.name):(this.slots[t.name]=t,this.sortedSlots.push(t))},n.prototype.addConstraint=function(t){t.name in this.constraints?console.warn("Same constraint: "+t.name):this.constraints[t.name]=t},n.prototype.addSkin=function(t){t.name in this.skins?console.warn("Same skin: "+t.name):(t.parent=this,this.skins[t.name]=t,null===this.defaultSkin&&(this.defaultSkin=t),"default"===t.name&&(this.defaultSkin=t))},n.prototype.addAnimation=function(t){t.name in this.animations?console.warn("Same animation: "+t.name):(t.parent=this,this.animations[t.name]=t,this.animationNames.push(t.name),null===this.defaultAnimation&&(this.defaultAnimation=t))},n.prototype.addAction=function(t,e){e?this.defaultActions.push(t):this.actions.push(t)},n.prototype.getBone=function(t){return t in this.bones?this.bones[t]:null},n.prototype.getSlot=function(t){return t in this.slots?this.slots[t]:null},n.prototype.getConstraint=function(t){return t in this.constraints?this.constraints[t]:null},n.prototype.getSkin=function(t){return t in this.skins?this.skins[t]:null},n.prototype.getMesh=function(t,e,n){var i=this.getSkin(t);return null===i?null:i.getDisplay(e,n)},n.prototype.getAnimation=function(t){return t in this.animations?this.animations[t]:null},n}(t.BaseObject);t.ArmatureData=e;var n=function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.transform=new t.Transform,n.userData=null,n}return V_t(n,e),n.toString=function(){return"[class dragonBones.BoneData]"},n.prototype._onClear=function(){null!==this.userData&&this.userData.returnToPool(),this.inheritTranslation=!1,this.inheritRotation=!1,this.inheritScale=!1,this.inheritReflection=!1,this.type=0,this.length=0,this.name="",this.transform.identity(),this.userData=null,this.parent=null},n}(t.BaseObject);t.BoneData=n;var i=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.vertices=[],e}return V_t(e,t),e.toString=function(){return"[class dragonBones.SurfaceData]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=1,this.segmentX=0,this.segmentY=0,this.vertices.length=0},e}(n);t.SurfaceData=i;var r=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.color=null,t.userData=null,t}return V_t(n,e),n.createColor=function(){return new t.ColorTransform},n.toString=function(){return"[class dragonBones.SlotData]"},n.prototype._onClear=function(){null!==this.userData&&this.userData.returnToPool(),this.blendMode=0,this.displayIndex=0,this.zOrder=0,this.name="",this.color=null,this.userData=null,this.parent=null},n.DEFAULT_COLOR=new t.ColorTransform,n}(t.BaseObject);t.SlotData=r}(j_t||(j_t={})),function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return V_t(e,t),e.prototype._onClear=function(){this.order=0,this.name="",this.type=0,this.target=null,this.root=null,this.bone=null},e}(t.BaseObject);t.ConstraintData=e;var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return V_t(e,t),e.toString=function(){return"[class dragonBones.IKConstraintData]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.scaleEnabled=!1,this.bendPositive=!1,this.weight=1},e}(e);t.IKConstraintData=n;var i=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bones=[],e}return V_t(e,t),e.toString=function(){return"[class dragonBones.PathConstraintData]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.pathSlot=null,this.pathDisplayData=null,this.bones.length=0,this.positionMode=0,this.spacingMode=1,this.rotateMode=1,this.position=0,this.spacing=0,this.rotateOffset=0,this.rotateMix=0,this.translateMix=0},e.prototype.AddBone=function(t){this.bones.push(t)},e}(e);t.PathConstraintData=i}(j_t||(j_t={})),function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return V_t(e,t),e.toString=function(){return"[class dragonBones.CanvasData]"},e.prototype._onClear=function(){this.hasBackground=!1,this.color=0,this.x=0,this.y=0,this.width=0,this.height=0},e}(t.BaseObject);t.CanvasData=e}(j_t||(j_t={})),function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.displays={},e}return V_t(e,t),e.toString=function(){return"[class dragonBones.SkinData]"},e.prototype._onClear=function(){for(var t in this.displays){for(var e=0,n=this.displays[t];e<n.length;e++){var i=n[e];null!==i&&i.returnToPool()}delete this.displays[t]}this.name="",this.parent=null},e.prototype.addDisplay=function(t,e){t in this.displays||(this.displays[t]=[]),null!==e&&(e.parent=this),this.displays[t].push(e)},e.prototype.getDisplay=function(t,e){var n=this.getDisplays(t);if(null!==n)for(var i=0,r=n;i<r.length;i++){var a=r[i];if(null!==a&&a.name===e)return a}return null},e.prototype.getDisplays=function(t){return t in this.displays?this.displays[t]:null},e}(t.BaseObject);t.SkinData=e}(j_t||(j_t={})),function(t){var e=function(){function t(){this.weight=null}return t.prototype.clear=function(){this.isShared||null===this.weight||this.weight.returnToPool(),this.isShared=!1,this.inheritDeform=!1,this.offset=0,this.data=null,this.weight=null},t.prototype.shareFrom=function(t){this.isShared=!0,this.offset=t.offset,this.weight=t.weight},t}();t.VerticesData=e;var n=function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.transform=new t.Transform,n}return V_t(n,e),n.prototype._onClear=function(){this.name="",this.path="",this.transform.identity(),this.parent=null},n}(t.BaseObject);t.DisplayData=n;var i=function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.pivot=new t.Point,n}return V_t(n,e),n.toString=function(){return"[class dragonBones.ImageDisplayData]"},n.prototype._onClear=function(){e.prototype._onClear.call(this),this.type=0,this.pivot.clear(),this.texture=null},n}(n);t.ImageDisplayData=i;var r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.actions=[],e}return V_t(e,t),e.toString=function(){return"[class dragonBones.ArmatureDisplayData]"},e.prototype._onClear=function(){t.prototype._onClear.call(this);for(var e=0,n=this.actions;e<n.length;e++)n[e].returnToPool();this.type=1,this.inheritAnimation=!1,this.actions.length=0,this.armature=null},e.prototype.addAction=function(t){this.actions.push(t)},e}(n);t.ArmatureDisplayData=r;var a=function(t){function n(){var n=null!==t&&t.apply(this,arguments)||this;return n.vertices=new e,n}return V_t(n,t),n.toString=function(){return"[class dragonBones.MeshDisplayData]"},n.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=2,this.vertices.clear(),this.texture=null},n}(n);t.MeshDisplayData=a;var o=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.boundingBox=null,e}return V_t(e,t),e.toString=function(){return"[class dragonBones.BoundingBoxDisplayData]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),null!==this.boundingBox&&this.boundingBox.returnToPool(),this.type=3,this.boundingBox=null},e}(n);t.BoundingBoxDisplayData=o;var s=function(t){function n(){var n=null!==t&&t.apply(this,arguments)||this;return n.vertices=new e,n.curveLengths=[],n}return V_t(n,t),n.toString=function(){return"[class dragonBones.PathDisplayData]"},n.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=4,this.closed=!1,this.constantSpeed=!1,this.vertices.clear(),this.curveLengths.length=0},n}(n);t.PathDisplayData=s;var c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bones=[],e}return V_t(e,t),e.toString=function(){return"[class dragonBones.WeightData]"},e.prototype._onClear=function(){this.count=0,this.offset=0,this.bones.length=0},e.prototype.addBone=function(t){this.bones.push(t)},e}(t.BaseObject);t.WeightData=c}(j_t||(j_t={})),function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return V_t(e,t),e.prototype._onClear=function(){this.color=0,this.width=0,this.height=0},e}(t.BaseObject);t.BoundingBoxData=e;var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return V_t(e,t),e.toString=function(){return"[class dragonBones.RectangleBoundingBoxData]"},e._computeOutCode=function(t,e,n,i,r,a){var o=0;return t<n?o|=1:t>r&&(o|=2),e<i?o|=4:e>a&&(o|=8),o},e.rectangleIntersectsSegment=function(t,n,i,r,a,o,s,c,l,u,h){void 0===l&&(l=null),void 0===u&&(u=null),void 0===h&&(h=null);var f=t>a&&t<s&&n>o&&n<c,_=i>a&&i<s&&r>o&&r<c;if(f&&_)return-1;for(var p=0,d=e._computeOutCode(t,n,a,o,s,c),m=e._computeOutCode(i,r,a,o,s,c);;){if(0==(d|m)){p=2;break}if(0!=(d&m))break;var g=0,v=0,y=0,x=0!==d?d:m;0!=(4&x)?(g=t+(i-t)*(o-n)/(r-n),v=o,null!==h&&(y=.5*-Math.PI)):0!=(8&x)?(g=t+(i-t)*(c-n)/(r-n),v=c,null!==h&&(y=.5*Math.PI)):0!=(2&x)?(v=n+(r-n)*(s-t)/(i-t),g=s,null!==h&&(y=0)):0!=(1&x)&&(v=n+(r-n)*(a-t)/(i-t),g=a,null!==h&&(y=Math.PI)),x===d?(t=g,n=v,d=e._computeOutCode(t,n,a,o,s,c),null!==h&&(h.x=y)):(i=g,r=v,m=e._computeOutCode(i,r,a,o,s,c),null!==h&&(h.y=y))}return p&&(f?(p=2,null!==l&&(l.x=i,l.y=r),null!==u&&(u.x=i,u.y=i),null!==h&&(h.x=h.y+Math.PI)):_?(p=1,null!==l&&(l.x=t,l.y=n),null!==u&&(u.x=t,u.y=n),null!==h&&(h.y=h.x+Math.PI)):(p=3,null!==l&&(l.x=t,l.y=n),null!==u&&(u.x=i,u.y=r))),p},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=0},e.prototype.containsPoint=function(t,e){var n=.5*this.width;if(t>=-n&&t<=n){var i=.5*this.height;if(e>=-i&&e<=i)return!0}return!1},e.prototype.intersectsSegment=function(t,n,i,r,a,o,s){void 0===a&&(a=null),void 0===o&&(o=null),void 0===s&&(s=null);var c=.5*this.width,l=.5*this.height;return e.rectangleIntersectsSegment(t,n,i,r,-c,-l,c,l,a,o,s)},e}(e);t.RectangleBoundingBoxData=n;var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return V_t(e,t),e.toString=function(){return"[class dragonBones.EllipseData]"},e.ellipseIntersectsSegment=function(t,e,n,i,r,a,o,s,c,l,u){void 0===c&&(c=null),void 0===l&&(l=null),void 0===u&&(u=null);var h=o/s,f=h*h,_=n-t,p=(i*=h)-(e*=h),d=Math.sqrt(_*_+p*p),m=_/d,g=p/d,v=(r-t)*m+(a-e)*g,y=o*o,x=y-(t*t+e*e)+v*v,S=0;if(x>=0){var T=Math.sqrt(x),A=v-T,E=v+T,C=A<0?-1:A<=d?0:1,b=E<0?-1:E<=d?0:1,w=C*b;if(w<0)return-1;0===w&&(-1===C?(S=2,n=t+E*m,i=(e+E*g)/h,null!==c&&(c.x=n,c.y=i),null!==l&&(l.x=n,l.y=i),null!==u&&(u.x=Math.atan2(i/y*f,n/y),u.y=u.x+Math.PI)):1===b?(S=1,t+=A*m,e=(e+A*g)/h,null!==c&&(c.x=t,c.y=e),null!==l&&(l.x=t,l.y=e),null!==u&&(u.x=Math.atan2(e/y*f,t/y),u.y=u.x+Math.PI)):(S=3,null!==c&&(c.x=t+A*m,c.y=(e+A*g)/h,null!==u&&(u.x=Math.atan2(c.y/y*f,c.x/y))),null!==l&&(l.x=t+E*m,l.y=(e+E*g)/h,null!==u&&(u.y=Math.atan2(l.y/y*f,l.x/y)))))}return S},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=1},e.prototype.containsPoint=function(t,e){var n=.5*this.width;if(t>=-n&&t<=n){var i=.5*this.height;if(e>=-i&&e<=i)return e*=n/i,Math.sqrt(t*t+e*e)<=n}return!1},e.prototype.intersectsSegment=function(t,n,i,r,a,o,s){return void 0===a&&(a=null),void 0===o&&(o=null),void 0===s&&(s=null),e.ellipseIntersectsSegment(t,n,i,r,0,0,.5*this.width,.5*this.height,a,o,s)},e}(e);t.EllipseBoundingBoxData=i;var r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.vertices=[],e}return V_t(e,t),e.toString=function(){return"[class dragonBones.PolygonBoundingBoxData]"},e.polygonIntersectsSegment=function(t,e,n,i,r,a,o,s){void 0===a&&(a=null),void 0===o&&(o=null),void 0===s&&(s=null),t===n&&(t=n+1e-6),e===i&&(e=i+1e-6);for(var c=r.length,l=t-n,u=e-i,h=t*i-e*n,f=0,_=r[c-2],p=r[c-1],d=0,m=0,g=0,v=0,y=0,x=0,S=0;S<c;S+=2){var T=r[S],A=r[S+1];_===T&&(_=T+1e-4),p===A&&(p=A+1e-4);var E=_-T,C=p-A,b=_*A-p*T,w=l*C-u*E,P=(h*E-l*b)/w;if((P>=_&&P<=T||P>=T&&P<=_)&&(0===l||P>=t&&P<=n||P>=n&&P<=t)){var I=(h*C-u*b)/w;if((I>=p&&I<=A||I>=A&&I<=p)&&(0===u||I>=e&&I<=i||I>=i&&I<=e)){if(null===o){g=P,v=I,y=P,x=I,f++,null!==s&&(s.x=Math.atan2(A-p,T-_)-.5*Math.PI,s.y=s.x);break}var R=P-t;R<0&&(R=-R),0===f?(d=R,m=R,g=P,v=I,y=P,x=I,null!==s&&(s.x=Math.atan2(A-p,T-_)-.5*Math.PI,s.y=s.x)):(R<d&&(d=R,g=P,v=I,null!==s&&(s.x=Math.atan2(A-p,T-_)-.5*Math.PI)),R>m&&(m=R,y=P,x=I,null!==s&&(s.y=Math.atan2(A-p,T-_)-.5*Math.PI))),f++}}_=T,p=A}return 1===f?(null!==a&&(a.x=g,a.y=v),null!==o&&(o.x=g,o.y=v),null!==s&&(s.y=s.x+Math.PI)):f>1&&(f++,null!==a&&(a.x=g,a.y=v),null!==o&&(o.x=y,o.y=x)),f},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=2,this.x=0,this.y=0,this.vertices.length=0},e.prototype.containsPoint=function(t,e){var n=!1;if(t>=this.x&&t<=this.width&&e>=this.y&&e<=this.height)for(var i=0,r=this.vertices.length,a=r-2;i<r;i+=2){var o=this.vertices[a+1],s=this.vertices[i+1];if(s<e&&o>=e||o<e&&s>=e){var c=this.vertices[a],l=this.vertices[i];(e-s)*(c-l)/(o-s)+l<t&&(n=!n)}a=i}return n},e.prototype.intersectsSegment=function(t,i,r,a,o,s,c){void 0===o&&(o=null),void 0===s&&(s=null),void 0===c&&(c=null);var l=0;return 0!==n.rectangleIntersectsSegment(t,i,r,a,this.x,this.y,this.x+this.width,this.y+this.height,null,null,null)&&(l=e.polygonIntersectsSegment(t,i,r,a,this.vertices,o,s,c)),l},e}(e);t.PolygonBoundingBoxData=r}(j_t||(j_t={})),function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.cachedFrames=[],e.boneTimelines={},e.surfaceTimelines={},e.slotTimelines={},e.constraintTimelines={},e.animationTimelines={},e.boneCachedFrameIndices={},e.slotCachedFrameIndices={},e.actionTimeline=null,e.zOrderTimeline=null,e}return V_t(e,t),e.toString=function(){return"[class dragonBones.AnimationData]"},e.prototype._onClear=function(){for(var t in this.boneTimelines){for(var e=0,n=this.boneTimelines[t];e<n.length;e++)n[e].returnToPool();delete this.boneTimelines[t]}for(var t in this.surfaceTimelines){for(var i=0,r=this.surfaceTimelines[t];i<r.length;i++)r[i].returnToPool();delete this.surfaceTimelines[t]}for(var t in this.slotTimelines){for(var a=0,o=this.slotTimelines[t];a<o.length;a++)o[a].returnToPool();delete this.slotTimelines[t]}for(var t in this.constraintTimelines){for(var s=0,c=this.constraintTimelines[t];s<c.length;s++)c[s].returnToPool();delete this.constraintTimelines[t]}for(var t in this.animationTimelines){for(var l=0,u=this.animationTimelines[t];l<u.length;l++)u[l].returnToPool();delete this.animationTimelines[t]}for(var t in this.boneCachedFrameIndices)delete this.boneCachedFrameIndices[t];for(var t in this.slotCachedFrameIndices)delete this.slotCachedFrameIndices[t];null!==this.actionTimeline&&this.actionTimeline.returnToPool(),null!==this.zOrderTimeline&&this.zOrderTimeline.returnToPool(),this.frameIntOffset=0,this.frameFloatOffset=0,this.frameOffset=0,this.frameCount=0,this.playTimes=0,this.duration=0,this.scale=1,this.fadeInTime=0,this.cacheFrameRate=0,this.name="",this.cachedFrames.length=0,this.actionTimeline=null,this.zOrderTimeline=null,this.parent=null},e.prototype.cacheFrames=function(t){if(!(this.cacheFrameRate>0)){this.cacheFrameRate=Math.max(Math.ceil(t*this.scale),1);var e=Math.ceil(this.cacheFrameRate*this.duration)+1;this.cachedFrames.length=e;for(var n=0,i=this.cacheFrames.length;n<i;++n)this.cachedFrames[n]=!1;for(var r=0,a=this.parent.sortedBones;r<a.length;r++){var o=a[r];for(n=0,i=(l=new Array(e)).length;n<i;++n)l[n]=-1;this.boneCachedFrameIndices[o.name]=l}for(var s=0,c=this.parent.sortedSlots;s<c.length;s++){var l,u=c[s];for(n=0,i=(l=new Array(e)).length;n<i;++n)l[n]=-1;this.slotCachedFrameIndices[u.name]=l}}},e.prototype.addBoneTimeline=function(t,e){var n=t.name in this.boneTimelines?this.boneTimelines[t.name]:this.boneTimelines[t.name]=[];n.indexOf(e)<0&&n.push(e)},e.prototype.addSurfaceTimeline=function(t,e){var n=t.name in this.surfaceTimelines?this.surfaceTimelines[t.name]:this.surfaceTimelines[t.name]=[];n.indexOf(e)<0&&n.push(e)},e.prototype.addSlotTimeline=function(t,e){var n=t.name in this.slotTimelines?this.slotTimelines[t.name]:this.slotTimelines[t.name]=[];n.indexOf(e)<0&&n.push(e)},e.prototype.addConstraintTimeline=function(t,e){var n=t.name in this.constraintTimelines?this.constraintTimelines[t.name]:this.constraintTimelines[t.name]=[];n.indexOf(e)<0&&n.push(e)},e.prototype.addAnimationTimeline=function(t,e){var n=t in this.animationTimelines?this.animationTimelines[t]:this.animationTimelines[t]=[];n.indexOf(e)<0&&n.push(e)},e.prototype.getBoneTimelines=function(t){return t in this.boneTimelines?this.boneTimelines[t]:null},e.prototype.getSurfaceTimelines=function(t){return t in this.surfaceTimelines?this.surfaceTimelines[t]:null},e.prototype.getSlotTimelines=function(t){return t in this.slotTimelines?this.slotTimelines[t]:null},e.prototype.getConstraintTimelines=function(t){return t in this.constraintTimelines?this.constraintTimelines[t]:null},e.prototype.getAnimationTimelines=function(t){return t in this.animationTimelines?this.animationTimelines[t]:null},e.prototype.getBoneCachedFrameIndices=function(t){return t in this.boneCachedFrameIndices?this.boneCachedFrameIndices[t]:null},e.prototype.getSlotCachedFrameIndices=function(t){return t in this.slotCachedFrameIndices?this.slotCachedFrameIndices[t]:null},e}(t.BaseObject);t.AnimationData=e;var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return V_t(e,t),e.toString=function(){return"[class dragonBones.TimelineData]"},e.prototype._onClear=function(){this.type=10,this.offset=0,this.frameIndicesOffset=-1},e}(t.BaseObject);t.TimelineData=n}(j_t||(j_t={})),function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.boneMask=[],e}return V_t(e,t),e.toString=function(){return"[class dragonBones.AnimationConfig]"},e.prototype._onClear=function(){this.pauseFadeOut=!0,this.fadeOutMode=4,this.fadeOutTweenType=1,this.fadeOutTime=-1,this.actionEnabled=!0,this.additiveBlending=!1,this.displayControl=!0,this.pauseFadeIn=!0,this.resetToPose=!0,this.fadeInTweenType=1,this.playTimes=-1,this.layer=0,this.position=0,this.duration=-1,this.timeScale=-100,this.weight=1,this.fadeInTime=-1,this.autoFadeOutTime=-1,this.name="",this.animation="",this.group="",this.boneMask.length=0},e.prototype.clear=function(){this._onClear()},e.prototype.copyFrom=function(t){this.pauseFadeOut=t.pauseFadeOut,this.fadeOutMode=t.fadeOutMode,this.autoFadeOutTime=t.autoFadeOutTime,this.fadeOutTweenType=t.fadeOutTweenType,this.actionEnabled=t.actionEnabled,this.additiveBlending=t.additiveBlending,this.displayControl=t.displayControl,this.pauseFadeIn=t.pauseFadeIn,this.resetToPose=t.resetToPose,this.playTimes=t.playTimes,this.layer=t.layer,this.position=t.position,this.duration=t.duration,this.timeScale=t.timeScale,this.fadeInTime=t.fadeInTime,this.fadeOutTime=t.fadeOutTime,this.fadeInTweenType=t.fadeInTweenType,this.weight=t.weight,this.name=t.name,this.animation=t.animation,this.group=t.group,this.boneMask.length=t.boneMask.length;for(var e=0,n=this.boneMask.length;e<n;++e)this.boneMask[e]=t.boneMask[e]},e.prototype.containsBoneMask=function(t){return 0===this.boneMask.length||this.boneMask.indexOf(t)>=0},e.prototype.addBoneMask=function(t,e,n){void 0===n&&(n=!0);var i=t.getBone(e);if(null!==i&&(this.boneMask.indexOf(e)<0&&this.boneMask.push(e),n))for(var r=0,a=t.getBones();r<a.length;r++){var o=a[r];this.boneMask.indexOf(o.name)<0&&i.contains(o)&&this.boneMask.push(o.name)}},e.prototype.removeBoneMask=function(t,e,n){void 0===n&&(n=!0);var i=this.boneMask.indexOf(e);if(i>=0&&this.boneMask.splice(i,1),n){var r=t.getBone(e);if(null!==r)if(this.boneMask.length>0)for(var a=0,o=t.getBones();a<o.length;a++){var s=o[a],c=this.boneMask.indexOf(s.name);c>=0&&r.contains(s)&&this.boneMask.splice(c,1)}else for(var l=0,u=t.getBones();l<u.length;l++)(s=u[l])!==r&&(r.contains(s)||this.boneMask.push(s.name))}},e}(t.BaseObject);t.AnimationConfig=e}(j_t||(j_t={})),function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.textures={},e}return V_t(e,t),e.prototype._onClear=function(){for(var t in this.textures)this.textures[t].returnToPool(),delete this.textures[t];this.autoSearch=!1,this.width=0,this.height=0,this.scale=1,this.name="",this.imagePath=""},e.prototype.copyFrom=function(t){for(var e in this.autoSearch=t.autoSearch,this.scale=t.scale,this.width=t.width,this.height=t.height,this.name=t.name,this.imagePath=t.imagePath,this.textures)this.textures[e].returnToPool(),delete this.textures[e];for(var e in t.textures){var n=this.createTexture();n.copyFrom(t.textures[e]),this.textures[e]=n}},e.prototype.addTexture=function(t){t.name in this.textures?console.warn("Same texture: "+t.name):(t.parent=this,this.textures[t.name]=t)},e.prototype.getTexture=function(t){return t in this.textures?this.textures[t]:null},e}(t.BaseObject);t.TextureAtlasData=e;var n=function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.region=new t.Rectangle,n.frame=null,n}return V_t(n,e),n.createRectangle=function(){return new t.Rectangle},n.prototype._onClear=function(){this.rotated=!1,this.name="",this.region.clear(),this.parent=null,this.frame=null},n.prototype.copyFrom=function(t){this.rotated=t.rotated,this.name=t.name,this.region.copyFrom(t.region),this.parent=t.parent,null===this.frame&&null!==t.frame?this.frame=n.createRectangle():null!==this.frame&&null===t.frame&&(this.frame=null),null!==this.frame&&null!==t.frame&&this.frame.copyFrom(t.frame)},n}(t.BaseObject);t.TextureData=n}(j_t||(j_t={})),function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.vertices=[],e.bones=[],e}return V_t(e,t),e.toString=function(){return"[class dragonBones.DeformVertices]"},e.prototype._onClear=function(){this.verticesDirty=!1,this.vertices.length=0,this.bones.length=0,this.verticesData=null},e.prototype.init=function(t,e){if(this.verticesData=t,null!==this.verticesData){var n;n=null!==this.verticesData.weight?2*this.verticesData.weight.count:2*this.verticesData.data.intArray[this.verticesData.offset+0],this.verticesDirty=!0,this.vertices.length=n,this.bones.length=0;for(var i=0,r=this.vertices.length;i<r;++i)this.vertices[i]=0;if(null!==this.verticesData.weight)for(i=0,r=this.verticesData.weight.bones.length;i<r;++i){var a=e.getBone(this.verticesData.weight.bones[i].name);this.bones.push(a)}}else this.verticesDirty=!1,this.vertices.length=0,this.bones.length=0,this.verticesData=null},e.prototype.isBonesUpdate=function(){for(var t=0,e=this.bones;t<e.length;t++){var n=e[t];if(null!==n&&n._childrenTransformDirty)return!0}return!1},e}(t.BaseObject);t.DeformVertices=e}(j_t||(j_t={})),function(t){var e=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t._bones=[],t._slots=[],t._constraints=[],t._actions=[],t._animation=null,t._proxy=null,t._replaceTextureAtlasData=null,t._clock=null,t}return V_t(n,e),n.toString=function(){return"[class dragonBones.Armature]"},n._onSortSlots=function(t,e){return t._zOrder>e._zOrder?1:-1},n.prototype._onClear=function(){null!==this._clock&&this._clock.remove(this);for(var t=0,e=this._bones;t<e.length;t++)e[t].returnToPool();for(var n=0,i=this._slots;n<i.length;n++)i[n].returnToPool();for(var r=0,a=this._constraints;r<a.length;r++)a[r].returnToPool();for(var o=0,s=this._actions;o<s.length;o++)s[o].returnToPool();null!==this._animation&&this._animation.returnToPool(),null!==this._proxy&&this._proxy.dbClear(),null!==this._replaceTextureAtlasData&&this._replaceTextureAtlasData.returnToPool(),this.inheritAnimation=!0,this.userData=null,this._lockUpdate=!1,this._slotsDirty=!0,this._zOrderDirty=!1,this._flipX=!1,this._flipY=!1,this._cacheFrameIndex=-1,this._bones.length=0,this._slots.length=0,this._constraints.length=0,this._actions.length=0,this._armatureData=null,this._animation=null,this._proxy=null,this._display=null,this._replaceTextureAtlasData=null,this._replacedTexture=null,this._dragonBones=null,this._clock=null,this._parent=null},n.prototype._sortZOrder=function(t,e){var n=this._armatureData.sortedSlots,i=null===t;if(this._zOrderDirty||!i){for(var r=0,a=n.length;r<a;++r){var o=i?r:t[e+r];if(!(o<0||o>=a)){var s=n[o],c=this.getSlot(s.name);null!==c&&c._setZorder(r)}}this._slotsDirty=!0,this._zOrderDirty=!i}},n.prototype._addBone=function(t){this._bones.indexOf(t)<0&&this._bones.push(t)},n.prototype._addSlot=function(t){this._slots.indexOf(t)<0&&this._slots.push(t)},n.prototype._addConstraint=function(t){this._constraints.indexOf(t)<0&&this._constraints.push(t)},n.prototype._bufferAction=function(t,e){this._actions.indexOf(t)<0&&(e?this._actions.push(t):this._actions.unshift(t))},n.prototype.dispose=function(){null!==this._armatureData&&(this._lockUpdate=!0,this._dragonBones.bufferObject(this))},n.prototype.init=function(e,n,i,r){null===this._armatureData&&(this._armatureData=e,this._animation=t.BaseObject.borrowObject(t.Animation),this._proxy=n,this._display=i,this._dragonBones=r,this._proxy.dbInit(this),this._animation.init(this),this._animation.animations=this._armatureData.animations)},n.prototype.advanceTime=function(t){if(!this._lockUpdate)if(null!==this._armatureData)if(null!==this._armatureData.parent){var e=this._cacheFrameIndex;if(this._animation.advanceTime(t),this._slotsDirty&&(this._slotsDirty=!1,this._slots.sort(n._onSortSlots)),this._cacheFrameIndex<0||this._cacheFrameIndex!==e){var i=0,r=0;for(i=0,r=this._bones.length;i<r;++i)this._bones[i].update(this._cacheFrameIndex);for(i=0,r=this._slots.length;i<r;++i)this._slots[i].update(this._cacheFrameIndex)}if(this._actions.length>0){this._lockUpdate=!0;for(var a=0,o=this._actions;a<o.length;a++){var s=o[a],c=s.actionData;if(null!==c&&0===c.type)if(null!==s.slot)null!==(h=s.slot.childArmature)&&h.animation.fadeIn(c.name);else if(null!==s.bone)for(var l=0,u=this.getSlots();l<u.length;l++){var h,f=u[l];f.parent===s.bone&&null!==(h=f.childArmature)&&h.animation.fadeIn(c.name)}else this._animation.fadeIn(c.name);s.returnToPool()}this._actions.length=0,this._lockUpdate=!1}this._proxy.dbUpdate()}else console.warn("The armature data has been disposed.\nPlease make sure dispose armature before call factory.clear().");else console.warn("The armature has been disposed.")},n.prototype.invalidUpdate=function(t,e){if(void 0===t&&(t=null),void 0===e&&(e=!1),null!==t&&t.length>0){if(null!==(o=this.getBone(t))&&(o.invalidUpdate(),e))for(var n=0,i=this._slots;n<i.length;n++)(l=i[n]).parent===o&&l.invalidUpdate()}else{for(var r=0,a=this._bones;r<a.length;r++){var o;(o=a[r]).invalidUpdate()}if(e)for(var s=0,c=this._slots;s<c.length;s++){var l;(l=c[s]).invalidUpdate()}}},n.prototype.containsPoint=function(t,e){for(var n=0,i=this._slots;n<i.length;n++){var r=i[n];if(r.containsPoint(t,e))return r}return null},n.prototype.intersectsSegment=function(t,e,n,i,r,a,o){void 0===r&&(r=null),void 0===a&&(a=null),void 0===o&&(o=null);for(var s=t===n,c=0,l=0,u=0,h=0,f=0,_=0,p=0,d=0,m=null,g=null,v=0,y=this._slots;v<y.length;v++){var x=y[v];if(x.intersectsSegment(t,e,n,i,r,a,o)>0){if(null===r&&null===a){m=x;break}var S;null!==r&&((S=s?r.y-e:r.x-t)<0&&(S=-S),(null===m||S<c)&&(c=S,u=r.x,h=r.y,m=x,o&&(p=o.x))),null!==a&&((S=a.x-t)<0&&(S=-S),(null===g||S>l)&&(l=S,f=a.x,_=a.y,g=x,null!==o&&(d=o.y)))}}return null!==m&&null!==r&&(r.x=u,r.y=h,null!==o&&(o.x=p)),null!==g&&null!==a&&(a.x=f,a.y=_,null!==o&&(o.y=d)),m},n.prototype.getBone=function(t){for(var e=0,n=this._bones;e<n.length;e++){var i=n[e];if(i.name===t)return i}return null},n.prototype.getBoneByDisplay=function(t){var e=this.getSlotByDisplay(t);return null!==e?e.parent:null},n.prototype.getSlot=function(t){for(var e=0,n=this._slots;e<n.length;e++){var i=n[e];if(i.name===t)return i}return null},n.prototype.getSlotByDisplay=function(t){if(null!==t)for(var e=0,n=this._slots;e<n.length;e++){var i=n[e];if(i.display===t)return i}return null},n.prototype.getBones=function(){return this._bones},n.prototype.getSlots=function(){return this._slots},Object.defineProperty(n.prototype,"flipX",{get:function(){return this._flipX},set:function(t){this._flipX!==t&&(this._flipX=t,this.invalidUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"flipY",{get:function(){return this._flipY},set:function(t){this._flipY!==t&&(this._flipY=t,this.invalidUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"cacheFrameRate",{get:function(){return this._armatureData.cacheFrameRate},set:function(t){if(this._armatureData.cacheFrameRate!==t){this._armatureData.cacheFrames(t);for(var e=0,n=this._slots;e<n.length;e++){var i=n[e].childArmature;null!==i&&(i.cacheFrameRate=t)}}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"name",{get:function(){return this._armatureData.name},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"armatureData",{get:function(){return this._armatureData},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"animation",{get:function(){return this._animation},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"proxy",{get:function(){return this._proxy},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"eventDispatcher",{get:function(){return this._proxy},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"display",{get:function(){return this._display},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"replacedTexture",{get:function(){return this._replacedTexture},set:function(t){if(this._replacedTexture!==t){null!==this._replaceTextureAtlasData&&(this._replaceTextureAtlasData.returnToPool(),this._replaceTextureAtlasData=null),this._replacedTexture=t;for(var e=0,n=this._slots;e<n.length;e++){var i=n[e];i.invalidUpdate(),i.update(-1)}}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"clock",{get:function(){return this._clock},set:function(t){if(this._clock!==t){null!==this._clock&&this._clock.remove(this),this._clock=t,this._clock&&this._clock.add(this);for(var e=0,n=this._slots;e<n.length;e++){var i=n[e].childArmature;null!==i&&(i.clock=this._clock)}}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),n.prototype.replaceTexture=function(t){this.replacedTexture=t},n.prototype.hasEventListener=function(t){return this._proxy.hasDBEventListener(t)},n.prototype.addEventListener=function(t,e,n){this._proxy.addDBEventListener(t,e,n)},n.prototype.removeEventListener=function(t,e,n){this._proxy.removeDBEventListener(t,e,n)},n.prototype.enableAnimationCache=function(t){console.warn("Deprecated."),this.cacheFrameRate=t},n.prototype.getDisplay=function(){return this._display},n}(t.BaseObject);t.Armature=e}(j_t||(j_t={})),function(t){var e=function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.globalTransformMatrix=new t.Matrix,n.global=new t.Transform,n.offset=new t.Transform,n}return V_t(n,e),n.prototype._onClear=function(){this.globalTransformMatrix.identity(),this.global.identity(),this.offset.identity(),this.origin=null,this.userData=null,this._globalDirty=!1,this._armature=null},n.prototype.updateGlobalTransform=function(){this._globalDirty&&(this._globalDirty=!1,this.global.fromMatrix(this.globalTransformMatrix))},Object.defineProperty(n.prototype,"armature",{get:function(){return this._armature},enumerable:!0,configurable:!0}),n._helpMatrix=new t.Matrix,n._helpTransform=new t.Transform,n._helpPoint=new t.Point,n}(t.BaseObject);t.TransformObject=e}(j_t||(j_t={})),function(t){var e=function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.animationPose=new t.Transform,n._blendState=new t.BlendState,n}return V_t(n,e),n.toString=function(){return"[class dragonBones.Bone]"},n.prototype._onClear=function(){e.prototype._onClear.call(this),this.offsetMode=1,this.animationPose.identity(),this._transformDirty=!1,this._childrenTransformDirty=!1,this._localDirty=!0,this._hasConstraint=!1,this._visible=!0,this._cachedFrameIndex=-1,this._blendState.clear(),this._boneData=null,this._parent=null,this._cachedFrameIndices=null},n.prototype._updateGlobalTransformMatrix=function(e){var n=this._boneData,i=this.global,r=this.globalTransformMatrix,a=this.origin,o=this.offset,s=this.animationPose,c=this._parent,l=this._armature.flipX,u=this._armature.flipY===t.DragonBones.yDown,h=null!==c,f=0;if(1===this.offsetMode?null!==a?(i.x=a.x+o.x+s.x,i.scaleX=a.scaleX*o.scaleX*s.scaleX,i.scaleY=a.scaleY*o.scaleY*s.scaleY,t.DragonBones.yDown?(i.y=a.y+o.y+s.y,i.skew=a.skew+o.skew+s.skew,i.rotation=a.rotation+o.rotation+s.rotation):(i.y=a.y-o.y+s.y,i.skew=a.skew-o.skew+s.skew,i.rotation=a.rotation-o.rotation+s.rotation)):(i.copyFrom(o),t.DragonBones.yDown||(i.y=-i.y,i.skew=-i.skew,i.rotation=-i.rotation),i.add(s)):0===this.offsetMode?null!==a?i.copyFrom(a).add(s):i.copyFrom(s):(h=!1,i.copyFrom(o),t.DragonBones.yDown||(i.y=-i.y,i.skew=-i.skew,i.rotation=-i.rotation)),h){var _=0===c._boneData.type?c.globalTransformMatrix:c._getGlobalTransformMatrix(i.x,i.y);if(n.inheritScale)n.inheritRotation||(c.updateGlobalTransform(),f=l&&u?i.rotation-(c.global.rotation+Math.PI):l?i.rotation+c.global.rotation+Math.PI:u?i.rotation+c.global.rotation:i.rotation-c.global.rotation,i.rotation=f),i.toMatrix(r),r.concat(_),n.inheritTranslation?(i.x=r.tx,i.y=r.ty):(r.tx=i.x,r.ty=i.y),e?i.fromMatrix(r):this._globalDirty=!0;else{if(n.inheritTranslation){var p=i.x,d=i.y;i.x=_.a*p+_.c*d+_.tx,i.y=_.b*p+_.d*d+_.ty}else l&&(i.x=-i.x),u&&(i.y=-i.y);n.inheritRotation?(c.updateGlobalTransform(),f=c.global.scaleX<0?i.rotation+c.global.rotation+Math.PI:i.rotation+c.global.rotation,_.a*_.d-_.b*_.c<0&&(f-=2*i.rotation,(l!==u||n.inheritReflection)&&(i.skew+=Math.PI),t.DragonBones.yDown||(i.skew=-i.skew)),i.rotation=f):(l||u)&&(l&&u?f=i.rotation+Math.PI:(f=l?Math.PI-i.rotation:-i.rotation,i.skew+=Math.PI),i.rotation=f),i.toMatrix(r)}}else(l||u)&&(l&&(i.x=-i.x),u&&(i.y=-i.y),l&&u?f=i.rotation+Math.PI:(f=l?Math.PI-i.rotation:-i.rotation,i.skew+=Math.PI),i.rotation=f),i.toMatrix(r)},n.prototype.init=function(t,e){null===this._boneData&&(this._boneData=t,this._armature=e,null!==this._boneData.parent&&(this._parent=this._armature.getBone(this._boneData.parent.name)),this._armature._addBone(this),this.origin=this._boneData.transform)},n.prototype.update=function(t){if(this._blendState.dirty=!1,t>=0&&null!==this._cachedFrameIndices){var e=this._cachedFrameIndices[t];if(e>=0&&this._cachedFrameIndex===e)this._transformDirty=!1;else if(e>=0)this._transformDirty=!0,this._cachedFrameIndex=e;else{if(this._hasConstraint)for(var n=0,i=this._armature._constraints;n<i.length;n++)(o=i[n])._root===this&&o.update();this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty?(this._transformDirty=!0,this._cachedFrameIndex=-1):this._cachedFrameIndex>=0?(this._transformDirty=!1,this._cachedFrameIndices[t]=this._cachedFrameIndex):(this._transformDirty=!0,this._cachedFrameIndex=-1)}}else{if(this._hasConstraint)for(var r=0,a=this._armature._constraints;r<a.length;r++){var o;(o=a[r])._root===this&&o.update()}(this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty)&&(t=-1,this._transformDirty=!0,this._cachedFrameIndex=-1)}if(this._transformDirty)if(this._transformDirty=!1,this._childrenTransformDirty=!0,this._cachedFrameIndex<0){var s=t>=0;this._localDirty&&this._updateGlobalTransformMatrix(s),s&&null!==this._cachedFrameIndices&&(this._cachedFrameIndex=this._cachedFrameIndices[t]=this._armature._armatureData.setCacheFrame(this.globalTransformMatrix,this.global))}else this._armature._armatureData.getCacheFrame(this.globalTransformMatrix,this.global,this._cachedFrameIndex);else this._childrenTransformDirty&&(this._childrenTransformDirty=!1);this._localDirty=!0},n.prototype.updateByConstraint=function(){this._localDirty&&(this._localDirty=!1,(this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty)&&this._updateGlobalTransformMatrix(!0),this._transformDirty=!0)},n.prototype.invalidUpdate=function(){this._transformDirty=!0},n.prototype.contains=function(t){if(t===this)return!1;for(var e=t;e!==this&&null!==e;)e=e.parent;return e===this},Object.defineProperty(n.prototype,"boneData",{get:function(){return this._boneData},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"visible",{get:function(){return this._visible},set:function(t){if(this._visible!==t){this._visible=t;for(var e=0,n=this._armature.getSlots();e<n.length;e++){var i=n[e];i.parent===this&&i._updateVisible()}}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"name",{get:function(){return this._boneData.name},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),n.prototype.getBones=function(){console.warn("Deprecated.");for(var t=new Array,e=0,n=this._armature.getBones();e<n.length;e++){var i=n[e];i.parent===this&&t.push(i)}return t},n.prototype.getSlots=function(){console.warn("Deprecated.");for(var t=new Array,e=0,n=this._armature.getSlots();e<n.length;e++){var i=n[e];i.parent===this&&t.push(i)}return t},Object.defineProperty(n.prototype,"slot",{get:function(){console.warn("Deprecated.");for(var t=0,e=this._armature.getSlots();t<e.length;t++){var n=e[t];if(n.parent===this)return n}return null},enumerable:!0,configurable:!0}),n}(t.TransformObject);t.Bone=e}(j_t||(j_t={})),function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._vertices=[],e._deformVertices=[],e._hullCache=[],e._matrixCahce=[],e}return V_t(e,t),e.toString=function(){return"[class dragonBones.Surface]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this._dX=0,this._dY=0,this._k=0,this._kX=0,this._kY=0,this._vertices.length=0,this._deformVertices.length=0,this._matrixCahce.length=0,this._hullCache.length=0},e.prototype._getAffineTransform=function(t,e,n,i,r,a,o,s,c,l,u,h,f){var _=o-r,p=s-a,d=c-r,m=l-a;u.rotation=Math.atan2(p,_),u.skew=Math.atan2(m,d)-.5*Math.PI-u.rotation,f&&(u.rotation+=Math.PI),u.scaleX=Math.sqrt(_*_+p*p)/n,u.scaleY=Math.sqrt(d*d+m*m)/i,u.toMatrix(h),u.x=h.tx=r-(h.a*t+h.c*e),u.y=h.ty=a-(h.b*t+h.d*e)},e.prototype._updateVertices=function(){var t=this._boneData.vertices,e=this._vertices,n=this._deformVertices;if(null!==this._parent)if(1===this._parent._boneData.type)for(var i=0,r=t.length;i<r;i+=2){var a=t[i]+n[i],o=t[i+1]+n[i],s=this._parent._getGlobalTransformMatrix(a,o);e[i]=s.a*a+s.c*o+s.tx,e[i+1]=s.b*a+s.d*o+s.ty}else{var c=this._parent.globalTransformMatrix;for(i=0,r=t.length;i<r;i+=2)a=t[i]+n[i],o=t[i+1]+n[i+1],e[i]=c.a*a+c.c*o+c.tx,e[i+1]=c.b*a+c.d*o+c.ty}else for(i=0,r=t.length;i<r;i+=2)e[i]=t[i]+n[i],e[i+1]=t[i+1]+n[i+1]},e.prototype._updateGlobalTransformMatrix=function(){var t=2*this._boneData.segmentX,e=this._vertices.length-2,n=this._vertices[0],i=this._vertices[1],r=this._vertices[t],a=this._vertices[t+1],o=this._vertices[e],s=this._vertices[e+1],c=this._vertices[e-t],l=this._vertices[e-t+1],u=n+.5*(o-n),h=i+.5*(s-i),f=u+.5*(r+.5*(c-r)-u),_=h+.5*(a+.5*(l-a)-h),p=r+.5*(o-r),d=a+.5*(s-a),m=c+.5*(o-c),g=l+.5*(s-l);this._globalDirty=!1,this._getAffineTransform(0,0,200,200,f,_,p,d,m,g,this.global,this.globalTransformMatrix,!1)},e.prototype._getGlobalTransformMatrix=function(t,n){var i=1e3;if(t<-i||i<t||n<-i||i<n)return this.globalTransformMatrix;var r=!1,a=200,o=this._boneData,s=o.segmentX,c=o.segmentY,l=2*o.segmentX,u=this._dX,h=this._dY,f=Math.floor((t+a)/u),_=Math.floor((n+a)/h),p=0,d=f*u-a,m=_*h-a,g=this._matrixCahce,v=e._helpMatrix;if(t<-a){if(n<-a||n>=a)return this.globalTransformMatrix;if(p=7*(2*(s*(c+1)+2*s+c+_)+((r=n>this._kX*(t+a)+m)?1:0)),this._matrixCahce[p]>0)v.copyFromArray(g,p+1);else{var y=_*(l+2),x=this._hullCache[4],S=this._hullCache[5],T=this._hullCache[2]-(c-_)*x,A=this._hullCache[3]-(c-_)*S,E=this._vertices;r?this._getAffineTransform(-a,m+h,800,h,E[y+l+2],E[y+l+3],T+x,A+S,E[y],E[y+1],e._helpTransform,v,!0):this._getAffineTransform(-i,m,800,h,T,A,E[y],E[y+1],T+x,A+S,e._helpTransform,v,!1),g[p]=1,g[p+1]=v.a,g[p+2]=v.b,g[p+3]=v.c,g[p+4]=v.d,g[p+5]=v.tx,g[p+6]=v.ty}}else if(t>=a){if(n<-a||n>=a)return this.globalTransformMatrix;p=7*(2*(s*(c+1)+s+_)+((r=n>this._kX*(t-i)+m)?1:0)),this._matrixCahce[p]>0?v.copyFromArray(g,p+1):(y=(_+1)*(l+2)-2,x=this._hullCache[4],S=this._hullCache[5],T=this._hullCache[0]+_*x,A=this._hullCache[1]+_*S,E=this._vertices,r?this._getAffineTransform(i,m+h,800,h,T+x,A+S,E[y+l+2],E[y+l+3],T,A,e._helpTransform,v,!0):this._getAffineTransform(a,m,800,h,E[y],E[y+1],T,A,E[y+l+2],E[y+l+3],e._helpTransform,v,!1),g[p]=1,g[p+1]=v.a,g[p+2]=v.b,g[p+3]=v.c,g[p+4]=v.d,g[p+5]=v.tx,g[p+6]=v.ty)}else if(n<-a){if(t<-a||t>=a)return this.globalTransformMatrix;p=7*(s*(c+1)+2*f+((r=n>this._kY*(t-d-u)-i)?1:0)),this._matrixCahce[p]>0?v.copyFromArray(g,p+1):(y=2*f,x=this._hullCache[10],S=this._hullCache[11],T=this._hullCache[8]+f*x,A=this._hullCache[9]+f*S,E=this._vertices,r?this._getAffineTransform(d+u,-a,u,800,E[y+2],E[y+3],E[y],E[y+1],T+x,A+S,e._helpTransform,v,!0):this._getAffineTransform(d,-i,u,800,T,A,T+x,A+S,E[y],E[y+1],e._helpTransform,v,!1),g[p]=1,g[p+1]=v.a,g[p+2]=v.b,g[p+3]=v.c,g[p+4]=v.d,g[p+5]=v.tx,g[p+6]=v.ty)}else if(n>=a){if(t<-a||t>=a)return this.globalTransformMatrix;p=7*(2*(s*(c+1)+s+c+_)+((r=n>this._kY*(t-d-u)+a)?1:0)),this._matrixCahce[p]>0?v.copyFromArray(g,p+1):(y=c*(l+2)+2*f,x=this._hullCache[10],S=this._hullCache[11],T=this._hullCache[6]-(s-f)*x,A=this._hullCache[7]-(s-f)*S,E=this._vertices,r?this._getAffineTransform(d+u,i,u,800,T+x,A+S,T,A,E[y+2],E[y+3],e._helpTransform,v,!0):this._getAffineTransform(d,a,u,800,E[y],E[y+1],E[y+2],E[y+3],T,A,e._helpTransform,v,!1),g[p]=1,g[p+1]=v.a,g[p+2]=v.b,g[p+3]=v.c,g[p+4]=v.d,g[p+5]=v.tx,g[p+6]=v.ty)}else p=7*(2*(s*_+f)+((r=n>this._k*(t-d-u)+m)?1:0)),this._matrixCahce[p]>0?v.copyFromArray(g,p+1):(y=2*f+_*(l+2),E=this._vertices,r?this._getAffineTransform(d+u,m+h,u,h,E[y+l+4],E[y+l+5],E[y+l+2],E[y+l+3],E[y+2],E[y+3],e._helpTransform,v,!0):this._getAffineTransform(d,m,u,h,E[y],E[y+1],E[y+2],E[y+3],E[y+l+2],E[y+l+3],e._helpTransform,v,!1),g[p]=1,g[p+1]=v.a,g[p+2]=v.b,g[p+3]=v.c,g[p+4]=v.d,g[p+5]=v.tx,g[p+6]=v.ty);return v},e.prototype.init=function(e,n){if(null===this._boneData){t.prototype.init.call(this,e,n);var i=e.segmentX,r=e.segmentY,a=e.vertices.length;this._dX=400/i,this._dY=400/r,this._k=-this._dY/this._dX,this._kX=-this._dY/800,this._kY=-800/this._dX,this._vertices.length=a,this._deformVertices.length=a,this._matrixCahce.length=14*(i*r+2*i+2*r),this._hullCache.length=10;for(var o=0;o<a;++o)this._deformVertices[o]=0}},e.prototype.update=function(t){if(this._blendState.dirty=!1,t>=0&&null!==this._cachedFrameIndices){var n=this._cachedFrameIndices[t];if(n>=0&&this._cachedFrameIndex===n)this._transformDirty=!1;else if(n>=0)this._transformDirty=!0,this._cachedFrameIndex=n;else{if(this._hasConstraint)for(var i=0,r=this._armature._constraints;i<r.length;i++)(s=r[i])._root===this&&s.update();this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty?(this._transformDirty=!0,this._cachedFrameIndex=-1):this._cachedFrameIndex>=0?(this._transformDirty=!1,this._cachedFrameIndices[t]=this._cachedFrameIndex):(this._transformDirty=!0,this._cachedFrameIndex=-1)}}else{if(this._hasConstraint)for(var a=0,o=this._armature._constraints;a<o.length;a++){var s;(s=o[a])._root===this&&s.update()}(this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty)&&(t=-1,this._transformDirty=!0,this._cachedFrameIndex=-1)}if(this._transformDirty){this._transformDirty=!1,this._childrenTransformDirty=!0;for(var c=0,l=this._matrixCahce.length;c<l;c+=7)this._matrixCahce[c]=-1;if(this._updateVertices(),this._cachedFrameIndex<0){var u=t>=0;this._localDirty&&this._updateGlobalTransformMatrix(u),u&&null!==this._cachedFrameIndices&&(this._cachedFrameIndex=this._cachedFrameIndices[t]=this._armature._armatureData.setCacheFrame(this.globalTransformMatrix,this.global))}else this._armature._armatureData.getCacheFrame(this.globalTransformMatrix,this.global,this._cachedFrameIndex);var h=2*this.global.x,f=2*this.global.y,_=e._helpPoint;this.globalTransformMatrix.transformPoint(1e3,-200,_),this._hullCache[0]=_.x,this._hullCache[1]=_.y,this._hullCache[2]=h-_.x,this._hullCache[3]=f-_.y,this.globalTransformMatrix.transformPoint(0,this._dY,_,!0),this._hullCache[4]=_.x,this._hullCache[5]=_.y,this.globalTransformMatrix.transformPoint(200,1e3,_),this._hullCache[6]=_.x,this._hullCache[7]=_.y,this._hullCache[8]=h-_.x,this._hullCache[9]=f-_.y,this.globalTransformMatrix.transformPoint(this._dX,0,_,!0),this._hullCache[10]=_.x,this._hullCache[11]=_.y}else this._childrenTransformDirty&&(this._childrenTransformDirty=!1);this._localDirty=!0},e}(t.Bone);t.Surface=e}(j_t||(j_t={})),function(t){var e=function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n._localMatrix=new t.Matrix,n._colorTransform=new t.ColorTransform,n._displayDatas=[],n._displayList=[],n._deformVertices=null,n._rawDisplay=null,n._meshDisplay=null,n}return V_t(n,e),n.prototype._onClear=function(){e.prototype._onClear.call(this);for(var n=[],i=0,r=this._displayList;i<r.length;i++)null!==(s=r[i])&&s!==this._rawDisplay&&s!==this._meshDisplay&&n.indexOf(s)<0&&n.push(s);for(var a=0,o=n;a<o.length;a++){var s;(s=o[a])instanceof t.Armature?s.dispose():this._disposeDisplay(s,!0)}null!==this._deformVertices&&this._deformVertices.returnToPool(),null!==this._meshDisplay&&this._meshDisplay!==this._rawDisplay&&this._disposeDisplay(this._meshDisplay,!1),null!==this._rawDisplay&&this._disposeDisplay(this._rawDisplay,!1),this.displayController=null,this._displayDirty=!1,this._zOrderDirty=!1,this._blendModeDirty=!1,this._colorDirty=!1,this._transformDirty=!1,this._visible=!0,this._blendMode=0,this._displayIndex=-1,this._animationDisplayIndex=-1,this._zOrder=0,this._cachedFrameIndex=-1,this._pivotX=0,this._pivotY=0,this._localMatrix.identity(),this._colorTransform.identity(),this._displayList.length=0,this._displayDatas.length=0,this._slotData=null,this._rawDisplayDatas=null,this._displayData=null,this._boundingBoxData=null,this._textureData=null,this._deformVertices=null,this._rawDisplay=null,this._meshDisplay=null,this._display=null,this._childArmature=null,this._parent=null,this._cachedFrameIndices=null},n.prototype._getDefaultRawDisplayData=function(t){var e=this._armature._armatureData.defaultSkin;if(null!==e){var n=e.getDisplays(this._slotData.name);if(null!==n)return t<n.length?n[t]:null}return null},n.prototype._updateDisplayData=function(){var e=this._displayData,i=null!==this._deformVertices?this._deformVertices.verticesData:null,r=this._textureData,a=null,o=null;if(this._displayData=null,this._boundingBoxData=null,this._textureData=null,this._displayIndex>=0&&(null!==this._rawDisplayDatas&&(a=this._displayIndex<this._rawDisplayDatas.length?this._rawDisplayDatas[this._displayIndex]:null),null===a&&(a=this._getDefaultRawDisplayData(this._displayIndex)),this._displayIndex<this._displayDatas.length&&(this._displayData=this._displayDatas[this._displayIndex])),null!==this._displayData&&(2===this._displayData.type||4===this._displayData.type?o=this._displayData.vertices:null!==a&&(2===a.type||4===a.type)&&(o=a.vertices),3===this._displayData.type?this._boundingBoxData=this._displayData.boundingBox:null!==a&&3===a.type&&(this._boundingBoxData=a.boundingBox),(0===this._displayData.type||2===this._displayData.type)&&(this._textureData=this._displayData.texture)),this._displayData!==e||o!==i||this._textureData!==r){if(null===o&&null!==this._textureData){var s=this._displayData,c=this._textureData.parent.scale*this._armature._armatureData.scale,l=this._textureData.frame;this._pivotX=s.pivot.x,this._pivotY=s.pivot.y;var u=null!==l?l:this._textureData.region,h=u.width,f=u.height;this._textureData.rotated&&null===l&&(h=u.height,f=u.width),this._pivotX*=h*c,this._pivotY*=f*c,null!==l&&(this._pivotX+=l.x*c,this._pivotY+=l.y*c),null!==this._displayData&&null!==a&&this._displayData!==a&&(a.transform.toMatrix(n._helpMatrix),n._helpMatrix.invert(),n._helpMatrix.transformPoint(0,0,n._helpPoint),this._pivotX-=n._helpPoint.x,this._pivotY-=n._helpPoint.y,this._displayData.transform.toMatrix(n._helpMatrix),n._helpMatrix.invert(),n._helpMatrix.transformPoint(0,0,n._helpPoint),this._pivotX+=n._helpPoint.x,this._pivotY+=n._helpPoint.y),t.DragonBones.yDown||(this._pivotY=(this._textureData.rotated?this._textureData.region.width:this._textureData.region.height)*c-this._pivotY)}else this._pivotX=0,this._pivotY=0;null!==a?this.origin=a.transform:null!==this._displayData?this.origin=this._displayData.transform:this.origin=null,o!==i?(null===this._deformVertices&&(this._deformVertices=t.BaseObject.borrowObject(t.DeformVertices)),this._deformVertices.init(o,this._armature)):null!==this._deformVertices&&this._textureData!==r&&(this._deformVertices.verticesDirty=!0),this._displayDirty=!0,this._transformDirty=!0}},n.prototype._updateDisplay=function(){var e=null!==this._display?this._display:this._rawDisplay,n=this._childArmature;this._displayIndex>=0&&this._displayIndex<this._displayList.length?(this._display=this._displayList[this._displayIndex],null!==this._display&&this._display instanceof t.Armature?(this._childArmature=this._display,this._display=this._childArmature.display):this._childArmature=null):(this._display=null,this._childArmature=null);var i=null!==this._display?this._display:this._rawDisplay;if(i!==e&&(this._onUpdateDisplay(),this._replaceDisplay(e),this._transformDirty=!0,this._visibleDirty=!0,this._blendModeDirty=!0,this._colorDirty=!0),i!==this._rawDisplay&&i!==this._meshDisplay||this._updateFrame(),this._childArmature!==n&&(null!==n&&(n._parent=null,n.clock=null,n.inheritAnimation&&n.animation.reset()),null!==this._childArmature&&(this._childArmature._parent=this,this._childArmature.clock=this._armature.clock,this._childArmature.inheritAnimation))){if(0===this._childArmature.cacheFrameRate){var r=this._armature.cacheFrameRate;0!==r&&(this._childArmature.cacheFrameRate=r)}var a=null;if(null!==this._displayData&&1===this._displayData.type)a=this._displayData.actions;else if(this._displayIndex>=0&&null!==this._rawDisplayDatas){var o=this._displayIndex<this._rawDisplayDatas.length?this._rawDisplayDatas[this._displayIndex]:null;null===o&&(o=this._getDefaultRawDisplayData(this._displayIndex)),null!==o&&1===o.type&&(a=o.actions)}if(null!==a&&a.length>0)for(var s=0,c=a;s<c.length;s++){var l=c[s],u=t.BaseObject.borrowObject(t.EventObject);t.EventObject.actionDataToInstance(l,u,this._armature),u.slot=this,this._armature._bufferAction(u,!1)}else this._childArmature.animation.play()}},n.prototype._updateGlobalTransformMatrix=function(t){var e=0===this._parent._boneData.type?this._parent.globalTransformMatrix:this._parent._getGlobalTransformMatrix(this.global.x,this.global.y);this.globalTransformMatrix.copyFrom(this._localMatrix),this.globalTransformMatrix.concat(e),t?this.global.fromMatrix(this.globalTransformMatrix):this._globalDirty=!0},n.prototype._setDisplayIndex=function(t,e){if(void 0===e&&(e=!1),e){if(this._animationDisplayIndex===t)return!1;this._animationDisplayIndex=t}return this._displayIndex!==t&&(this._displayIndex=t,this._displayDirty=!0,this._updateDisplayData(),this._displayDirty)},n.prototype._setZorder=function(t){return this._zOrder,this._zOrder=t,this._zOrderDirty=!0,this._zOrderDirty},n.prototype._setColor=function(t){return this._colorTransform.copyFrom(t),this._colorDirty=!0,this._colorDirty},n.prototype._setDisplayList=function(e){if(null!==e&&e.length>0){this._displayList.length!==e.length&&(this._displayList.length=e.length);for(var n=0,i=e.length;n<i;++n){var r=e[n];null!==r&&r!==this._rawDisplay&&r!==this._meshDisplay&&!(r instanceof t.Armature)&&this._displayList.indexOf(r)<0&&this._initDisplay(r,!0),this._displayList[n]=r}}else this._displayList.length>0&&(this._displayList.length=0);return this._displayIndex>=0&&this._displayIndex<this._displayList.length?this._displayDirty=this._display!==this._displayList[this._displayIndex]:this._displayDirty=null!==this._display,this._updateDisplayData(),this._displayDirty},n.prototype.init=function(t,e,n,i){if(null===this._slotData){this._slotData=t,this._isFromCache=!1,this._visibleDirty=!0,this._blendModeDirty=!0,this._colorDirty=!0,this._blendMode=this._slotData.blendMode,this._zOrder=this._slotData.zOrder,this._colorTransform.copyFrom(this._slotData.color),this._rawDisplay=n,this._meshDisplay=i,this._armature=e;var r=this._armature.getBone(this._slotData.parent.name);null!==r&&(this._parent=r),this._armature._addSlot(this),this._initDisplay(this._rawDisplay,!1),this._rawDisplay!==this._meshDisplay&&this._initDisplay(this._meshDisplay,!1),this._onUpdateDisplay(),this._addDisplay()}},n.prototype.update=function(t){if(this._isFromCache=!1,this._displayDirty&&(this._displayDirty=!1,this._updateDisplay(),this._transformDirty&&(null!==this.origin?this.global.copyFrom(this.origin).add(this.offset).toMatrix(this._localMatrix):this.global.copyFrom(this.offset).toMatrix(this._localMatrix))),this._zOrderDirty&&(this._zOrderDirty=!1,this._updateZOrder()),t>=0&&null!==this._cachedFrameIndices){var e=this._cachedFrameIndices[t];e>=0&&this._cachedFrameIndex===e?this._transformDirty=!1:e>=0?(this._transformDirty=!0,this._cachedFrameIndex=e):this._transformDirty||this._parent._childrenTransformDirty?(this._transformDirty=!0,this._cachedFrameIndex=-1):this._cachedFrameIndex>=0?(this._transformDirty=!1,this._cachedFrameIndices[t]=this._cachedFrameIndex):(this._transformDirty=!0,this._cachedFrameIndex=-1)}else(this._transformDirty||this._parent._childrenTransformDirty)&&(t=-1,this._transformDirty=!0,this._cachedFrameIndex=-1);if(null!==this._display){if(this._visibleDirty&&(this._visibleDirty=!1,this._updateVisible()),this._blendModeDirty&&(this._blendModeDirty=!1,this._updateBlendMode()),this._colorDirty&&(this._colorDirty=!1,this._updateColor()),null!==this._deformVertices&&null!==this._deformVertices.verticesData&&this._display===this._meshDisplay){var n=null!==this._deformVertices.verticesData.weight,i=0!==this._parent._boneData.type;if((this._deformVertices.verticesDirty||n&&this._deformVertices.isBonesUpdate()||i&&this._parent._childrenTransformDirty)&&(this._deformVertices.verticesDirty=!1,this._updateMesh()),n||i)return}if(this._transformDirty){if(this._transformDirty=!1,this._cachedFrameIndex<0){var r=t>=0;this._updateGlobalTransformMatrix(r),r&&null!==this._cachedFrameIndices&&(this._cachedFrameIndex=this._cachedFrameIndices[t]=this._armature._armatureData.setCacheFrame(this.globalTransformMatrix,this.global))}else this._isFromCache=!0,this._armature._armatureData.getCacheFrame(this.globalTransformMatrix,this.global,this._cachedFrameIndex);this._updateTransform()}}},n.prototype.updateTransformAndMatrix=function(){this._transformDirty&&(this._transformDirty=!1,this._updateGlobalTransformMatrix(!1))},n.prototype.replaceDisplayData=function(t,e){if(void 0===e&&(e=-1),e<0&&(e=this._displayIndex<0?0:this._displayIndex),this._displayDatas.length<=e){this._displayDatas.length=e+1;for(var n=0,i=this._displayDatas.length;n<i;++n)this._displayDatas[n]||(this._displayDatas[n]=null)}this._displayDatas[e]=t},n.prototype.containsPoint=function(t,e){return null!==this._boundingBoxData&&(this.updateTransformAndMatrix(),n._helpMatrix.copyFrom(this.globalTransformMatrix),n._helpMatrix.invert(),n._helpMatrix.transformPoint(t,e,n._helpPoint),this._boundingBoxData.containsPoint(n._helpPoint.x,n._helpPoint.y))},n.prototype.intersectsSegment=function(t,e,i,r,a,o,s){if(void 0===a&&(a=null),void 0===o&&(o=null),void 0===s&&(s=null),null===this._boundingBoxData)return 0;this.updateTransformAndMatrix(),n._helpMatrix.copyFrom(this.globalTransformMatrix),n._helpMatrix.invert(),n._helpMatrix.transformPoint(t,e,n._helpPoint),t=n._helpPoint.x,e=n._helpPoint.y,n._helpMatrix.transformPoint(i,r,n._helpPoint),i=n._helpPoint.x,r=n._helpPoint.y;var c=this._boundingBoxData.intersectsSegment(t,e,i,r,a,o,s);return c>0&&(1===c||2===c?null!==a?(this.globalTransformMatrix.transformPoint(a.x,a.y,a),null!==o&&(o.x=a.x,o.y=a.y)):null!==o&&this.globalTransformMatrix.transformPoint(o.x,o.y,o):(null!==a&&this.globalTransformMatrix.transformPoint(a.x,a.y,a),null!==o&&this.globalTransformMatrix.transformPoint(o.x,o.y,o)),null!==s&&(this.globalTransformMatrix.transformPoint(Math.cos(s.x),Math.sin(s.x),n._helpPoint,!0),s.x=Math.atan2(n._helpPoint.y,n._helpPoint.x),this.globalTransformMatrix.transformPoint(Math.cos(s.y),Math.sin(s.y),n._helpPoint,!0),s.y=Math.atan2(n._helpPoint.y,n._helpPoint.x))),c},n.prototype.invalidUpdate=function(){this._displayDirty=!0,this._transformDirty=!0},Object.defineProperty(n.prototype,"visible",{get:function(){return this._visible},set:function(t){this._visible!==t&&(this._visible=t,this._updateVisible())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"displayIndex",{get:function(){return this._displayIndex},set:function(t){this._setDisplayIndex(t)&&this.update(-1)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"name",{get:function(){return this._slotData.name},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"displayList",{get:function(){return this._displayList.concat()},set:function(e){var n=this._displayList.concat(),i=new Array;this._setDisplayList(e)&&this.update(-1);for(var r=0,a=n;r<a.length;r++)null!==(c=a[r])&&c!==this._rawDisplay&&c!==this._meshDisplay&&this._displayList.indexOf(c)<0&&i.indexOf(c)<0&&i.push(c);for(var o=0,s=i;o<s.length;o++){var c;(c=s[o])instanceof t.Armature||this._disposeDisplay(c,!0)}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"slotData",{get:function(){return this._slotData},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"rawDisplayDatas",{get:function(){return this._rawDisplayDatas},set:function(t){if(this._rawDisplayDatas!==t)if(this._displayDirty=!0,this._rawDisplayDatas=t,null!==this._rawDisplayDatas){this._displayDatas.length=this._rawDisplayDatas.length;for(var e=0,n=this._displayDatas.length;e<n;++e){var i=this._rawDisplayDatas[e];null===i&&(i=this._getDefaultRawDisplayData(e)),this._displayDatas[e]=i}}else this._displayDatas.length=0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"displayData",{get:function(){return this._displayData},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"boundingBoxData",{get:function(){return this._boundingBoxData},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"rawDisplay",{get:function(){return this._rawDisplay},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"meshDisplay",{get:function(){return this._meshDisplay},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"display",{get:function(){return this._display},set:function(t){if(this._display!==t){var e=this._displayList.length;if(this._displayIndex<0&&0===e&&(this._displayIndex=0),!(this._displayIndex<0)){var n=this.displayList;e<=this._displayIndex&&(n.length=this._displayIndex+1),n[this._displayIndex]=t,this.displayList=n}}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"childArmature",{get:function(){return this._childArmature},set:function(t){this._childArmature!==t&&(this.display=t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),n.prototype.getDisplay=function(){return this._display},n.prototype.setDisplay=function(t){this.display=t},n}(t.TransformObject);t.Slot=e}(j_t||(j_t={})),function(t){var e=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return V_t(n,e),n.prototype._onClear=function(){this._armature=null,this._target=null,this._root=null,this._bone=null},Object.defineProperty(n.prototype,"name",{get:function(){return this._constraintData.name},enumerable:!0,configurable:!0}),n._helpMatrix=new t.Matrix,n._helpTransform=new t.Transform,n._helpPoint=new t.Point,n}(t.BaseObject);t.Constraint=e;var n=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return V_t(n,e),n.toString=function(){return"[class dragonBones.IKConstraint]"},n.prototype._onClear=function(){e.prototype._onClear.call(this),this._scaleEnabled=!1,this._bendPositive=!1,this._weight=1,this._constraintData=null},n.prototype._computeA=function(){var e=this._target.global,n=this._root.global,i=this._root.globalTransformMatrix,r=Math.atan2(e.y-n.y,e.x-n.x);n.scaleX<0&&(r+=Math.PI),n.rotation+=t.Transform.normalizeRadian(r-n.rotation)*this._weight,n.toMatrix(i)},n.prototype._computeB=function(){var e=this._bone._boneData.length,n=this._root,i=this._target.global,r=n.global,a=this._bone.global,o=this._bone.globalTransformMatrix,s=o.a*e,c=o.b*e,l=s*s+c*c,u=Math.sqrt(l),h=a.x-r.x,f=a.y-r.y,_=h*h+f*f,p=Math.sqrt(_),d=a.rotation,m=r.rotation,g=Math.atan2(f,h),v=(h=i.x-r.x)*h+(f=i.y-r.y)*f,y=Math.sqrt(v),x=0;if(u+p<=y||y+u<=p||y+p<=u)x=Math.atan2(i.y-r.y,i.x-r.x),u+p<=y||p<u&&(x+=Math.PI);else{var S=(_-l+v)/(2*v),T=Math.sqrt(_-S*S*v)/y,A=r.x+h*S,E=r.y+f*S,C=-f*T,b=h*T,w=!1,P=n.parent;if(null!==P){var I=P.globalTransformMatrix;w=I.a*I.d-I.b*I.c<0}w!==this._bendPositive?(a.x=A-C,a.y=E-b):(a.x=A+C,a.y=E+b),x=Math.atan2(a.y-r.y,a.x-r.x)}var R=t.Transform.normalizeRadian(x-g);r.rotation=m+R*this._weight,r.toMatrix(n.globalTransformMatrix);var D=g+R*this._weight;a.x=r.x+Math.cos(D)*p,a.y=r.y+Math.sin(D)*p;var O=Math.atan2(i.y-a.y,i.x-a.x);a.scaleX<0&&(O+=Math.PI),a.rotation=r.rotation+d-m+t.Transform.normalizeRadian(O-R-d)*this._weight,a.toMatrix(o)},n.prototype.init=function(t,e){if(null===this._constraintData){this._constraintData=t,this._armature=e,this._target=this._armature.getBone(this._constraintData.target.name),this._root=this._armature.getBone(this._constraintData.root.name),this._bone=null!==this._constraintData.bone?this._armature.getBone(this._constraintData.bone.name):null;var n=this._constraintData;this._scaleEnabled=n.scaleEnabled,this._bendPositive=n.bendPositive,this._weight=n.weight,this._root._hasConstraint=!0}},n.prototype.update=function(){this._root.updateByConstraint(),null!==this._bone?(this._bone.updateByConstraint(),this._computeB()):this._computeA()},n.prototype.invalidUpdate=function(){this._root.invalidUpdate(),null!==this._bone&&this._bone.invalidUpdate()},n}(e);t.IKConstraint=n;var i=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t._bones=[],t._spaces=[],t._positions=[],t._curves=[],t._boneLengths=[],t._pathGlobalVertices=[],t._segments=[10],t}return V_t(n,e),n.toString=function(){return"[class dragonBones.PathConstraint]"},n.prototype._onClear=function(){e.prototype._onClear.call(this),this.dirty=!1,this.pathOffset=0,this.position=0,this.spacing=0,this.rotateOffset=0,this.rotateMix=1,this.translateMix=1,this._pathSlot=null,this._bones.length=0,this._spaces.length=0,this._positions.length=0,this._curves.length=0,this._boneLengths.length=0,this._pathGlobalVertices.length=0},n.prototype._updatePathVertices=function(t){var e=this._armature,n=e.armatureData.parent,i=e.armatureData.scale,r=n.intArray,a=n.floatArray,o=t.offset,s=r[o+0],c=r[o+2];this._pathGlobalVertices.length=2*s;var l=t.weight;if(null!==l)for(var u=this._pathSlot._deformVertices.bones,h=l.bones.length,f=l.offset,_=r[f+1],p=f+2+h,d=(E=0,0);E<s;E++){for(var m=0,g=0,v=0,y=r[p++];v<y;v++){var x=u[r[p++]];if(null!==x){x.updateByConstraint(),A=x.globalTransformMatrix;var S=a[_++];b=a[_++]*i,w=a[_++]*i,m+=(A.a*b+A.c*w+A.tx)*S,g+=(A.b*b+A.d*w+A.ty)*S}}this._pathGlobalVertices[d++]=m,this._pathGlobalVertices[d++]=g}else{var T=this._pathSlot.parent;T.updateByConstraint();for(var A=T.globalTransformMatrix,E=0,C=c;E<s;E+=2){var b=a[C++]*i,w=a[C++]*i,P=A.a*b+A.c*w+A.tx,I=A.b*b+A.d*w+A.ty;this._pathGlobalVertices[E]=P,this._pathGlobalVertices[E+1]=I}}},n.prototype._computeVertices=function(t,e,n,i){for(var r=n,a=t;r<e;r+=2)i[r]=this._pathGlobalVertices[a++],i[r+1]=this._pathGlobalVertices[a++]},n.prototype._computeBezierCurve=function(t,e,n,i,r){var a=this._armature.armatureData.parent.intArray[t.vertices.offset+0],o=this._positions,s=this._spaces,c=t.closed,l=Array(),u=2*a,h=u/6,f=-1,_=this.position;o.length=3*e+2;var p=0;if(t.constantSpeed){c?(u+=2,l.length=a,this._computeVertices(2,u-4,0,l),this._computeVertices(0,2,u-4,l),l[u-2]=l[0],l[u-1]=l[1]):(h--,u-=4,l.length=u,this._computeVertices(2,u,0,l));var d=new Array(h);p=0;for(var m,g,v,y,x,S,T,A,E=l[0],C=l[1],b=0,w=0,P=0,I=0,R=0,D=0,O=(H=0,2);H<h;H++,O+=6)b=l[O],w=l[O+1],P=l[O+2],I=l[O+3],x=2*(m=.1875*(E-2*b+P))+(v=.09375*(3*(b-P)-E+(R=l[O+4]))),S=2*(g=.1875*(C-2*w+I))+(y=.09375*(3*(w-I)-C+(D=l[O+5]))),T=.75*(b-E)+m+.16666667*v,A=.75*(w-C)+g+.16666667*y,p+=Math.sqrt(T*T+A*A),T+=x,A+=S,x+=v,S+=y,p+=Math.sqrt(T*T+A*A),T+=x,A+=S,p+=Math.sqrt(T*T+A*A),T+=x+v,A+=S+y,p+=Math.sqrt(T*T+A*A),d[H]=p,E=R,C=D;if(i&&(_*=p),r)for(H=0;H<e;H++)s[H]*=p;for(var M=this._segments,N=0,L=(H=0,V=0,j=0,0);H<e;H++,V+=3){var B=_+=s[H];if(c)(B%=p)<0&&(B+=p),j=0;else{if(B<0)continue;if(B>p)continue}for(;;j++){var F=d[j];if(!(B>F)){0===j?B/=F:B=(B-(k=d[j-1]))/(F-k);break}}if(j!==f){f=j;var z=6*j;for(E=l[z],C=l[z+1],b=l[z+2],w=l[z+3],P=l[z+4],I=l[z+5],x=2*(m=.03*(E-2*b+P))+(v=.006*(3*(b-P)-E+(R=l[z+6]))),S=2*(g=.03*(C-2*w+I))+(y=.006*(3*(w-I)-C+(D=l[z+7]))),T=.3*(b-E)+m+.16666667*v,A=.3*(w-C)+g+.16666667*y,N=Math.sqrt(T*T+A*A),M[0]=N,z=1;z<8;z++)T+=x,A+=S,x+=v,S+=y,N+=Math.sqrt(T*T+A*A),M[z]=N;T+=x,A+=S,N+=Math.sqrt(T*T+A*A),M[8]=N,T+=x+v,A+=S+y,N+=Math.sqrt(T*T+A*A),M[9]=N,L=0}for(B*=N;;L++){var U=M[L];if(!(B>U)){var k;0===L?B/=U:B=L+(B-(k=M[L-1]))/(U-k);break}}this.addCurvePosition(.1*B,E,C,b,w,P,I,R,D,o,V,n)}}else{var G=t.curveLengths;if(p=G[h-=c?1:2],i&&(_*=p),r)for(var H=0;H<e;H++)s[H]*=p;l.length=8;H=0;for(var V=0,j=0;H<e;H++,V+=3){if(_+=s[H],c)(_%=p)<0&&(_+=p),j=0;else{if(_<0)continue;if(_>p)continue}for(var W=0;;j++){var X=G[j];if(!(_>X)){if(0===j)W=_/X;else{var q=G[j-1];W=(_-q)/(X-q)}break}}j!==f&&(f=j,c&&j===h?(this._computeVertices(u-4,4,0,l),this._computeVertices(0,4,4,l)):this._computeVertices(6*j+2,8,0,l)),this.addCurvePosition(W,l[0],l[1],l[2],l[3],l[4],l[5],l[6],l[7],o,V,n)}}},n.prototype.addCurvePosition=function(t,e,n,i,r,a,o,s,c,l,u,h){if(0===t)return l[u]=e,l[u+1]=n,void(l[u+2]=0);if(1===t)return l[u]=s,l[u+1]=c,void(l[u+2]=0);var f=1-t,_=f*f,p=t*t,d=_*f,m=_*t*3,g=f*p*3,v=t*p,y=d*e+m*i+g*a+v*s,x=d*n+m*r+g*o+v*c;l[u]=y,l[u+1]=x,l[u+2]=h?Math.atan2(x-(d*n+m*r+g*o),y-(d*e+m*i+g*a)):0},n.prototype.init=function(t,e){this._constraintData=t,this._armature=e;var n=t;this.pathOffset=n.pathDisplayData.vertices.offset,this.position=n.position,this.spacing=n.spacing,this.rotateOffset=n.rotateOffset,this.rotateMix=n.rotateMix,this.translateMix=n.translateMix,this._root=this._armature.getBone(n.root.name),this._target=this._armature.getBone(n.target.name),this._pathSlot=this._armature.getSlot(n.pathSlot.name);for(var i=0,r=n.bones.length;i<r;i++){var a=this._armature.getBone(n.bones[i].name);null!==a&&this._bones.push(a)}2===n.rotateMode&&(this._boneLengths.length=this._bones.length),this._root._hasConstraint=!0},n.prototype.update=function(){var e=this._pathSlot;if(null!==e._deformVertices&&null!==e._deformVertices.verticesData&&e._deformVertices.verticesData.offset===this.pathOffset){var n=this._constraintData,i=e._displayData,r=!1,a=e._deformVertices;if(this._root._childrenTransformDirty?(this._updatePathVertices(i.vertices),r=!0):null!==a&&(a.verticesDirty||a.isBonesUpdate())&&(this._updatePathVertices(i.vertices),a.verticesDirty=!1,r=!0),r||this.dirty){var o=n.positionMode,s=n.spacingMode,c=n.rotateMode,l=this._bones,u=0===s,h=2===c,f=0===c,_=l.length,p=f?_:_+1,d=this.spacing,m=this._spaces;if(m.length=p,h||u){m[0]=0;for(var g=0,v=p-1;g<v;g++){(D=l[g]).updateByConstraint();var y=D._boneData.length,x=y*(O=D.globalTransformMatrix).a,S=y*O.b,T=Math.sqrt(x*x+S*S);h&&(this._boneLengths[g]=T),m[g+1]=(y+d)*T/y}}else for(g=0;g<p;g++)m[g]=d;this._computeBezierCurve(i,p,f,1===o,2===s);var A,E=this._positions,C=this.rotateOffset,b=E[0],w=E[1];0===C?A=1===c:(A=!1,null!==(D=e.parent)&&(C*=(O=D.globalTransformMatrix).a*O.d-O.b*O.c>0?t.Transform.DEG_RAD:-t.Transform.DEG_RAD));for(var P=this.rotateMix,I=this.translateMix,R=(g=0,3);g<_;g++,R+=3){var D,O;(D=l[g]).updateByConstraint(),(O=D.globalTransformMatrix).tx+=(b-O.tx)*I,O.ty+=(w-O.ty)*I;var M=(x=E[R])-b,N=(S=E[R+1])-w;if(h){var L=this._boneLengths[g],B=(Math.sqrt(M*M+N*N)/L-1)*P+1;O.a*=B,O.b*=B}if(b=x,w=S,P>0){var F=O.a,z=O.b,U=O.c,k=O.d,G=void 0,H=void 0,V=void 0;if(G=f?E[R-1]:Math.atan2(N,M),G-=Math.atan2(z,F),A){H=Math.cos(G),V=Math.sin(G);var j=D._boneData.length;b+=(j*(H*F-V*z)-M)*P,w+=(j*(V*F+H*z)-N)*P}else G+=C;G>t.Transform.PI?G-=t.Transform.PI_D:G<-t.Transform.PI&&(G+=t.Transform.PI_D),G*=P,H=Math.cos(G),V=Math.sin(G),O.a=H*F-V*z,O.b=V*F+H*z,O.c=H*U-V*k,O.d=V*U+H*k}D.global.fromMatrix(O)}this.dirty=!1}}},n.prototype.invalidUpdate=function(){},n}(e);t.PathConstraint=i}(j_t||(j_t={})),function(t){var e=function(){function t(t){void 0===t&&(t=0),this.time=0,this.timeScale=1,this._systemTime=0,this._animatebles=[],this._clock=null,this.time=t,this._systemTime=.001*(new Date).getTime()}return t.prototype.advanceTime=function(t){t!=t&&(t=0);var e=.001*Date.now();if(t<0&&(t=e-this._systemTime),this._systemTime=e,1!==this.timeScale&&(t*=this.timeScale),0!==t){t<0?this.time-=t:this.time+=t;for(var n=0,i=0,r=this._animatebles.length;n<r;++n){var a=this._animatebles[n];null!==a?(i>0&&(this._animatebles[n-i]=a,this._animatebles[n]=null),a.advanceTime(t)):i++}if(i>0){for(r=this._animatebles.length;n<r;++n){var o=this._animatebles[n];null!==o?this._animatebles[n-i]=o:i++}this._animatebles.length-=i}}},t.prototype.contains=function(t){if(t===this)return!1;for(var e=t;e!==this&&null!==e;)e=e.clock;return e===this},t.prototype.add=function(t){this._animatebles.indexOf(t)<0&&(this._animatebles.push(t),t.clock=this)},t.prototype.remove=function(t){var e=this._animatebles.indexOf(t);e>=0&&(this._animatebles[e]=null,t.clock=null)},t.prototype.clear=function(){for(var t=0,e=this._animatebles;t<e.length;t++){var n=e[t];null!==n&&(n.clock=null)}},Object.defineProperty(t.prototype,"clock",{get:function(){return this._clock},set:function(t){this._clock!==t&&(null!==this._clock&&this._clock.remove(this),this._clock=t,null!==this._clock&&this._clock.add(this))},enumerable:!0,configurable:!0}),t.clock=new t,t}();t.WorldClock=e}(j_t||(j_t={})),function(t){var e=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t._animationNames=[],t._animationStates=[],t._animations={},t._animationConfig=null,t}return V_t(n,e),n.toString=function(){return"[class dragonBones.Animation]"},n.prototype._onClear=function(){for(var t=0,e=this._animationStates;t<e.length;t++)e[t].returnToPool();for(var n in this._animations)delete this._animations[n];null!==this._animationConfig&&this._animationConfig.returnToPool(),this.timeScale=1,this._lockUpdate=!1,this._animationDirty=!1,this._inheritTimeScale=1,this._animationNames.length=0,this._animationStates.length=0,this._armature=null,this._animationConfig=null,this._lastAnimationState=null},n.prototype._fadeOut=function(t){switch(t.fadeOutMode){case 1:for(var e=0,n=this._animationStates;e<n.length;e++)null===(l=n[e])._parent&&l.layer===t.layer&&l.fadeOut(t.fadeOutTime,t.pauseFadeOut);break;case 2:for(var i=0,r=this._animationStates;i<r.length;i++)null===(l=r[i])._parent&&l.group===t.group&&l.fadeOut(t.fadeOutTime,t.pauseFadeOut);break;case 3:for(var a=0,o=this._animationStates;a<o.length;a++)null===(l=o[a])._parent&&l.layer===t.layer&&l.group===t.group&&l.fadeOut(t.fadeOutTime,t.pauseFadeOut);break;case 4:for(var s=0,c=this._animationStates;s<c.length;s++){var l;null===(l=c[s])._parent&&l.fadeOut(t.fadeOutTime,t.pauseFadeOut)}}},n.prototype.init=function(e){null===this._armature&&(this._armature=e,this._animationConfig=t.BaseObject.borrowObject(t.AnimationConfig))},n.prototype.advanceTime=function(t){t<0&&(t=-t),this._armature.inheritAnimation&&null!==this._armature._parent?this._inheritTimeScale=this._armature._parent._armature.animation._inheritTimeScale*this.timeScale:this._inheritTimeScale=this.timeScale,1!==this._inheritTimeScale&&(t*=this._inheritTimeScale);var e=this._animationStates.length;if(1===e)if((p=this._animationStates[0])._fadeState>0&&p._subFadeState>0)this._armature._dragonBones.bufferObject(p),this._animationStates.length=0,this._lastAnimationState=null;else{var n=p._animationData,i=n.cacheFrameRate;if(this._animationDirty&&i>0){this._animationDirty=!1;for(var r=0,a=this._armature.getBones();r<a.length;r++){var o=a[r];o._cachedFrameIndices=n.getBoneCachedFrameIndices(o.name)}for(var s=0,c=this._armature.getSlots();s<c.length;s++){var l=c[s],u=l.rawDisplayDatas;if(null!==u&&u.length>0){var h=u[0];if(null!==h&&h.parent===this._armature.armatureData.defaultSkin){l._cachedFrameIndices=n.getSlotCachedFrameIndices(l.name);continue}}l._cachedFrameIndices=null}}p.advanceTime(t,i)}else if(e>1){for(var f=0,_=0;f<e;++f){var p;(p=this._animationStates[f])._fadeState>0&&p._subFadeState>0?(_++,this._armature._dragonBones.bufferObject(p),this._animationDirty=!0,this._lastAnimationState===p&&(this._lastAnimationState=null)):(_>0&&(this._animationStates[f-_]=p),p.advanceTime(t,0)),f===e-1&&_>0&&(this._animationStates.length-=_,null===this._lastAnimationState&&this._animationStates.length>0&&(this._lastAnimationState=this._animationStates[this._animationStates.length-1]))}this._armature._cacheFrameIndex=-1}else this._armature._cacheFrameIndex=-1},n.prototype.reset=function(){for(var t=0,e=this._animationStates;t<e.length;t++)e[t].returnToPool();this._animationDirty=!1,this._animationConfig.clear(),this._animationStates.length=0,this._lastAnimationState=null},n.prototype.stop=function(t){if(void 0===t&&(t=null),null!==t)null!==(i=this.getState(t))&&i.stop();else for(var e=0,n=this._animationStates;e<n.length;e++){var i;(i=n[e]).stop()}},n.prototype.playConfig=function(e){var n=e.animation;if(!(n in this._animations))return console.warn("Non-existent animation.\n","DragonBones name: "+this._armature.armatureData.parent.name,"Armature name: "+this._armature.name,"Animation name: "+n),null;var i=this._animations[n];if(5===e.fadeOutMode)for(var r=0,a=this._animationStates;r<a.length;r++){var o=a[r];if(o._animationData===i)return o}0===this._animationStates.length?e.fadeInTime=0:e.fadeInTime<0&&(e.fadeInTime=i.fadeInTime),e.fadeOutTime<0&&(e.fadeOutTime=e.fadeInTime),e.timeScale<=-100&&(e.timeScale=1/i.scale),i.frameCount>1?(e.position<0?(e.position%=i.duration,e.position=i.duration-e.position):e.position===i.duration?e.position-=1e-6:e.position>i.duration&&(e.position%=i.duration),e.duration>0&&e.position+e.duration>i.duration&&(e.duration=i.duration-e.position),e.playTimes<0&&(e.playTimes=i.playTimes)):(e.playTimes=1,e.position=0,e.duration>0&&(e.duration=0)),0===e.duration&&(e.duration=-1),this._fadeOut(e);var s=t.BaseObject.borrowObject(t.AnimationState);if(s.init(this._armature,i,e),this._animationDirty=!0,this._armature._cacheFrameIndex=-1,this._animationStates.length>0){for(var c=!1,l=0,u=this._animationStates.length;l<u;++l){if(s.layer>this._animationStates[l].layer){c=!0,this._animationStates.splice(l,0,s);break}if(l!==u-1&&s.layer>this._animationStates[l+1].layer){c=!0,this._animationStates.splice(l+1,0,s);break}}c||this._animationStates.push(s)}else this._animationStates.push(s);for(var h=0,f=this._armature.getSlots();h<f.length;h++){var _=f[h].childArmature;null!==_&&_.inheritAnimation&&_.animation.hasAnimation(n)&&null===_.animation.getState(n)&&_.animation.fadeIn(n)}var p=!1;for(var d in i.animationTimelines){this._lockUpdate||(p=!0,this._lockUpdate=!0);var m=this.fadeIn(d,e.fadeInTime,1,s.layer,null,0);null!==m&&(m.resetToPose=!1,m._parent=s,m.stop())}return p&&(this._lockUpdate=!1),this._lockUpdate||(e.fadeInTime<=0&&this._armature.advanceTime(0),this._lastAnimationState=s),s},n.prototype.play=function(t,e){if(void 0===t&&(t=null),void 0===e&&(e=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=e,this._animationConfig.fadeInTime=0,this._animationConfig.animation=null!==t?t:"",null!==t&&t.length>0)this.playConfig(this._animationConfig);else if(null===this._lastAnimationState){var n=this._armature.armatureData.defaultAnimation;null!==n&&(this._animationConfig.animation=n.name,this.playConfig(this._animationConfig))}else this._lastAnimationState.isPlaying||this._lastAnimationState.isCompleted?(this._animationConfig.animation=this._lastAnimationState.name,this.playConfig(this._animationConfig)):this._lastAnimationState.play();return this._lastAnimationState},n.prototype.fadeIn=function(t,e,n,i,r,a){return void 0===e&&(e=-1),void 0===n&&(n=-1),void 0===i&&(i=0),void 0===r&&(r=null),void 0===a&&(a=3),this._animationConfig.clear(),this._animationConfig.fadeOutMode=a,this._animationConfig.playTimes=n,this._animationConfig.layer=i,this._animationConfig.fadeInTime=e,this._animationConfig.animation=t,this._animationConfig.group=null!==r?r:"",this.playConfig(this._animationConfig)},n.prototype.gotoAndPlayByTime=function(t,e,n){return void 0===e&&(e=0),void 0===n&&(n=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=n,this._animationConfig.position=e,this._animationConfig.fadeInTime=0,this._animationConfig.animation=t,this.playConfig(this._animationConfig)},n.prototype.gotoAndPlayByFrame=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=n,this._animationConfig.fadeInTime=0,this._animationConfig.animation=t;var i=t in this._animations?this._animations[t]:null;return null!==i&&(this._animationConfig.position=i.duration*e/i.frameCount),this.playConfig(this._animationConfig)},n.prototype.gotoAndPlayByProgress=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=n,this._animationConfig.fadeInTime=0,this._animationConfig.animation=t;var i=t in this._animations?this._animations[t]:null;return null!==i&&(this._animationConfig.position=i.duration*(e>0?e:0)),this.playConfig(this._animationConfig)},n.prototype.gotoAndStopByTime=function(t,e){void 0===e&&(e=0);var n=this.gotoAndPlayByTime(t,e,1);return null!==n&&n.stop(),n},n.prototype.gotoAndStopByFrame=function(t,e){void 0===e&&(e=0);var n=this.gotoAndPlayByFrame(t,e,1);return null!==n&&n.stop(),n},n.prototype.gotoAndStopByProgress=function(t,e){void 0===e&&(e=0);var n=this.gotoAndPlayByProgress(t,e,1);return null!==n&&n.stop(),n},n.prototype.getState=function(t){for(var e=this._animationStates.length;e--;){var n=this._animationStates[e];if(n.name===t)return n}return null},n.prototype.hasAnimation=function(t){return t in this._animations},n.prototype.getStates=function(){return this._animationStates},Object.defineProperty(n.prototype,"isPlaying",{get:function(){for(var t=0,e=this._animationStates;t<e.length;t++)if(e[t].isPlaying)return!0;return!1},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isCompleted",{get:function(){for(var t=0,e=this._animationStates;t<e.length;t++)if(!e[t].isCompleted)return!1;return this._animationStates.length>0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"lastAnimationName",{get:function(){return null!==this._lastAnimationState?this._lastAnimationState.name:""},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"animationNames",{get:function(){return this._animationNames},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"animations",{get:function(){return this._animations},set:function(t){if(this._animations!==t){for(var e in this._animationNames.length=0,this._animations)delete this._animations[e];for(var e in t)this._animationNames.push(e),this._animations[e]=t[e]}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"animationConfig",{get:function(){return this._animationConfig.clear(),this._animationConfig},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"lastAnimationState",{get:function(){return this._lastAnimationState},enumerable:!0,configurable:!0}),n.prototype.gotoAndPlay=function(t,e,n,i,r,a,o){void 0===e&&(e=-1),void 0===n&&(n=-1),void 0===i&&(i=-1),void 0===r&&(r=0),void 0===a&&(a=null),void 0===o&&(o=3),console.warn("Deprecated."),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.fadeOutMode=o,this._animationConfig.playTimes=i,this._animationConfig.layer=r,this._animationConfig.fadeInTime=e,this._animationConfig.animation=t,this._animationConfig.group=null!==a?a:"";var s=this._animations[t];return s&&n>0&&(this._animationConfig.timeScale=s.duration/n),this.playConfig(this._animationConfig)},n.prototype.gotoAndStop=function(t,e){return void 0===e&&(e=0),console.warn("Deprecated."),this.gotoAndStopByTime(t,e)},Object.defineProperty(n.prototype,"animationList",{get:function(){return console.warn("Deprecated."),this._animationNames},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"animationDataList",{get:function(){console.warn("Deprecated.");for(var t=[],e=0,n=this._animationNames.length;e<n;++e)t.push(this._animations[this._animationNames[e]]);return t},enumerable:!0,configurable:!0}),n}(t.BaseObject);t.Animation=e}(j_t||(j_t={})),function(t){var e=function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return t._blendState=new i,t._boneMask=[],t._boneTimelines=[],t._surfaceTimelines=[],t._slotTimelines=[],t._constraintTimelines=[],t._animationTimelines=[],t._poseTimelines=[],t._bonePoses={},t._actionTimeline=null,t._zOrderTimeline=null,t._parent=null,t}return V_t(r,e),r.toString=function(){return"[class dragonBones.AnimationState]"},r.prototype._onClear=function(){for(var t=0,e=this._boneTimelines;t<e.length;t++)e[t].returnToPool();for(var n=0,i=this._surfaceTimelines;n<i.length;n++)i[n].returnToPool();for(var r=0,a=this._slotTimelines;r<a.length;r++)a[r].returnToPool();for(var o=0,s=this._constraintTimelines;o<s.length;o++)s[o].returnToPool();for(var c=0,l=this._animationTimelines;c<l.length;c++)l[c].returnToPool();for(var u in this._bonePoses)this._bonePoses[u].returnToPool(),delete this._bonePoses[u];null!==this._actionTimeline&&this._actionTimeline.returnToPool(),null!==this._zOrderTimeline&&this._zOrderTimeline.returnToPool(),this.actionEnabled=!1,this.additiveBlending=!1,this.displayControl=!1,this.resetToPose=!1,this.playTimes=1,this.layer=0,this.timeScale=1,this.weight=1,this.autoFadeOutTime=0,this.fadeTotalTime=0,this.name="",this.group="",this._timelineDirty=2,this._playheadState=0,this._fadeState=-1,this._subFadeState=-1,this._position=0,this._duration=0,this._fadeTime=0,this._time=0,this._fadeProgress=0,this._weightResult=0,this._blendState.clear(),this._boneMask.length=0,this._boneTimelines.length=0,this._surfaceTimelines.length=0,this._slotTimelines.length=0,this._constraintTimelines.length=0,this._animationTimelines.length=0,this._poseTimelines.length=0,this._animationData=null,this._armature=null,this._actionTimeline=null,this._zOrderTimeline=null,this._parent=null},r.prototype._updateTimelines=function(){for(var e=0,n=this._armature._constraints;e<n.length;e++){var i=n[e];if(null!==(c=this._animationData.getConstraintTimelines(i.name)))for(var r=0,a=c;r<a.length;r++)switch((f=a[r]).type){case 30:(_=t.BaseObject.borrowObject(t.IKConstraintTimelineState)).constraint=i,_.init(this._armature,this,f),this._constraintTimelines.push(_)}else this.resetToPose&&((_=t.BaseObject.borrowObject(t.IKConstraintTimelineState)).constraint=i,_.init(this._armature,this,null),this._constraintTimelines.push(_),this._poseTimelines.push(_))}for(var o=0,s=this._armature.animation.getStates();o<s.length;o++){var c,l=s[o];if(l._parent===this&&null!==(c=this._animationData.getAnimationTimelines(l.name)))for(var u=0,h=c;u<h.length;u++){var f;switch((f=h[u]).type){case 40:var _;(_=t.BaseObject.borrowObject(t.AnimationTimelineState)).animationState=l,_.init(this._armature,this,f),this._animationTimelines.push(_)}}}},r.prototype._updateBoneAndSlotTimelines=function(){for(var e={},i=0,r=this._boneTimelines;i<r.length;i++)(c=(v=r[i]).bone.name)in e||(e[c]=[]),e[c].push(v);for(var a=0,o=this._armature.getBones();a<o.length;a++){var s=o[a],c=s.name;if(this.containsBoneMask(c))if(c in e)delete e[c];else if(0===s._boneData.type){var l=this._animationData.getBoneTimelines(c),u=c in this._bonePoses?this._bonePoses[c]:this._bonePoses[c]=t.BaseObject.borrowObject(n);if(null!==l)for(var h=0,f=l;h<f.length;h++)switch((D=f[h]).type){case 10:(v=t.BaseObject.borrowObject(t.BoneAllTimelineState)).bone=s,v.bonePose=u,v.init(this._armature,this,D),this._boneTimelines.push(v);break;case 11:(v=t.BaseObject.borrowObject(t.BoneTranslateTimelineState)).bone=s,v.bonePose=u,v.init(this._armature,this,D),this._boneTimelines.push(v);break;case 12:(v=t.BaseObject.borrowObject(t.BoneRotateTimelineState)).bone=s,v.bonePose=u,v.init(this._armature,this,D),this._boneTimelines.push(v);break;case 13:(v=t.BaseObject.borrowObject(t.BoneScaleTimelineState)).bone=s,v.bonePose=u,v.init(this._armature,this,D),this._boneTimelines.push(v)}else this.resetToPose&&((v=t.BaseObject.borrowObject(t.BoneAllTimelineState)).bone=s,v.bonePose=u,v.init(this._armature,this,null),this._boneTimelines.push(v),this._poseTimelines.push(v))}else if(1===s._boneData.type)if(null!==(l=this._animationData.getSurfaceTimelines(c)))for(var _=0,p=l;_<p.length;_++)switch((D=p[_]).type){case 50:(v=t.BaseObject.borrowObject(t.SurfaceTimelineState)).surface=s,v.init(this._armature,this,D),this._surfaceTimelines.push(v)}else this.resetToPose&&((v=t.BaseObject.borrowObject(t.SurfaceTimelineState)).surface=s,v.init(this._armature,this,null),this._surfaceTimelines.push(v),this._poseTimelines.push(v))}for(var d in e)for(var m=0,g=e[d];m<g.length;m++){var v=g[m];this._boneTimelines.splice(this._boneTimelines.indexOf(v),1),v.returnToPool()}for(var y={},x=[],S=0,T=this._slotTimelines;S<T.length;S++)(c=(v=T[S]).slot.name)in y||(y[c]=[]),y[c].push(v);for(var A=0,E=this._armature.getSlots();A<E.length;A++){var C=E[A],b=C.parent.name;if(this.containsBoneMask(b))if(c=C.name,l=this._animationData.getSlotTimelines(c),c in y)delete y[c];else{var w=!1,P=!1;if(x.length=0,null!==l)for(var I=0,R=l;I<R.length;I++){var D;switch((D=R[I]).type){case 20:(v=t.BaseObject.borrowObject(t.SlotDislayTimelineState)).slot=C,v.init(this._armature,this,D),this._slotTimelines.push(v),w=!0;break;case 21:(v=t.BaseObject.borrowObject(t.SlotColorTimelineState)).slot=C,v.init(this._armature,this,D),this._slotTimelines.push(v),P=!0;break;case 22:(v=t.BaseObject.borrowObject(t.DeformTimelineState)).slot=C,v.init(this._armature,this,D),this._slotTimelines.push(v),x.push(v.vertexOffset)}}if(this.resetToPose&&(w||((v=t.BaseObject.borrowObject(t.SlotDislayTimelineState)).slot=C,v.init(this._armature,this,null),this._slotTimelines.push(v),this._poseTimelines.push(v)),P||((v=t.BaseObject.borrowObject(t.SlotColorTimelineState)).slot=C,v.init(this._armature,this,null),this._slotTimelines.push(v),this._poseTimelines.push(v)),null!==C.rawDisplayDatas))for(var O=0,M=C.rawDisplayDatas;O<M.length;O++){var N=M[O];if(null!==N&&2===N.type){var L=N.vertices.offset;x.indexOf(L)<0&&((v=t.BaseObject.borrowObject(t.DeformTimelineState)).vertexOffset=L,v.slot=C,v.init(this._armature,this,null),this._slotTimelines.push(v),this._poseTimelines.push(v))}}}}for(var d in y)for(var B=0,F=y[d];B<F.length;B++)v=F[B],this._slotTimelines.splice(this._slotTimelines.indexOf(v),1),v.returnToPool()},r.prototype._advanceFadeTime=function(e){var n,i=this._fadeState>0;if(this._subFadeState<0){this._subFadeState=0;var r=i?t.EventObject.FADE_OUT:t.EventObject.FADE_IN;this._armature.eventDispatcher.hasDBEventListener(r)&&((n=t.BaseObject.borrowObject(t.EventObject)).type=r,n.armature=this._armature,n.animationState=this,this._armature._dragonBones.bufferEvent(n))}(e<0&&(e=-e),this._fadeTime+=e,this._fadeTime>=this.fadeTotalTime?(this._subFadeState=1,this._fadeProgress=i?0:1):this._fadeTime>0?this._fadeProgress=i?1-this._fadeTime/this.fadeTotalTime:this._fadeTime/this.fadeTotalTime:this._fadeProgress=i?1:0,this._subFadeState>0)&&(i||(this._playheadState|=1,this._fadeState=0),r=i?t.EventObject.FADE_OUT_COMPLETE:t.EventObject.FADE_IN_COMPLETE,this._armature.eventDispatcher.hasDBEventListener(r)&&((n=t.BaseObject.borrowObject(t.EventObject)).type=r,n.armature=this._armature,n.animationState=this,this._armature._dragonBones.bufferEvent(n)))},r.prototype.init=function(e,n,i){if(null===this._armature){if(this._armature=e,this._animationData=n,this.resetToPose=i.resetToPose,this.additiveBlending=i.additiveBlending,this.displayControl=i.displayControl,this.actionEnabled=i.actionEnabled,this.layer=i.layer,this.playTimes=i.playTimes,this.timeScale=i.timeScale,this.fadeTotalTime=i.fadeInTime,this.autoFadeOutTime=i.autoFadeOutTime,this.weight=i.weight,this.name=i.name.length>0?i.name:i.animation,this.group=i.group,i.pauseFadeIn?this._playheadState=2:this._playheadState=3,i.duration<0?(this._position=0,this._duration=this._animationData.duration,0!==i.position?this.timeScale>=0?this._time=i.position:this._time=i.position-this._duration:this._time=0):(this._position=i.position,this._duration=i.duration,this._time=0),this.timeScale<0&&0===this._time&&(this._time=-1e-6),this.fadeTotalTime<=0&&(this._fadeProgress=.999999),i.boneMask.length>0){this._boneMask.length=i.boneMask.length;for(var r=0,a=this._boneMask.length;r<a;++r)this._boneMask[r]=i.boneMask[r]}this._actionTimeline=t.BaseObject.borrowObject(t.ActionTimelineState),this._actionTimeline.init(this._armature,this,this._animationData.actionTimeline),this._actionTimeline.currentTime=this._time,this._actionTimeline.currentTime<0&&(this._actionTimeline.currentTime=this._duration-this._actionTimeline.currentTime),null!==this._animationData.zOrderTimeline&&(this._zOrderTimeline=t.BaseObject.borrowObject(t.ZOrderTimelineState),this._zOrderTimeline.init(this._armature,this,this._animationData.zOrderTimeline))}},r.prototype.advanceTime=function(e,n){if(this._blendState.dirty=!1,0===this._fadeState&&0===this._subFadeState||this._advanceFadeTime(e),3===this._playheadState&&(1!==this.timeScale&&(e*=this.timeScale),this._time+=e),0!==this._timelineDirty&&(2===this._timelineDirty&&this._updateTimelines(),this._timelineDirty=0,this._updateBoneAndSlotTimelines()),0!==this.weight){var i=0===this._fadeState&&n>0,r=!0,a=!0,o=this._time;if(this._weightResult=this.weight*this._fadeProgress,null!==this._parent&&(this._weightResult*=this._parent._weightResult/this._parent._fadeProgress),this._actionTimeline.playState<=0&&this._actionTimeline.update(o),i){var s=2*n;this._actionTimeline.currentTime=Math.floor(this._actionTimeline.currentTime*s)/s}if(null!==this._zOrderTimeline&&this._zOrderTimeline.playState<=0&&this._zOrderTimeline.update(o),i){var c=Math.floor(this._actionTimeline.currentTime*n);this._armature._cacheFrameIndex===c?(r=!1,a=!1):(this._armature._cacheFrameIndex=c,this._animationData.cachedFrames[c]?a=!1:this._animationData.cachedFrames[c]=!0)}if(r){if(a)for(var l=0,u=this._boneTimelines.length;l<u;++l)(d=this._boneTimelines[l]).playState<=0&&d.update(o),(l===u-1||d.bone!==this._boneTimelines[l+1].bone)&&0!==(h=d.bone._blendState.update(this._weightResult,this.layer))&&d.blend(h);for(l=0,u=this._surfaceTimelines.length;l<u;++l){var h=(d=this._surfaceTimelines[l]).surface._blendState.update(this._weightResult,this.layer);d.playState<=0&&d.update(o),0!==h&&d.blend(h)}if(this.displayControl)for(l=0,u=this._slotTimelines.length;l<u;++l){var f=(d=this._slotTimelines[l]).slot.displayController;null!==f&&f!==this.name&&f!==this.group||d.playState<=0&&d.update(o)}for(l=0,u=this._constraintTimelines.length;l<u;++l)(d=this._constraintTimelines[l]).playState<=0&&d.update(o);for(l=0,u=this._animationTimelines.length;l<u;++l)h=(d=this._animationTimelines[l]).animationState._blendState.update(this._weightResult,this.layer),d.playState<=0&&d.update(o),0!==h&&d.blend(h)}if(0===this._fadeState){if(this._subFadeState>0&&(this._subFadeState=0,this._poseTimelines.length>0)){for(var _=0,p=this._poseTimelines;_<p.length;_++){var d;(d=p[_])instanceof t.BoneTimelineState?this._boneTimelines.splice(this._boneTimelines.indexOf(d),1):d instanceof t.SurfaceTimelineState?this._surfaceTimelines.splice(this._surfaceTimelines.indexOf(d),1):d instanceof t.SlotTimelineState?this._slotTimelines.splice(this._slotTimelines.indexOf(d),1):d instanceof t.ConstraintTimelineState&&this._constraintTimelines.splice(this._constraintTimelines.indexOf(d),1),d.returnToPool()}this._poseTimelines.length=0}this._actionTimeline.playState>0&&this.autoFadeOutTime>=0&&this.fadeOut(this.autoFadeOutTime)}}},r.prototype.play=function(){this._playheadState=3},r.prototype.stop=function(){this._playheadState&=1},r.prototype.fadeOut=function(t,e){if(void 0===e&&(e=!0),t<0&&(t=0),e&&(this._playheadState&=2),this._fadeState>0){if(t>this.fadeTotalTime-this._fadeTime)return}else{this._fadeState=1,this._subFadeState=-1,(t<=0||this._fadeProgress<=0)&&(this._fadeProgress=1e-6);for(var n=0,i=this._boneTimelines;n<i.length;n++)(f=i[n]).fadeOut();for(var r=0,a=this._surfaceTimelines;r<a.length;r++)(f=a[r]).fadeOut();for(var o=0,s=this._slotTimelines;o<s.length;o++)(f=s[o]).fadeOut();for(var c=0,l=this._constraintTimelines;c<l.length;c++)(f=l[c]).fadeOut();for(var u=0,h=this._animationTimelines;u<h.length;u++){var f;(f=h[u]).animationState.fadeOut(t,e),f.fadeOut()}}this.displayControl=!1,this.fadeTotalTime=this._fadeProgress>1e-6?t/this._fadeProgress:0,this._fadeTime=this.fadeTotalTime*(1-this._fadeProgress)},r.prototype.containsBoneMask=function(t){return 0===this._boneMask.length||this._boneMask.indexOf(t)>=0},r.prototype.addBoneMask=function(t,e){void 0===e&&(e=!0);var n=this._armature.getBone(t);if(null!==n){if(this._boneMask.indexOf(t)<0&&this._boneMask.push(t),e)for(var i=0,r=this._armature.getBones();i<r.length;i++){var a=r[i];this._boneMask.indexOf(a.name)<0&&n.contains(a)&&this._boneMask.push(a.name)}this._timelineDirty=1}},r.prototype.removeBoneMask=function(t,e){void 0===e&&(e=!0);var n=this._boneMask.indexOf(t);if(n>=0&&this._boneMask.splice(n,1),e){var i=this._armature.getBone(t);if(null!==i){var r=this._armature.getBones();if(this._boneMask.length>0)for(var a=0,o=r;a<o.length;a++){var s=o[a],c=this._boneMask.indexOf(s.name);c>=0&&i.contains(s)&&this._boneMask.splice(c,1)}else for(var l=0,u=r;l<u.length;l++)(s=u[l])!==i&&(i.contains(s)||this._boneMask.push(s.name))}}this._timelineDirty=1},r.prototype.removeAllBoneMask=function(){this._boneMask.length=0,this._timelineDirty=1},Object.defineProperty(r.prototype,"isFadeIn",{get:function(){return this._fadeState<0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isFadeOut",{get:function(){return this._fadeState>0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isFadeComplete",{get:function(){return 0===this._fadeState},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isPlaying",{get:function(){return 0!=(2&this._playheadState)&&this._actionTimeline.playState<=0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isCompleted",{get:function(){return this._actionTimeline.playState>0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"currentPlayTimes",{get:function(){return this._actionTimeline.currentPlayTimes},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"totalTime",{get:function(){return this._duration},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"currentTime",{get:function(){return this._actionTimeline.currentTime},set:function(t){var e=this._actionTimeline.currentPlayTimes-(this._actionTimeline.playState>0?1:0);if((t<0||this._duration<t)&&(t=t%this._duration+e*this._duration)<0&&(t+=this._duration),this.playTimes>0&&e===this.playTimes-1&&t===this._duration&&(t=this._duration-1e-6),this._time!==t){this._time=t,this._actionTimeline.setCurrentTime(this._time),null!==this._zOrderTimeline&&(this._zOrderTimeline.playState=-1);for(var n=0,i=this._boneTimelines;n<i.length;n++)i[n].playState=-1;for(var r=0,a=this._slotTimelines;r<a.length;r++)a[r].playState=-1}},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"animationData",{get:function(){return this._animationData},enumerable:!0,configurable:!0}),r}(t.BaseObject);t.AnimationState=e;var n=function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.current=new t.Transform,n.delta=new t.Transform,n.result=new t.Transform,n}return V_t(n,e),n.toString=function(){return"[class dragonBones.BonePose]"},n.prototype._onClear=function(){this.current.identity(),this.delta.identity(),this.result.identity()},n}(t.BaseObject);t.BonePose=n;var i=function(){function t(){}return t.prototype.update=function(t,e){if(this.dirty){if(!(this.leftWeight>0))return 0;if(this.layer!==e){if(this.layerWeight>=this.leftWeight)return this.leftWeight=0,0;this.layer=e,this.leftWeight-=this.layerWeight,this.layerWeight=0}return t*=this.leftWeight,this.layerWeight+=t,this.blendWeight=t,2}return this.dirty=!0,this.layer=e,this.layerWeight=t,this.leftWeight=1,this.blendWeight=t,1},t.prototype.clear=function(){this.dirty=!1,this.layer=0,this.leftWeight=0,this.layerWeight=0,this.blendWeight=0},t}();t.BlendState=i}(j_t||(j_t={})),function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return V_t(e,t),e.prototype._onClear=function(){this.playState=-1,this.currentPlayTimes=-1,this.currentTime=-1,this._tweenState=0,this._frameRate=0,this._frameValueOffset=0,this._frameCount=0,this._frameOffset=0,this._frameIndex=-1,this._frameRateR=0,this._position=0,this._duration=0,this._timeScale=1,this._timeOffset=0,this._dragonBonesData=null,this._animationData=null,this._timelineData=null,this._armature=null,this._animationState=null,this._actionTimeline=null,this._frameArray=null,this._frameIntArray=null,this._frameFloatArray=null,this._timelineArray=null,this._frameIndices=null},e.prototype._setCurrentTime=function(t){var e=this.playState,n=this.currentPlayTimes,i=this.currentTime;if(null!==this._actionTimeline&&this._frameCount<=1)this.playState=this._actionTimeline.playState>=0?1:-1,this.currentPlayTimes=1,this.currentTime=this._actionTimeline.currentTime;else if(null===this._actionTimeline||1!==this._timeScale||0!==this._timeOffset){var r=this._animationState.playTimes,a=r*this._duration;t*=this._timeScale,0!==this._timeOffset&&(t+=this._timeOffset*this._animationData.duration),r>0&&(t>=a||t<=-a)?(this.playState<=0&&3===this._animationState._playheadState&&(this.playState=1),this.currentPlayTimes=r,this.currentTime=t<0?0:this._duration+1e-6):(0!==this.playState&&3===this._animationState._playheadState&&(this.playState=0),t<0?(t=-t,this.currentPlayTimes=Math.floor(t/this._duration),this.currentTime=this._duration-t%this._duration):(this.currentPlayTimes=Math.floor(t/this._duration),this.currentTime=t%this._duration)),this.currentTime+=this._position}else this.playState=this._actionTimeline.playState,this.currentPlayTimes=this._actionTimeline.currentPlayTimes,this.currentTime=this._actionTimeline.currentTime;return(this.currentPlayTimes!==n||this.currentTime!==i)&&((e<0&&this.playState!==e||this.playState<=0&&this.currentPlayTimes!==n)&&(this._frameIndex=-1),!0)},e.prototype.init=function(t,e,n){this._armature=t,this._animationState=e,this._timelineData=n,this._actionTimeline=this._animationState._actionTimeline,this===this._actionTimeline&&(this._actionTimeline=null),this._animationData=this._animationState._animationData,this._frameRate=this._animationData.parent.frameRate,this._frameRateR=1/this._frameRate,this._position=this._animationState._position,this._duration=this._animationState._duration,this._dragonBonesData=this._animationData.parent.parent,null!==this._timelineData&&(this._frameIntArray=this._dragonBonesData.frameIntArray,this._frameFloatArray=this._dragonBonesData.frameFloatArray,this._frameArray=this._dragonBonesData.frameArray,this._timelineArray=this._dragonBonesData.timelineArray,this._frameIndices=this._dragonBonesData.frameIndices,this._frameCount=this._timelineArray[this._timelineData.offset+2],this._frameValueOffset=this._timelineArray[this._timelineData.offset+4],this._timeScale=100/this._timelineArray[this._timelineData.offset+0],this._timeOffset=.01*this._timelineArray[this._timelineData.offset+1])},e.prototype.fadeOut=function(){},e.prototype.update=function(t){if(this._setCurrentTime(t)){if(this._frameCount>1){var e=Math.floor(this.currentTime*this._frameRate),n=this._frameIndices[this._timelineData.frameIndicesOffset+e];this._frameIndex!==n&&(this._frameIndex=n,this._frameOffset=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5+this._frameIndex],this._onArriveAtFrame())}else this._frameIndex<0&&(this._frameIndex=0,null!==this._timelineData&&(this._frameOffset=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5]),this._onArriveAtFrame());0!==this._tweenState&&this._onUpdateFrame()}},e}(t.BaseObject);t.TimelineState=e;var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return V_t(e,t),e._getEasingValue=function(t,e,n){var i=e;switch(t){case 3:i=Math.pow(e,2);break;case 4:i=1-Math.pow(1-e,2);break;case 5:i=.5*(1-Math.cos(e*Math.PI))}return(i-e)*n+e},e._getEasingCurveValue=function(t,e,n,i){if(t<=0)return 0;if(t>=1)return 1;var r=n+1,a=Math.floor(t*r),o=0===a?0:e[i+a-1];return 1e-4*(o+((a===r-1?1e4:e[i+a])-o)*(t*r-a))},e.prototype._onClear=function(){t.prototype._onClear.call(this),this._tweenType=0,this._curveCount=0,this._framePosition=0,this._frameDurationR=0,this._tweenProgress=0,this._tweenEasing=0},e.prototype._onArriveAtFrame=function(){if(this._frameCount>1&&(this._frameIndex!==this._frameCount-1||0===this._animationState.playTimes||this._animationState.currentPlayTimes<this._animationState.playTimes-1))if(this._tweenType=this._frameArray[this._frameOffset+1],this._tweenState=0===this._tweenType?1:2,2===this._tweenType?this._curveCount=this._frameArray[this._frameOffset+2]:0!==this._tweenType&&1!==this._tweenType&&(this._tweenEasing=.01*this._frameArray[this._frameOffset+2]),this._framePosition=this._frameArray[this._frameOffset]*this._frameRateR,this._frameIndex===this._frameCount-1)this._frameDurationR=1/(this._animationData.duration-this._framePosition);else{var t=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5+this._frameIndex+1],e=this._frameArray[t]*this._frameRateR-this._framePosition;this._frameDurationR=e>0?1/e:0}else this._tweenState=1},e.prototype._onUpdateFrame=function(){2===this._tweenState?(this._tweenProgress=(this.currentTime-this._framePosition)*this._frameDurationR,2===this._tweenType?this._tweenProgress=e._getEasingCurveValue(this._tweenProgress,this._frameArray,this._curveCount,this._frameOffset+3):1!==this._tweenType&&(this._tweenProgress=e._getEasingValue(this._tweenType,this._tweenProgress,this._tweenEasing))):this._tweenProgress=0},e}(e);t.TweenTimelineState=n;var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return V_t(e,t),e.prototype._onClear=function(){t.prototype._onClear.call(this),this.bone=null,this.bonePose=null},e.prototype.blend=function(t){var e=this.bone._blendState.blendWeight,n=this.bone.animationPose,i=this.bonePose.result;2===t?(n.x+=i.x*e,n.y+=i.y*e,n.rotation+=i.rotation*e,n.skew+=i.skew*e,n.scaleX+=(i.scaleX-1)*e,n.scaleY+=(i.scaleY-1)*e):1!==e?(n.x=i.x*e,n.y=i.y*e,n.rotation=i.rotation*e,n.skew=i.skew*e,n.scaleX=(i.scaleX-1)*e+1,n.scaleY=(i.scaleY-1)*e+1):(n.x=i.x,n.y=i.y,n.rotation=i.rotation,n.skew=i.skew,n.scaleX=i.scaleX,n.scaleY=i.scaleY),0===this._animationState._fadeState&&0===this._animationState._subFadeState||(this.bone._transformDirty=!0)},e}(n);t.BoneTimelineState=i;var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return V_t(e,t),e.prototype._onClear=function(){t.prototype._onClear.call(this),this.slot=null},e}(n);t.SlotTimelineState=r;var a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return V_t(e,t),e.prototype._onClear=function(){t.prototype._onClear.call(this),this.constraint=null},e}(n);t.ConstraintTimelineState=a}(j_t||(j_t={})),function(t){var e=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return V_t(n,e),n.toString=function(){return"[class dragonBones.ActionTimelineState]"},n.prototype._onCrossFrame=function(e){var n=this._armature.eventDispatcher;if(this._animationState.actionEnabled)for(var i=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5+e],r=this._frameArray[i+1],a=this._animationData.parent.actions,o=0;o<r;++o){var s=a[this._frameArray[i+2+o]];if(0===s.type)(c=t.BaseObject.borrowObject(t.EventObject)).time=this._frameArray[i]/this._frameRate,c.animationState=this._animationState,t.EventObject.actionDataToInstance(s,c,this._armature),this._armature._bufferAction(c,!0);else{var c,l=10===s.type?t.EventObject.FRAME_EVENT:t.EventObject.SOUND_EVENT;(11===s.type||n.hasDBEventListener(l))&&((c=t.BaseObject.borrowObject(t.EventObject)).time=this._frameArray[i]/this._frameRate,c.animationState=this._animationState,t.EventObject.actionDataToInstance(s,c,this._armature),this._armature._dragonBones.bufferEvent(c))}}},n.prototype._onArriveAtFrame=function(){},n.prototype._onUpdateFrame=function(){},n.prototype.update=function(e){var n=this.playState,i=this.currentPlayTimes,r=this.currentTime;if(this._setCurrentTime(e)){var a=this._armature.eventDispatcher;if(n<0){if(this.playState===n)return;if(this._animationState.displayControl&&this._animationState.resetToPose&&this._armature._sortZOrder(null,0),i=this.currentPlayTimes,a.hasDBEventListener(t.EventObject.START)){var o=t.BaseObject.borrowObject(t.EventObject);o.type=t.EventObject.START,o.armature=this._armature,o.animationState=this._animationState,this._armature._dragonBones.bufferEvent(o)}}var s=this._animationState.timeScale<0,c=null,l=null;if(this.currentPlayTimes!==i&&(a.hasDBEventListener(t.EventObject.LOOP_COMPLETE)&&((c=t.BaseObject.borrowObject(t.EventObject)).type=t.EventObject.LOOP_COMPLETE,c.armature=this._armature,c.animationState=this._animationState),this.playState>0&&a.hasDBEventListener(t.EventObject.COMPLETE)&&((l=t.BaseObject.borrowObject(t.EventObject)).type=t.EventObject.COMPLETE,l.armature=this._armature,l.animationState=this._animationState)),this._frameCount>1){var u=this._timelineData,h=Math.floor(this.currentTime*this._frameRate),f=this._frameIndices[u.frameIndicesOffset+h];if(this._frameIndex!==f){var _=this._frameIndex;if(this._frameIndex=f,null!==this._timelineArray)if(this._frameOffset=this._animationData.frameOffset+this._timelineArray[u.offset+5+this._frameIndex],s){if(_<0){var p=Math.floor(r*this._frameRate);_=this._frameIndices[u.frameIndicesOffset+p],this.currentPlayTimes===i&&_===f&&(_=-1)}for(;_>=0;){var d=this._animationData.frameOffset+this._timelineArray[u.offset+5+_],m=this._frameArray[d]/this._frameRate;if(this._position<=m&&m<=this._position+this._duration&&this._onCrossFrame(_),null!==c&&0===_&&(this._armature._dragonBones.bufferEvent(c),c=null),_>0?_--:_=this._frameCount-1,_===f)break}}else for(_<0&&(p=Math.floor(r*this._frameRate),_=this._frameIndices[u.frameIndicesOffset+p],d=this._animationData.frameOffset+this._timelineArray[u.offset+5+_],m=this._frameArray[d]/this._frameRate,this.currentPlayTimes===i&&(r<=m?_>0?_--:_=this._frameCount-1:_===f&&(_=-1)));_>=0&&(_<this._frameCount-1?_++:_=0,d=this._animationData.frameOffset+this._timelineArray[u.offset+5+_],m=this._frameArray[d]/this._frameRate,this._position<=m&&m<=this._position+this._duration&&this._onCrossFrame(_),null!==c&&0===_&&(this._armature._dragonBones.bufferEvent(c),c=null),_!==f););}}else this._frameIndex<0&&(this._frameIndex=0,null!==this._timelineData)&&(this._frameOffset=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5],m=this._frameArray[this._frameOffset]/this._frameRate,this.currentPlayTimes===i?r<=m&&this._onCrossFrame(this._frameIndex):this._position<=m&&(s||null===c||(this._armature._dragonBones.bufferEvent(c),c=null),this._onCrossFrame(this._frameIndex)));null!==c&&this._armature._dragonBones.bufferEvent(c),null!==l&&this._armature._dragonBones.bufferEvent(l)}},n.prototype.setCurrentTime=function(t){this._setCurrentTime(t),this._frameIndex=-1},n}(t.TimelineState);t.ActionTimelineState=e;var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return V_t(e,t),e.toString=function(){return"[class dragonBones.ZOrderTimelineState]"},e.prototype._onArriveAtFrame=function(){this.playState>=0&&(this._frameArray[this._frameOffset+1]>0?this._armature._sortZOrder(this._frameArray,this._frameOffset+2):this._armature._sortZOrder(null,0))},e.prototype._onUpdateFrame=function(){},e}(t.TimelineState);t.ZOrderTimelineState=n;var i=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return V_t(n,e),n.toString=function(){return"[class dragonBones.BoneAllTimelineState]"},n.prototype._onArriveAtFrame=function(){if(e.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var t=this._animationData.frameFloatOffset+this._frameValueOffset+6*this._frameIndex,n=this._armature._armatureData.scale,i=this._frameFloatArray,r=this.bonePose.current,a=this.bonePose.delta;r.x=i[t++]*n,r.y=i[t++]*n,r.rotation=i[t++],r.skew=i[t++],r.scaleX=i[t++],r.scaleY=i[t++],2===this._tweenState?(this._frameIndex===this._frameCount-1&&(t=this._animationData.frameFloatOffset+this._frameValueOffset),a.x=i[t++]*n-r.x,a.y=i[t++]*n-r.y,a.rotation=i[t++]-r.rotation,a.skew=i[t++]-r.skew,a.scaleX=i[t++]-r.scaleX,a.scaleY=i[t++]-r.scaleY):(a.x=0,a.y=0,a.rotation=0,a.skew=0,a.scaleX=0,a.scaleY=0)}else r=this.bonePose.current,a=this.bonePose.delta,r.x=0,r.y=0,r.rotation=0,r.skew=0,r.scaleX=1,r.scaleY=1,a.x=0,a.y=0,a.rotation=0,a.skew=0,a.scaleX=0,a.scaleY=0},n.prototype._onUpdateFrame=function(){e.prototype._onUpdateFrame.call(this);var t=this.bonePose.current,n=this.bonePose.delta,i=this.bonePose.result;this.bone._transformDirty=!0,2!==this._tweenState&&(this._tweenState=0),i.x=t.x+n.x*this._tweenProgress,i.y=t.y+n.y*this._tweenProgress,i.rotation=t.rotation+n.rotation*this._tweenProgress,i.skew=t.skew+n.skew*this._tweenProgress,i.scaleX=t.scaleX+n.scaleX*this._tweenProgress,i.scaleY=t.scaleY+n.scaleY*this._tweenProgress},n.prototype.fadeOut=function(){var e=this.bonePose.result;e.rotation=t.Transform.normalizeRadian(e.rotation),e.skew=t.Transform.normalizeRadian(e.skew)},n}(t.BoneTimelineState);t.BoneAllTimelineState=i;var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return V_t(e,t),e.toString=function(){return"[class dragonBones.BoneTranslateTimelineState]"},e.prototype._onArriveAtFrame=function(){if(t.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var e=this._animationData.frameFloatOffset+this._frameValueOffset+2*this._frameIndex,n=this._armature._armatureData.scale,i=this._frameFloatArray,r=this.bonePose.current,a=this.bonePose.delta;r.x=i[e++]*n,r.y=i[e++]*n,2===this._tweenState?(this._frameIndex===this._frameCount-1&&(e=this._animationData.frameFloatOffset+this._frameValueOffset),a.x=i[e++]*n-r.x,a.y=i[e++]*n-r.y):(a.x=0,a.y=0)}else r=this.bonePose.current,a=this.bonePose.delta,r.x=0,r.y=0,a.x=0,a.y=0},e.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this);var e=this.bonePose.current,n=this.bonePose.delta,i=this.bonePose.result;this.bone._transformDirty=!0,2!==this._tweenState&&(this._tweenState=0),i.x=e.x+n.x*this._tweenProgress,i.y=e.y+n.y*this._tweenProgress},e}(t.BoneTimelineState);t.BoneTranslateTimelineState=r;var a=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return V_t(n,e),n.toString=function(){return"[class dragonBones.BoneRotateTimelineState]"},n.prototype._onArriveAtFrame=function(){if(e.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var n=this._animationData.frameFloatOffset+this._frameValueOffset+2*this._frameIndex,i=this._frameFloatArray,r=this.bonePose.current,a=this.bonePose.delta;r.rotation=i[n++],r.skew=i[n++],2===this._tweenState?(this._frameIndex===this._frameCount-1?(n=this._animationData.frameFloatOffset+this._frameValueOffset,a.rotation=t.Transform.normalizeRadian(i[n++]-r.rotation)):a.rotation=i[n++]-r.rotation,a.skew=i[n++]-r.skew):(a.rotation=0,a.skew=0)}else r=this.bonePose.current,a=this.bonePose.delta,r.rotation=0,r.skew=0,a.rotation=0,a.skew=0},n.prototype._onUpdateFrame=function(){e.prototype._onUpdateFrame.call(this);var t=this.bonePose.current,n=this.bonePose.delta,i=this.bonePose.result;this.bone._transformDirty=!0,2!==this._tweenState&&(this._tweenState=0),i.rotation=t.rotation+n.rotation*this._tweenProgress,i.skew=t.skew+n.skew*this._tweenProgress},n.prototype.fadeOut=function(){var e=this.bonePose.result;e.rotation=t.Transform.normalizeRadian(e.rotation),e.skew=t.Transform.normalizeRadian(e.skew)},n}(t.BoneTimelineState);t.BoneRotateTimelineState=a;var o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return V_t(e,t),e.toString=function(){return"[class dragonBones.BoneScaleTimelineState]"},e.prototype._onArriveAtFrame=function(){if(t.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var e=this._animationData.frameFloatOffset+this._frameValueOffset+2*this._frameIndex,n=this._frameFloatArray,i=this.bonePose.current,r=this.bonePose.delta;i.scaleX=n[e++],i.scaleY=n[e++],2===this._tweenState?(this._frameIndex===this._frameCount-1&&(e=this._animationData.frameFloatOffset+this._frameValueOffset),r.scaleX=n[e++]-i.scaleX,r.scaleY=n[e++]-i.scaleY):(r.scaleX=0,r.scaleY=0)}else i=this.bonePose.current,r=this.bonePose.delta,i.scaleX=1,i.scaleY=1,r.scaleX=0,r.scaleY=0},e.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this);var e=this.bonePose.current,n=this.bonePose.delta,i=this.bonePose.result;this.bone._transformDirty=!0,2!==this._tweenState&&(this._tweenState=0),i.scaleX=e.scaleX+n.scaleX*this._tweenProgress,i.scaleY=e.scaleY+n.scaleY*this._tweenProgress},e}(t.BoneTimelineState);t.BoneScaleTimelineState=o;var s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._current=[],e._delta=[],e._result=[],e}return V_t(e,t),e.toString=function(){return"[class dragonBones.SurfaceTimelineState]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.surface=null,this._frameFloatOffset=0,this._valueCount=0,this._deformCount=0,this._valueOffset=0,this._current.length=0,this._delta.length=0,this._result.length=0},e.prototype._onArriveAtFrame=function(){if(t.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var e=this._animationData.frameFloatOffset+this._frameValueOffset+this._frameIndex*this._valueCount,n=this._armature._armatureData.scale,i=this._frameFloatArray;if(2===this._tweenState){var r=e+this._valueCount;this._frameIndex===this._frameCount-1&&(r=this._animationData.frameFloatOffset+this._frameValueOffset);for(var a=0;a<this._valueCount;++a)this._delta[a]=i[r+a]*n-(this._current[a]=i[e+a]*n)}else for(a=0;a<this._valueCount;++a)this._current[a]=i[e+a]*n}else for(a=0;a<this._valueCount;++a)this._current[a]=0},e.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this),this.surface._transformDirty=!0,2!==this._tweenState&&(this._tweenState=0);for(var e=0;e<this._valueCount;++e)this._result[e]=this._current[e]+this._delta[e]*this._tweenProgress},e.prototype.init=function(e,n,i){if(t.prototype.init.call(this,e,n,i),null!==this._timelineData){var r=this._animationData.frameIntOffset+this._timelineArray[this._timelineData.offset+3];this._deformCount=this._frameIntArray[r+1],this._valueCount=this._frameIntArray[r+2],this._valueOffset=this._frameIntArray[r+3],this._frameFloatOffset=this._frameIntArray[r+4]+this._animationData.frameFloatOffset}else this._deformCount=this.surface._deformVertices.length,this._valueCount=this._deformCount,this._valueOffset=0,this._frameFloatOffset=0;this._current.length=this._valueCount,this._delta.length=this._valueCount,this._result.length=this._valueCount;for(var a=0;a<this._valueCount;++a)this._delta[a]=0},e.prototype.blend=function(t){for(var e=this.surface._blendState.blendWeight,n=this.surface._deformVertices,i=0;i<this._deformCount;++i){var r;r=i<this._valueOffset?this._frameFloatArray[this._frameFloatOffset+i]:i<this._valueOffset+this._valueCount?this._result[i-this._valueOffset]:this._frameFloatArray[this._frameFloatOffset+i-this._valueCount],2===t?n[i]+=r*e:n[i]=1!==e?r*e:r}0===this._animationState._fadeState&&0===this._animationState._subFadeState||(this.surface._transformDirty=!0)},e}(t.TweenTimelineState);t.SurfaceTimelineState=s;var c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return V_t(e,t),e.toString=function(){return"[class dragonBones.SlotDislayTimelineState]"},e.prototype._onArriveAtFrame=function(){if(this.playState>=0){var t=null!==this._timelineData?this._frameArray[this._frameOffset+1]:this.slot._slotData.displayIndex;this.slot.displayIndex!==t&&this.slot._setDisplayIndex(t,!0)}},e}(t.SlotTimelineState);t.SlotDislayTimelineState=c;var l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._current=[0,0,0,0,0,0,0,0],e._delta=[0,0,0,0,0,0,0,0],e._result=[0,0,0,0,0,0,0,0],e}return V_t(e,t),e.toString=function(){return"[class dragonBones.SlotColorTimelineState]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this._dirty=!1},e.prototype._onArriveAtFrame=function(){if(t.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var e=this._dragonBonesData.intArray,n=this._frameIntArray,i=this._animationData.frameIntOffset+this._frameValueOffset+1*this._frameIndex,r=n[i];r<0&&(r+=65536),this._current[0]=e[r++],this._current[1]=e[r++],this._current[2]=e[r++],this._current[3]=e[r++],this._current[4]=e[r++],this._current[5]=e[r++],this._current[6]=e[r++],this._current[7]=e[r++],2===this._tweenState&&((r=this._frameIndex===this._frameCount-1?n[this._animationData.frameIntOffset+this._frameValueOffset]:n[i+1])<0&&(r+=65536),this._delta[0]=e[r++]-this._current[0],this._delta[1]=e[r++]-this._current[1],this._delta[2]=e[r++]-this._current[2],this._delta[3]=e[r++]-this._current[3],this._delta[4]=e[r++]-this._current[4],this._delta[5]=e[r++]-this._current[5],this._delta[6]=e[r++]-this._current[6],this._delta[7]=e[r++]-this._current[7])}else{var a=this.slot._slotData.color;this._current[0]=100*a.alphaMultiplier,this._current[1]=100*a.redMultiplier,this._current[2]=100*a.greenMultiplier,this._current[3]=100*a.blueMultiplier,this._current[4]=a.alphaOffset,this._current[5]=a.redOffset,this._current[6]=a.greenOffset,this._current[7]=a.blueOffset}},e.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this),this._dirty=!0,2!==this._tweenState&&(this._tweenState=0),this._result[0]=.01*(this._current[0]+this._delta[0]*this._tweenProgress),this._result[1]=.01*(this._current[1]+this._delta[1]*this._tweenProgress),this._result[2]=.01*(this._current[2]+this._delta[2]*this._tweenProgress),this._result[3]=.01*(this._current[3]+this._delta[3]*this._tweenProgress),this._result[4]=this._current[4]+this._delta[4]*this._tweenProgress,this._result[5]=this._current[5]+this._delta[5]*this._tweenProgress,this._result[6]=this._current[6]+this._delta[6]*this._tweenProgress,this._result[7]=this._current[7]+this._delta[7]*this._tweenProgress},e.prototype.fadeOut=function(){this._tweenState=0,this._dirty=!1},e.prototype.update=function(e){if(t.prototype.update.call(this,e),0!==this._tweenState||this._dirty){var n=this.slot._colorTransform;if(0!==this._animationState._fadeState||0!==this._animationState._subFadeState){if(n.alphaMultiplier!==this._result[0]||n.redMultiplier!==this._result[1]||n.greenMultiplier!==this._result[2]||n.blueMultiplier!==this._result[3]||n.alphaOffset!==this._result[4]||n.redOffset!==this._result[5]||n.greenOffset!==this._result[6]||n.blueOffset!==this._result[7]){var i=Math.pow(this._animationState._fadeProgress,4);n.alphaMultiplier+=(this._result[0]-n.alphaMultiplier)*i,n.redMultiplier+=(this._result[1]-n.redMultiplier)*i,n.greenMultiplier+=(this._result[2]-n.greenMultiplier)*i,n.blueMultiplier+=(this._result[3]-n.blueMultiplier)*i,n.alphaOffset+=(this._result[4]-n.alphaOffset)*i,n.redOffset+=(this._result[5]-n.redOffset)*i,n.greenOffset+=(this._result[6]-n.greenOffset)*i,n.blueOffset+=(this._result[7]-n.blueOffset)*i,this.slot._colorDirty=!0}}else this._dirty&&(this._dirty=!1,n.alphaMultiplier===this._result[0]&&n.redMultiplier===this._result[1]&&n.greenMultiplier===this._result[2]&&n.blueMultiplier===this._result[3]&&n.alphaOffset===this._result[4]&&n.redOffset===this._result[5]&&n.greenOffset===this._result[6]&&n.blueOffset===this._result[7]||(n.alphaMultiplier=this._result[0],n.redMultiplier=this._result[1],n.greenMultiplier=this._result[2],n.blueMultiplier=this._result[3],n.alphaOffset=this._result[4],n.redOffset=this._result[5],n.greenOffset=this._result[6],n.blueOffset=this._result[7],this.slot._colorDirty=!0))}},e}(t.SlotTimelineState);t.SlotColorTimelineState=l;var u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._current=[],e._delta=[],e._result=[],e}return V_t(e,t),e.toString=function(){return"[class dragonBones.DeformTimelineState]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.vertexOffset=0,this._dirty=!1,this._frameFloatOffset=0,this._valueCount=0,this._deformCount=0,this._valueOffset=0,this._current.length=0,this._delta.length=0,this._result.length=0},e.prototype._onArriveAtFrame=function(){if(t.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var e=this._animationData.frameFloatOffset+this._frameValueOffset+this._frameIndex*this._valueCount,n=this._armature._armatureData.scale,i=this._frameFloatArray;if(2===this._tweenState){var r=e+this._valueCount;this._frameIndex===this._frameCount-1&&(r=this._animationData.frameFloatOffset+this._frameValueOffset);for(var a=0;a<this._valueCount;++a)this._delta[a]=i[r+a]*n-(this._current[a]=i[e+a]*n)}else for(a=0;a<this._valueCount;++a)this._current[a]=i[e+a]*n}else for(a=0;a<this._valueCount;++a)this._current[a]=0},e.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this),this._dirty=!0,2!==this._tweenState&&(this._tweenState=0);for(var e=0;e<this._valueCount;++e)this._result[e]=this._current[e]+this._delta[e]*this._tweenProgress},e.prototype.init=function(e,n,i){if(t.prototype.init.call(this,e,n,i),null!==this._timelineData){var r=this._animationData.frameIntOffset+this._timelineArray[this._timelineData.offset+3];this.vertexOffset=this._frameIntArray[r+0],this.vertexOffset<0&&(this.vertexOffset+=65536),this._deformCount=this._frameIntArray[r+1],this._valueCount=this._frameIntArray[r+2],this._valueOffset=this._frameIntArray[r+3],this._frameFloatOffset=this._frameIntArray[r+4]+this._animationData.frameFloatOffset}else{var a=this.slot._deformVertices;this._deformCount=null!==a?a.vertices.length:0,this._valueCount=this._deformCount,this._valueOffset=0,this._frameFloatOffset=0}this._current.length=this._valueCount,this._delta.length=this._valueCount,this._result.length=this._valueCount;for(var o=0;o<this._valueCount;++o)this._delta[o]=0},e.prototype.fadeOut=function(){this._tweenState=0,this._dirty=!1},e.prototype.update=function(e){var n=this.slot._deformVertices;if(null!==n&&null!==n.verticesData&&n.verticesData.offset===this.vertexOffset&&(t.prototype.update.call(this,e),0!==this._tweenState||this._dirty)){var i=n.vertices;if(0!==this._animationState._fadeState||0!==this._animationState._subFadeState){for(var r=Math.pow(this._animationState._fadeProgress,2),a=0;a<this._deformCount;++a)a<this._valueOffset?i[a]+=(this._frameFloatArray[this._frameFloatOffset+a]-i[a])*r:a<this._valueOffset+this._valueCount?i[a]+=(this._result[a-this._valueOffset]-i[a])*r:i[a]+=(this._frameFloatArray[this._frameFloatOffset+a-this._valueCount]-i[a])*r;n.verticesDirty=!0}else if(this._dirty){for(this._dirty=!1,a=0;a<this._deformCount;++a)a<this._valueOffset?i[a]=this._frameFloatArray[this._frameFloatOffset+a]:a<this._valueOffset+this._valueCount?i[a]=this._result[a-this._valueOffset]:i[a]=this._frameFloatArray[this._frameFloatOffset+a-this._valueCount];n.verticesDirty=!0}}},e}(t.SlotTimelineState);t.DeformTimelineState=u;var h=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return V_t(e,t),e.toString=function(){return"[class dragonBones.IKConstraintTimelineState]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this._current=0,this._delta=0},e.prototype._onArriveAtFrame=function(){t.prototype._onArriveAtFrame.call(this);var e=this.constraint;if(null!==this._timelineData){var n=this._animationData.frameIntOffset+this._frameValueOffset+2*this._frameIndex,i=this._frameIntArray,r=0!==i[n++];this._current=.01*i[n++],2===this._tweenState?(this._frameIndex===this._frameCount-1&&(n=this._animationData.frameIntOffset+this._frameValueOffset),this._delta=.01*i[n+1]-this._current):this._delta=0,e._bendPositive=r}else{var a=e._constraintData;this._current=a.weight,this._delta=0,e._bendPositive=a.bendPositive}e.invalidUpdate()},e.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this),2!==this._tweenState&&(this._tweenState=0);var e=this.constraint;e._weight=this._current+this._delta*this._tweenProgress,e.invalidUpdate()},e}(t.ConstraintTimelineState);t.IKConstraintTimelineState=h;var f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._floats=[0,0,0,0,0,0],e}return V_t(e,t),e.toString=function(){return"[class dragonBones.AnimationTimelineState]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.animationState=null},e.prototype._onArriveAtFrame=function(){if(t.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var e=this._animationData.frameIntOffset+this._frameValueOffset+2*this._frameIndex,n=1/this.animationState._animationData.parent.frameRate,i=this._frameIntArray;this._floats[0]=i[e++]*n,this._floats[3]=.01*i[e++],2===this._tweenState?(this._frameIndex===this._frameCount-1&&(e=this._animationData.frameIntOffset+this._frameValueOffset),this._floats[1]=i[e++]*n-this._floats[0],this._floats[4]=.01*i[e++]-this._floats[3]):(this._floats[1]=0,this._floats[4]=0)}},e.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this),2!==this._tweenState&&(this._tweenState=0),this._floats[0]>=0&&(this._floats[2]=this._floats[0]+this._floats[1]*this._tweenProgress),this._floats[5]=this._floats[3]+this._floats[4]*this._tweenProgress},e.prototype.blend=function(t){var e=this.animationState,n=e._blendState.blendWeight;2===t?(e.weight+=this._floats[5]*n,e.currentTime+=this._floats[2]*n):(e.weight=this._floats[5]*n,e.currentTime=this._floats[2]*n)},e}(t.TweenTimelineState);t.AnimationTimelineState=f}(j_t||(j_t={})),function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return V_t(e,t),e.actionDataToInstance=function(t,n,i){0===t.type?n.type=e.FRAME_EVENT:n.type=10===t.type?e.FRAME_EVENT:e.SOUND_EVENT,n.name=t.name,n.armature=i,n.actionData=t,n.data=t.data,null!==t.bone&&(n.bone=i.getBone(t.bone.name)),null!==t.slot&&(n.slot=i.getSlot(t.slot.name))},e.toString=function(){return"[class dragonBones.EventObject]"},e.prototype._onClear=function(){this.time=0,this.type="",this.name="",this.armature=null,this.bone=null,this.slot=null,this.animationState=null,this.actionData=null,this.data=null},e.START="start",e.LOOP_COMPLETE="loopComplete",e.COMPLETE="complete",e.FADE_IN="fadeIn",e.FADE_IN_COMPLETE="fadeInComplete",e.FADE_OUT="fadeOut",e.FADE_OUT_COMPLETE="fadeOutComplete",e.FRAME_EVENT="frameEvent",e.SOUND_EVENT="soundEvent",e}(t.BaseObject);t.EventObject=e}(j_t||(j_t={})),function(t){var e=function(){function e(){}return e._getArmatureType=function(t){switch(t.toLowerCase()){case"stage":return 2;case"armature":return 0;case"movieclip":return 1;default:return 0}},e._getBoneType=function(t){switch(t.toLowerCase()){case"bone":return 0;case"surface":return 1;default:return 0}},e._getDisplayType=function(t){switch(t.toLowerCase()){case"image":return 0;case"mesh":return 2;case"armature":return 1;case"boundingbox":return 3;case"path":return 4;default:return 0}},e._getBoundingBoxType=function(t){switch(t.toLowerCase()){case"rectangle":return 0;case"ellipse":return 1;case"polygon":return 2;default:return 0}},e._getActionType=function(t){switch(t.toLowerCase()){case"play":return 0;case"frame":return 10;case"sound":return 11;default:return 0}},e._getBlendMode=function(t){switch(t.toLowerCase()){case"normal":return 0;case"add":return 1;case"alpha":return 2;case"darken":return 3;case"difference":return 4;case"erase":return 5;case"hardlight":return 6;case"invert":return 7;case"layer":return 8;case"lighten":return 9;case"multiply":return 10;case"overlay":return 11;case"screen":return 12;case"subtract":return 13;default:return 0}},e._getPositionMode=function(t){switch(t.toLocaleLowerCase()){case"percent":return 1;case"fixed":return 0;default:return 1}},e._getSpacingMode=function(t){switch(t.toLocaleLowerCase()){case"length":return 0;case"percent":return 2;case"fixed":return 1;default:return 0}},e._getRotateMode=function(t){switch(t.toLocaleLowerCase()){case"tangent":return 0;case"chain":return 1;case"chainscale":return 2;default:return 0}},e.parseDragonBonesData=function(e){return console.warn("Deprecated."),e instanceof ArrayBuffer?t.BinaryDataParser.getInstance().parseDragonBonesData(e):t.ObjectDataParser.getInstance().parseDragonBonesData(e)},e.parseTextureAtlasData=function(n,i){void 0===i&&(i=1),console.warn("已废弃");for(var r={},a=n[e.SUB_TEXTURE],o=0,s=a.length;o<s;o++){var c=a[o],l=c[e.NAME],u=new t.Rectangle,h=null;u.x=c[e.X]/i,u.y=c[e.Y]/i,u.width=c[e.WIDTH]/i,u.height=c[e.HEIGHT]/i,e.FRAME_WIDTH in c&&((h=new t.Rectangle).x=c[e.FRAME_X]/i,h.y=c[e.FRAME_Y]/i,h.width=c[e.FRAME_WIDTH]/i,h.height=c[e.FRAME_HEIGHT]/i),r[l]={region:u,frame:h,rotated:!1}}return r},e.DATA_VERSION_2_3="2.3",e.DATA_VERSION_3_0="3.0",e.DATA_VERSION_4_0="4.0",e.DATA_VERSION_4_5="4.5",e.DATA_VERSION_5_0="5.0",e.DATA_VERSION_5_5="5.5",e.DATA_VERSION=e.DATA_VERSION_5_5,e.DATA_VERSIONS=[e.DATA_VERSION_4_0,e.DATA_VERSION_4_5,e.DATA_VERSION_5_0,e.DATA_VERSION_5_5],e.TEXTURE_ATLAS="textureAtlas",e.SUB_TEXTURE="SubTexture",e.FORMAT="format",e.IMAGE_PATH="imagePath",e.WIDTH="width",e.HEIGHT="height",e.ROTATED="rotated",e.FRAME_X="frameX",e.FRAME_Y="frameY",e.FRAME_WIDTH="frameWidth",e.FRAME_HEIGHT="frameHeight",e.DRADON_BONES="dragonBones",e.USER_DATA="userData",e.ARMATURE="armature",e.BONE="bone",e.SURFACE="surface",e.SLOT="slot",e.CONSTRAINT="constraint",e.IK="ik",e.PATH_CONSTRAINT="path",e.SKIN="skin",e.DISPLAY="display",e.ANIMATION="animation",e.Z_ORDER="zOrder",e.FFD="ffd",e.FRAME="frame",e.TRANSLATE_FRAME="translateFrame",e.ROTATE_FRAME="rotateFrame",e.SCALE_FRAME="scaleFrame",e.DISPLAY_FRAME="displayFrame",e.COLOR_FRAME="colorFrame",e.DEFAULT_ACTIONS="defaultActions",e.ACTIONS="actions",e.EVENTS="events",e.INTS="ints",e.FLOATS="floats",e.STRINGS="strings",e.CANVAS="canvas",e.TRANSFORM="transform",e.PIVOT="pivot",e.AABB="aabb",e.COLOR="color",e.VERSION="version",e.COMPATIBLE_VERSION="compatibleVersion",e.FRAME_RATE="frameRate",e.TYPE="type",e.SUB_TYPE="subType",e.NAME="name",e.PARENT="parent",e.TARGET="target",e.STAGE="stage",e.SHARE="share",e.PATH="path",e.LENGTH="length",e.DISPLAY_INDEX="displayIndex",e.BLEND_MODE="blendMode",e.INHERIT_TRANSLATION="inheritTranslation",e.INHERIT_ROTATION="inheritRotation",e.INHERIT_SCALE="inheritScale",e.INHERIT_REFLECTION="inheritReflection",e.INHERIT_ANIMATION="inheritAnimation",e.INHERIT_DEFORM="inheritDeform",e.SEGMENT_X="segmentX",e.SEGMENT_Y="segmentY",e.BEND_POSITIVE="bendPositive",e.CHAIN="chain",e.WEIGHT="weight",e.FADE_IN_TIME="fadeInTime",e.PLAY_TIMES="playTimes",e.SCALE="scale",e.OFFSET="offset",e.POSITION="position",e.DURATION="duration",e.TWEEN_EASING="tweenEasing",e.TWEEN_ROTATE="tweenRotate",e.TWEEN_SCALE="tweenScale",e.CLOCK_WISE="clockwise",e.CURVE="curve",e.SOUND="sound",e.EVENT="event",e.ACTION="action",e.X="x",e.Y="y",e.SKEW_X="skX",e.SKEW_Y="skY",e.SCALE_X="scX",e.SCALE_Y="scY",e.VALUE="value",e.ROTATE="rotate",e.SKEW="skew",e.ALPHA_OFFSET="aO",e.RED_OFFSET="rO",e.GREEN_OFFSET="gO",e.BLUE_OFFSET="bO",e.ALPHA_MULTIPLIER="aM",e.RED_MULTIPLIER="rM",e.GREEN_MULTIPLIER="gM",e.BLUE_MULTIPLIER="bM",e.UVS="uvs",e.VERTICES="vertices",e.TRIANGLES="triangles",e.WEIGHTS="weights",e.SLOT_POSE="slotPose",e.BONE_POSE="bonePose",e.GLUE_WEIGHTS="glueWeights",e.GLUE_MESHES="glueMeshes",e.BONES="bones",e.POSITION_MODE="positionMode",e.SPACING_MODE="spacingMode",e.ROTATE_MODE="rotateMode",e.SPACING="spacing",e.ROTATE_OFFSET="rotateOffset",e.ROTATE_MIX="rotateMix",e.TRANSLATE_MIX="translateMix",e.TARGET_DISPLAY="targetDisplay",e.CLOSED="closed",e.CONSTANT_SPEED="constantSpeed",e.VERTEX_COUNT="vertexCount",e.LENGTHS="lengths",e.GOTO_AND_PLAY="gotoAndPlay",e.DEFAULT_NAME="default",e}();t.DataParser=e}(j_t||(j_t={})),function(t){var e=function(e){function i(){var n=null!==e&&e.apply(this,arguments)||this;return n._rawTextureAtlasIndex=0,n._rawBones=[],n._data=null,n._armature=null,n._bone=null,n._surface=null,n._slot=null,n._skin=null,n._mesh=null,n._animation=null,n._timeline=null,n._rawTextureAtlases=null,n._defaultColorOffset=-1,n._prevClockwise=0,n._prevRotation=0,n._helpMatrixA=new t.Matrix,n._helpMatrixB=new t.Matrix,n._helpTransform=new t.Transform,n._helpColorTransform=new t.ColorTransform,n._helpPoint=new t.Point,n._helpArray=[],n._intArray=[],n._floatArray=[],n._frameIntArray=[],n._frameFloatArray=[],n._frameArray=[],n._timelineArray=[],n._cacheRawMeshes=[],n._cacheMeshes=[],n._actionFrames=[],n._weightSlotPose={},n._weightBonePoses={},n._cacheBones={},n._slotChildActions={},n}return V_t(i,e),i._getBoolean=function(t,e,n){if(e in t){var i=t[e],r=typeof i;if("boolean"===r)return i;if("string"!==r)return!!i;switch(i){case"0":case"NaN":case"":case"false":case"null":case"undefined":return!1;default:return!0}}return n},i._getNumber=function(t,e,n){if(e in t){var i=t[e];return null===i||"NaN"===i?n:+i||0}return n},i._getString=function(e,n,i){if(n in e){var r=e[n];if("string"==typeof r){if(t.DragonBones.webAssembly)for(var a=0,o=r.length;a<o;++a)if(r.charCodeAt(a)>255)return encodeURI(r);return r}return String(r)}return i},i.prototype._getCurvePoint=function(t,e,n,i,r,a,o,s,c,l){var u=1-c,h=u*u,f=c*c,_=u*h,p=3*c*h,d=3*u*f,m=c*f;l.x=_*t+p*n+d*r+m*o,l.y=_*e+p*i+d*a+m*s},i.prototype._samplingEasingCurve=function(t,e){for(var n=t.length,i=-2,r=0,a=e.length;r<a;++r){for(var o=(r+1)/(a+1);(i+6<n?t[i+6]:1)<o;)i+=6;for(var s=i>=0&&i+6<n,c=s?t[i]:0,l=s?t[i+1]:0,u=t[i+2],h=t[i+3],f=t[i+4],_=t[i+5],p=s?t[i+6]:1,d=s?t[i+7]:1,m=0,g=1;g-m>1e-4;){var v=.5*(g+m);this._getCurvePoint(c,l,u,h,f,_,p,d,v,this._helpPoint),o-this._helpPoint.x>0?m=v:g=v}e[r]=this._helpPoint.y}},i.prototype._parseActionDataInFrame=function(e,n,i,r){t.DataParser.EVENT in e&&this._mergeActionFrame(e[t.DataParser.EVENT],n,10,i,r),t.DataParser.SOUND in e&&this._mergeActionFrame(e[t.DataParser.SOUND],n,11,i,r),t.DataParser.ACTION in e&&this._mergeActionFrame(e[t.DataParser.ACTION],n,0,i,r),t.DataParser.EVENTS in e&&this._mergeActionFrame(e[t.DataParser.EVENTS],n,10,i,r),t.DataParser.ACTIONS in e&&this._mergeActionFrame(e[t.DataParser.ACTIONS],n,0,i,r)},i.prototype._mergeActionFrame=function(e,i,r,a,o){for(var s=t.DragonBones.webAssembly?this._armature.actions.size():this._armature.actions.length,c=this._parseActionData(e,r,a,o),l=0,u=null,h=0,f=c;h<f.length;h++){var _=f[h];this._armature.addAction(_,!1)}0===this._actionFrames.length&&((u=new n).frameStart=0,this._actionFrames.push(u),u=null);for(var p=0,d=this._actionFrames;p<d.length;p++){var m=d[p];if(m.frameStart===i){u=m;break}if(m.frameStart>i)break;l++}null===u&&((u=new n).frameStart=i,this._actionFrames.splice(l+1,0,u));for(var g=0;g<c.length;++g)u.actions.push(s+g)},i.prototype._parseArmature=function(e,n){var r=t.BaseObject.borrowObject(t.ArmatureData);if(r.name=i._getString(e,t.DataParser.NAME,""),r.frameRate=i._getNumber(e,t.DataParser.FRAME_RATE,this._data.frameRate),r.scale=n,t.DataParser.TYPE in e&&"string"==typeof e[t.DataParser.TYPE]?r.type=t.DataParser._getArmatureType(e[t.DataParser.TYPE]):r.type=i._getNumber(e,t.DataParser.TYPE,0),0===r.frameRate&&(r.frameRate=24),this._armature=r,t.DataParser.CANVAS in e){var a=e[t.DataParser.CANVAS],o=t.BaseObject.borrowObject(t.CanvasData);t.DataParser.COLOR in a?o.hasBackground=!0:o.hasBackground=!1,o.color=i._getNumber(a,t.DataParser.COLOR,0),o.x=i._getNumber(a,t.DataParser.X,0)*r.scale,o.y=i._getNumber(a,t.DataParser.Y,0)*r.scale,o.width=i._getNumber(a,t.DataParser.WIDTH,0)*r.scale,o.height=i._getNumber(a,t.DataParser.HEIGHT,0)*r.scale,r.canvas=o}if(t.DataParser.AABB in e){var s=e[t.DataParser.AABB];r.aabb.x=i._getNumber(s,t.DataParser.X,0)*r.scale,r.aabb.y=i._getNumber(s,t.DataParser.Y,0)*r.scale,r.aabb.width=i._getNumber(s,t.DataParser.WIDTH,0)*r.scale,r.aabb.height=i._getNumber(s,t.DataParser.HEIGHT,0)*r.scale}if(t.DataParser.BONE in e)for(var c=0,l=e[t.DataParser.BONE];c<l.length;c++){var u=l[c],h=i._getString(u,t.DataParser.PARENT,""),f=this._parseBone(u);if(h.length>0){var _=r.getBone(h);null!==_?f.parent=_:(h in this._cacheBones||(this._cacheBones[h]=[]),this._cacheBones[h].push(f))}if(f.name in this._cacheBones){for(var p=0,d=this._cacheBones[f.name];p<d.length;p++)d[p].parent=f;delete this._cacheBones[f.name]}r.addBone(f),this._rawBones.push(f)}if(t.DataParser.IK in e)for(var m=0,g=e[t.DataParser.IK];m<g.length;m++){var v=g[m];(P=this._parseIKConstraint(v))&&r.addConstraint(P)}if(r.sortBones(),t.DataParser.SLOT in e)for(var y=0,x=0,S=e[t.DataParser.SLOT];x<S.length;x++){var T=S[x];r.addSlot(this._parseSlot(T,y++))}if(t.DataParser.SKIN in e)for(var A=0,E=e[t.DataParser.SKIN];A<E.length;A++){var C=E[A];r.addSkin(this._parseSkin(C))}if(t.DataParser.PATH_CONSTRAINT in e)for(var b=0,w=e[t.DataParser.PATH_CONSTRAINT];b<w.length;b++){var P,I=w[b];(P=this._parsePathConstraint(I))&&r.addConstraint(P)}for(var R=0,D=this._cacheRawMeshes.length;R<D;++R){var O=this._cacheRawMeshes[R];t.DataParser.GLUE_WEIGHTS in O&&t.DataParser.GLUE_MESHES in O&&this._parseMeshGlue(O,this._cacheMeshes[R])}for(R=0,D=this._cacheRawMeshes.length;R<D;++R){var M=this._cacheRawMeshes[R],N=i._getString(M,t.DataParser.SHARE,"");if(0!==N.length){var L=i._getString(M,t.DataParser.SKIN,t.DataParser.DEFAULT_NAME);0===L.length&&(L=t.DataParser.DEFAULT_NAME);var B=r.getMesh(L,"",N);null!==B&&this._cacheMeshes[R].vertices.shareFrom(B.vertices)}}if(t.DataParser.ANIMATION in e)for(var F=0,z=e[t.DataParser.ANIMATION];F<z.length;F++){var U=z[F],k=this._parseAnimation(U);r.addAnimation(k)}if(t.DataParser.DEFAULT_ACTIONS in e)for(var G=0,H=this._parseActionData(e[t.DataParser.DEFAULT_ACTIONS],0,null,null);G<H.length;G++){var V=H[G];r.addAction(V,!0),0===V.type&&null!==(k=r.getAnimation(V.name))&&(r.defaultAnimation=k)}if(t.DataParser.ACTIONS in e)for(var j=0,W=this._parseActionData(e[t.DataParser.ACTIONS],0,null,null);j<W.length;j++)V=W[j],r.addAction(V,!1);for(var X in this._rawBones.length=0,this._cacheRawMeshes.length=0,this._cacheMeshes.length=0,this._armature=null,this._weightSlotPose)delete this._weightSlotPose[X];for(var X in this._weightBonePoses)delete this._weightBonePoses[X];for(var X in this._cacheBones)delete this._cacheBones[X];for(var X in this._slotChildActions)delete this._slotChildActions[X];return r},i.prototype._parseBone=function(e){var n=this._armature.scale;if(0===(t.DataParser.TYPE in e&&"string"==typeof e[t.DataParser.TYPE]?t.DataParser._getBoneType(e[t.DataParser.TYPE]):i._getNumber(e,t.DataParser.TYPE,0))){var r=t.BaseObject.borrowObject(t.BoneData);return r.inheritTranslation=i._getBoolean(e,t.DataParser.INHERIT_TRANSLATION,!0),r.inheritRotation=i._getBoolean(e,t.DataParser.INHERIT_ROTATION,!0),r.inheritScale=i._getBoolean(e,t.DataParser.INHERIT_SCALE,!0),r.inheritReflection=i._getBoolean(e,t.DataParser.INHERIT_REFLECTION,!0),r.length=i._getNumber(e,t.DataParser.LENGTH,0)*n,r.name=i._getString(e,t.DataParser.NAME,""),t.DataParser.TRANSFORM in e&&this._parseTransform(e[t.DataParser.TRANSFORM],r.transform,n),r}var a=t.BaseObject.borrowObject(t.SurfaceData);if(a.name=i._getString(e,t.DataParser.NAME,""),a.segmentX=i._getNumber(e,t.DataParser.SEGMENT_X,0),a.segmentY=i._getNumber(e,t.DataParser.SEGMENT_Y,0),a.vertices.length=(a.segmentX+1)*(a.segmentY+1)*2,t.DataParser.VERTICES in e)for(var o=e[t.DataParser.VERTICES],s=0,c=a.vertices.length;s<c;++s)s<o.length?a.vertices[s]=o[s]*n:a.vertices[s]=0;return a},i.prototype._parseIKConstraint=function(e){var n=this._armature.getBone(i._getString(e,t.DataParser.BONE,""));if(null===n)return null;var r=this._armature.getBone(i._getString(e,t.DataParser.TARGET,""));if(null===r)return null;var a=t.BaseObject.borrowObject(t.IKConstraintData);return a.scaleEnabled=i._getBoolean(e,t.DataParser.SCALE,!1),a.bendPositive=i._getBoolean(e,t.DataParser.BEND_POSITIVE,!0),a.weight=i._getNumber(e,t.DataParser.WEIGHT,1),a.name=i._getString(e,t.DataParser.NAME,""),a.type=0,a.target=r,i._getNumber(e,t.DataParser.CHAIN,0)>0&&null!==n.parent?(a.root=n.parent,a.bone=n):(a.root=n,a.bone=null),a},i.prototype._parsePathConstraint=function(e){var n=this._armature.getSlot(i._getString(e,t.DataParser.TARGET,""));if(null===n)return null;var r=this._armature.defaultSkin;if(null===r)return null;var a=r.getDisplay(n.name,i._getString(e,t.DataParser.TARGET_DISPLAY,n.name));if(null===a||!(a instanceof t.PathDisplayData))return null;var o=e[t.DataParser.BONES];if(null===o||0===o.length)return null;var s=t.BaseObject.borrowObject(t.PathConstraintData);s.name=i._getString(e,t.DataParser.NAME,""),s.type=1,s.pathSlot=n,s.pathDisplayData=a,s.target=n.parent,s.positionMode=t.DataParser._getPositionMode(i._getString(e,t.DataParser.POSITION_MODE,"")),s.spacingMode=t.DataParser._getSpacingMode(i._getString(e,t.DataParser.SPACING_MODE,"")),s.rotateMode=t.DataParser._getRotateMode(i._getString(e,t.DataParser.ROTATE_MODE,"")),s.position=i._getNumber(e,t.DataParser.POSITION,0),s.spacing=i._getNumber(e,t.DataParser.SPACING,0),s.rotateOffset=i._getNumber(e,t.DataParser.ROTATE_OFFSET,0),s.rotateMix=i._getNumber(e,t.DataParser.ROTATE_MIX,1),s.translateMix=i._getNumber(e,t.DataParser.TRANSLATE_MIX,1);for(var c=0,l=o;c<l.length;c++){var u=l[c],h=this._armature.getBone(u);null!==h&&(s.AddBone(h),null===s.root&&(s.root=h))}return s},i.prototype._parseSlot=function(e,n){var r=t.BaseObject.borrowObject(t.SlotData);return r.displayIndex=i._getNumber(e,t.DataParser.DISPLAY_INDEX,0),r.zOrder=n,r.name=i._getString(e,t.DataParser.NAME,""),r.parent=this._armature.getBone(i._getString(e,t.DataParser.PARENT,"")),t.DataParser.BLEND_MODE in e&&"string"==typeof e[t.DataParser.BLEND_MODE]?r.blendMode=t.DataParser._getBlendMode(e[t.DataParser.BLEND_MODE]):r.blendMode=i._getNumber(e,t.DataParser.BLEND_MODE,0),t.DataParser.COLOR in e?(r.color=t.SlotData.createColor(),this._parseColorTransform(e[t.DataParser.COLOR],r.color)):r.color=t.SlotData.DEFAULT_COLOR,t.DataParser.ACTIONS in e&&(this._slotChildActions[r.name]=this._parseActionData(e[t.DataParser.ACTIONS],0,null,null)),r},i.prototype._parseSkin=function(e){var n=t.BaseObject.borrowObject(t.SkinData);if(n.name=i._getString(e,t.DataParser.NAME,t.DataParser.DEFAULT_NAME),0===n.name.length&&(n.name=t.DataParser.DEFAULT_NAME),t.DataParser.SLOT in e){var r=e[t.DataParser.SLOT];this._skin=n;for(var a=0,o=r;a<o.length;a++){var s=o[a],c=i._getString(s,t.DataParser.NAME,""),l=this._armature.getSlot(c);if(null!==l){if(this._slot=l,t.DataParser.DISPLAY in s)for(var u=0,h=s[t.DataParser.DISPLAY];u<h.length;u++){var f=h[u];f?n.addDisplay(c,this._parseDisplay(f)):n.addDisplay(c,null)}this._slot=null}}this._skin=null}return n},i.prototype._parseDisplay=function(e){var n=i._getString(e,t.DataParser.NAME,""),r=i._getString(e,t.DataParser.PATH,""),a=0,o=null;switch(a=t.DataParser.TYPE in e&&"string"==typeof e[t.DataParser.TYPE]?t.DataParser._getDisplayType(e[t.DataParser.TYPE]):i._getNumber(e,t.DataParser.TYPE,a)){case 0:var s=o=t.BaseObject.borrowObject(t.ImageDisplayData);s.name=n,s.path=r.length>0?r:n,this._parsePivot(e,s);break;case 1:var c=o=t.BaseObject.borrowObject(t.ArmatureDisplayData);if(c.name=n,c.path=r.length>0?r:n,c.inheritAnimation=!0,t.DataParser.ACTIONS in e)for(var l=0,u=this._parseActionData(e[t.DataParser.ACTIONS],0,null,null);l<u.length;l++){var h=u[l];c.addAction(h)}else if(this._slot.name in this._slotChildActions){var f=this._skin.getDisplays(this._slot.name);if(null===f?0===this._slot.displayIndex:this._slot.displayIndex===f.length){for(var _=0,p=this._slotChildActions[this._slot.name];_<p.length;_++)h=p[_],c.addAction(h);delete this._slotChildActions[this._slot.name]}}break;case 2:var d=o=t.BaseObject.borrowObject(t.MeshDisplayData);d.vertices.inheritDeform=i._getBoolean(e,t.DataParser.INHERIT_DEFORM,!0),d.name=n,d.path=r.length>0?r:n,d.vertices.data=this._data,t.DataParser.SHARE in e?(this._cacheRawMeshes.push(e),this._cacheMeshes.push(d)):this._parseMesh(e,d),t.DataParser.GLUE_WEIGHTS in e&&t.DataParser.GLUE_MESHES in e&&(this._cacheRawMeshes.push(e),this._cacheMeshes.push(d));break;case 3:var m=this._parseBoundingBox(e);if(null!==m){var g=o=t.BaseObject.borrowObject(t.BoundingBoxDisplayData);g.name=n,g.path=r.length>0?r:n,g.boundingBox=m}break;case 4:var v=e[t.DataParser.LENGTHS],y=o=t.BaseObject.borrowObject(t.PathDisplayData);y.closed=i._getBoolean(e,t.DataParser.CLOSED,!1),y.constantSpeed=i._getBoolean(e,t.DataParser.CONSTANT_SPEED,!1),y.name=n,y.path=r.length>0?r:n,y.vertices.data=this._data,y.curveLengths.length=v.length;for(var x=0,S=v.length;x<S;++x)y.curveLengths[x]=v[x];this._parsePath(e,y)}return null!==o&&t.DataParser.TRANSFORM in e&&this._parseTransform(e[t.DataParser.TRANSFORM],o.transform,this._armature.scale),o},i.prototype._parsePath=function(e,n){var r=e[t.DataParser.VERTICES],a=i._getNumber(e,t.DataParser.VERTEX_COUNT,0),o=this._floatArray.length,s=this._intArray.length;if(n.vertices.offset=s,this._intArray.length+=2,this._intArray[s+0]=a,this._intArray[s+2]=o,t.DataParser.WEIGHTS in e){var c=e[t.DataParser.WEIGHTS],l=e[t.DataParser.BONES],u=l.length,h=Math.floor(c.length-a)/2,f=this._intArray.length,_=this._floatArray.length,p=this._armature.sortedBones,d=t.BaseObject.borrowObject(t.WeightData);for(d.count=h,d.offset=f,this._intArray.length+=2+u+a+h,this._intArray[f+0]=u,this._intArray[f+1]=_,P=0;P<u;P++){var m=l[P],g=this._rawBones[m];d.addBone(g),this._intArray[f+2+P]=p.indexOf(g)}this._floatArray.length+=3*h,P=0;for(var v=0,y=0,x=f+2+u,S=_;P<h;P++){var T=c[v++];this._intArray[x++]=T;for(var A=0;A<T;A++){var E=c[v++],C=c[v++],b=r[y++],w=r[y++];this._intArray[x++]=l.indexOf(E),this._floatArray[S++]=C,this._floatArray[S++]=b,this._floatArray[S++]=w}}n.vertices.weight=d}else{this._floatArray.length+=r.length;for(var P=0,I=r.length;P<I;++P)this._floatArray[o+P]=r[P]}},i.prototype._parsePivot=function(e,n){if(t.DataParser.PIVOT in e){var r=e[t.DataParser.PIVOT];n.pivot.x=i._getNumber(r,t.DataParser.X,0),n.pivot.y=i._getNumber(r,t.DataParser.Y,0)}else n.pivot.x=.5,n.pivot.y=.5},i.prototype._parseMesh=function(e,n){var i=e[t.DataParser.VERTICES],r=e[t.DataParser.UVS],a=e[t.DataParser.TRIANGLES],o=Math.floor(i.length/2),s=Math.floor(a.length/3),c=this._floatArray.length,l=c+2*o,u=this._intArray.length,h=this._skin.name+"_"+this._slot.name+"_"+n.name;n.vertices.offset=u,this._intArray.length+=4+3*s,this._intArray[u+0]=o,this._intArray[u+1]=s,this._intArray[u+2]=c;for(var f=0,_=3*s;f<_;++f)this._intArray[u+4+f]=a[f];for(this._floatArray.length+=2*o+2*o,f=0,_=2*o;f<_;++f)this._floatArray[c+f]=i[f],this._floatArray[l+f]=r[f];if(t.DataParser.WEIGHTS in e){var p=e[t.DataParser.WEIGHTS],d=e[t.DataParser.SLOT_POSE],m=e[t.DataParser.BONE_POSE],g=this._armature.sortedBones,v=new Array,y=Math.floor(m.length/7),x=this._floatArray.length,S=Math.floor(p.length-o)/2,T=this._intArray.length,A=t.BaseObject.borrowObject(t.WeightData);for(A.count=S,A.offset=T,v.length=y,this._intArray.length+=2+y+o+S,this._intArray[T+1]=x,f=0;f<y;++f){var E=m[7*f],C=this._rawBones[E];A.addBone(C),v[f]=E,this._intArray[T+2+f]=g.indexOf(C)}this._floatArray.length+=3*S,this._helpMatrixA.copyFromArray(d,0),f=0;for(var b=0,w=T+2+y,P=x;f<o;++f){var I=2*f,R=this._intArray[w++]=p[b++],D=this._floatArray[c+I],O=this._floatArray[c+I+1];this._helpMatrixA.transformPoint(D,O,this._helpPoint),D=this._helpPoint.x,O=this._helpPoint.y;for(var M=0;M<R;++M){E=p[b++];var N=v.indexOf(E);this._helpMatrixB.copyFromArray(m,7*N+1),this._helpMatrixB.invert(),this._helpMatrixB.transformPoint(D,O,this._helpPoint),this._intArray[w++]=N,this._floatArray[P++]=p[b++],this._floatArray[P++]=this._helpPoint.x,this._floatArray[P++]=this._helpPoint.y}}n.vertices.weight=A,this._weightSlotPose[h]=d,this._weightBonePoses[h]=m}},i.prototype._parseMeshGlue=function(){},i.prototype._parseBoundingBox=function(e){var n=null,r=0;switch(r=t.DataParser.SUB_TYPE in e&&"string"==typeof e[t.DataParser.SUB_TYPE]?t.DataParser._getBoundingBoxType(e[t.DataParser.SUB_TYPE]):i._getNumber(e,t.DataParser.SUB_TYPE,r)){case 0:n=t.BaseObject.borrowObject(t.RectangleBoundingBoxData);break;case 1:n=t.BaseObject.borrowObject(t.EllipseBoundingBoxData);break;case 2:n=this._parsePolygonBoundingBox(e)}return null!==n&&(n.color=i._getNumber(e,t.DataParser.COLOR,0),0!==n.type&&1!==n.type||(n.width=i._getNumber(e,t.DataParser.WIDTH,0),n.height=i._getNumber(e,t.DataParser.HEIGHT,0))),n},i.prototype._parsePolygonBoundingBox=function(e){var n=t.BaseObject.borrowObject(t.PolygonBoundingBoxData);if(t.DataParser.VERTICES in e){var i=this._armature.scale,r=e[t.DataParser.VERTICES],a=n.vertices;t.DragonBones.webAssembly?a.resize(r.length,0):a.length=r.length;for(var o=0,s=r.length;o<s;o+=2){var c=r[o]*i,l=r[o+1]*i;t.DragonBones.webAssembly?(a.set(o,c),a.set(o+1,l)):(a[o]=c,a[o+1]=l),0===o?(n.x=c,n.y=l,n.width=c,n.height=l):(c<n.x?n.x=c:c>n.width&&(n.width=c),l<n.y?n.y=l:l>n.height&&(n.height=l))}n.width-=n.x,n.height-=n.y}else console.warn("Data error.\n Please reexport DragonBones Data to fixed the bug.");return n},i.prototype._parseAnimation=function(e){var n=t.BaseObject.borrowObject(t.AnimationData);if(n.frameCount=Math.max(i._getNumber(e,t.DataParser.DURATION,1),1),n.playTimes=i._getNumber(e,t.DataParser.PLAY_TIMES,1),n.duration=n.frameCount/this._armature.frameRate,n.fadeInTime=i._getNumber(e,t.DataParser.FADE_IN_TIME,0),n.scale=i._getNumber(e,t.DataParser.SCALE,1),n.name=i._getString(e,t.DataParser.NAME,t.DataParser.DEFAULT_NAME),0===n.name.length&&(n.name=t.DataParser.DEFAULT_NAME),n.frameIntOffset=this._frameIntArray.length,n.frameFloatOffset=this._frameFloatArray.length,n.frameOffset=this._frameArray.length,this._animation=n,t.DataParser.FRAME in e){var r=e[t.DataParser.FRAME],a=r.length;if(a>0)for(var o=0,s=0;o<a;++o){var c=r[o];this._parseActionDataInFrame(c,s,null,null),s+=i._getNumber(c,t.DataParser.DURATION,1)}}if(t.DataParser.Z_ORDER in e&&(this._animation.zOrderTimeline=this._parseTimeline(e[t.DataParser.Z_ORDER],null,t.DataParser.FRAME,1,!1,!1,0,this._parseZOrderFrame)),t.DataParser.BONE in e)for(var l=0,u=e[t.DataParser.BONE];l<u.length;l++){var h=u[l];this._parseBoneTimeline(h)}if(t.DataParser.SURFACE in e)for(var f=0,_=e[t.DataParser.SURFACE];f<_.length;f++){h=_[f];var p=i._getString(h,t.DataParser.NAME,"");this._surface=this._armature.getBone(p),null!==this._surface&&(null!==(P=this._parseTimeline(h,null,t.DataParser.FRAME,50,!1,!0,0,this._parseSurfaceFrame))&&this._animation.addSurfaceTimeline(this._surface,P),this._surface=null)}if(t.DataParser.SLOT in e)for(var d=0,m=e[t.DataParser.SLOT];d<m.length;d++)h=m[d],this._parseSlotTimeline(h);if(t.DataParser.FFD in e)for(var g=0,v=e[t.DataParser.FFD];g<v.length;g++){h=v[g];var y=i._getString(h,t.DataParser.SKIN,t.DataParser.DEFAULT_NAME),x=i._getString(h,t.DataParser.SLOT,""),S=i._getString(h,t.DataParser.NAME,"");0===y.length&&(y=t.DataParser.DEFAULT_NAME),this._slot=this._armature.getSlot(x),this._mesh=this._armature.getMesh(y,x,S),null!==this._slot&&null!==this._mesh&&(null!==(P=this._parseTimeline(h,null,t.DataParser.FRAME,22,!1,!0,0,this._parseSlotFFDFrame))&&this._animation.addSlotTimeline(this._slot,P),this._slot=null,this._mesh=null)}if(t.DataParser.IK in e)for(var T=0,A=e[t.DataParser.IK];T<A.length;T++){h=A[T];var E=i._getString(h,t.DataParser.NAME,""),C=this._armature.getConstraint(E);null!==C&&null!==(P=this._parseTimeline(h,null,t.DataParser.FRAME,30,!0,!1,2,this._parseIKConstraintFrame))&&this._animation.addConstraintTimeline(C,P)}if(t.DataParser.ANIMATION in e)for(var b=0,w=e[t.DataParser.ANIMATION];b<w.length;b++){h=w[b];var P,I=i._getString(h,t.DataParser.NAME,"");null!==(P=this._parseTimeline(h,null,t.DataParser.FRAME,40,!0,!1,2,this._parseAnimationFrame))&&this._animation.addAnimationTimeline(I,P)}return this._actionFrames.length>0&&(this._animation.actionTimeline=this._parseTimeline(null,this._actionFrames,"",0,!1,!1,0,this._parseActionFrame),this._actionFrames.length=0),this._animation=null,n},i.prototype._parseTimeline=function(e,r,a,o,s,c,l,u){if(null!==e&&a.length>0&&a in e&&(r=e[a]),null===r)return null;var h=r.length;if(0===h)return null;var f=this._frameIntArray.length,_=this._frameFloatArray.length,p=t.BaseObject.borrowObject(t.TimelineData),d=this._timelineArray.length;if(this._timelineArray.length+=5+h,null!==e?(this._timelineArray[d+0]=Math.round(100*i._getNumber(e,t.DataParser.SCALE,1)),this._timelineArray[d+1]=Math.round(100*i._getNumber(e,t.DataParser.OFFSET,0))):(this._timelineArray[d+0]=100,this._timelineArray[d+1]=0),this._timelineArray[d+2]=h,this._timelineArray[d+3]=l,this._timelineArray[d+4]=s?f-this._animation.frameIntOffset:c?_-this._animation.frameFloatOffset:0,this._timeline=p,p.type=o,p.offset=d,1===h)p.frameIndicesOffset=-1,this._timelineArray[d+5+0]=u.call(this,r[0],0,0)-this._animation.frameOffset;else{var m=this._animation.frameCount+1,g=this._data.frameIndices,v=0;t.DragonBones.webAssembly?(v=g.size(),g.resize(v+m,0)):(v=g.length,g.length+=m),p.frameIndicesOffset=v;for(var y=0,x=0,S=0,T=0;y<m;++y){if(S+T<=y&&x<h){var A=r[x];S=y,T=x===h-1?this._animation.frameCount-S:A instanceof n?this._actionFrames[x+1].frameStart-S:i._getNumber(A,t.DataParser.DURATION,1),this._timelineArray[d+5+x]=u.call(this,A,S,T)-this._animation.frameOffset,x++}t.DragonBones.webAssembly?g.set(v+y,x-1):g[v+y]=x-1}}return this._timeline=null,p},i.prototype._parseBoneTimeline=function(e){var n,r=this._armature.getBone(i._getString(e,t.DataParser.NAME,""));null!==r&&(this._bone=r,this._slot=this._armature.getSlot(this._bone.name),t.DataParser.TRANSLATE_FRAME in e&&null!==(n=this._parseTimeline(e,null,t.DataParser.TRANSLATE_FRAME,11,!1,!0,2,this._parseBoneTranslateFrame))&&this._animation.addBoneTimeline(r,n),t.DataParser.ROTATE_FRAME in e&&null!==(n=this._parseTimeline(e,null,t.DataParser.ROTATE_FRAME,12,!1,!0,2,this._parseBoneRotateFrame))&&this._animation.addBoneTimeline(r,n),t.DataParser.SCALE_FRAME in e&&null!==(n=this._parseTimeline(e,null,t.DataParser.SCALE_FRAME,13,!1,!0,2,this._parseBoneScaleFrame))&&this._animation.addBoneTimeline(r,n),t.DataParser.FRAME in e&&null!==(n=this._parseTimeline(e,null,t.DataParser.FRAME,10,!1,!0,6,this._parseBoneAllFrame))&&this._animation.addBoneTimeline(r,n),this._bone=null,this._slot=null)},i.prototype._parseSlotTimeline=function(e){var n=this._armature.getSlot(i._getString(e,t.DataParser.NAME,""));if(null!==n){this._slot=n;var r;null!==(r=t.DataParser.DISPLAY_FRAME in e?this._parseTimeline(e,null,t.DataParser.DISPLAY_FRAME,20,!1,!1,0,this._parseSlotDisplayFrame):this._parseTimeline(e,null,t.DataParser.FRAME,20,!1,!1,0,this._parseSlotDisplayFrame))&&this._animation.addSlotTimeline(n,r);var a;null!==(a=t.DataParser.COLOR_FRAME in e?this._parseTimeline(e,null,t.DataParser.COLOR_FRAME,21,!0,!1,1,this._parseSlotColorFrame):this._parseTimeline(e,null,t.DataParser.FRAME,21,!0,!1,1,this._parseSlotColorFrame))&&this._animation.addSlotTimeline(n,a),this._slot=null}},i.prototype._parseFrame=function(t,e){var n=this._frameArray.length;return this._frameArray.length+=1,this._frameArray[n+0]=e,n},i.prototype._parseTweenFrame=function(e,n,r){var a=this._parseFrame(e,n,r);if(r>0)if(t.DataParser.CURVE in e){var o=r+1;this._helpArray.length=o,this._samplingEasingCurve(e[t.DataParser.CURVE],this._helpArray),this._frameArray.length+=2+this._helpArray.length,this._frameArray[a+1]=2,this._frameArray[a+2]=o;for(var s=0;s<o;++s)this._frameArray[a+3+s]=Math.round(1e4*this._helpArray[s])}else{var c=-2;t.DataParser.TWEEN_EASING in e&&(c=i._getNumber(e,t.DataParser.TWEEN_EASING,-2)),-2===c?(this._frameArray.length+=1,this._frameArray[a+1]=0):0===c?(this._frameArray.length+=1,this._frameArray[a+1]=1):c<0?(this._frameArray.length+=2,this._frameArray[a+1]=3,this._frameArray[a+2]=Math.round(100*-c)):c<=1?(this._frameArray.length+=2,this._frameArray[a+1]=4,this._frameArray[a+2]=Math.round(100*c)):(this._frameArray.length+=2,this._frameArray[a+1]=5,this._frameArray[a+2]=Math.round(100*c-100))}else this._frameArray.length+=1,this._frameArray[a+1]=0;return a},i.prototype._parseActionFrame=function(t,e){var n=this._frameArray.length,i=t.actions.length;this._frameArray.length+=2+i,this._frameArray[n+0]=e,this._frameArray[n+0+1]=i;for(var r=0;r<i;++r)this._frameArray[n+0+2+r]=t.actions[r];return n},i.prototype._parseZOrderFrame=function(e,n,i){var r=this._parseFrame(e,n,i);if(t.DataParser.Z_ORDER in e){var a=e[t.DataParser.Z_ORDER];if(a.length>0){for(var o=this._armature.sortedSlots.length,s=new Array(o-a.length/2),c=new Array(o),l=0;l<s.length;++l)s[l]=0;for(var u=0;u<o;++u)c[u]=-1;for(var h=0,f=0,_=0,p=a.length;_<p;_+=2){for(var d=a[_],m=a[_+1];h!==d;)s[f++]=h++;c[h+m]=h++}for(;h<o;)s[f++]=h++;this._frameArray.length+=1+o,this._frameArray[r+1]=o;for(var g=o;g--;)-1===c[g]?this._frameArray[r+2+g]=s[--f]||0:this._frameArray[r+2+g]=c[g]||0;return r}}return this._frameArray.length+=1,this._frameArray[r+1]=0,r},i.prototype._parseBoneAllFrame=function(e,n,r){this._helpTransform.identity(),t.DataParser.TRANSFORM in e&&this._parseTransform(e[t.DataParser.TRANSFORM],this._helpTransform,1);var a=this._helpTransform.rotation;0!==n&&(0===this._prevClockwise?a=this._prevRotation+t.Transform.normalizeRadian(a-this._prevRotation):((this._prevClockwise>0?a>=this._prevRotation:a<=this._prevRotation)&&(this._prevClockwise=this._prevClockwise>0?this._prevClockwise-1:this._prevClockwise+1),a=this._prevRotation+a-this._prevRotation+t.Transform.PI_D*this._prevClockwise)),this._prevClockwise=i._getNumber(e,t.DataParser.TWEEN_ROTATE,0),this._prevRotation=a;var o=this._parseTweenFrame(e,n,r),s=this._frameFloatArray.length;return this._frameFloatArray.length+=6,this._frameFloatArray[s++]=this._helpTransform.x,this._frameFloatArray[s++]=this._helpTransform.y,this._frameFloatArray[s++]=a,this._frameFloatArray[s++]=this._helpTransform.skew,this._frameFloatArray[s++]=this._helpTransform.scaleX,this._frameFloatArray[s++]=this._helpTransform.scaleY,this._parseActionDataInFrame(e,n,this._bone,this._slot),o},i.prototype._parseBoneTranslateFrame=function(e,n,r){var a=this._parseTweenFrame(e,n,r),o=this._frameFloatArray.length;return this._frameFloatArray.length+=2,this._frameFloatArray[o++]=i._getNumber(e,t.DataParser.X,0),this._frameFloatArray[o++]=i._getNumber(e,t.DataParser.Y,0),a},i.prototype._parseBoneRotateFrame=function(e,n,r){var a=i._getNumber(e,t.DataParser.ROTATE,0)*t.Transform.DEG_RAD;0!==n&&(0===this._prevClockwise?a=this._prevRotation+t.Transform.normalizeRadian(a-this._prevRotation):((this._prevClockwise>0?a>=this._prevRotation:a<=this._prevRotation)&&(this._prevClockwise=this._prevClockwise>0?this._prevClockwise-1:this._prevClockwise+1),a=this._prevRotation+a-this._prevRotation+t.Transform.PI_D*this._prevClockwise)),this._prevClockwise=i._getNumber(e,t.DataParser.CLOCK_WISE,0),this._prevRotation=a;var o=this._parseTweenFrame(e,n,r),s=this._frameFloatArray.length;return this._frameFloatArray.length+=2,this._frameFloatArray[s++]=a,this._frameFloatArray[s++]=i._getNumber(e,t.DataParser.SKEW,0)*t.Transform.DEG_RAD,o},i.prototype._parseBoneScaleFrame=function(e,n,r){var a=this._parseTweenFrame(e,n,r),o=this._frameFloatArray.length;return this._frameFloatArray.length+=2,this._frameFloatArray[o++]=i._getNumber(e,t.DataParser.X,1),this._frameFloatArray[o++]=i._getNumber(e,t.DataParser.Y,1),a},i.prototype._parseSurfaceFrame=function(e,n,r){var a=this._frameFloatArray.length,o=this._parseTweenFrame(e,n,r),s=e[t.DataParser.VERTICES],c=i._getNumber(e,t.DataParser.OFFSET,0),l=this._surface.vertices.length/2,u=0,h=0;this._frameFloatArray.length+=2*l;for(var f=0;f<2*l;f+=2)u=f<c||f-c>=s.length?0:s[f-c],h=f+1<c||f+1-c>=s.length?0:s[f+1-c],this._frameFloatArray[a+f]=u,this._frameFloatArray[a+f+1]=h;if(0===n){var _=this._frameIntArray.length;this._frameIntArray.length+=5,this._frameIntArray[_+0]=0,this._frameIntArray[_+1]=this._frameFloatArray.length-a,this._frameIntArray[_+2]=this._frameFloatArray.length-a,this._frameIntArray[_+3]=0,this._frameIntArray[_+4]=a-this._animation.frameFloatOffset,this._timelineArray[this._timeline.offset+3]=_-this._animation.frameIntOffset}return o},i.prototype._parseSlotDisplayFrame=function(e,n,r){var a=this._parseFrame(e,n,r);return this._frameArray.length+=1,t.DataParser.VALUE in e?this._frameArray[a+1]=i._getNumber(e,t.DataParser.VALUE,0):this._frameArray[a+1]=i._getNumber(e,t.DataParser.DISPLAY_INDEX,0),this._parseActionDataInFrame(e,n,this._slot.parent,this._slot),a},i.prototype._parseSlotColorFrame=function(e,n,i){var r=this._parseTweenFrame(e,n,i),a=-1;if(t.DataParser.VALUE in e||t.DataParser.COLOR in e){var o=t.DataParser.VALUE in e?e[t.DataParser.VALUE]:e[t.DataParser.COLOR];for(var s in o){this._parseColorTransform(o,this._helpColorTransform),a=this._intArray.length,this._intArray.length+=8,this._intArray[a++]=Math.round(100*this._helpColorTransform.alphaMultiplier),this._intArray[a++]=Math.round(100*this._helpColorTransform.redMultiplier),this._intArray[a++]=Math.round(100*this._helpColorTransform.greenMultiplier),this._intArray[a++]=Math.round(100*this._helpColorTransform.blueMultiplier),this._intArray[a++]=Math.round(this._helpColorTransform.alphaOffset),this._intArray[a++]=Math.round(this._helpColorTransform.redOffset),this._intArray[a++]=Math.round(this._helpColorTransform.greenOffset),this._intArray[a++]=Math.round(this._helpColorTransform.blueOffset),a-=8;break}}a<0&&(this._defaultColorOffset<0&&(this._defaultColorOffset=a=this._intArray.length,this._intArray.length+=8,this._intArray[a++]=100,this._intArray[a++]=100,this._intArray[a++]=100,this._intArray[a++]=100,this._intArray[a++]=0,this._intArray[a++]=0,this._intArray[a++]=0,this._intArray[a++]=0),a=this._defaultColorOffset);var c=this._frameIntArray.length;return this._frameIntArray.length+=1,this._frameIntArray[c]=a,r},i.prototype._parseSlotFFDFrame=function(e,n,r){var a=this._frameFloatArray.length,o=this._parseTweenFrame(e,n,r),s=t.DataParser.VERTICES in e?e[t.DataParser.VERTICES]:null,c=i._getNumber(e,t.DataParser.OFFSET,0),l=this._intArray[this._mesh.vertices.offset+0],u=this._mesh.parent.name+"_"+this._slot.name+"_"+this._mesh.name,h=this._mesh.vertices.weight,f=0,_=0,p=0,d=0;if(null!==h){var m=this._weightSlotPose[u];this._helpMatrixA.copyFromArray(m,0),this._frameFloatArray.length+=2*h.count,p=h.offset+2+h.bones.length}else this._frameFloatArray.length+=2*l;for(var g=0;g<2*l;g+=2)if(null===s?(f=0,_=0):(f=g<c||g-c>=s.length?0:s[g-c],_=g+1<c||g+1-c>=s.length?0:s[g+1-c]),null!==h){var v=this._weightBonePoses[u],y=this._intArray[p++];this._helpMatrixA.transformPoint(f,_,this._helpPoint,!0),f=this._helpPoint.x,_=this._helpPoint.y;for(var x=0;x<y;++x){var S=this._intArray[p++];this._helpMatrixB.copyFromArray(v,7*S+1),this._helpMatrixB.invert(),this._helpMatrixB.transformPoint(f,_,this._helpPoint,!0),this._frameFloatArray[a+d++]=this._helpPoint.x,this._frameFloatArray[a+d++]=this._helpPoint.y}}else this._frameFloatArray[a+g]=f,this._frameFloatArray[a+g+1]=_;if(0===n){var T=this._frameIntArray.length;this._frameIntArray.length+=5,this._frameIntArray[T+0]=this._mesh.vertices.offset,this._frameIntArray[T+1]=this._frameFloatArray.length-a,this._frameIntArray[T+2]=this._frameFloatArray.length-a,this._frameIntArray[T+3]=0,this._frameIntArray[T+4]=a-this._animation.frameFloatOffset,this._timelineArray[this._timeline.offset+3]=T-this._animation.frameIntOffset}return o},i.prototype._parseIKConstraintFrame=function(e,n,r){var a=this._parseTweenFrame(e,n,r),o=this._frameIntArray.length;return this._frameIntArray.length+=2,this._frameIntArray[o++]=i._getBoolean(e,t.DataParser.BEND_POSITIVE,!0)?1:0,this._frameIntArray[o++]=Math.round(100*i._getNumber(e,t.DataParser.WEIGHT,1)),a},i.prototype._parseAnimationFrame=function(e,n,r){var a=this._parseTweenFrame(e,n,r),o=this._frameIntArray.length;return this._frameIntArray.length+=2,this._frameIntArray[o++]=i._getNumber(e,t.DataParser.VALUE,0),this._frameIntArray[o++]=Math.round(100*i._getNumber(e,t.DataParser.WEIGHT,1)),a},i.prototype._parseActionData=function(e,n,r,a){var o=new Array;if("string"==typeof e)(u=t.BaseObject.borrowObject(t.ActionData)).type=n,u.name=e,u.bone=r,u.slot=a,o.push(u);else if(e instanceof Array)for(var s=0,c=e;s<c.length;s++){var l=c[s],u=t.BaseObject.borrowObject(t.ActionData);if(t.DataParser.GOTO_AND_PLAY in l?(u.type=0,u.name=i._getString(l,t.DataParser.GOTO_AND_PLAY,"")):(t.DataParser.TYPE in l&&"string"==typeof l[t.DataParser.TYPE]?u.type=t.DataParser._getActionType(l[t.DataParser.TYPE]):u.type=i._getNumber(l,t.DataParser.TYPE,n),u.name=i._getString(l,t.DataParser.NAME,"")),t.DataParser.BONE in l){var h=i._getString(l,t.DataParser.BONE,"");u.bone=this._armature.getBone(h)}else u.bone=r;if(t.DataParser.SLOT in l){var f=i._getString(l,t.DataParser.SLOT,"");u.slot=this._armature.getSlot(f)}else u.slot=a;var _=null;if(t.DataParser.INTS in l){null===_&&(_=t.BaseObject.borrowObject(t.UserData));for(var p=0,d=l[t.DataParser.INTS];p<d.length;p++){var m=d[p];_.addInt(m)}}if(t.DataParser.FLOATS in l){null===_&&(_=t.BaseObject.borrowObject(t.UserData));for(var g=0,v=l[t.DataParser.FLOATS];g<v.length;g++)m=v[g],_.addFloat(m)}if(t.DataParser.STRINGS in l){null===_&&(_=t.BaseObject.borrowObject(t.UserData));for(var y=0,x=l[t.DataParser.STRINGS];y<x.length;y++)m=x[y],_.addString(m)}u.data=_,o.push(u)}return o},i.prototype._parseTransform=function(e,n,r){n.x=i._getNumber(e,t.DataParser.X,0)*r,n.y=i._getNumber(e,t.DataParser.Y,0)*r,t.DataParser.ROTATE in e||t.DataParser.SKEW in e?(n.rotation=t.Transform.normalizeRadian(i._getNumber(e,t.DataParser.ROTATE,0)*t.Transform.DEG_RAD),n.skew=t.Transform.normalizeRadian(i._getNumber(e,t.DataParser.SKEW,0)*t.Transform.DEG_RAD)):(t.DataParser.SKEW_X in e||t.DataParser.SKEW_Y in e)&&(n.rotation=t.Transform.normalizeRadian(i._getNumber(e,t.DataParser.SKEW_Y,0)*t.Transform.DEG_RAD),n.skew=t.Transform.normalizeRadian(i._getNumber(e,t.DataParser.SKEW_X,0)*t.Transform.DEG_RAD)-n.rotation),n.scaleX=i._getNumber(e,t.DataParser.SCALE_X,1),n.scaleY=i._getNumber(e,t.DataParser.SCALE_Y,1)},i.prototype._parseColorTransform=function(e,n){n.alphaMultiplier=.01*i._getNumber(e,t.DataParser.ALPHA_MULTIPLIER,100),n.redMultiplier=.01*i._getNumber(e,t.DataParser.RED_MULTIPLIER,100),n.greenMultiplier=.01*i._getNumber(e,t.DataParser.GREEN_MULTIPLIER,100),n.blueMultiplier=.01*i._getNumber(e,t.DataParser.BLUE_MULTIPLIER,100),n.alphaOffset=i._getNumber(e,t.DataParser.ALPHA_OFFSET,0),n.redOffset=i._getNumber(e,t.DataParser.RED_OFFSET,0),n.greenOffset=i._getNumber(e,t.DataParser.GREEN_OFFSET,0),n.blueOffset=i._getNumber(e,t.DataParser.BLUE_OFFSET,0)},i.prototype._parseArray=function(){this._intArray.length=0,this._floatArray.length=0,this._frameIntArray.length=0,this._frameFloatArray.length=0,this._frameArray.length=0,this._timelineArray.length=0},i.prototype._modifyArray=function(){this._intArray.length%Int16Array.BYTES_PER_ELEMENT!=0&&this._intArray.push(0),this._frameIntArray.length%Int16Array.BYTES_PER_ELEMENT!=0&&this._frameIntArray.push(0),this._frameArray.length%Int16Array.BYTES_PER_ELEMENT!=0&&this._frameArray.push(0),this._timelineArray.length%Uint16Array.BYTES_PER_ELEMENT!=0&&this._timelineArray.push(0);var e=this._intArray.length*Int16Array.BYTES_PER_ELEMENT,n=this._floatArray.length*Float32Array.BYTES_PER_ELEMENT,i=this._frameIntArray.length*Int16Array.BYTES_PER_ELEMENT,r=this._frameFloatArray.length*Float32Array.BYTES_PER_ELEMENT,a=this._frameArray.length*Int16Array.BYTES_PER_ELEMENT,o=this._timelineArray.length*Uint16Array.BYTES_PER_ELEMENT,s=e+n+i+r+a+o;if(t.DragonBones.webAssembly){for(var c=t.webAssemblyModule.HEAP16.buffer,l=t.webAssemblyModule._malloc(s),u=new Int16Array(c,l,this._intArray.length),h=new Float32Array(c,l+e,this._floatArray.length),f=new Int16Array(c,l+e+n,this._frameIntArray.length),_=new Float32Array(c,l+e+n+i,this._frameFloatArray.length),p=new Int16Array(c,l+e+n+i+r,this._frameArray.length),d=new Uint16Array(c,l+e+n+i+r+a,this._timelineArray.length),m=0,g=this._intArray.length;m<g;++m)u[m]=this._intArray[m];for(m=0,g=this._floatArray.length;m<g;++m)h[m]=this._floatArray[m];for(m=0,g=this._frameIntArray.length;m<g;++m)f[m]=this._frameIntArray[m];for(m=0,g=this._frameFloatArray.length;m<g;++m)_[m]=this._frameFloatArray[m];for(m=0,g=this._frameArray.length;m<g;++m)p[m]=this._frameArray[m];for(m=0,g=this._timelineArray.length;m<g;++m)d[m]=this._timelineArray[m];t.webAssemblyModule.setDataBinary(this._data,l,e,n,i,r,a,o)}else{var v=new ArrayBuffer(s);for(u=new Int16Array(v,0,this._intArray.length),h=new Float32Array(v,e,this._floatArray.length),f=new Int16Array(v,e+n,this._frameIntArray.length),_=new Float32Array(v,e+n+i,this._frameFloatArray.length),p=new Int16Array(v,e+n+i+r,this._frameArray.length),d=new Uint16Array(v,e+n+i+r+a,this._timelineArray.length),m=0,g=this._intArray.length;m<g;++m)u[m]=this._intArray[m];for(m=0,g=this._floatArray.length;m<g;++m)h[m]=this._floatArray[m];for(m=0,g=this._frameIntArray.length;m<g;++m)f[m]=this._frameIntArray[m];for(m=0,g=this._frameFloatArray.length;m<g;++m)_[m]=this._frameFloatArray[m];for(m=0,g=this._frameArray.length;m<g;++m)p[m]=this._frameArray[m];for(m=0,g=this._timelineArray.length;m<g;++m)d[m]=this._timelineArray[m];this._data.binary=v,this._data.intArray=u,this._data.floatArray=h,this._data.frameIntArray=f,this._data.frameFloatArray=_,this._data.frameArray=p,this._data.timelineArray=d}this._defaultColorOffset=-1},i.prototype.parseDragonBonesData=function(e,n){void 0===n&&(n=1),console.assert(null!=e,"Data error.");var r=i._getString(e,t.DataParser.VERSION,""),a=i._getString(e,t.DataParser.COMPATIBLE_VERSION,"");if(t.DataParser.DATA_VERSIONS.indexOf(r)>=0||t.DataParser.DATA_VERSIONS.indexOf(a)>=0){var o=t.BaseObject.borrowObject(t.DragonBonesData);if(o.version=r,o.name=i._getString(e,t.DataParser.NAME,""),o.frameRate=i._getNumber(e,t.DataParser.FRAME_RATE,24),0===o.frameRate&&(o.frameRate=24),t.DataParser.ARMATURE in e){this._data=o,this._parseArray(e);for(var s=0,c=e[t.DataParser.ARMATURE];s<c.length;s++){var l=c[s];o.addArmature(this._parseArmature(l,n))}this._data.binary||this._modifyArray(),t.DataParser.STAGE in e?o.stage=o.getArmature(i._getString(e,t.DataParser.STAGE,"")):o.armatureNames.length>0&&(o.stage=o.getArmature(o.armatureNames[0])),this._data=null}return t.DataParser.TEXTURE_ATLAS in e&&(this._rawTextureAtlases=e[t.DataParser.TEXTURE_ATLAS]),o}return console.assert(!1,"Nonsupport data version: "+r+"\nPlease convert DragonBones data to support version.\nRead more: https://github.com/DragonBones/Tools/"),null},i.prototype.parseTextureAtlasData=function(e,n,r){if(void 0===r&&(r=1),console.assert(void 0!==e),null===e){if(null===this._rawTextureAtlases||0===this._rawTextureAtlases.length)return!1;var a=this._rawTextureAtlases[this._rawTextureAtlasIndex++];return this.parseTextureAtlasData(a,n,r),this._rawTextureAtlasIndex>=this._rawTextureAtlases.length&&(this._rawTextureAtlasIndex=0,this._rawTextureAtlases=null),!0}if(n.width=i._getNumber(e,t.DataParser.WIDTH,0),n.height=i._getNumber(e,t.DataParser.HEIGHT,0),n.scale=1===r?1/i._getNumber(e,t.DataParser.SCALE,1):r,n.name=i._getString(e,t.DataParser.NAME,""),n.imagePath=i._getString(e,t.DataParser.IMAGE_PATH,""),t.DataParser.SUB_TEXTURE in e)for(var o=e[t.DataParser.SUB_TEXTURE],s=0,c=o.length;s<c;++s){var l=o[s],u=n.createTexture();u.rotated=i._getBoolean(l,t.DataParser.ROTATED,!1),u.name=i._getString(l,t.DataParser.NAME,""),u.region.x=i._getNumber(l,t.DataParser.X,0),u.region.y=i._getNumber(l,t.DataParser.Y,0),u.region.width=i._getNumber(l,t.DataParser.WIDTH,0),u.region.height=i._getNumber(l,t.DataParser.HEIGHT,0);var h=i._getNumber(l,t.DataParser.FRAME_WIDTH,-1),f=i._getNumber(l,t.DataParser.FRAME_HEIGHT,-1);h>0&&f>0&&(u.frame=t.TextureData.createRectangle(),u.frame.x=i._getNumber(l,t.DataParser.FRAME_X,0),u.frame.y=i._getNumber(l,t.DataParser.FRAME_Y,0),u.frame.width=h,u.frame.height=f),n.addTexture(u)}return!0},i.getInstance=function(){return null===i._objectDataParserInstance&&(i._objectDataParserInstance=new i),i._objectDataParserInstance},i._objectDataParserInstance=null,i}(t.DataParser);t.ObjectDataParser=e;var n=function(){this.frameStart=0,this.actions=[]};t.ActionFrame=n}(j_t||(j_t={})),function(t){var e=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return V_t(n,e),n.prototype._inRange=function(t,e,n){return e<=t&&t<=n},n.prototype._decodeUTF8=function(t){for(var e,n=0,i="",r=0,a=0,o=0,s=0;t.length>n;){var c=t[n++];if(-1===c)e=0!==a?65533:-1;else if(0===a)this._inRange(c,0,127)?e=c:(this._inRange(c,194,223)?(a=1,s=128,r=c-192):this._inRange(c,224,239)?(a=2,s=2048,r=c-224):this._inRange(c,240,244)&&(a=3,s=65536,r=c-240),r*=Math.pow(64,a),e=null);else if(this._inRange(c,128,191))if(o+=1,r+=(c-128)*Math.pow(64,a-o),o!==a)e=null;else{var l=r,u=s;r=0,a=0,o=0,s=0,e=this._inRange(l,u,1114111)&&!this._inRange(l,55296,57343)?l:c}else r=0,a=0,o=0,s=0,n--,e=c;null!==e&&-1!==e&&(e<=65535?e>0&&(i+=String.fromCharCode(e)):(e-=65536,i+=String.fromCharCode(55296+(e>>10&1023)),i+=String.fromCharCode(56320+(1023&e))))}return i},n.prototype._getUTF16Key=function(t){for(var e=0,n=t.length;e<n;++e)if(t.charCodeAt(e)>255)return encodeURI(t);return t},n.prototype._parseBinaryTimeline=function(e,n,i){void 0===i&&(i=null);var r=null!==i?i:t.BaseObject.borrowObject(t.TimelineData);r.type=e,r.offset=n,this._timeline=r;var a=this._timelineArrayBuffer[r.offset+2];if(1===a)r.frameIndicesOffset=-1;else{var o=0,s=this._animation.frameCount+1,c=this._data.frameIndices;t.DragonBones.webAssembly?(o=c.size(),c.resize(o+s,0)):(o=c.length,c.length+=s),r.frameIndicesOffset=o;for(var l=0,u=0,h=0,f=0;l<s;++l)h+f<=l&&u<a&&(h=this._frameArrayBuffer[this._animation.frameOffset+this._timelineArrayBuffer[r.offset+5+u]],f=u===a-1?this._animation.frameCount-h:this._frameArrayBuffer[this._animation.frameOffset+this._timelineArrayBuffer[r.offset+5+u+1]]-h,u++),t.DragonBones.webAssembly?c.set(o+l,u-1):c[o+l]=u-1}return this._timeline=null,r},n.prototype._parseVertices=function(e,n){n.offset=e[t.DataParser.OFFSET];var i=this._intArrayBuffer[n.offset+3];if(i>=0){var r=t.BaseObject.borrowObject(t.WeightData),a=this._intArrayBuffer[n.offset+0],o=this._intArrayBuffer[i+0];r.offset=i;for(var s=0;s<o;++s){var c=this._intArrayBuffer[i+2+s];r.addBone(this._rawBones[c])}for(var l=i+2+o,u=0,h=(s=0,a);s<h;++s){var f=this._intArrayBuffer[l++];u+=f,l+=f}r.count=u,n.weight=r}},n.prototype._parseMesh=function(t,e){this._parseVertices(t,e.vertices)},n.prototype._parsePath=function(t,e){this._parseVertices(t,e.vertices)},n.prototype._parseAnimation=function(e){var n=t.BaseObject.borrowObject(t.AnimationData);n.frameCount=Math.max(t.ObjectDataParser._getNumber(e,t.DataParser.DURATION,1),1),n.playTimes=t.ObjectDataParser._getNumber(e,t.DataParser.PLAY_TIMES,1),n.duration=n.frameCount/this._armature.frameRate,n.fadeInTime=t.ObjectDataParser._getNumber(e,t.DataParser.FADE_IN_TIME,0),n.scale=t.ObjectDataParser._getNumber(e,t.DataParser.SCALE,1),n.name=t.ObjectDataParser._getString(e,t.DataParser.NAME,t.DataParser.DEFAULT_NAME),0===n.name.length&&(n.name=t.DataParser.DEFAULT_NAME);var i=e[t.DataParser.OFFSET];if(n.frameIntOffset=i[0],n.frameFloatOffset=i[1],n.frameOffset=i[2],this._animation=n,t.DataParser.ACTION in e&&(n.actionTimeline=this._parseBinaryTimeline(0,e[t.DataParser.ACTION])),t.DataParser.Z_ORDER in e&&(n.zOrderTimeline=this._parseBinaryTimeline(1,e[t.DataParser.Z_ORDER])),t.DataParser.BONE in e){var r=e[t.DataParser.BONE];for(var a in r){var o=r[a];t.DragonBones.webAssembly&&(a=this._getUTF16Key(a));var s=this._armature.getBone(a);if(null!==s)for(var c=0,l=o.length;c<l;c+=2){var u=o[c],h=o[c+1],f=this._parseBinaryTimeline(u,h);this._animation.addBoneTimeline(s,f)}}}if(t.DataParser.SURFACE in e)for(var a in r=e[t.DataParser.SURFACE]){o=r[a],t.DragonBones.webAssembly&&(a=this._getUTF16Key(a));var _=this._armature.getBone(a);if(null!==_)for(c=0,l=o.length;c<l;c+=2)u=o[c],h=o[c+1],f=this._parseBinaryTimeline(u,h),this._animation.addSurfaceTimeline(_,f)}if(t.DataParser.SLOT in e)for(var a in r=e[t.DataParser.SLOT]){o=r[a],t.DragonBones.webAssembly&&(a=this._getUTF16Key(a));var p=this._armature.getSlot(a);if(null!==p)for(c=0,l=o.length;c<l;c+=2)u=o[c],h=o[c+1],f=this._parseBinaryTimeline(u,h),this._animation.addSlotTimeline(p,f)}if(t.DataParser.CONSTRAINT in e)for(var a in r=e[t.DataParser.CONSTRAINT]){o=r[a],t.DragonBones.webAssembly&&(a=this._getUTF16Key(a));var d=this._armature.getConstraint(a);if(null!==d)for(c=0,l=o.length;c<l;c+=2)u=o[c],h=o[c+1],f=this._parseBinaryTimeline(u,h),this._animation.addConstraintTimeline(d,f)}if(t.DataParser.ANIMATION in e)for(var a in r=e[t.DataParser.ANIMATION])for(o=r[a],t.DragonBones.webAssembly&&(a=this._getUTF16Key(a)),c=0,l=o.length;c<l;c+=2)u=o[c],h=o[c+1],f=this._parseBinaryTimeline(u,h),this._animation.addAnimationTimeline(a,f);return this._animation=null,n},n.prototype._parseArray=function(e){var n=e[t.DataParser.OFFSET],i=n[1],r=n[3],a=n[5],o=n[7],s=n[9],c=n[11],l=new Int16Array(this._binary,this._binaryOffset+n[0],i/Int16Array.BYTES_PER_ELEMENT),u=new Float32Array(this._binary,this._binaryOffset+n[2],r/Float32Array.BYTES_PER_ELEMENT),h=new Int16Array(this._binary,this._binaryOffset+n[4],a/Int16Array.BYTES_PER_ELEMENT),f=new Float32Array(this._binary,this._binaryOffset+n[6],o/Float32Array.BYTES_PER_ELEMENT),_=new Int16Array(this._binary,this._binaryOffset+n[8],s/Int16Array.BYTES_PER_ELEMENT),p=new Uint16Array(this._binary,this._binaryOffset+n[10],c/Uint16Array.BYTES_PER_ELEMENT);if(t.DragonBones.webAssembly){for(var d=i+r+a+o+s+c,m=t.webAssemblyModule._malloc(d),g=new Uint8Array(this._binary,this._binaryOffset,d/Uint8Array.BYTES_PER_ELEMENT),v=new Uint8Array(t.webAssemblyModule.HEAP16.buffer,m,g.length),y=0,x=g.length;y<x;++y)v[y]=g[y];t.webAssemblyModule.setDataBinary(this._data,m,i,r,a,o,s,c),this._intArrayBuffer=l,this._floatArrayBuffer=u,this._frameIntArrayBuffer=h,this._frameFloatArrayBuffer=f,this._frameArrayBuffer=_,this._timelineArrayBuffer=p}else this._data.binary=this._binary,this._data.intArray=this._intArrayBuffer=l,this._data.floatArray=this._floatArrayBuffer=u,this._data.frameIntArray=this._frameIntArrayBuffer=h,this._data.frameFloatArray=this._frameFloatArrayBuffer=f,this._data.frameArray=this._frameArrayBuffer=_,this._data.timelineArray=this._timelineArrayBuffer=p},n.prototype.parseDragonBonesData=function(t,n){void 0===n&&(n=1),console.assert(null!=t&&t instanceof ArrayBuffer,"Data error.");var i=new Uint8Array(t,0,8);if(i[0]!=="D".charCodeAt(0)||i[1]!=="B".charCodeAt(0)||i[2]!=="D".charCodeAt(0)||i[3]!=="T".charCodeAt(0))return console.assert(!1,"Nonsupport data."),null;var r=new Uint32Array(t,8,1)[0],a=new Uint8Array(t,12,r),o=this._decodeUTF8(a),s=JSON.parse(o);return this._binaryOffset=12+r,this._binary=t,e.prototype.parseDragonBonesData.call(this,s,n)},n.getInstance=function(){return null===n._binaryDataParserInstance&&(n._binaryDataParserInstance=new n),n._binaryDataParserInstance},n._binaryDataParserInstance=null,n}(t.ObjectDataParser);t.BinaryDataParser=e}(j_t||(j_t={})),function(t){var e=function(){function e(n){void 0===n&&(n=null),this.autoSearch=!1,this._dragonBonesDataMap={},this._textureAtlasDataMap={},this._dragonBones=null,this._dataParser=null,null===e._objectParser&&(e._objectParser=new t.ObjectDataParser),null===e._binaryParser&&(e._binaryParser=new t.BinaryDataParser),this._dataParser=null!==n?n:e._objectParser}return e.prototype._isSupportMesh=function(){return!0},e.prototype._getTextureData=function(t,e){if(t in this._textureAtlasDataMap)for(var n=0,i=this._textureAtlasDataMap[t];n<i.length;n++)if(null!==(c=(s=i[n]).getTexture(e)))return c;if(this.autoSearch)for(var r in this._textureAtlasDataMap)for(var a=0,o=this._textureAtlasDataMap[r];a<o.length;a++){var s,c;if((s=o[a]).autoSearch&&null!==(c=s.getTexture(e)))return c}return null},e.prototype._fillBuildArmaturePackage=function(t,e,n,i,r){var a=null,o=null;if(e.length>0&&e in this._dragonBonesDataMap&&(o=(a=this._dragonBonesDataMap[e]).getArmature(n)),null===o&&(0===e.length||this.autoSearch))for(var s in this._dragonBonesDataMap)if(a=this._dragonBonesDataMap[s],(0===e.length||a.autoSearch)&&null!==(o=a.getArmature(n))){e=s;break}if(null!==o){if(t.dataName=e,t.textureAtlasName=r,t.data=a,t.armature=o,t.skin=null,i.length>0&&(t.skin=o.getSkin(i),null===t.skin&&this.autoSearch))for(var s in this._dragonBonesDataMap){var c=this._dragonBonesDataMap[s].getArmature(i);if(null!==c){t.skin=c.defaultSkin;break}}return null===t.skin&&(t.skin=o.defaultSkin),!0}return!1},e.prototype._buildBones=function(e,n){for(var i=0,r=e.armature.sortedBones;i<r.length;i++){var a=r[i];t.BaseObject.borrowObject(0===a.type?t.Bone:t.Surface).init(a,n)}},e.prototype._buildSlots=function(e,n){var i=e.skin,r=e.armature.defaultSkin;if(null!==i&&null!==r){var a={};for(var o in r.displays){var s=r.getDisplays(o);a[o]=s}if(i!==r)for(var o in i.displays)s=i.getDisplays(o),a[o]=s;for(var c=0,l=e.armature.sortedSlots;c<l.length;c++){var u=l[c],h=u.name in a?a[u.name]:null,f=this._buildSlot(e,u,n);if(f.rawDisplayDatas=h,null!==h){for(var _=new Array,p=0,d=t.DragonBones.webAssembly?h.size():h.length;p<d;++p){var m=t.DragonBones.webAssembly?h.get(p):h[p];null!==m?_.push(this._getSlotDisplay(e,m,null,f)):_.push(null)}f._setDisplayList(_)}f._setDisplayIndex(u.displayIndex,!0)}}},e.prototype._buildConstraints=function(e,n){var i=e.armature.constraints;for(var r in i){var a=i[r];switch(a.type){case 0:var o=t.BaseObject.borrowObject(t.IKConstraint);o.init(a,n),n._addConstraint(o);break;case 1:var s=t.BaseObject.borrowObject(t.PathConstraint);s.init(a,n),n._addConstraint(s);break;default:var c=t.BaseObject.borrowObject(t.IKConstraint);c.init(a,n),n._addConstraint(c)}}},e.prototype._buildChildArmature=function(t,e,n){return this.buildArmature(n.path,null!==t?t.dataName:"","",null!==t?t.textureAtlasName:"")},e.prototype._getSlotDisplay=function(e,n,i,r){var a=null!==e?e.dataName:n.parent.parent.parent.name,o=null;switch(n.type){case 0:var s=n;null!==e&&e.textureAtlasName.length>0&&(s.texture=this._getTextureData(e.textureAtlasName,n.path)),null===s.texture&&(s.texture=this._getTextureData(a,n.path)),o=null!==i&&2===i.type&&this._isSupportMesh()?r.meshDisplay:r.rawDisplay;break;case 2:var c=n;null!==e&&e.textureAtlasName.length>0&&(c.texture=this._getTextureData(e.textureAtlasName,c.path)),null===c.texture&&(c.texture=this._getTextureData(a,c.path)),o=this._isSupportMesh()?r.meshDisplay:r.rawDisplay;break;case 1:var l=n,u=this._buildChildArmature(e,r,n);if(null!==u){if(u.inheritAnimation=l.inheritAnimation,!u.inheritAnimation){var h=l.actions.length>0?l.actions:u.armatureData.defaultActions;if(h.length>0)for(var f=0,_=h;f<_.length;f++){var p=_[f],d=t.BaseObject.borrowObject(t.EventObject);t.EventObject.actionDataToInstance(p,d,r.armature),d.slot=r,r.armature._bufferAction(d,!1)}else u.animation.play()}l.armature=u.armatureData}o=u}return o},e.prototype.parseDragonBonesData=function(t,n,i){void 0===n&&(n=null),void 0===i&&(i=1);for(var r=t instanceof ArrayBuffer?e._binaryParser:this._dataParser,a=r.parseDragonBonesData(t,i);;){var o=this._buildTextureAtlasData(null,null);if(!r.parseTextureAtlasData(null,o,i)){o.returnToPool();break}this.addTextureAtlasData(o,n)}return null!==a&&this.addDragonBonesData(a,n),a},e.prototype.parseTextureAtlasData=function(t,e,n,i){void 0===n&&(n=null),void 0===i&&(i=1);var r=this._buildTextureAtlasData(null,null);return this._dataParser.parseTextureAtlasData(t,r,i),this._buildTextureAtlasData(r,e||null),this.addTextureAtlasData(r,n),r},e.prototype.updateTextureAtlasData=function(t,e){var n=this.getTextureAtlasData(t);if(null!==n)for(var i=0,r=n.length;i<r;++i)i<e.length&&this._buildTextureAtlasData(n[i],e[i])},e.prototype.getDragonBonesData=function(t){return t in this._dragonBonesDataMap?this._dragonBonesDataMap[t]:null},e.prototype.addDragonBonesData=function(t,e){if(void 0===e&&(e=null),(e=null!==e?e:t.name)in this._dragonBonesDataMap){if(this._dragonBonesDataMap[e]===t)return;console.warn("Can not add same name data: "+e)}else this._dragonBonesDataMap[e]=t},e.prototype.removeDragonBonesData=function(t,e){void 0===e&&(e=!0),t in this._dragonBonesDataMap&&(e&&this._dragonBones.bufferObject(this._dragonBonesDataMap[t]),delete this._dragonBonesDataMap[t])},e.prototype.getTextureAtlasData=function(t){return t in this._textureAtlasDataMap?this._textureAtlasDataMap[t]:null},e.prototype.addTextureAtlasData=function(t,e){void 0===e&&(e=null);var n=(e=null!==e?e:t.name)in this._textureAtlasDataMap?this._textureAtlasDataMap[e]:this._textureAtlasDataMap[e]=[];n.indexOf(t)<0&&n.push(t)},e.prototype.removeTextureAtlasData=function(t,e){if(void 0===e&&(e=!0),t in this._textureAtlasDataMap){var n=this._textureAtlasDataMap[t];if(e)for(var i=0,r=n;i<r.length;i++){var a=r[i];this._dragonBones.bufferObject(a)}delete this._textureAtlasDataMap[t]}},e.prototype.getArmatureData=function(t,e){void 0===e&&(e="");var i=new n;return this._fillBuildArmaturePackage(i,e,t,"","")?i.armature:null},e.prototype.clear=function(t){for(var e in void 0===t&&(t=!0),this._dragonBonesDataMap)t&&this._dragonBones.bufferObject(this._dragonBonesDataMap[e]),delete this._dragonBonesDataMap[e];for(var e in this._textureAtlasDataMap){if(t)for(var n=0,i=this._textureAtlasDataMap[e];n<i.length;n++){var r=i[n];this._dragonBones.bufferObject(r)}delete this._textureAtlasDataMap[e]}},e.prototype.buildArmature=function(t,e,i,r){void 0===e&&(e=""),void 0===i&&(i=""),void 0===r&&(r="");var a=new n;if(!this._fillBuildArmaturePackage(a,e||"",t,i||"",r||""))return console.warn("No armature data: "+t+", "+(null!==e?e:"")),null;var o=this._buildArmature(a);return this._buildBones(a,o),this._buildSlots(a,o),this._buildConstraints(a,o),o.invalidUpdate(null,!0),o.advanceTime(0),o},e.prototype.replaceDisplay=function(e,n,i){void 0===i&&(i=-1),i<0&&(i=e.displayIndex),i<0&&(i=0),e.replaceDisplayData(n,i);var r=e.displayList;if(r.length<=i){r.length=i+1;for(var a=0,o=r.length;a<o;++a)r[a]||(r[a]=null)}if(null!==n){var s=e.rawDisplayDatas,c=null;s&&(t.DragonBones.webAssembly?i<s.size()&&(c=s.get(i)):i<s.length&&(c=s[i])),r[i]=this._getSlotDisplay(null,n,c,e)}else r[i]=null;e.displayList=r},e.prototype.replaceSlotDisplay=function(t,e,n,i,r,a){void 0===a&&(a=-1);var o=this.getArmatureData(e,t||"");if(!o||!o.defaultSkin)return!1;var s=o.defaultSkin.getDisplay(n,i);return!!s&&(this.replaceDisplay(r,s,a),!0)},e.prototype.replaceSlotDisplayList=function(e,n,i,r){var a=this.getArmatureData(n,e||"");if(!a||!a.defaultSkin)return!1;var o=a.defaultSkin.getDisplays(i);if(!o)return!1;for(var s=0,c=0,l=t.DragonBones.webAssembly?o.size():o.length;c<l;++c){var u=t.DragonBones.webAssembly?o.get(c):o[c];this.replaceDisplay(r,u,s++)}return!0},e.prototype.replaceSkin=function(e,n,i,r){void 0===i&&(i=!1),void 0===r&&(r=null);for(var a=!1,o=n.parent.defaultSkin,s=0,c=e.getSlots();s<c.length;s++){var l=c[s];if(!(null!==r&&r.indexOf(l.name)>=0)){var u=n.getDisplays(l.name);if(u||(null!==o&&n!==o&&(u=o.getDisplays(l.name)),u)){var h=t.DragonBones.webAssembly?u.size():u.length,f=l.displayList;f.length=h;for(var _=0,p=h;_<p;++_){var d=t.DragonBones.webAssembly?u.get(_):u[_];f[_]=null!==d?this._getSlotDisplay(null,d,null,l):null}a=!0,l.rawDisplayDatas=u,l.displayList=f}else i&&(l.rawDisplayDatas=null,l.displayList=[])}}return a},e.prototype.replaceAnimation=function(e,n,i){void 0===i&&(i=!0);var r=n.defaultSkin;if(null===r)return!1;if(i)e.animation.animations=n.animations;else{var a=e.animation.animations,o={};for(var s in a)o[s]=a[s];for(var s in n.animations)o[s]=n.animations[s];e.animation.animations=o}for(var c=0,l=e.getSlots();c<l.length;c++)for(var u=l[c],h=0,f=0,_=u.displayList;f<_.length;f++){var p=_[f];if(p instanceof t.Armature){var d=r.getDisplays(u.name);if(null!==d&&h<(t.DragonBones.webAssembly?d.size():d.length)){var m=t.DragonBones.webAssembly?d.get(h):d[h];if(null!==m&&1===m.type){var g=this.getArmatureData(m.path,m.parent.parent.parent.name);g&&this.replaceAnimation(p,g,i)}}}h++}return!0},e.prototype.getAllDragonBonesData=function(){return this._dragonBonesDataMap},e.prototype.getAllTextureAtlasData=function(){return this._textureAtlasDataMap},Object.defineProperty(e.prototype,"clock",{get:function(){return this._dragonBones.clock},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dragonBones",{get:function(){return this._dragonBones},enumerable:!0,configurable:!0}),e.prototype.changeSkin=function(t,e,n){return void 0===n&&(n=null),this.replaceSkin(t,e,!1,n)},e.prototype.copyAnimationsToArmature=function(t,e,n,i,r){void 0===i&&(i=""),void 0===r&&(r=!0);var a=this.getArmatureData(e,i);return!!a&&this.replaceAnimation(t,a,r)},e._objectParser=null,e._binaryParser=null,e}();t.BaseFactory=e;var n=function(){this.dataName="",this.textureAtlasName="",this.skin=null};t.BuildArmaturePackage=n}(j_t||(j_t={})),function(t){t.BinaryOffset={WeigthBoneCount:0,WeigthFloatOffset:1,WeigthBoneIndices:2,MeshVertexCount:0,MeshTriangleCount:1,MeshFloatOffset:2,MeshWeightOffset:3,MeshVertexIndices:4,TimelineScale:0,TimelineOffset:1,TimelineKeyFrameCount:2,TimelineFrameValueCount:3,TimelineFrameValueOffset:4,TimelineFrameOffset:5,FramePosition:0,FrameTweenType:1,FrameTweenEasingOrCurveSampleCount:2,FrameCurveSamples:3,DeformMeshOffset:0,DeformCount:1,DeformValueCount:2,DeformValueOffset:3,DeformFloatOffset:4},t.ArmatureType={Armature:0,MovieClip:1,Stage:2},t.BoneType={Bone:0,Surface:1},t.DisplayType={Image:0,Armature:1,Mesh:2,BoundingBox:3},t.BoundingBoxType={Rectangle:0,Ellipse:1,Polygon:2},t.ActionType={Play:0,Stop:1,GotoAndPlay:2,GotoAndStop:3,FadeIn:4,FadeOut:5,Frame:10,Sound:11},t.BlendMode={Normal:0,Add:1,Alpha:2,Darken:3,Difference:4,Erase:5,HardLight:6,Invert:7,Layer:8,Lighten:9,Multiply:10,Overlay:11,Screen:12,Subtract:13},t.TweenType={None:0,Line:1,Curve:2,QuadIn:3,QuadOut:4,QuadInOut:5},t.TimelineType={Action:0,ZOrder:1,BoneAll:10,BoneTranslate:11,BoneRotate:12,BoneScale:13,Surface:50,SlotDisplay:20,SlotColor:21,SlotFFD:22,IKConstraint:30,AnimationTime:40,AnimationWeight:41}}(j_t||(j_t={}));var W_t,X_t,q_t,Y_t,K_t,Q_t,Z_t,J_t,$_t,tpt,ept,npt,ipt,rpt=j_t.DragonBones,apt=j_t.BaseObject,opt=j_t.Matrix,spt=j_t.Transform,cpt=j_t.ColorTransform,lpt=j_t.Point,upt=j_t.Rectangle,hpt=j_t.UserData,fpt=j_t.ActionData,_pt=j_t.DragonBonesData,ppt=j_t.ArmatureData,dpt=j_t.BoneData,mpt=j_t.SurfaceData,gpt=j_t.SlotData,vpt=j_t.ConstraintData,ypt=j_t.IKConstraintData,xpt=j_t.PathConstraintData,Spt=j_t.CanvasData,Tpt=j_t.SkinData,Apt=j_t.VerticesData,Ept=j_t.DisplayData,Cpt=j_t.ImageDisplayData,bpt=j_t.ArmatureDisplayData,wpt=j_t.MeshDisplayData,Ppt=j_t.BoundingBoxDisplayData,Ipt=j_t.PathDisplayData,Rpt=j_t.WeightData,Dpt=j_t.BoundingBoxData,Opt=j_t.RectangleBoundingBoxData,Mpt=j_t.EllipseBoundingBoxData,Npt=j_t.PolygonBoundingBoxData,Lpt=j_t.AnimationData,Bpt=j_t.TimelineData,Fpt=j_t.AnimationConfig,zpt=j_t.TextureAtlasData,Upt=j_t.TextureData,kpt=j_t.DeformVertices,Gpt=j_t.Armature,Hpt=j_t.TransformObject,Vpt=j_t.Bone,jpt=j_t.Surface,Wpt=j_t.Slot,Xpt=j_t.Constraint,qpt=j_t.IKConstraint,Ypt=j_t.PathConstraint,Kpt=j_t.WorldClock,Qpt=j_t.Animation,Zpt=j_t.AnimationState,Jpt=j_t.BonePose,$pt=j_t.BlendState,tdt=j_t.TimelineState,edt=j_t.TweenTimelineState,ndt=j_t.BoneTimelineState,idt=j_t.SlotTimelineState,rdt=j_t.ConstraintTimelineState,adt=j_t.ActionTimelineState,odt=j_t.ZOrderTimelineState,sdt=j_t.BoneAllTimelineState,cdt=j_t.BoneTranslateTimelineState,ldt=j_t.BoneRotateTimelineState,udt=j_t.BoneScaleTimelineState,hdt=j_t.SurfaceTimelineState,fdt=j_t.SlotDislayTimelineState,_dt=j_t.SlotColorTimelineState,pdt=j_t.DeformTimelineState,ddt=j_t.IKConstraintTimelineState,mdt=j_t.AnimationTimelineState,gdt=j_t.EventObject,vdt=j_t.DataParser,ydt=j_t.ObjectDataParser,xdt=j_t.ActionFrame,Sdt=j_t.BinaryDataParser,Tdt=j_t.BaseFactory,Adt=j_t.BuildArmaturePackage,Edt=j_t.BinaryOffset,Cdt=j_t.ArmatureType,bdt=j_t.BoneType,wdt=j_t.DisplayType,Pdt=j_t.BoundingBoxType,Idt=j_t.ActionType,Rdt=j_t.BlendMode,Ddt=j_t.TweenType,Odt=j_t.TimelineType,Mdt=nl("dragonBones.CCTextureAtlasData")(W_t=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._renderTexture=null,e}F(e,t),e.toString=function(){return"[class dragonBones.CCTextureAtlasData]"};var n=e.prototype;return n.createTexture=function(){return apt.borrowObject(Ndt)},n._onClear=function(){t.prototype._onClear.call(this),this.renderTexture=null},L(e,[{key:"renderTexture",get:function(){return this._renderTexture},set:function(t){if(this._renderTexture=t,t)for(var e in this.textures){var n=this.textures[e];if(!n.spriteFrame){var i=null;n.rotated?i=new Vi(n.region.x,n.region.y,n.region.height,n.region.width):(i=new Vi(n.region.x,n.region.y,n.region.width,n.region.height),n.spriteFrame=new uj,n.spriteFrame.texture=t,n.spriteFrame.rect=i)}}else for(var r in this.textures)this.textures[r].spriteFrame=null}}]),e}(zpt))||W_t,Ndt=nl("dragonBones.CCTextureData")(X_t=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).spriteFrame=null,e}return F(e,t),e.toString=function(){return"[class dragonBones.CCTextureData]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.spriteFrame=null},e}(Upt))||X_t,Ldt=nl("dragonBones.CCSlot")(q_t=function(t){function e(){var e;return(e=t.call(this)||this)._localVertices=void 0,e._indices=void 0,e._matrix=void 0,e._worldMatrix=void 0,e._worldMatrixDirty=void 0,e._color=void 0,e._localVertices=[],e._indices=[],e._matrix=new Ri,e._worldMatrix=new Ri,e._worldMatrixDirty=!0,e._visible=!1,e._color=new _i,e}F(e,t),e.toString=function(){return"[class dragonBones.CCSlot]"};var n=e.prototype;return n.getTexture=function(){return this._textureData?this._textureData.spriteFrame.texture:null},n.calculWorldMatrix=function(){var t=this._armature._parent;t?this._mulMat(this._worldMatrix,t._worldMatrix,this._matrix):Ri.copy(this._worldMatrix,this._matrix),this._worldMatrixDirty=!1},n._onClear=function(){t.prototype._onClear.call(this),this._localVertices.length=0,this._indices.length=0,Ri.identity(this._matrix),Ri.identity(this._worldMatrix),this._worldMatrixDirty=!0,this._color=new _i,this._visible=!1},n._onUpdateDisplay=function(){},n._initDisplay=function(){},n._addDisplay=function(){this._visible=!0},n._replaceDisplay=function(){},n._removeDisplay=function(){this._visible=!1},n._disposeDisplay=function(){},n._updateVisible=function(){this._visible=this.parent.visible},n._updateGlueMesh=function(){},n._updateZOrder=function(){},n._updateBlendMode=function(){if(this._childArmature)for(var t=this._childArmature.getSlots(),e=0,n=t.length;e<n;e++){var i=t[e];i._blendMode=this._blendMode,i._updateBlendMode()}},n._updateColor=function(){var t=this._color;t.r=255*this._colorTransform.redMultiplier,t.g=255*this._colorTransform.greenMultiplier,t.b=255*this._colorTransform.blueMultiplier,t.a=255*this._colorTransform.alphaMultiplier},n._updateFrame=function(){this._indices.length=0;var t=this._indices,e=this._localVertices,n=0,i=0,r=this._textureData;if(this._display&&!(this._displayIndex<0)&&r&&r.spriteFrame){var a=r.spriteFrame.texture,o=a.width,s=a.height,c=r.region;if(0!==o&&0!==s){var l=null!==this._deformVertices&&this._display===this._meshDisplay?this._deformVertices.verticesData:null;if(l){var u=l.data,h=u.intArray,f=u.floatArray,_=h[l.offset+Edt.MeshVertexCount],p=h[l.offset+Edt.MeshTriangleCount],d=h[l.offset+Edt.MeshFloatOffset];d<0&&(d+=65536);for(var m=d+2*_,g=this._armature._armatureData.scale,v=0,y=2*_;v<y;v+=2)e[i++]=f[d+v]*g,e[i++]=-f[d+v+1]*g,l.rotated?(e[i++]=(c.x+(1-f[m+v])*c.width)/o,e[i++]=(c.y+f[m+v+1]*c.height)/s):(e[i++]=(c.x+f[m+v]*c.width)/o,e[i++]=(c.y+f[m+v+1]*c.height)/s);for(var x=0;x<3*p;++x)t[n++]=h[l.offset+Edt.MeshVertexIndices+x];e.length=i,t.length=n,l.weight&&this._identityTransform()}else{var S=c.x/o,T=(c.y+c.height)/s,A=(c.x+c.width)/o,E=c.y/s;e[i++]=0,e[i++]=0,e[i++]=S,e[i++]=T,e[i++]=c.width,e[i++]=0,e[i++]=A,e[i++]=T,e[i++]=0,e[i++]=c.height,e[i++]=S,e[i++]=E,e[i++]=c.width,e[i++]=c.height,e[i++]=A,e[i++]=E,t[0]=0,t[1]=1,t[2]=2,t[3]=1,t[4]=3,t[5]=2,e.length=i,t.length=6}this._visibleDirty=!0,this._blendModeDirty=!0,this._colorDirty=!0}else console.error("SpriteFrame "+r.spriteFrame.name+" incorrect size "+o+" x "+s)}},n._updateMesh=function(){var t=this._armature._armatureData.scale,e=this._deformVertices.vertices,n=this._deformVertices.bones,i=this._deformVertices.verticesData,r=i.weight,a=e.length>0&&i.inheritDeform,o=this._localVertices;if(r){var s=i.data,c=s.intArray,l=s.floatArray,u=c[i.offset+Edt.MeshVertexCount],h=c[r.offset+Edt.WeigthFloatOffset];h<0&&(h+=65536);for(var f=0,_=r.offset+Edt.WeigthBoneIndices+n.length,p=h,d=0,m=0;f<u;f++,m+=4){for(var g=c[_++],v=0,y=0,x=0;x<g;++x){var S=n[c[_++]];if(null!==S){var T=S.globalTransformMatrix,A=l[p++],E=l[p++]*t,C=l[p++]*t;a&&(E+=e[d++],C+=e[d++]),v+=(T.a*E+T.c*C+T.tx)*A,y+=(T.b*E+T.d*C+T.ty)*A}}o[m]=v,o[m+1]=-y}}else if(a){var b=this._parent._boneData.type!==bdt.Bone,w=i.data,P=w.intArray,I=w.floatArray,R=P[i.offset+Edt.MeshVertexCount],D=P[i.offset+Edt.MeshFloatOffset];D<0&&(D+=65536);for(var O=0,M=R,N=0;O<M;O++,N+=4){var L=I[D+2*O]*t+e[2*O],B=I[D+2*O+1]*t+e[2*O+1];if(b){var F=this._parent._getGlobalTransformMatrix(L,B);o[N]=F.a*L+F.c*B+F.tx,o[N+1]=-F.b*L+F.d*B+F.ty}else o[N]=L,o[N+1]=-B}}r&&this._identityTransform()},n._identityTransform=function(){var t=this._matrix;t.m00=1,t.m01=0,t.m04=-0,t.m05=-1,t.m12=0,t.m13=0,this._worldMatrixDirty=!0},n._updateTransform=function(){var t=this._matrix;t.m00=this.globalTransformMatrix.a,t.m01=this.globalTransformMatrix.b,t.m04=-this.globalTransformMatrix.c,t.m05=-this.globalTransformMatrix.d,this._childArmature?(t.m12=this.globalTransformMatrix.tx,t.m13=this.globalTransformMatrix.ty):(t.m12=this.globalTransformMatrix.tx-(this.globalTransformMatrix.a*this._pivotX-this.globalTransformMatrix.c*this._pivotY),t.m13=this.globalTransformMatrix.ty-(this.globalTransformMatrix.b*this._pivotX-this.globalTransformMatrix.d*this._pivotY)),this._worldMatrixDirty=!0},n.updateWorldMatrix=function(){if(this._armature){var t=this._armature._parent;if(t&&t.updateWorldMatrix(),this._worldMatrixDirty){this.calculWorldMatrix();var e=this.childArmature;if(!e)return;for(var n=e.getSlots(),i=0,r=n.length;i<r;i++){var a=n[i];a&&(a._worldMatrixDirty=!0)}}}},n._mulMat=function(t,e,n){var i=e.m00,r=e.m01,a=e.m04,o=e.m05,s=e.m12,c=e.m13,l=n.m00,u=n.m01,h=n.m04,f=n.m05,_=n.m12,p=n.m13;0!==r||0!==a?(t.m00=l*i+u*a,t.m01=l*r+u*o,t.m04=h*i+f*a,t.m05=h*r+f*o,t.m12=i*_+a*p+s,t.m13=r*_+o*p+c):(t.m00=l*i,t.m01=u*o,t.m04=h*i,t.m05=f*o,t.m12=i*_+s,t.m13=o*p+c)},e}(Wpt))||q_t,Bdt=nl("dragonBones.CCArmatureDisplay")(Y_t=function(t){function e(){var e;return(e=t.call(this)||this).shouldAdvanced=!1,e._ccNode=null,e._ccComponent=null,e._eventTarget=void 0,e._armature=null,e._eventTarget=new fn,e}F(e,t);var n=e.prototype;return n.hasEvent=function(){return console.warn("Method not implemented."),!1},n.addEvent=function(){console.warn("Method not implemented.")},n.removeEvent=function(){console.warn("Method not implemented.")},n.setEventTarget=function(t){this._eventTarget=t},n.getRootDisplay=function(){var t,e=this._armature._parent;if(!e)return this;for(;e;)t=e,e=e._armature._parent;return t._armature.display},n.convertToRootSpace=function(t){var e=this._armature._parent;if(!e)return t;e.updateWorldMatrix();var n=e._worldMatrix,i=new di(0,0);return i.x=t.x*n.m00+t.y*n.m04+n.m12,i.y=t.x*n.m01+t.y*n.m05+n.m13,i},n.convertToWorldSpace=function(t){var e,n=this.convertToRootSpace(t),i=this.getRootNode();return null==i||null===(e=i._uiProps.uiTransformComp)||void 0===e?void 0:e.convertToWorldSpaceAR(n)},n.getRootNode=function(){var t=this.getRootDisplay();return t&&t._ccNode},n.dbInit=function(t){this._armature=t},n.dbClear=function(){this._armature=null},n.dbUpdate=function(){this._ccComponent&&this._ccComponent.markForUpdateRenderData()},n.advanceTimeBySelf=function(t){this.shouldAdvanced=!!t},n.hasDBEventListener=function(t){return this._eventTarget.hasEventListener(t)},n.addDBEventListener=function(t,e,n){this._eventTarget.on(t,e,n)},n.removeDBEventListener=function(t,e,n){this._eventTarget.off(t,e,n)},n.dispatchDBEvent=function(t,e){this._eventTarget.emit(t,e)},L(e,[{key:"node",get:function(){return this}}]),e}(Ept))||Y_t,Fdt=nl("CCFactory")((Z_t=Q_t=function(t){function e(){var e;(e=t.call(this)||this).id=void 0,e.uuid=void 0,e._slots=void 0;var n=new Bdt;return e._dragonBones=new rpt(n),WM.getScheduler()&&(VM.on(HM.EVENT_RESTART,e.onRestart,V(e)),e.initUpdate()),e.id=e.uuid="CCFactory",e}F(e,t),e.getInstance=function(){return e._factory||(e._factory=new e),e._factory};var n=e.prototype;return n.onRestart=function(){e._factory=null},n.initUpdate=function(){zM.enableForTarget(this),WM.getScheduler().scheduleUpdate(this,DM.Priority.HIGH,!1)},n.update=function(t){this._dragonBones.advanceTime(t)},n.getDragonBonesDataByRawData=function(t){return(t instanceof ArrayBuffer?Tdt._binaryParser:this._dataParser).parseDragonBonesData(t,1)},n.buildArmatureDisplay=function(t,e,n,i){var r=this.buildArmature(t,e,n,i);return r?r._display:null},n.createArmatureNode=function(t,e,n){var i=(n=n||new qC).getComponent("dragonBones.ArmatureDisplay");return i||(i=n.addComponent("dragonBones.ArmatureDisplay")),n.name=e,i._armatureName=e,i._dragonAsset=t.dragonAsset,i._dragonAtlasAsset=t.dragonAtlasAsset,i._init(),i},n._buildTextureAtlasData=function(t,e){return t?t.renderTexture=e:t=apt.borrowObject(Mdt),t},n._sortSlots=function(){for(var t=this._slots,e=[],n=0,i=t.length;n<i;n++){for(var r=t[n],a=r._zOrder,o=!1,s=e.length-1;s>=0;s--)if(a>=e[s]._zOrder){e.splice(s+1,0,r),o=!0;break}o||e.unshift(r)}this._slots=e},n._buildArmature=function(t){var e=apt.borrowObject(Gpt);e._skinData=t.skin,e._animation=apt.borrowObject(Qpt),e._animation._armature=e,e._animation.animations=t.armature.animations,e._isChildArmature=!1;var n=new Bdt;return e.init(t.armature,n,n,this._dragonBones),e},n._buildSlot=function(t,e,n){var i=apt.borrowObject(Ldt),r=i;return i.init(e,n,r,r),i},n.getDragonBonesDataByUUID=function(t){for(var e in this._dragonBonesDataMap)if(-1!==e.indexOf(t))return this._dragonBonesDataMap[e];return null},n.removeDragonBonesDataByUUID=function(t,e){for(var n in void 0===e&&(e=!0),this._dragonBonesDataMap)-1!==n.indexOf(t)&&(e&&this._dragonBones.bufferObject(this._dragonBonesDataMap[n]),delete this._dragonBonesDataMap[n])},e}(Tdt),Q_t._factory=null,K_t=Z_t))||K_t,zdt=1/60,Udt=[],kdt=[],Gdt=0,Hdt=0,Vdt=0,jdt=null,Wdt=null,Xdt=0,qdt=0,Ydt=0,Kdt=0,Qdt=0,Zdt=function(){function t(){this.maxVertexCount=0,this.maxIndexCount=0,this._privateMode=!1,this._inited=!1,this._invalid=!0,this._enableCacheAttachedInfo=!1,this.frames=[],this.totalTime=0,this.isCompleted=!1,this._frameIdx=-1,this._armatureInfo=null,this._animationName=null,this._tempSegments=null,this._tempColors=null,this._tempBoneInfos=null}var e=t.prototype;return e.init=function(t,e){this._inited=!0,this._armatureInfo=t,this._animationName=e},e.clear=function(){this._inited=!1;for(var t=0,e=this.frames.length;t<e;t++)this.frames[t].segments.length=0;this.invalidAllFrame()},e.begin=function(){if(this._invalid){var t=this._armatureInfo,e=t.curAnimationCache;e&&e!==this&&(this._privateMode?e.invalidAllFrame():e.updateToFrame()),t.armature.animation.play(this._animationName,1),t.curAnimationCache=this,this._invalid=!1,this._frameIdx=-1,this.totalTime=0,this.isCompleted=!1}},e.end=function(){this._needToUpdate()||(this._armatureInfo.curAnimationCache=null,this.frames.length=this._frameIdx+1,this.isCompleted=!0)},e._needToUpdate=function(t){return!this._armatureInfo.armature.animation.isCompleted&&this.totalTime<30&&(void 0===t||this._frameIdx<t)},e.updateToFrame=function(t){if(this._inited&&(this.begin(),this._needToUpdate(t))){var e=this._armatureInfo.armature;do{e.advanceTime(zdt),this._frameIdx++,this.updateFrame(e,this._frameIdx),this.totalTime+=zdt}while(this._needToUpdate(t));this.end()}},e.isInited=function(){return this._inited},e.isInvalid=function(){return this._invalid},e.invalidAllFrame=function(){this.isCompleted=!1,this._invalid=!0},e.updateAllFrame=function(){this.invalidAllFrame(),this.updateToFrame()},e.enableCacheAttachedInfo=function(){this._enableCacheAttachedInfo||(this._enableCacheAttachedInfo=!0,this.invalidAllFrame())},e.updateFrame=function(t,e){Vdt=0,Gdt=0,Hdt=0,jdt=null,Wdt=null,Xdt=0,qdt=0,Ydt=0,Kdt=0,Qdt=0,this.frames[e]=this.frames[e]||{segments:[],colors:[],boneInfos:[],vertices:null,uintVert:null,indices:null};var n=this.frames[e],i=this._tempSegments=n.segments,r=this._tempColors=n.colors,a=this._tempBoneInfos=n.boneInfos;this._traverseArmature(t,1),Kdt>0&&(r[Kdt-1].vfOffset=Vdt),r.length=Kdt,a.length=Gdt;var o=Ydt-1;if(o>=0)if(qdt>0){var s=i[o];s.indexCount=qdt,s.vfCount=9*Xdt,s.vertexCount=Xdt,i.length=Ydt}else i.length=Ydt-1;if(0!==i.length){var c,l=n.vertices,u=Vdt/5,h=9*u;(!l||l.length<Vdt)&&(l=n.vertices=new Float32Array(h));for(var f=0,_=0;f<h;)l[f]=Udt[_++],l[f+1]=Udt[_++],l[f+3]=Udt[_++],l[f+4]=Udt[_++],c=Udt[_++],l[f+5]=(255&c)/255,l[f+6]=(c>>8&255)/255,l[f+7]=(c>>16&255)/255,l[f+8]=(c>>24&255)/255,f+=9;var p=n.indices;(!p||p.length<Hdt)&&(p=n.indices=new Uint16Array(Hdt));for(var d=0;d<Hdt;d++)p[d]=kdt[d];n.vertices=l,n.indices=p,this.maxVertexCount=u>this.maxVertexCount?u:this.maxVertexCount,this.maxIndexCount=p.length>this.maxIndexCount?p.length:this.maxIndexCount}},e._traverseArmature=function(t,e){var n,i,r,a,o,s,c,l,u,h=this._tempColors,f=this._tempSegments,_=this._tempBoneInfos,p=t._slots,d=t._bones;if(this._enableCacheAttachedInfo)for(var m=0,g=d.length;m<g;m++,Gdt++){var v=d[m],y=_[Gdt];y||(y=_[Gdt]={globalTransformMatrix:new opt});var x=v.globalTransformMatrix;y.globalTransformMatrix.copyFrom(x)}for(var S=0,T=p.length;S<T;S++)if((r=p[S])._visible&&r._displayData)if(r.updateWorldMatrix(),o=r._color,r.childArmature)this._traverseArmature(r.childArmature,e*o.a/255);else if(c=r.getTexture()){jdt===c.nativeUrl&&Wdt===r._blendMode||(jdt=c.nativeUrl,Wdt=r._blendMode,(l=Ydt-1)>=0&&(qdt>0?((u=f[l]).indexCount=qdt,u.vertexCount=Xdt,u.vfCount=9*Xdt):Ydt--),f[Ydt]={tex:c,blendMode:r._blendMode,indexCount:0,vertexCount:0,vfCount:0},Ydt++,qdt=0,Xdt=0),s=(o.a*e<<24>>>0)+(o.b<<16)+(o.g<<8)+o.r,Qdt!==s&&(Qdt=s,Kdt>0&&(h[Kdt-1].vfOffset=Vdt),h[Kdt++]={r:o.r,g:o.g,b:o.b,a:o.a*e,vfOffset:0}),n=r._localVertices,i=r._indices,a=r._worldMatrix;for(var A=0,E=n.length;A<E;)J_t=n[A++],$_t=n[A++],Udt[Vdt++]=J_t*a.m00+$_t*a.m04+a.m12,Udt[Vdt++]=J_t*a.m01+$_t*a.m05+a.m13,Udt[Vdt++]=n[A++],Udt[Vdt++]=n[A++],Udt[Vdt++]=s;for(var C=0,b=i.length;C<b;C++)kdt[Hdt++]=Xdt+i[C];qdt+=i.length,Xdt+=n.length/4}},t}(),Jdt=function(){function t(){this._privateMode=!1,this._animationPool={},this._armatureCache={}}var e=t.prototype;return e.enablePrivateMode=function(){this._privateMode=!0},e.dispose=function(){for(var t in this._armatureCache){var e=this._armatureCache[t];if(e){var n=e.armature;n&&n.dispose()}}this._armatureCache={},this._animationPool={}},e._removeArmature=function(t){var e=this._armatureCache[t],n=e.animationsCache;for(var i in n){var r=n[i];r&&(this._animationPool[t+"#"+i]=r,r.clear())}var a=e.armature;a&&a.dispose(),delete this._armatureCache[t]},e.resetArmature=function(t){for(var e in this._armatureCache)-1!==e.indexOf(t)&&this._removeArmature(e)},e.getArmatureCache=function(e,n,i){var r,a=this._armatureCache[n];if(a)r=a.armature;else{var o=Fdt.getInstance().buildArmatureDisplay(e,n,"",i);if(!o||!o._armature)return null;if(r=o._armature,!t.canCache(r))return r.dispose(),null;this._armatureCache[n]={armature:r,animationsCache:{},curAnimationCache:null}}return r},e.getAnimationCache=function(t,e){var n=this._armatureCache[t];return n?n.animationsCache[e]:null},e.initAnimationCache=function(t,e){if(!e)return null;var n=this._armatureCache[t],i=n&&n.armature;if(!i)return null;if(!i.animation.hasAnimation(e))return null;var r=n.animationsCache,a=r[e];if(!a){var o=t+"#"+e;(a=this._animationPool[o])?delete this._animationPool[o]:(a=new Zdt)._privateMode=this._privateMode,a.init(n,e),r[e]=a}return a},e.invalidAnimationCache=function(t){var e=this._armatureCache[t];if(e&&e.armature){var n=e.animationsCache;for(var i in n)n[i].invalidAllFrame()}},e.updateAnimationCache=function(t,e){if(e){var n=this.initAnimationCache(t,e);if(!n)return;n.updateAllFrame()}else{var i=this._armatureCache[t];if(!i||!i.armature)return;var r=i.animationsCache;for(var a in r)r[a].updateAllFrame()}},t.canCache=function(t){for(var e=t._slots,n=0,i=e.length;n<i;n++)if(e[n].childArmature)return!1;return!0},t}();Jdt.FrameTime=zdt,Jdt.sharedCache=new Jdt;var $dt,tmt,emt,nmt,imt,rmt,amt,omt,smt,cmt=nl("dragonBones.DragonBonesAsset")((ipt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return X(e=t.call.apply(t,[this].concat(i))||this,"_dragonBonesJson",npt,V(e)),e._factory=null,e._dragonBonesJsonData=void 0,e._armaturesEnum=null,e}F(e,t);var n=e.prototype;return n.constructctor=function(){this.reset()},n.createNode=function(t){var e=new qC(this.name);return e.addComponent("dragonBones.ArmatureDisplay").dragonAsset=this,t(null,e)},n.reset=function(){this._clear()},n.init=function(t,e){this._factory=t,!this._dragonBonesJsonData&&this.dragonBonesJson&&(this._dragonBonesJsonData=JSON.parse(this.dragonBonesJson));var n;if(n=this._dragonBonesJsonData?this._dragonBonesJsonData:this._nativeAsset,!this._uuid){var i=this._factory.getDragonBonesDataByRawData(n);i?this._uuid=i.name:console.warn("dragonbones name is empty")}var r=this._uuid+"#"+e;return this._factory.getDragonBonesData(r)||this._factory.parseDragonBonesData(n instanceof ArrayBuffer?n:n.buffer instanceof ArrayBuffer?n.buffer:n,r),r},n.getArmatureEnum=function(){if(this._armaturesEnum)return this._armaturesEnum;this.init();var t=this._factory.getDragonBonesDataByUUID(this._uuid);if(t){for(var e=t.armatureNames,n={},i=0;i<e.length;i++)n[e[i]]=i;return this._armaturesEnum=Yt(n)}return null},n.getAnimsEnum=function(t){this.init();var e=this._factory.getDragonBonesDataByUUID(this._uuid);if(e){var n=e.getArmature(t);if(!n)return null;var i={"<None>":0},r=n.animations,a=0;for(var o in r)r.hasOwnProperty(o)&&(i[o]=a+1,a++);return Yt(i)}return null},n.destroy=function(){return this._clear(),t.prototype.destroy.call(this)},n._clear=function(){this._factory&&(Jdt.sharedCache.resetArmature(this._uuid),this._factory.removeDragonBonesDataByUUID(this._uuid,!0))},L(e,[{key:"dragonBonesJson",get:function(){return this._dragonBonesJson},set:function(t){this._dragonBonesJson=t,this._dragonBonesJsonData=JSON.parse(t),this.reset()}}]),e}(Ou),npt=q((ept=ipt).prototype,"_dragonBonesJson",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),tpt=ept))||tpt;i.internal.DragonBonesAsset=cmt;var lmt,umt=($dt=nl("dragonBones.DragonBonesAtlasAsset"),tmt=Bl(ng),$dt((smt=function(t){function e(){var e;return X(e=t.call(this)||this,"_atlasJson",imt,V(e)),X(e,"_texture",rmt,V(e)),X(e,"_atlasJsonData",amt,V(e)),e._factory=null,X(e,"_textureAtlasData",omt,V(e)),e._clear(),e}F(e,t);var n=e.prototype;return n.createNode=function(t){var e=new qC(this.name);return e.addComponent("dragonBones.ArmatureDisplay").dragonAtlasAsset=this,t(null,e)},n.init=function(t){this._factory=t,this._atlasJsonData||(this._atlasJsonData=JSON.parse(this.atlasJson));var e=this._atlasJsonData;this._uuid=this._uuid||e.name,this._textureAtlasData?t.addTextureAtlasData(this._textureAtlasData,this._uuid):this._textureAtlasData=t.parseTextureAtlasData(e,this.texture,this._uuid)},n.destroy=function(){return this._clear(),t.prototype.destroy.call(this)},n._clear=function(){this._factory&&(Jdt.sharedCache.resetArmature(this._uuid),this._factory.removeTextureAtlasData(this._uuid,!0),this._factory.removeDragonBonesDataByUUID(this._uuid,!0)),this._textureAtlasData=null},L(e,[{key:"atlasJson",get:function(){return this._atlasJson},set:function(t){this._atlasJson=t,this._atlasJsonData=JSON.parse(this.atlasJson),this._clear()}},{key:"texture",get:function(){return this._texture},set:function(t){this._texture=t,this._clear()}}]),e}(Ou),imt=q((nmt=smt).prototype,"_atlasJson",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),rmt=q(nmt.prototype,"_texture",[cl,tmt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),amt=q(nmt.prototype,"_atlasJsonData",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{}}}),omt=q(nmt.prototype,"_textureAtlasData",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),emt=nmt))||emt);i.internal.DragonBonesAtlasAsset=umt;var hmt,fmt,_mt,pmt,dmt,mmt,gmt,vmt,ymt,xmt,Smt,Tmt,Amt,Emt,Cmt,bmt,wmt,Pmt,Imt,Rmt,Dmt,Omt,Mmt,Nmt,Lmt,Bmt,Fmt,zmt,Umt,kmt,Gmt,Hmt,Vmt,jmt,Wmt,Xmt,qmt,Ymt,Kmt,Qmt,Zmt,Jmt,$mt,tgt,egt,ngt,igt,rgt,agt,ogt,sgt,cgt=new Ri,lgt=nl("dragonBones.AttachUtil")(lmt=function(){function t(){this._inited=!1,this._armature=null,this._armatureNode=null,this._armatureDisplay=null}var e=t.prototype;return e.init=function(t){this._inited=!0,this._armature=t._armature,this._armatureNode=t.node,this._armatureDisplay=t},e.reset=function(){this._inited=!1,this._armature=null,this._armatureNode=null,this._armatureDisplay=null},e._syncAttachedNode=function(){if(this._inited){this._armatureNode.worldMatrix;var t=null,e=this._armatureDisplay.isAnimationCached();if(!e||!this._armatureDisplay||(t=this._armatureDisplay._curFrame&&this._armatureDisplay._curFrame.boneInfos))for(var n,i,r,a=this._armatureDisplay.sockets,o=this._armatureDisplay.socketNodes,s=new di,c=this._armature.getBones(),l=a.length-1;l>=0;l--){var u=a[l],h=u.target;if(h)if(h.isValid){var f=e?t[u.boneIndex]:c[u.boneIndex];f&&(n=h,i=f.globalTransformMatrix,r=void 0,(r=cgt).m00=i.a,r.m01=i.b,r.m04=-i.c,r.m05=-i.d,r.m12=i.tx,r.m13=i.ty,n._oldScale||(n._oldScale=n.scale.clone()),s.set(n._oldScale),n.matrix=cgt,n.scale=s.multiply(this._armatureNode.scale))}else o.delete(u.path),a.splice(l,1)}}},t}())||lmt,ugt=function(t){function e(){var e;return(e=t.call(this)||this)._armatures=new Set,e}F(e,t),e.getInstance=function(){return e._instance||(e._instance=new e,WM.registerSystem(e.ID,e._instance,DM.Priority.HIGH)),e._instance};var n=e.prototype;return n.add=function(t){t&&(this._armatures.has(t)||this._armatures.add(t))},n.remove=function(t){t&&this._armatures.has(t)&&this._armatures.delete(t)},n.postUpdate=function(t){this._armatures&&this._armatures.forEach((function(e){e.updateAnimation(t)}))},e}(DM);function hgt(t,e,n){Ge.Attr.setClassAttr(t,e,"type","Enum"),Ge.Attr.setClassAttr(t,e,"enumList",Yt.getList(n))}ugt.ID="ARMATURE",ugt._instance=void 0,i.internal.ArmatureSystem=ugt,function(t){t[t.default=-1]="default"}(rgt||(rgt={})),Zt(rgt),function(t){t[t["<None>"]=0]="<None>"}(agt||(agt={})),Zt(agt),function(t){t[t.REALTIME=0]="REALTIME"}(ogt||(ogt={})),Zt(agt),function(t){t[t.REALTIME=0]="REALTIME",t[t.SHARED_CACHE=1]="SHARED_CACHE",t[t.PRIVATE_CACHE=2]="PRIVATE_CACHE"}(sgt||(sgt={})),Zt(sgt);var fgt=(hmt=nl("dragonBones.ArmatureDisplay.DragonBoneSocket"),fmt=Bl(qC),hmt((dmt=q((pmt=function(t,e){void 0===t&&(t=""),void 0===e&&(e=null),X(this,"path",dmt,this),X(this,"target",mmt,this),this.boneIndex=null,this.path=t,this.target=e}).prototype,"path",[cl,yl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),mmt=q(pmt.prototype,"target",[fmt,yl,cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_mt=pmt))||_mt);Nt(fgt,"dragonBones.ArmatureDisplay.DragonBoneSocket");var _gt=(gmt=nl("dragonBones.ArmatureDisplay"),vmt=vl(),ymt=pl(),xmt=Bl(cmt),Smt=Al(),Tmt=Bl(umt),Amt=Al(),Emt=xl(),Cmt=xl(),bmt=Tl(),wmt=Bl(rgt),Pmt=Al(),Imt=Bl(agt),Rmt=Tl(),Dmt=Al(),Omt=Tl(),Mmt=Al(),Nmt=Al(),Lmt=Al(),Bmt=Al(),Fmt=Al(),zmt=Bl([fgt]),Umt=Al(),gmt(kmt=vmt(kmt=ymt(kmt=_l((igt=ngt=function(t){function e(){var e;return X(e=t.call(this)||this,"playTimes",Hmt,V(e)),X(e,"premultipliedAlpha",Vmt,V(e)),e._armature=null,e.attachUtil=void 0,X(e,"_defaultArmatureIndexValue",jmt,V(e)),X(e,"_dragonAsset",Wmt,V(e)),X(e,"_dragonAtlasAsset",Xmt,V(e)),X(e,"_armatureName",qmt,V(e)),X(e,"_animationName",Ymt,V(e)),X(e,"_animationIndexValue",Kmt,V(e)),e._preCacheMode=-1,e._cacheMode=sgt.REALTIME,X(e,"_defaultCacheModeValue",Qmt,V(e)),X(e,"_timeScale",Zmt,V(e)),X(e,"_playTimes",Jmt,V(e)),X(e,"_debugBones",$mt,V(e)),e._debugDraw=null,X(e,"_enableBatch",tgt,V(e)),e._armatureKey="",e._accTime=0,e._playCount=0,e._frameCache=null,e._curFrame=null,e._playing=!1,e._armatureCache=null,e._eventTarget=void 0,e._factory=null,e._displayProxy=null,e._drawIdx=0,e._drawList=new Wt((function(){return{material:null,texture:null,indexOffset:0,indexCount:0}}),1),e.maxVertexCount=0,e.maxIndexCount=0,e._materialCache={},e._enumArmatures=Yt({}),e._enumAnimations=Yt({}),e._socketNodes=new Map,e._cachedSockets=new Map,X(e,"_sockets",egt,V(e)),e._inited=void 0,e._cacheModeEnum=void 0,e._eventTarget=new fn,e._inited=!1,e.attachUtil=new lgt,e.initFactory(),hgt(V(e),"_animationIndex",e._enumAnimations),hgt(V(e),"_defaultArmatureIndex",e._enumArmatures),e}F(e,t);var n=e.prototype;return n.initFactory=function(){this._factory=Fdt.getInstance()},n.onLoad=function(){for(var t=this.node.children,e=0,n=t.length;e<n;e++){var i=t[e];0===(i.name&&i.name.search("CHILD_ARMATURE-"))&&i.destroy()}},n._requestDrawData=function(t,e,n,i){var r=this._drawList.add();return r.material=t,r.texture=e,r.indexOffset=n,r.indexCount=i,r},n.destroyRenderData=function(){this._drawList.reset(),t.prototype.destroyRenderData.call(this)},n.getMaterialForBlend=function(t,e){var n=t+"/"+e,i=this._materialCache[n];if(i)return i;var r=this.getMaterial(0);return(i=new Hv({parent:r,subModelIdx:0,owner:this})).recompileShaders({USE_LOCAL:!0},0),this._materialCache[n]=i,i.overridePipelineStates({blendState:{targets:[{blendSrc:t,blendDst:e}]}}),i},n._render=function(t){if(this._renderData&&this._drawList){var e=this._renderData,n=e.chunk,i=n.vertexAccessor,r=e.getMeshBuffer(),a=r.indexOffset;i.appendIndices(n.bufferId,e.indices);for(var o=0;o<this._drawList.length;o++){this._drawIdx=o;var s=this._drawList.data[o];if(s.texture){var c=r.requireFreeIA(t.device);c.firstIndex=a+s.indexOffset,c.indexCount=s.indexCount,t.commitIA(this,c,s.texture,s.material,this.node)}}}},n._updateBatch=function(){this._materialCache={},this.markForUpdateRenderData()},n._updateMaterial=function(){this.markForUpdateRenderData()},n.__preload=function(){t.prototype.__preload.call(this),this._init()},n._init=function(){if(this._cacheMode=this._defaultCacheMode,!this._inited){this._inited=!0,this._parseDragonAtlasAsset(),this._refresh();for(var t=this.node.children,e=0,n=t.length;e<n;e++){var i=t[e];i&&"DEBUG_DRAW_NODE"===i.name&&i.destroy()}this._updateDebugDraw(),this._indexBoneSockets(),this._updateSocketBindings()}},n.getArmatureKey=function(){return this._armatureKey},n.setAnimationCacheMode=function(t){this._preCacheMode!==t&&(this._cacheMode=t,this._buildArmature(),this._armature&&!this.isAnimationCached()&&this._factory._dragonBones.clock.add(this._armature),this._updateSocketBindings(),this.markForUpdateRenderData())},n.isAnimationCached=function(){return this._cacheMode!==sgt.REALTIME},n.onEnable=function(){t.prototype.onEnable.call(this),this._armature&&!this.isAnimationCached()&&this._factory._dragonBones.clock.add(this._armature),this._flushAssembler(),ugt.getInstance().add(this)},n.onDisable=function(){t.prototype.onDisable.call(this),this._armature&&!this.isAnimationCached()&&this._factory._dragonBones.clock.remove(this._armature),ugt.getInstance().remove(this)},n._emitCacheCompleteEvent=function(){this._eventTarget.emit(gdt.LOOP_COMPLETE),this._eventTarget.emit(gdt.COMPLETE)},n.updateAnimation=function(t){if(this.isAnimationCached()&&this._frameCache){this.markForUpdateRenderData();var e=this._frameCache;if(e.isInited()){var n=e.frames;if(this._playing){var i=Jdt.FrameTime;0===this._accTime&&0===this._playCount&&this._eventTarget.emit(gdt.START),this._accTime+=t*this.timeScale*1;var r=Math.floor(this._accTime/i);if(e.isCompleted||(e.updateToFrame(r),this._renderData&&(this._renderData.vertexCount<e.maxVertexCount||this._renderData.indexCount<e.maxIndexCount)&&(this.maxVertexCount=e.maxVertexCount>this.maxVertexCount?e.maxVertexCount:this.maxVertexCount,this.maxIndexCount=e.maxIndexCount>this.maxIndexCount?e.maxIndexCount:this.maxIndexCount,this._renderData.resize(this.maxVertexCount,this.maxIndexCount),(!this._renderData.indices||this.maxIndexCount>this._renderData.indices.length)&&(this._renderData.indices=new Uint16Array(this.maxIndexCount)))),e.isCompleted&&r>=n.length){if(this._playCount++,this.playTimes>0&&this._playCount>=this.playTimes)return this._curFrame=n[n.length-1],this._accTime=0,this._playing=!1,this._playCount=0,this._emitCacheCompleteEvent(),void this.attachUtil._syncAttachedNode();this._accTime=0,r=0,this._emitCacheCompleteEvent()}this._curFrame=n[r],this.attachUtil._syncAttachedNode()}else e.isInvalid()&&(e.updateToFrame(),this._curFrame=n[n.length-1],this._renderData&&(this._renderData.vertexCount<e.maxVertexCount||this._renderData.indexCount<e.maxIndexCount)&&(this.maxVertexCount=e.maxVertexCount>this.maxVertexCount?e.maxVertexCount:this.maxVertexCount,this.maxIndexCount=e.maxIndexCount>this.maxIndexCount?e.maxIndexCount:this.maxIndexCount,this._renderData.resize(this.maxVertexCount,this.maxIndexCount),(!this._renderData.indices||this.maxIndexCount>this._renderData.indices.length)&&(this._renderData.indices=new Uint16Array(this.maxIndexCount))))}}},n.onDestroy=function(){this._materialInstances=this._materialInstances.filter((function(t){return!!t})),this._inited=!1,this._cacheMode===sgt.PRIVATE_CACHE?(this._armatureCache.dispose(),this._armatureCache=null,this._armature=null):this._cacheMode===sgt.SHARED_CACHE?(this._armatureCache=null,this._armature=null):this._armature&&(this._armature.dispose(),this._armature=null),this._drawList.destroy(),t.prototype.onDestroy.call(this)},n._updateDebugDraw=function(){if(this.debugBones){if(!this._debugDraw){var t=new qC("DEBUG_DRAW_NODE");t.hideFlags|=Ye.Flags.DontSave|Ye.Flags.HideInHierarchy;var e=t.addComponent(LY);e.lineWidth=1,e.strokeColor=new _i(255,0,0,255),this._debugDraw=e}this._debugDraw.node.parent=this.node}else this._debugDraw&&(this._debugDraw.node.parent=null);this.markForUpdateRenderData()},n._buildArmature=function(){if(this.dragonAsset&&this.dragonAtlasAsset&&this.armatureName){this._armature&&(this._preCacheMode===sgt.PRIVATE_CACHE?this._armatureCache.dispose():this._preCacheMode===sgt.REALTIME&&this._armature.dispose(),this._armatureCache=null,this._armature=null,this._displayProxy=null,this._frameCache=null,this._curFrame=null,this._playing=!1,this._preCacheMode=-1),this._cacheMode===sgt.SHARED_CACHE?this._armatureCache=Jdt.sharedCache:this._cacheMode===sgt.PRIVATE_CACHE&&(this._armatureCache=new Jdt,this._armatureCache.enablePrivateMode());var t=this.dragonAtlasAsset._uuid;if(this._armatureKey=this.dragonAsset.init(this._factory,t),this.isAnimationCached()&&(this._armature=this._armatureCache.getArmatureCache(this.armatureName,this._armatureKey,t),this._armature||(this._cacheMode=sgt.REALTIME)),this._preCacheMode=this._cacheMode,this._cacheMode===sgt.REALTIME){if(this._displayProxy=this._factory.buildArmatureDisplay(this.armatureName,this._armatureKey,"",t),!this._displayProxy)return;this._displayProxy._ccNode=this.node,this._displayProxy._ccComponent=this,this._displayProxy.setEventTarget(this._eventTarget),this._armature=this._displayProxy._armature,this._armature.animation.timeScale=this.timeScale}if(this._cacheMode!==sgt.REALTIME&&this.debugBones&&console.warn("Debug bones is invalid in cached mode"),this._armature){var e=this._armature.armatureData.aabb;this.node._uiProps.uiTransformComp.setContentSize(e.width,e.height)}this._updateBatch(),this.attachUtil.init(this),this.animationName&&this.playAnimation(this.animationName,this.playTimes),this._flushAssembler()}},n.querySockets=function(){return this._armature?(0===this._cachedSockets.size&&this._indexBoneSockets(),Array.from(this._cachedSockets.keys()).sort()):[]},n.setBlendHash=function(){-1!==this._blendHash&&(this._blendHash=-1)},n.querySocketPathByName=function(t){for(var e,n=[],i=W(this._cachedSockets.keys());!(e=i()).done;){var r=e.value;r.endsWith(t)&&n.push(r)}return n},n._parseDragonAtlasAsset=function(){this.dragonAtlasAsset&&this.dragonAtlasAsset.init(this._factory)},n._refresh=function(){this._buildArmature(),this._indexBoneSockets(),this.markForUpdateRenderData()},n._updateCacheModeEnum=function(){this._cacheModeEnum=Yt({}),this._armature?Object.assign(this._cacheModeEnum,sgt):Object.assign(this._cacheModeEnum,ogt),hgt(this,"_defaultCacheMode",this._cacheModeEnum)},n._updateAnimEnum=function(){var t;t=this.dragonAsset?this.dragonAsset.getAnimsEnum(this.armatureName):agt,this._enumAnimations=Yt({}),Object.assign(this._enumAnimations,t||agt),Yt.update(this._enumAnimations),hgt(this,"_animationIndex",this._enumAnimations)},n._updateArmatureEnum=function(){var t;t=this.dragonAsset?this.dragonAsset.getArmatureEnum():rgt,this._enumArmatures=Yt({}),Object.assign(this._enumArmatures,t||rgt),Yt.update(this._enumArmatures),hgt(this,"_defaultArmatureIndex",this._enumArmatures)},n._indexBoneSockets=function(){if(this._armature){this._cachedSockets.clear();var t=this._cachedSockets,e=function t(e,n,i){if(i.has(e))return i.get(e);var r=n[e];if(!r.parent)return i.set(e,r.name),r.path=r.name,r.name;var a=t(r.parent._boneIndex,n,i)+"/"+r.name;return i.set(e,a),r.path=a,a};!function n(i,r){for(var a=r.getBones(),o=new Map,s=0;s<a.length;s++)a[s]._boneIndex=s;for(var c=0;c<a.length;c++)e(c,a,o);for(var l,u=W(o.keys());!(l=u()).done;){var h=l.value;t.set(""+i+o.get(h),h)}for(var f=r.getSlots(),_=0;_<f.length;_++)f[_].childArmature&&n(f[_].name,f[_].childArmature)}("",this._armature)}},n.playAnimation=function(t,e){if(this.playTimes=void 0===e?-1:e,this.animationName=t,this.isAnimationCached()){var n=this._armatureCache.getAnimationCache(this._armatureKey,t);n||(n=this._armatureCache.initAnimationCache(this._armatureKey,t)),n&&(this._accTime=0,this._playCount=0,this._frameCache=n,this._sockets.length>0&&this._frameCache.enableCacheAttachedInfo(),this._frameCache.updateToFrame(0),this._playing=!0,this._curFrame=this._frameCache.frames[0])}else if(this._armature)return this._armature.animation.play(t,this.playTimes);return this.markForUpdateRenderData(),null},n.updateAnimationCache=function(t){this.isAnimationCached()&&this._armatureCache.updateAnimationCache(this._armatureKey,t)},n.invalidAnimationCache=function(){this.isAnimationCached()&&this._armatureCache.invalidAnimationCache(this._armatureKey)},n.getArmatureNames=function(){var t=this._factory.getDragonBonesData(this._armatureKey);return t&&t.armatureNames||[]},n.getAnimationNames=function(t){var e=[],n=this._factory.getDragonBonesData(this._armatureKey);if(n){var i=n.getArmature(t);if(i)for(var r in i.animations)i.animations.hasOwnProperty(r)&&e.push(r)}return e},n.on=function(t,e,n){this.addEventListener(t,e,n)},n.off=function(t,e,n){this.removeEventListener(t,e,n)},n.once=function(t,e,n){this._eventTarget.once(t,e,n)},n.addEventListener=function(t,e,n){this._eventTarget.on(t,e,n)},n.removeEventListener=function(t,e,n){this._eventTarget.off(t,e,n)},n.buildArmature=function(t,e){return this._factory.createArmatureNode(this,t,e)},n.armature=function(){return this._armature},n._flushAssembler=function(){var t=e.Assembler.getAssembler(this);this._assembler!==t&&(this._assembler=t),this._armature&&this._assembler&&(this._renderData=this._assembler.createData(this),this._renderData&&(this.maxVertexCount=this._renderData.vertexCount,this.maxIndexCount=this._renderData.indexCount),this.markForUpdateRenderData(),this._updateColor())},n._updateSocketBindings=function(){if(this._armature){this._socketNodes.clear();for(var t=0,e=this._sockets.length;t<e;t++){var n=this._sockets[t];if(n.path&&n.target){var i=this._cachedSockets.get(n.path);if(!i){console.error("Skeleton data does not contain path "+n.path);continue}n.boneIndex=i,this._socketNodes.set(n.path,n.target)}}}},n._verifySockets=function(t){for(var e=0,n=t.length;e<n;e++){var i=t[e].target;!i||i.parent&&i.parent===this.node||console.error("Target node "+i.name+" is expected to be a direct child of "+this.node.name)}},L(e,[{key:"dragonAsset",get:function(){return this._dragonAsset},set:function(t){this._dragonAsset=t,this._refresh()}},{key:"dragonAtlasAsset",get:function(){return this._dragonAtlasAsset},set:function(t){this._dragonAtlasAsset=t,this._parseDragonAtlasAsset(),this._refresh()}},{key:"armatureName",get:function(){return this._armatureName},set:function(t){this._armatureName=t;var e=this.getAnimationNames(this._armatureName);(!this.animationName||e.indexOf(this.animationName)<0)&&(this.animationName=""),this._armature&&!this.isAnimationCached()&&this._factory._dragonBones.clock.remove(this._armature),this._refresh(),this._armature&&!this.isAnimationCached()&&this._factory._dragonBones.clock.add(this._armature)}},{key:"animationName",get:function(){return this._animationName},set:function(t){this._animationName=t}},{key:"_defaultArmatureIndex",get:function(){return this._defaultArmatureIndexValue},set:function(t){this._defaultArmatureIndexValue=t;var e="";if(this.dragonAsset){var n;if(this.dragonAsset&&(n=this.dragonAsset.getArmatureEnum()),!n)return void b(7400,this.name);e=n[this._defaultArmatureIndex]}void 0!==e?this.armatureName=e:b(7401,this.name),this.markForUpdateRenderData()}},{key:"_animationIndex",get:function(){return this._animationIndexValue},set:function(t){var e;if(this._animationIndexValue=t,0!==this._animationIndex){if(this.dragonAsset&&(e=this.dragonAsset.getAnimsEnum(this.armatureName)),e){var n=e[this._animationIndex];void 0!==n?this.playAnimation(n,this.playTimes):b(7402,this.name)}}else this.animationName=""}},{key:"_defaultCacheMode",get:function(){return this._defaultCacheModeValue},set:function(t){if(this._defaultCacheModeValue=t,this._defaultCacheMode!==sgt.REALTIME&&this._armature&&!Jdt.canCache(this._armature))return this._defaultCacheMode=sgt.REALTIME,void console.warn("Animation cache mode doesn't support skeletal nesting");this.setAnimationCacheMode(this._defaultCacheMode)}},{key:"timeScale",get:function(){return this._timeScale},set:function(t){this._timeScale=t,this._armature&&!this.isAnimationCached()&&(this._armature.animation.timeScale=this.timeScale)}},{key:"debugBones",get:function(){return this._debugBones},set:function(t){this._debugBones=t,this._updateDebugDraw()}},{key:"sockets",get:function(){return this._sockets},set:function(t){this._verifySockets(t),this._sockets=t,this._updateSocketBindings(),t.length>0&&this._frameCache&&this._frameCache.enableCacheAttachedInfo()}},{key:"socketNodes",get:function(){return this._socketNodes}},{key:"drawList",get:function(){return this._drawList}}]),e}(Sq),ngt.AnimationCacheMode=sgt,q((Gmt=igt).prototype,"dragonAsset",[yl,xmt,Smt],Object.getOwnPropertyDescriptor(Gmt.prototype,"dragonAsset"),Gmt.prototype),q(Gmt.prototype,"dragonAtlasAsset",[yl,Tmt,Amt],Object.getOwnPropertyDescriptor(Gmt.prototype,"dragonAtlasAsset"),Gmt.prototype),q(Gmt.prototype,"armatureName",[Emt],Object.getOwnPropertyDescriptor(Gmt.prototype,"armatureName"),Gmt.prototype),q(Gmt.prototype,"animationName",[Cmt],Object.getOwnPropertyDescriptor(Gmt.prototype,"animationName"),Gmt.prototype),q(Gmt.prototype,"_defaultArmatureIndex",[bmt,yl,wmt,Pmt],Object.getOwnPropertyDescriptor(Gmt.prototype,"_defaultArmatureIndex"),Gmt.prototype),q(Gmt.prototype,"_animationIndex",[yl,Imt,Rmt,Dmt],Object.getOwnPropertyDescriptor(Gmt.prototype,"_animationIndex"),Gmt.prototype),q(Gmt.prototype,"_defaultCacheMode",[yl,Omt,Mmt],Object.getOwnPropertyDescriptor(Gmt.prototype,"_defaultCacheMode"),Gmt.prototype),q(Gmt.prototype,"timeScale",[yl,Nmt,cl],Object.getOwnPropertyDescriptor(Gmt.prototype,"timeScale"),Gmt.prototype),Hmt=q(Gmt.prototype,"playTimes",[Lmt,yl,cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),Vmt=q(Gmt.prototype,"premultipliedAlpha",[cl,yl,Bmt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),q(Gmt.prototype,"debugBones",[Fmt,yl],Object.getOwnPropertyDescriptor(Gmt.prototype,"debugBones"),Gmt.prototype),q(Gmt.prototype,"sockets",[zmt,Umt],Object.getOwnPropertyDescriptor(Gmt.prototype,"sockets"),Gmt.prototype),jmt=q(Gmt.prototype,"_defaultArmatureIndexValue",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return rgt.default}}),Wmt=q(Gmt.prototype,"_dragonAsset",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Xmt=q(Gmt.prototype,"_dragonAtlasAsset",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),qmt=q(Gmt.prototype,"_armatureName",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Ymt=q(Gmt.prototype,"_animationName",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Kmt=q(Gmt.prototype,"_animationIndexValue",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Qmt=q(Gmt.prototype,"_defaultCacheModeValue",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return sgt.REALTIME}}),Zmt=q(Gmt.prototype,"_timeScale",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Jmt=q(Gmt.prototype,"_playTimes",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),$mt=q(Gmt.prototype,"_debugBones",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),tgt=q(Gmt.prototype,"_enableBatch",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),egt=q(Gmt.prototype,"_sockets",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),kmt=Gmt))||kmt)||kmt)||kmt)||kmt);i.internal.ArmatureDisplay=_gt;var pgt,dgt,mgt,ggt,vgt,ygt,xgt,Sgt,Tgt,Agt,Egt,Cgt,bgt,wgt,Pgt,Igt,Rgt,Dgt,Ogt,Mgt,Ngt=new _i(255,0,0,255),Lgt=new _i(0,0,255,255),Bgt=new _i(0,255,0,255),Fgt=0,zgt=0,Ugt=0,kgt=0,Ggt=0,Hgt=0,Vgt=0,jgt=0,Wgt=0,Xgt=new Float32Array(4),qgt=new Ri,Ygt=null,Kgt=null;function Qgt(t,e){if(!t)return null;var n,i;switch(e){case 1:n=vgt?Fr.ONE:Fr.SRC_ALPHA,i=Fr.ONE;break;case 10:n=Fr.DST_COLOR,i=Fr.ONE_MINUS_SRC_ALPHA;break;case 12:n=Fr.ONE,i=Fr.ONE_MINUS_SRC_COLOR;break;case 0:default:n=vgt?Fr.ONE:Fr.SRC_ALPHA,i=Fr.ONE_MINUS_SRC_ALPHA}return Egt.setBlendHash(),Egt.getMaterialForBlend(n,i)}function Zgt(t,e){var n=t.a*e*ggt,i=vgt?n/255:1,r=t.r*pgt*i/255,a=t.g*dgt*i/255,o=t.b*mgt*i/255;Xgt[0]=r,Xgt[1]=a,Xgt[2]=o,Xgt[3]=vgt?1:n/255}var Jgt=null,$gt={accessor:Jgt,vCount:32767,ensureAccessor:function(){if(!Jgt){var t=WM.root.device,e=WM.root.batcher2D,n=rW;this.accessor=Jgt=new k0(t,n,this.vCount),e.registerBufferAccessor(Number.parseInt("DRAGONBONES",36),Jgt)}return this.accessor},createData:function(t){var e=t.renderData;if(!e){this.ensureAccessor();for(var n=t._armature._slots,i=0,r=0,a=0;a<n.length;++a){var o=n[a];i+=o._localVertices.length/4,r+=o._indices.length}(e=wW.add(rW,this.accessor)).resize(i,r),e.indices&&r===e.indices.length||(e.indices=new Uint16Array(r))}return e},updateRenderData:function(t){Egt=t,t._armature&&function(t){var e=t._armature;if(e){ygt=!0,vgt=t.premultipliedAlpha,t.drawList.reset(),Egt=t,Agt=t.node,xgt=t.renderData,Egt=t,wgt=0,Ygt=null;var n,i=t.color;if(pgt=i.r/255,dgt=i.g/255,mgt=i.b/255,ggt=i.a/255,4294967295!==i._val&&(wgt|=1),Egt._enableBatch&&(n=Agt.worldMatrix,ygt=!1,wgt|=16),Fgt=0,Ugt=0,kgt=0,Ggt=0,Hgt=0,Wgt=0,Vgt=Egt.maxVertexCount,jgt=Egt.maxIndexCount,t.isAnimationCached())!function(t,e){if(t){var n=t.segments;if(0!==n.length){var i=null,r=t.vertices,a=t.indices,o=0,s=0,c=0,l=0;e&&(Pgt=e.m00,Dgt=e.m01,Igt=e.m04,Ogt=e.m05,Rgt=e.m12,Mgt=e.m13);var u=0,h=t.colors,f=h[u++],_=f.vfOffset;Zgt(f,1);for(var p=xgt,d=p.chunk.vb,m=p.indices,g=0,v=n.length;g<v;g++){var y=n[g];if(i=Qgt(y.tex,y.blendMode)){if(Ygt||(Ygt=i),ygt||i.hash!==Ygt.hash||y.tex&&y.tex!==Kgt){ygt=!1;var x=Hgt-Wgt;x>0&&(Egt._requestDrawData(Ygt,Kgt,Wgt,x),Wgt=Hgt),Ygt=i,Kgt=y.tex}zgt=y.vertexCount,Ggt=y.indexCount,o=p.chunk.vertexOffset;for(var S=Hgt,T=Hgt+Ggt;S<T;S++)m[S]=o+Ugt+a[c++];l=y.vfCount;var A=r.subarray(s,l);d.set(A,s);var E=0;if(e)for(var C=0,b=zgt;C<b;C++)Cgt=d[E],bgt=d[E+1],d[E]=Cgt*Pgt+bgt*Igt+Rgt,d[E+1]=Cgt*Dgt+bgt*Ogt+Mgt,E+=9;if(1&wgt)for(var w=s/9*5,P=s,I=s+l;P<I;P+=9,w+=5)w>=_&&(Zgt(f=h[u++],1),_=f.vfOffset),d.set(Xgt,P+5);s+=l,Ugt+=zgt,Hgt+=Ggt,zgt=0,Ggt=0}}var R=Hgt-Wgt;Kgt&&R>0&&Egt._requestDrawData(Ygt,Kgt,Wgt,R)}}}(t._curFrame,n);else{tvt(e,1,n);var r=t._debugDraw;if(t.debugBones&&r){r.clear(),r.lineWidth=5,r.strokeColor=Ngt,r.fillColor=Lgt;for(var a=e.getBones(),o=0,s=a.length;o<s;o++){var c=a[o],l=Math.max(c.boneData.length,5),u=c.globalTransformMatrix.tx,h=c.globalTransformMatrix.ty,f=u+c.globalTransformMatrix.a*l,_=h+c.globalTransformMatrix.b*l;r.moveTo(u,h),r.lineTo(f,_),r.stroke(),r.circle(u,h,2*Math.PI),r.fill(),0===o&&(r.fillColor=Bgt)}}}Jgt.getMeshBuffer(xgt.chunk.bufferId).setDirty(),t.attachUtil._syncAttachedNode(),Agt=void 0,Egt=void 0}}(t)},updateColor:function(t){t&&(Egt=t).markForUpdateRenderData()}};function tvt(t,e,n){var i=xgt;Tgt=i.chunk.vb,Sgt=i.indices;for(var r,a,o,s,c,l,u=t._slots,h=0,f=u.length;h<f;h++)if(s=(c=u[h])._color,c._visible&&c._displayData)if(n?c._mulMat(c._worldMatrix,n,c._matrix):Ri.copy(c._worldMatrix,c._matrix),c.childArmature)tvt(c.childArmature,s.a/255,c._worldMatrix);else if(r=Qgt(c.getTexture(),c._blendMode)){Ygt||(Ygt=r);var _=c.getTexture();if(ygt||r.hash!==Ygt.hash||_&&Kgt!==_){ygt=!1;var p=Hgt-Wgt;p>0&&(Egt._requestDrawData(Ygt,Kgt,Wgt,p),Wgt=Hgt),Kgt=_,Ygt=r}Zgt(s,e),qgt.set(c._worldMatrix),a=c._localVertices,zgt=a.length/4,Fgt=9*zgt,o=c._indices,Ggt=o.length;var d=!1;if(Ugt+zgt>Vgt&&(Vgt=Ugt+zgt,d=!0),Hgt+Ggt>jgt&&(jgt=Hgt+Ggt,d=!0),d){var m=Sgt,g=i.chunk.vertexOffset;i.resizeAndCopy(Vgt,jgt>i.indexCount?jgt:i.indexCount),Tgt=i.chunk.vb,jgt>Sgt.length&&(Sgt=i.indices=new Uint16Array(jgt));for(var v=i.chunk.vertexOffset-g,y=0;y<Hgt;++y)Sgt[y]=m[y]+v}Pgt=qgt.m00,Igt=qgt.m04,Rgt=qgt.m12,Dgt=qgt.m01,Ogt=qgt.m05,Mgt=qgt.m13;for(var x=0,S=a.length,T=kgt;x<S;T+=9)Cgt=a[x++],bgt=a[x++],Tgt[T]=Cgt*Pgt+bgt*Igt+Rgt,Tgt[T+1]=Cgt*Dgt+bgt*Ogt+Mgt,Tgt[T+3]=a[x++],Tgt[T+4]=a[x++],Tgt.set(Xgt,T+5);for(var A=i.chunk.vertexOffset,E=0,C=o.length,b=Hgt;E<C;E++,b++)Sgt[b]=Ugt+o[E]+A;kgt+=Fgt,Ugt+=zgt,Hgt+=Ggt,zgt=0,Ggt=0}l=Hgt-Wgt,Kgt&&l>0&&(Egt._requestDrawData(Ygt,Kgt,Wgt,l),Wgt=Hgt),Egt.maxIndexCount<jgt&&(Egt.maxIndexCount=jgt),Egt.maxVertexCount<Vgt&&(Egt.maxVertexCount=Vgt)}i.internal.DragonBonesAssembler=$gt;var evt,nvt,ivt,rvt={getAssembler:function(){return $gt}};_gt.Assembler=rvt,function(t){t[t.FFD=0]="FFD",t[t.AdjustColor=10]="AdjustColor",t[t.BevelFilter=11]="BevelFilter",t[t.BlurFilter=12]="BlurFilter",t[t.DropShadowFilter=13]="DropShadowFilter",t[t.GlowFilter=14]="GlowFilter",t[t.GradientBevelFilter=15]="GradientBevelFilter",t[t.GradientGlowFilter=16]="GradientGlowFilter"}(evt||(evt={})),function(t){t[t.Frame=0]="Frame",t[t.Sound=1]="Sound"}(nvt||(nvt={})),function(t){t[t.None=0]="None",t[t.SameLayer=1]="SameLayer",t[t.SameGroup=2]="SameGroup",t[t.SameLayerAndGroup=3]="SameLayerAndGroup",t[t.All=4]="All"}(ivt||(ivt={})),t("dragonBones",Object.freeze({__proto__:null,get ExtensionType(){return evt},get EventType(){return nvt},get AnimationFadeOutMode(){return ivt},CCFactory:Fdt,CCSlot:Ldt,CCTextureAtlasData:Mdt,CCTextureData:Ndt,CCArmatureDisplay:Bdt,AnimationCache:Zdt,ArmatureCache:Jdt,DragonBonesAsset:cmt,DragonBonesAtlasAsset:umt,timeScale:1,get AnimationCacheMode(){return sgt},DragonBoneSocket:fgt,ArmatureDisplay:_gt,AttachUtil:lgt,simpleDragonBoneAssembler:rvt,DragonBones:rpt,BaseObject:apt,Matrix:opt,Transform:spt,ColorTransform:cpt,Point:lpt,Rectangle:upt,UserData:hpt,ActionData:fpt,DragonBonesData:_pt,ArmatureData:ppt,BoneData:dpt,SurfaceData:mpt,SlotData:gpt,ConstraintData:vpt,IKConstraintData:ypt,PathConstraintData:xpt,CanvasData:Spt,SkinData:Tpt,VerticesData:Apt,DisplayData:Ept,ImageDisplayData:Cpt,ArmatureDisplayData:bpt,MeshDisplayData:wpt,BoundingBoxDisplayData:Ppt,PathDisplayData:Ipt,WeightData:Rpt,BoundingBoxData:Dpt,RectangleBoundingBoxData:Opt,EllipseBoundingBoxData:Mpt,PolygonBoundingBoxData:Npt,AnimationData:Lpt,TimelineData:Bpt,AnimationConfig:Fpt,TextureAtlasData:zpt,TextureData:Upt,DeformVertices:kpt,Armature:Gpt,TransformObject:Hpt,Bone:Vpt,Surface:jpt,Slot:Wpt,Constraint:Xpt,IKConstraint:qpt,PathConstraint:Ypt,WorldClock:Kpt,Animation:Qpt,AnimationState:Zpt,BonePose:Jpt,BlendState:$pt,TimelineState:tdt,TweenTimelineState:edt,BoneTimelineState:ndt,SlotTimelineState:idt,ConstraintTimelineState:rdt,ActionTimelineState:adt,ZOrderTimelineState:odt,BoneAllTimelineState:sdt,BoneTranslateTimelineState:cdt,BoneRotateTimelineState:ldt,BoneScaleTimelineState:udt,SurfaceTimelineState:hdt,SlotDislayTimelineState:fdt,SlotColorTimelineState:_dt,DeformTimelineState:pdt,IKConstraintTimelineState:ddt,AnimationTimelineState:mdt,EventObject:gdt,DataParser:vdt,ObjectDataParser:ydt,ActionFrame:xdt,BinaryDataParser:Sdt,BaseFactory:Tdt,BuildArmaturePackage:Adt,BinaryOffset:Edt,ArmatureType:Cdt,BoneType:bdt,DisplayType:wdt,BoundingBoxType:Pdt,ActionType:Idt,BlendMode:Rdt,TweenType:Ddt,TimelineType:Odt}))}}}));
